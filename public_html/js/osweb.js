/*!
* @license CreateJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2015 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
this.createjs=this.createjs||{},createjs.extend=function(a,b){"use strict";function c(){this.constructor=a}return c.prototype=b.prototype,a.prototype=new c},this.createjs=this.createjs||{},createjs.promote=function(a,b){"use strict";var c=a.prototype,d=Object.getPrototypeOf&&Object.getPrototypeOf(c)||c.__proto__;if(d){c[(b+="_")+"constructor"]=d.constructor;for(var e in d)c.hasOwnProperty(e)&&"function"==typeof d[e]&&(c[b+e]=d[e])}return a},this.createjs=this.createjs||{},createjs.indexOf=function(a,b){"use strict";for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1},this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.type=a,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!b,this.cancelable=!!c,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var b=a.prototype;b.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._listeners=null,this._captureListeners=null}var b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b.addEventListener=function(a,b,c){var d;d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var e=d[a];return e&&this.removeEventListener(a,b,c),e=d[a],e?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a,b,c){if("string"==typeof a){var d=this._listeners;if(!(b||d&&d[a]))return!0;a=new createjs.Event(a,b,c)}else a.target&&a.clone&&(a=a.clone());try{a.target=this}catch(e){}if(a.bubbles&&this.parent){for(var f=this,g=[f];f.parent;)g.push(f=f.parent);var h,i=g.length;for(h=i-1;h>=0&&!a.propagationStopped;h--)g[h]._dispatchEvent(a,1+(0==h));for(h=1;i>h&&!a.propagationStopped;h++)g[h]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return!a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;try{a.currentTarget=this}catch(f){}try{a.eventPhase=b}catch(f){}a.removed=!1,e=e.slice();for(var g=0;c>g&&!a.immediatePropagationStopped;g++){var h=e[g];h.handleEvent?h.handleEvent(a):h(a),a.removed&&(this.off(a.type,h,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ticker cannot be instantiated."}a.RAF_SYNCHED="synched",a.RAF="raf",a.TIMEOUT="timeout",a.useRAF=!1,a.timingMode=null,a.maxDelta=0,a.paused=!1,a.removeEventListener=null,a.removeAllEventListeners=null,a.dispatchEvent=null,a.hasEventListener=null,a._listeners=null,createjs.EventDispatcher.initialize(a),a._addEventListener=a.addEventListener,a.addEventListener=function(){return!a._inited&&a.init(),a._addEventListener.apply(a,arguments)},a._inited=!1,a._startTime=0,a._pausedTime=0,a._ticks=0,a._pausedTicks=0,a._interval=50,a._lastTime=0,a._times=null,a._tickTimes=null,a._timerId=null,a._raf=!0,a.setInterval=function(b){a._interval=b,a._inited&&a._setupTick()},a.getInterval=function(){return a._interval},a.setFPS=function(b){a.setInterval(1e3/b)},a.getFPS=function(){return 1e3/a._interval};try{Object.defineProperties(a,{interval:{get:a.getInterval,set:a.setInterval},framerate:{get:a.getFPS,set:a.setFPS}})}catch(b){console.log(b)}a.init=function(){a._inited||(a._inited=!0,a._times=[],a._tickTimes=[],a._startTime=a._getTime(),a._times.push(a._lastTime=0),a.interval=a._interval)},a.reset=function(){if(a._raf){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;b&&b(a._timerId)}else clearTimeout(a._timerId);a.removeAllEventListeners("tick"),a._timerId=a._times=a._tickTimes=null,a._startTime=a._lastTime=a._ticks=0,a._inited=!1},a.getMeasuredTickTime=function(b){var c=0,d=a._tickTimes;if(!d||d.length<1)return-1;b=Math.min(d.length,b||0|a.getFPS());for(var e=0;b>e;e++)c+=d[e];return c/b},a.getMeasuredFPS=function(b){var c=a._times;return!c||c.length<2?-1:(b=Math.min(c.length-1,b||0|a.getFPS()),1e3/((c[0]-c[b])/b))},a.setPaused=function(b){a.paused=b},a.getPaused=function(){return a.paused},a.getTime=function(b){return a._startTime?a._getTime()-(b?a._pausedTime:0):-1},a.getEventTime=function(b){return a._startTime?(a._lastTime||a._startTime)-(b?a._pausedTime:0):-1},a.getTicks=function(b){return a._ticks-(b?a._pausedTicks:0)},a._handleSynch=function(){a._timerId=null,a._setupTick(),a._getTime()-a._lastTime>=.97*(a._interval-1)&&a._tick()},a._handleRAF=function(){a._timerId=null,a._setupTick(),a._tick()},a._handleTimeout=function(){a._timerId=null,a._setupTick(),a._tick()},a._setupTick=function(){if(null==a._timerId){var b=a.timingMode||a.useRAF&&a.RAF_SYNCHED;if(b==a.RAF_SYNCHED||b==a.RAF){var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(c)return a._timerId=c(b==a.RAF?a._handleRAF:a._handleSynch),void(a._raf=!0)}a._raf=!1,a._timerId=setTimeout(a._handleTimeout,a._interval)}},a._tick=function(){var b=a.paused,c=a._getTime(),d=c-a._lastTime;if(a._lastTime=c,a._ticks++,b&&(a._pausedTicks++,a._pausedTime+=d),a.hasEventListener("tick")){var e=new createjs.Event("tick"),f=a.maxDelta;e.delta=f&&d>f?f:d,e.paused=b,e.time=c,e.runTime=c-a._pausedTime,a.dispatchEvent(e)}for(a._tickTimes.unshift(a._getTime()-c);a._tickTimes.length>100;)a._tickTimes.pop();for(a._times.unshift(c);a._times.length>100;)a._times.pop()};var c=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);a._getTime=function(){return(c&&c.call(performance)||(new Date).getTime())-a._startTime},createjs.Ticker=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"UID cannot be instantiated"}a._nextID=0,a.get=function(){return a._nextID++},createjs.UID=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){this.Event_constructor(a,b,c),this.stageX=d,this.stageY=e,this.rawX=null==i?d:i,this.rawY=null==j?e:j,this.nativeEvent=f,this.pointerID=g,this.primary=!!h,this.relatedTarget=k}var b=createjs.extend(a,createjs.Event);b._get_localX=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x},b._get_localY=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y},b._get_isTouch=function(){return-1!==this.pointerID};try{Object.defineProperties(b,{localX:{get:b._get_localX},localY:{get:b._get_localY},isTouch:{get:b._get_isTouch}})}catch(c){}b.clone=function(){return new a(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},b.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=createjs.promote(a,"Event")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e,f){this.setValues(a,b,c,d,e,f)}var b=a.prototype;a.DEG_TO_RAD=Math.PI/180,a.identity=null,b.setValues=function(a,b,c,d,e,f){return this.a=null==a?1:a,this.b=b||0,this.c=c||0,this.d=null==d?1:d,this.tx=e||0,this.ty=f||0,this},b.append=function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.c,j=this.d;return(1!=a||0!=b||0!=c||1!=d)&&(this.a=g*a+i*b,this.b=h*a+j*b,this.c=g*c+i*d,this.d=h*c+j*d),this.tx=g*e+i*f+this.tx,this.ty=h*e+j*f+this.ty,this},b.prepend=function(a,b,c,d,e,f){var g=this.a,h=this.c,i=this.tx;return this.a=a*g+c*this.b,this.b=b*g+d*this.b,this.c=a*h+c*this.d,this.d=b*h+d*this.d,this.tx=a*i+c*this.ty+e,this.ty=b*i+d*this.ty+f,this},b.appendMatrix=function(a){return this.append(a.a,a.b,a.c,a.d,a.tx,a.ty)},b.prependMatrix=function(a){return this.prepend(a.a,a.b,a.c,a.d,a.tx,a.ty)},b.appendTransform=function(b,c,d,e,f,g,h,i,j){if(f%360)var k=f*a.DEG_TO_RAD,l=Math.cos(k),m=Math.sin(k);else l=1,m=0;return g||h?(g*=a.DEG_TO_RAD,h*=a.DEG_TO_RAD,this.append(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),b,c),this.append(l*d,m*d,-m*e,l*e,0,0)):this.append(l*d,m*d,-m*e,l*e,b,c),(i||j)&&(this.tx-=i*this.a+j*this.c,this.ty-=i*this.b+j*this.d),this},b.prependTransform=function(b,c,d,e,f,g,h,i,j){if(f%360)var k=f*a.DEG_TO_RAD,l=Math.cos(k),m=Math.sin(k);else l=1,m=0;return(i||j)&&(this.tx-=i,this.ty-=j),g||h?(g*=a.DEG_TO_RAD,h*=a.DEG_TO_RAD,this.prepend(l*d,m*d,-m*e,l*e,0,0),this.prepend(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),b,c)):this.prepend(l*d,m*d,-m*e,l*e,b,c),this},b.rotate=function(b){b*=a.DEG_TO_RAD;var c=Math.cos(b),d=Math.sin(b),e=this.a,f=this.b;return this.a=e*c+this.c*d,this.b=f*c+this.d*d,this.c=-e*d+this.c*c,this.d=-f*d+this.d*c,this},b.skew=function(b,c){return b*=a.DEG_TO_RAD,c*=a.DEG_TO_RAD,this.append(Math.cos(c),Math.sin(c),-Math.sin(b),Math.cos(b),0,0),this},b.scale=function(a,b){return this.a*=a,this.b*=a,this.c*=b,this.d*=b,this},b.translate=function(a,b){return this.tx+=this.a*a+this.c*b,this.ty+=this.b*a+this.d*b,this},b.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},b.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},b.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},b.equals=function(a){return this.tx===a.tx&&this.ty===a.ty&&this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d},b.transformPoint=function(a,b,c){return c=c||{},c.x=a*this.a+b*this.c+this.tx,c.y=a*this.b+b*this.d+this.ty,c},b.decompose=function(b){null==b&&(b={}),b.x=this.tx,b.y=this.ty,b.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),b.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var c=Math.atan2(-this.c,this.d),d=Math.atan2(this.b,this.a),e=Math.abs(1-c/d);return 1e-5>e?(b.rotation=d/a.DEG_TO_RAD,this.a<0&&this.d>=0&&(b.rotation+=b.rotation<=0?180:-180),b.skewX=b.skewY=0):(b.skewX=c/a.DEG_TO_RAD,b.skewY=d/a.DEG_TO_RAD),b},b.copy=function(a){return this.setValues(a.a,a.b,a.c,a.d,a.tx,a.ty)},b.clone=function(){return new a(this.a,this.b,this.c,this.d,this.tx,this.ty)},b.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},a.identity=new a,createjs.Matrix2D=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e){this.setValues(a,b,c,d,e)}var b=a.prototype;b.setValues=function(a,b,c,d,e){return this.visible=null==a?!0:!!a,this.alpha=null==b?1:b,this.shadow=c,this.compositeOperation=d,this.matrix=e||this.matrix&&this.matrix.identity()||new createjs.Matrix2D,this},b.append=function(a,b,c,d,e){return this.alpha*=b,this.shadow=c||this.shadow,this.compositeOperation=d||this.compositeOperation,this.visible=this.visible&&a,e&&this.matrix.appendMatrix(e),this},b.prepend=function(a,b,c,d,e){return this.alpha*=b,this.shadow=this.shadow||c,this.compositeOperation=this.compositeOperation||d,this.visible=this.visible&&a,e&&this.matrix.prependMatrix(e),this},b.identity=function(){return this.visible=!0,this.alpha=1,this.shadow=this.compositeOperation=null,this.matrix.identity(),this},b.clone=function(){return new a(this.alpha,this.shadow,this.compositeOperation,this.visible,this.matrix.clone())},createjs.DisplayProps=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.setValues(a,b)}var b=a.prototype;b.setValues=function(a,b){return this.x=a||0,this.y=b||0,this},b.copy=function(a){return this.x=a.x,this.y=a.y,this},b.clone=function(){return new a(this.x,this.y)},b.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d){this.setValues(a,b,c,d)}var b=a.prototype;b.setValues=function(a,b,c,d){return this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0,this},b.extend=function(a,b,c,d){return c=c||0,d=d||0,a+c>this.x+this.width&&(this.width=a+c-this.x),b+d>this.y+this.height&&(this.height=b+d-this.y),a<this.x&&(this.width+=this.x-a,this.x=a),b<this.y&&(this.height+=this.y-b,this.y=b),this},b.pad=function(a,b,c,d){return this.x-=b,this.y-=a,this.width+=b+d,this.height+=a+c,this},b.copy=function(a){return this.setValues(a.x,a.y,a.width,a.height)},b.contains=function(a,b,c,d){return c=c||0,d=d||0,a>=this.x&&a+c<=this.x+this.width&&b>=this.y&&b+d<=this.y+this.height},b.union=function(a){return this.clone().extend(a.x,a.y,a.width,a.height)},b.intersection=function(b){var c=b.x,d=b.y,e=c+b.width,f=d+b.height;return this.x>c&&(c=this.x),this.y>d&&(d=this.y),this.x+this.width<e&&(e=this.x+this.width),this.y+this.height<f&&(f=this.y+this.height),c>=e||d>=f?null:new a(c,d,e-c,f-d)},b.intersects=function(a){return a.x<=this.x+this.width&&this.x<=a.x+a.width&&a.y<=this.y+this.height&&this.y<=a.y+a.height},b.isEmpty=function(){return this.width<=0||this.height<=0},b.clone=function(){return new a(this.x,this.y,this.width,this.height)},b.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e,f,g){a.addEventListener&&(this.target=a,this.overLabel=null==c?"over":c,this.outLabel=null==b?"out":b,this.downLabel=null==d?"down":d,this.play=e,this._isPressed=!1,this._isOver=!1,this._enabled=!1,a.mouseChildren=!1,this.enabled=!0,this.handleEvent({}),f&&(g&&(f.actionsEnabled=!1,f.gotoAndStop&&f.gotoAndStop(g)),a.hitArea=f))}var b=a.prototype;b.setEnabled=function(a){if(a!=this._enabled){var b=this.target;this._enabled=a,a?(b.cursor="pointer",b.addEventListener("rollover",this),b.addEventListener("rollout",this),b.addEventListener("mousedown",this),b.addEventListener("pressup",this),b._reset&&(b.__reset=b._reset,b._reset=this._reset)):(b.cursor=null,b.removeEventListener("rollover",this),b.removeEventListener("rollout",this),b.removeEventListener("mousedown",this),b.removeEventListener("pressup",this),b.__reset&&(b._reset=b.__reset,delete b.__reset))}},b.getEnabled=function(){return this._enabled};try{Object.defineProperties(b,{enabled:{get:b.getEnabled,set:b.setEnabled}})}catch(c){}b.toString=function(){return"[ButtonHelper]"},b.handleEvent=function(a){var b,c=this.target,d=a.type;"mousedown"==d?(this._isPressed=!0,b=this.downLabel):"pressup"==d?(this._isPressed=!1,b=this._isOver?this.overLabel:this.outLabel):"rollover"==d?(this._isOver=!0,b=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,b=this._isPressed?this.overLabel:this.outLabel),this.play?c.gotoAndPlay&&c.gotoAndPlay(b):c.gotoAndStop&&c.gotoAndStop(b)},b._reset=function(){var a=this.paused;this.__reset(),this.paused=a},createjs.ButtonHelper=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d){this.color=a||"black",this.offsetX=b||0,this.offsetY=c||0,this.blur=d||0}var b=a.prototype;a.identity=new a("transparent",0,0,0),b.toString=function(){return"[Shadow]"},b.clone=function(){return new a(this.color,this.offsetX,this.offsetY,this.blur)},createjs.Shadow=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.EventDispatcher_constructor(),this.complete=!0,this.framerate=0,this._animations=null,this._frames=null,this._images=null,this._data=null,this._loadCount=0,this._frameHeight=0,this._frameWidth=0,this._numFrames=0,this._regX=0,this._regY=0,this._spacing=0,this._margin=0,this._parseData(a)}var b=createjs.extend(a,createjs.EventDispatcher);b.getAnimations=function(){return this._animations.slice()};try{Object.defineProperties(b,{animations:{get:b.getAnimations}})}catch(c){}b.getNumFrames=function(a){if(null==a)return this._frames?this._frames.length:this._numFrames||0;var b=this._data[a];return null==b?0:b.frames.length},b.getAnimation=function(a){return this._data[a]},b.getFrame=function(a){var b;return this._frames&&(b=this._frames[a])?b:null},b.getFrameBounds=function(a,b){var c=this.getFrame(a);return c?(b||new createjs.Rectangle).setValues(-c.regX,-c.regY,c.rect.width,c.rect.height):null},b.toString=function(){return"[SpriteSheet]"},b.clone=function(){throw"SpriteSheet cannot be cloned."},b._parseData=function(a){var b,c,d,e;if(null!=a){if(this.framerate=a.framerate||0,a.images&&(c=a.images.length)>0)for(e=this._images=[],b=0;c>b;b++){var f=a.images[b];if("string"==typeof f){var g=f;f=document.createElement("img"),f.src=g}e.push(f),f.getContext||f.naturalWidth||(this._loadCount++,this.complete=!1,function(a,b){f.onload=function(){a._handleImageLoad(b)}}(this,g),function(a,b){f.onerror=function(){a._handleImageError(b)}}(this,g))}if(null==a.frames);else if(Array.isArray(a.frames))for(this._frames=[],e=a.frames,b=0,c=e.length;c>b;b++){var h=e[b];this._frames.push({image:this._images[h[4]?h[4]:0],rect:new createjs.Rectangle(h[0],h[1],h[2],h[3]),regX:h[5]||0,regY:h[6]||0})}else d=a.frames,this._frameWidth=d.width,this._frameHeight=d.height,this._regX=d.regX||0,this._regY=d.regY||0,this._spacing=d.spacing||0,this._margin=d.margin||0,this._numFrames=d.count,0==this._loadCount&&this._calculateFrames();if(this._animations=[],null!=(d=a.animations)){this._data={};var i;for(i in d){var j={name:i},k=d[i];if("number"==typeof k)e=j.frames=[k];else if(Array.isArray(k))if(1==k.length)j.frames=[k[0]];else for(j.speed=k[3],j.next=k[2],e=j.frames=[],b=k[0];b<=k[1];b++)e.push(b);else{j.speed=k.speed,j.next=k.next;var l=k.frames;e=j.frames="number"==typeof l?[l]:l.slice(0)}(j.next===!0||void 0===j.next)&&(j.next=i),(j.next===!1||e.length<2&&j.next==i)&&(j.next=null),j.speed||(j.speed=1),this._animations.push(i),this._data[i]=j}}}},b._handleImageLoad=function(a){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))},b._handleImageError=function(a){var b=new createjs.Event("error");b.src=a,this.dispatchEvent(b),0==--this._loadCount&&this.dispatchEvent("complete")},b._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];var a=this._numFrames||1e5,b=0,c=this._frameWidth,d=this._frameHeight,e=this._spacing,f=this._margin;a:for(var g=0,h=this._images;g<h.length;g++)for(var i=h[g],j=i.width,k=i.height,l=f;k-f-d>=l;){for(var m=f;j-f-c>=m;){if(b>=a)break a;b++,this._frames.push({image:i,rect:new createjs.Rectangle(m,l,c,d),regX:this._regX,regY:this._regY}),m+=c+e}l+=d+e}this._numFrames=b}},createjs.SpriteSheet=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.command=null,this._stroke=null,this._strokeStyle=null,this._oldStrokeStyle=null,this._strokeDash=null,this._oldStrokeDash=null,this._strokeIgnoreScale=!1,this._fill=null,this._instructions=[],this._commitIndex=0,this._activeInstructions=[],this._dirty=!1,this._storeIndex=0,this.clear()}var b=a.prototype,c=a;a.getRGB=function(a,b,c,d){return null!=a&&null==c&&(d=b,c=255&a,b=a>>8&255,a=a>>16&255),null==d?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+d+")"},a.getHSL=function(a,b,c,d){return null==d?"hsl("+a%360+","+b+"%,"+c+"%)":"hsla("+a%360+","+b+"%,"+c+"%,"+d+")"},a.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},a.STROKE_CAPS_MAP=["butt","round","square"],a.STROKE_JOINTS_MAP=["miter","round","bevel"];var d=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");d.getContext&&(a._ctx=d.getContext("2d"),d.width=d.height=1),b.getInstructions=function(){return this._updateInstructions(),this._instructions};try{Object.defineProperties(b,{instructions:{get:b.getInstructions}})}catch(e){}b.isEmpty=function(){return!(this._instructions.length||this._activeInstructions.length)},b.draw=function(a,b){this._updateInstructions();for(var c=this._instructions,d=this._storeIndex,e=c.length;e>d;d++)c[d].exec(a,b)},b.drawAsPath=function(a){this._updateInstructions();for(var b,c=this._instructions,d=this._storeIndex,e=c.length;e>d;d++)(b=c[d]).path!==!1&&b.exec(a)},b.moveTo=function(a,b){return this.append(new c.MoveTo(a,b),!0)},b.lineTo=function(a,b){return this.append(new c.LineTo(a,b))},b.arcTo=function(a,b,d,e,f){return this.append(new c.ArcTo(a,b,d,e,f))},b.arc=function(a,b,d,e,f,g){return this.append(new c.Arc(a,b,d,e,f,g))},b.quadraticCurveTo=function(a,b,d,e){return this.append(new c.QuadraticCurveTo(a,b,d,e))},b.bezierCurveTo=function(a,b,d,e,f,g){return this.append(new c.BezierCurveTo(a,b,d,e,f,g))},b.rect=function(a,b,d,e){return this.append(new c.Rect(a,b,d,e))},b.closePath=function(){return this._activeInstructions.length?this.append(new c.ClosePath):this},b.clear=function(){return this._instructions.length=this._activeInstructions.length=this._commitIndex=0,this._strokeStyle=this._oldStrokeStyle=this._stroke=this._fill=this._strokeDash=this._oldStrokeDash=null,this._dirty=this._strokeIgnoreScale=!1,this},b.beginFill=function(a){return this._setFill(a?new c.Fill(a):null)},b.beginLinearGradientFill=function(a,b,d,e,f,g){return this._setFill((new c.Fill).linearGradient(a,b,d,e,f,g))},b.beginRadialGradientFill=function(a,b,d,e,f,g,h,i){return this._setFill((new c.Fill).radialGradient(a,b,d,e,f,g,h,i))},b.beginBitmapFill=function(a,b,d){return this._setFill(new c.Fill(null,d).bitmap(a,b))},b.endFill=function(){return this.beginFill()},b.setStrokeStyle=function(a,b,d,e,f){return this._updateInstructions(!0),this._strokeStyle=this.command=new c.StrokeStyle(a,b,d,e,f),this._stroke&&(this._stroke.ignoreScale=f),this._strokeIgnoreScale=f,this},b.setStrokeDash=function(a,b){return this._updateInstructions(!0),this._strokeDash=this.command=new c.StrokeDash(a,b),this},b.beginStroke=function(a){return this._setStroke(a?new c.Stroke(a):null)},b.beginLinearGradientStroke=function(a,b,d,e,f,g){return this._setStroke((new c.Stroke).linearGradient(a,b,d,e,f,g))},b.beginRadialGradientStroke=function(a,b,d,e,f,g,h,i){return this._setStroke((new c.Stroke).radialGradient(a,b,d,e,f,g,h,i))},b.beginBitmapStroke=function(a,b){return this._setStroke((new c.Stroke).bitmap(a,b))},b.endStroke=function(){return this.beginStroke()},b.curveTo=b.quadraticCurveTo,b.drawRect=b.rect,b.drawRoundRect=function(a,b,c,d,e){return this.drawRoundRectComplex(a,b,c,d,e,e,e,e)},b.drawRoundRectComplex=function(a,b,d,e,f,g,h,i){return this.append(new c.RoundRect(a,b,d,e,f,g,h,i))},b.drawCircle=function(a,b,d){return this.append(new c.Circle(a,b,d))},b.drawEllipse=function(a,b,d,e){return this.append(new c.Ellipse(a,b,d,e))},b.drawPolyStar=function(a,b,d,e,f,g){return this.append(new c.PolyStar(a,b,d,e,f,g))},b.append=function(a,b){return this._activeInstructions.push(a),this.command=a,b||(this._dirty=!0),this},b.decodePath=function(b){for(var c=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],d=[2,2,4,6,0],e=0,f=b.length,g=[],h=0,i=0,j=a.BASE_64;f>e;){var k=b.charAt(e),l=j[k],m=l>>3,n=c[m];if(!n||3&l)throw"bad path data (@"+e+"): "+k;var o=d[m];m||(h=i=0),g.length=0,e++;for(var p=(l>>2&1)+2,q=0;o>q;q++){var r=j[b.charAt(e)],s=r>>5?-1:1;r=(31&r)<<6|j[b.charAt(e+1)],3==p&&(r=r<<6|j[b.charAt(e+2)]),r=s*r/10,q%2?h=r+=h:i=r+=i,g[q]=r,e+=p}n.apply(this,g)}return this},b.store=function(){return this._updateInstructions(!0),this._storeIndex=this._instructions.length,this},b.unstore=function(){return this._storeIndex=0,this},b.clone=function(){var b=new a;return b.command=this.command,b._stroke=this._stroke,b._strokeStyle=this._strokeStyle,b._strokeDash=this._strokeDash,b._strokeIgnoreScale=this._strokeIgnoreScale,b._fill=this._fill,b._instructions=this._instructions.slice(),b._commitIndex=this._commitIndex,b._activeInstructions=this._activeInstructions.slice(),b._dirty=this._dirty,b._storeIndex=this._storeIndex,b},b.toString=function(){return"[Graphics]"},b.mt=b.moveTo,b.lt=b.lineTo,b.at=b.arcTo,b.bt=b.bezierCurveTo,b.qt=b.quadraticCurveTo,b.a=b.arc,b.r=b.rect,b.cp=b.closePath,b.c=b.clear,b.f=b.beginFill,b.lf=b.beginLinearGradientFill,b.rf=b.beginRadialGradientFill,b.bf=b.beginBitmapFill,b.ef=b.endFill,b.ss=b.setStrokeStyle,b.sd=b.setStrokeDash,b.s=b.beginStroke,b.ls=b.beginLinearGradientStroke,b.rs=b.beginRadialGradientStroke,b.bs=b.beginBitmapStroke,b.es=b.endStroke,b.dr=b.drawRect,b.rr=b.drawRoundRect,b.rc=b.drawRoundRectComplex,b.dc=b.drawCircle,b.de=b.drawEllipse,b.dp=b.drawPolyStar,b.p=b.decodePath,b._updateInstructions=function(b){var c=this._instructions,d=this._activeInstructions,e=this._commitIndex;if(this._dirty&&d.length){c.length=e,c.push(a.beginCmd);var f=d.length,g=c.length;c.length=g+f;for(var h=0;f>h;h++)c[h+g]=d[h];this._fill&&c.push(this._fill),this._stroke&&(this._strokeDash!==this._oldStrokeDash&&(this._oldStrokeDash=this._strokeDash,c.push(this._strokeDash)),this._strokeStyle!==this._oldStrokeStyle&&(this._oldStrokeStyle=this._strokeStyle,c.push(this._strokeStyle)),c.push(this._stroke)),this._dirty=!1}b&&(d.length=0,this._commitIndex=c.length)},b._setFill=function(a){return this._updateInstructions(!0),this.command=this._fill=a,this},b._setStroke=function(a){return this._updateInstructions(!0),(this.command=this._stroke=a)&&(a.ignoreScale=this._strokeIgnoreScale),this},(c.LineTo=function(a,b){this.x=a,this.y=b}).prototype.exec=function(a){a.lineTo(this.x,this.y)},(c.MoveTo=function(a,b){this.x=a,this.y=b}).prototype.exec=function(a){a.moveTo(this.x,this.y)},(c.ArcTo=function(a,b,c,d,e){this.x1=a,this.y1=b,this.x2=c,this.y2=d,this.radius=e}).prototype.exec=function(a){a.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)},(c.Arc=function(a,b,c,d,e,f){this.x=a,this.y=b,this.radius=c,this.startAngle=d,this.endAngle=e,this.anticlockwise=!!f}).prototype.exec=function(a){a.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},(c.QuadraticCurveTo=function(a,b,c,d){this.cpx=a,this.cpy=b,this.x=c,this.y=d}).prototype.exec=function(a){a.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)},(c.BezierCurveTo=function(a,b,c,d,e,f){this.cp1x=a,this.cp1y=b,this.cp2x=c,this.cp2y=d,this.x=e,this.y=f}).prototype.exec=function(a){a.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)},(c.Rect=function(a,b,c,d){this.x=a,this.y=b,this.w=c,this.h=d}).prototype.exec=function(a){a.rect(this.x,this.y,this.w,this.h)},(c.ClosePath=function(){}).prototype.exec=function(a){a.closePath()},(c.BeginPath=function(){}).prototype.exec=function(a){a.beginPath()},b=(c.Fill=function(a,b){this.style=a,this.matrix=b}).prototype,b.exec=function(a){if(this.style){a.fillStyle=this.style;var b=this.matrix;b&&(a.save(),a.transform(b.a,b.b,b.c,b.d,b.tx,b.ty)),a.fill(),b&&a.restore()}},b.linearGradient=function(b,c,d,e,f,g){for(var h=this.style=a._ctx.createLinearGradient(d,e,f,g),i=0,j=b.length;j>i;i++)h.addColorStop(c[i],b[i]);return h.props={colors:b,ratios:c,x0:d,y0:e,x1:f,y1:g,type:"linear"},this},b.radialGradient=function(b,c,d,e,f,g,h,i){for(var j=this.style=a._ctx.createRadialGradient(d,e,f,g,h,i),k=0,l=b.length;l>k;k++)j.addColorStop(c[k],b[k]);return j.props={colors:b,ratios:c,x0:d,y0:e,r0:f,x1:g,y1:h,r1:i,type:"radial"},this},b.bitmap=function(b,c){if(b.naturalWidth||b.getContext||b.readyState>=2){var d=this.style=a._ctx.createPattern(b,c||"");d.props={image:b,repetition:c,type:"bitmap"}}return this},b.path=!1,b=(c.Stroke=function(a,b){this.style=a,this.ignoreScale=b}).prototype,b.exec=function(a){this.style&&(a.strokeStyle=this.style,this.ignoreScale&&(a.save(),a.setTransform(1,0,0,1,0,0)),a.stroke(),this.ignoreScale&&a.restore())},b.linearGradient=c.Fill.prototype.linearGradient,b.radialGradient=c.Fill.prototype.radialGradient,b.bitmap=c.Fill.prototype.bitmap,b.path=!1,b=(c.StrokeStyle=function(a,b,c,d,e){this.width=a,this.caps=b,this.joints=c,this.miterLimit=d,this.ignoreScale=e}).prototype,b.exec=function(b){b.lineWidth=null==this.width?"1":this.width,b.lineCap=null==this.caps?"butt":isNaN(this.caps)?this.caps:a.STROKE_CAPS_MAP[this.caps],b.lineJoin=null==this.joints?"miter":isNaN(this.joints)?this.joints:a.STROKE_JOINTS_MAP[this.joints],b.miterLimit=null==this.miterLimit?"10":this.miterLimit,b.ignoreScale=null==this.ignoreScale?!1:this.ignoreScale},b.path=!1,(c.StrokeDash=function(a,b){this.segments=a,this.offset=b||0}).prototype.exec=function(a){a.setLineDash&&(a.setLineDash(this.segments||c.StrokeDash.EMPTY_SEGMENTS),a.lineDashOffset=this.offset||0)},c.StrokeDash.EMPTY_SEGMENTS=[],(c.RoundRect=function(a,b,c,d,e,f,g,h){this.x=a,this.y=b,this.w=c,this.h=d,this.radiusTL=e,this.radiusTR=f,this.radiusBR=g,this.radiusBL=h}).prototype.exec=function(a){var b=(j>i?i:j)/2,c=0,d=0,e=0,f=0,g=this.x,h=this.y,i=this.w,j=this.h,k=this.radiusTL,l=this.radiusTR,m=this.radiusBR,n=this.radiusBL;0>k&&(k*=c=-1),k>b&&(k=b),0>l&&(l*=d=-1),l>b&&(l=b),0>m&&(m*=e=-1),m>b&&(m=b),0>n&&(n*=f=-1),n>b&&(n=b),a.moveTo(g+i-l,h),a.arcTo(g+i+l*d,h-l*d,g+i,h+l,l),a.lineTo(g+i,h+j-m),a.arcTo(g+i+m*e,h+j+m*e,g+i-m,h+j,m),a.lineTo(g+n,h+j),a.arcTo(g-n*f,h+j+n*f,g,h+j-n,n),a.lineTo(g,h+k),a.arcTo(g-k*c,h-k*c,g+k,h,k),a.closePath()},(c.Circle=function(a,b,c){this.x=a,this.y=b,this.radius=c}).prototype.exec=function(a){a.arc(this.x,this.y,this.radius,0,2*Math.PI)},(c.Ellipse=function(a,b,c,d){this.x=a,this.y=b,this.w=c,this.h=d}).prototype.exec=function(a){var b=this.x,c=this.y,d=this.w,e=this.h,f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l)},(c.PolyStar=function(a,b,c,d,e,f){this.x=a,this.y=b,this.radius=c,this.sides=d,this.pointSize=e,this.angle=f}).prototype.exec=function(a){var b=this.x,c=this.y,d=this.radius,e=(this.angle||0)/180*Math.PI,f=this.sides,g=1-(this.pointSize||0),h=Math.PI/f;a.moveTo(b+Math.cos(e)*d,c+Math.sin(e)*d);for(var i=0;f>i;i++)e+=h,1!=g&&a.lineTo(b+Math.cos(e)*d*g,c+Math.sin(e)*d*g),e+=h,a.lineTo(b+Math.cos(e)*d,c+Math.sin(e)*d);a.closePath()},a.beginCmd=new c.BeginPath,createjs.Graphics=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.EventDispatcher_constructor(),this.alpha=1,this.cacheCanvas=null,this.cacheID=0,this.id=createjs.UID.get(),this.mouseEnabled=!0,this.tickEnabled=!0,this.name=null,this.parent=null,this.regX=0,this.regY=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.shadow=null,this.visible=!0,this.x=0,this.y=0,this.transformMatrix=null,this.compositeOperation=null,this.snapToPixel=!0,this.filters=null,
this.mask=null,this.hitArea=null,this.cursor=null,this._cacheOffsetX=0,this._cacheOffsetY=0,this._filterOffsetX=0,this._filterOffsetY=0,this._cacheScale=1,this._cacheDataURLID=0,this._cacheDataURL=null,this._props=new createjs.DisplayProps,this._rectangle=new createjs.Rectangle,this._bounds=null}var b=createjs.extend(a,createjs.EventDispatcher);a._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],a.suppressCrossDomainErrors=!1,a._snapToPixelEnabled=!1;var c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");c.getContext&&(a._hitTestCanvas=c,a._hitTestContext=c.getContext("2d"),c.width=c.height=1),a._nextCacheID=1,b.getStage=function(){for(var a=this,b=createjs.Stage;a.parent;)a=a.parent;return a instanceof b?a:null};try{Object.defineProperties(b,{stage:{get:b.getStage}})}catch(d){}b.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},b.draw=function(a,b){var c=this.cacheCanvas;if(b||!c)return!1;var d=this._cacheScale;return a.drawImage(c,this._cacheOffsetX+this._filterOffsetX,this._cacheOffsetY+this._filterOffsetY,c.width/d,c.height/d),!0},b.updateContext=function(b){var c=this,d=c.mask,e=c._props.matrix;d&&d.graphics&&!d.graphics.isEmpty()&&(d.getMatrix(e),b.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),d.graphics.drawAsPath(b),b.clip(),e.invert(),b.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),this.getMatrix(e);var f=e.tx,g=e.ty;a._snapToPixelEnabled&&c.snapToPixel&&(f=f+(0>f?-.5:.5)|0,g=g+(0>g?-.5:.5)|0),b.transform(e.a,e.b,e.c,e.d,f,g),b.globalAlpha*=c.alpha,c.compositeOperation&&(b.globalCompositeOperation=c.compositeOperation),c.shadow&&this._applyShadow(b,c.shadow)},b.cache=function(a,b,c,d,e){e=e||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this._cacheWidth=c,this._cacheHeight=d,this._cacheOffsetX=a,this._cacheOffsetY=b,this._cacheScale=e,this.updateCache()},b.updateCache=function(b){var c=this.cacheCanvas;if(!c)throw"cache() must be called before updateCache()";var d=this._cacheScale,e=this._cacheOffsetX*d,f=this._cacheOffsetY*d,g=this._cacheWidth,h=this._cacheHeight,i=c.getContext("2d"),j=this._getFilterBounds();e+=this._filterOffsetX=j.x,f+=this._filterOffsetY=j.y,g=Math.ceil(g*d)+j.width,h=Math.ceil(h*d)+j.height,g!=c.width||h!=c.height?(c.width=g,c.height=h):b||i.clearRect(0,0,g+1,h+1),i.save(),i.globalCompositeOperation=b,i.setTransform(d,0,0,d,-e,-f),this.draw(i,!0),this._applyFilters(),i.restore(),this.cacheID=a._nextCacheID++},b.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=this._filterOffsetX=this._filterOffsetY=0,this._cacheScale=1},b.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},b.localToGlobal=function(a,b,c){return this.getConcatenatedMatrix(this._props.matrix).transformPoint(a,b,c||new createjs.Point)},b.globalToLocal=function(a,b,c){return this.getConcatenatedMatrix(this._props.matrix).invert().transformPoint(a,b,c||new createjs.Point)},b.localToLocal=function(a,b,c,d){return d=this.localToGlobal(a,b,d),c.globalToLocal(d.x,d.y,d)},b.setTransform=function(a,b,c,d,e,f,g,h,i){return this.x=a||0,this.y=b||0,this.scaleX=null==c?1:c,this.scaleY=null==d?1:d,this.rotation=e||0,this.skewX=f||0,this.skewY=g||0,this.regX=h||0,this.regY=i||0,this},b.getMatrix=function(a){var b=this,c=a&&a.identity()||new createjs.Matrix2D;return b.transformMatrix?c.copy(b.transformMatrix):c.appendTransform(b.x,b.y,b.scaleX,b.scaleY,b.rotation,b.skewX,b.skewY,b.regX,b.regY)},b.getConcatenatedMatrix=function(a){for(var b=this,c=this.getMatrix(a);b=b.parent;)c.prependMatrix(b.getMatrix(b._props.matrix));return c},b.getConcatenatedDisplayProps=function(a){a=a?a.identity():new createjs.DisplayProps;var b=this,c=b.getMatrix(a.matrix);do a.prepend(b.visible,b.alpha,b.shadow,b.compositeOperation),b!=this&&c.prependMatrix(b.getMatrix(b._props.matrix));while(b=b.parent);return a},b.hitTest=function(b,c){var d=a._hitTestContext;d.setTransform(1,0,0,1,-b,-c),this.draw(d);var e=this._testHit(d);return d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,2,2),e},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.getBounds=function(){if(this._bounds)return this._rectangle.copy(this._bounds);var a=this.cacheCanvas;if(a){var b=this._cacheScale;return this._rectangle.setValues(this._cacheOffsetX,this._cacheOffsetY,a.width/b,a.height/b)}return null},b.getTransformedBounds=function(){return this._getBounds()},b.setBounds=function(a,b,c,d){null==a&&(this._bounds=a),this._bounds=(this._bounds||new createjs.Rectangle).setValues(a,b,c,d)},b.clone=function(){return this._cloneProps(new a)},b.toString=function(){return"[DisplayObject (name="+this.name+")]"},b._cloneProps=function(a){return a.alpha=this.alpha,a.mouseEnabled=this.mouseEnabled,a.tickEnabled=this.tickEnabled,a.name=this.name,a.regX=this.regX,a.regY=this.regY,a.rotation=this.rotation,a.scaleX=this.scaleX,a.scaleY=this.scaleY,a.shadow=this.shadow,a.skewX=this.skewX,a.skewY=this.skewY,a.visible=this.visible,a.x=this.x,a.y=this.y,a.compositeOperation=this.compositeOperation,a.snapToPixel=this.snapToPixel,a.filters=null==this.filters?null:this.filters.slice(0),a.mask=this.mask,a.hitArea=this.hitArea,a.cursor=this.cursor,a._bounds=this._bounds,a},b._applyShadow=function(a,b){b=b||Shadow.identity,a.shadowColor=b.color,a.shadowOffsetX=b.offsetX,a.shadowOffsetY=b.offsetY,a.shadowBlur=b.blur},b._tick=function(a){var b=this._listeners;b&&b.tick&&(a.target=null,a.propagationStopped=a.immediatePropagationStopped=!1,this.dispatchEvent(a))},b._testHit=function(b){try{var c=b.getImageData(0,0,1,1).data[3]>1}catch(d){if(!a.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return c},b._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var a=this.filters.length,b=this.cacheCanvas.getContext("2d"),c=this.cacheCanvas.width,d=this.cacheCanvas.height,e=0;a>e;e++)this.filters[e].applyFilter(b,0,0,c,d)},b._getFilterBounds=function(a){var b,c=this.filters,d=this._rectangle.setValues(0,0,0,0);if(!c||!(b=c.length))return d;for(var e=0;b>e;e++){var f=this.filters[e];f.getBounds&&f.getBounds(d)}return d},b._getBounds=function(a,b){return this._transformBounds(this.getBounds(),a,b)},b._transformBounds=function(a,b,c){if(!a)return a;var d=a.x,e=a.y,f=a.width,g=a.height,h=this._props.matrix;h=c?h.identity():this.getMatrix(h),(d||e)&&h.appendTransform(0,0,1,1,0,0,0,-d,-e),b&&h.prependMatrix(b);var i=f*h.a,j=f*h.b,k=g*h.c,l=g*h.d,m=h.tx,n=h.ty,o=m,p=m,q=n,r=n;return(d=i+m)<o?o=d:d>p&&(p=d),(d=i+k+m)<o?o=d:d>p&&(p=d),(d=k+m)<o?o=d:d>p&&(p=d),(e=j+n)<q?q=e:e>r&&(r=e),(e=j+l+n)<q?q=e:e>r&&(r=e),(e=l+n)<q?q=e:e>r&&(r=e),a.setValues(o,q,p-o,r-q)},b._hasMouseEventListener=function(){for(var b=a._MOUSE_EVENTS,c=0,d=b.length;d>c;c++)if(this.hasEventListener(b[c]))return!0;return!!this.cursor},createjs.DisplayObject=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.DisplayObject_constructor(),this.children=[],this.mouseChildren=!0,this.tickChildren=!0}var b=createjs.extend(a,createjs.DisplayObject);b.getNumChildren=function(){return this.children.length};try{Object.defineProperties(b,{numChildren:{get:b.getNumChildren}})}catch(c){}b.initialize=a,b.isVisible=function(){var a=this.cacheCanvas||this.children.length;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;for(var c=this.children.slice(),d=0,e=c.length;e>d;d++){var f=c[d];f.isVisible()&&(a.save(),f.updateContext(a),f.draw(a),a.restore())}return!0},b.addChild=function(a){if(null==a)return a;var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addChild(arguments[c]);return arguments[b-1]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.push(a),a.dispatchEvent("added"),a},b.addChildAt=function(a,b){var c=arguments.length,d=arguments[c-1];if(0>d||d>this.children.length)return arguments[c-2];if(c>2){for(var e=0;c-1>e;e++)this.addChildAt(arguments[e],d+e);return arguments[c-2]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),a.dispatchEvent("added"),a},b.removeChild=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeChild(arguments[d]);return c}return this.removeChildAt(createjs.indexOf(this.children,a))},b.removeChildAt=function(a){var b=arguments.length;if(b>1){for(var c=[],d=0;b>d;d++)c[d]=arguments[d];c.sort(function(a,b){return b-a});for(var e=!0,d=0;b>d;d++)e=e&&this.removeChildAt(c[d]);return e}if(0>a||a>this.children.length-1)return!1;var f=this.children[a];return f&&(f.parent=null),this.children.splice(a,1),f.dispatchEvent("removed"),!0},b.removeAllChildren=function(){for(var a=this.children;a.length;)this.removeChildAt(0)},b.getChildAt=function(a){return this.children[a]},b.getChildByName=function(a){for(var b=this.children,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},b.sortChildren=function(a){this.children.sort(a)},b.getChildIndex=function(a){return createjs.indexOf(this.children,a)},b.swapChildrenAt=function(a,b){var c=this.children,d=c[a],e=c[b];d&&e&&(c[a]=e,c[b]=d)},b.swapChildren=function(a,b){for(var c,d,e=this.children,f=0,g=e.length;g>f&&(e[f]==a&&(c=f),e[f]==b&&(d=f),null==c||null==d);f++);f!=g&&(e[c]=b,e[d]=a)},b.setChildIndex=function(a,b){var c=this.children,d=c.length;if(!(a.parent!=this||0>b||b>=d)){for(var e=0;d>e&&c[e]!=a;e++);e!=d&&e!=b&&(c.splice(e,1),c.splice(b,0,a))}},b.contains=function(a){for(;a;){if(a==this)return!0;a=a.parent}return!1},b.hitTest=function(a,b){return null!=this.getObjectUnderPoint(a,b)},b.getObjectsUnderPoint=function(a,b,c){var d=[],e=this.localToGlobal(a,b);return this._getObjectsUnderPoint(e.x,e.y,d,c>0,1==c),d},b.getObjectUnderPoint=function(a,b,c){var d=this.localToGlobal(a,b);return this._getObjectsUnderPoint(d.x,d.y,null,c>0,1==c)},b.getBounds=function(){return this._getBounds(null,!0)},b.getTransformedBounds=function(){return this._getBounds()},b.clone=function(b){var c=this._cloneProps(new a);return b&&this._cloneChildren(c),c},b.toString=function(){return"[Container (name="+this.name+")]"},b._tick=function(a){if(this.tickChildren)for(var b=this.children.length-1;b>=0;b--){var c=this.children[b];c.tickEnabled&&c._tick&&c._tick(a)}this.DisplayObject__tick(a)},b._cloneChildren=function(a){a.children.length&&a.removeAllChildren();for(var b=a.children,c=0,d=this.children.length;d>c;c++){var e=this.children[c].clone(!0);e.parent=a,b.push(e)}},b._getObjectsUnderPoint=function(b,c,d,e,f,g){if(g=g||0,!g&&!this._testMask(this,b,c))return null;var h,i=createjs.DisplayObject._hitTestContext;f=f||e&&this._hasMouseEventListener();for(var j=this.children,k=j.length,l=k-1;l>=0;l--){var m=j[l],n=m.hitArea;if(m.visible&&(n||m.isVisible())&&(!e||m.mouseEnabled)&&(n||this._testMask(m,b,c)))if(!n&&m instanceof a){var o=m._getObjectsUnderPoint(b,c,d,e,f,g+1);if(!d&&o)return e&&!this.mouseChildren?this:o}else{if(e&&!f&&!m._hasMouseEventListener())continue;var p=m.getConcatenatedDisplayProps(m._props);if(h=p.matrix,n&&(h.appendMatrix(n.getMatrix(n._props.matrix)),p.alpha=n.alpha),i.globalAlpha=p.alpha,i.setTransform(h.a,h.b,h.c,h.d,h.tx-b,h.ty-c),(n||m).draw(i),!this._testHit(i))continue;if(i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,2,2),!d)return e&&!this.mouseChildren?this:m;d.push(m)}}return null},b._testMask=function(a,b,c){var d=a.mask;if(!d||!d.graphics||d.graphics.isEmpty())return!0;var e=this._props.matrix,f=a.parent;e=f?f.getConcatenatedMatrix(e):e.identity(),e=d.getMatrix(d._props.matrix).prependMatrix(e);var g=createjs.DisplayObject._hitTestContext;return g.setTransform(e.a,e.b,e.c,e.d,e.tx-b,e.ty-c),d.graphics.drawAsPath(g),g.fillStyle="#000",g.fill(),this._testHit(g)?(g.setTransform(1,0,0,1,0,0),g.clearRect(0,0,2,2),!0):!1},b._getBounds=function(a,b){var c=this.DisplayObject_getBounds();if(c)return this._transformBounds(c,a,b);var d=this._props.matrix;d=b?d.identity():this.getMatrix(d),a&&d.prependMatrix(a);for(var e=this.children.length,f=null,g=0;e>g;g++){var h=this.children[g];h.visible&&(c=h._getBounds(d))&&(f?f.extend(c.x,c.y,c.width,c.height):f=c.clone())}return f},createjs.Container=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.Container_constructor(),this.autoClear=!0,this.canvas="string"==typeof a?document.getElementById(a):a,this.mouseX=0,this.mouseY=0,this.drawRect=null,this.snapToPixelEnabled=!1,this.mouseInBounds=!1,this.tickOnUpdate=!0,this.mouseMoveOutside=!1,this.preventSelection=!0,this._pointerData={},this._pointerCount=0,this._primaryPointerID=null,this._mouseOverIntervalID=null,this._nextStage=null,this._prevStage=null,this.enableDOMEvents(!0)}var b=createjs.extend(a,createjs.Container);b._get_nextStage=function(){return this._nextStage},b._set_nextStage=function(a){this._nextStage&&(this._nextStage._prevStage=null),a&&(a._prevStage=this),this._nextStage=a};try{Object.defineProperties(b,{nextStage:{get:b._get_nextStage,set:b._set_nextStage}})}catch(c){}b.update=function(a){if(this.canvas&&(this.tickOnUpdate&&this.tick(a),this.dispatchEvent("drawstart",!1,!0)!==!1)){createjs.DisplayObject._snapToPixelEnabled=this.snapToPixelEnabled;var b=this.drawRect,c=this.canvas.getContext("2d");c.setTransform(1,0,0,1,0,0),this.autoClear&&(b?c.clearRect(b.x,b.y,b.width,b.height):c.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)),c.save(),this.drawRect&&(c.beginPath(),c.rect(b.x,b.y,b.width,b.height),c.clip()),this.updateContext(c),this.draw(c,!1),c.restore(),this.dispatchEvent("drawend")}},b.tick=function(a){if(this.tickEnabled&&this.dispatchEvent("tickstart",!1,!0)!==!1){var b=new createjs.Event("tick");if(a)for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);this._tick(b),this.dispatchEvent("tickend")}},b.handleEvent=function(a){"tick"==a.type&&this.update(a)},b.clear=function(){if(this.canvas){var a=this.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},b.toDataURL=function(a,b){var c,d=this.canvas.getContext("2d"),e=this.canvas.width,f=this.canvas.height;if(a){c=d.getImageData(0,0,e,f);var g=d.globalCompositeOperation;d.globalCompositeOperation="destination-over",d.fillStyle=a,d.fillRect(0,0,e,f)}var h=this.canvas.toDataURL(b||"image/png");return a&&(d.putImageData(c,0,0),d.globalCompositeOperation=g),h},b.enableMouseOver=function(a){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==a&&this._testMouseOver(!0)),null==a)a=20;else if(0>=a)return;var b=this;this._mouseOverIntervalID=setInterval(function(){b._testMouseOver()},1e3/Math.min(50,a))},b.enableDOMEvents=function(a){null==a&&(a=!0);var b,c,d=this._eventListeners;if(!a&&d){for(b in d)c=d[b],c.t.removeEventListener(b,c.f,!1);this._eventListeners=null}else if(a&&!d&&this.canvas){var e=window.addEventListener?window:document,f=this;d=this._eventListeners={},d.mouseup={t:e,f:function(a){f._handleMouseUp(a)}},d.mousemove={t:e,f:function(a){f._handleMouseMove(a)}},d.dblclick={t:this.canvas,f:function(a){f._handleDoubleClick(a)}},d.mousedown={t:this.canvas,f:function(a){f._handleMouseDown(a)}};for(b in d)c=d[b],c.t.addEventListener(b,c.f,!1)}},b.clone=function(){throw"Stage cannot be cloned."},b.toString=function(){return"[Stage (name="+this.name+")]"},b._getElementRect=function(a){var b;try{b=a.getBoundingClientRect()}catch(c){b={top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}}var d=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),e=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),f=window.getComputedStyle?getComputedStyle(a,null):a.currentStyle,g=parseInt(f.paddingLeft)+parseInt(f.borderLeftWidth),h=parseInt(f.paddingTop)+parseInt(f.borderTopWidth),i=parseInt(f.paddingRight)+parseInt(f.borderRightWidth),j=parseInt(f.paddingBottom)+parseInt(f.borderBottomWidth);return{left:b.left+d+g,right:b.right+d-i,top:b.top+e+h,bottom:b.bottom+e-j}},b._getPointerData=function(a){var b=this._pointerData[a];return b||(b=this._pointerData[a]={x:0,y:0}),b},b._handleMouseMove=function(a){a||(a=window.event),this._handlePointerMove(-1,a,a.pageX,a.pageY)},b._handlePointerMove=function(a,b,c,d,e){if((!this._prevStage||void 0!==e)&&this.canvas){var f=this._nextStage,g=this._getPointerData(a),h=g.inBounds;this._updatePointerPosition(a,b,c,d),(h||g.inBounds||this.mouseMoveOutside)&&(-1===a&&g.inBounds==!h&&this._dispatchMouseEvent(this,h?"mouseleave":"mouseenter",!1,a,g,b),this._dispatchMouseEvent(this,"stagemousemove",!1,a,g,b),this._dispatchMouseEvent(g.target,"pressmove",!0,a,g,b)),f&&f._handlePointerMove(a,b,c,d,null)}},b._updatePointerPosition=function(a,b,c,d){var e=this._getElementRect(this.canvas);c-=e.left,d-=e.top;var f=this.canvas.width,g=this.canvas.height;c/=(e.right-e.left)/f,d/=(e.bottom-e.top)/g;var h=this._getPointerData(a);(h.inBounds=c>=0&&d>=0&&f-1>=c&&g-1>=d)?(h.x=c,h.y=d):this.mouseMoveOutside&&(h.x=0>c?0:c>f-1?f-1:c,h.y=0>d?0:d>g-1?g-1:d),h.posEvtObj=b,h.rawX=c,h.rawY=d,(a===this._primaryPointerID||-1===a)&&(this.mouseX=h.x,this.mouseY=h.y,this.mouseInBounds=h.inBounds)},b._handleMouseUp=function(a){this._handlePointerUp(-1,a,!1)},b._handlePointerUp=function(a,b,c,d){var e=this._nextStage,f=this._getPointerData(a);if(!this._prevStage||void 0!==d){var g=null,h=f.target;d||!h&&!e||(g=this._getObjectsUnderPoint(f.x,f.y,null,!0)),f.down&&(this._dispatchMouseEvent(this,"stagemouseup",!1,a,f,b,g),f.down=!1),g==h&&this._dispatchMouseEvent(h,"click",!0,a,f,b),this._dispatchMouseEvent(h,"pressup",!0,a,f,b),c?(a==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[a]):f.target=null,e&&e._handlePointerUp(a,b,c,d||g&&this)}},b._handleMouseDown=function(a){this._handlePointerDown(-1,a,a.pageX,a.pageY)},b._handlePointerDown=function(a,b,c,d,e){this.preventSelection&&b.preventDefault(),(null==this._primaryPointerID||-1===a)&&(this._primaryPointerID=a),null!=d&&this._updatePointerPosition(a,b,c,d);var f=null,g=this._nextStage,h=this._getPointerData(a);e||(f=h.target=this._getObjectsUnderPoint(h.x,h.y,null,!0)),h.inBounds&&(this._dispatchMouseEvent(this,"stagemousedown",!1,a,h,b,f),h.down=!0),this._dispatchMouseEvent(f,"mousedown",!0,a,h,b),g&&g._handlePointerDown(a,b,c,d,e||f&&this)},b._testMouseOver=function(a,b,c){if(!this._prevStage||void 0!==b){var d=this._nextStage;if(!this._mouseOverIntervalID)return void(d&&d._testMouseOver(a,b,c));var e=this._getPointerData(-1);if(e&&(a||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var f,g,h,i=e.posEvtObj,j=c||i&&i.target==this.canvas,k=null,l=-1,m="";!b&&(a||this.mouseInBounds&&j)&&(k=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var n=this._mouseOverTarget||[],o=n[n.length-1],p=this._mouseOverTarget=[];for(f=k;f;)p.unshift(f),m||(m=f.cursor),f=f.parent;for(this.canvas.style.cursor=m,!b&&c&&(c.canvas.style.cursor=m),g=0,h=p.length;h>g&&p[g]==n[g];g++)l=g;for(o!=k&&this._dispatchMouseEvent(o,"mouseout",!0,-1,e,i,k),g=n.length-1;g>l;g--)this._dispatchMouseEvent(n[g],"rollout",!1,-1,e,i,k);for(g=p.length-1;g>l;g--)this._dispatchMouseEvent(p[g],"rollover",!1,-1,e,i,o);o!=k&&this._dispatchMouseEvent(k,"mouseover",!0,-1,e,i,o),d&&d._testMouseOver(a,b||k&&this,c||j&&this)}}},b._handleDoubleClick=function(a,b){var c=null,d=this._nextStage,e=this._getPointerData(-1);b||(c=this._getObjectsUnderPoint(e.x,e.y,null,!0),this._dispatchMouseEvent(c,"dblclick",!0,-1,e,a)),d&&d._handleDoubleClick(a,b||c&&this)},b._dispatchMouseEvent=function(a,b,c,d,e,f,g){if(a&&(c||a.hasEventListener(b))){var h=new createjs.MouseEvent(b,c,!1,e.x,e.y,f,d,d===this._primaryPointerID||-1===d,e.rawX,e.rawY,g);a.dispatchEvent(h)}},createjs.Stage=createjs.promote(a,"Container")}(),this.createjs=this.createjs||{},function(){function a(a){this.DisplayObject_constructor(),"string"==typeof a?(this.image=document.createElement("img"),this.image.src=a):this.image=a,this.sourceRect=null}var b=createjs.extend(a,createjs.DisplayObject);b.initialize=a,b.isVisible=function(){var a=this.image,b=this.cacheCanvas||a&&(a.naturalWidth||a.getContext||a.readyState>=2);return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&b)},b.draw=function(a,b){if(this.DisplayObject_draw(a,b)||!this.image)return!0;var c=this.image,d=this.sourceRect;if(d){var e=d.x,f=d.y,g=e+d.width,h=f+d.height,i=0,j=0,k=c.width,l=c.height;0>e&&(i-=e,e=0),g>k&&(g=k),0>f&&(j-=f,f=0),h>l&&(h=l),a.drawImage(c,e,f,g-e,h-f,i,j,g-e,h-f)}else a.drawImage(c,0,0);return!0},b.getBounds=function(){var a=this.DisplayObject_getBounds();if(a)return a;var b=this.image,c=this.sourceRect||b,d=b&&(b.naturalWidth||b.getContext||b.readyState>=2);return d?this._rectangle.setValues(0,0,c.width,c.height):null},b.clone=function(){var b=new a(this.image);return this.sourceRect&&(b.sourceRect=this.sourceRect.clone()),this._cloneProps(b),b},b.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.DisplayObject_constructor(),this.currentFrame=0,this.currentAnimation=null,this.paused=!0,this.spriteSheet=a,this.currentAnimationFrame=0,this.framerate=0,this._animation=null,this._currentFrame=null,this._skipAdvance=!1,null!=b&&this.gotoAndPlay(b)}var b=createjs.extend(a,createjs.DisplayObject);b.initialize=a,b.isVisible=function(){var a=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;this._normalizeFrame();var c=this.spriteSheet.getFrame(0|this._currentFrame);if(!c)return!1;var d=c.rect;return d.width&&d.height&&a.drawImage(c.image,d.x,d.y,d.width,d.height,-c.regX,-c.regY,d.width,d.height),!0},b.play=function(){this.paused=!1},b.stop=function(){this.paused=!0},b.gotoAndPlay=function(a){this.paused=!1,this._skipAdvance=!0,this._goto(a)},b.gotoAndStop=function(a){this.paused=!0,this._goto(a)},b.advance=function(a){var b=this.framerate||this.spriteSheet.framerate,c=b&&null!=a?a/(1e3/b):1;this._normalizeFrame(c)},b.getBounds=function(){return this.DisplayObject_getBounds()||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)},b.clone=function(){return this._cloneProps(new a(this.spriteSheet))},b.toString=function(){return"[Sprite (name="+this.name+")]"},b._cloneProps=function(a){return this.DisplayObject__cloneProps(a),a.currentFrame=this.currentFrame,a.currentAnimation=this.currentAnimation,a.paused=this.paused,a.currentAnimationFrame=this.currentAnimationFrame,a.framerate=this.framerate,a._animation=this._animation,a._currentFrame=this._currentFrame,a._skipAdvance=this._skipAdvance,a},b._tick=function(a){this.paused||(this._skipAdvance||this.advance(a&&a.delta),this._skipAdvance=!1),this.DisplayObject__tick(a)},b._normalizeFrame=function(a){a=a||0;var b,c=this._animation,d=this.paused,e=this._currentFrame;if(c){var f=c.speed||1,g=this.currentAnimationFrame;if(b=c.frames.length,g+a*f>=b){var h=c.next;if(this._dispatchAnimationEnd(c,e,d,h,b-1))return;if(h)return this._goto(h,a-(b-g)/f);this.paused=!0,g=c.frames.length-1}else g+=a*f;this.currentAnimationFrame=g,this._currentFrame=c.frames[0|g]}else if(e=this._currentFrame+=a,b=this.spriteSheet.getNumFrames(),e>=b&&b>0&&!this._dispatchAnimationEnd(c,e,d,b-1)&&(this._currentFrame-=b)>=b)return this._normalizeFrame();e=0|this._currentFrame,this.currentFrame!=e&&(this.currentFrame=e,this.dispatchEvent("change"))},b._dispatchAnimationEnd=function(a,b,c,d,e){var f=a?a.name:null;if(this.hasEventListener("animationend")){var g=new createjs.Event("animationend");g.name=f,g.next=d,this.dispatchEvent(g)}var h=this._animation!=a||this._currentFrame!=b;return h||c||!this.paused||(this.currentAnimationFrame=e,h=!0),h},b._goto=function(a,b){if(this.currentAnimationFrame=0,isNaN(a)){var c=this.spriteSheet.getAnimation(a);c&&(this._animation=c,this.currentAnimation=a,this._normalizeFrame(b))}else this.currentAnimation=this._animation=null,this._currentFrame=a,this._normalizeFrame()},createjs.Sprite=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.DisplayObject_constructor(),this.graphics=a?a:new createjs.Graphics}var b=createjs.extend(a,createjs.DisplayObject);b.isVisible=function(){var a=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.draw=function(a,b){return this.DisplayObject_draw(a,b)?!0:(this.graphics.draw(a,this),!0)},b.clone=function(b){var c=b&&this.graphics?this.graphics.clone():this.graphics;return this._cloneProps(new a(c))},b.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.DisplayObject_constructor(),this.text=a,this.font=b,this.color=c,this.textAlign="left",this.textBaseline="top",this.maxWidth=null,this.outline=0,this.lineHeight=0,this.lineWidth=null}var b=createjs.extend(a,createjs.DisplayObject),c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");c.getContext&&(a._workingContext=c.getContext("2d"),c.width=c.height=1),a.H_OFFSETS={start:0,left:0,center:-.5,end:-1,right:-1},a.V_OFFSETS={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1},b.isVisible=function(){var a=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&a)},b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;var c=this.color||"#000";return this.outline?(a.strokeStyle=c,a.lineWidth=1*this.outline):a.fillStyle=c,this._drawText(this._prepContext(a)),!0},b.getMeasuredWidth=function(){return this._getMeasuredWidth(this.text)},b.getMeasuredLineHeight=function(){return 1.2*this._getMeasuredWidth("M")},b.getMeasuredHeight=function(){return this._drawText(null,{}).height},b.getBounds=function(){var b=this.DisplayObject_getBounds();if(b)return b;if(null==this.text||""===this.text)return null;var c=this._drawText(null,{}),d=this.maxWidth&&this.maxWidth<c.width?this.maxWidth:c.width,e=d*a.H_OFFSETS[this.textAlign||"left"],f=this.lineHeight||this.getMeasuredLineHeight(),g=f*a.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.setValues(e,g,d,c.height)},b.getMetrics=function(){var b={lines:[]};return b.lineHeight=this.lineHeight||this.getMeasuredLineHeight(),b.vOffset=b.lineHeight*a.V_OFFSETS[this.textBaseline||"top"],this._drawText(null,b,b.lines)},b.clone=function(){return this._cloneProps(new a(this.text,this.font,this.color))},b.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"},b._cloneProps=function(a){return this.DisplayObject__cloneProps(a),a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,a.maxWidth=this.maxWidth,a.outline=this.outline,a.lineHeight=this.lineHeight,a.lineWidth=this.lineWidth,a},b._prepContext=function(a){return a.font=this.font||"10px sans-serif",a.textAlign=this.textAlign||"left",a.textBaseline=this.textBaseline||"top",a},b._drawText=function(b,c,d){var e=!!b;e||(b=a._workingContext,b.save(),this._prepContext(b));for(var f=this.lineHeight||this.getMeasuredLineHeight(),g=0,h=0,i=String(this.text).split(/(?:\r\n|\r|\n)/),j=0,k=i.length;k>j;j++){var l=i[j],m=null;if(null!=this.lineWidth&&(m=b.measureText(l).width)>this.lineWidth){var n=l.split(/(\s)/);l=n[0],m=b.measureText(l).width;for(var o=1,p=n.length;p>o;o+=2){var q=b.measureText(n[o]+n[o+1]).width;m+q>this.lineWidth?(e&&this._drawTextLine(b,l,h*f),d&&d.push(l),m>g&&(g=m),l=n[o+1],m=b.measureText(l).width,h++):(l+=n[o]+n[o+1],m+=q)}}e&&this._drawTextLine(b,l,h*f),d&&d.push(l),c&&null==m&&(m=b.measureText(l).width),m>g&&(g=m),h++}return c&&(c.width=g,c.height=h*f),e||b.restore(),c},b._drawTextLine=function(a,b,c){this.outline?a.strokeText(b,0,c,this.maxWidth||65535):a.fillText(b,0,c,this.maxWidth||65535)},b._getMeasuredWidth=function(b){var c=a._workingContext;c.save();var d=this._prepContext(c).measureText(b).width;return c.restore(),d},createjs.Text=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.Container_constructor(),this.text=a||"",this.spriteSheet=b,this.lineHeight=0,this.letterSpacing=0,this.spaceWidth=0,this._oldProps={text:0,spriteSheet:0,lineHeight:0,letterSpacing:0,spaceWidth:0}}var b=createjs.extend(a,createjs.Container);a.maxPoolSize=100,a._spritePool=[],b.draw=function(a,b){this.DisplayObject_draw(a,b)||(this._updateText(),this.Container_draw(a,b))},b.getBounds=function(){return this._updateText(),this.Container_getBounds()},b.isVisible=function(){var a=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&this.alpha>0&&0!==this.scaleX&&0!==this.scaleY&&a)},b.clone=function(){return this._cloneProps(new a(this.text,this.spriteSheet))},b.addChild=b.addChildAt=b.removeChild=b.removeChildAt=b.removeAllChildren=function(){},b._cloneProps=function(a){return this.Container__cloneProps(a),a.lineHeight=this.lineHeight,a.letterSpacing=this.letterSpacing,a.spaceWidth=this.spaceWidth,a},b._getFrameIndex=function(a,b){var c,d=b.getAnimation(a);return d||(a!=(c=a.toUpperCase())||a!=(c=a.toLowerCase())||(c=null),c&&(d=b.getAnimation(c))),d&&d.frames[0]},b._getFrame=function(a,b){var c=this._getFrameIndex(a,b);return null==c?c:b.getFrame(c)},b._getLineHeight=function(a){var b=this._getFrame("1",a)||this._getFrame("T",a)||this._getFrame("L",a)||a.getFrame(0);return b?b.rect.height:1},b._getSpaceWidth=function(a){var b=this._getFrame("1",a)||this._getFrame("l",a)||this._getFrame("e",a)||this._getFrame("a",a)||a.getFrame(0);return b?b.rect.width:1},b._updateText=function(){var b,c=0,d=0,e=this._oldProps,f=!1,g=this.spaceWidth,h=this.lineHeight,i=this.spriteSheet,j=a._spritePool,k=this.children,l=0,m=k.length;for(var n in e)e[n]!=this[n]&&(e[n]=this[n],f=!0);if(f){var o=!!this._getFrame(" ",i);o||g||(g=this._getSpaceWidth(i)),h||(h=this._getLineHeight(i));for(var p=0,q=this.text.length;q>p;p++){var r=this.text.charAt(p);if(" "!=r||o)if("\n"!=r&&"\r"!=r){var s=this._getFrameIndex(r,i);null!=s&&(m>l?b=k[l]:(k.push(b=j.length?j.pop():new createjs.Sprite),b.parent=this,m++),b.spriteSheet=i,b.gotoAndStop(s),b.x=c,b.y=d,l++,c+=b.getBounds().width+this.letterSpacing)}else"\r"==r&&"\n"==this.text.charAt(p+1)&&p++,c=0,d+=h;else c+=g}for(;m>l;)j.push(b=k.pop()),b.parent=null,m--;j.length>a.maxPoolSize&&(j.length=a.maxPoolSize)}},createjs.BitmapText=createjs.promote(a,"Container")}(),this.createjs=this.createjs||{},function(){"use strict";function a(b,c,d,e){this.Container_constructor(),!a.inited&&a.init(),this.mode=b||a.INDEPENDENT,this.startPosition=c||0,this.loop=d,this.currentFrame=0,this.timeline=new createjs.Timeline(null,e,{paused:!0,position:c,useTicks:!0}),this.paused=!1,this.actionsEnabled=!0,this.autoReset=!0,this.frameBounds=this.frameBounds||null,this.framerate=null,this._synchOffset=0,this._prevPos=-1,this._prevPosition=0,this._t=0,this._managed={}}function b(){throw"MovieClipPlugin cannot be instantiated."}var c=createjs.extend(a,createjs.Container);a.INDEPENDENT="independent",a.SINGLE_FRAME="single",a.SYNCHED="synched",a.inited=!1,a.init=function(){a.inited||(b.install(),a.inited=!0)},c.getLabels=function(){return this.timeline.getLabels()},c.getCurrentLabel=function(){return this._updateTimeline(),this.timeline.getCurrentLabel()},c.getDuration=function(){return this.timeline.duration;
};try{Object.defineProperties(c,{labels:{get:c.getLabels},currentLabel:{get:c.getCurrentLabel},totalFrames:{get:c.getDuration},duration:{get:c.getDuration}})}catch(d){}c.initialize=a,c.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},c.draw=function(a,b){return this.DisplayObject_draw(a,b)?!0:(this._updateTimeline(),this.Container_draw(a,b),!0)},c.play=function(){this.paused=!1},c.stop=function(){this.paused=!0},c.gotoAndPlay=function(a){this.paused=!1,this._goto(a)},c.gotoAndStop=function(a){this.paused=!0,this._goto(a)},c.advance=function(b){var c=a.INDEPENDENT;if(this.mode==c){for(var d=this,e=d.framerate;(d=d.parent)&&null==e;)d.mode==c&&(e=d._framerate);this._framerate=e;var f=null!=e&&-1!=e&&null!=b?b/(1e3/e)+this._t:1,g=0|f;for(this._t=f-g;!this.paused&&g--;)this._prevPosition=this._prevPos<0?0:this._prevPosition+1,this._updateTimeline()}},c.clone=function(){throw"MovieClip cannot be cloned."},c.toString=function(){return"[MovieClip (name="+this.name+")]"},c._tick=function(a){this.advance(a&&a.delta),this.Container__tick(a)},c._goto=function(a){var b=this.timeline.resolve(a);null!=b&&(-1==this._prevPos&&(this._prevPos=NaN),this._prevPosition=b,this._t=0,this._updateTimeline())},c._reset=function(){this._prevPos=-1,this._t=this.currentFrame=0,this.paused=!1},c._updateTimeline=function(){var b=this.timeline,c=this.mode!=a.INDEPENDENT;b.loop=null==this.loop?!0:this.loop;var d=c?this.startPosition+(this.mode==a.SINGLE_FRAME?0:this._synchOffset):this._prevPos<0?0:this._prevPosition,e=c||!this.actionsEnabled?createjs.Tween.NONE:null;if(this.currentFrame=b._calcPosition(d),b.setPosition(d,e),this._prevPosition=b._prevPosition,this._prevPos!=b._prevPos){this.currentFrame=this._prevPos=b._prevPos;for(var f in this._managed)this._managed[f]=1;for(var g=b._tweens,h=0,i=g.length;i>h;h++){var j=g[h],k=j._target;if(k!=this&&!j.passive){var l=j._stepPosition;k instanceof createjs.DisplayObject?this._addManagedChild(k,l):this._setState(k.state,l)}}var m=this.children;for(h=m.length-1;h>=0;h--){var n=m[h].id;1==this._managed[n]&&(this.removeChildAt(h),delete this._managed[n])}}},c._setState=function(a,b){if(a)for(var c=a.length-1;c>=0;c--){var d=a[c],e=d.t,f=d.p;for(var g in f)e[g]=f[g];this._addManagedChild(e,b)}},c._addManagedChild=function(b,c){b._off||(this.addChildAt(b,0),b instanceof a&&(b._synchOffset=c,b.mode==a.INDEPENDENT&&b.autoReset&&!this._managed[b.id]&&b._reset()),this._managed[b.id]=2)},c._getBounds=function(a,b){var c=this.DisplayObject_getBounds();return c||(this._updateTimeline(),this.frameBounds&&(c=this._rectangle.copy(this.frameBounds[this.currentFrame]))),c?this._transformBounds(c,a,b):this.Container__getBounds(a,b)},createjs.MovieClip=createjs.promote(a,"Container"),b.priority=100,b.install=function(){createjs.Tween.installPlugin(b,["startPosition"])},b.init=function(a,b,c){return c},b.step=function(){},b.tween=function(b,c,d,e,f,g,h,i){return b.target instanceof a?1==g?f[c]:e[c]:d}}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"SpriteSheetUtils cannot be instantiated"}var b=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");b.getContext&&(a._workingCanvas=b,a._workingContext=b.getContext("2d"),b.width=b.height=1),a.addFlippedFrames=function(b,c,d,e){if(c||d||e){var f=0;c&&a._flip(b,++f,!0,!1),d&&a._flip(b,++f,!1,!0),e&&a._flip(b,++f,!0,!0)}},a.extractFrame=function(b,c){isNaN(c)&&(c=b.getAnimation(c).frames[0]);var d=b.getFrame(c);if(!d)return null;var e=d.rect,f=a._workingCanvas;f.width=e.width,f.height=e.height,a._workingContext.drawImage(d.image,e.x,e.y,e.width,e.height,0,0,e.width,e.height);var g=document.createElement("img");return g.src=f.toDataURL("image/png"),g},a.mergeAlpha=function(a,b,c){c||(c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),c.width=Math.max(b.width,a.width),c.height=Math.max(b.height,a.height);var d=c.getContext("2d");return d.save(),d.drawImage(a,0,0),d.globalCompositeOperation="destination-in",d.drawImage(b,0,0),d.restore(),c},a._flip=function(b,c,d,e){for(var f=b._images,g=a._workingCanvas,h=a._workingContext,i=f.length/c,j=0;i>j;j++){var k=f[j];k.__tmp=j,h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,g.width+1,g.height+1),g.width=k.width,g.height=k.height,h.setTransform(d?-1:1,0,0,e?-1:1,d?k.width:0,e?k.height:0),h.drawImage(k,0,0);var l=document.createElement("img");l.src=g.toDataURL("image/png"),l.width=k.width,l.height=k.height,f.push(l)}var m=b._frames,n=m.length/c;for(j=0;n>j;j++){k=m[j];var o=k.rect.clone();l=f[k.image.__tmp+i*c];var p={image:l,rect:o,regX:k.regX,regY:k.regY};d&&(o.x=l.width-o.x-o.width,p.regX=o.width-k.regX),e&&(o.y=l.height-o.y-o.height,p.regY=o.height-k.regY),m.push(p)}var q="_"+(d?"h":"")+(e?"v":""),r=b._animations,s=b._data,t=r.length/c;for(j=0;t>j;j++){var u=r[j];k=s[u];var v={name:u+q,speed:k.speed,next:k.next,frames:[]};k.next&&(v.next+=q),m=k.frames;for(var w=0,x=m.length;x>w;w++)v.frames.push(m[w]+n*c);s[v.name]=v,r.push(v.name)}},createjs.SpriteSheetUtils=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.EventDispatcher_constructor(),this.maxWidth=2048,this.maxHeight=2048,this.spriteSheet=null,this.scale=1,this.padding=1,this.timeSlice=.3,this.progress=-1,this.framerate=a||0,this._frames=[],this._animations={},this._data=null,this._nextFrameIndex=0,this._index=0,this._timerID=null,this._scale=1}var b=createjs.extend(a,createjs.EventDispatcher);a.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",a.ERR_RUNNING="a build is already running",b.addFrame=function(b,c,d,e,f){if(this._data)throw a.ERR_RUNNING;var g=c||b.bounds||b.nominalBounds;return!g&&b.getBounds&&(g=b.getBounds()),g?(d=d||1,this._frames.push({source:b,sourceRect:g,scale:d,funct:e,data:f,index:this._frames.length,height:g.height*d})-1):null},b.addAnimation=function(b,c,d,e){if(this._data)throw a.ERR_RUNNING;this._animations[b]={frames:c,next:d,speed:e}},b.addMovieClip=function(b,c,d,e,f,g){if(this._data)throw a.ERR_RUNNING;var h=b.frameBounds,i=c||b.bounds||b.nominalBounds;if(!i&&b.getBounds&&(i=b.getBounds()),i||h){var j,k,l=this._frames.length,m=b.timeline.duration;for(j=0;m>j;j++){var n=h&&h[j]?h[j]:i;this.addFrame(b,n,d,this._setupMovieClipFrame,{i:j,f:e,d:f})}var o=b.timeline._labels,p=[];for(var q in o)p.push({index:o[q],label:q});if(p.length)for(p.sort(function(a,b){return a.index-b.index}),j=0,k=p.length;k>j;j++){for(var r=p[j].label,s=l+p[j].index,t=l+(j==k-1?m:p[j+1].index),u=[],v=s;t>v;v++)u.push(v);(!g||(r=g(r,b,s,t)))&&this.addAnimation(r,u,!0)}}},b.build=function(){if(this._data)throw a.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},b.buildAsync=function(b){if(this._data)throw a.ERR_RUNNING;this.timeSlice=b,this._startBuild();var c=this;this._timerID=setTimeout(function(){c._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},b.stopAsync=function(){clearTimeout(this._timerID),this._data=null},b.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},b.toString=function(){return"[SpriteSheetBuilder]"},b._startBuild=function(){var b=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var c=[];this._data={images:[],frames:c,framerate:this.framerate,animations:this._animations};var d=this._frames.slice();if(d.sort(function(a,b){return a.height<=b.height?-1:1}),d[d.length-1].height+2*b>this.maxHeight)throw a.ERR_DIMENSIONS;for(var e=0,f=0,g=0;d.length;){var h=this._fillRow(d,e,g,c,b);if(h.w>f&&(f=h.w),e+=h.h,!h.h||!d.length){var i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.width=this._getSize(f,this.maxWidth),i.height=this._getSize(e,this.maxHeight),this._data.images[g]=i,h.h||(f=e=0,g++)}}},b._setupMovieClipFrame=function(a,b){var c=a.actionsEnabled;a.actionsEnabled=!1,a.gotoAndStop(b.i),a.actionsEnabled=c,b.f&&b.f(a,b.d,b.i)},b._getSize=function(a,b){for(var c=4;Math.pow(2,++c)<a;);return Math.min(b,Math.pow(2,c))},b._fillRow=function(b,c,d,e,f){var g=this.maxWidth,h=this.maxHeight;c+=f;for(var i=h-c,j=f,k=0,l=b.length-1;l>=0;l--){var m=b[l],n=this._scale*m.scale,o=m.sourceRect,p=m.source,q=Math.floor(n*o.x-f),r=Math.floor(n*o.y-f),s=Math.ceil(n*o.height+2*f),t=Math.ceil(n*o.width+2*f);if(t>g)throw a.ERR_DIMENSIONS;s>i||j+t>g||(m.img=d,m.rect=new createjs.Rectangle(j,c,t,s),k=k||s,b.splice(l,1),e[m.index]=[j,c,t,s,d,Math.round(-q+n*p.regX-f),Math.round(-r+n*p.regY-f)],j+=t)}return{w:j,h:k}},b._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.dispatchEvent("complete")},b._run=function(){for(var a=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),b=(new Date).getTime()+a,c=!1;b>(new Date).getTime();)if(!this._drawNext()){c=!0;break}if(c)this._endBuild();else{var d=this;this._timerID=setTimeout(function(){d._run()},50-a)}var e=this.progress=this._index/this._frames.length;if(this.hasEventListener("progress")){var f=new createjs.Event("progress");f.progress=e,this.dispatchEvent(f)}},b._drawNext=function(){var a=this._frames[this._index],b=a.scale*this._scale,c=a.rect,d=a.sourceRect,e=this._data.images[a.img],f=e.getContext("2d");return a.funct&&a.funct(a.source,a.data),f.save(),f.beginPath(),f.rect(c.x,c.y,c.width,c.height),f.clip(),f.translate(Math.ceil(c.x-d.x*b),Math.ceil(c.y-d.y*b)),f.scale(b,b),a.source.draw(f),f.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.DisplayObject_constructor(),"string"==typeof a&&(a=document.getElementById(a)),this.mouseEnabled=!1;var b=a.style;b.position="absolute",b.transformOrigin=b.WebkitTransformOrigin=b.msTransformOrigin=b.MozTransformOrigin=b.OTransformOrigin="0% 0%",this.htmlElement=a,this._oldProps=null}var b=createjs.extend(a,createjs.DisplayObject);b.isVisible=function(){return null!=this.htmlElement},b.draw=function(a,b){return!0},b.cache=function(){},b.uncache=function(){},b.updateCache=function(){},b.hitTest=function(){},b.localToGlobal=function(){},b.globalToLocal=function(){},b.localToLocal=function(){},b.clone=function(){throw"DOMElement cannot be cloned."},b.toString=function(){return"[DOMElement (name="+this.name+")]"},b._tick=function(a){var b=this.getStage();b&&b.on("drawend",this._handleDrawEnd,this,!0),this.DisplayObject__tick(a)},b._handleDrawEnd=function(a){var b=this.htmlElement;if(b){var c=b.style,d=this.getConcatenatedDisplayProps(this._props),e=d.matrix,f=d.visible?"visible":"hidden";if(f!=c.visibility&&(c.visibility=f),d.visible){var g=this._oldProps,h=g&&g.matrix,i=1e4;if(!h||!h.equals(e)){var j="matrix("+(e.a*i|0)/i+","+(e.b*i|0)/i+","+(e.c*i|0)/i+","+(e.d*i|0)/i+","+(e.tx+.5|0);c.transform=c.WebkitTransform=c.OTransform=c.msTransform=j+","+(e.ty+.5|0)+")",c.MozTransform=j+"px,"+(e.ty+.5|0)+"px)",g||(g=this._oldProps=new createjs.DisplayProps(!0,NaN)),g.matrix.copy(e)}g.alpha!=d.alpha&&(c.opacity=""+(d.alpha*i|0)/i,g.alpha=d.alpha)}}},createjs.DOMElement=createjs.promote(a,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){}var b=a.prototype;b.getBounds=function(a){return a},b.applyFilter=function(a,b,c,d,e,f,g,h){f=f||a,null==g&&(g=b),null==h&&(h=c);try{var i=a.getImageData(b,c,d,e)}catch(j){return!1}return this._applyFilter(i)?(f.putImageData(i,g,h),!0):!1},b.toString=function(){return"[Filter]"},b.clone=function(){return new a},b._applyFilter=function(a){return!0},createjs.Filter=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){(isNaN(a)||0>a)&&(a=0),(isNaN(b)||0>b)&&(b=0),(isNaN(c)||1>c)&&(c=1),this.blurX=0|a,this.blurY=0|b,this.quality=0|c}var b=createjs.extend(a,createjs.Filter);a.MUL_TABLE=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],a.SHG_TABLE=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],b.getBounds=function(a){var b=0|this.blurX,c=0|this.blurY;if(0>=b&&0>=c)return a;var d=Math.pow(this.quality,.2);return(a||new createjs.Rectangle).pad(b*d+1,c*d+1,b*d+1,c*d+1)},b.clone=function(){return new a(this.blurX,this.blurY,this.quality)},b.toString=function(){return"[BlurFilter]"},b._applyFilter=function(b){var c=this.blurX>>1;if(isNaN(c)||0>c)return!1;var d=this.blurY>>1;if(isNaN(d)||0>d)return!1;if(0==c&&0==d)return!1;var e=this.quality;(isNaN(e)||1>e)&&(e=1),e|=0,e>3&&(e=3),1>e&&(e=1);var f=b.data,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=c+c+1|0,w=d+d+1|0,x=0|b.width,y=0|b.height,z=x-1|0,A=y-1|0,B=c+1|0,C=d+1|0,D={r:0,b:0,g:0,a:0},E=D;for(i=1;v>i;i++)E=E.n={r:0,b:0,g:0,a:0};E.n=D;var F={r:0,b:0,g:0,a:0},G=F;for(i=1;w>i;i++)G=G.n={r:0,b:0,g:0,a:0};G.n=F;for(var H=null,I=0|a.MUL_TABLE[c],J=0|a.SHG_TABLE[c],K=0|a.MUL_TABLE[d],L=0|a.SHG_TABLE[d];e-->0;){m=l=0;var M=I,N=J;for(h=y;--h>-1;){for(n=B*(r=f[0|l]),o=B*(s=f[l+1|0]),p=B*(t=f[l+2|0]),q=B*(u=f[l+3|0]),E=D,i=B;--i>-1;)E.r=r,E.g=s,E.b=t,E.a=u,E=E.n;for(i=1;B>i;i++)j=l+((i>z?z:i)<<2)|0,n+=E.r=f[j],o+=E.g=f[j+1],p+=E.b=f[j+2],q+=E.a=f[j+3],E=E.n;for(H=D,g=0;x>g;g++)f[l++]=n*M>>>N,f[l++]=o*M>>>N,f[l++]=p*M>>>N,f[l++]=q*M>>>N,j=m+((j=g+c+1)<z?j:z)<<2,n-=H.r-(H.r=f[j]),o-=H.g-(H.g=f[j+1]),p-=H.b-(H.b=f[j+2]),q-=H.a-(H.a=f[j+3]),H=H.n;m+=x}for(M=K,N=L,g=0;x>g;g++){for(l=g<<2|0,n=C*(r=f[l])|0,o=C*(s=f[l+1|0])|0,p=C*(t=f[l+2|0])|0,q=C*(u=f[l+3|0])|0,G=F,i=0;C>i;i++)G.r=r,G.g=s,G.b=t,G.a=u,G=G.n;for(k=x,i=1;d>=i;i++)l=k+g<<2,n+=G.r=f[l],o+=G.g=f[l+1],p+=G.b=f[l+2],q+=G.a=f[l+3],G=G.n,A>i&&(k+=x);if(l=g,H=F,e>0)for(h=0;y>h;h++)j=l<<2,f[j+3]=u=q*M>>>N,u>0?(f[j]=n*M>>>N,f[j+1]=o*M>>>N,f[j+2]=p*M>>>N):f[j]=f[j+1]=f[j+2]=0,j=g+((j=h+C)<A?j:A)*x<<2,n-=H.r-(H.r=f[j]),o-=H.g-(H.g=f[j+1]),p-=H.b-(H.b=f[j+2]),q-=H.a-(H.a=f[j+3]),H=H.n,l+=x;else for(h=0;y>h;h++)j=l<<2,f[j+3]=u=q*M>>>N,u>0?(u=255/u,f[j]=(n*M>>>N)*u,f[j+1]=(o*M>>>N)*u,f[j+2]=(p*M>>>N)*u):f[j]=f[j+1]=f[j+2]=0,j=g+((j=h+C)<A?j:A)*x<<2,n-=H.r-(H.r=f[j]),o-=H.g-(H.g=f[j+1]),p-=H.b-(H.b=f[j+2]),q-=H.a-(H.a=f[j+3]),H=H.n,l+=x}}return!0},createjs.BlurFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.alphaMap=a,this._alphaMap=null,this._mapData=null}var b=createjs.extend(a,createjs.Filter);b.clone=function(){var b=new a(this.alphaMap);return b._alphaMap=this._alphaMap,b._mapData=this._mapData,b},b.toString=function(){return"[AlphaMapFilter]"},b._applyFilter=function(a){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;for(var b=a.data,c=this._mapData,d=0,e=b.length;e>d;d+=4)b[d+3]=c[d]||0;return!0},b._prepAlphaMap=function(){if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;var a,b=this._alphaMap=this.alphaMap,c=b;b instanceof HTMLCanvasElement?a=c.getContext("2d"):(c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),c.width=b.width,c.height=b.height,a=c.getContext("2d"),a.drawImage(b,0,0));try{var d=a.getImageData(0,0,b.width,b.height)}catch(e){return!1}return this._mapData=d.data,!0},createjs.AlphaMapFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.mask=a}var b=createjs.extend(a,createjs.Filter);b.applyFilter=function(a,b,c,d,e,f,g,h){return this.mask?(f=f||a,null==g&&(g=b),null==h&&(h=c),f.save(),a!=f?!1:(f.globalCompositeOperation="destination-in",f.drawImage(this.mask,g,h),f.restore(),!0)):!0},b.clone=function(){return new a(this.mask)},b.toString=function(){return"[AlphaMaskFilter]"},createjs.AlphaMaskFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d,e,f,g,h){this.redMultiplier=null!=a?a:1,this.greenMultiplier=null!=b?b:1,this.blueMultiplier=null!=c?c:1,this.alphaMultiplier=null!=d?d:1,this.redOffset=e||0,this.greenOffset=f||0,this.blueOffset=g||0,this.alphaOffset=h||0}var b=createjs.extend(a,createjs.Filter);b.toString=function(){return"[ColorFilter]"},b.clone=function(){return new a(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)},b._applyFilter=function(a){for(var b=a.data,c=b.length,d=0;c>d;d+=4)b[d]=b[d]*this.redMultiplier+this.redOffset,b[d+1]=b[d+1]*this.greenMultiplier+this.greenOffset,b[d+2]=b[d+2]*this.blueMultiplier+this.blueOffset,b[d+3]=b[d+3]*this.alphaMultiplier+this.alphaOffset;return!0},createjs.ColorFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d){this.setColor(a,b,c,d)}var b=a.prototype;a.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],a.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],a.LENGTH=a.IDENTITY_MATRIX.length,b.setColor=function(a,b,c,d){return this.reset().adjustColor(a,b,c,d)},b.reset=function(){return this.copy(a.IDENTITY_MATRIX)},b.adjustColor=function(a,b,c,d){return this.adjustHue(d),this.adjustContrast(b),this.adjustBrightness(a),this.adjustSaturation(c)},b.adjustBrightness=function(a){return 0==a||isNaN(a)?this:(a=this._cleanValue(a,255),this._multiplyMatrix([1,0,0,0,a,0,1,0,0,a,0,0,1,0,a,0,0,0,1,0,0,0,0,0,1]),this)},b.adjustContrast=function(b){if(0==b||isNaN(b))return this;b=this._cleanValue(b,100);var c;return 0>b?c=127+b/100*127:(c=b%1,c=0==c?a.DELTA_INDEX[b]:a.DELTA_INDEX[b<<0]*(1-c)+a.DELTA_INDEX[(b<<0)+1]*c,c=127*c+127),this._multiplyMatrix([c/127,0,0,0,.5*(127-c),0,c/127,0,0,.5*(127-c),0,0,c/127,0,.5*(127-c),0,0,0,1,0,0,0,0,0,1]),this},b.adjustSaturation=function(a){if(0==a||isNaN(a))return this;a=this._cleanValue(a,100);var b=1+(a>0?3*a/100:a/100),c=.3086,d=.6094,e=.082;return this._multiplyMatrix([c*(1-b)+b,d*(1-b),e*(1-b),0,0,c*(1-b),d*(1-b)+b,e*(1-b),0,0,c*(1-b),d*(1-b),e*(1-b)+b,0,0,0,0,0,1,0,0,0,0,0,1]),this},b.adjustHue=function(a){if(0==a||isNaN(a))return this;a=this._cleanValue(a,180)/180*Math.PI;var b=Math.cos(a),c=Math.sin(a),d=.213,e=.715,f=.072;return this._multiplyMatrix([d+b*(1-d)+c*-d,e+b*-e+c*-e,f+b*-f+c*(1-f),0,0,d+b*-d+.143*c,e+b*(1-e)+.14*c,f+b*-f+c*-.283,0,0,d+b*-d+c*-(1-d),e+b*-e+c*e,f+b*(1-f)+c*f,0,0,0,0,0,1,0,0,0,0,0,1]),this},b.concat=function(b){return b=this._fixMatrix(b),b.length!=a.LENGTH?this:(this._multiplyMatrix(b),this)},b.clone=function(){return(new a).copy(this)},b.toArray=function(){for(var b=[],c=0,d=a.LENGTH;d>c;c++)b[c]=this[c];return b},b.copy=function(b){for(var c=a.LENGTH,d=0;c>d;d++)this[d]=b[d];return this},b.toString=function(){return"[ColorMatrix]"},b._multiplyMatrix=function(a){var b,c,d,e=[];for(b=0;5>b;b++){for(c=0;5>c;c++)e[c]=this[c+5*b];for(c=0;5>c;c++){var f=0;for(d=0;5>d;d++)f+=a[c+5*d]*e[d];this[c+5*b]=f}}},b._cleanValue=function(a,b){return Math.min(b,Math.max(-b,a))},b._fixMatrix=function(b){return b instanceof a&&(b=b.toArray()),b.length<a.LENGTH?b=b.slice(0,b.length).concat(a.IDENTITY_MATRIX.slice(b.length,a.LENGTH)):b.length>a.LENGTH&&(b=b.slice(0,a.LENGTH)),b},createjs.ColorMatrix=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.matrix=a}var b=createjs.extend(a,createjs.Filter);b.toString=function(){return"[ColorMatrixFilter]"},b.clone=function(){return new a(this.matrix)},b._applyFilter=function(a){for(var b,c,d,e,f=a.data,g=f.length,h=this.matrix,i=h[0],j=h[1],k=h[2],l=h[3],m=h[4],n=h[5],o=h[6],p=h[7],q=h[8],r=h[9],s=h[10],t=h[11],u=h[12],v=h[13],w=h[14],x=h[15],y=h[16],z=h[17],A=h[18],B=h[19],C=0;g>C;C+=4)b=f[C],c=f[C+1],d=f[C+2],e=f[C+3],f[C]=b*i+c*j+d*k+e*l+m,f[C+1]=b*n+c*o+d*p+e*q+r,f[C+2]=b*s+c*t+d*u+e*v+w,f[C+3]=b*x+c*y+d*z+e*A+B;return!0},createjs.ColorMatrixFilter=createjs.promote(a,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Touch cannot be instantiated"}a.isSupported=function(){return!!("ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)},a.enable=function(b,c,d){return b&&b.canvas&&a.isSupported()?b.__touch?!0:(b.__touch={pointers:{},multitouch:!c,preventDefault:!d,count:0},"ontouchstart"in window?a._IOS_enable(b):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&a._IE_enable(b),!0):!1},a.disable=function(b){b&&("ontouchstart"in window?a._IOS_disable(b):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&a._IE_disable(b),delete b.__touch)},a._IOS_enable=function(b){var c=b.canvas,d=b.__touch.f=function(c){a._IOS_handleEvent(b,c)};c.addEventListener("touchstart",d,!1),c.addEventListener("touchmove",d,!1),c.addEventListener("touchend",d,!1),c.addEventListener("touchcancel",d,!1)},a._IOS_disable=function(a){var b=a.canvas;if(b){var c=a.__touch.f;b.removeEventListener("touchstart",c,!1),b.removeEventListener("touchmove",c,!1),b.removeEventListener("touchend",c,!1),b.removeEventListener("touchcancel",c,!1)}},a._IOS_handleEvent=function(a,b){if(a){a.__touch.preventDefault&&b.preventDefault&&b.preventDefault();for(var c=b.changedTouches,d=b.type,e=0,f=c.length;f>e;e++){var g=c[e],h=g.identifier;g.target==a.canvas&&("touchstart"==d?this._handleStart(a,h,b,g.pageX,g.pageY):"touchmove"==d?this._handleMove(a,h,b,g.pageX,g.pageY):("touchend"==d||"touchcancel"==d)&&this._handleEnd(a,h,b))}}},a._IE_enable=function(b){var c=b.canvas,d=b.__touch.f=function(c){a._IE_handleEvent(b,c)};void 0===window.navigator.pointerEnabled?(c.addEventListener("MSPointerDown",d,!1),window.addEventListener("MSPointerMove",d,!1),window.addEventListener("MSPointerUp",d,!1),window.addEventListener("MSPointerCancel",d,!1),b.__touch.preventDefault&&(c.style.msTouchAction="none")):(c.addEventListener("pointerdown",d,!1),window.addEventListener("pointermove",d,!1),window.addEventListener("pointerup",d,!1),window.addEventListener("pointercancel",d,!1),b.__touch.preventDefault&&(c.style.touchAction="none")),b.__touch.activeIDs={}},a._IE_disable=function(a){var b=a.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",b,!1),window.removeEventListener("MSPointerUp",b,!1),window.removeEventListener("MSPointerCancel",b,!1),a.canvas&&a.canvas.removeEventListener("MSPointerDown",b,!1)):(window.removeEventListener("pointermove",b,!1),window.removeEventListener("pointerup",b,!1),window.removeEventListener("pointercancel",b,!1),a.canvas&&a.canvas.removeEventListener("pointerdown",b,!1))},a._IE_handleEvent=function(a,b){if(a){a.__touch.preventDefault&&b.preventDefault&&b.preventDefault();var c=b.type,d=b.pointerId,e=a.__touch.activeIDs;if("MSPointerDown"==c||"pointerdown"==c){if(b.srcElement!=a.canvas)return;e[d]=!0,this._handleStart(a,d,b,b.pageX,b.pageY)}else e[d]&&("MSPointerMove"==c||"pointermove"==c?this._handleMove(a,d,b,b.pageX,b.pageY):("MSPointerUp"==c||"MSPointerCancel"==c||"pointerup"==c||"pointercancel"==c)&&(delete e[d],this._handleEnd(a,d,b)))}},a._handleStart=function(a,b,c,d,e){var f=a.__touch;if(f.multitouch||!f.count){var g=f.pointers;g[b]||(g[b]=!0,f.count++,a._handlePointerDown(b,c,d,e))}},a._handleMove=function(a,b,c,d,e){a.__touch.pointers[b]&&a._handlePointerMove(b,c,d,e)},a._handleEnd=function(a,b,c){var d=a.__touch,e=d.pointers;e[b]&&(d.count--,a._handlePointerUp(b,c,!0),delete e[b])},createjs.Touch=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.EaselJS=createjs.EaselJS||{};a.version="0.8.2",a.buildDate="Thu, 26 Nov 2015 20:44:34 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.PreloadJS=createjs.PreloadJS||{};a.version="0.6.2",a.buildDate="Thu, 26 Nov 2015 20:44:31 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}}}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.Event_constructor("error"),this.title=a,this.message=b,this.data=c}var b=createjs.extend(a,createjs.Event);b.clone=function(){return new createjs.ErrorEvent(this.title,this.message,this.data)},createjs.ErrorEvent=createjs.promote(a,"Event")}(),this.createjs=this.createjs||{},function(a){"use strict";function b(a,b){this.Event_constructor("progress"),this.loaded=a,this.total=null==b?1:b,this.progress=0==b?0:this.loaded/this.total}var c=createjs.extend(b,createjs.Event);c.clone=function(){return new createjs.ProgressEvent(this.loaded,this.total)},createjs.ProgressEvent=createjs.promote(b,"Event")}(window),function(){function a(b,d){function f(a){if(f[a]!==q)return f[a];var b;if("bug-string-char-index"==a)b="a"!="a"[0];else if("json"==a)b=f("json-stringify")&&f("json-parse");else{var c,e='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var i=d.stringify,k="function"==typeof i&&t;if(k){(c=function(){return 1}).toJSON=c;try{k="0"===i(0)&&"0"===i(new g)&&'""'==i(new h)&&i(s)===q&&i(q)===q&&i()===q&&"1"===i(c)&&"[1]"==i([c])&&"[null]"==i([q])&&"null"==i(null)&&"[null,null,null]"==i([q,s,null])&&i({a:[c,!0,!1,null,"\x00\b\n\f\r	"]})==e&&"1"===i(null,c)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new j(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==i(new j(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new j(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==i(new j(-1))}catch(l){k=!1}}b=k}if("json-parse"==a){var m=d.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){c=m(e);var n=5==c.a.length&&1===c.a[0];if(n){try{n=!m('"	"')}catch(l){}if(n)try{n=1!==m("01")}catch(l){}if(n)try{n=1!==m("1.")}catch(l){}}}}catch(l){n=!1}b=n}}return f[a]=!!b}b||(b=e.Object()),d||(d=e.Object());var g=b.Number||e.Number,h=b.String||e.String,i=b.Object||e.Object,j=b.Date||e.Date,k=b.SyntaxError||e.SyntaxError,l=b.TypeError||e.TypeError,m=b.Math||e.Math,n=b.JSON||e.JSON;"object"==typeof n&&n&&(d.stringify=n.stringify,d.parse=n.parse);var o,p,q,r=i.prototype,s=r.toString,t=new j(-0xc782b5b800cec);try{t=-109252==t.getUTCFullYear()&&0===t.getUTCMonth()&&1===t.getUTCDate()&&10==t.getUTCHours()&&37==t.getUTCMinutes()&&6==t.getUTCSeconds()&&708==t.getUTCMilliseconds()}catch(u){}if(!f("json")){var v="[object Function]",w="[object Date]",x="[object Number]",y="[object String]",z="[object Array]",A="[object Boolean]",B=f("bug-string-char-index");if(!t)var C=m.floor,D=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(a,b){return D[b]+365*(a-1970)+C((a-1969+(b=+(b>1)))/4)-C((a-1901+b)/100)+C((a-1601+b)/400)};if((o=r.hasOwnProperty)||(o=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=s?o=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,o=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,o.call(this,a)}),p=function(a,b){var d,e,f,g=0;(d=function(){this.valueOf=0}).prototype.valueOf=0,e=new d;for(f in e)o.call(e,f)&&g++;return d=e=null,g?p=2==g?function(a,b){var c,d={},e=s.call(a)==v;for(c in a)e&&"prototype"==c||o.call(d,c)||!(d[c]=1)||!o.call(a,c)||b(c)}:function(a,b){var c,d,e=s.call(a)==v;for(c in a)e&&"prototype"==c||!o.call(a,c)||(d="constructor"===c)||b(c);(d||o.call(a,c="constructor"))&&b(c)}:(e=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],p=function(a,b){var d,f,g=s.call(a)==v,h=!g&&"function"!=typeof a.constructor&&c[typeof a.hasOwnProperty]&&a.hasOwnProperty||o;for(d in a)g&&"prototype"==d||!h.call(a,d)||b(d);for(f=e.length;d=e[--f];h.call(a,d)&&b(d));}),p(a,b)},!f("json-stringify")){var F={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},G="000000",H=function(a,b){return(G+(b||0)).slice(-a)},I="\\u00",J=function(a){for(var b='"',c=0,d=a.length,e=!B||d>10,f=e&&(B?a.split(""):a);d>c;c++){var g=a.charCodeAt(c);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=F[g];break;default:if(32>g){b+=I+H(2,g.toString(16));break}b+=e?f[c]:a.charAt(c)}}return b+'"'},K=function(a,b,c,d,e,f,g){var h,i,j,k,m,n,r,t,u,v,B,D,F,G,I,L;try{h=b[a]}catch(M){}if("object"==typeof h&&h)if(i=s.call(h),i!=w||o.call(h,"toJSON"))"function"==typeof h.toJSON&&(i!=x&&i!=y&&i!=z||o.call(h,"toJSON"))&&(h=h.toJSON(a));else if(h>-1/0&&1/0>h){if(E){for(m=C(h/864e5),j=C(m/365.2425)+1970-1;E(j+1,0)<=m;j++);for(k=C((m-E(j,0))/30.42);E(j,k+1)<=m;k++);m=1+m-E(j,k),n=(h%864e5+864e5)%864e5,r=C(n/36e5)%24,t=C(n/6e4)%60,u=C(n/1e3)%60,v=n%1e3}else j=h.getUTCFullYear(),k=h.getUTCMonth(),m=h.getUTCDate(),r=h.getUTCHours(),t=h.getUTCMinutes(),u=h.getUTCSeconds(),v=h.getUTCMilliseconds();h=(0>=j||j>=1e4?(0>j?"-":"+")+H(6,0>j?-j:j):H(4,j))+"-"+H(2,k+1)+"-"+H(2,m)+"T"+H(2,r)+":"+H(2,t)+":"+H(2,u)+"."+H(3,v)+"Z"}else h=null;if(c&&(h=c.call(b,a,h)),null===h)return"null";if(i=s.call(h),i==A)return""+h;if(i==x)return h>-1/0&&1/0>h?""+h:"null";if(i==y)return J(""+h);if("object"==typeof h){for(G=g.length;G--;)if(g[G]===h)throw l();if(g.push(h),B=[],I=f,f+=e,i==z){for(F=0,G=h.length;G>F;F++)D=K(F,h,c,d,e,f,g),B.push(D===q?"null":D);L=B.length?e?"[\n"+f+B.join(",\n"+f)+"\n"+I+"]":"["+B.join(",")+"]":"[]"}else p(d||h,function(a){var b=K(a,h,c,d,e,f,g);b!==q&&B.push(J(a)+":"+(e?" ":"")+b)}),L=B.length?e?"{\n"+f+B.join(",\n"+f)+"\n"+I+"}":"{"+B.join(",")+"}":"{}";return g.pop(),L}};d.stringify=function(a,b,d){var e,f,g,h;if(c[typeof b]&&b)if((h=s.call(b))==v)f=b;else if(h==z){g={};for(var i,j=0,k=b.length;k>j;i=b[j++],h=s.call(i),(h==y||h==x)&&(g[i]=1));}if(d)if((h=s.call(d))==x){if((d-=d%1)>0)for(e="",d>10&&(d=10);e.length<d;e+=" ");}else h==y&&(e=d.length<=10?d:d.slice(0,10));return K("",(i={},i[""]=a,i),f,g,e,"",[])}}if(!f("json-parse")){var L,M,N=h.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw L=M=null,k()},Q=function(){for(var a,b,c,d,e,f=M,g=f.length;g>L;)switch(e=f.charCodeAt(L)){case 9:case 10:case 13:case 32:L++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=B?f.charAt(L):f[L],L++,a;case 34:for(a="@",L++;g>L;)if(e=f.charCodeAt(L),32>e)P();else if(92==e)switch(e=f.charCodeAt(++L)){case 92:case 34:
case 47:case 98:case 116:case 110:case 102:case 114:a+=O[e],L++;break;case 117:for(b=++L,c=L+4;c>L;L++)e=f.charCodeAt(L),e>=48&&57>=e||e>=97&&102>=e||e>=65&&70>=e||P();a+=N("0x"+f.slice(b,L));break;default:P()}else{if(34==e)break;for(e=f.charCodeAt(L),b=L;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++L);a+=f.slice(b,L)}if(34==f.charCodeAt(L))return L++,a;P();default:if(b=L,45==e&&(d=!0,e=f.charCodeAt(++L)),e>=48&&57>=e){for(48==e&&(e=f.charCodeAt(L+1),e>=48&&57>=e)&&P(),d=!1;g>L&&(e=f.charCodeAt(L),e>=48&&57>=e);L++);if(46==f.charCodeAt(L)){for(c=++L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}if(e=f.charCodeAt(L),101==e||69==e){for(e=f.charCodeAt(++L),(43==e||45==e)&&L++,c=L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}return+f.slice(b,L)}if(d&&P(),"true"==f.slice(L,L+4))return L+=4,!0;if("false"==f.slice(L,L+5))return L+=5,!1;if("null"==f.slice(L,L+4))return L+=4,null;P()}return"$"},R=function(a){var b,c;if("$"==a&&P(),"string"==typeof a){if("@"==(B?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];a=Q(),"]"!=a;c||(c=!0))c&&(","==a?(a=Q(),"]"==a&&P()):P()),","==a&&P(),b.push(R(a));return b}if("{"==a){for(b={};a=Q(),"}"!=a;c||(c=!0))c&&(","==a?(a=Q(),"}"==a&&P()):P()),(","==a||"string"!=typeof a||"@"!=(B?a.charAt(0):a[0])||":"!=Q())&&P(),b[a.slice(1)]=R(Q());return b}P()}return a},S=function(a,b,c){var d=T(a,b,c);d===q?delete a[b]:a[b]=d},T=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(s.call(e)==z)for(d=e.length;d--;)S(e,d,c);else p(e,function(a){S(e,a,c)});return c.call(a,b,e)};d.parse=function(a,b){var c,d;return L=0,M=""+a,c=R(Q()),"$"!=Q()&&P(),L=M=null,b&&s.call(b)==v?T((d={},d[""]=c,d),"",b):c}}}return d.runInContext=a,d}var b="function"==typeof define&&define.amd,c={"function":!0,object:!0},d=c[typeof exports]&&exports&&!exports.nodeType&&exports,e=c[typeof window]&&window||this,f=d&&c[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!f||f.global!==f&&f.window!==f&&f.self!==f||(e=f),d&&!b)a(e,d);else{var g=e.JSON,h=e.JSON3,i=!1,j=a(e,e.JSON3={noConflict:function(){return i||(i=!0,e.JSON=g,e.JSON3=h,g=h=null),j}});e.JSON={parse:j.parse,stringify:j.stringify}}b&&define(function(){return j})}.call(this),function(){var a={};a.appendToHead=function(b){a.getHead().appendChild(b)},a.getHead=function(){return document.head||document.getElementsByTagName("head")[0]},a.getBody=function(){return document.body||document.getElementsByTagName("body")[0]},createjs.DomUtils=a}(),function(){var a={};a.parseXML=function(a,b){var c=null;try{if(window.DOMParser){var d=new DOMParser;c=d.parseFromString(a,b)}}catch(e){}if(!c)try{c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)}catch(e){c=null}return c},a.parseJSON=function(a){if(null==a)return null;try{return JSON.parse(a)}catch(b){throw b}},createjs.DataUtils=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.src=null,this.type=null,this.id=null,this.maintainOrder=!1,this.callback=null,this.data=null,this.method=createjs.LoadItem.GET,this.values=null,this.headers=null,this.withCredentials=!1,this.mimeType=null,this.crossOrigin=null,this.loadTimeout=c.LOAD_TIMEOUT_DEFAULT}var b=a.prototype={},c=a;c.LOAD_TIMEOUT_DEFAULT=8e3,c.create=function(b){if("string"==typeof b){var d=new a;return d.src=b,d}if(b instanceof c)return b;if(b instanceof Object&&b.src)return null==b.loadTimeout&&(b.loadTimeout=c.LOAD_TIMEOUT_DEFAULT),b;throw new Error("Type not recognized.")},b.set=function(a){for(var b in a)this[b]=a[b];return this},createjs.LoadItem=c}(),function(){var a={};a.ABSOLUTE_PATT=/^(?:\w+:)?\/{2}/i,a.RELATIVE_PATT=/^[.\/]*?\//i,a.EXTENSION_PATT=/\/?[^\/]+\.(\w{1,5})$/i,a.parseURI=function(b){var c={absolute:!1,relative:!1};if(null==b)return c;var d=b.indexOf("?");d>-1&&(b=b.substr(0,d));var e;return a.ABSOLUTE_PATT.test(b)?c.absolute=!0:a.RELATIVE_PATT.test(b)&&(c.relative=!0),(e=b.match(a.EXTENSION_PATT))&&(c.extension=e[1].toLowerCase()),c},a.formatQueryString=function(a,b){if(null==a)throw new Error("You must specify data.");var c=[];for(var d in a)c.push(d+"="+escape(a[d]));return b&&(c=c.concat(b)),c.join("&")},a.buildPath=function(a,b){if(null==b)return a;var c=[],d=a.indexOf("?");if(-1!=d){var e=a.slice(d+1);c=c.concat(e.split("&"))}return-1!=d?a.slice(0,d)+"?"+this.formatQueryString(b,c):a+"?"+this.formatQueryString(b,c)},a.isCrossDomain=function(a){var b=document.createElement("a");b.href=a.src;var c=document.createElement("a");c.href=location.href;var d=""!=b.hostname&&(b.port!=c.port||b.protocol!=c.protocol||b.hostname!=c.hostname);return d},a.isLocal=function(a){var b=document.createElement("a");return b.href=a.src,""==b.hostname&&"file:"==b.protocol},a.isBinary=function(a){switch(a){case createjs.AbstractLoader.IMAGE:case createjs.AbstractLoader.BINARY:return!0;default:return!1}},a.isImageTag=function(a){return a instanceof HTMLImageElement},a.isAudioTag=function(a){return window.HTMLAudioElement?a instanceof HTMLAudioElement:!1},a.isVideoTag=function(a){return window.HTMLVideoElement?a instanceof HTMLVideoElement:!1},a.isText=function(a){switch(a){case createjs.AbstractLoader.TEXT:case createjs.AbstractLoader.JSON:case createjs.AbstractLoader.MANIFEST:case createjs.AbstractLoader.XML:case createjs.AbstractLoader.CSS:case createjs.AbstractLoader.SVG:case createjs.AbstractLoader.JAVASCRIPT:case createjs.AbstractLoader.SPRITESHEET:return!0;default:return!1}},a.getTypeByExtension=function(a){if(null==a)return createjs.AbstractLoader.TEXT;switch(a.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.AbstractLoader.IMAGE;case"ogg":case"mp3":case"webm":return createjs.AbstractLoader.SOUND;case"mp4":case"webm":case"ts":return createjs.AbstractLoader.VIDEO;case"json":return createjs.AbstractLoader.JSON;case"xml":return createjs.AbstractLoader.XML;case"css":return createjs.AbstractLoader.CSS;case"js":return createjs.AbstractLoader.JAVASCRIPT;case"svg":return createjs.AbstractLoader.SVG;default:return createjs.AbstractLoader.TEXT}},createjs.RequestUtils=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.EventDispatcher_constructor(),this.loaded=!1,this.canceled=!1,this.progress=0,this.type=c,this.resultFormatter=null,a?this._item=createjs.LoadItem.create(a):this._item=null,this._preferXHR=b,this._result=null,this._rawResult=null,this._loadedItems=null,this._tagSrcAttribute=null,this._tag=null}var b=createjs.extend(a,createjs.EventDispatcher),c=a;c.POST="POST",c.GET="GET",c.BINARY="binary",c.CSS="css",c.IMAGE="image",c.JAVASCRIPT="javascript",c.JSON="json",c.JSONP="jsonp",c.MANIFEST="manifest",c.SOUND="sound",c.VIDEO="video",c.SPRITESHEET="spritesheet",c.SVG="svg",c.TEXT="text",c.XML="xml",b.getItem=function(){return this._item},b.getResult=function(a){return a?this._rawResult:this._result},b.getTag=function(){return this._tag},b.setTag=function(a){this._tag=a},b.load=function(){this._createRequest(),this._request.on("complete",this,this),this._request.on("progress",this,this),this._request.on("loadStart",this,this),this._request.on("abort",this,this),this._request.on("timeout",this,this),this._request.on("error",this,this);var a=new createjs.Event("initialize");a.loader=this._request,this.dispatchEvent(a),this._request.load()},b.cancel=function(){this.canceled=!0,this.destroy()},b.destroy=function(){this._request&&(this._request.removeAllEventListeners(),this._request.destroy()),this._request=null,this._item=null,this._rawResult=null,this._result=null,this._loadItems=null,this.removeAllEventListeners()},b.getLoadedItems=function(){return this._loadedItems},b._createRequest=function(){this._preferXHR?this._request=new createjs.XHRRequest(this._item):this._request=new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},b._createTag=function(a){return null},b._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},b._sendProgress=function(a){if(!this._isCanceled()){var b=null;"number"==typeof a?(this.progress=a,b=new createjs.ProgressEvent(this.progress)):(b=a,this.progress=a.loaded/a.total,b.progress=this.progress,(isNaN(this.progress)||this.progress==1/0)&&(this.progress=0)),this.hasEventListener("progress")&&this.dispatchEvent(b)}},b._sendComplete=function(){if(!this._isCanceled()){this.loaded=!0;var a=new createjs.Event("complete");a.rawResult=this._rawResult,null!=this._result&&(a.result=this._result),this.dispatchEvent(a)}},b._sendError=function(a){!this._isCanceled()&&this.hasEventListener("error")&&(null==a&&(a=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY")),this.dispatchEvent(a))},b._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1},b.resultFormatter=null,b.handleEvent=function(a){switch(a.type){case"complete":this._rawResult=a.target._response;var b=this.resultFormatter&&this.resultFormatter(this);b instanceof Function?b.call(this,createjs.proxy(this._resultFormatSuccess,this),createjs.proxy(this._resultFormatFailed,this)):(this._result=b||this._rawResult,this._sendComplete());break;case"progress":this._sendProgress(a);break;case"error":this._sendError(a);break;case"loadstart":this._sendLoadStart();break;case"abort":case"timeout":this._isCanceled()||this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_"+a.type.toUpperCase()+"_ERROR"))}},b._resultFormatSuccess=function(a){this._result=a,this._sendComplete()},b._resultFormatFailed=function(a){this._sendError(a)},b.buildPath=function(a,b){return createjs.RequestUtils.buildPath(a,b)},b.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.AbstractLoader_constructor(a,b,c),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src",this.on("initialize",this._updateXHR,this)}var b=createjs.extend(a,createjs.AbstractLoader);b.load=function(){this._tag||(this._tag=this._createTag(this._item.src)),this._tag.preload="auto",this._tag.load(),this.AbstractLoader_load()},b._createTag=function(){},b._createRequest=function(){this._preferXHR?this._request=new createjs.XHRRequest(this._item):this._request=new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},b._updateXHR=function(a){a.loader.setResponseType&&a.loader.setResponseType("blob")},b._formatResult=function(a){if(this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.onstalled=null,this._preferXHR){var b=window.URL||window.webkitURL,c=a.getResult(!0);a.getTag().src=b.createObjectURL(c)}return a.getTag()},createjs.AbstractMediaLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a){this._item=a},b=createjs.extend(a,createjs.EventDispatcher);b.load=function(){},b.destroy=function(){},b.cancel=function(){},createjs.AbstractRequest=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.AbstractRequest_constructor(a),this._tag=b,this._tagSrcAttribute=c,this._loadedHandler=createjs.proxy(this._handleTagComplete,this),this._addedToDOM=!1,this._startTagVisibility=null}var b=createjs.extend(a,createjs.AbstractRequest);b.load=function(){this._tag.onload=createjs.proxy(this._handleTagComplete,this),this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this),this._tag.onerror=createjs.proxy(this._handleError,this);var a=new createjs.Event("initialize");a.loader=this._tag,this.dispatchEvent(a),this._hideTag(),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout),this._tag[this._tagSrcAttribute]=this._item.src,null==this._tag.parentNode&&(window.document.body.appendChild(this._tag),this._addedToDOM=!0)},b.destroy=function(){this._clean(),this._tag=null,this.AbstractRequest_destroy()},b._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var a=this._tag;("loaded"==a.readyState||"complete"==a.readyState)&&this._handleTagComplete()},b._handleError=function(){this._clean(),this.dispatchEvent("error")},b._handleTagComplete=function(){this._rawResult=this._tag,this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult,this._clean(),this._showTag(),this.dispatchEvent("complete")},b._handleTimeout=function(){this._clean(),this.dispatchEvent(new createjs.Event("timeout"))},b._clean=function(){this._tag.onload=null,this._tag.onreadystatechange=null,this._tag.onerror=null,this._addedToDOM&&null!=this._tag.parentNode&&this._tag.parentNode.removeChild(this._tag),clearTimeout(this._loadTimeout)},b._hideTag=function(){this._startTagVisibility=this._tag.style.visibility,this._tag.style.visibility="hidden"},b._showTag=function(){this._tag.style.visibility=this._startTagVisibility},b._handleStalled=function(){},createjs.TagRequest=createjs.promote(a,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.AbstractRequest_constructor(a),this._tag=b,this._tagSrcAttribute=c,this._loadedHandler=createjs.proxy(this._handleTagComplete,this)}var b=createjs.extend(a,createjs.TagRequest);b.load=function(){var a=createjs.proxy(this._handleStalled,this);this._stalledCallback=a;var b=createjs.proxy(this._handleProgress,this);this._handleProgress=b,this._tag.addEventListener("stalled",a),this._tag.addEventListener("progress",b),this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,!1),this.TagRequest_load()},b._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var a=this._tag;("loaded"==a.readyState||"complete"==a.readyState)&&this._handleTagComplete()},b._handleStalled=function(){},b._handleProgress=function(a){if(a&&!(a.loaded>0&&0==a.total)){var b=new createjs.ProgressEvent(a.loaded,a.total);this.dispatchEvent(b)}},b._clean=function(){this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.removeEventListener("stalled",this._stalledCallback),this._tag.removeEventListener("progress",this._progressCallback),this.TagRequest__clean()},createjs.MediaTagRequest=createjs.promote(a,"TagRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractRequest_constructor(a),this._request=null,this._loadTimeout=null,this._xhrLevel=1,this._response=null,this._rawResponse=null,this._canceled=!1,this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this),this._handleProgressProxy=createjs.proxy(this._handleProgress,this),this._handleAbortProxy=createjs.proxy(this._handleAbort,this),this._handleErrorProxy=createjs.proxy(this._handleError,this),this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this),this._handleLoadProxy=createjs.proxy(this._handleLoad,this),this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this),!this._createXHR(a)}var b=createjs.extend(a,createjs.AbstractRequest);a.ACTIVEX_VERSIONS=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],b.getResult=function(a){return a&&this._rawResponse?this._rawResponse:this._response},b.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},b.load=function(){if(null==this._request)return void this._handleError();null!=this._request.addEventListener?(this._request.addEventListener("loadstart",this._handleLoadStartProxy,!1),this._request.addEventListener("progress",this._handleProgressProxy,!1),this._request.addEventListener("abort",this._handleAbortProxy,!1),this._request.addEventListener("error",this._handleErrorProxy,!1),this._request.addEventListener("timeout",this._handleTimeoutProxy,!1),this._request.addEventListener("load",this._handleLoadProxy,!1),this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,!1)):(this._request.onloadstart=this._handleLoadStartProxy,this._request.onprogress=this._handleProgressProxy,this._request.onabort=this._handleAbortProxy,this._request.onerror=this._handleErrorProxy,this._request.ontimeout=this._handleTimeoutProxy,this._request.onload=this._handleLoadProxy,this._request.onreadystatechange=this._handleReadyStateChangeProxy),1==this._xhrLevel&&(this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout));try{this._item.values&&this._item.method!=createjs.AbstractLoader.GET?this._item.method==createjs.AbstractLoader.POST&&this._request.send(createjs.RequestUtils.formatQueryString(this._item.values)):this._request.send()}catch(a){this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,a))}},b.setResponseType=function(a){"blob"===a&&(a=window.URL?"blob":"arraybuffer",this._responseType=a),this._request.responseType=a},b.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},b.getResponseHeader=function(a){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(a):null},b._handleProgress=function(a){if(a&&!(a.loaded>0&&0==a.total)){var b=new createjs.ProgressEvent(a.loaded,a.total);this.dispatchEvent(b)}},b._handleLoadStart=function(a){clearTimeout(this._loadTimeout),this.dispatchEvent("loadstart")},b._handleAbort=function(a){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,a))},b._handleError=function(a){this._clean(),this.dispatchEvent(new createjs.ErrorEvent(a.message))},b._handleReadyStateChange=function(a){4==this._request.readyState&&this._handleLoad()},b._handleLoad=function(a){if(!this.loaded){this.loaded=!0;var b=this._checkError();if(b)return void this._handleError(b);if(this._response=this._getResponse(),"arraybuffer"===this._responseType)try{this._response=new Blob([this._response])}catch(c){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"===c.name&&window.BlobBuilder){var d=new BlobBuilder;d.append(this._response),this._response=d.getBlob()}}this._clean(),this.dispatchEvent(new createjs.Event("complete"))}},b._handleTimeout=function(a){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,a))},b._checkError=function(){var a=parseInt(this._request.status);switch(a){case 404:case 0:return new Error(a)}return null},b._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(a){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(a){}return null},b._createXHR=function(a){var b=createjs.RequestUtils.isCrossDomain(a),c={},d=null;if(window.XMLHttpRequest)d=new XMLHttpRequest,b&&void 0===d.withCredentials&&window.XDomainRequest&&(d=new XDomainRequest);else{for(var e=0,f=s.ACTIVEX_VERSIONS.length;f>e;e++){var g=s.ACTIVEX_VERSIONS[e];try{d=new ActiveXObject(g);break}catch(h){}}if(null==d)return!1}null==a.mimeType&&createjs.RequestUtils.isText(a.type)&&(a.mimeType="text/plain; charset=utf-8"),a.mimeType&&d.overrideMimeType&&d.overrideMimeType(a.mimeType),this._xhrLevel="string"==typeof d.responseType?2:1;var i=null;if(i=a.method==createjs.AbstractLoader.GET?createjs.RequestUtils.buildPath(a.src,a.values):a.src,d.open(a.method||createjs.AbstractLoader.GET,i,!0),b&&d instanceof XMLHttpRequest&&1==this._xhrLevel&&(c.Origin=location.origin),a.values&&a.method==createjs.AbstractLoader.POST&&(c["Content-Type"]="application/x-www-form-urlencoded"),b||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest"),a.headers)for(var j in a.headers)c[j]=a.headers[j];for(j in c)d.setRequestHeader(j,c[j]);return d instanceof XMLHttpRequest&&void 0!==a.withCredentials&&(d.withCredentials=a.withCredentials),this._request=d,!0},b._clean=function(){clearTimeout(this._loadTimeout),null!=this._request.removeEventListener?(this._request.removeEventListener("loadstart",this._handleLoadStartProxy),this._request.removeEventListener("progress",this._handleProgressProxy),this._request.removeEventListener("abort",this._handleAbortProxy),this._request.removeEventListener("error",this._handleErrorProxy),this._request.removeEventListener("timeout",this._handleTimeoutProxy),this._request.removeEventListener("load",this._handleLoadProxy),this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy)):(this._request.onloadstart=null,this._request.onprogress=null,this._request.onabort=null,this._request.onerror=null,this._request.ontimeout=null,this._request.onload=null,this._request.onreadystatechange=null)},b.toString=function(){return"[PreloadJS XHRRequest]"},createjs.XHRRequest=createjs.promote(a,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.AbstractLoader_constructor(),this._plugins=[],this._typeCallbacks={},this._extensionCallbacks={},this.next=null,this.maintainScriptOrder=!0,this.stopOnError=!1,this._maxConnections=1,this._availableLoaders=[createjs.ImageLoader,createjs.JavaScriptLoader,createjs.CSSLoader,createjs.JSONLoader,createjs.JSONPLoader,createjs.SoundLoader,createjs.ManifestLoader,createjs.SpriteSheetLoader,createjs.XMLLoader,createjs.SVGLoader,createjs.BinaryLoader,createjs.VideoLoader,createjs.TextLoader],this._defaultLoaderLength=this._availableLoaders.length,this.init(a,b,c)}var b=createjs.extend(a,createjs.AbstractLoader),c=a;b.init=function(a,b,c){this.useXHR=!0,this.preferXHR=!0,this._preferXHR=!0,this.setPreferXHR(a),this._paused=!1,this._basePath=b,this._crossOrigin=c,this._loadStartWasDispatched=!1,this._currentlyLoadingScript=null,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._numItems=0,this._numItemsLoaded=0,this._scriptOrder=[],this._loadedScripts=[],this._lastProgress=NaN},c.loadTimeout=8e3,c.LOAD_TIMEOUT=0,c.BINARY=createjs.AbstractLoader.BINARY,c.CSS=createjs.AbstractLoader.CSS,c.IMAGE=createjs.AbstractLoader.IMAGE,c.JAVASCRIPT=createjs.AbstractLoader.JAVASCRIPT,c.JSON=createjs.AbstractLoader.JSON,c.JSONP=createjs.AbstractLoader.JSONP,c.MANIFEST=createjs.AbstractLoader.MANIFEST,c.SOUND=createjs.AbstractLoader.SOUND,c.VIDEO=createjs.AbstractLoader.VIDEO,c.SVG=createjs.AbstractLoader.SVG,c.TEXT=createjs.AbstractLoader.TEXT,c.XML=createjs.AbstractLoader.XML,c.POST=createjs.AbstractLoader.POST,c.GET=createjs.AbstractLoader.GET,b.registerLoader=function(a){if(!a||!a.canLoadItem)throw new Error("loader is of an incorrect type.");if(-1!=this._availableLoaders.indexOf(a))throw new Error("loader already exists.");this._availableLoaders.unshift(a)},b.unregisterLoader=function(a){var b=this._availableLoaders.indexOf(a);-1!=b&&b<this._defaultLoaderLength-1&&this._availableLoaders.splice(b,1)},b.setUseXHR=function(a){return this.setPreferXHR(a)},b.setPreferXHR=function(a){return this.preferXHR=0!=a&&null!=window.XMLHttpRequest,this.preferXHR},b.removeAll=function(){this.remove()},b.remove=function(a){var b=null;if(a&&!Array.isArray(a))b=[a];else if(a)b=a;else if(arguments.length>0)return;var c=!1;if(b){for(;b.length;){var d=b.pop(),e=this.getResult(d);for(f=this._loadQueue.length-1;f>=0;f--)if(g=this._loadQueue[f].getItem(),g.id==d||g.src==d){this._loadQueue.splice(f,1)[0].cancel();break}for(f=this._loadQueueBackup.length-1;f>=0;f--)if(g=this._loadQueueBackup[f].getItem(),g.id==d||g.src==d){this._loadQueueBackup.splice(f,1)[0].cancel();break}if(e)this._disposeItem(this.getItem(d));else for(var f=this._currentLoads.length-1;f>=0;f--){var g=this._currentLoads[f].getItem();if(g.id==d||g.src==d){this._currentLoads.splice(f,1)[0].cancel(),c=!0;break}}}c&&this._loadNext()}else{this.close();for(var h in this._loadItemsById)this._disposeItem(this._loadItemsById[h]);this.init(this.preferXHR,this._basePath)}},b.reset=function(){this.close();for(var a in this._loadItemsById)this._disposeItem(this._loadItemsById[a]);for(var b=[],c=0,d=this._loadQueueBackup.length;d>c;c++)b.push(this._loadQueueBackup[c].getItem());this.loadManifest(b,!1)},b.installPlugin=function(a){if(null!=a&&null!=a.getPreloadHandlers){this._plugins.push(a);var b=a.getPreloadHandlers();if(b.scope=a,null!=b.types)for(var c=0,d=b.types.length;d>c;c++)this._typeCallbacks[b.types[c]]=b;if(null!=b.extensions)for(c=0,d=b.extensions.length;d>c;c++)this._extensionCallbacks[b.extensions[c]]=b}},b.setMaxConnections=function(a){this._maxConnections=a,!this._paused&&this._loadQueue.length>0&&this._loadNext()},b.loadFile=function(a,b,c){if(null==a){var d=new createjs.ErrorEvent("PRELOAD_NO_FILE");return void this._sendError(d)}this._addItem(a,null,c),b!==!1?this.setPaused(!1):this.setPaused(!0)},b.loadManifest=function(a,b,d){var e=null,f=null;if(Array.isArray(a)){if(0==a.length){var g=new createjs.ErrorEvent("PRELOAD_MANIFEST_EMPTY");return void this._sendError(g)}e=a}else if("string"==typeof a)e=[{src:a,type:c.MANIFEST}];else{if("object"!=typeof a){var g=new createjs.ErrorEvent("PRELOAD_MANIFEST_NULL");return void this._sendError(g)}if(void 0!==a.src){if(null==a.type)a.type=c.MANIFEST;else if(a.type!=c.MANIFEST){var g=new createjs.ErrorEvent("PRELOAD_MANIFEST_TYPE");this._sendError(g)}e=[a]}else void 0!==a.manifest&&(e=a.manifest,f=a.path)}for(var h=0,i=e.length;i>h;h++)this._addItem(e[h],f,d);b!==!1?this.setPaused(!1):this.setPaused(!0)},b.load=function(){this.setPaused(!1)},b.getItem=function(a){return this._loadItemsById[a]||this._loadItemsBySrc[a]},b.getResult=function(a,b){var c=this._loadItemsById[a]||this._loadItemsBySrc[a];if(null==c)return null;var d=c.id;return b&&this._loadedRawResults[d]?this._loadedRawResults[d]:this._loadedResults[d]},b.getItems=function(a){var b=[];for(var c in this._loadItemsById){var d=this._loadItemsById[c],e=this.getResult(c);(a!==!0||null!=e)&&b.push({item:d,result:e,rawResult:this.getResult(c,!0)})}return b},b.setPaused=function(a){this._paused=a,this._paused||this._loadNext()},b.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1,this._itemCount=0,this._lastProgress=NaN},b._addItem=function(a,b,c){var d=this._createLoadItem(a,b,c);if(null!=d){var e=this._createLoader(d);null!=e&&("plugins"in e&&(e.plugins=this._plugins),d._loader=e,this._loadQueue.push(e),this._loadQueueBackup.push(e),this._numItems++,this._updateProgress(),(this.maintainScriptOrder&&d.type==createjs.LoadQueue.JAVASCRIPT||d.maintainOrder===!0)&&(this._scriptOrder.push(d),this._loadedScripts.push(null)))}},b._createLoadItem=function(a,b,c){var d=createjs.LoadItem.create(a);if(null==d)return null;var e="",f=c||this._basePath;if(d.src instanceof Object){if(!d.type)return null;if(b){e=b;var g=createjs.RequestUtils.parseURI(b);null==f||g.absolute||g.relative||(e=f+e)}else null!=f&&(e=f)}else{var h=createjs.RequestUtils.parseURI(d.src);h.extension&&(d.ext=h.extension),null==d.type&&(d.type=createjs.RequestUtils.getTypeByExtension(d.ext));var i=d.src;if(!h.absolute&&!h.relative)if(b){e=b;var g=createjs.RequestUtils.parseURI(b);i=b+i,null==f||g.absolute||g.relative||(e=f+e)}else null!=f&&(e=f);d.src=e+d.src}d.path=e,(void 0===d.id||null===d.id||""===d.id)&&(d.id=i);var j=this._typeCallbacks[d.type]||this._extensionCallbacks[d.ext];if(j){var k=j.callback.call(j.scope,d,this);if(k===!1)return null;k===!0||null!=k&&(d._loader=k),h=createjs.RequestUtils.parseURI(d.src),null!=h.extension&&(d.ext=h.extension)}return this._loadItemsById[d.id]=d,this._loadItemsBySrc[d.src]=d,null==d.crossOrigin&&(d.crossOrigin=this._crossOrigin),d},b._createLoader=function(a){if(null!=a._loader)return a._loader;for(var b=this.preferXHR,c=0;c<this._availableLoaders.length;c++){var d=this._availableLoaders[c];if(d&&d.canLoadItem(a))return new d(a,b)}return null},b._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded?(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load()):this.loaded=!1;for(var a=0;a<this._loadQueue.length&&!(this._currentLoads.length>=this._maxConnections);a++){var b=this._loadQueue[a];this._canStartLoad(b)&&(this._loadQueue.splice(a,1),a--,this._loadItem(b))}}},b._loadItem=function(a){a.on("fileload",this._handleFileLoad,this),a.on("progress",this._handleProgress,this),a.on("complete",this._handleFileComplete,this),a.on("error",this._handleError,this),a.on("fileerror",this._handleFileError,this),this._currentLoads.push(a),this._sendFileStart(a.getItem()),a.load()},b._handleFileLoad=function(a){a.target=null,this.dispatchEvent(a)},b._handleFileError=function(a){var b=new createjs.ErrorEvent("FILE_LOAD_ERROR",null,a.item);this._sendError(b)},b._handleError=function(a){var b=a.target;this._numItemsLoaded++,this._finishOrderedItem(b,!0),this._updateProgress();var c=new createjs.ErrorEvent("FILE_LOAD_ERROR",null,b.getItem());this._sendError(c),this.stopOnError?this.setPaused(!0):(this._removeLoadItem(b),this._cleanLoadItem(b),this._loadNext())},b._handleFileComplete=function(a){var b=a.target,c=b.getItem(),d=b.getResult();this._loadedResults[c.id]=d;var e=b.getResult(!0);null!=e&&e!==d&&(this._loadedRawResults[c.id]=e),this._saveLoadedItems(b),this._removeLoadItem(b),this._finishOrderedItem(b)||this._processFinishedLoad(c,b),this._cleanLoadItem(b)},b._saveLoadedItems=function(a){var b=a.getLoadedItems();if(null!==b)for(var c=0;c<b.length;c++){var d=b[c].item;this._loadItemsBySrc[d.src]=d,this._loadItemsById[d.id]=d,this._loadedResults[d.id]=b[c].result,this._loadedRawResults[d.id]=b[c].rawResult}},b._finishOrderedItem=function(a,b){var c=a.getItem();if(this.maintainScriptOrder&&c.type==createjs.LoadQueue.JAVASCRIPT||c.maintainOrder){a instanceof createjs.JavaScriptLoader&&(this._currentlyLoadingScript=!1);var d=createjs.indexOf(this._scriptOrder,c);return-1==d?!1:(this._loadedScripts[d]=b===!0?!0:c,this._checkScriptLoadOrder(),!0)}return!1},b._checkScriptLoadOrder=function(){for(var a=this._loadedScripts.length,b=0;a>b;b++){var c=this._loadedScripts[b];if(null===c)break;if(c!==!0){var d=this._loadedResults[c.id];c.type==createjs.LoadQueue.JAVASCRIPT&&createjs.DomUtils.appendToHead(d);var e=c._loader;this._processFinishedLoad(c,e),this._loadedScripts[b]=!0}}},b._processFinishedLoad=function(a,b){if(this._numItemsLoaded++,!this.maintainScriptOrder&&a.type==createjs.LoadQueue.JAVASCRIPT){var c=b.getTag();createjs.DomUtils.appendToHead(c)}this._updateProgress(),this._sendFileComplete(a,b),this._loadNext()},b._canStartLoad=function(a){if(!this.maintainScriptOrder||a.preferXHR)return!0;var b=a.getItem();if(b.type!=createjs.LoadQueue.JAVASCRIPT)return!0;if(this._currentlyLoadingScript)return!1;for(var c=this._scriptOrder.indexOf(b),d=0;c>d;){var e=this._loadedScripts[d];if(null==e)return!1;d++}return this._currentlyLoadingScript=!0,!0},b._removeLoadItem=function(a){for(var b=this._currentLoads.length,c=0;b>c;c++)if(this._currentLoads[c]==a){this._currentLoads.splice(c,1);break}},b._cleanLoadItem=function(a){var b=a.getItem();b&&delete b._loader},b._handleProgress=function(a){var b=a.target;this._sendFileProgress(b.getItem(),b.progress),this._updateProgress()},b._updateProgress=function(){var a=this._numItemsLoaded/this._numItems,b=this._numItems-this._numItemsLoaded;if(b>0){for(var c=0,d=0,e=this._currentLoads.length;e>d;d++)c+=this._currentLoads[d].progress;a+=c/b*(b/this._numItems)}this._lastProgress!=a&&(this._sendProgress(a),this._lastProgress=a)},b._disposeItem=function(a){delete this._loadedResults[a.id],delete this._loadedRawResults[a.id],delete this._loadItemsById[a.id],delete this._loadItemsBySrc[a.src]},b._sendFileProgress=function(a,b){if(!this._isCanceled()&&!this._paused&&this.hasEventListener("fileprogress")){var c=new createjs.Event("fileprogress");c.progress=b,c.loaded=b,c.total=1,c.item=a,this.dispatchEvent(c)}},b._sendFileComplete=function(a,b){
if(!this._isCanceled()&&!this._paused){var c=new createjs.Event("fileload");c.loader=b,c.item=a,c.result=this._loadedResults[a.id],c.rawResult=this._loadedRawResults[a.id],a.completeHandler&&a.completeHandler(c),this.hasEventListener("fileload")&&this.dispatchEvent(c)}},b._sendFileStart=function(a){var b=new createjs.Event("filestart");b.item=a,this.hasEventListener("filestart")&&this.dispatchEvent(b)},b.toString=function(){return"[PreloadJS LoadQueue]"},createjs.LoadQueue=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.TEXT)}var b=(createjs.extend(a,createjs.AbstractLoader),a);b.canLoadItem=function(a){return a.type==createjs.AbstractLoader.TEXT},createjs.TextLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.BINARY),this.on("initialize",this._updateXHR,this)}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.BINARY},b._updateXHR=function(a){a.loader.setResponseType("arraybuffer")},createjs.BinaryLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.CSS),this.resultFormatter=this._formatResult,this._tagSrcAttribute="href",b?this._tag=document.createElement("style"):this._tag=document.createElement("link"),this._tag.rel="stylesheet",this._tag.type="text/css"}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.CSS},b._formatResult=function(a){if(this._preferXHR){var b=a.getTag();if(b.styleSheet)b.styleSheet.cssText=a.getResult(!0);else{var c=document.createTextNode(a.getResult(!0));b.appendChild(c)}}else b=this._tag;return createjs.DomUtils.appendToHead(b),b},createjs.CSSLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.IMAGE),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src",createjs.RequestUtils.isImageTag(a)?this._tag=a:createjs.RequestUtils.isImageTag(a.src)?this._tag=a.src:createjs.RequestUtils.isImageTag(a.tag)&&(this._tag=a.tag),null!=this._tag?this._preferXHR=!1:this._tag=document.createElement("img"),this.on("initialize",this._updateXHR,this)}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.IMAGE},b.load=function(){if(""!=this._tag.src&&this._tag.complete)return void this._sendComplete();var a=this._item.crossOrigin;1==a&&(a="Anonymous"),null==a||createjs.RequestUtils.isLocal(this._item.src)||(this._tag.crossOrigin=a),this.AbstractLoader_load()},b._updateXHR=function(a){a.loader.mimeType="text/plain; charset=x-user-defined-binary",a.loader.setResponseType&&a.loader.setResponseType("blob")},b._formatResult=function(a){return this._formatImage},b._formatImage=function(a,b){var c=this._tag,d=window.URL||window.webkitURL;if(this._preferXHR)if(d){var e=d.createObjectURL(this.getResult(!0));c.src=e,c.addEventListener("load",this._cleanUpURL,!1),c.addEventListener("error",this._cleanUpURL,!1)}else c.src=this._item.src;else;c.complete?a(c):(c.onload=createjs.proxy(function(){a(this._tag)},this),c.onerror=createjs.proxy(function(){b(_this._tag)},this))},b._cleanUpURL=function(a){var b=window.URL||window.webkitURL;b.revokeObjectURL(a.target.src)},createjs.ImageLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.JAVASCRIPT),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src",this.setTag(document.createElement("script"))}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.JAVASCRIPT},b._formatResult=function(a){var b=a.getTag();return this._preferXHR&&(b.text=a.getResult(!0)),b},createjs.JavaScriptLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.JSON),this.resultFormatter=this._formatResult}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.JSON},b._formatResult=function(a){var b=null;try{b=createjs.DataUtils.parseJSON(a.getResult(!0))}catch(c){var d=new createjs.ErrorEvent("JSON_FORMAT",null,c);return this._sendError(d),c}return b},createjs.JSONLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!1,createjs.AbstractLoader.JSONP),this.setTag(document.createElement("script")),this.getTag().type="text/javascript"}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.JSONP},b.cancel=function(){this.AbstractLoader_cancel(),this._dispose()},b.load=function(){if(null==this._item.callback)throw new Error("callback is required for loading JSONP requests.");if(null!=window[this._item.callback])throw new Error("JSONP callback '"+this._item.callback+"' already exists on window. You need to specify a different callback or re-name the current one.");window[this._item.callback]=createjs.proxy(this._handleLoad,this),window.document.body.appendChild(this._tag),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout),this._tag.src=this._item.src},b._handleLoad=function(a){this._result=this._rawResult=a,this._sendComplete(),this._dispose()},b._handleTimeout=function(){this._dispose(),this.dispatchEvent(new createjs.ErrorEvent("timeout"))},b._dispose=function(){window.document.body.removeChild(this._tag),delete window[this._item.callback],clearTimeout(this._loadTimeout)},createjs.JSONPLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,null,createjs.AbstractLoader.MANIFEST),this.plugins=null,this._manifestQueue=null}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.MANIFEST_PROGRESS=.25,c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.MANIFEST},b.load=function(){this.AbstractLoader_load()},b._createRequest=function(){var a=this._item.callback;null!=a?this._request=new createjs.JSONPLoader(this._item):this._request=new createjs.JSONLoader(this._item)},b.handleEvent=function(a){switch(a.type){case"complete":return this._rawResult=a.target.getResult(!0),this._result=a.target.getResult(),this._sendProgress(c.MANIFEST_PROGRESS),void this._loadManifest(this._result);case"progress":return a.loaded*=c.MANIFEST_PROGRESS,this.progress=a.loaded/a.total,(isNaN(this.progress)||this.progress==1/0)&&(this.progress=0),void this._sendProgress(a)}this.AbstractLoader_handleEvent(a)},b.destroy=function(){this.AbstractLoader_destroy(),this._manifestQueue.close()},b._loadManifest=function(a){if(a&&a.manifest){var b=this._manifestQueue=new createjs.LoadQueue;b.on("fileload",this._handleManifestFileLoad,this),b.on("progress",this._handleManifestProgress,this),b.on("complete",this._handleManifestComplete,this,!0),b.on("error",this._handleManifestError,this,!0);for(var c=0,d=this.plugins.length;d>c;c++)b.installPlugin(this.plugins[c]);b.loadManifest(a)}else this._sendComplete()},b._handleManifestFileLoad=function(a){a.target=null,this.dispatchEvent(a)},b._handleManifestComplete=function(a){this._loadedItems=this._manifestQueue.getItems(!0),this._sendComplete()},b._handleManifestProgress=function(a){this.progress=a.progress*(1-c.MANIFEST_PROGRESS)+c.MANIFEST_PROGRESS,this._sendProgress(this.progress)},b._handleManifestError=function(a){var b=new createjs.Event("fileerror");b.item=a.data,this.dispatchEvent(b)},createjs.ManifestLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractMediaLoader_constructor(a,b,createjs.AbstractLoader.SOUND),createjs.RequestUtils.isAudioTag(a)?this._tag=a:createjs.RequestUtils.isAudioTag(a.src)?this._tag=a:createjs.RequestUtils.isAudioTag(a.tag)&&(this._tag=createjs.RequestUtils.isAudioTag(a)?a:a.src),null!=this._tag&&(this._preferXHR=!1)}var b=createjs.extend(a,createjs.AbstractMediaLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.SOUND},b._createTag=function(a){var b=document.createElement("audio");return b.autoplay=!1,b.preload="none",b.src=a,b},createjs.SoundLoader=createjs.promote(a,"AbstractMediaLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractMediaLoader_constructor(a,b,createjs.AbstractLoader.VIDEO),createjs.RequestUtils.isVideoTag(a)||createjs.RequestUtils.isVideoTag(a.src)?(this.setTag(createjs.RequestUtils.isVideoTag(a)?a:a.src),this._preferXHR=!1):this.setTag(this._createTag())}var b=createjs.extend(a,createjs.AbstractMediaLoader),c=a;b._createTag=function(){return document.createElement("video")},c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.VIDEO},createjs.VideoLoader=createjs.promote(a,"AbstractMediaLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.SPRITESHEET),this._manifestQueue=null}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.SPRITESHEET_PROGRESS=.25,c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.SPRITESHEET},b.destroy=function(){this.AbstractLoader_destroy,this._manifestQueue.close()},b._createRequest=function(){var a=this._item.callback;null!=a?this._request=new createjs.JSONPLoader(this._item):this._request=new createjs.JSONLoader(this._item)},b.handleEvent=function(a){switch(a.type){case"complete":return this._rawResult=a.target.getResult(!0),this._result=a.target.getResult(),this._sendProgress(c.SPRITESHEET_PROGRESS),void this._loadManifest(this._result);case"progress":return a.loaded*=c.SPRITESHEET_PROGRESS,this.progress=a.loaded/a.total,(isNaN(this.progress)||this.progress==1/0)&&(this.progress=0),void this._sendProgress(a)}this.AbstractLoader_handleEvent(a)},b._loadManifest=function(a){if(a&&a.images){var b=this._manifestQueue=new createjs.LoadQueue(this._preferXHR,this._item.path,this._item.crossOrigin);b.on("complete",this._handleManifestComplete,this,!0),b.on("fileload",this._handleManifestFileLoad,this),b.on("progress",this._handleManifestProgress,this),b.on("error",this._handleManifestError,this,!0),b.loadManifest(a.images)}},b._handleManifestFileLoad=function(a){var b=a.result;if(null!=b){var c=this.getResult().images,d=c.indexOf(a.item.src);c[d]=b}},b._handleManifestComplete=function(a){this._result=new createjs.SpriteSheet(this._result),this._loadedItems=this._manifestQueue.getItems(!0),this._sendComplete()},b._handleManifestProgress=function(a){this.progress=a.progress*(1-c.SPRITESHEET_PROGRESS)+c.SPRITESHEET_PROGRESS,this._sendProgress(this.progress)},b._handleManifestError=function(a){var b=new createjs.Event("fileerror");b.item=a.data,this.dispatchEvent(b)},createjs.SpriteSheetLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b){this.AbstractLoader_constructor(a,b,createjs.AbstractLoader.SVG),this.resultFormatter=this._formatResult,this._tagSrcAttribute="data",b?this.setTag(document.createElement("svg")):(this.setTag(document.createElement("object")),this.getTag().type="image/svg+xml")}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.SVG},b._formatResult=function(a){var b=createjs.DataUtils.parseXML(a.getResult(!0),"text/xml"),c=a.getTag();return!this._preferXHR&&document.body.contains(c)&&document.body.removeChild(c),null!=b.documentElement?(c.appendChild(b.documentElement),c.style.visibility="visible",c):b},createjs.SVGLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.XML),this.resultFormatter=this._formatResult}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.canLoadItem=function(a){return a.type==createjs.AbstractLoader.XML},b._formatResult=function(a){return createjs.DataUtils.parseXML(a.getResult(!0),"text/xml")},createjs.XMLLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){var a=createjs.SoundJS=createjs.SoundJS||{};a.version="0.6.2",a.buildDate="Thu, 26 Nov 2015 20:44:31 GMT"}(),this.createjs=this.createjs||{},createjs.indexOf=function(a,b){"use strict";for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1},this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}}}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"BrowserDetect cannot be instantiated"}var b=a.agent=window.navigator.userAgent;a.isWindowPhone=b.indexOf("IEMobile")>-1||b.indexOf("Windows Phone")>-1,a.isFirefox=b.indexOf("Firefox")>-1,a.isOpera=null!=window.opera,a.isChrome=b.indexOf("Chrome")>-1,a.isIOS=(b.indexOf("iPod")>-1||b.indexOf("iPhone")>-1||b.indexOf("iPad")>-1)&&!a.isWindowPhone,a.isAndroid=b.indexOf("Android")>-1&&!a.isWindowPhone,a.isBlackberry=b.indexOf("Blackberry")>-1,createjs.BrowserDetect=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){this.interrupt=null,this.delay=null,this.offset=null,this.loop=null,this.volume=null,this.pan=null,this.startTime=null,this.duration=null},b=a.prototype={},c=a;c.create=function(a){if(a instanceof c||a instanceof Object){var b=new createjs.PlayPropsConfig;return b.set(a),b}throw new Error("Type not recognized.")},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.toString=function(){return"[PlayPropsConfig]"},createjs.PlayPropsConfig=c}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Sound cannot be instantiated"}function b(a,b){this.init(a,b)}var c=a;c.INTERRUPT_ANY="any",c.INTERRUPT_EARLY="early",c.INTERRUPT_LATE="late",c.INTERRUPT_NONE="none",c.PLAY_INITED="playInited",c.PLAY_SUCCEEDED="playSucceeded",c.PLAY_INTERRUPTED="playInterrupted",c.PLAY_FINISHED="playFinished",c.PLAY_FAILED="playFailed",c.SUPPORTED_EXTENSIONS=["mp3","ogg","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"],c.EXTENSION_MAP={m4a:"mp4"},c.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([\/.]*?(?:[^?]+)?\/)?((?:[^\/?]+)\.(\w+))(?:\?(\S+)?)?$/,c.defaultInterruptBehavior=c.INTERRUPT_NONE,c.alternateExtensions=[],c.activePlugin=null,c._masterVolume=1,Object.defineProperty(c,"volume",{get:function(){return this._masterVolume},set:function(a){if(null==Number(a))return!1;if(a=Math.max(0,Math.min(1,a)),c._masterVolume=a,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(a))for(var b=this._instances,d=0,e=b.length;e>d;d++)b[d].setMasterVolume(a)}}),c._masterMute=!1,Object.defineProperty(c,"muted",{get:function(){return this._masterMute},set:function(a){if(null==a)return!1;if(this._masterMute=a,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(a))for(var b=this._instances,c=0,d=b.length;d>c;c++)b[c].setMasterMute(a);return!0}}),Object.defineProperty(c,"capabilities",{get:function(){return null==c.activePlugin?null:c.activePlugin._capabilities},set:function(a){return!1}}),c._pluginsRegistered=!1,c._lastID=0,c._instances=[],c._idHash={},c._preloadHash={},c._defaultPlayPropsHash={},c.addEventListener=null,c.removeEventListener=null,c.removeAllEventListeners=null,c.dispatchEvent=null,c.hasEventListener=null,c._listeners=null,createjs.EventDispatcher.initialize(c),c.getPreloadHandlers=function(){return{callback:createjs.proxy(c.initLoad,c),types:["sound"],extensions:c.SUPPORTED_EXTENSIONS}},c._handleLoadComplete=function(a){var b=a.target.getItem().src;if(c._preloadHash[b])for(var d=0,e=c._preloadHash[b].length;e>d;d++){var f=c._preloadHash[b][d];if(c._preloadHash[b][d]=!0,c.hasEventListener("fileload")){var a=new createjs.Event("fileload");a.src=f.src,a.id=f.id,a.data=f.data,a.sprite=f.sprite,c.dispatchEvent(a)}}},c._handleLoadError=function(a){var b=a.target.getItem().src;if(c._preloadHash[b])for(var d=0,e=c._preloadHash[b].length;e>d;d++){var f=c._preloadHash[b][d];if(c._preloadHash[b][d]=!1,c.hasEventListener("fileerror")){var a=new createjs.Event("fileerror");a.src=f.src,a.id=f.id,a.data=f.data,a.sprite=f.sprite,c.dispatchEvent(a)}}},c._registerPlugin=function(a){return a.isSupported()?(c.activePlugin=new a,!0):!1},c.registerPlugins=function(a){c._pluginsRegistered=!0;for(var b=0,d=a.length;d>b;b++)if(c._registerPlugin(a[b]))return!0;return!1},c.initializeDefaultPlugins=function(){return null!=c.activePlugin?!0:c._pluginsRegistered?!1:c.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])?!0:!1},c.isReady=function(){return null!=c.activePlugin},c.getCapabilities=function(){return null==c.activePlugin?null:c.activePlugin._capabilities},c.getCapability=function(a){return null==c.activePlugin?null:c.activePlugin._capabilities[a]},c.initLoad=function(a){return c._registerSound(a)},c._registerSound=function(a){if(!c.initializeDefaultPlugins())return!1;var d;if(a.src instanceof Object?(d=c._parseSrc(a.src),d.src=a.path+d.src):d=c._parsePath(a.src),null==d)return!1;a.src=d.src,a.type="sound";var e=a.data,f=null;if(null!=e&&(isNaN(e.channels)?isNaN(e)||(f=parseInt(e)):f=parseInt(e.channels),e.audioSprite))for(var g,h=e.audioSprite.length;h--;)g=e.audioSprite[h],c._idHash[g.id]={src:a.src,startTime:parseInt(g.startTime),duration:parseInt(g.duration)},g.defaultPlayProps&&(c._defaultPlayPropsHash[g.id]=createjs.PlayPropsConfig.create(g.defaultPlayProps));null!=a.id&&(c._idHash[a.id]={src:a.src});var i=c.activePlugin.register(a);return b.create(a.src,f),null!=e&&isNaN(e)?a.data.channels=f||b.maxPerChannel():a.data=f||b.maxPerChannel(),i.type&&(a.type=i.type),a.defaultPlayProps&&(c._defaultPlayPropsHash[a.src]=createjs.PlayPropsConfig.create(a.defaultPlayProps)),i},c.registerSound=function(a,b,d,e,f){var g={src:a,id:b,data:d,defaultPlayProps:f};a instanceof Object&&a.src&&(e=b,g=a),g=createjs.LoadItem.create(g),g.path=e,null==e||g.src instanceof Object||(g.src=e+a);var h=c._registerSound(g);if(!h)return!1;if(c._preloadHash[g.src]||(c._preloadHash[g.src]=[]),c._preloadHash[g.src].push(g),1==c._preloadHash[g.src].length)h.on("complete",createjs.proxy(this._handleLoadComplete,this)),h.on("error",createjs.proxy(this._handleLoadError,this)),c.activePlugin.preload(h);else if(1==c._preloadHash[g.src][0])return!0;return g},c.registerSounds=function(a,b){var c=[];a.path&&(b?b+=a.path:b=a.path,a=a.manifest);for(var d=0,e=a.length;e>d;d++)c[d]=createjs.Sound.registerSound(a[d].src,a[d].id,a[d].data,b,a[d].defaultPlayProps);return c},c.removeSound=function(a,d){if(null==c.activePlugin)return!1;a instanceof Object&&a.src&&(a=a.src);var e;if(a instanceof Object?e=c._parseSrc(a):(a=c._getSrcById(a).src,e=c._parsePath(a)),null==e)return!1;a=e.src,null!=d&&(a=d+a);for(var f in c._idHash)c._idHash[f].src==a&&delete c._idHash[f];return b.removeSrc(a),delete c._preloadHash[a],c.activePlugin.removeSound(a),!0},c.removeSounds=function(a,b){var c=[];a.path&&(b?b+=a.path:b=a.path,a=a.manifest);for(var d=0,e=a.length;e>d;d++)c[d]=createjs.Sound.removeSound(a[d].src,b);return c},c.removeAllSounds=function(){c._idHash={},c._preloadHash={},b.removeAll(),c.activePlugin&&c.activePlugin.removeAllSounds()},c.loadComplete=function(a){if(!c.isReady())return!1;var b=c._parsePath(a);return a=b?c._getSrcById(b.src).src:c._getSrcById(a).src,void 0==c._preloadHash[a]?!1:1==c._preloadHash[a][0]},c._parsePath=function(a){"string"!=typeof a&&(a=a.toString());var b=a.match(c.FILE_PATTERN);if(null==b)return!1;for(var d=b[4],e=b[5],f=c.capabilities,g=0;!f[e];)if(e=c.alternateExtensions[g++],g>c.alternateExtensions.length)return null;a=a.replace("."+b[5],"."+e);var h={name:d,src:a,extension:e};return h},c._parseSrc=function(a){var b={name:void 0,src:void 0,extension:void 0},d=c.capabilities;for(var e in a)if(a.hasOwnProperty(e)&&d[e]){b.src=a[e],b.extension=e;break}if(!b.src)return!1;var f=b.src.lastIndexOf("/");return-1!=f?b.name=b.src.slice(f+1):b.name=b.src,b},c.play=function(a,b,d,e,f,g,h,i,j){var k;k=b instanceof Object||b instanceof createjs.PlayPropsConfig?createjs.PlayPropsConfig.create(b):createjs.PlayPropsConfig.create({interrupt:b,delay:d,offset:e,loop:f,volume:g,pan:h,startTime:i,duration:j});var l=c.createInstance(a,k.startTime,k.duration),m=c._playInstance(l,k);return m||l._playFailed(),l},c.createInstance=function(a,d,e){if(!c.initializeDefaultPlugins())return new createjs.DefaultSoundInstance(a,d,e);var f=c._defaultPlayPropsHash[a];a=c._getSrcById(a);var g=c._parsePath(a.src),h=null;return null!=g&&null!=g.src?(b.create(g.src),null==d&&(d=a.startTime),h=c.activePlugin.create(g.src,d,e||a.duration),f=f||c._defaultPlayPropsHash[g.src],f&&h.applyPlayProps(f)):h=new createjs.DefaultSoundInstance(a,d,e),h.uniqueId=c._lastID++,h},c.stop=function(){for(var a=this._instances,b=a.length;b--;)a[b].stop()},c.setVolume=function(a){if(null==Number(a))return!1;if(a=Math.max(0,Math.min(1,a)),c._masterVolume=a,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(a))for(var b=this._instances,d=0,e=b.length;e>d;d++)b[d].setMasterVolume(a)},c.getVolume=function(){return this._masterVolume},c.setMute=function(a){if(null==a)return!1;if(this._masterMute=a,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(a))for(var b=this._instances,c=0,d=b.length;d>c;c++)b[c].setMasterMute(a);return!0},c.getMute=function(){return this._masterMute},c.setDefaultPlayProps=function(a,b){a=c._getSrcById(a),c._defaultPlayPropsHash[c._parsePath(a.src).src]=createjs.PlayPropsConfig.create(b)},c.getDefaultPlayProps=function(a){return a=c._getSrcById(a),c._defaultPlayPropsHash[c._parsePath(a.src).src]},c._playInstance=function(a,b){var d=c._defaultPlayPropsHash[a.src]||{};if(null==b.interrupt&&(b.interrupt=d.interrupt||c.defaultInterruptBehavior),null==b.delay&&(b.delay=d.delay||0),null==b.offset&&(b.offset=a.getPosition()),null==b.loop&&(b.loop=a.loop),null==b.volume&&(b.volume=a.volume),null==b.pan&&(b.pan=a.pan),0==b.delay){var e=c._beginPlaying(a,b);if(!e)return!1}else{var f=setTimeout(function(){c._beginPlaying(a,b)},b.delay);a.delayTimeoutId=f}return this._instances.push(a),!0},c._beginPlaying=function(a,c){if(!b.add(a,c.interrupt))return!1;var d=a._beginPlaying(c);if(!d){var e=createjs.indexOf(this._instances,a);return e>-1&&this._instances.splice(e,1),!1}return!0},c._getSrcById=function(a){return c._idHash[a]||{src:a}},c._playFinished=function(a){b.remove(a);var c=createjs.indexOf(this._instances,a);c>-1&&this._instances.splice(c,1)},createjs.Sound=a,b.channels={},b.create=function(a,c){var d=b.get(a);return null==d?(b.channels[a]=new b(a,c),!0):!1},b.removeSrc=function(a){var c=b.get(a);return null==c?!1:(c._removeAll(),delete b.channels[a],!0)},b.removeAll=function(){for(var a in b.channels)b.channels[a]._removeAll();b.channels={}},b.add=function(a,c){var d=b.get(a.src);return null==d?!1:d._add(a,c)},b.remove=function(a){var c=b.get(a.src);return null==c?!1:(c._remove(a),!0)},b.maxPerChannel=function(){return d.maxDefault},b.get=function(a){return b.channels[a]};var d=b.prototype;d.constructor=b,d.src=null,d.max=null,d.maxDefault=100,d.length=0,d.init=function(a,b){this.src=a,this.max=b||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},d._get=function(a){return this._instances[a]},d._add=function(a,b){return this._getSlot(b,a)?(this._instances.push(a),this.length++,!0):!1},d._remove=function(a){var b=createjs.indexOf(this._instances,a);return-1==b?!1:(this._instances.splice(b,1),this.length--,!0)},d._removeAll=function(){for(var a=this.length-1;a>=0;a--)this._instances[a].stop()},d._getSlot=function(b,c){var d,e;if(b!=a.INTERRUPT_NONE&&(e=this._get(0),null==e))return!0;for(var f=0,g=this.max;g>f;f++){if(d=this._get(f),null==d)return!0;if(d.playState==a.PLAY_FINISHED||d.playState==a.PLAY_INTERRUPTED||d.playState==a.PLAY_FAILED){e=d;break}b!=a.INTERRUPT_NONE&&(b==a.INTERRUPT_EARLY&&d.getPosition()<e.getPosition()||b==a.INTERRUPT_LATE&&d.getPosition()>e.getPosition())&&(e=d)}return null!=e?(e._interrupt(),this._remove(e),!0):!1},d.toString=function(){return"[Sound SoundChannel]"}}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b,c,d){this.EventDispatcher_constructor(),this.src=a,this.uniqueId=-1,this.playState=null,this.delayTimeoutId=null,this._volume=1,Object.defineProperty(this,"volume",{get:this.getVolume,set:this.setVolume}),this._pan=0,Object.defineProperty(this,"pan",{get:this.getPan,set:this.setPan}),this._startTime=Math.max(0,b||0),Object.defineProperty(this,"startTime",{get:this.getStartTime,set:this.setStartTime}),this._duration=Math.max(0,c||0),Object.defineProperty(this,"duration",{get:this.getDuration,set:this.setDuration}),this._playbackResource=null,Object.defineProperty(this,"playbackResource",{get:this.getPlaybackResource,set:this.setPlaybackResource}),d!==!1&&d!==!0&&this.setPlaybackResource(d),this._position=0,Object.defineProperty(this,"position",{get:this.getPosition,set:this.setPosition}),this._loop=0,Object.defineProperty(this,"loop",{get:this.getLoop,set:this.setLoop}),this._muted=!1,Object.defineProperty(this,"muted",{get:this.getMuted,set:this.setMuted}),this._paused=!1,Object.defineProperty(this,"paused",{get:this.getPaused,set:this.setPaused})},b=createjs.extend(a,createjs.EventDispatcher);b.play=function(a,b,c,d,e,f){var g;return g=a instanceof Object||a instanceof createjs.PlayPropsConfig?createjs.PlayPropsConfig.create(a):createjs.PlayPropsConfig.create({interrupt:a,delay:b,offset:c,loop:d,volume:e,pan:f}),this.playState==createjs.Sound.PLAY_SUCCEEDED?(this.applyPlayProps(g),void(this._paused&&this.setPaused(!1))):(this._cleanUp(),createjs.Sound._playInstance(this,g),this)},b.stop=function(){return this._position=0,this._paused=!1,this._handleStop(),this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this},b.destroy=function(){this._cleanUp(),this.src=null,this.playbackResource=null,this.removeAllEventListeners()},b.applyPlayProps=function(a){return null!=a.offset&&this.setPosition(a.offset),null!=a.loop&&this.setLoop(a.loop),null!=a.volume&&this.setVolume(a.volume),null!=a.pan&&this.setPan(a.pan),null!=a.startTime&&(this.setStartTime(a.startTime),this.setDuration(a.duration)),this},b.toString=function(){return"[AbstractSoundInstance]"},b.getPaused=function(){return this._paused},b.setPaused=function(a){return a!==!0&&a!==!1||this._paused==a||1==a&&this.playState!=createjs.Sound.PLAY_SUCCEEDED?void 0:(this._paused=a,a?this._pause():this._resume(),clearTimeout(this.delayTimeoutId),this)},b.setVolume=function(a){return a==this._volume?this:(this._volume=Math.max(0,Math.min(1,a)),this._muted||this._updateVolume(),this)},b.getVolume=function(){return this._volume},b.setMuted=function(a){return a===!0||a===!1?(this._muted=a,this._updateVolume(),this):void 0},b.getMuted=function(){return this._muted},b.setPan=function(a){return a==this._pan?this:(this._pan=Math.max(-1,Math.min(1,a)),this._updatePan(),this)},b.getPan=function(){return this._pan},b.getPosition=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||(this._position=this._calculateCurrentPosition()),this._position},b.setPosition=function(a){return this._position=Math.max(0,a),this.playState==createjs.Sound.PLAY_SUCCEEDED&&this._updatePosition(),this},b.getStartTime=function(){return this._startTime},b.setStartTime=function(a){return a==this._startTime?this:(this._startTime=Math.max(0,a||0),this._updateStartTime(),this)},b.getDuration=function(){return this._duration},b.setDuration=function(a){return a==this._duration?this:(this._duration=Math.max(0,a||0),this._updateDuration(),this)},b.setPlaybackResource=function(a){return this._playbackResource=a,0==this._duration&&this._setDurationFromSource(),this},b.getPlaybackResource=function(){return this._playbackResource},b.getLoop=function(){return this._loop},b.setLoop=function(a){null!=this._playbackResource&&(0!=this._loop&&0==a?this._removeLooping(a):0==this._loop&&0!=a&&this._addLooping(a)),this._loop=a},b._sendEvent=function(a){var b=new createjs.Event(a);this.dispatchEvent(b)},b._cleanUp=function(){clearTimeout(this.delayTimeoutId),this._handleCleanUp(),this._paused=!1,createjs.Sound._playFinished(this)},b._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._sendEvent("interrupted")},b._beginPlaying=function(a){return this.setPosition(a.offset),this.setLoop(a.loop),this.setVolume(a.volume),this.setPan(a.pan),null!=a.startTime&&(this.setStartTime(a.startTime),this.setDuration(a.duration)),null!=this._playbackResource&&this._position<this._duration?(this._paused=!1,this._handleSoundReady(),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._sendEvent("succeeded"),!0):(this._playFailed(),!1)},b._playFailed=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed")},b._handleSoundComplete=function(a){return this._position=0,0!=this._loop?(this._loop--,this._handleLoop(),void this._sendEvent("loop")):(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,void this._sendEvent("complete"))},b._handleSoundReady=function(){},b._updateVolume=function(){},b._updatePan=function(){},b._updateStartTime=function(){},b._updateDuration=function(){},b._setDurationFromSource=function(){},b._calculateCurrentPosition=function(){},b._updatePosition=function(){},b._removeLooping=function(a){},b._addLooping=function(a){},b._pause=function(){},b._resume=function(){},b._handleStop=function(){},b._handleCleanUp=function(){},b._handleLoop=function(){},createjs.AbstractSoundInstance=createjs.promote(a,"EventDispatcher"),createjs.DefaultSoundInstance=createjs.AbstractSoundInstance}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){this._capabilities=null,this._loaders={},this._audioSources={},this._soundInstances={},this._volume=1,this._loaderClass,this._soundInstanceClass},b=a.prototype;a._capabilities=null,a.isSupported=function(){return!0},b.register=function(a){var b=this._loaders[a.src];return b&&!b.canceled?this._loaders[a.src]:(this._audioSources[a.src]=!0,this._soundInstances[a.src]=[],b=new this._loaderClass(a),b.on("complete",this._handlePreloadComplete,this),this._loaders[a.src]=b,b)},b.preload=function(a){a.on("error",this._handlePreloadError,this),a.load()},b.isPreloadStarted=function(a){return null!=this._audioSources[a]},b.isPreloadComplete=function(a){return!(null==this._audioSources[a]||1==this._audioSources[a])},b.removeSound=function(a){if(this._soundInstances[a]){for(var b=this._soundInstances[a].length;b--;){var c=this._soundInstances[a][b];c.destroy()}delete this._soundInstances[a],delete this._audioSources[a],this._loaders[a]&&this._loaders[a].destroy(),delete this._loaders[a]}},b.removeAllSounds=function(){for(var a in this._audioSources)this.removeSound(a)},b.create=function(a,b,c){this.isPreloadStarted(a)||this.preload(this.register(a));var d=new this._soundInstanceClass(a,b,c,this._audioSources[a]);return this._soundInstances[a].push(d),d},b.setVolume=function(a){return this._volume=a,this._updateVolume(),!0},b.getVolume=function(){return this._volume},b.setMute=function(a){return this._updateVolume(),!0},b.toString=function(){return"[AbstractPlugin]"},b._handlePreloadComplete=function(a){var b=a.target.getItem().src;this._audioSources[b]=a.result;for(var c=0,d=this._soundInstances[b].length;d>c;c++){var e=this._soundInstances[b][c];e.setPlaybackResource(this._audioSources[b]);
}},b._handlePreloadError=function(a){},b._updateVolume=function(){},createjs.AbstractPlugin=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(a){this.AbstractLoader_constructor(a,!0,createjs.AbstractLoader.SOUND)}var b=createjs.extend(a,createjs.AbstractLoader);a.context=null,b.toString=function(){return"[WebAudioLoader]"},b._createRequest=function(){this._request=new createjs.XHRRequest(this._item,!1),this._request.setResponseType("arraybuffer")},b._sendComplete=function(b){a.context.decodeAudioData(this._rawResult,createjs.proxy(this._handleAudioDecoded,this),createjs.proxy(this._sendError,this))},b._handleAudioDecoded=function(a){this._result=a,this.AbstractLoader__sendComplete()},createjs.WebAudioLoader=createjs.promote(a,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,d,e){this.AbstractSoundInstance_constructor(a,b,d,e),this.gainNode=c.context.createGain(),this.panNode=c.context.createPanner(),this.panNode.panningModel=c._panningModel,this.panNode.connect(this.gainNode),this._updatePan(),this.sourceNode=null,this._soundCompleteTimeout=null,this._sourceNodeNext=null,this._playbackStartTime=0,this._endedHandler=createjs.proxy(this._handleSoundComplete,this)}var b=createjs.extend(a,createjs.AbstractSoundInstance),c=a;c.context=null,c._scratchBuffer=null,c.destinationNode=null,c._panningModel="equalpower",b.destroy=function(){this.AbstractSoundInstance_destroy(),this.panNode.disconnect(0),this.panNode=null,this.gainNode.disconnect(0),this.gainNode=null},b.toString=function(){return"[WebAudioSoundInstance]"},b._updatePan=function(){this.panNode.setPosition(this._pan,0,-.5)},b._removeLooping=function(a){this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)},b._addLooping=function(a){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},b._setDurationFromSource=function(){this._duration=1e3*this.playbackResource.duration},b._handleCleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout),this._playbackStartTime=0},b._cleanUpAudioNode=function(a){if(a){a.stop(0),a.disconnect(0);try{a.buffer=c._scratchBuffer}catch(b){}a=null}return a},b._handleSoundReady=function(a){this.gainNode.connect(c.destinationNode);var b=.001*this._duration,d=.001*this._position;d>b&&(d=b),this.sourceNode=this._createAndPlayAudioNode(c.context.currentTime-b,d),this._playbackStartTime=this.sourceNode.startTime-d,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(b-d)),0!=this._loop&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},b._createAndPlayAudioNode=function(a,b){var d=c.context.createBufferSource();d.buffer=this.playbackResource,d.connect(this.panNode);var e=.001*this._duration;return d.startTime=a+e,d.start(d.startTime,b+.001*this._startTime,e-b),d},b._pause=function(){this._position=1e3*(c.context.currentTime-this._playbackStartTime),this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout)},b._resume=function(){this._handleSoundReady()},b._updateVolume=function(){var a=this._muted?0:this._volume;a!=this.gainNode.gain.value&&(this.gainNode.gain.value=a)},b._calculateCurrentPosition=function(){return 1e3*(c.context.currentTime-this._playbackStartTime)},b._updatePosition=function(){this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout),this._paused||this._handleSoundReady()},b._handleLoop=function(){this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._playbackStartTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)},b._updateDuration=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._pause(),this._resume())},createjs.WebAudioSoundInstance=createjs.promote(a,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.AbstractPlugin_constructor(),this._panningModel=c._panningModel,this.context=c.context,this.dynamicsCompressorNode=this.context.createDynamicsCompressor(),this.dynamicsCompressorNode.connect(this.context.destination),this.gainNode=this.context.createGain(),this.gainNode.connect(this.dynamicsCompressorNode),createjs.WebAudioSoundInstance.destinationNode=this.gainNode,this._capabilities=c._capabilities,this._loaderClass=createjs.WebAudioLoader,this._soundInstanceClass=createjs.WebAudioSoundInstance,this._addPropsToClasses()}var b=createjs.extend(a,createjs.AbstractPlugin),c=a;c._capabilities=null,c._panningModel="equalpower",c.context=null,c._scratchBuffer=null,c._unlocked=!1,c.isSupported=function(){var a=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;return"file:"!=location.protocol||a||this._isFileXHRSupported()?(c._generateCapabilities(),null==c.context?!1:!0):!1},c.playEmptySound=function(){if(null!=c.context){var a=c.context.createBufferSource();a.buffer=c._scratchBuffer,a.connect(c.context.destination),a.start(0,0,0)}},c._isFileXHRSupported=function(){var a=!0,b=new XMLHttpRequest;try{b.open("GET","WebAudioPluginTest.fail",!1)}catch(c){return a=!1}b.onerror=function(){a=!1},b.onload=function(){a=404==this.status||200==this.status||0==this.status&&""!=this.response};try{b.send()}catch(c){a=!1}return a},c._generateCapabilities=function(){if(null==c._capabilities){var a=document.createElement("audio");if(null==a.canPlayType)return null;if(null==c.context)if(window.AudioContext)c.context=new AudioContext;else{if(!window.webkitAudioContext)return null;c.context=new webkitAudioContext}null==c._scratchBuffer&&(c._scratchBuffer=c.context.createBuffer(1,1,22050)),c._compatibilitySetUp(),"ontouchstart"in window&&"running"!=c.context.state&&(c._unlock(),document.addEventListener("mousedown",c._unlock,!0),document.addEventListener("touchend",c._unlock,!0)),c._capabilities={panning:!0,volume:!0,tracks:-1};for(var b=createjs.Sound.SUPPORTED_EXTENSIONS,d=createjs.Sound.EXTENSION_MAP,e=0,f=b.length;f>e;e++){var g=b[e],h=d[g]||g;c._capabilities[g]="no"!=a.canPlayType("audio/"+g)&&""!=a.canPlayType("audio/"+g)||"no"!=a.canPlayType("audio/"+h)&&""!=a.canPlayType("audio/"+h)}c.context.destination.numberOfChannels<2&&(c._capabilities.panning=!1)}},c._compatibilitySetUp=function(){if(c._panningModel="equalpower",!c.context.createGain){c.context.createGain=c.context.createGainNode;var a=c.context.createBufferSource();a.__proto__.start=a.__proto__.noteGrainOn,a.__proto__.stop=a.__proto__.noteOff,c._panningModel=0}},c._unlock=function(){c._unlocked||(c.playEmptySound(),"running"==c.context.state&&(document.removeEventListener("mousedown",c._unlock,!0),document.removeEventListener("touchend",c._unlock,!0),c._unlocked=!0))},b.toString=function(){return"[WebAudioPlugin]"},b._addPropsToClasses=function(){var a=this._soundInstanceClass;a.context=this.context,a._scratchBuffer=c._scratchBuffer,a.destinationNode=this.gainNode,a._panningModel=this._panningModel,this._loaderClass.context=this.context},b._updateVolume=function(){var a=createjs.Sound._masterMute?0:this._volume;a!=this.gainNode.gain.value&&(this.gainNode.gain.value=a)},createjs.WebAudioPlugin=createjs.promote(a,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"HTMLAudioTagPool cannot be instantiated"}function b(a){this._tags=[]}var c=a;c._tags={},c._tagPool=new b,c._tagUsed={},c.get=function(a){var b=c._tags[a];return null==b?(b=c._tags[a]=c._tagPool.get(),b.src=a):c._tagUsed[a]?(b=c._tagPool.get(),b.src=a):c._tagUsed[a]=!0,b},c.set=function(a,b){b==c._tags[a]?c._tagUsed[a]=!1:c._tagPool.set(b)},c.remove=function(a){var b=c._tags[a];return null==b?!1:(c._tagPool.set(b),delete c._tags[a],delete c._tagUsed[a],!0)},c.getDuration=function(a){var b=c._tags[a];return null!=b&&b.duration?1e3*b.duration:0},createjs.HTMLAudioTagPool=a;var d=b.prototype;d.constructor=b,d.get=function(){var a;return a=0==this._tags.length?this._createTag():this._tags.pop(),null==a.parentNode&&document.body.appendChild(a),a},d.set=function(a){var b=createjs.indexOf(this._tags,a);-1==b&&(this._tags.src=null,this._tags.push(a))},d.toString=function(){return"[TagPool]"},d._createTag=function(){var a=document.createElement("audio");return a.autoplay=!1,a.preload="none",a}}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c,d){this.AbstractSoundInstance_constructor(a,b,c,d),this._audioSpriteStopTime=null,this._delayTimeoutId=null,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleTagReady,this),this._stalledHandler=createjs.proxy(this._playFailed,this),this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this),this._loopHandler=createjs.proxy(this._handleSoundComplete,this),c?this._audioSpriteStopTime=.001*(b+c):this._duration=createjs.HTMLAudioTagPool.getDuration(this.src)}var b=createjs.extend(a,createjs.AbstractSoundInstance);b.setMasterVolume=function(a){this._updateVolume()},b.setMasterMute=function(a){this._updateVolume()},b.toString=function(){return"[HTMLAudioSoundInstance]"},b._removeLooping=function(){null!=this._playbackResource&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},b._addLooping=function(){null==this._playbackResource||this._audioSpriteStopTime||(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)},b._handleCleanUp=function(){var a=this._playbackResource;if(null!=a){a.pause(),a.loop=!1,a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1);try{a.currentTime=this._startTime}catch(b){}createjs.HTMLAudioTagPool.set(this.src,a),this._playbackResource=null}},b._beginPlaying=function(a){return this._playbackResource=createjs.HTMLAudioTagPool.get(this.src),this.AbstractSoundInstance__beginPlaying(a)},b._handleSoundReady=function(a){if(4!==this._playbackResource.readyState){var b=this._playbackResource;return b.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),b.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),b.preload="auto",void b.load()}this._updateVolume(),this._playbackResource.currentTime=.001*(this._startTime+this._position),this._audioSpriteStopTime?this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1):(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),0!=this._loop&&(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)),this._playbackResource.play()},b._handleTagReady=function(a){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),this._handleSoundReady()},b._pause=function(){this._playbackResource.pause()},b._resume=function(){this._playbackResource.play()},b._updateVolume=function(){if(null!=this._playbackResource){var a=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;a!=this._playbackResource.volume&&(this._playbackResource.volume=a)}},b._calculateCurrentPosition=function(){return 1e3*this._playbackResource.currentTime-this._startTime},b._updatePosition=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1);try{this._playbackResource.currentTime=.001*(this._position+this._startTime)}catch(a){this._handleSetPositionSeek(null)}},b._handleSetPositionSeek=function(a){null!=this._playbackResource&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},b._handleAudioSpriteLoop=function(a){this._playbackResource.currentTime<=this._audioSpriteStopTime||(this._playbackResource.pause(),0==this._loop?this._handleSoundComplete(null):(this._position=0,this._loop--,this._playbackResource.currentTime=.001*this._startTime,this._paused||this._playbackResource.play(),this._sendEvent("loop")))},b._handleLoop=function(a){0==this._loop&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},b._updateStartTime=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},b._updateDuration=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},b._setDurationFromSource=function(){this._duration=createjs.HTMLAudioTagPool.getDuration(this.src),this._playbackResource=null},createjs.HTMLAudioSoundInstance=createjs.promote(a,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this.AbstractPlugin_constructor(),this.defaultNumChannels=2,this._capabilities=c._capabilities,this._loaderClass=createjs.SoundLoader,this._soundInstanceClass=createjs.HTMLAudioSoundInstance}var b=createjs.extend(a,createjs.AbstractPlugin),c=a;c.MAX_INSTANCES=30,c._AUDIO_READY="canplaythrough",c._AUDIO_ENDED="ended",c._AUDIO_SEEKED="seeked",c._AUDIO_STALLED="stalled",c._TIME_UPDATE="timeupdate",c._capabilities=null,c.isSupported=function(){return c._generateCapabilities(),null!=c._capabilities},c._generateCapabilities=function(){if(null==c._capabilities){var a=document.createElement("audio");if(null==a.canPlayType)return null;c._capabilities={panning:!1,volume:!0,tracks:-1};for(var b=createjs.Sound.SUPPORTED_EXTENSIONS,d=createjs.Sound.EXTENSION_MAP,e=0,f=b.length;f>e;e++){var g=b[e],h=d[g]||g;c._capabilities[g]="no"!=a.canPlayType("audio/"+g)&&""!=a.canPlayType("audio/"+g)||"no"!=a.canPlayType("audio/"+h)&&""!=a.canPlayType("audio/"+h)}}},b.register=function(a){var b=createjs.HTMLAudioTagPool.get(a.src),c=this.AbstractPlugin_register(a);return c.setTag(b),c},b.removeSound=function(a){this.AbstractPlugin_removeSound(a),createjs.HTMLAudioTagPool.remove(a)},b.create=function(a,b,c){var d=this.AbstractPlugin_create(a,b,c);return d.setPlaybackResource(null),d},b.toString=function(){return"[HTMLAudioPlugin]"},b.setVolume=b.getVolume=b.setMute=null,createjs.HTMLAudioPlugin=createjs.promote(a,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){"use strict";function a(b,c,d){this.ignoreGlobalPause=!1,this.loop=!1,this.duration=0,this.pluginData=d||{},this.target=b,this.position=null,this.passive=!1,this._paused=!1,this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],this._prevPosition=0,this._stepPosition=0,this._prevPos=-1,this._target=b,this._useTicks=!1,this._inited=!1,this._registered=!1,c&&(this._useTicks=c.useTicks,this.ignoreGlobalPause=c.ignoreGlobalPause,this.loop=c.loop,c.onChange&&this.addEventListener("change",c.onChange),c.override&&a.removeTweens(b)),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,a.NONE)}var b=createjs.extend(a,createjs.EventDispatcher);a.NONE=0,a.LOOP=1,a.REVERSE=2,a.IGNORE={},a._tweens=[],a._plugins={},a.get=function(b,c,d,e){return e&&a.removeTweens(b),new a(b,c,d)},a.tick=function(b,c){for(var d=a._tweens.slice(),e=d.length-1;e>=0;e--){var f=d[e];c&&!f.ignoreGlobalPause||f._paused||f.tick(f._useTicks?1:b)}},a.handleEvent=function(a){"tick"==a.type&&this.tick(a.delta,a.paused)},a.removeTweens=function(b){if(b.tweenjs_count){for(var c=a._tweens,d=c.length-1;d>=0;d--){var e=c[d];e._target==b&&(e._paused=!0,c.splice(d,1))}b.tweenjs_count=0}},a.removeAllTweens=function(){for(var b=a._tweens,c=0,d=b.length;d>c;c++){var e=b[c];e._paused=!0,e.target&&(e.target.tweenjs_count=0)}b.length=0},a.hasActiveTweens=function(b){return b?null!=b.tweenjs_count&&!!b.tweenjs_count:a._tweens&&!!a._tweens.length},a.installPlugin=function(b,c){var d=b.priority;null==d&&(b.priority=d=0);for(var e=0,f=c.length,g=a._plugins;f>e;e++){var h=c[e];if(g[h]){for(var i=g[h],j=0,k=i.length;k>j&&!(d<i[j].priority);j++);g[h].splice(j,0,b)}else g[h]=[b]}},a._register=function(b,c){var d=b._target,e=a._tweens;if(c&&!b._registered)d&&(d.tweenjs_count=d.tweenjs_count?d.tweenjs_count+1:1),e.push(b),!a._inited&&createjs.Ticker&&(createjs.Ticker.addEventListener("tick",a),a._inited=!0);else if(!c&&b._registered){d&&d.tweenjs_count--;for(var f=e.length;f--;)if(e[f]==b){e.splice(f,1);break}}b._registered=c},b.wait=function(a,b){if(null==a||0>=a)return this;var c=this._cloneProps(this._curQueueProps);return this._addStep({d:a,p0:c,e:this._linearEase,p1:c,v:b})},b.to=function(a,b,c){return(isNaN(b)||0>b)&&(b=0),this._addStep({d:b||0,p0:this._cloneProps(this._curQueueProps),e:c,p1:this._cloneProps(this._appendQueueProps(a))})},b.call=function(a,b,c){return this._addAction({f:a,p:b?b:[this],o:c?c:this._target})},b.set=function(a,b){return this._addAction({f:this._set,o:this,p:[a,b?b:this._target]})},b.play=function(a){return a||(a=this),this.call(a.setPaused,[!1],a)},b.pause=function(a){return a||(a=this),this.call(a.setPaused,[!0],a)},b.setPosition=function(a,b){0>a&&(a=0),null==b&&(b=1);var c=a,d=!1;if(c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0)),c==this._prevPos)return d;var e=this._prevPos;if(this.position=this._prevPos=c,this._prevPosition=a,this._target)if(d)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var f=0,g=this._steps.length;g>f&&!(this._steps[f].t>c);f++);var h=this._steps[f-1];this._updateTargetProps(h,(this._stepPosition=c-h.t)/h.d)}return 0!=b&&this._actions.length>0&&(this._useTicks?this._runActions(c,c):1==b&&e>c?(e!=this.duration&&this._runActions(e,this.duration),this._runActions(0,c,!0)):this._runActions(e,c)),d&&this.setPaused(!0),this.dispatchEvent("change"),d},b.tick=function(a){this._paused||this.setPosition(this._prevPosition+a)},b.setPaused=function(b){return this._paused===!!b?this:(this._paused=!!b,a._register(this,!b),this)},b.w=b.wait,b.t=b.to,b.c=b.call,b.s=b.set,b.toString=function(){return"[Tween]"},b.clone=function(){throw"Tween can not be cloned."},b._updateTargetProps=function(b,c){var d,e,f,g,h,i;if(b||1!=c){if(this.passive=!!b.v,this.passive)return;b.e&&(c=b.e(c,0,1,1)),d=b.p0,e=b.p1}else this.passive=!1,d=e=this._curQueueProps;for(var j in this._initQueueProps){null==(g=d[j])&&(d[j]=g=this._initQueueProps[j]),null==(h=e[j])&&(e[j]=h=g),f=g==h||0==c||1==c||"number"!=typeof g?1==c?h:g:g+(h-g)*c;var k=!1;if(i=a._plugins[j])for(var l=0,m=i.length;m>l;l++){var n=i[l].tween(this,j,f,d,e,c,!!b&&d==e,!b);n==a.IGNORE?k=!0:f=n}k||(this._target[j]=f)}},b._runActions=function(a,b,c){var d=a,e=b,f=-1,g=this._actions.length,h=1;for(a>b&&(d=b,e=a,f=g,g=h=-1);(f+=h)!=g;){var i=this._actions[f],j=i.t;(j==e||j>d&&e>j||c&&j==a)&&i.f.apply(i.o,i.p)}},b._appendQueueProps=function(b){var c,d,e,f,g;for(var h in b)if(void 0===this._initQueueProps[h]){if(d=this._target[h],c=a._plugins[h])for(e=0,f=c.length;f>e;e++)d=c[e].init(this,h,d);this._initQueueProps[h]=this._curQueueProps[h]=void 0===d?null:d}else d=this._curQueueProps[h];for(var h in b){if(d=this._curQueueProps[h],c=a._plugins[h])for(g=g||{},e=0,f=c.length;f>e;e++)c[e].step&&c[e].step(this,h,d,b[h],g);this._curQueueProps[h]=b[h]}return g&&this._appendQueueProps(g),this._curQueueProps},b._cloneProps=function(a){var b={};for(var c in a)b[c]=a[c];return b},b._addStep=function(a){return a.d>0&&(this._steps.push(a),a.t=this.duration,this.duration+=a.d),this},b._addAction=function(a){return a.t=this.duration,this._actions.push(a),this},b._set=function(a,b){for(var c in a)b[c]=a[c]},createjs.Tween=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.EventDispatcher_constructor(),this.ignoreGlobalPause=!1,this.duration=0,this.loop=!1,this.position=null,this._paused=!1,this._tweens=[],this._labels=null,this._labelList=null,this._prevPosition=0,this._prevPos=-1,this._useTicks=!1,this._registered=!1,c&&(this._useTicks=c.useTicks,this.loop=c.loop,this.ignoreGlobalPause=c.ignoreGlobalPause,c.onChange&&this.addEventListener("change",c.onChange)),a&&this.addTween.apply(this,a),this.setLabels(b),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,createjs.Tween.NONE)}var b=createjs.extend(a,createjs.EventDispatcher);b.addTween=function(a){var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addTween(arguments[c]);return arguments[0]}return 0==b?null:(this.removeTween(a),this._tweens.push(a),a.setPaused(!0),a._paused=!1,a._useTicks=this._useTicks,a.duration>this.duration&&(this.duration=a.duration),this._prevPos>=0&&a.setPosition(this._prevPos,createjs.Tween.NONE),a)},b.removeTween=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeTween(arguments[d]);return c}if(0==b)return!1;for(var e=this._tweens,d=e.length;d--;)if(e[d]==a)return e.splice(d,1),a.duration>=this.duration&&this.updateDuration(),!0;return!1},b.addLabel=function(a,b){this._labels[a]=b;var c=this._labelList;if(c){for(var d=0,e=c.length;e>d&&!(b<c[d].position);d++);c.splice(d,0,{label:a,position:b})}},b.setLabels=function(a){this._labels=a?a:{}},b.getLabels=function(){var a=this._labelList;if(!a){a=this._labelList=[];var b=this._labels;for(var c in b)a.push({label:c,position:b[c]});a.sort(function(a,b){return a.position-b.position})}return a},b.getCurrentLabel=function(){var a=this.getLabels(),b=this.position,c=a.length;if(c){for(var d=0;c>d&&!(b<a[d].position);d++);return 0==d?null:a[d-1].label}return null},b.gotoAndPlay=function(a){this.setPaused(!1),this._goto(a)},b.gotoAndStop=function(a){this.setPaused(!0),this._goto(a)},b.setPosition=function(a,b){var c=this._calcPosition(a),d=!this.loop&&a>=this.duration;if(c==this._prevPos)return d;this._prevPosition=a,this.position=this._prevPos=c;for(var e=0,f=this._tweens.length;f>e;e++)if(this._tweens[e].setPosition(c,b),c!=this._prevPos)return!1;return d&&this.setPaused(!0),this.dispatchEvent("change"),d},b.setPaused=function(a){this._paused=!!a,createjs.Tween._register(this,!a)},b.updateDuration=function(){this.duration=0;for(var a=0,b=this._tweens.length;b>a;a++){var c=this._tweens[a];c.duration>this.duration&&(this.duration=c.duration)}},b.tick=function(a){this.setPosition(this._prevPosition+a)},b.resolve=function(a){var b=Number(a);return isNaN(b)&&(b=this._labels[a]),b},b.toString=function(){return"[Timeline]"},b.clone=function(){throw"Timeline can not be cloned."},b._goto=function(a){var b=this.resolve(a);null!=b&&this.setPosition(b)},b._calcPosition=function(a){return 0>a?0:a<this.duration?a:this.loop?a%this.duration:this.duration},createjs.Timeline=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ease cannot be instantiated."}a.linear=function(a){return a},a.none=a.linear,a.get=function(a){return-1>a&&(a=-1),a>1&&(a=1),function(b){return 0==a?b:0>a?b*(b*-a+1+a):b*((2-b)*a+(1-a))}},a.getPowIn=function(a){return function(b){return Math.pow(b,a)}},a.getPowOut=function(a){return function(b){return 1-Math.pow(1-b,a)}},a.getPowInOut=function(a){return function(b){return(b*=2)<1?.5*Math.pow(b,a):1-.5*Math.abs(Math.pow(2-b,a))}},a.quadIn=a.getPowIn(2),a.quadOut=a.getPowOut(2),a.quadInOut=a.getPowInOut(2),a.cubicIn=a.getPowIn(3),a.cubicOut=a.getPowOut(3),a.cubicInOut=a.getPowInOut(3),a.quartIn=a.getPowIn(4),a.quartOut=a.getPowOut(4),a.quartInOut=a.getPowInOut(4),a.quintIn=a.getPowIn(5),a.quintOut=a.getPowOut(5),a.quintInOut=a.getPowInOut(5),a.sineIn=function(a){return 1-Math.cos(a*Math.PI/2)},a.sineOut=function(a){return Math.sin(a*Math.PI/2)},a.sineInOut=function(a){return-.5*(Math.cos(Math.PI*a)-1)},a.getBackIn=function(a){return function(b){return b*b*((a+1)*b-a)}},a.backIn=a.getBackIn(1.7),a.getBackOut=function(a){return function(b){return--b*b*((a+1)*b+a)+1}},a.backOut=a.getBackOut(1.7),a.getBackInOut=function(a){return a*=1.525,function(b){return(b*=2)<1?.5*(b*b*((a+1)*b-a)):.5*((b-=2)*b*((a+1)*b+a)+2)}},a.backInOut=a.getBackInOut(1.7),a.circIn=function(a){return-(Math.sqrt(1-a*a)-1)},a.circOut=function(a){return Math.sqrt(1- --a*a)},a.circInOut=function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},a.bounceIn=function(b){return 1-a.bounceOut(1-b)},a.bounceOut=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},a.bounceInOut=function(b){return.5>b?.5*a.bounceIn(2*b):.5*a.bounceOut(2*b-1)+.5},a.getElasticIn=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return-(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b))}},a.elasticIn=a.getElasticIn(1,.3),a.getElasticOut=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return a*Math.pow(2,-10*d)*Math.sin((d-e)*c/b)+1}},a.elasticOut=a.getElasticOut(1,.3),a.getElasticInOut=function(a,b){var c=2*Math.PI;return function(d){var e=b/c*Math.asin(1/a);return(d*=2)<1?-.5*(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b)):a*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*c/b)*.5+1}},a.elasticInOut=a.getElasticInOut(1,.3*1.5),createjs.Ease=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"MotionGuidePlugin cannot be instantiated."}a.priority=0,a._rotOffS,a._rotOffE,a._rotNormS,a._rotNormE,a.install=function(){return createjs.Tween.installPlugin(a,["guide","x","y","rotation"]),createjs.Tween.IGNORE},a.init=function(a,b,c){var d=a.target;return d.hasOwnProperty("x")||(d.x=0),d.hasOwnProperty("y")||(d.y=0),d.hasOwnProperty("rotation")||(d.rotation=0),"rotation"==b&&(a.__needsRot=!0),"guide"==b?null:c},a.step=function(b,c,d,e,f){if("rotation"==c&&(b.__rotGlobalS=d,b.__rotGlobalE=e,a.testRotData(b,f)),"guide"!=c)return e;var g,h=e;h.hasOwnProperty("path")||(h.path=[]);var i=h.path;if(h.hasOwnProperty("end")||(h.end=1),h.hasOwnProperty("start")||(h.start=d&&d.hasOwnProperty("end")&&d.path===i?d.end:0),h.hasOwnProperty("_segments")&&h._length)return e;var j=i.length,k=10;if(!(j>=6&&(j-2)%4==0))throw"invalid 'path' data, please see documentation for valid paths";h._segments=[],h._length=0;for(var l=2;j>l;l+=4){for(var m,n,o=i[l-2],p=i[l-1],q=i[l+0],r=i[l+1],s=i[l+2],t=i[l+3],u=o,v=p,w=0,x=[],y=1;k>=y;y++){var z=y/k,A=1-z;m=A*A*o+2*A*z*q+z*z*s,n=A*A*p+2*A*z*r+z*z*t,w+=x[x.push(Math.sqrt((g=m-u)*g+(g=n-v)*g))-1],u=m,v=n}h._segments.push(w),h._segments.push(x),h._length+=w}g=h.orient,h.orient=!0;var B={};return a.calc(h,h.start,B),b.__rotPathS=Number(B.rotation.toFixed(5)),a.calc(h,h.end,B),b.__rotPathE=Number(B.rotation.toFixed(5)),h.orient=!1,a.calc(h,h.end,f),h.orient=g,h.orient?(b.__guideData=h,a.testRotData(b,f),e):e},a.testRotData=function(a,b){if(void 0===a.__rotGlobalS||void 0===a.__rotGlobalE){if(a.__needsRot)return;void 0!==a._curQueueProps.rotation?a.__rotGlobalS=a.__rotGlobalE=a._curQueueProps.rotation:a.__rotGlobalS=a.__rotGlobalE=b.rotation=a.target.rotation||0}if(void 0!==a.__guideData){var c=a.__guideData,d=a.__rotGlobalE-a.__rotGlobalS,e=a.__rotPathE-a.__rotPathS,f=d-e;if("auto"==c.orient)f>180?f-=360:-180>f&&(f+=360);else if("cw"==c.orient){for(;0>f;)f+=360;0==f&&d>0&&180!=d&&(f+=360)}else if("ccw"==c.orient){for(f=d-(e>180?360-e:e);f>0;)f-=360;0==f&&0>d&&-180!=d&&(f-=360)}c.rotDelta=f,c.rotOffS=a.__rotGlobalS-a.__rotPathS,a.__rotGlobalS=a.__rotGlobalE=a.__guideData=a.__needsRot=void 0}},a.tween=function(b,c,d,e,f,g,h,i){var j=f.guide;if(void 0==j||j===e.guide)return d;if(j.lastRatio!=g){var k=(j.end-j.start)*(h?j.end:g)+j.start;switch(a.calc(j,k,b.target),j.orient){case"cw":case"ccw":case"auto":b.target.rotation+=j.rotOffS+j.rotDelta*g;break;case"fixed":default:b.target.rotation+=j.rotOffS}j.lastRatio=g}return"rotation"!=c||j.orient&&"false"!=j.orient?b.target[c]:d},a.calc=function(a,b,c){if(void 0==a._segments)throw"Missing critical pre-calculated information, please file a bug";void 0==c&&(c={x:0,y:0,rotation:0});for(var d=a._segments,e=a.path,f=a._length*b,g=d.length-2,h=0;f>d[h]&&g>h;)f-=d[h],h+=2;var i=d[h+1],j=0;for(g=i.length-1;f>i[j]&&g>j;)f-=i[j],j++;var k=j/++g+f/(g*i[j]);h=2*h+2;var l=1-k;return c.x=l*l*e[h-2]+2*l*k*e[h+0]+k*k*e[h+2],c.y=l*l*e[h-1]+2*l*k*e[h+1]+k*k*e[h+3],a.orient&&(c.rotation=57.2957795*Math.atan2((e[h+1]-e[h-1])*l+(e[h+3]-e[h+1])*k,(e[h+0]-e[h-2])*l+(e[h+2]-e[h+0])*k)),c},createjs.MotionGuidePlugin=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.TweenJS=createjs.TweenJS||{};a.version="0.6.2",a.buildDate="Thu, 26 Nov 2015 20:44:31 GMT"}();
// Filbert is a Python parser written in JavaScript.
//
// Filbert was written by Matt Lott and released under an MIT
// license. It was adatped from [Acorn](https://github.com/marijnh/acorn.git)
// by Marijn Haverbeke.
//
// Git repository for Filbert are available at
//
//     https://github.com/differentmatt/filbert.git
//
// Please use the [github bug tracker][ghbt] to report issues.
//
// [ghbt]: https://github.com/differentmatt/filbert/issues

(function(root, mod) {
  if (typeof exports == "object" && typeof module == "object") return mod(exports); // CommonJS
  if (typeof define == "function" && define.amd) return define(["exports"], mod); // AMD
  mod(root.filbert || (root.filbert = {})); // Plain browser env
})(this, function(exports) {
  "use strict";

  exports.version = "0.5.1";

  // The main exported interface (under `self.filbert` when in the
  // browser) is a `parse` function that takes a code string and
  // returns an abstract syntax tree as specified by [Mozilla parser
  // API][api].
  //
  // [api]: https://developer.mozilla.org/en-US/docs/SpiderMonkey/Parser_API

  var options, input, inputLen, sourceFile, nc;

  exports.parse = function(inpt, opts) {
    input = String(inpt); inputLen = input.length;
    setOptions(opts);
    initTokenState();
    nc = getNodeCreator(startNode, startNodeFrom, finishNode, unpackTuple);
    return parseTopLevel(options.program);
  };

  // A second optional argument can be given to further configure
  // the parser process. These options are recognized:

  var defaultOptions = exports.defaultOptions = {
    // `languageVersion` indicates the Python version to parse. It
    // is not currently in use, but will support 2 or 3 eventually.
    languageVersion: 3,
    // When `allowTrailingCommas` is false, the parser will not allow
    // trailing commas in array and object literals.
    allowTrailingCommas: true,
    // When enabled, a return at the top level is not considered an
    // error.
    allowReturnOutsideFunction: false,
    // When `locations` is on, `loc` properties holding objects with
    // `start` and `end` properties in `{line, column}` form (with
    // line being 1-based and column 0-based) will be attached to the
    // nodes.
    locations: false,
    // A function can be passed as `onComment` option, which will
    // cause Filbert to call that function with `(text, start,
    // end)` parameters whenever a comment is skipped.
    // `text` is the content of the comment, and `start` and `end` are
    // character offsets that denote the start and end of the comment.
    // When the `locations` option is on, two more parameters are
    // passed, the full `{line, column}` locations of the start and
    // end of the comments. Note that you are not allowed to call the
    // parser from the callback-that will corrupt its internal state.
    onComment: null,
    // [semi-standardized][range] `range` property holding a `[start,
    // end]` array with the same numbers, set the `ranges` option to
    // `true`.
    //
    // [range]: https://bugzilla.mozilla.org/show_bug.cgi?id=745678
    ranges: false,
    // It is possible to parse multiple files into a single AST by
    // passing the tree produced by parsing the first file as
    // `program` option in subsequent parses. This will add the
    // toplevel forms of the parsed file to the `Program` (top) node
    // of an existing parse tree.
    program: null,
    // When `locations` is on, you can pass this to record the source
    // file in every node's `loc` object.
    sourceFile: null,
    // This value, if given, is stored in every node, whether
    // `locations` is on or off.
    directSourceFile: null,
    // Python runtime library object name
    runtimeParamName: "__pythonRuntime"
  };

  function setOptions(opts) {
    options = opts || {};
    for (var opt in defaultOptions) if (!Object.prototype.hasOwnProperty.call(options, opt))
      options[opt] = defaultOptions[opt];
    sourceFile = options.sourceFile || null;
  }

  // The `getLineInfo` function is mostly useful when the
  // `locations` option is off (for performance reasons) and you
  // want to find the line/column position for a given character
  // offset. `input` should be the code string that the offset refers
  // into.

  var getLineInfo = exports.getLineInfo = function(input, offset) {
    for (var line = 1, cur = 0;;) {
      lineBreak.lastIndex = cur;
      var match = lineBreak.exec(input);
      if (match && match.index < offset) {
        ++line;
        cur = match.index + match[0].length;
      } else break;
    }
    return {line: line, column: offset - cur};
  };

  // Filbert is organized as a tokenizer and a recursive-descent parser.
  // The `tokenize` export provides an interface to the tokenizer.
  // Because the tokenizer is optimized for being efficiently used by
  // the Filbert parser itself, this interface is somewhat crude and not
  // very modular. Performing another parse or call to `tokenize` will
  // reset the internal state, and invalidate existing tokenizers.

  exports.tokenize = function(inpt, opts) {
    input = String(inpt); inputLen = input.length;
    setOptions(opts);
    initTokenState();

    var t = {};
    function getToken(forceRegexp) {
      lastEnd = tokEnd;
      readToken(forceRegexp);
      t.start = tokStart; t.end = tokEnd;
      t.startLoc = tokStartLoc; t.endLoc = tokEndLoc;
      t.type = tokType; t.value = tokVal;
      return t;
    }
    getToken.jumpTo = function(pos, reAllowed) {
      tokPos = pos;
      if (options.locations) {
        tokCurLine = 1;
        tokLineStart = lineBreak.lastIndex = 0;
        var match;
        while ((match = lineBreak.exec(input)) && match.index < pos) {
          ++tokCurLine;
          tokLineStart = match.index + match[0].length;
        }
      }
      tokRegexpAllowed = reAllowed;
      skipSpace();
    };
    return getToken;
  };

  // State is kept in (closure-)global variables. We already saw the
  // `options`, `input`, and `inputLen` variables above.

  // The current position of the tokenizer in the input.

  var tokPos;

  // The start and end offsets of the current token.

  var tokStart, tokEnd;

  // When `options.locations` is true, these hold objects
  // containing the tokens start and end line/column pairs.

  var tokStartLoc, tokEndLoc;

  // The type and value of the current token. Token types are objects,
  // named by variables against which they can be compared, and
  // holding properties that describe them (indicating, for example,
  // the precedence of an infix operator, and the original name of a
  // keyword token). The kind of value that's held in `tokVal` depends
  // on the type of the token. For literals, it is the literal value,
  // for operators, the operator name, and so on.

  var tokType, tokVal;

  // Interal state for the tokenizer. To distinguish between division
  // operators and regular expressions, it remembers whether the last
  // token was one that is allowed to be followed by an expression.
  // (If it is, a slash is probably a regexp, if it isn't it's a
  // division operator. See the `parseStatement` function for a
  // caveat.)

  var tokRegexpAllowed;

  // When `options.locations` is true, these are used to keep
  // track of the current line, and know when a new line has been
  // entered.

  var tokCurLine, tokLineStart;

  // These store the position of the previous token, which is useful
  // when finishing a node and assigning its `end` position.

  var lastStart, lastEnd, lastEndLoc;

  // This is the parser's state. `inFunction` is used to reject
  // `return` statements outside of functions, `strict` indicates
  // whether strict mode is on, and `bracketNesting` tracks the level
  // of nesting within brackets for implicit lint continuation.

  var inFunction, strict, bracketNesting;

  // This function is used to raise exceptions on parse errors. It
  // takes an offset integer (into the current `input`) to indicate
  // the location of the error, attaches the position to the end
  // of the error message, and then raises a `SyntaxError` with that
  // message.

  function raise(pos, message) {
    var loc = getLineInfo(input, pos);
    var err = new SyntaxError(message);
    err.pos = pos; err.loc = loc; err.raisedAt = tokPos;
    throw err;
  }

  // Reused empty array added for node fields that are always empty.

  var empty = [];

  // Used for name collision avoidance whend adding extra AST identifiers

  var newAstIdCount = 0;

  var indentHist = exports.indentHist = {
    // Current indentation stack
    indent: [],

    // Number of dedent tokens left (i.e. if tokType == _dedent, dedentCount > 0)
    // Multiple dedent tokens are read in at once, but processed individually in readToken()
    dedentCount: 0,

    init: function () { this.indent = []; this.dedentCount = 0; },
    count: function () { return this.indent.length; },
    len: function (i) { 
      if (typeof i === 'undefined' || i >= this.indent.length) i = this.indent.length - 1;
      return this.indent[i].length; 
    },
    isIndent: function(s) {
      return this.indent.length === 0 || s.length > this.len();
    },
    isDedent: function(s) {
      return this.indent.length > 0 && s.length < this.len();
    },
    addIndent: function (s) { this.indent.push(s); },
    addDedent: function (s) {
      this.dedentCount = 0;
      for (var i = this.indent.length - 1; i >= 0 && s.length < this.indent[i].length; --i)
        ++this.dedentCount;
    },
    updateDedent: function () { this.dedentCount = this.count(); },
    pop: function () {
      --this.dedentCount;
      this.indent.pop();
    },
    undoIndent: function () { this.pop(); }
  };

  // ## Scope

  // Collection of namespaces saved as a stack
  // A namespace is a mapping of identifiers to 3 types: variables, functions, classes
  // A namespace also knows whether it is for global, class, or function
  // A new namespace is pushed at function and class start, and popped at their end
  // Starts with a global namespace on the stack
  // E.g. scope.namespaces ~ [{type: 'g', map:{x: 'v', MyClass: 'c'} }, ...]

  // TODO: Not tracking built-in namespace
  
  var scope = exports.scope = {
    namespaces: [],
    init: function () { this.namespaces = [{ type: 'g', map: {} }]; },
    current: function(offset) { 
      offset = offset || 0;
      return this.namespaces[this.namespaces.length - offset - 1];
    },
    startClass: function (id) {
      this.current().map[id] = 'c';
      this.namespaces.push({ type: 'c', map: {}, className: id });
    },
    startFn: function (id) {
      this.current().map[id] = 'f';
      this.namespaces.push({ type: 'f', map: {}, fnName: id });
    },
    end: function () { this.namespaces.pop(); },
    addVar: function (id) { this.current().map[id] = 'v'; },
    exists: function (id) { return this.current().map.hasOwnProperty(id); },
    isClass: function () { return this.current().type === 'c'; },
    isUserFunction: function(name) {
      // Loose match (i.e. order ignored)
      // TODO: does not identify user-defined class methods
      for (var i = this.namespaces.length - 1; i >= 0; i--)
        for (var key in this.namespaces[i].map)
          if (key === name && this.namespaces[i].map[key] === 'f')
            return true;
      return false;
    },
    isParentClass: function() { return this.current(1).type === 'c'; },
    isNewObj: function (id) {
      for (var i = this.namespaces.length - 1; i >= 0; i--)
        if (this.namespaces[i].map[id] === 'c') return true;
        else if (this.namespaces[i].map[id] === 'f') break;
      return false;
    },
    getParentClassName: function () { return this.current(1).className; },
    getThisReplace: function () { return this.current().thisReplace; },
    setThisReplace: function (s) { this.current().thisReplace = s; }
  };
  

  // ## Token types

  // The assignment of fine-grained, information-carrying type objects
  // allows the tokenizer to store the information it has about a
  // token in a way that is very cheap for the parser to look up.

  // All token type variables start with an underscore, to make them
  // easy to recognize.

  // These are the general types. The `type` property is only used to
  // make them recognizeable when debugging.

  var _num = {type: "num"}, _regexp = {type: "regexp"}, _string = {type: "string"};
  var _name = {type: "name"}, _eof = {type: "eof"};
  var _newline = {type: "newline"}, _indent = {type: "indent"}, _dedent = {type: "dedent"};

  // Keyword tokens. The `keyword` property (also used in keyword-like
  // operators) indicates that the token originated from an
  // identifier-like word, which is used when parsing property names.
  //
  // The `beforeExpr` property is used to disambiguate between regular
  // expressions and divisions. It is set on all token types that can
  // be followed by an expression (thus, a slash after them would be a
  // regular expression).
  
  var _dict = { keyword: "dict" };  // TODO: not a keyword
  var _as = { keyword: "as" }, _assert = { keyword: "assert" }, _break = { keyword: "break" };
  var _class = { keyword: "class" }, _continue = { keyword: "continue" };
  var _def = { keyword: "def" }, _del = { keyword: "del" };
  var _elif = { keyword: "elif", beforeExpr: true }, _else = { keyword: "else", beforeExpr: true };
  var _except = { keyword: "except", beforeExpr: true }, _finally = {keyword: "finally"};
  var _for = { keyword: "for" }, _from = { keyword: "from" }, _global = { keyword: "global" };
  var _if = { keyword: "if" }, _import = { keyword: "import" };
  var _lambda = {keyword: "lambda"}, _nonlocal = {keyword: "nonlocal"};
  var _pass = { keyword: "pass" }, _raise = {keyword: "raise"};
  var _return = { keyword: "return", beforeExpr: true }, _try = { keyword: "try" };
  var _while = {keyword: "while"}, _with = {keyword: "with"}, _yield = {keyword: "yield"};

  // The keywords that denote values.

  var _none = {keyword: "None", atomValue: null}, _true = {keyword: "True", atomValue: true};
  var _false = {keyword: "False", atomValue: false};

  // Some keywords are treated as regular operators. `in` sometimes
  // (when parsing `for`) needs to be tested against specifically, so
  // we assign a variable name to it for quick comparing.
  // 'prec' is the operator precedence'

  var _or = { keyword: "or", prec: 1, beforeExpr: true, rep: "||" };
  var _and = { keyword: "and", prec: 2, beforeExpr: true, rep: "&&" };
  var _not = { keyword: "not", prec: 3, prefix: true, beforeExpr: true, rep: "!" };
  var _in = { keyword: "in", prec: 4, beforeExpr: true };
  var _is = { keyword: "is", prec: 4, beforeExpr: true };

  // Map keyword names to token types.

  var keywordTypes = {
    "dict": _dict,
    "False": _false, "None": _none, "True": _true, "and": _and, "as": _as, 
    "break": _break, "class": _class, "continue": _continue, "def": _def, "del": _del,
    "elif": _elif, "else": _else, "except": _except, "finally": _finally, "for": _for,
    "from": _from, "global": _global, "if": _if, "import": _import, "in": _in, "is": _is, 
    "lambda": _lambda, "nonlocal": _nonlocal, "not": _not, "or": _or, 
    "pass": _pass, "raise": _raise, "return": _return, "try": _try, "while": _while, 
    "with": _with, "yield": _yield
  };

  // Punctuation token types. Again, the `type` property is purely for debugging.

  var _bracketL = {type: "[", beforeExpr: true}, _bracketR = {type: "]"}, _braceL = {type: "{", beforeExpr: true};
  var _braceR = {type: "}"}, _parenL = {type: "(", beforeExpr: true}, _parenR = {type: ")"};
  var _comma = {type: ",", beforeExpr: true}, _semi = {type: ";", beforeExpr: true};
  var _colon = { type: ":", beforeExpr: true }, _dot = { type: "." }, _question = { type: "?", beforeExpr: true };
  
  // Operators. These carry several kinds of properties to help the
  // parser use them properly (the presence of these properties is
  // what categorizes them as operators).
  //
  // `prec` specifies the precedence of this operator.
  //
  // `prefix` marks the operator as a prefix unary operator. 
  //
  // `isAssign` marks all of `=`, `+=`, `-=` etcetera, which act as
  // binary operators with a very low precedence, that should result
  // in AssignmentExpression nodes.

  var _slash = { prec: 10, beforeExpr: true }, _eq = { isAssign: true, beforeExpr: true };
  var _assign = {isAssign: true, beforeExpr: true};
  var _equality = { prec: 4, beforeExpr: true };
  var _relational = {prec: 4, beforeExpr: true };
  var _bitwiseOR = { prec: 5, beforeExpr: true };
  var _bitwiseXOR = { prec: 6, beforeExpr: true };
  var _bitwiseAND = { prec: 7, beforeExpr: true };
  var _bitShift = { prec: 8, beforeExpr: true };
  var _plusMin = { prec: 9, beforeExpr: true };
  var _multiplyModulo = { prec: 10, beforeExpr: true };
  var _floorDiv = { prec: 10, beforeExpr: true };
  var _posNegNot = { prec: 11, prefix: true, beforeExpr: true };
  var _bitwiseNOT = { prec: 11, prefix: true, beforeExpr: true };
  var _exponentiation = { prec: 12, beforeExpr: true };

  // Provide access to the token types for external users of the
  // tokenizer.

  exports.tokTypes = {bracketL: _bracketL, bracketR: _bracketR, braceL: _braceL, braceR: _braceR,
                      parenL: _parenL, parenR: _parenR, comma: _comma, semi: _semi, colon: _colon,
                      dot: _dot, question: _question, slash: _slash, eq: _eq, name: _name, eof: _eof,
                      num: _num, regexp: _regexp, string: _string,
                      newline: _newline, indent: _indent, dedent: _dedent,
                      exponentiation: _exponentiation, floorDiv: _floorDiv, plusMin: _plusMin,
                      posNegNot: _posNegNot, multiplyModulo: _multiplyModulo
  };
  for (var kw in keywordTypes) exports.tokTypes["_" + kw] = keywordTypes[kw];

  // This is a trick taken from Esprima. It turns out that, on
  // non-Chrome browsers, to check whether a string is in a set, a
  // predicate containing a big ugly `switch` statement is faster than
  // a regular expression, and on Chrome the two are about on par.
  // This function uses `eval` (non-lexical) to produce such a
  // predicate from a space-separated string of words.
  //
  // It starts by sorting the words by length.

  function makePredicate(words) {
    words = words.split(" ");
    var f = "", cats = [];
    out: for (var i = 0; i < words.length; ++i) {
      for (var j = 0; j < cats.length; ++j)
        if (cats[j][0].length == words[i].length) {
          cats[j].push(words[i]);
          continue out;
        }
      cats.push([words[i]]);
    }
    function compareTo(arr) {
      if (arr.length == 1) return f += "return str === " + JSON.stringify(arr[0]) + ";";
      f += "switch(str){";
      for (var i = 0; i < arr.length; ++i) f += "case " + JSON.stringify(arr[i]) + ":";
      f += "return true}return false;";
    }

    // When there are more than three length categories, an outer
    // switch first dispatches on the lengths, to save on comparisons.

    if (cats.length > 3) {
      cats.sort(function(a, b) {return b.length - a.length;});
      f += "switch(str.length){";
      for (var i = 0; i < cats.length; ++i) {
        var cat = cats[i];
        f += "case " + cat[0].length + ":";
        compareTo(cat);
      }
      f += "}";

      // Otherwise, simply generate a flat `switch` statement.

    } else {
      compareTo(words);
    }
    return new Function("str", f);
  }

  // The forbidden variable names

  var isStrictBadIdWord = makePredicate("eval arguments");

  // Keywords
  // TODO: dict isn't a keyword, it's a builtin

  var isKeyword = makePredicate("dict False None True and as assert break class continue def del elif else except finally for from global if import in is lambda nonlocal not or pass raise return try while with yield");

  // ## Character categories

  // Big ugly regular expressions that match characters in the
  // whitespace, identifier, and identifier-start categories. These
  // are only applied when a character is found to actually have a
  // code point above 128.

  var nonASCIIwhitespace = /[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/;
  var nonASCIIidentifierStartChars = "\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc";
  var nonASCIIidentifierChars = "\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u0620-\u0649\u0672-\u06d3\u06e7-\u06e8\u06fb-\u06fc\u0730-\u074a\u0800-\u0814\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0840-\u0857\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962-\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09d7\u09df-\u09e0\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5f-\u0b60\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2-\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d46-\u0d48\u0d57\u0d62-\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e34-\u0e3a\u0e40-\u0e45\u0e50-\u0e59\u0eb4-\u0eb9\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f41-\u0f47\u0f71-\u0f84\u0f86-\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1029\u1040-\u1049\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u170e-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17b2\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1920-\u192b\u1930-\u193b\u1951-\u196d\u19b0-\u19c0\u19c8-\u19c9\u19d0-\u19d9\u1a00-\u1a15\u1a20-\u1a53\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b46-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1bb0-\u1bb9\u1be6-\u1bf3\u1c00-\u1c22\u1c40-\u1c49\u1c5b-\u1c7d\u1cd0-\u1cd2\u1d00-\u1dbe\u1e01-\u1f15\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2d81-\u2d96\u2de0-\u2dff\u3021-\u3028\u3099\u309a\ua640-\ua66d\ua674-\ua67d\ua69f\ua6f0-\ua6f1\ua7f8-\ua800\ua806\ua80b\ua823-\ua827\ua880-\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8f3-\ua8f7\ua900-\ua909\ua926-\ua92d\ua930-\ua945\ua980-\ua983\ua9b3-\ua9c0\uaa00-\uaa27\uaa40-\uaa41\uaa4c-\uaa4d\uaa50-\uaa59\uaa7b\uaae0-\uaae9\uaaf2-\uaaf3\uabc0-\uabe1\uabec\uabed\uabf0-\uabf9\ufb20-\ufb28\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f";
  var nonASCIIidentifierStart = new RegExp("[" + nonASCIIidentifierStartChars + "]");
  var nonASCIIidentifier = new RegExp("[" + nonASCIIidentifierStartChars + nonASCIIidentifierChars + "]");

  // Whether a single character denotes a newline.

  var newline = /[\n\r\u2028\u2029]/;

  // Matches a whole line break (where CRLF is considered a single
  // line break). Used to count lines.

  var lineBreak = /\r\n|[\n\r\u2028\u2029]/g;

  // Test whether a given character code starts an identifier.

  var isIdentifierStart = exports.isIdentifierStart = function(code) {
    if (code < 65) return code === 36;
    if (code < 91) return true;
    if (code < 97) return code === 95;
    if (code < 123)return true;
    return code >= 0xaa && nonASCIIidentifierStart.test(String.fromCharCode(code));
  };

  // Test whether a given character is part of an identifier.

  var isIdentifierChar = exports.isIdentifierChar = function(code) {
    if (code < 48) return code === 36;
    if (code < 58) return true;
    if (code < 65) return false;
    if (code < 91) return true;
    if (code < 97) return code === 95;
    if (code < 123)return true;
    return code >= 0xaa && nonASCIIidentifier.test(String.fromCharCode(code));
  };

  // ## Tokenizer

  // These are used when `options.locations` is on, for the
  // `tokStartLoc` and `tokEndLoc` properties.

  function Position() {
    this.line = tokCurLine;
    this.column = tokPos - tokLineStart;
  }

  // Reset the token state. Used at the start of a parse.

  function initTokenState() {
    tokCurLine = 1;
    tokPos = tokLineStart = 0;
    tokRegexpAllowed = true;
    indentHist.init();
    newAstIdCount = 0;
    scope.init();
  }

  // Called at the end of every token. Sets `tokEnd`, `tokVal`, and
  // `tokRegexpAllowed`, and skips the space after the token, so that
  // the next one's `tokStart` will point at the right position.

  function finishToken(type, val) {
    tokEnd = tokPos;
    if (options.locations) tokEndLoc = new Position;
    tokType = type;
    if (type === _parenL || type === _braceL || type === _bracketL) ++bracketNesting;
    if (type === _parenR || type === _braceR || type === _bracketR) --bracketNesting;
    if (type !== _newline) skipSpace();
    tokVal = val;
    tokRegexpAllowed = type.beforeExpr;
  }

  function skipLine() {
    var ch = input.charCodeAt(++tokPos);
    while (tokPos < inputLen && !isNewline(ch)) {
      ++tokPos;
      ch = input.charCodeAt(tokPos);
    }
  }

  function skipLineComment() {
    var start = tokPos;
    var startLoc = options.onComment && options.locations && new Position;
    skipLine();
    if (options.onComment)
      options.onComment(input.slice(start + 1, tokPos), start, tokPos,
                        startLoc, options.locations && new Position);
  }

  // Called at the start of the parse and after every token. Skips
  // whitespace and comments, and.

  function skipSpace() {
    while (tokPos < inputLen) {
      var ch = input.charCodeAt(tokPos);
      if (ch === 35) skipLineComment();
      else if (ch === 92) {
        ++tokPos;
        if (isNewline(input.charCodeAt(tokPos))) {
          if (input.charCodeAt(tokPos) === 13 && input.charCodeAt(tokPos+1) === 10) ++tokPos;
          ++tokPos;
          if (options.location) { tokLineStart = tokPos; ++tokCurLine; }
        } else {
          raise(tokPos, "Unexpected character after line continuation character");
        }
      }
      else if (isSpace(ch)) ++tokPos;
      else if (bracketNesting > 0 && isNewline(ch)) {
        if (ch === 13 && input.charCodeAt(tokPos+1) === 10) ++tokPos;
        ++tokPos;
        if (options.location) { tokLineStart = tokPos; ++tokCurLine; }
      }
      else break;
    }
  }

  function isSpace(ch) {
    if (ch === 32 || // ' '
      ch === 9 || ch === 11 || ch === 12 ||
      ch === 160 || // '\xa0'
      ch >= 5760 && nonASCIIwhitespace.test(String.fromCharCode(ch))) {
      return true;
    }
    return false;
  }

  function isNewline(ch) {
    if (ch === 10 || ch === 13 ||
      ch === 8232 || ch === 8233) {
      return true;
    }
    return false;
  }

  // ### Token reading

  // This is the function that is called to fetch the next token. It
  // is somewhat obscure, because it works in character codes rather
  // than characters, and because operator parsing has been inlined
  // into it.
  //
  // All in the name of speed.
  //
  // The `forceRegexp` parameter is used in the one case where the
  // `tokRegexpAllowed` trick does not work. See `parseStatement`.

  function readToken_dot() {
    var next = input.charCodeAt(tokPos + 1);
    if (next >= 48 && next <= 57) return readNumber(true);
    ++tokPos;
    return finishToken(_dot);
  }

  function readToken_slash() { // '/'
    if (tokRegexpAllowed) { ++tokPos; return readRegexp(); }
    var next = input.charCodeAt(tokPos + 1);
    if (next === 47) return finishOp(_floorDiv, 2);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(_slash, 1);
  }

  function readToken_mult_modulo(code) { // '*%'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 42 && next === code) return finishOp(_exponentiation, 2);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(_multiplyModulo, 1);
  }
  
  function readToken_pipe_amp(code) { // '|&'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(code === 124 ? _bitwiseOR : _bitwiseAND, 1);
  }

  function readToken_caret() { // '^'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(_bitwiseXOR, 1);
  }

  function readToken_plus_min(code) { // '+-'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 61) return finishOp(_assign, 2);
    return finishOp(_plusMin, 1);
  }

  function readToken_lt_gt(code) { // '<>'
    var next = input.charCodeAt(tokPos + 1);
    var size = 1;
    if (next === code) {
      size = 2;
      if (input.charCodeAt(tokPos + size) === 61) return finishOp(_assign, size + 1);
      return finishOp(_bitShift, size);
    }
    if (next === 61) size = 2;
    return finishOp(_relational, size);
  }

  function readToken_eq_excl(code) { // '=!'
    var next = input.charCodeAt(tokPos + 1);
    if (next === 61) return finishOp(_equality, 2);
    return finishOp(_eq, 1);
  }

  // Parse indentation
  // Possible output: _indent, _dedent, _eof, readToken()
  // TODO: disallow unequal indents of same length (e.g. nested if/else block)

  function readToken_indent() {
    // Read indent, skip empty lines and comments
    var indent = "";
    var indentPos = tokPos;
    var ch, next;
    while (indentPos < inputLen) {
      ch = input.charCodeAt(indentPos);
      if (isSpace(ch)) {
        indent += String.fromCharCode(ch);
        ++indentPos;
      } else if (isNewline(ch)) { // newline
        indent = "";
        if (ch === 13 && input.charCodeAt(indentPos + 1) === 10) ++indentPos;
        ++indentPos;
        tokPos = indentPos;
        if (options.locations) {
          tokLineStart = indentPos;
          ++tokCurLine;
        }
      } else if (ch === 35) { // '#'
        do {
          next = input.charCodeAt(++indentPos);
        } while (indentPos < inputLen && next !== 10);
        // TODO: call onComment
      } else {
        break;
      }
    }

    // Determine token type based on indent found versus indentation history
    var type;
    if (indent.length > 0) {
      if (indentHist.isIndent(indent)) {
        type = _indent;
        if (indentHist.count() >= 1) tokStart += indentHist.len(indentHist.count() - 1);
        indentHist.addIndent(indent);
      } else if (indentHist.isDedent(indent)) {
        type = _dedent;
        indentHist.addDedent(indent);
        var nextDedent = indentHist.count() - indentHist.dedentCount;
        if (nextDedent >= 2) {
          tokStart += indentHist.len(nextDedent) - indentHist.len(nextDedent - 1);
        }
      } else {
        tokPos += indent.length;
      }
    } else if (indentPos >= inputLen) {
      type = _eof;
    } else if (indentHist.count() > 0) {
      type = _dedent;
      indentHist.updateDedent();
    }

    switch (type) {
      case _indent: case _dedent: return finishOp(type, indentPos - ++tokPos);
      case _eof:
        tokPos = inputLen;
        if (options.locations) tokStartLoc = new Position;
        return finishOp(type, 0);
      default:
        tokType = null;
        return readToken();
    }
  }

  function getTokenFromCode(code) {
    switch(code) {

    case 13: case 10: case 8232: case 8233:
      ++tokPos;
      if (code === 13 && input.charCodeAt(tokPos) === 10) ++tokPos;
      if (options.locations) {
        ++tokCurLine;
        tokLineStart = tokPos;
      }
      return finishToken(_newline);

    case 35: // '#'
      skipLineComment();
      return readToken();

      // The interpretation of a dot depends on whether it is followed
      // by a digit.
    case 46: // '.'
      return readToken_dot();

      // Punctuation tokens.
    case 40: ++tokPos; return finishToken(_parenL);
    case 41: ++tokPos; return finishToken(_parenR);
    case 59: ++tokPos; return finishToken(_semi);
    case 44: ++tokPos; return finishToken(_comma);
    case 91: ++tokPos; return finishToken(_bracketL);
    case 93: ++tokPos; return finishToken(_bracketR);
    case 123: ++tokPos; return finishToken(_braceL);
    case 125: ++tokPos; return finishToken(_braceR);
    case 58: ++tokPos; return finishToken(_colon);
    case 63: ++tokPos; return finishToken(_question);

      // '0x' is a hexadecimal number.
    case 48: // '0'
      var next = input.charCodeAt(tokPos + 1);
      if (next === 120 || next === 88) return readHexNumber();
      // Anything else beginning with a digit is an integer, octal
      // number, or float.
    case 49: case 50: case 51: case 52: case 53: case 54: case 55: case 56: case 57: // 1-9
      return readNumber(false);

      // Quotes produce strings.
    case 34: case 39: // '"', "'"
      return readString(code);

    // Operators are parsed inline in tiny state machines. '=' (61) is
    // often referred to. `finishOp` simply skips the amount of
    // characters it is given as second argument, and returns a token
    // of the type given by its first argument.

    case 47: // '/'
      return readToken_slash(code);

    case 42: case 37: // '*%'
      return readToken_mult_modulo(code);

    case 124: case 38: // '|&'
      return readToken_pipe_amp(code);

    case 94: // '^'
      return readToken_caret();

    case 43: case 45: // '+-'
      return readToken_plus_min(code);

    case 60: case 62: // '<>'
      return readToken_lt_gt(code);

    case 61: case 33: // '=!'
      return readToken_eq_excl(code);

    case 126: // '~'
      return finishOp(_bitwiseNOT, 1);
    }

    return false;
  }

  function readToken(forceRegexp) {
    if (tokType === _dedent) {
      indentHist.pop();
      if (indentHist.dedentCount > 0) return;
    }

    if (!forceRegexp) tokStart = tokPos;
    else tokPos = tokStart + 1;
    if (options.locations) tokStartLoc = new Position;
    if (forceRegexp) return readRegexp();
    if (tokPos >= inputLen) return finishToken(_eof);
    if (tokType === _newline) return readToken_indent();

    var code = input.charCodeAt(tokPos);
    // Identifier or keyword. '\uXXXX' sequences are allowed in
    // identifiers, so '\' also dispatches to that.
    if (isIdentifierStart(code) || code === 92 /* '\' */) return readWord();

    var tok = getTokenFromCode(code);

    if (tok === false) {
      // If we are here, we either found a non-ASCII identifier
      // character, or something that's entirely disallowed.
      var ch = String.fromCharCode(code);
      if (ch === "\\" || nonASCIIidentifierStart.test(ch)) return readWord();
      raise(tokPos, "Unexpected character '" + ch + "'");
    }
    return tok;
  }

  function finishOp(type, size) {
    var str = input.slice(tokPos, tokPos + size);
    tokPos += size;
    finishToken(type, str);
  }

  // Parse a regular expression. Some context-awareness is necessary,
  // since a '/' inside a '[]' set does not end the expression.

  function readRegexp() {
    var content = "", escaped, inClass, start = tokPos, value;
    for (;;) {
      if (tokPos >= inputLen) raise(start, "Unterminated regular expression");
      var ch = input.charAt(tokPos);
      if (newline.test(ch)) raise(start, "Unterminated regular expression");
      if (!escaped) {
        if (ch === "[") inClass = true;
        else if (ch === "]" && inClass) inClass = false;
        else if (ch === "/" && !inClass) break;
        escaped = ch === "\\";
      } else escaped = false;
      ++tokPos;
    }
    content = input.slice(start, tokPos);
    ++tokPos;
    // Need to use `readWord1` because '\uXXXX' sequences are allowed
    // here (don't ask).
    var mods = readWord1();
    if (mods && !/^[gmsiy]*$/.test(mods)) raise(start, "Invalid regular expression flag");
    try {
      value = new RegExp(content, mods);
    } catch (e) {
      if (e instanceof SyntaxError) raise(start, "Error parsing regular expression: " + e.message);
      raise(e);
    }
    return finishToken(_regexp, value);
  }

  // Read an integer in the given radix. Return null if zero digits
  // were read, the integer value otherwise. When `len` is given, this
  // will return `null` unless the integer has exactly `len` digits.

  function readInt(radix, len) {
    var start = tokPos, total = 0;
    for (var i = 0, e = len == null ? Infinity : len; i < e; ++i) {
      var code = input.charCodeAt(tokPos), val;
      if (code >= 97) val = code - 97 + 10; // a
      else if (code >= 65) val = code - 65 + 10; // A
      else if (code >= 48 && code <= 57) val = code - 48; // 0-9
      else val = Infinity;
      if (val >= radix) break;
      ++tokPos;
      total = total * radix + val;
    }
    if (tokPos === start || len != null && tokPos - start !== len) return null;

    return total;
  }

  function readHexNumber() {
    tokPos += 2; // 0x
    var val = readInt(16);
    if (val == null) raise(tokStart + 2, "Expected hexadecimal number");
    if (isIdentifierStart(input.charCodeAt(tokPos))) raise(tokPos, "Identifier directly after number");
    return finishToken(_num, val);
  }

  // Read an integer, octal integer, or floating-point number.

  function readNumber(startsWithDot) {
    var start = tokPos, isFloat = false, octal = input.charCodeAt(tokPos) === 48;
    if (!startsWithDot && readInt(10) === null) raise(start, "Invalid number");
    if (input.charCodeAt(tokPos) === 46) {
      ++tokPos;
      readInt(10);
      isFloat = true;
    }
    var next = input.charCodeAt(tokPos);
    if (next === 69 || next === 101) { // 'eE'
      next = input.charCodeAt(++tokPos);
      if (next === 43 || next === 45) ++tokPos; // '+-'
      if (readInt(10) === null) raise(start, "Invalid number");
      isFloat = true;
    }
    if (isIdentifierStart(input.charCodeAt(tokPos))) raise(tokPos, "Identifier directly after number");

    var str = input.slice(start, tokPos), val;
    if (isFloat) val = parseFloat(str);
    else if (!octal || str.length === 1) val = parseInt(str, 10);
    else if (/[89]/.test(str) || strict) raise(start, "Invalid number");
    else val = parseInt(str, 8);
    return finishToken(_num, val);
  }

  // Read a string value, interpreting backslash-escapes.

  function readString(quote) {
    tokPos++;
    var ch = input.charCodeAt(tokPos);
    var tripleQuoted = false;
    if (ch === quote && input.charCodeAt(tokPos+1) === quote) {
      tripleQuoted = true;
      tokPos += 2;
    }
    var out = "";
    for (;;) {
      if (tokPos >= inputLen) raise(tokStart, "Unterminated string constant");
      var ch = input.charCodeAt(tokPos);
      if (ch === quote) {
        if (tripleQuoted) {
          if (input.charCodeAt(tokPos+1) === quote &&
              input.charCodeAt(tokPos+2) === quote) {
            tokPos += 3;
            return finishToken(_string, out);
          }
        } else {
          ++tokPos;
          return finishToken(_string, out);
        }
      }
      if (ch === 92) { // '\'
        ch = input.charCodeAt(++tokPos);
        var octal = /^[0-7]+/.exec(input.slice(tokPos, tokPos + 3));
        if (octal) octal = octal[0];
        while (octal && parseInt(octal, 8) > 255) octal = octal.slice(0, -1);
        if (octal === "0") octal = null;
        ++tokPos;
        if (octal) {
          if (strict) raise(tokPos - 2, "Octal literal in strict mode");
          out += String.fromCharCode(parseInt(octal, 8));
          tokPos += octal.length - 1;
        } else {
          switch (ch) {
          case 110: out += "\n"; break; // 'n' -> '\n'
          case 114: out += "\r"; break; // 'r' -> '\r'
          case 120: out += String.fromCharCode(readHexChar(2)); break; // 'x'
          case 117: out += String.fromCharCode(readHexChar(4)); break; // 'u'
          case 85: // 'U'
            ch = readHexChar(8);
            if (ch < 0xFFFF && (ch < 0xD800 || 0xDBFF < ch)) out += String.fromCharCode(ch); // If it's UTF-16
            else { // If we need UCS-2
              ch -= 0x10000;
              out += String.fromCharCode((ch>>10)+0xd800)+String.fromCharCode((ch%0x400)+0xdc00);
            }
            break;
          case 116: out += "\t"; break; // 't' -> '\t'
          case 98: out += "\b"; break; // 'b' -> '\b'
          case 118: out += "\u000b"; break; // 'v' -> '\u000b'
          case 102: out += "\f"; break; // 'f' -> '\f'
          case 48: out += "\0"; break; // 0 -> '\0'
          case 13: if (input.charCodeAt(tokPos) === 10) ++tokPos; // '\r\n'
          case 10: // ' \n'
            if (options.locations) { tokLineStart = tokPos; ++tokCurLine; }
            break;
          default: out += '\\' + String.fromCharCode(ch); break; // Python doesn't remove slashes on failed escapes
          }
        }
      } else {
        if (isNewline(ch)) {
          if (tripleQuoted) {
            out += String.fromCharCode(ch);
            ++tokPos;
            if (ch === 13 && input.charCodeAt(tokPos) === 10) {
              ++tokPos;
              out += "\n";
            }
            if (options.location) { tokLineStart = tokPos; ++tokCurLine; }
          } else raise(tokStart, "Unterminated string constant");
        } else {
          out += String.fromCharCode(ch); // '\'
          ++tokPos;
        }
      }
    }
  }

  // Used to read character escape sequences ('\x', '\u', '\U').

  function readHexChar(len) {
    var n = readInt(16, len);
    if (n === null) raise(tokStart, "Bad character escape sequence");
    return n;
  }

  // Used to signal to callers of `readWord1` whether the word
  // contained any escape sequences. This is needed because words with
  // escape sequences must not be interpreted as keywords.

  var containsEsc;

  // Read an identifier, and return it as a string. Sets `containsEsc`
  // to whether the word contained a '\u' escape.
  //
  // Only builds up the word character-by-character when it actually
  // containeds an escape, as a micro-optimization.

  function readWord1() {
    containsEsc = false;
    var word, first = true, start = tokPos;
    for (;;) {
      var ch = input.charCodeAt(tokPos);
      if (isIdentifierChar(ch)) {
        if (containsEsc) word += input.charAt(tokPos);
        ++tokPos;
      } else if (ch === 92) { // "\"
        if (!containsEsc) word = input.slice(start, tokPos);
        containsEsc = true;
        if (input.charCodeAt(++tokPos) != 117) // "u"
          raise(tokPos, "Expecting Unicode escape sequence \\uXXXX");
        ++tokPos;
        var esc = readHexChar(4);
        var escStr = String.fromCharCode(esc);
        if (!escStr) raise(tokPos - 1, "Invalid Unicode escape");
        if (!(first ? isIdentifierStart(esc) : isIdentifierChar(esc)))
          raise(tokPos - 4, "Invalid Unicode escape");
        word += escStr;
      } else {
        break;
      }
      first = false;
    }
    return containsEsc ? word : input.slice(start, tokPos);
  }

  // Read an identifier or keyword token. Will check for reserved
  // words when necessary.

  function readWord() {
    var word = readWord1();
    var type = _name;
    if (!containsEsc && isKeyword(word))
      type = keywordTypes[word];
    return finishToken(type, word);
  }

  // ## Parser

  // A recursive descent parser operates by defining functions for all
  // syntactic elements, and recursively calling those, each function
  // advancing the input stream and returning an AST node. Precedence
  // of constructs (for example, the fact that `!x[1]` means `!(x[1])`
  // instead of `(!x)[1]` is handled by the fact that the parser
  // function that parses unary prefix operators is called first, and
  // in turn calls the function that parses `[]` subscripts - that
  // way, it'll receive the node for `x[1]` already parsed, and wraps
  // *that* in the unary operator node.
  //
  // Acorn uses an [operator precedence parser][opp] to handle binary
  // operator precedence, because it is much more compact than using
  // the technique outlined above, which uses different, nesting
  // functions to specify precedence, for all of the ten binary
  // precedence levels that JavaScript defines.
  //
  // [opp]: http://en.wikipedia.org/wiki/Operator-precedence_parser

  // ### Parser utilities

  // Continue to the next token.

  function next() {
    lastStart = tokStart;
    lastEnd = tokEnd;
    lastEndLoc = tokEndLoc;
    readToken();
  }

  // Enter strict mode. Re-reads the next token to please pedantic
  // tests ("use strict"; 010; -- should fail).

  function setStrict(strct) {
    strict = strct;
    tokPos = tokStart;
    if (options.locations) {
      while (tokPos < tokLineStart) {
        tokLineStart = input.lastIndexOf("\n", tokLineStart - 2) + 1;
        --tokCurLine;
      }
    }
    skipSpace();
    readToken();
  }

  // Start an AST node, attaching a start offset.

  function Node() {
    this.type = null;
  }

  exports.Node = Node;

  function SourceLocation() {
    this.start = tokStartLoc;
    this.end = null;
    if (sourceFile !== null) this.source = sourceFile;
  }

  function startNode() {
    var node = new Node();
    if (options.locations)
      node.loc = new SourceLocation();
    if (options.directSourceFile)
      node.sourceFile = options.directSourceFile;
    if (options.ranges)
      node.range = [tokStart, 0];
    return node;
  }

  // Finish an AST node, adding `type` and `end` properties.

  function finishNode(node, type) {
    node.type = type;
    if (options.locations)
      node.loc.end = lastEndLoc;
    if (options.ranges)
      node.range[1] = lastEnd;
    return node;
  }

  // Start a node whose start offset information should be based on
  // the start of another node. For example, a binary operator node is
  // only started after its left-hand side has already been parsed.

  function startNodeFrom(other) {
    var node = new Node();
    if (options.locations) {
      node.loc = new SourceLocation();
      node.loc.start = other.loc.start;
    }
    if (options.ranges)
      node.range = [other.range[0], 0];

    return node;
  }

  // ## Node creation utilities

  var getNodeCreator = exports.getNodeCreator = function(startNode, startNodeFrom, finishNode, unpackTuple) {

    return {

      // Finish a node whose end offset information should be based on
      // the end of another node.  For example, createNode* functions
      // are used to create extra AST nodes which may be based on a single
      // parsed user code node.

      finishNodeFrom: function (endNode, node, type) {
        node.type = type;
        if (options.locations) node.loc.end = endNode.loc.end;
        if (options.ranges) node.range[1] = endNode.range[1];
        return node;
      },

      // Create an AST node using start offsets

      createNodeFrom: function (startNode, type, props) {
        var node = startNodeFrom(startNode);
        for (var prop in props) node[prop] = props[prop];
        return finishNode(node, type);
      },

      // Create an AST node using start and end offsets

      createNodeSpan: function (startNode, endNode, type, props) {
        var node = startNodeFrom(startNode);
        for (var prop in props) node[prop] = props[prop];
        return this.finishNodeFrom(endNode, node, type);
      },

      createGeneratedNodeSpan: function (startNode, endNode, type, props) {
        var node = startNodeFrom(startNode);
        for (var prop in props) node[prop] = props[prop];
        node.userCode = false;
        return this.finishNodeFrom(endNode, node, type);
      },

      // while (__formalsIndex < __params.formals.length) {
      //   <argsId>.push(__params.formals[__formalsIndex++]); }
      createNodeArgsWhileConsequent: function (argsId, s) {
        var __paramsFormals = this.createNodeMembIds(argsId, '__params' + s, 'formals');
        var __formalsIndexId = this.createGeneratedNodeSpan(argsId, argsId, "Identifier", { name: '__formalsIndex' + s });
        return this.createGeneratedNodeSpan(argsId, argsId, "WhileStatement", {
          test: this.createGeneratedNodeSpan(argsId, argsId, "BinaryExpression", {
            operator: '<', left: __formalsIndexId,
            right: this.createGeneratedNodeSpan(argsId, argsId, "MemberExpression", {
              computed: false, object: __paramsFormals,
              property: this.createGeneratedNodeSpan(argsId, argsId, "Identifier", { name: 'length' })
            })
          }),
          body: this.createGeneratedNodeSpan(argsId, argsId, "BlockStatement", {
            body: [this.createGeneratedNodeSpan(argsId, argsId, "ExpressionStatement", {
              expression: this.createGeneratedNodeSpan(argsId, argsId, "CallExpression", {
                callee: this.createNodeMembIds(argsId, argsId.name, 'push'),
                arguments: [this.createGeneratedNodeSpan(argsId, argsId, "MemberExpression", {
                  computed: true, object: __paramsFormals,
                  property: this.createGeneratedNodeSpan(argsId, argsId, "UpdateExpression", {
                    operator: '++', prefix: false, argument: __formalsIndexId
                  })
                })]
              })
            })]
          })
        });
      },

      // { while (__formalsIndex < __args.length) {
      //   <argsId>.push(__args[__formalsIndex++]); }}
      createNodeArgsAlternate: function (argsId, s) {
        var __args = '__args' + s;
        var __formalsIndexId = this.createGeneratedNodeSpan(argsId, argsId, "Identifier", { name: '__formalsIndex' + s });
        return this.createGeneratedNodeSpan(argsId, argsId, "BlockStatement", {
          body: [this.createGeneratedNodeSpan(argsId, argsId, "WhileStatement", {
            test: this.createGeneratedNodeSpan(argsId, argsId, "BinaryExpression", {
              operator: '<', left: __formalsIndexId,
              right: this.createNodeMembIds(argsId, __args, 'length')
            }),
            body: this.createGeneratedNodeSpan(argsId, argsId, "BlockStatement", {
              body: [this.createGeneratedNodeSpan(argsId, argsId, "ExpressionStatement", {
                expression: this.createGeneratedNodeSpan(argsId, argsId, "CallExpression", {
                  callee: this.createNodeMembIds(argsId, argsId.name, 'push'),
                  arguments: [this.createGeneratedNodeSpan(argsId, argsId, "MemberExpression", {
                    computed: true,
                    object: this.createGeneratedNodeSpan(argsId, argsId, "Identifier", { name: __args }),
                    property: this.createGeneratedNodeSpan(argsId, argsId, "UpdateExpression", {
                      operator: '++', prefix: false, argument: __formalsIndexId
                    })
                  })]
                })
              })]
            })
          })]
        });
      },

      // return (function() {<body>}).call(this);
      createNodeFnBodyIife: function (body) {
        var iifeBody = this.createGeneratedNodeSpan(body, body, "FunctionExpression", {
          params: [], defaults: [], body: body, generator: false, expression: false
        });
        var iifeCall = this.createGeneratedNodeSpan(body, body, "CallExpression", {
          callee: this.createGeneratedNodeSpan(body, body, "MemberExpression", {
            computed: false, object: iifeBody,
            property: this.createGeneratedNodeSpan(body, body, "Identifier", { name: 'call' })
          }),
          arguments: [this.createGeneratedNodeSpan(body, body, "ThisExpression")]
        });
        return this.createGeneratedNodeSpan(body, body, "ReturnStatement", { argument: iifeCall });
      },

      // E.g. Math.pow(2, 3)

      createNodeMemberCall: function (node, object, property, args) {
        var objId = this.createNodeFrom(node, "Identifier", { name: object });
        var propId = this.createNodeFrom(node, "Identifier", { name: property });
        var member = this.createNodeFrom(node, "MemberExpression", { object: objId, property: propId, computed: false });
        node.callee = member;
        node.arguments = args;
        return finishNode(node, "CallExpression");
      },

      // o.p
      createNodeMembIds: function(r, o, p) {
        return this.createNodeSpan(r, r, "MemberExpression", {
          computed: false,
          object: this.createNodeSpan(r, r, "Identifier", { name: o }),
          property: this.createNodeSpan(r, r, "Identifier", { name: p })
        })
      },

      // o[p]
      createNodeMembIdLit: function(r, o, p) {
        return this.createNodeSpan(r, r, "MemberExpression", {
          computed: true,
          object: this.createNodeSpan(r, r, "Identifier", { name: o }),
          property: this.createNodeSpan(r, r, "Literal", { value: p })
        })
      },

      // E.g. pyRuntime.ops.add

      createNodeOpsCallee: function (node, fnName) {
        var runtimeId = this.createGeneratedNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
        var opsId = this.createGeneratedNodeSpan(node, node, "Identifier", { name: "ops" });
        var addId = this.createGeneratedNodeSpan(node, node, "Identifier", { name: fnName });
        var opsMember = this.createGeneratedNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: opsId, computed: false });
        return this.createGeneratedNodeSpan(node, node, "MemberExpression", { object: opsMember, property: addId, computed: false });
      },

      // var __params = arguments.length === 1 && arguments[0].formals && arguments[0].keywords ? arguments[0] : null;
      createNodeParamsCheck: function (r, s) {
        var __paramsId = this.createNodeSpan(r, r, "Identifier", { name: '__params' + s });
        var arguments0 = this.createNodeMembIdLit(r, 'arguments', 0);
        var checks = this.createNodeSpan(r, r, "ConditionalExpression", {
          test: this.createNodeSpan(r, r, "LogicalExpression", {
            operator: '&&',
            left: this.createNodeSpan(r, r, "LogicalExpression", {
              operator: '&&',
              left: this.createNodeSpan(r, r, "BinaryExpression", {
                operator: '===',
                left: this.createNodeMembIds(r, 'arguments', 'length'),
                right: this.createNodeSpan(r, r, "Literal", { value: 1 })
              }),
              right: this.createNodeSpan(r, r, "MemberExpression", {
                computed: false, object: arguments0,
                property: this.createNodeSpan(r, r, "Identifier", { name: 'formals' }),
              })
            }),
            right: this.createNodeSpan(r, r, "MemberExpression", {
              computed: false, object: arguments0,
              property: this.createNodeSpan(r, r, "Identifier", { name: 'keywords' }),
            })
          }),
          consequent: arguments0,
          alternate: this.createNodeSpan(r, r, "Literal", { value: null })
        });
        return this.createGeneratedVarDeclFromId(r, __paramsId, checks);
      },

      // function __getParam(v, d) {
      //   var r = d;
      //   if (__params) {
      //     if (__formalsIndex < __params.formals.length) {
      //       r = __params.formals[__formalsIndex++];
      //     } else if (v in __params.keywords) {
      //       r = __params.keywords[v];
      //       delete __params.keywords[v];
      //     }
      //   } else if (__formalsIndex < __args.length) {
      //     r = __args[__formalsIndex++];
      //   }
      //   return r;
      // }
      createNodeGetParamFn: function (r, s) {
        var dId = this.createNodeSpan(r, r, "Identifier", { name: 'd' });
        var vId = this.createNodeSpan(r, r, "Identifier", { name: 'v' });
        var rId = this.createNodeSpan(r, r, "Identifier", { name: 'r' });
        var __formalsIndexId = this.createNodeSpan(r, r, "Identifier", { name: '__formalsIndex' + s });
        var __params = '__params' + s;
        var __getParam = '__getParam' + s;
        var __args = '__args' + s;
        var __paramsFormals = this.createNodeMembIds(r, __params, 'formals');
        var __paramsKeywords = this.createNodeMembIds(r, __params, 'keywords')
        var __paramsKeywordsV = this.createNodeSpan(r, r, "MemberExpression", { computed: true, property: vId, object: __paramsKeywords });
        return this.createGeneratedNodeSpan(r, r, "FunctionDeclaration", {
          id: this.createNodeSpan(r, r, "Identifier", { name: __getParam }),
          params: [vId, dId],
          defaults: [],
          body: this.createNodeSpan(r, r, "BlockStatement", {
            body: [this.createGeneratedVarDeclFromId(r, rId, dId),
              this.createGeneratedNodeSpan(r, r, "IfStatement", {
                test: this.createNodeSpan(r, r, "Identifier", { name: __params }),
                consequent: this.createNodeSpan(r, r, "BlockStatement", {
                  body: [this.createGeneratedNodeSpan(r, r, "IfStatement", {
                    test: this.createNodeSpan(r, r, "BinaryExpression", {
                      operator: '<', left: __formalsIndexId,
                      right: this.createNodeSpan(r, r, "MemberExpression", {
                        computed: false, object: __paramsFormals,
                        property: this.createNodeSpan(r, r, "Identifier", { name: 'length' })
                      })
                    }),
                    consequent: this.createNodeSpan(r, r, "BlockStatement", {
                      body: [this.createGeneratedNodeSpan(r, r, "ExpressionStatement", {
                        expression: this.createGeneratedNodeSpan(r, r, "AssignmentExpression", {
                          operator: '=', left: rId,
                          right: this.createNodeSpan(r, r, "MemberExpression", {
                            computed: true, object: __paramsFormals,
                            property: this.createNodeSpan(r, r, "UpdateExpression", {
                              operator: '++', argument: __formalsIndexId, prefix: false
                            })
                          })
                        })
                      })]
                    }),
                    alternate: this.createGeneratedNodeSpan(r, r, "IfStatement", {
                      test: this.createNodeSpan(r, r, "BinaryExpression", {
                        operator: 'in', left: vId, right: __paramsKeywords,
                      }),
                      consequent: this.createNodeSpan(r, r, "BlockStatement", {
                        body: [this.createGeneratedNodeSpan(r, r, "ExpressionStatement", {
                          expression: this.createGeneratedNodeSpan(r, r, "AssignmentExpression", {
                            operator: '=', left: rId, right: __paramsKeywordsV
                          })
                        }),
                        this.createGeneratedNodeSpan(r, r, "ExpressionStatement", {
                          expression: this.createNodeSpan(r, r, "UnaryExpression", {
                            operator: 'delete', prefix: true, argument: __paramsKeywordsV
                          })
                        })]
                      }),
                      alternate: null
                    })
                  })]
                }),
                alternate: this.createGeneratedNodeSpan(r, r, "IfStatement", {
                  test: this.createGeneratedNodeSpan(r, r, "BinaryExpression", {
                    operator: '<', left: __formalsIndexId,
                    right: this.createNodeMembIds(r, __args, 'length'),
                  }),
                  consequent: this.createGeneratedNodeSpan(r, r, "BlockStatement", {
                    body: [this.createGeneratedNodeSpan(r, r, "ExpressionStatement", {
                      expression: this.createGeneratedNodeSpan(r, r, "AssignmentExpression", {
                        operator: '=', left: rId,
                        right: this.createGeneratedNodeSpan(r, r, "MemberExpression", {
                          computed: true,
                          object: this.createGeneratedNodeSpan(r, r, "Identifier", { name: __args }),
                          property: this.createGeneratedNodeSpan(r, r, "UpdateExpression", {
                            operator: '++', argument: __formalsIndexId, prefix: false
                          })
                        })
                      })
                    })]
                  }),
                  alternate: null
                })
              }),
              this.createGeneratedNodeSpan(r, r, "ReturnStatement", { argument: rId })]
          }),
          rest: null, generator: false, expression: false
        });
      },

      // E.g. pyRuntime.utils.add

      createNodeRuntimeCall: function (r, mod, fn, args) {
        return this.createNodeSpan(r, r, "CallExpression", {
          callee: this.createNodeSpan(r, r, "MemberExpression", {
            computed: false,
            object: this.createNodeMembIds(r, options.runtimeParamName,  mod),
            property: this.createNodeSpan(r, r, "Identifier", { name: fn })
          }),
          arguments: args
        });
      },

      // Used to convert 'id = init' to 'var id = init'

      createVarDeclFromId: function (refNode, id, init) {
        var decl = startNodeFrom(refNode);
        decl.id = id;
        decl.init = init;
        this.finishNodeFrom(refNode, decl, "VariableDeclarator");
        var declDecl = startNodeFrom(refNode);
        declDecl.kind = "var";
        declDecl.declarations = [decl];
        return this.finishNodeFrom(refNode, declDecl, "VariableDeclaration");
      },

      createGeneratedVarDeclFromId: function (refNode, id, init) {
        var decl = startNodeFrom(refNode);
        decl.id = id;
        decl.init = init;
        this.finishNodeFrom(refNode, decl, "VariableDeclarator");
        var declDecl = startNodeFrom(refNode);
        declDecl.kind = "var";
        declDecl.declarations = [decl];
        declDecl.userCode = false;
        return this.finishNodeFrom(refNode, declDecl, "VariableDeclaration");
      },

      createClass: function(container, ctorNode, classParams, classBodyRefNode, classBlock) {
        // Helper to identify class methods which were parsed onto the class prototype

        function getPrototype(stmt) {
          if (stmt.expression && stmt.expression.left && stmt.expression.left.object &&
            stmt.expression.left.object.property && stmt.expression.left.object.property.name === "prototype")
            return stmt.expression.left.property.name;
          return null;
        }

        // Start building class constructor

        var ctorBlock = startNodeFrom(classBlock);
        ctorBlock.body = [];

        // Add parent class constructor call

        if (classParams.length === 1) {
          var objId = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "Identifier", { name: classParams[0].name });
          var propertyId = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "Identifier", { name: "call" });
          var calleeMember = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "MemberExpression", { object: objId, property: propertyId, computed: false });
          var thisExpr = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "ThisExpression");
          var callExpr = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "CallExpression", { callee: calleeMember, arguments: [thisExpr] });
          var superExpr = this.createNodeSpan(classBodyRefNode, classBodyRefNode, "ExpressionStatement", { expression: callExpr });
          ctorBlock.body.push(superExpr);
        }

        // Add non-function statements and contents of special '__init__' method

        for (var i in classBlock.body) {
          var stmt = classBlock.body[i];
          var prototype = getPrototype(stmt);
          if (!prototype) {
            ctorBlock.body.push(stmt);
          }
          else if (prototype === "__init__") {
            for (var j in stmt.expression.right.body.body)
              ctorBlock.body.push(stmt.expression.right.body.body[j]);
            ctorNode.params = stmt.expression.right.params;
          }
        }

        // Finish class constructor

        ctorNode.body = finishNode(ctorBlock, "BlockStatement");
        finishNode(ctorNode, "FunctionDeclaration");
        container.body.push(ctorNode);

        // Add inheritance via 'MyClass.prototype = Object.create(ParentClass.prototype)'

        if (classParams.length === 1) {
          var childClassId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: ctorNode.id.name });
          var childPrototypeId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: "prototype" });
          var childPrototypeMember = this.createNodeSpan(ctorNode, ctorNode, "MemberExpression", { object: childClassId, property: childPrototypeId, computed: false });
          var parentClassId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: classParams[0].name });
          var parentPrototypeId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: "prototype" });
          var parentPrototypeMember = this.createNodeSpan(ctorNode, ctorNode, "MemberExpression", { object: parentClassId, property: parentPrototypeId, computed: false });
          var objClassId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: "Object" });
          var objCreateId = this.createNodeSpan(ctorNode, ctorNode, "Identifier", { name: "create" });
          var objPropertyMember = this.createNodeSpan(ctorNode, ctorNode, "MemberExpression", { object: objClassId, property: objCreateId, computed: false });
          var callExpr = this.createNodeSpan(ctorNode, ctorNode, "CallExpression", { callee: objPropertyMember, arguments: [parentPrototypeMember] });
          var assignExpr = this.createNodeSpan(ctorNode, ctorNode, "AssignmentExpression", { left: childPrototypeMember, operator: "=", right: callExpr });
          var inheritanceExpr = this.createNodeSpan(ctorNode, ctorNode, "ExpressionStatement", { expression: assignExpr });
          container.body.push(inheritanceExpr);
        }

        // Add class methods, which are already prototype assignments

        for (var i in classBlock.body) {
          var stmt = classBlock.body[i];
          var prototype = getPrototype(stmt);
          if (prototype && prototype !== "__init__")
            container.body.push(stmt);
        }

        return finishNode(container, "BlockStatement");
      },

      // Create for loop
      // 
      // Problem:
      // 1. JavaScript for/in loop iterates on properties, which are the indexes for an Array
      //    Python iterates on the list items themselves, not indexes
      // 2. JavaScript for/in does not necessarily iterate in order
      // Solution:
      // Generate extra AST to do the right thing at runtime
      // JavaScript for/in is used for dictionaries
      // If iterating through an ordered sequence, return something like: 
      // { var __right = right; 
      //    if (__right instanceof Array) { 
      //      for(var __index=0; __index < __right.length; __index++) {
      //        i = __right[__index]; 
      //        ...
      //      } 
      //    } else { 
      //      for(i in __right){...} 
      //    }
      // }
      // When the loop target is a Tuple, it is unpacked into each for body in the example above.
      // E.g. 'for k, v in __right: total += v' becomes:
      // for (var __tmp in __right) {
      //    k = __tmp[0];
      //    v = __tmp[1];
      //    total += v;
      // }

      // TODO: for/in on a string should go through items, not indexes. String obj and string literal.

      createFor: function (node, init, tupleArgs, right, body) {
        var forOrderedBody = body;
        var forInBody = JSON.parse(JSON.stringify(forOrderedBody));

        var tmpVarSuffix = newAstIdCount++;

        var arrayId = this.createNodeSpan(node, node, "Identifier", { name: "Array" });
        var lengthId = this.createNodeSpan(init, init, "Identifier", { name: "length" });
        var zeroLit = this.createNodeSpan(init, init, "Literal", { value: 0 });

        // var __rightN = right

        var rightId = this.createNodeSpan(right, right, "Identifier", { name: "__filbertRight" + tmpVarSuffix });
        var rightAssign = this.createVarDeclFromId(right, rightId, right);

        // for(;;) and for(in) loops

        var forRightId = this.createNodeSpan(init, init, "Identifier", { name: "__filbertRight" + tmpVarSuffix });

        // for (var __indexN; __indexN < __rightN.length; ++__indexN)

        var forOrderedIndexId = this.createNodeSpan(init, init, "Identifier", { name: "__filbertIndex" + tmpVarSuffix });
        var forOrderedIndexDeclr = this.createNodeSpan(init, init, "VariableDeclarator", { id: forOrderedIndexId, init: zeroLit });
        var forOrderedIndexDecln = this.createNodeSpan(init, init, "VariableDeclaration", { declarations: [forOrderedIndexDeclr], kind: "var" });
        var forOrderedTestMember = this.createNodeSpan(init, init, "MemberExpression", { object: forRightId, property: lengthId, computed: false });
        var forOrderedTestBinop = this.createNodeSpan(init, init, "BinaryExpression", { left: forOrderedIndexId, operator: "<", right: forOrderedTestMember });
        var forOrderedUpdate = this.createNodeSpan(init, init, "UpdateExpression", { operator: "++", prefix: true, argument: forOrderedIndexId });
        var forOrderedMember = this.createNodeSpan(init, init, "MemberExpression", { object: forRightId, property: forOrderedIndexId, computed: true });

        if (tupleArgs) {
          var varStmts = unpackTuple(tupleArgs, forOrderedMember);
          for (var i = varStmts.length - 1; i >= 0; i--) forOrderedBody.body.unshift(varStmts[i]);
        }
        else {
          if (init.type === "Identifier" && !scope.exists(init.name)) {
            scope.addVar(init.name);
            forOrderedBody.body.unshift(this.createVarDeclFromId(init, init, forOrderedMember));
          } else {
            var forOrderedInit = this.createNodeSpan(init, init, "AssignmentExpression", { operator: "=", left: init, right: forOrderedMember });
            var forOrderedInitStmt = this.createNodeSpan(init, init, "ExpressionStatement", { expression: forOrderedInit });
            forOrderedBody.body.unshift(forOrderedInitStmt);
          }
        }

        var forOrdered = this.createNodeSpan(node, node, "ForStatement", { init: forOrderedIndexDecln, test: forOrderedTestBinop, update: forOrderedUpdate, body: forOrderedBody });
        var forOrderedBlock = this.createNodeSpan(node, node, "BlockStatement", { body: [forOrdered] });

        // for (init in __rightN)

        var forInLeft = init;
        if (tupleArgs) {
          var varStmts = unpackTuple(tupleArgs, right);
          forInLeft = varStmts[0];
          for (var i = varStmts.length - 1; i > 0; i--) forInBody.body.unshift(varStmts[i]);
        }
        else if (init.type === "Identifier" && !scope.exists(init.name)) {
          scope.addVar(init.name);
          forInLeft = this.createVarDeclFromId(init, init, null);
        }
        var forIn = this.createNodeSpan(node, node, "ForInStatement", { left: forInLeft, right: forRightId, body: forInBody });
        var forInBlock = this.createNodeSpan(node, node, "BlockStatement", { body: [forIn] });

        // if ordered sequence then forOrdered else forIn

        var ifRightId = this.createNodeSpan(node, node, "Identifier", { name: "__filbertRight" + tmpVarSuffix });
        var ifTest = this.createNodeSpan(node, node, "BinaryExpression", { left: ifRightId, operator: "instanceof", right: arrayId });
        var ifStmt = this.createNodeSpan(node, node, "IfStatement", { test: ifTest, consequent: forOrderedBlock, alternate: forInBlock });

        node.body = [rightAssign, ifStmt];

        return node;
      },

      // expr => __tmpList.push(expr);

      createListCompPush: function (expr, tmpVarSuffix) {
        var exprPushTmpListId = this.createNodeSpan(expr, expr, "Identifier", { name: "__tmpList" + tmpVarSuffix });
        var exprPushId = this.createNodeSpan(expr, expr, "Identifier", { name: "push" });
        var exprMember = this.createNodeSpan(expr, expr, "MemberExpression", { object: exprPushTmpListId, property: exprPushId, computed: false });
        var exprCall = this.createNodeSpan(expr, expr, "CallExpression", { callee: exprMember, arguments: [expr] });
        return this.createNodeSpan(expr, expr, "ExpressionStatement", { expression: exprCall });
      },

      //  (function() {
      //    var _list = [];
      //    ...
      //    body
      //    return _list;
      //  }());

      createListCompIife: function (node, body, tmpVarSuffix) {
        var iifeRuntimeId = this.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
        var iifeObjectsId = this.createNodeSpan(node, node, "Identifier", { name: "objects" });
        var iifeObjMember = this.createNodeSpan(node, node, "MemberExpression", { object: iifeRuntimeId, property: iifeObjectsId, computed: false });
        var iifeListId = this.createNodeSpan(node, node, "Identifier", { name: "list" });
        var iifeListMember = this.createNodeSpan(node, node, "MemberExpression", { object: iifeObjMember, property: iifeListId, computed: false });
        var iifeNewExpr = this.createNodeSpan(node, node, "NewExpression", { callee: iifeListMember, arguments: [] });
        var iifeListId = this.createNodeSpan(node, node, "Identifier", { name: "__tmpList" + tmpVarSuffix });
        var iifeListDecl = this.createVarDeclFromId(node, iifeListId, iifeNewExpr);

        var iifeReturnListId = this.createNodeSpan(node, node, "Identifier", { name: "__tmpList" + tmpVarSuffix });
        var iifeReturn = this.createNodeSpan(node, node, "ReturnStatement", { argument: iifeReturnListId });

        var iifeBlock = this.createNodeSpan(node, node, "BlockStatement", { body: [iifeListDecl, body, iifeReturn] });
        var fnExpr = this.createNodeSpan(node, node, "FunctionExpression", { params: [], defaults: [], body: iifeBlock, generator: false, expression: false });

        return this.createNodeSpan(node, node, "CallExpression", { callee: fnExpr, arguments: [] });
      }
    };
  };

  // Predicate that tests whether the next token is of the given
  // type, and if yes, consumes it as a side effect.

  function eat(type) {
    if (tokType === type) {
      next();
      return true;
    }
  }

  // Expect a token of a given type. If found, consume it, otherwise,
  // raise an unexpected token error.

  function expect(type) {
    if (tokType === type) next();
    else unexpected();
  }

  // Raise an unexpected token error.

  function unexpected() {
    raise(tokStart, "Unexpected token");
  }

  // Verify that a node is an lval - something that can be assigned
  // to.

  function checkLVal(expr) {
    if (expr.type !== "Identifier" && expr.type !== "MemberExpression")
      raise(expr.start, "Assigning to rvalue");
    if (strict && expr.type === "Identifier" && isStrictBadIdWord(expr.name))
      raise(expr.start, "Assigning to " + expr.name + " in strict mode");
  }

  // Get args for a new tuple expression

  function getTupleArgs(expr) {
    if (expr.callee && expr.callee.object && expr.callee.object.object &&
      expr.callee.object.object.name === options.runtimeParamName &&
      expr.callee.property && expr.callee.property.name === "tuple")
      return expr.arguments;
    return null;
  }

  // Unpack an lvalue tuple into indivual variable assignments
  // 'arg0, arg1 = right' becomes:
  // var tmp = right
  // arg0 = tmp[0]
  // arg1 = tmp[1]
  // ...

  function unpackTuple(tupleArgs, right) {
    if (!tupleArgs || tupleArgs.length < 1) unexpected();

    var varStmts = [];

    // var tmp = right

    var tmpId = nc.createNodeSpan(right, right, "Identifier", { name: "__filbertTmp" + newAstIdCount++ });
    var tmpDecl = nc.createVarDeclFromId(right, tmpId, right);
    varStmts.push(tmpDecl);

    // argN = tmp[N]

    for (var i = 0; i < tupleArgs.length; i++) {
      var lval = tupleArgs[i];
      var subTupleArgs = getTupleArgs(lval);
      if (subTupleArgs) {
        var subLit = nc.createNodeSpan(right, right, "Literal", { value: i });
        var subRight = nc.createNodeSpan(right, right, "MemberExpression", { object: tmpId, property: subLit, computed: true });
        var subStmts = unpackTuple(subTupleArgs, subRight);
        for (var j = 0; j < subStmts.length; j++) varStmts.push(subStmts[j]);
      } else {
        checkLVal(lval);
        var indexId = nc.createNodeSpan(right, right, "Literal", { value: i });
        var init = nc.createNodeSpan(right, right, "MemberExpression", { object: tmpId, property: indexId, computed: true });
        if (lval.type === "Identifier" && !scope.exists(lval.name)) {
          scope.addVar(lval.name);
          var varDecl = nc.createVarDeclFromId(lval, lval, init);
          varStmts.push(varDecl);
        }
        else {
          var node = startNodeFrom(lval);
          node.left = lval;
          node.operator = "=";
          node.right = init;
          finishNode(node, "AssignmentExpression");
          varStmts.push(nc.createNodeFrom(node, "ExpressionStatement", { expression: node }));
        }
      }
    }

    return varStmts;
  }

  // ### Statement parsing

  // Parse a program. Initializes the parser, reads any number of
  // statements, and wraps them in a Program node.  Optionally takes a
  // `program` argument.  If present, the statements will be appended
  // to its body instead of creating a new node.

  function parseTopLevel(program) {
    lastStart = lastEnd = tokPos;
    if (options.locations) lastEndLoc = new Position;
    inFunction = strict = null;
    bracketNesting = 0;
    readToken();
    var node = program || startNode();
    if (!program) node.body = [];
    while (tokType !== _eof) {
      var stmt = parseStatement();
      if (stmt) node.body.push(stmt);
    }
    return finishNode(node, "Program");
  }

  // Parse a single statement.
  //
  // If expecting a statement and finding a slash operator, parse a
  // regular expression literal. This is to handle cases like
  // `if (foo) /blah/.exec(foo);`, where looking at the previous token
  // does not help.

  function parseStatement() {
    if (tokType === _slash || tokType === _assign && tokVal == "/=")
      readToken(true);

    var starttype = tokType, node = startNode();

    // Most types of statements are recognized by the keyword they
    // start with. Many are trivial to parse, some require a bit of
    // complexity.

    switch (starttype) {

    case _break:
      next();
      return finishNode(node, "BreakStatement");

    case _continue:
      next();
      return finishNode(node, "ContinueStatement");

    case _class:
      next();
      return parseClass(node);

    case _def:
      next();
      return parseFunction(node);

    case _for:
      next();
      return parseFor(node);

    case _from: // Skipping from and import statements for now
      skipLine();
      next();
      return parseStatement();

    case _if: case _elif:
      next();
      if (tokType === _parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      expect(_colon);
      node.consequent = parseSuite();
      if (tokType === _elif)
        node.alternate = parseStatement();
      else
        node.alternate = eat(_else) && eat(_colon) ? parseSuite() : null;
      return finishNode(node, "IfStatement");

    case _import: // Skipping from and import statements for now
      skipLine();
      next();
      return parseStatement();

    case _newline:
      // TODO: parseStatement() should probably eat it's own newline
      next();
      return null;

    case _pass:
      next();
      return finishNode(node, "EmptyStatement");

    case _return:
      if (!inFunction && !options.allowReturnOutsideFunction)
        raise(tokStart, "'return' outside of function");
      next();
      if (tokType ===_newline || tokType === _eof) node.argument = null;
      else { node.argument = parseExpression();}
      return finishNode(node, "ReturnStatement");

    case _try: // TODO, and remove parseBlock
      next();
      node.block = parseBlock();
      node.handler = null;
      if (tokType === _catch) {
        var clause = startNode();
        next();
        expect(_parenL);
        clause.param = parseIdent();
        if (strict && isStrictBadIdWord(clause.param.name))
          raise(clause.param.start, "Binding " + clause.param.name + " in strict mode");
        expect(_parenR);
        clause.guard = null;
        clause.body = parseBlock();
        node.handler = finishNode(clause, "CatchClause");
      }
      node.guardedHandlers = empty;
      node.finalizer = eat(_finally) ? parseBlock() : null;
      if (!node.handler && !node.finalizer)
        raise(node.start, "Missing catch or finally clause");
      return finishNode(node, "TryStatement");

    case _while:
      next();
      if (tokType === _parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      expect(_colon);
      node.body = parseSuite();
      return finishNode(node, "WhileStatement");

    case _with: // TODO
      if (strict) raise(tokStart, "'with' in strict mode");
      next();
      node.object = parseParenExpression();
      node.body = parseStatement();
      return finishNode(node, "WithStatement");

    case _semi:
      next();
      return finishNode(node, "EmptyStatement");

      // Assume it's an ExpressionStatement. If an assign has been 
      // converted to a variable declaration, pass it up as is.

    default:
      var expr = parseExpression();
      if (tokType !== _semi && tokType !== _newline && tokType !== _eof) unexpected();
      if (expr.type === "VariableDeclaration" || expr.type === "BlockStatement") {
        return expr;
      } else {
        node.expression = expr;
        return finishNode(node, "ExpressionStatement");
      }
    }
  }

  // Parse indent-enclosed block of statements

  function parseBlock() {
    var node = startNode();
    node.body = [];
    while (tokType !== _dedent && tokType !== _eof) {
      var stmt = parseStatement();
      if (stmt) node.body.push(stmt);
    }
    if (tokType === _dedent) next();
    return finishNode(node, "BlockStatement");
  }

  // Parse 'suite' from Python grammar spec
  // Will replace parseBlock eventually

  function parseSuite() {
    // NOTE: This is not strictly valid Python for this to be an empty block
    var node = startNode();
    node.body = [];
    if (eat(_newline)) {
      if (tokType === _indent) {
        expect(_indent);
        while (!eat(_dedent) && !eat(_eof)) {
          var stmt = parseStatement();
          if (stmt) node.body.push(stmt);
        }
      }
    } else if (tokType !== _eof) {
      node.body.push(parseStatement());
      next();
    }
    return finishNode(node, "BlockStatement");
  }

  // Parse for/in loop

  function parseFor(node) {
    var init = parseExpression(false, true);
    var tupleArgs = getTupleArgs(init);
    if (!tupleArgs) checkLVal(init);
    expect(_in);
    var right = parseExpression();
    expect(_colon);
    var body = parseSuite();
    finishNode(node, "BlockStatement");
    return nc.createFor(node, init, tupleArgs, right, body);
  }

  // ### Expression parsing

  // These nest, from the most general expression type at the top to
  // 'atomic', nondivisible expression types at the bottom. Most of
  // the functions will simply let the function(s) below them parse,
  // and, *if* the syntactic construct they handle is present, wrap
  // the AST node that the inner parser gave them in another node.

  // Parse a full expression. The arguments are used to forbid comma
  // sequences (in argument lists, array literals, or object literals)
  // or the `in` operator (in for loops initalization expressions).

  function parseExpression(noComma, noIn) {
    return parseMaybeAssign(noIn);
  }

  // Used for constructs like `switch` and `if` that insist on
  // parentheses around their expression.

  function parseParenExpression() {
    expect(_parenL);
    var val = parseExpression();
    expect(_parenR);
    return val;
  }

  // Parse an assignment expression. This includes applications of
  // operators like `+=`.
  // Add 'this.' to assignments in a class constructor.
  // Convert identifier assignment to variable declaration if the
  // identifier doesn't exist in this namespace yet.

  function parseMaybeAssign(noIn) {
    var left = parseMaybeTuple(noIn);
    if (tokType.isAssign) {
      var tupleArgs = getTupleArgs(left);
      if (tupleArgs) {
        next();
        var right = parseMaybeTuple(noIn);
        var blockNode = startNodeFrom(left);
        blockNode.body = unpackTuple(tupleArgs, right);
        return finishNode(blockNode, "BlockStatement");
      }

      if (scope.isClass()) {
        var thisExpr = nc.createNodeFrom(left, "ThisExpression");
        left = nc.createNodeFrom(left, "MemberExpression", { object: thisExpr, property: left });
      }

      var node = startNodeFrom(left);
      node.operator = tokVal;
      node.left = left;
      next();
      node.right = parseMaybeTuple(noIn);
      checkLVal(left);

      if (node.operator === '+=' || node.operator === '*=') {
        var right = nc.createNodeSpan(node.right, node.right, "CallExpression");
        right.callee = nc.createNodeOpsCallee(right, node.operator === '+=' ? "add" : "multiply");
        right.arguments = [left, node.right];
        node.right = right;
        node.operator = '=';
      }

      if (left.type === "Identifier" && !scope.exists(left.name)) {
        if (!node.operator || node.operator.length > 1) unexpected();
        scope.addVar(left.name);
        return nc.createVarDeclFromId(node.left, node.left, node.right);
      }
      return finishNode(node, "AssignmentExpression");
    }
    return left;
  }

  // Parse a tuple

  function parseMaybeTuple(noIn) {
    var expr = parseExprOps(noIn);
    if (tokType === _comma) {
      return parseTuple(noIn, expr);
    }
    return expr;
  }

  // Start the precedence parser.

  function parseExprOps(noIn) {
    return parseExprOp(parseMaybeUnary(noIn), -1, noIn);
  }

  // Parse binary operators with the operator precedence parsing
  // algorithm. `left` is the left-hand side of the operator.
  // `minPrec` provides context that allows the function to stop and
  // defer further parser to one of its callers when it encounters an
  // operator that has a lower precedence than the set it is parsing.
  // Exponentiation is evaluated right-to-left, so 'prec >= minPrec'
  // Exponentiation operator 'x**y' is replaced with 'Math.pow(x, y)'
  // Floor division operator 'x//y' is replaced with 'Math.floor(x/y)'
  // 'in' and 'not in' implemented via indexOf()

  function parseExprOp(left, minPrec, noIn) {
    var node, exprNode, right, op = tokType, val = tokVal;
    var prec = op === _not ? _in.prec : op.prec;
    if (op === _exponentiation && prec >= minPrec) {
      node = startNodeFrom(left);
      next();
      right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
      exprNode = nc.createNodeMemberCall(node, "Math", "pow", [left, right]);
      return parseExprOp(exprNode, minPrec, noIn);
    } else if (prec != null && (!noIn || op !== _in)) {
      if (prec > minPrec) {
        next();
        node = startNodeFrom(left);
        if (op === _floorDiv) {
          right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
          finishNode(node);
          var binExpr = nc.createNodeSpan(node, node, "BinaryExpression", { left: left, operator: '/', right: right });
          exprNode = nc.createNodeMemberCall(node, "Math", "floor", [binExpr]);
        } else if (op === _in || op === _not) {
          if (op === _in || eat(_in)) {
            right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
            finishNode(node);
            var notLit = nc.createNodeSpan(node, node, "Literal", { value: op === _not });
            exprNode = nc.createNodeRuntimeCall(node, 'ops', 'in', [left, right, notLit]);
          } else raise(tokPos, "Expected 'not in' comparison operator");
        } else if (op === _plusMin && val === '+' || op === _multiplyModulo && val === '*') {
          node.arguments = [left];
          node.arguments.push(parseExprOp(parseMaybeUnary(noIn), prec, noIn));
          finishNode(node, "CallExpression");
          node.callee = nc.createNodeOpsCallee(node, op === _plusMin ? "add" : "multiply");
          exprNode = node;
        } else {
          if (op === _is) {
            if (eat(_not)) node.operator = "!==";
            else node.operator = "===";
          } else node.operator = op.rep != null ? op.rep : val;
          node.left = left;
          node.right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
          exprNode = finishNode(node, (op === _or || op === _and) ? "LogicalExpression" : "BinaryExpression");
        }
        return parseExprOp(exprNode, minPrec, noIn);
      }
    }
    return left;
  }

  // Parse unary operators.
  // '-+' are prefixes here, with different precedence.

  function parseMaybeUnary(noIn) {
    if (tokType.prefix || tokType === _plusMin) {
      var prec = tokType === _plusMin ? _posNegNot.prec : tokType.prec;
      var node = startNode();
      node.operator = tokType.rep != null ? tokType.rep : tokVal;
      node.prefix = true;
      tokRegexpAllowed = true;
      next();
      node.argument = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
      return finishNode(node, "UnaryExpression");
    }
    return parseSubscripts(parseExprAtom());
  }

  // Parse call, dot, and `[]`-subscript expressions.

  function parseSubscripts(base, noCalls) {
    var node = startNodeFrom(base);
    if (eat(_dot)) {
      var id = parseIdent(true);
      if (pythonRuntime.imports[base.name] && pythonRuntime.imports[base.name][id.name]) {
        // Calling a Python import function
        // TODO: Unpack parameters into JavaScript-friendly parameters
        var runtimeId = nc.createNodeSpan(base, base, "Identifier", { name: options.runtimeParamName });
        var importsId = nc.createNodeSpan(base, base, "Identifier", { name: "imports" });
        var runtimeMember = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeId, property: importsId, computed: false });
        node.object = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeMember, property: base, computed: false });
      } else if (base.name && base.name === scope.getThisReplace()) {
        node.object = nc.createNodeSpan(base, base, "ThisExpression");
      } else node.object = base;
      node.property = id;
      node.computed = false;
      return parseSubscripts(finishNode(node, "MemberExpression"), noCalls);
    } else if (eat(_bracketL)) {
      var expr, isSlice = false;
      if (eat(_colon)) isSlice = true;
      else expr = parseExpression();
      if (!isSlice && eat(_colon)) isSlice = true;
      if (isSlice) return parseSlice(node, base, expr, noCalls);
      var subscriptCall = nc.createNodeSpan(expr, expr, "CallExpression");
      subscriptCall.callee = nc.createNodeOpsCallee(expr, "subscriptIndex");
      subscriptCall.arguments = [base, expr];
      node.object = base;
      node.property = subscriptCall;
      node.computed = true;
      expect(_bracketR);
      return parseSubscripts(finishNode(node, "MemberExpression"), noCalls);
    } else if (!noCalls && eat(_parenL)) {
      if (scope.isUserFunction(base.name)) {
        // Unpack parameters into JavaScript-friendly parameters, further processed at runtime
        var createParamsCall = nc.createNodeRuntimeCall(node, 'utils', 'createParamsObj', parseParamsList());
        node.arguments = [createParamsCall];
      } else node.arguments = parseExprList(_parenR, false);
      if (scope.isNewObj(base.name)) finishNode(node, "NewExpression");
      else finishNode(node, "CallExpression");
      if (pythonRuntime.functions[base.name]) {
        // Calling a Python built-in function
        // TODO: Unpack parameters into JavaScript-friendly parameters
        if (base.type !== "Identifier") unexpected();
        var runtimeId = nc.createNodeSpan(base, base, "Identifier", { name: options.runtimeParamName });
        var functionsId = nc.createNodeSpan(base, base, "Identifier", { name: "functions" });
        var runtimeMember = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeId, property: functionsId, computed: false });
        node.callee = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeMember, property: base, computed: false });
      } else node.callee = base;
      return parseSubscripts(node, noCalls);
    }
    return base;
  }

  function parseSlice(node, base, start, noCalls) {
    var end, step;
    if (!start) start = nc.createNodeFrom(node, "Literal", { value: null });
    if (tokType === _bracketR || eat(_colon)) {
      end = nc.createNodeFrom(node, "Literal", { value: null });
    } else {
      end = parseExpression();
      if (tokType !== _bracketR) expect(_colon);
    }
    if (tokType === _bracketR) step = nc.createNodeFrom(node, "Literal", { value: null });
    else step = parseExpression();
    expect(_bracketR);

    node.arguments = [start, end, step];
    var sliceId = nc.createNodeFrom(base, "Identifier", { name: "_pySlice" });
    var memberExpr = nc.createNodeSpan(base, base, "MemberExpression", { object: base, property: sliceId, computed: false });
    node.callee = memberExpr;
    return parseSubscripts(finishNode(node, "CallExpression"), noCalls);
  }

  // Parse an atomic expression - either a single token that is an
  // expression, an expression started by a keyword like `function` or
  // `new`, or an expression wrapped in punctuation like `()`, `[]`,
  // or `{}`.

  function parseExprAtom() {
    switch (tokType) {

    case _dict:
      next();
      return parseDict(_parenR);

    case _name:
      return parseIdent();

    case _num: case _string: case _regexp:
      var node = startNode();
      node.value = tokVal;
      node.raw = input.slice(tokStart, tokEnd);
      next();
      return finishNode(node, "Literal");

    case _none: case _true: case _false:
      var node = startNode();
      node.value = tokType.atomValue;
      node.raw = tokType.keyword;
      next();
      return finishNode(node, "Literal");

    case _parenL:
      var tokStartLoc1 = tokStartLoc, tokStart1 = tokStart;
      next();
      if (tokType === _parenR) {
        // Empty tuple
        var node = parseTuple(false);
        eat(_parenR);
        return node;
      }
      var val = parseMaybeTuple(false);
      if (options.locations) {
        val.loc.start = tokStartLoc1;
        val.loc.end = tokEndLoc;
      }
      if (options.ranges)
        val.range = [tokStart1, tokEnd];
      expect(_parenR);
      return val;

    case _bracketL:
      return parseList();

    case _braceL:
      return parseDict(_braceR);

    case _indent:
      raise(tokStart, "Unexpected indent");

    default:
      unexpected();
    }
  }

  // Parse list

  // Custom list object is used to simulate native Python list
  // E.g. Python '[]' becomes JavaScript 'new __pythonRuntime.objects.list();'
  // If list comprehension, build something like this:
  //(function() {
  //  var _list = [];
  //  ...
  //  _list.push(expr);
  //  return _list;
  //}());

  function parseList() {
    var node = startNode();
    node.arguments = [];
    next();

    if (!eat(_bracketR)) {
      var expr = parseExprOps(false);
      if (tokType === _for || tokType === _if) {

        // List comprehension
        var tmpVarSuffix = newAstIdCount++;
        expr = nc.createListCompPush(expr, tmpVarSuffix);
        var body = parseCompIter(expr, true);
        finishNode(node);
        return nc.createListCompIife(node, body, tmpVarSuffix);

      } else if (eat(_comma)) {
        node.arguments = [expr].concat(parseExprList(_bracketR, true, false));
      }
      else {
        expect(_bracketR);
        node.arguments = [expr];
      }
    }

    finishNode(node, "NewExpression");
    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "list" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });
    return node;
  }

  // Parse a comp_iter from Python language grammar
  // Used to build list comprehensions
  // 'expr' is the body to be used after unrolling the ifs and fors

  function parseCompIter(expr, first) {
    if (first && tokType !== _for) unexpected();
    if (eat(_bracketR)) return expr;
    var node = startNode();
    if (eat(_for)) {
      var init = parseExpression(false, true);
      var tupleArgs = getTupleArgs(init);
      if (!tupleArgs) checkLVal(init);
      expect(_in);
      var right = parseExpression();
      var body = parseCompIter(expr, false);
      var block = nc.createNodeSpan(body, body, "BlockStatement", { body: [body] });
      finishNode(node, "BlockStatement");
      return nc.createFor(node, init, tupleArgs, right, block);
    } else if (eat(_if)) {
      if (tokType === _parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      node.consequent = parseCompIter(expr, false);
      return finishNode(node, "IfStatement");
    } else unexpected();
  }

  // Parse class

  function parseClass(ctorNode) {
    // Container for class constructor and prototype functions
    var container = startNodeFrom(ctorNode);
    container.body = [];

    // Parse class signature
    ctorNode.id = parseIdent();
    ctorNode.params = [];
    var classParams = [];
    if (eat(_parenL)) {
      var first = true;
      while (!eat(_parenR)) {
        if (!first) expect(_comma); else first = false;
        classParams.push(parseIdent());
      }
    }
    if (classParams.length > 1) raise(tokPos, "Multiple inheritance not supported");
    expect(_colon);

    // Start new namespace for class body
    scope.startClass(ctorNode.id.name);

    // Save a reference for source ranges
    var classBodyRefNode = finishNode(startNode());

    // Parse class body
    var classBlock = parseSuite();

    // Generate additional AST to implement class
    var classStmt = nc.createClass(container, ctorNode, classParams, classBodyRefNode, classBlock);

    scope.end();

    return classStmt;
  }

  // Parse dictionary
  // Custom dict object used to simulate native Python dict
  // E.g. "{'k1':'v1', 'k2':'v2'}" becomes "new __pythonRuntime.objects.dict(['k1', 'v1'], ['k2', 'v2']);"

  function parseDict(tokClose) {
    var node = startNode(), first = true, key, value;
    node.arguments = [];
    next();
    while (!eat(tokClose)) {
      if (!first) {
        expect(_comma);
      } else first = false;

      if (tokClose === _braceR) {
        key = parsePropertyName();
        expect(_colon);
        value = parseExprOps(false);
      } else if (tokClose === _parenR) {
        var keyId = parseIdent(true);
        key = startNodeFrom(keyId);
        key.value = keyId.name;
        finishNode(key, "Literal");
        expect(_eq);
        value = parseExprOps(false);
      } else unexpected();
      node.arguments.push(nc.createNodeSpan(key, value, "ArrayExpression", { elements: [key, value] }));
    }
    finishNode(node, "NewExpression");

    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "dict" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });

    return node;
  }

  function parsePropertyName() {
    if (tokType === _num || tokType === _string) return parseExprAtom();
    return parseIdent(true);
  }

  function parseFunction(node) {
    // TODO: The node creation utilities used here are tightly coupled (e.g. variable names)

    var suffix = newAstIdCount++;
    node.id = parseIdent();
    node.params = [];

    // Parse parameters

    var formals = [];     // In order, maybe with default value
    var argsId = null;    // *args
    var kwargsId = null;  // **kwargs
    var defaultsFound = false;
    var first = true;
    expect(_parenL);
    while (!eat(_parenR)) {
      if (!first) expect(_comma); else first = false;
      if (tokVal === '*') {
        if (kwargsId) raise(tokPos, "invalid syntax");
        next(); argsId = parseIdent();
      } else if (tokVal === '**') {
        next(); kwargsId = parseIdent();
      } else {
        if (kwargsId) raise(tokPos, "invalid syntax");
        var paramId = parseIdent();
        if (eat(_eq)) {
          formals.push({ id: paramId, expr: parseExprOps(false) });
          defaultsFound = true;
        } else {
          if (defaultsFound) raise(tokPos, "non-default argument follows default argument");
          if (argsId) raise(tokPos, "missing required keyword-only argument");
          formals.push({ id: paramId, expr: null });
        }
      }
    }
    expect(_colon);

    // Start a new scope with regard to the `inFunction`
    // flag (restore them to their old value afterwards).
    // `inFunction` used to throw syntax error for stray `return`
    var oldInFunc = inFunction = true;

    scope.startFn(node.id.name);

    // If class method, remove class instance var from params and save for 'this' replacement
    if (scope.isParentClass()) {
      var selfId = formals.shift();
      scope.setThisReplace(selfId.id.name);
    }

    var body = parseSuite();
    node.body = nc.createNodeSpan(body, body, "BlockStatement", { body: [] });

    // Add runtime parameter processing
    // The caller may pass a complex parameter object as a single parameter like this:
    // {formals:[<expr>, <expr>, ...], keywords:{<id>:<expr>, <id>:<expr>, ...}}

    if (formals.length > 0 || argsId || kwargsId) {
      // var __params = arguments.length === 1 && arguments[0].formals && arguments[0].keywords ? arguments[0] : null;
      node.body.body.push(nc.createNodeParamsCheck(node.id, suffix));

      // var __formalsIndex = 0;
      node.body.body.push(nc.createGeneratedVarDeclFromId(node.id,
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: '__formalsIndex' + suffix }),
        nc.createNodeSpan(node.id, node.id, "Literal", { value: 0 })));

      // var __args = arguments;
      node.body.body.push(nc.createGeneratedVarDeclFromId(node.id,
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: '__args' + suffix }),
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: 'arguments' })));
    }

    if (formals.length > 0) {
      // function __getParam(v, d) {
      //   var r = d;
      //   if (__params) {
      //     if (__formalsIndex < __params.formals.length) {
      //       r = __params.formals[__formalsIndex++];
      //     } else if (v in __params.keywords) {
      //       r = __params.keywords[v];
      //       delete __params.keywords[v];
      //     }
      //   } else if (__formalsIndex < __args.length) {
      //     r = __args[__formalsIndex++];
      //   }
      //   return r;
      // }
      node.body.body.push(nc.createNodeGetParamFn(node.id, suffix));

      for (var i = 0; i < formals.length; i++) {
        // var <param> = __getParam('<param>', <optional default>);
        var __getParamCall = nc.createNodeSpan(formals[i].id, formals[i].id, "CallExpression", {
          callee: nc.createNodeSpan(formals[i].id, formals[i].id, "Identifier", { name: '__getParam' + suffix }),
          arguments: [nc.createNodeSpan(formals[i].id, formals[i].id, "Literal", { value: formals[i].id.name })]
        });
        if (formals[i].expr) __getParamCall.arguments.push(formals[i].expr);
        node.body.body.push(nc.createGeneratedVarDeclFromId(formals[i].id, formals[i].id, __getParamCall));
      }
    }
    
    var refNode = argsId || kwargsId;
    if (refNode) {
      if (argsId) {
        // var <args> = [];
        var argsAssign = nc.createGeneratedVarDeclFromId(argsId, argsId, nc.createNodeSpan(argsId, argsId, "ArrayExpression", { elements: [] }));
        node.body.body.push(argsAssign);
      }
      if (kwargsId) {
        // var <kwargs> = {};
        var kwargsAssign = nc.createGeneratedVarDeclFromId(kwargsId, kwargsId, nc.createNodeSpan(kwargsId, kwargsId, "ObjectExpression", { properties: [] }));
        node.body.body.push(kwargsAssign);
      }
      // if (__params) {}
      var argsIf = nc.createNodeSpan(refNode, refNode, "IfStatement", {
        test: nc.createNodeSpan(refNode, refNode, "Identifier", { name: '__params' + suffix }),
        consequent: nc.createNodeSpan(refNode, refNode, "BlockStatement", { body: [] })})
      if (argsId) {
        // while (__formalsIndex < __params.formals.length) {
        //   <argsId>.push(__params.formals[__formalsIndex++]); }
        argsIf.consequent.body.push(nc.createNodeArgsWhileConsequent(argsId, suffix));
        // { while (__formalsIndex < __args.length) {
        //   <argsId>.push(__args[__formalsIndex++]); }}
        argsIf.alternate = nc.createNodeArgsAlternate(argsId, suffix);
      }
      if (kwargsId) {
        // <kwargs> = __params.keywords
        argsIf.consequent.body.push(nc.createNodeSpan(kwargsId, kwargsId, "ExpressionStatement", {
          expression: nc.createNodeSpan(kwargsId, kwargsId, "AssignmentExpression", {
            operator: '=', left: kwargsId, right: nc.createNodeMembIds(kwargsId, '__params' + suffix, 'keywords'),
          })
        }));
      }
      node.body.body.push(argsIf);
    }

    // Convert original body to 'return (function() {<body>}).call(this);'
    node.body.body.push(nc.createNodeFnBodyIife(body));

    inFunction = oldInFunc;

    // Verify that argument names are not repeated
    for (var i = 0; i < formals.length; ++i) {
      for (var j = 0; j < i; ++j) if (formals[i].id.name === formals[j].id.name)
        raise(formals[i].id.start, "Argument name clash");
    }

    // If class method, replace with prototype function literals
    var retNode;
    if (scope.isParentClass()) {
      finishNode(node);
      var classId = nc.createNodeSpan(node, node, "Identifier", { name: scope.getParentClassName() });
      var prototypeId = nc.createNodeSpan(node, node, "Identifier", { name: "prototype" });
      var functionId = node.id;
      var prototypeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: classId, property: prototypeId, computed: false });
      var functionMember = nc.createNodeSpan(node, node, "MemberExpression", { object: prototypeMember, property: functionId, computed: false });
      var functionExpr = nc.createNodeSpan(node, node, "FunctionExpression", { body: node.body, params: node.params });
      var assignExpr = nc.createNodeSpan(node, node, "AssignmentExpression", { left: functionMember, operator: "=", right: functionExpr });
      retNode = nc.createNodeSpan(node, node, "ExpressionStatement", { expression: assignExpr });
    } else retNode = finishNode(node, "FunctionDeclaration");

    scope.end();

    return retNode;
  }

  // Parses a comma-separated list of expressions, and returns them as
  // an array. `close` is the token type that ends the list, and
  // `allowEmpty` can be turned on to allow subsequent commas with
  // nothing in between them to be parsed as `null` (which is needed
  // for array literals).

  function parseExprList(close, allowTrailingComma, allowEmpty) {
    var elts = [], first = true;
    while (!eat(close)) {
      if (!first) {
        expect(_comma);
        if (allowTrailingComma && options.allowTrailingCommas && eat(close)) break;
      } else first = false;

      if (allowEmpty && tokType === _comma) elts.push(null);
      else elts.push(parseExprOps(false));
    }
    return elts;
  }

  function parseParamsList() {
    // In: expr, expr, ..., id=expr, id=expr, ...
    // Out: expr, expr, ..., {id:expr, __kwp:true}, {id:expr, __kwp:true}, ...
    var elts = [], first = true;
    while (!eat(_parenR)) {
      if (!first) expect(_comma);
      else first = false;
      var expr = parseExprOps(false);
      if (eat(_eq)) {
        var right = parseExprOps(false);
        var kwId = nc.createNodeSpan(expr, right, "Identifier", {name:"__kwp"});
        var kwLit = nc.createNodeSpan(expr, right, "Literal", {value:true});
        var left = nc.createNodeSpan(expr, right, "ObjectExpression", { properties: [] });
        left.properties.push({ type: "Property", key: expr, value: right, kind: "init" });
        left.properties.push({ type: "Property", key: kwId, value: kwLit, kind: "init" });
        expr = left;
      }
      elts.push(expr);
    }
    return elts;
  }

  // Parse the next token as an identifier. If `liberal` is true (used
  // when parsing properties), it will also convert keywords into
  // identifiers.

  // TODO: liberal?

  function parseIdent(liberal) {
    var node = startNode();
    if (liberal) liberal = false;
    if (tokType === _name) {
      if (!liberal && strict && input.slice(tokStart, tokEnd).indexOf("\\") == -1)
        raise(tokStart, "The keyword '" + tokVal + "' is reserved");
      node.name = tokVal;
    } else if (liberal && tokType.keyword) {
      node.name = tokType.keyword;
    } else {
      unexpected();
    }
    tokRegexpAllowed = false;
    next();
    return finishNode(node, "Identifier");
  }

  function parseTuple(noIn, expr) {
    var node = expr ? startNodeFrom(expr) : startNode();
    node.arguments = expr ? [expr] : [];

    // Tuple with single element has special trailing comma: t = 'hi',
    // Look ahead and eat comma in this scenario
    if (tokType === _comma) {
      var oldPos = tokPos; skipSpace();
      var newPos = tokPos; tokPos = oldPos;
      if (newPos >= inputLen || input[newPos] === ';' || input[newPos] === ')' || newline.test(input[newPos]))
        eat(_comma);
    }

    while (eat(_comma)) {
      node.arguments.push(parseExprOps(noIn));
    }
    finishNode(node, "NewExpression");

    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "tuple" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });

    return node;
  }


  // ## Python runtime library

  var pythonRuntime = exports.pythonRuntime = {

    // Shim JavaScript objects that impersonate Python equivalents

    // TODO: use 'type' or isSequence instead of 'instanceof Array' to id these

    internal: {
      // Only used within runtime
      isSeq: function (a) { return a && (a._type === "list" || a._type === "tuple"); },
      slice: function (obj, start, end, step) {
        if (step == null || step === 0) step = 1; // TODO: step === 0 is a runtime error
        if (start == null) {
          if (step < 0) start = obj.length - 1;
          else start = 0;
        } else if (start < 0) start += obj.length;
        if (end == null) {
          if (step < 0) end = -1;
          else end = obj.length;
        } else if (end < 0) end += obj.length;

        var ret = new pythonRuntime.objects.list(), tmp, i;
        if (step < 0) {
          tmp = obj.slice(end + 1, start + 1);
          for (i = tmp.length - 1; i >= 0; i += step) ret.append(tmp[i]);
        } else {
          tmp = obj.slice(start, end);
          if (step === 1) ret = pythonRuntime.utils.createList(tmp);
          else for (i = 0; i < tmp.length; i += step) ret.append(tmp[i]);
        }
        return ret;
      },
      isJSArray: Array.isArray || function(obj) {
        return toString.call(obj) === '[object Array]';
      }
    },

    utils: {
      convertToDict: function (dict) {
        if (!dict.hasOwnProperty("_type")) {
          Object.defineProperty(dict, "_type",
          {
            get: function () { return 'dict';},
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("_isPython")) {
          Object.defineProperty(dict, "_isPython",
          {
            get: function () { return true; },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("items")) {
          Object.defineProperty(dict, "items",
          {
            value: function () {
              var items = new pythonRuntime.objects.list();
              for (var k in this) items.append(new pythonRuntime.objects.tuple(k, this[k]));
              return items;
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("length")) {
          Object.defineProperty(dict, "length",
          {
            get: function () {
              return Object.keys(this).length;
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("clear")) {
          Object.defineProperty(dict, "clear",
          {
            value: function () {
              for (var i in this) delete this[i];
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("get")) {
          Object.defineProperty(dict, "get",
          {
            value: function (key, def) {
              if (key in this) return this[key];
              else if (def !== undefined) return def;
              return null;
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("keys")) {
          Object.defineProperty(dict, "keys",
          {
            value: function () {
              return Object.keys(this);
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("pop")) {
          Object.defineProperty(dict, "pop",
          {
            value: function (key, def) {
              var value;
              if (key in this) {
                value = this[key];
                delete this[key];
              } else if (def !== undefined) value = def;
              else return new Error("KeyError");
              return value;
            },
            enumerable: false
          });
        }
        if (!dict.hasOwnProperty("values")) {
          Object.defineProperty(dict, "values",
          {
            value: function () {
              var values = new pythonRuntime.objects.list();
              for (var key in this) values.append(this[key]);
              return values;
            },
            enumerable: false
          });
        }
      },
      createDict: function () {
        var ret = new pythonRuntime.objects.dict();
        if (arguments.length === 1 && arguments[0] instanceof Object)
          for (var k in arguments[0]) ret[k] = arguments[0][k];
        else
          throw TypeError("createDict expects a single JavaScript object")
        return ret;
      },
      createParamsObj: function () {
        // In: expr, expr, ..., {id:expr, __kwp:true}, {id:expr, __kwp:true}, ...
        // Out: {formals:[expr, expr, ...], keywords:{id:expr, id:expr, ...}}
        var params = { formals: new pythonRuntime.objects.list(), keywords: new pythonRuntime.objects.dict() };
        for (var i = 0; i < arguments.length; i++) {
          if (arguments[i] && arguments[i].__kwp === true) {
            for (var k in arguments[i])
              if (k !== '__kwp') params.keywords[k] = arguments[i][k];
          }
          else params.formals.push(arguments[i]);
        }
        return params;
      },
      convertToList: function (list) {
        if (!list.hasOwnProperty("_type")) {
          Object.defineProperty(list, "_type",
          {
            get: function () { return 'list'; },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("_isPython")) {
          Object.defineProperty(list, "_isPython",
          {
            get: function () { return true; },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("append")) {
          Object.defineProperty(list, "append",
          {
            value: function (x) {
              this.push(x);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("clear")) {
          Object.defineProperty(list, "clear",
          {
            value: function () {
              this.splice(0, this.length);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("copy")) {
          Object.defineProperty(list, "copy",
          {
            value: function () {
              return this.slice(0);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("count")) {
          Object.defineProperty(list, "count",
          {
            value: function (x) {
              var c = 0;
              for (var i = 0; i < this.length; i++)
                if (this[i] === x) c++;
              return c;
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("equals")) {
          Object.defineProperty(list, "equals",
          {
            value: function (x) {
              try {
                if (this.length !== x.length) return false;
                for (var i = 0; i < this.length; i++) {
                  if (this[i].hasOwnProperty("equals")) {
                    if (!this[i].equals(x[i])) return false;
                  } else if (this[i] !== x[i]) return false;
                }
                return true;
              }
              catch (e) { }
              return false;
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("extend")) {
          Object.defineProperty(list, "extend",
          {
            value: function (L) {
              for (var i = 0; i < L.length; i++) this.push(L[i]);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("index")) {
          Object.defineProperty(list, "index",
          {
            value: function (x) {
              return this.indexOf(x);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("indexOf")) {
          Object.defineProperty(list, "indexOf",
          {
            value: function (x, fromIndex) {
              try {
                for (var i = fromIndex ? fromIndex : 0; i < this.length; i++) {
                  if (this[i].hasOwnProperty("equals")) {
                    if (this[i].equals(x)) return i;
                  } else if (this[i] === x) return i;
                }
              }
              catch (e) { }
              return -1;
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("insert")) {
          Object.defineProperty(list, "insert",
          {
            value: function (i, x) {
              this.splice(i, 0, x);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("pop")) {
          Object.defineProperty(list, "pop",
          {
            value: function (i) {
              if (!i)
                i = this.length - 1;
              var item = this[i];
              this.splice(i, 1);
              return item;
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("_pySlice")) {
          Object.defineProperty(list, "_pySlice",
          {
            value: function (start, end, step) {
              return pythonRuntime.internal.slice(this, start, end, step);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("remove")) {
          Object.defineProperty(list, "remove",
          {
            value: function (x) {
              this.splice(this.indexOf(x), 1);
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("sort")) {
          Object.defineProperty(list, "sort",
          {
            value: function(x, reverse) {
              var list2 = this.slice(0);
              var apply_key = function(a, numerical) {
                var list3 = list2.map(x);
                // construct a dict that maps the listay before and after the map
                var mapping = {}
                for(var i in list3) mapping[list3[i]] = list2[i];
                if(numerical)
                  list3.sort(function(a, b) { return a - b; });
                else
                  list3.sort()
                for(var i in a) a[i] = mapping[list3[i]];
              }
              for(var i in this) {
                if(typeof this[i] !== 'number' || !isFinite(this[i])) {
                  if(typeof x != 'undefined') {
                    apply_key(this, false);
                  }
                  else {
                    list2.sort();
                    for (var j in this) this[j] = list2[j];
                  }
                  if(reverse)
                    this.reverse();
                  return;
                }
              }
              if(typeof x != 'undefined') {
                apply_key(this, true);
              }
              else {
                list2.sort(function(a, b) { return a - b; });
                for(var i in this) this[i] = list2[i];
              }
              if(reverse)
                this.reverse();
            },
            enumerable: false
          });
        }
        if (!list.hasOwnProperty("toString")) {
          Object.defineProperty(list, "toString",
          {
            value: function () {
              return '[' + this.join(', ') + ']';
            },
            enumerable: false
          });
        }
      },
      createList: function () {
        var ret = new pythonRuntime.objects.list();
        if (arguments.length === 1 && arguments[0] instanceof Array)
          for (var i in arguments[0]) ret.push(arguments[0][i]);
        else
          for (var i in arguments) ret.push(arguments[i]);
        return ret;
      }
    },

    ops: {
      add: function (a, b) {
        if (pythonRuntime.internal.isSeq(a) && pythonRuntime.internal.isSeq(b)) {
          if (a._type !== b._type)
            throw TypeError("can only concatenate " + a._type + " (not '" + b._type + "') to " + a._type);
          var ret;
          if (a._type === 'list') ret = new pythonRuntime.objects.list();
          else if (a._type === 'tuple') ret = new pythonRuntime.objects.tuple();
          if (ret) {
            for (var i = 0; i < a.length; i++) ret.push(a[i]);
            for (var i = 0; i < b.length; i++) ret.push(b[i]);
            return ret;
          }
        }
        return a + b;
      },
      in: function (a, b, n) {
        var r = b.hasOwnProperty('indexOf') ? b.indexOf(a) >= 0 : a in b;
        return n ? !r : r;
      },
      multiply: function (a, b) {
        // TODO: non-sequence operand must be an integer
        if (pythonRuntime.internal.isSeq(a) && !isNaN(parseInt(b))) {
          var ret;
          if (a._type === 'list') ret = new pythonRuntime.objects.list();
          else if (a._type === 'tuple') ret = new pythonRuntime.objects.tuple();
          if (ret) {
            for (var i = 0; i < b; i++)
              for (var j = 0; j < a.length; j++) ret.push(a[j]);
            return ret;
          }
        }
        else if (pythonRuntime.internal.isSeq(b) && !isNaN(parseInt(a))) {
          var ret;
          if (b._type === 'list') ret = new pythonRuntime.objects.list();
          else if (b._type === 'tuple') ret = new pythonRuntime.objects.tuple();
          if (ret) {
            for (var i = 0; i < a; i++)
              for (var j = 0; j < b.length; j++) ret.push(b[j]);
            return ret;
          }
        }
        return a * b;
      },
      subscriptIndex: function (o, i) {
        if (pythonRuntime.internal.isSeq(o) && i < 0) return o.length + i;
        if (pythonRuntime.internal.isJSArray(o) && i < 0 ) return o.length + i;
        if ( typeof o === "string" && i < 0 ) return o.length + i;
        return i;
      }
    },

    objects: {
      dict: function () {
        var obj = {};
        for (var i in arguments) obj[arguments[i][0]] = arguments[i][1];
        pythonRuntime.utils.convertToDict(obj);
        return obj;
      },
      list: function () {
        var arr = [];
        arr.push.apply(arr, arguments);
        pythonRuntime.utils.convertToList(arr);
        return arr;
      },
      tuple: function () {
        var arr = [];
        arr.push.apply(arr, arguments);
        Object.defineProperty(arr, "_type",
        {
          get: function () { return 'tuple'; },
          enumerable: false
        });
        Object.defineProperty(arr, "_isPython",
        {
          get: function () { return true; },
          enumerable: false
        });
        Object.defineProperty(arr, "count",
        {
          value: function (x) {
            var c = 0;
            for (var i = 0; i < this.length; i++)
              if (this[i] === x) c++;
            return c;
          },
          enumerable: false
        });
        Object.defineProperty(arr, "equals",
        {
          value: function (x) {
            try {
              if (this.length !== x.length) return false;
              for (var i = 0; i < this.length; i++) {
                if (this[i].hasOwnProperty("equals")) {
                  if (!this[i].equals(x[i])) return false;
                } else if (this[i] !== x[i]) return false;
              }
              return true;
            }
            catch (e) { }
            return false;
          },
          enumerable: false
        });
        Object.defineProperty(arr, "index",
        {
          value: function (x) {
            return this.indexOf(x);
          },
          enumerable: false
        });
        Object.defineProperty(arr, "indexOf",
        {
          value: function (x, fromIndex) {
            try {
              for (var i = fromIndex ? fromIndex : 0; i < this.length; i++) {
                if (this[i].hasOwnProperty("equals")) {
                  if (this[i].equals(x)) return i;
                } else if (this[i] === x) return i;
              }
            }
            catch (e) { }
            return -1;
          },
          enumerable: false
        });
        Object.defineProperty(arr, "_pySlice",
        {
          value: function (start, end, step) { 
            return pythonRuntime.internal.slice(this, start, end, step);
          },
            enumerable: false
        });
        Object.defineProperty(arr, "toString",
        {
          value: function () {
            var s = '(' + this.join(', ');
            if (this.length === 1) s += ',';
            s += ')';
            return s;
          },
          enumerable: false
        });
        return arr;
      }
    },

    // Python built-in functions

    functions: {
      abs: function(x) {
        return Math.abs(x);
      },
      all: function(iterable) {
        for (var i in iterable) if (pythonRuntime.functions.bool(iterable[i]) !== true) return false;
        return true;
      },
      any: function(iterable) {
        for (var i in iterable) if (pythonRuntime.functions.bool(iterable[i]) === true) return true;
        return false;
      },
      ascii: function(obj) {
        var s = pythonRuntime.functions.repr(obj),
            asc = "",
            code;
        for (var i = 0; i < s.length; i++) {
          code = s.charCodeAt(i);
          if (code <= 127) asc += s[i];
          else if (code <= 0xFF) asc += "\\x" + code.toString(16);
          else if (0xD800 <= code && code <= 0xDBFF) { // UCS-2 for the astral chars
            // if (i+1 >= s.length) throw "High surrogate not followed by low surrogate"; // Is this needed?
            code = ((code-0xD800)*0x400)+(s.charCodeAt(++i)-0xDC00)+0x10000;
            asc += "\\U" + ("000"+code.toString(16)).slice(-8);
          } else if (code <= 0xFFFF) asc += "\\u" + ("0"+code.toString(16)).slice(-4);
          else if (code <= 0x10FFFF) asc += "\\U" + ("000"+code.toString(16)).slice(-8);
          else; // Invalid value, should probably throw something. It should never get here though as strings shouldn't contain them in the first place
        }
        return asc;
      },
      bool: function(x) {
        return !(x === undefined || // No argument
                 x === null || // None
                 x === false || // False
                 x === 0 || // Zero
                 x.length === 0 || // Empty Sequence
                 // TODO: Empty Mapping, needs more support for python mappings first
                 (x.__bool__ !== undefined && x.__bool__() === false) || // If it has bool conversion defined
                 (x.__len__ !== undefined && (x.__len__() === false || x.__len__() === 0))); // If it has length conversion defined
      },
      chr: function(i) {
        return String.fromCharCode(i); // TODO: Error code for not 0 <= i <= 1114111
      },
      divmod: function(a, b) {
        return pythonRuntime.objects.tuple(Math.floor(a/b), a%b);
      },
      enumerate: function(iterable, start) {
        start = start || 0;
        var ret = new pythonRuntime.objects.list();
        for (var i in iterable) ret.push(new pythonRuntime.objects.tuple(start++, iterable[i]));
        return ret;
      },
      filter: function(fn, iterable) {
        fn = fn || function () { return true; };
        var ret = new pythonRuntime.objects.list();
        for (var i in iterable) if (fn(iterable[i])) ret.push(iterable[i]);
        return ret;
      },
      float: function(x) {
        if (x === undefined) return 0.0;
        else if (typeof x == "string") { // TODO: Fix type check
          x = x.trim().toLowerCase();
          if ((/^[+-]?inf(inity)?$/i).exec(x) !== null) return Infinity*(x[0]==="-"?-1:1);
          else if ((/^nan$/i).exec(x) !== null) return NaN;
          else return parseFloat(x);
        } else if (typeof x == "number") { // TODO: Fix type check
          return x; // TODO: Get python types working right so we can return an actual float
        } else {
          if (x.__float__ !== undefined) return x.__float__();
          else return null; // TODO: Throw TypeError: float() argument must be a string or a number, not '<type of x>'
        }
      },
      hex: function(x) {
        return x.toString(16);
      },
      int: function (s) {
        return parseInt(s);
      },
      len: function (o) {
        return o.length;
      },
      list: function (iterable) {
        var ret = new pythonRuntime.objects.list();
        if (iterable instanceof Array) for (var i in iterable) ret.push(iterable[i]);
        else for (var i in iterable) ret.push(i);
        return ret;
      },
      map: function(fn, iterable) {
        // TODO: support additional iterables passed
        var ret = new pythonRuntime.objects.list();
        for (var i in iterable) ret.push(fn(iterable[i]));
        return ret;
      },
      max: function(arg1, arg2) {
        // TODO: support optional keyword-only arguments
        // TODO: empty iterable raises Python ValueError
        if (!arg2) { // iterable
          var max = null;
          for (var i in arg1) if (max === null || arg1[i] > max) max = arg1[i];
          return max;
        } else return arg1 >= arg2 ? arg1 : arg2;
      },
      min: function(arg1, arg2) {
        // TODO: support optional keyword-only arguments
        // TODO: empty iterable raises Python ValueError
        if (!arg2) { // iterable
          var max = null;
          for (var i in arg1) if (max === null || arg1[i] < max) max = arg1[i];
          return max;
        } else return arg1 <= arg2 ? arg1 : arg2;
      },
      oct: function(x) {
        return x.toString(8);
      },
      ord: function(c) {
        return c.charCodeAt(0);
      },
      pow: function(x, y, z) {
        return z ? Math.pow(x, y) % z : Math.pow(x, y);
      },
      print: function () {
        var s = "";
        for (var i = 0; i < arguments.length; i++)
          s += i === 0 ? arguments[i] : " " + arguments[i];
        console.log(s);
      },
      range: function (start, stop, step) {
        if (stop === undefined) {
          stop = start;
          start = 0;
          step = 1;
        }
        else if (step === undefined) step = 1;
        var r = new pythonRuntime.objects.list();
        if (start < stop && step > 0 || start > stop && step < 0) {
          var i = start;
          while (i < stop && step > 0 || i > stop && step < 0) {
            r.append(i);
            i += step;
          }
        }
        return r;
      },
      repr: function (obj) {
        if (typeof obj === 'string') return "'" + obj + "'"; // TODO: Patch until typesystem comes up.
        if (obj.__repr__ !== undefined) return obj.__repr__();
        else if (obj.__class__ !== undefined && obj.__class__.module !== undefined && obj.__class__.__name__) {
          return '<'+obj.__class__.__module__+'.'+obj.__class__.__name__+' object>';
        } else return obj.toString(); // Raise a please report warning here, we should never reach this piece of code
      },
      reversed: function (seq) {
        var ret = new pythonRuntime.objects.list();
        for (var i in seq) ret.push(seq[i]);
        return ret.reverse();
      },
      round: function (num, ndigits) {
        if (ndigits) {
          var scale = Math.pow(10, ndigits);
          return Math.round(num * scale) / scale;
        }
        return Math.round(num);
      },
      sorted: function (iterable, key, reverse) {
        var ret = new pythonRuntime.objects.list();
        for (var i in iterable) ret.push(iterable[i]);
        if(key) ret.sort(key); else ret.sort();
        if (reverse) ret.reverse();
        return ret;
      },
      str: function (obj) {
        return obj.toString();
      },
      sum: function (iterable, start) {
        // TODO: start can't be a string
        var ret = start || 0;
        for (var i in iterable) ret += iterable[i];
        return ret;
      },
      tuple: function (iterable) {
        var ret = new pythonRuntime.objects.tuple();
        for (var i in iterable) ret.push(iterable[i]);
        return ret;
      }
    },

    // Python imports
    // TODO: from x import y, z

    imports: {
      random: {
        random: function () { return Math.random(); }
      }
    }
  };
});

// Filbert: Loose parser
//
// This module provides an alternative parser (`parse_dammit`) that
// exposes that same interface as `parse`, but will try to parse
// anything as Python, repairing syntax errors the best it can.
// There are circumstances in which it will raise an error and give
// up, but they are very rare. The resulting AST will be a mostly
// valid JavaScript AST (as per the [Mozilla parser API][api], except
// that:
//
// - Return outside functions is allowed
//
// - Bogus Identifier nodes with a name of `""` are inserted whenever
//   the parser got too confused to return anything meaningful.
//
// [api]: https://developer.mozilla.org/en-US/docs/SpiderMonkey/Parser_API
//
// The expected use for this is to *first* try `filbert.parse`, and only
// if that fails switch to `parse_dammit`. The loose parser might
// parse badly indented code incorrectly, so **don't** use it as
// your default parser.
//
// Quite a lot of filbert.js is duplicated here. The alternative was to
// add a *lot* of extra cruft to that file, making it less readable
// and slower. Copying and editing the code allowed invasive changes and 
// simplifications without creating a complicated tangle.

(function(root, mod) {
  if (typeof exports == "object" && typeof module == "object") return mod(exports, require("./filbert")); // CommonJS
  if (typeof define == "function" && define.amd) return define(["exports", "./filbert_loose"], mod); // AMD
  mod(root.filbert_loose || (root.filbert_loose = {}), root.filbert); // Plain browser env
})(this, function(exports, filbert) {
  "use strict";

  var tt = filbert.tokTypes;
  var scope = filbert.scope;
  var indentHist = filbert.indentHist;

  var options, input, inputLen, fetchToken, nc;

  exports.parse_dammit = function(inpt, opts) {
    input = String(inpt); inputLen = input.length;
    setOptions(opts);
    if (!options.tabSize) options.tabSize = 4;
    fetchToken = filbert.tokenize(inpt, options);
    ahead.length = 0;
    newAstIdCount = 0;
    scope.init();
    nc = filbert.getNodeCreator(startNode, startNodeFrom, finishNode, unpackTuple);
    next();
    return parseTopLevel();
  };

  function setOptions(opts) {
    options = opts || {};
    for (var opt in filbert.defaultOptions) if (!Object.prototype.hasOwnProperty.call(options, opt))
      options[opt] = filbert.defaultOptions[opt];
    sourceFile = options.sourceFile || null;
  }

  var lastEnd, token = {start: 0, end: 0}, ahead = [];
  var lastEndLoc, sourceFile;

  var newAstIdCount = 0;

  function next() {
    lastEnd = token.end;
    if (options.locations) lastEndLoc = token.endLoc;

    if (ahead.length) token = ahead.shift();
    else token = readToken();
  }

  function readToken() {
    for (;;) {
      try {
        return fetchToken();
      } catch(e) {
        if (!(e instanceof SyntaxError)) throw e;

        // Try to skip some text, based on the error message, and then continue
        var msg = e.message, pos = e.raisedAt, replace = true;
        if (/unterminated/i.test(msg)) {
          pos = lineEnd(e.pos);
          if (/string/.test(msg)) {
            replace = {start: e.pos, end: pos, type: tt.string, value: input.slice(e.pos + 1, pos)};
          } else if (/regular expr/i.test(msg)) {
            var re = input.slice(e.pos, pos);
            try { re = new RegExp(re); } catch(e) {}
            replace = {start: e.pos, end: pos, type: tt.regexp, value: re};
          } else {
            replace = false;
          }
        } else if (/invalid (unicode|regexp|number)|expecting unicode|octal literal|is reserved|directly after number/i.test(msg)) {
          while (pos < input.length && !isSpace(input.charCodeAt(pos)) && !isNewline(input.charCodeAt(pos))) ++pos;
        } else if (/character escape|expected hexadecimal/i.test(msg)) {
          while (pos < input.length) {
            var ch = input.charCodeAt(pos++);
            if (ch === 34 || ch === 39 || isNewline(ch)) break;
          }
        } else if (/unexpected character/i.test(msg)) {
          pos++;
          replace = false;
        } else if (/regular expression/i.test(msg)) {
          replace = true;
        } else {
          throw e;
        }
        resetTo(pos);
        if (replace === true) replace = {start: pos, end: pos, type: tt.name, value: ""};
        if (replace) {
          if (options.locations) {
            replace.startLoc = filbert.getLineInfo(input, replace.start);
            replace.endLoc = filbert.getLineInfo(input, replace.end);
          }
          return replace;
        }
      }
    }
  }

  function resetTo(pos) {
    var ch = input.charAt(pos - 1);
    var reAllowed = !ch || /[\[\{\(,;:?\/*=+\-~!|&%^<>]/.test(ch) ||
      /[enwfd]/.test(ch) && /\b(keywords|case|else|return|throw|new|in|(instance|type)of|delete|void)$/.test(input.slice(pos - 10, pos));
    fetchToken.jumpTo(pos, reAllowed);
  }

  function copyToken(token) {
    var copy = {start: token.start, end: token.end, type: token.type, value: token.value};
    if (options.locations) {
      copy.startLoc = token.startLoc;
      copy.endLoc = token.endLoc;
    }
    return copy;
  }

  function lookAhead(n) {
    // Copy token objects, because fetchToken will overwrite the one
    // it returns, and in this case we still need it
    if (!ahead.length)
      token = copyToken(token);
    while (n > ahead.length)
      ahead.push(copyToken(readToken()));
    return ahead[n-1];
  }

  var newline = /[\n\r\u2028\u2029]/;
  var nonASCIIwhitespace = /[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/;

  function isNewline(ch) {
    return ch === 10 || ch === 13 || ch === 8232 || ch === 8329;
  }
  
  function isSpace(ch) {
    return ch === 9 || ch === 11 || ch === 12 ||
      ch === 32 || // ' '
      ch === 35 || // '#'
      ch === 160 || // '\xa0'
      ch >= 5760 && nonASCIIwhitespace.test(String.fromCharCode(ch));
  }
  
  function lineEnd(pos) {
    while (pos < input.length && !isNewline(input.charCodeAt(pos))) ++pos;
    return pos;
  }

  function skipLine() {
    fetchToken.jumpTo(lineEnd(token.start), false);
  }

  function Node(start) {
    this.type = null;
  }
  Node.prototype = filbert.Node.prototype;

  function SourceLocation(start) {
    this.start = start || token.startLoc || {line: 1, column: 0};
    this.end = null;
    if (sourceFile !== null) this.source = sourceFile;
  }

  function startNode() {
    var node = new Node(token.start);
    if (options.locations)
      node.loc = new SourceLocation();
    if (options.directSourceFile)
      node.sourceFile = options.directSourceFile;
    if (options.ranges)
      node.range = [token.start, 0];
    return node;
  }

  function startNodeFrom(other) {
    var node = new Node(other.start);
    if (options.locations)
      node.loc = new SourceLocation(other.loc.start);
    if (options.ranges)
      node.range = [other.range[0], 0];
    return node;
  }

  function finishNode(node, type) {
    node.type = type;
    if (options.locations)
      node.loc.end = lastEndLoc;
    if (options.ranges)
      node.range[1] = lastEnd;
    return node;
  }

  function getDummyLoc() {
    if (options.locations) {
      var loc = new SourceLocation();
      loc.end = loc.start;
      return loc;
    }
  }

  var dummyCount = 0
  function dummyIdent() {
    var dummy = new Node(token.start);
    dummy.type = "Identifier";
    dummy.end = token.start;
    dummy.name = "dummy" + dummyCount++;
    dummy.loc = getDummyLoc();
    return dummy;
  }
  function isDummy(node) { return node.name && node.name.indexOf("dummy") === 0; }

  function eat(type) {
    if (token.type === type) {
      next();
      return true;
    }
  }

  function expect(type) {
    if (eat(type)) return true;
    if (lookAhead(1).type == type) {
      next(); next();
      return true;
    }
    if (lookAhead(2).type == type) {
      next(); next(); next();
      return true;
    }
  }

  function checkLVal(expr) {
    if (expr.type === "Identifier" || expr.type === "MemberExpression") return expr;
    return dummyIdent();
  }

  // Get args for a new tuple expression

  function getTupleArgs(expr) {
    if (expr.callee && expr.callee.object && expr.callee.object.object &&
      expr.callee.object.object.name === options.runtimeParamName &&
      expr.callee.property && expr.callee.property.name === "tuple")
      return expr.arguments;
    return null;
  }

  // Unpack an lvalue tuple into indivual variable assignments
  // 'arg0, arg1 = right' becomes:
  // var tmp = right
  // arg0 = tmp[0]
  // arg1 = tmp[1]
  // ...

  function unpackTuple(tupleArgs, right) {
    var varStmts = [];

    // var tmp = right

    var tmpId = nc.createNodeSpan(right, right, "Identifier", { name: "__filbertTmp" + newAstIdCount++ });
    var tmpDecl = nc.createVarDeclFromId(right, tmpId, right);
    varStmts.push(tmpDecl);

    // argN = tmp[N]

    if (tupleArgs && tupleArgs.length > 0) {
      for (var i = 0; i < tupleArgs.length; i++) {
        var lval = tupleArgs[i];
        var subTupleArgs = getTupleArgs(lval);
        if (subTupleArgs) {
          var subLit = nc.createNodeSpan(right, right, "Literal", { value: i });
          var subRight = nc.createNodeSpan(right, right, "MemberExpression", { object: tmpId, property: subLit, computed: true });
          var subStmts = unpackTuple(subTupleArgs, subRight);
          for (var j = 0; j < subStmts.length; j++) varStmts.push(subStmts[j]);
        } else {
          checkLVal(lval);
          var indexId = nc.createNodeSpan(right, right, "Literal", { value: i });
          var init = nc.createNodeSpan(right, right, "MemberExpression", { object: tmpId, property: indexId, computed: true });
          if (lval.type === "Identifier" && !scope.exists(lval.name)) {
            scope.addVar(lval.name);
            var varDecl = nc.createVarDeclFromId(lval, lval, init);
            varStmts.push(varDecl);
          }
          else {
            var node = startNodeFrom(lval);
            node.left = lval;
            node.operator = "=";
            node.right = init;
            finishNode(node, "AssignmentExpression");
            varStmts.push(nc.createNodeFrom(node, "ExpressionStatement", { expression: node }));
          }
        }
      }
    }

    return varStmts;
  }

  // ### Statement parsing

  function parseTopLevel() {
    var node = startNode();
    node.body = [];
    while (token.type !== tt.eof) {
      var stmt = parseStatement();
      if (stmt) node.body.push(stmt);
    }
    return finishNode(node, "Program");
  }

  function parseStatement() {
    var starttype = token.type, node = startNode();

    switch (starttype) {

    case tt._break:
      next();
      return finishNode(node, "BreakStatement");

    case tt._continue:
      next();
      return finishNode(node, "ContinueStatement");

    case tt._class:
      next();
      return parseClass(node);

    case tt._def:
      next();
      return parseFunction(node);

    case tt._for:
      next();
      return parseFor(node);

    case tt._from: // Skipping from and import statements for now
      skipLine();
      next();
      return parseStatement();

    case tt._if: case tt._elif:
      next();
      if (token.type === tt.parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      expect(tt.colon);
      node.consequent = parseSuite();
      if (token.type === tt._elif)
        node.alternate = parseStatement();
      else
        node.alternate = eat(tt._else) && eat(tt.colon) ? parseSuite() : null;
      return finishNode(node, "IfStatement");

    case tt._import: // Skipping from and import statements for now
      skipLine();
      next();
      return parseStatement();

    case tt.newline:
      // TODO: parseStatement() should probably eat it's own newline
      next();
      return null;

    case tt._pass:
      next();
      return finishNode(node, "EmptyStatement");

    case tt._return:
      next();
      if (token.type === tt.newline || token.type === tt.eof) node.argument = null;
      else { node.argument = parseExpression(); }
      return finishNode(node, "ReturnStatement"); 

    case tt._while:
      next();
      if (token.type === tt.parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      expect(tt.colon);
      node.body = parseSuite();
      return finishNode(node, "WhileStatement");

    case tt.semi:
      next();
      return finishNode(node, "EmptyStatement");

    case tt.indent:
      // Unexpected indent, let's ignore it
      indentHist.undoIndent();
      next();
      return parseStatement();

    default:
      var expr = parseExpression();
      if (isDummy(expr)) {
        next();
        if (token.type === tt.eof) return finishNode(node, "EmptyStatement");
        return parseStatement();
      } else if (expr.type === "VariableDeclaration" || expr.type === "BlockStatement") {
        return expr;
      } else {
        node.expression = expr;
        return finishNode(node, "ExpressionStatement");
      }
    }
  }

  function parseSuite() {
    var node = startNode();
    node.body = [];
    if (eat(tt.newline)) {
      eat(tt.indent);
      while (!eat(tt.dedent) && token.type !== tt.eof) {
        var stmt = parseStatement();
        if (stmt) node.body.push(stmt);
      }
    } else {
      node.body.push(parseStatement());
      next();
    }
    return finishNode(node, "BlockStatement");
  }

  function parseFor(node) {
    var init = parseExpression(false, true);
    var tupleArgs = getTupleArgs(init);
    if (!tupleArgs) checkLVal(init);
    expect(tt._in);
    var right = parseExpression();
    expect(tt.colon);
    var body = parseSuite();
    finishNode(node, "BlockStatement");
    return nc.createFor(node, init, tupleArgs, right, body);
  }

  // ### Expression parsing

  function parseExpression(noComma, noIn) {
    return parseMaybeAssign(noIn);
  }

  function parseParenExpression() {
    expect(tt.parenL);
    var val = parseExpression();
    expect(tt.parenR);
    return val;
  }

  function parseMaybeAssign(noIn) {
    var left = parseMaybeTuple(noIn);
    if (token.type.isAssign) {
      var tupleArgs = getTupleArgs(left);
      if (tupleArgs) {
        next();
        var right = parseMaybeTuple(noIn);
        var blockNode = startNodeFrom(left);
        blockNode.body = unpackTuple(tupleArgs, right);
        return finishNode(blockNode, "BlockStatement");
      }

      if (scope.isClass()) {
        var thisExpr = nc.createNodeFrom(left, "ThisExpression");
        left = nc.createNodeFrom(left, "MemberExpression", { object: thisExpr, property: left });
      }

      var node = startNodeFrom(left);
      node.operator = token.value;
      node.left = checkLVal(left);
      next();
      node.right = parseMaybeTuple(noIn);

      if (node.operator === '+=' || node.operator === '*=') {
        var right = nc.createNodeSpan(node.right, node.right, "CallExpression");
        right.callee = nc.createNodeOpsCallee(right, node.operator === '+=' ? "add" : "multiply");
        right.arguments = [left, node.right];
        node.right = right;
        node.operator = '=';
      }

      if (left.type === "Identifier" && !scope.exists(left.name)) {
        scope.addVar(left.name);
        return nc.createVarDeclFromId(node.left, node.left, node.right);
      }

      return finishNode(node, "AssignmentExpression");
    }
    return left;
  }

  function parseMaybeTuple(noIn) {
    var expr = parseExprOps(noIn);
    if (token.type === tt.comma) {
      return parseTuple(noIn, expr);
    }
    return expr;
  }

  function parseExprOps(noIn) {
    return parseExprOp(parseMaybeUnary(noIn), -1, noIn);
  }

  function parseExprOp(left, minPrec, noIn) {
    var node, exprNode, right, op = token.type, val = token.value;
    var prec = op === tt._not ? tt._in.prec : op.prec;
    if (op === tt.exponentiation && prec >= minPrec) {
      node = startNodeFrom(left);
      next();
      right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
      exprNode = nc.createNodeMemberCall(node, "Math", "pow", [left, right]);
      return parseExprOp(exprNode, minPrec, noIn);
    } else if (prec != null && (!noIn || op !== tt._in)) {
      if (prec > minPrec) {
        next();
        node = startNodeFrom(left);
        if (op === tt.floorDiv) {
          right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
          finishNode(node);
          var binExpr = nc.createNodeSpan(node, node, "BinaryExpression", { left: left, operator: '/', right: right });
          exprNode = nc.createNodeMemberCall(node, "Math", "floor", [binExpr]);
        } else if (op === tt._in || op === tt._not) {
          if (op === tt._in || eat(tt._in)) {
            right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
            finishNode(node);
            var notLit = nc.createNodeSpan(node, node, "Literal", { value: op === tt._not });
            exprNode = nc.createNodeRuntimeCall(node, 'ops', 'in', [left, right, notLit]);
          } else exprNode = dummyIdent();
        } else if (op === tt.plusMin && val === '+' || op === tt.multiplyModulo && val === '*') {
          node.arguments = [left];
          node.arguments.push(parseExprOp(parseMaybeUnary(noIn), prec, noIn));
          finishNode(node, "CallExpression");
          node.callee = nc.createNodeOpsCallee(node, op === tt.plusMin ? "add" : "multiply");
          exprNode = node;
        } else {
          if (op === tt._is) {
            if (eat(tt._not)) node.operator = "!==";
            else node.operator = "===";
          } else node.operator = op.rep != null ? op.rep : val;

          // Accept '===' as '=='
          if (input[token.start - 1] === '=' && input[token.start - 2] === '=') next();

          node.left = left;
          node.right = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
          exprNode = finishNode(node, (op === tt._or || op === tt._and) ? "LogicalExpression" : "BinaryExpression");
        }
        return parseExprOp(exprNode, minPrec, noIn);
      }
    }
    return left;
  }

  function parseMaybeUnary(noIn) {
    if (token.type.prefix || token.type === tt.plusMin) {
      var prec = token.type === tt.plusMin ? tt.posNegNot.prec : token.type.prec;
      var node = startNode();
      node.operator = token.type.rep != null ? token.type.rep : token.value;
      node.prefix = true;
      next();
      node.argument = parseExprOp(parseMaybeUnary(noIn), prec, noIn);
      return finishNode(node, "UnaryExpression");
    }
    return parseSubscripts(parseExprAtom(), false);
  }

  function parseSubscripts(base, noCalls) {
    var node = startNodeFrom(base);
    if (eat(tt.dot)) {
      var id = parseIdent(true);
      if (filbert.pythonRuntime.imports[base.name] && filbert.pythonRuntime.imports[base.name][id.name]) {
        // Calling a Python import function
        var runtimeId = nc.createNodeSpan(base, base, "Identifier", { name: options.runtimeParamName });
        var importsId = nc.createNodeSpan(base, base, "Identifier", { name: "imports" });
        var runtimeMember = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeId, property: importsId, computed: false });
        node.object = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeMember, property: base, computed: false });
      } else if (base.name && base.name === scope.getThisReplace()) {
        node.object = nc.createNodeSpan(base, base, "ThisExpression");
      } else node.object = base;
      node.property = id;
      node.computed = false;
      return parseSubscripts(finishNode(node, "MemberExpression"), noCalls);
    } else if (eat(tt.bracketL)) {
      var expr, isSlice = false;
      if (eat(tt.colon)) isSlice = true;
      else expr = parseExpression();
      if (!isSlice && eat(tt.colon)) isSlice = true;
      if (isSlice) return parseSlice(node, base, expr, noCalls);
      var subscriptCall = nc.createNodeSpan(expr, expr, "CallExpression");
      subscriptCall.callee = nc.createNodeOpsCallee(expr, "subscriptIndex");
      subscriptCall.arguments = [base, expr];
      node.object = base;
      node.property = subscriptCall;
      node.computed = true;
      expect(tt.bracketR);
      return parseSubscripts(finishNode(node, "MemberExpression"), noCalls);
    } else if (!noCalls && eat(tt.parenL)) {
      if (scope.isUserFunction(base.name)) {
        // Unpack parameters into JavaScript-friendly parameters, further processed at runtime
        var createParamsCall = nc.createNodeRuntimeCall(node, 'utils', 'createParamsObj', parseParamsList());
        node.arguments = [createParamsCall];
      } else node.arguments = parseExprList(tt.parenR, false);
      
      if (scope.isNewObj(base.name)) finishNode(node, "NewExpression");
      else finishNode(node, "CallExpression");
      if (filbert.pythonRuntime.functions[base.name]) {
        // Calling a Python built-in function
        var runtimeId = nc.createNodeSpan(base, base, "Identifier", { name: options.runtimeParamName });
        var functionsId = nc.createNodeSpan(base, base, "Identifier", { name: "functions" });
        var runtimeMember = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeId, property: functionsId, computed: false });
        node.callee = nc.createNodeSpan(base, base, "MemberExpression", { object: runtimeMember, property: base, computed: false });
      } else node.callee = base;
      return parseSubscripts(node, noCalls);
    }
    return base;
  }

  function parseSlice(node, base, start, noCalls) {
    var end, step;
    if (!start) start = nc.createNodeFrom(node, "Literal", { value: null });
    if (token.type === tt.bracketR || eat(tt.colon)) {
      end = nc.createNodeFrom(node, "Literal", { value: null });
    } else {
      end = parseExpression();
      if (token.type !== tt.bracketR) expect(tt.colon);
    }
    if (token.type === tt.bracketR) step = nc.createNodeFrom(node, "Literal", { value: null });
    else step = parseExpression();
    expect(tt.bracketR);

    node.arguments = [start, end, step];
    var sliceId = nc.createNodeFrom(base, "Identifier", { name: "_pySlice" });
    var memberExpr = nc.createNodeSpan(base, base, "MemberExpression", { object: base, property: sliceId, computed: false });
    node.callee = memberExpr;
    return parseSubscripts(finishNode(node, "CallExpression"), noCalls);
  }

  function parseExprAtom() {
    switch (token.type) {

    case tt._dict:
      next();
      return parseDict(tt.parenR);

    case tt.name:
      return parseIdent();

    case tt.num: case tt.string: case tt.regexp:
      var node = startNode();
      node.value = token.value;
      node.raw = input.slice(token.start, token.end);
      next();
      return finishNode(node, "Literal");

    case tt._None: case tt._True: case tt._False:
      var node = startNode();
      node.value = token.type.atomValue;
      node.raw = token.type.keyword;
      next();
      return finishNode(node, "Literal");

    case tt.parenL:
      var tokStartLoc1 = token.startLoc, tokStart1 = token.start;
      next();
      if (token.type === tt.parenR) {
        var node = parseTuple(true);
        eat(tt.parenR);
        return node;
      }
      var val = parseMaybeTuple(true);
      if (options.locations) {
        val.loc.start = tokStartLoc1;
        val.loc.end = token.endLoc;
      }
      if (options.ranges)
        val.range = [tokStart1, token.end];
      expect(tt.parenR);
      return val;

    case tt.bracketL:
      return parseList();

    case tt.braceL:
      return parseDict(tt.braceR);

    default:
      return dummyIdent();
    }
  }

  // Parse list

  // Custom list object is used to simulate native Python list
  // E.g. Python '[]' becomes JavaScript 'new __pythonRuntime.objects.list();'
  // If list comprehension, build something like this:
  //(function() {
  //  var _list = [];
  //  ...
  //  _list.push(expr);
  //  return _list;
  //}());

  function parseList() {
    var node = startNode();
    node.arguments = [];
    next();

    if (!eat(tt.bracketR)) {
      var expr = parseExprOps(false);
      if (token.type === tt._for || token.type === tt._if) {

        // List comprehension
        var tmpVarSuffix = newAstIdCount++;
        expr = nc.createListCompPush(expr, tmpVarSuffix);
        var body = parseCompIter(expr, true);
        finishNode(node);
        return nc.createListCompIife(node, body, tmpVarSuffix);

      } else if (eat(tt.comma)) {
        node.arguments = [expr].concat(parseExprList(tt.bracketR, true, false));
      }
      else {
        expect(tt.bracketR);
        node.arguments = [expr];
      }
    }

    finishNode(node, "NewExpression");
    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "list" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });
    return node;
  }

  // Parse a comp_iter from Python language grammar
  // 'expr' is the body to be used after unrolling the ifs and fors

  function parseCompIter(expr, first) {
    if (first && token.type !== tt._for) return dummyIdent();
    if (eat(tt.bracketR)) return expr;
    var node = startNode();
    if (eat(tt._for)) {
      var init = parseExpression(false, true);
      var tupleArgs = getTupleArgs(init);
      if (!tupleArgs) checkLVal(init);
      expect(tt._in);
      var right = parseExpression();
      var body = parseCompIter(expr, false);
      var block = nc.createNodeSpan(body, body, "BlockStatement", { body: [body] });
      finishNode(node, "BlockStatement");
      return nc.createFor(node, init, tupleArgs, right, block);
    } else if (eat(tt._if)) {
      if (token.type === tt.parenL) node.test = parseParenExpression();
      else node.test = parseExpression();
      node.consequent = parseCompIter(expr, false);
      return finishNode(node, "IfStatement");
    } else return dummyIdent();
  }

  // Parse class

  function parseClass(ctorNode) {
    // Container for class constructor and prototype functions
    var container = startNodeFrom(ctorNode);
    container.body = [];

    // Parse class signature
    ctorNode.id = parseIdent();
    ctorNode.params = [];
    var classParams = [];
    if (eat(tt.parenL)) {
      var first = true;
      while (!eat(tt.parenR) && token.type !== tt.eof) {
        if (!first) expect(tt.comma); else first = false;
        classParams.push(parseIdent());
      }
    }
    expect(tt.colon);

    // Start new namespace for class body
    scope.startClass(ctorNode.id.name);

    // Save a reference for source ranges
    var classBodyRefNode = finishNode(startNode());

    // Parse class body
    var classBlock = parseSuite();

    // Generate additional AST to implement class
    var classStmt = nc.createClass(container, ctorNode, classParams, classBodyRefNode, classBlock);

    scope.end();

    return classStmt;
  }

  // Parse dictionary
  // Custom dict object used to simulate native Python dict
  // E.g. "{'k1':'v1', 'k2':'v2'}" becomes "new __pythonRuntime.objects.dict(['k1', 'v1'], ['k2', 'v2']);"

  function parseDict(tokClose) {
    var node = startNode(), first = true, key, value;
    node.arguments = [];
    next();
    while (!eat(tokClose) && !eat(tt.newline) && token.type !== tt.eof) {
      if (!first) {
        expect(tt.comma);
      } else first = false;

      if (tokClose === tt.braceR) {
        key = parsePropertyName();
        expect(tt.colon);
        value = parseExprOps(false);
      } else if (tokClose === tt.parenR) {
        var keyId = parseIdent(true);
        key = startNodeFrom(keyId);
        key.value = keyId.name;
        finishNode(key, "Literal");
        expect(tt.eq);
        value = parseExprOps(false);
      }
      node.arguments.push(nc.createNodeSpan(key, value, "ArrayExpression", { elements: [key, value] }));
    }
    finishNode(node, "NewExpression");

    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "dict" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });

    return node;
  }

  function parsePropertyName() {
    if (token.type === tt.num || token.type === tt.string) return parseExprAtom();
    if (token.type === tt.name || token.type.keyword) return parseIdent();
  }

  function parseIdent() {
    var node = startNode();
    node.name = token.type === tt.name ? token.value : token.type.keyword;
    if (!node.name) node = dummyIdent();
    next();
    return finishNode(node, "Identifier");
  }

  function parseFunction(node) {
    var suffix = newAstIdCount++;
    node.id = parseIdent();
    node.params = [];

    // Parse parameters

    var formals = [];     // In order, maybe with default value
    var argsId = null;    // *args
    var kwargsId = null;  // **kwargs
    var first = true;
    expect(tt.parenL);
    while (!eat(tt.parenR) && token.type !== tt.eof) {
      if (!first) expect(tt.comma); else first = false;
      if (token.value === '*') {
        next(); argsId = parseIdent();
      } else if (token.value === '**') {
        next(); kwargsId = parseIdent();
      } else {
        var paramId = parseIdent();
        if (eat(tt.eq))
          formals.push({ id: paramId, expr: parseExprOps(false) });
        else
          formals.push({ id: paramId, expr: null });
      }
    }
    expect(tt.colon);

    scope.startFn(node.id.name);

    // If class method, remove class instance var from params and save for 'this' replacement
    if (scope.isParentClass()) {
      var selfId = formals.shift();
      scope.setThisReplace(selfId.id.name);
    }

    var body = parseSuite();
    node.body = nc.createNodeSpan(body, body, "BlockStatement", { body: [] });

    // Add runtime parameter processing

    if (formals.length > 0 || argsId || kwargsId) {
      node.body.body.push(nc.createNodeParamsCheck(node.id, suffix));
      node.body.body.push(nc.createVarDeclFromId(node.id,
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: '__formalsIndex' + suffix }),
        nc.createNodeSpan(node.id, node.id, "Literal", { value: 0 })));
      node.body.body.push(nc.createVarDeclFromId(node.id,
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: '__args' + suffix }),
        nc.createNodeSpan(node.id, node.id, "Identifier", { name: 'arguments' })));
    }
    if (formals.length > 0) {
      node.body.body.push(nc.createNodeGetParamFn(node.id, suffix));
      for (var i = 0; i < formals.length; i++) {
        var __getParamCall = nc.createNodeSpan(formals[i].id, formals[i].id, "CallExpression", {
          callee: nc.createNodeSpan(formals[i].id, formals[i].id, "Identifier", { name: '__getParam' + suffix }),
          arguments: [nc.createNodeSpan(formals[i].id, formals[i].id, "Literal", { value: formals[i].id.name })]
        });
        if (formals[i].expr) __getParamCall.arguments.push(formals[i].expr);
        node.body.body.push(nc.createVarDeclFromId(formals[i].id, formals[i].id, __getParamCall));
      }
    }
    var refNode = argsId || kwargsId;
    if (refNode) {
      if (argsId) {
        var argsAssign = nc.createVarDeclFromId(argsId, argsId, nc.createNodeSpan(argsId, argsId, "ArrayExpression", { elements: [] }));
        node.body.body.push(argsAssign);
      }
      if (kwargsId) {
        var kwargsAssign = nc.createVarDeclFromId(kwargsId, kwargsId, nc.createNodeSpan(kwargsId, kwargsId, "ObjectExpression", { properties: [] }));
        node.body.body.push(kwargsAssign);
      }
      var argsIf = nc.createNodeSpan(refNode, refNode, "IfStatement", {
        test: nc.createNodeSpan(refNode, refNode, "Identifier", { name: '__params' + suffix }),
        consequent: nc.createNodeSpan(refNode, refNode, "BlockStatement", { body: [] })
      })
      if (argsId) {
        argsIf.consequent.body.push(nc.createNodeArgsWhileConsequent(argsId, suffix));
        argsIf.alternate = nc.createNodeArgsAlternate(argsId);
      }
      if (kwargsId) {
        argsIf.consequent.body.push(nc.createNodeSpan(kwargsId, kwargsId, "ExpressionStatement", {
          expression: nc.createNodeSpan(kwargsId, kwargsId, "AssignmentExpression", {
            operator: '=', left: kwargsId, right: nc.createNodeMembIds(kwargsId, '__params' + suffix, 'keywords'),
          })
        }));
      }
      node.body.body.push(argsIf);
    }
    node.body.body.push(nc.createNodeFnBodyIife(body));

    // If class method, replace with prototype function literals
    var retNode;
    if (scope.isParentClass()) {
      finishNode(node);
      var classId = nc.createNodeSpan(node, node, "Identifier", { name: scope.getParentClassName() });
      var prototypeId = nc.createNodeSpan(node, node, "Identifier", { name: "prototype" });
      var functionId = node.id;
      var prototypeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: classId, property: prototypeId, computed: false });
      var functionMember = nc.createNodeSpan(node, node, "MemberExpression", { object: prototypeMember, property: functionId, computed: false });
      var functionExpr = nc.createNodeSpan(node, node, "FunctionExpression", { body: node.body, params: node.params });
      var assignExpr = nc.createNodeSpan(node, node, "AssignmentExpression", { left: functionMember, operator: "=", right: functionExpr });
      retNode = nc.createNodeSpan(node, node, "ExpressionStatement", { expression: assignExpr });
    } else retNode = finishNode(node, "FunctionDeclaration");

    scope.end();

    return retNode;
  }

  function parseExprList(close) {
    var elts = [];
    while (!eat(close) && !eat(tt.newline) && token.type !== tt.eof) {
      var elt = parseExprOps(false);
      if (isDummy(elt)) {
        next();
      } else {
        elts.push(elt);
      }
      while (eat(tt.comma)) {}
    }
    return elts;
  }

  function parseParamsList() {
    var elts = [], first = true;
    while (!eat(tt.parenR) && !eat(tt.newline) && token.type !== tt.eof) {
      if (!first) expect(tt.comma);
      else first = false;
      var expr = parseExprOps(false);
      if (eat(tt.eq)) {
        var right = parseExprOps(false);
        var kwId = nc.createNodeSpan(expr, right, "Identifier", { name: "__kwp" });
        var kwLit = nc.createNodeSpan(expr, right, "Literal", { value: true });
        var left = nc.createNodeSpan(expr, right, "ObjectExpression", { properties: [] });
        left.properties.push({ type: "Property", key: expr, value: right, kind: "init" });
        left.properties.push({ type: "Property", key: kwId, value: kwLit, kind: "init" });
        expr = left;
      }
      elts.push(expr);
    }
    return elts;
  }

  function parseTuple(noIn, expr) {
    var node = expr ? startNodeFrom(expr) : startNode();
    node.arguments = expr ? [expr] : [];

    // Tuple with single element has special trailing comma: t = 'hi',
    // Look ahead and eat comma in this scenario
    if (token.type === tt.comma) {
      var pos = token.start + 1;
      while (isSpace(input.charCodeAt(pos))) ++pos;
      if (pos >= inputLen || input[pos] === ';' || input[pos] === ')' || isNewline(input.charCodeAt(pos)))
        eat(tt.comma);
    }

    while (eat(tt.comma)) {
      node.arguments.push(parseExprOps(noIn));
    }
    finishNode(node, "NewExpression");

    var runtimeId = nc.createNodeSpan(node, node, "Identifier", { name: options.runtimeParamName });
    var objectsId = nc.createNodeSpan(node, node, "Identifier", { name: "objects" });
    var runtimeMember = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeId, property: objectsId, computed: false });
    var listId = nc.createNodeSpan(node, node, "Identifier", { name: "tuple" });
    node.callee = nc.createNodeSpan(node, node, "MemberExpression", { object: runtimeMember, property: listId, computed: false });

    return node;
  }
});

TarGZ = function(){};

// Load and parse archive, calls onload after loading all files.
TarGZ.load = function(url, onload, onstream, onerror) 
{
  var o = new TarGZ();
  o.onload = onload;
  o.onerror = onerror;
  o.onstream = onstream;
  o.load(url);
  return o;
};

// Streams an archive from the given url, calling onstream after loading each file in archive.
// Calls onload after loading all files.
TarGZ.stream = function(url, onstream, onload, onerror) 
{
  var o = new TarGZ();
  o.onload = onload;
  o.onerror = onerror;
  o.onstream = onstream;
  o.load(url);
  return o;
};

TarGZ.prototype = {
  onerror : null,
  onload : null,
  onstream : null,
  ondata : null,
  
  load : function(url) {
    var self = this;
    var offset = {chunkBytes: 0, chunks: 0};
    var byteOffset = 0;
    this.files = [];
    GZip.load(url,
      function(h) {
        byteOffset = self.processTarChunks(h.data, byteOffset, h.outputSize);
        if (self.onload)
          self.onload(self.files, h);
      },
      function(h) {
        self.gzip = h;
        if (self.ondata) self.ondata(h);
        byteOffset = self.processTarChunks(h.data, byteOffset, h.outputSize);
      },
      function(xhr, e, h) {
        if (self.onerror)
          self.onerror(xhr, e, h);
      }
    );
  },
 
  cleanHighByte : function(s) {
    return s.replace(/./g, function(m) { 
      return String.fromCharCode(m.charCodeAt(0) & 0xff);
    });
  },
  
  parseTar : function(text) {
    this.files = [];
    this.processTarChunks([text], 0, text.length);
  },
  processTarChunks : function (chunks, offset, totalSize) {
    while (totalSize >= offset + 512) {
      var header = this.files.length == 0 ? null : this.files[this.files.length-1];
      if (header && header.data == null) {
        if (offset + header.length <= totalSize) {
          header.data = this.chunkSubstring(chunks, offset, offset+header.length);
          header.toDataURL = this.__toDataURL;
          offset += 512 * Math.ceil(header.length / 512);
          if (this.onstream) 
            this.onstream(header, this.gzip);
        } else { // not loaded yet
          break;
        }
      } else {
        var s = this.chunkSubstring(chunks, offset, offset+512);
        var header = this.parseTarHeader(s, 0);
        if (header.length > 0 || header.filename != '') {
          this.files.push(header);
          offset += 512;
          header.offset = offset;
        } else { // empty header, stop processing
          offset = totalSize;
        }
      }
    }
    return offset;
  },
  parseTarHeader : function(text, offset) {
    var i = offset || 0;
    var h = {};
    h.filename = text.substring(i, i+=100).split("\0", 1)[0];
    h.mode = text.substring(i, i+=8).split("\0", 1)[0];
    h.uid = text.substring(i, i+=8).split("\0", 1)[0];
    h.gid = text.substring(i, i+=8).split("\0", 1)[0];
    h.length = this.parseTarNumber(text.substring(i, i+=12));
    h.lastModified = text.substring(i, i+=12).split("\0", 1)[0];
    h.checkSum = text.substring(i, i+=8).split("\0", 1)[0];
    h.fileType = text.substring(i, i+=1).split("\0", 1)[0];
    h.linkName = text.substring(i, i+=100).split("\0", 1)[0];
    return h;
  },
  parseTarNumber : function(text) {
    // if (text.charCodeAt(0) & 0x80 == 1) {
    // GNU tar 8-byte binary big-endian number
    // } else {
      return parseInt(text.replace(/[^\d]/g, ''), 8);
    // }
  },

  // extract substring from an array of strings
  chunkSubstring : function (chunks, start, end) {
    var soff=0, eoff=0, i=0, j=0;
    for (i=0; i<chunks.length; i++) {
      if (soff + chunks[i].length > start)
        break;
      soff += chunks[i].length;
    }
    var strs = [];
    eoff = soff;
    for (j=i; j<chunks.length; j++) {
      strs.push(chunks[j]);
      if (eoff + chunks[j].length > end)
        break;
      eoff += chunks[j].length;
    }
    var s = strs.join('');
    return s.substring(start-soff, start-soff+(end-start));
  },

  __toDataURL : function() {
    if (this.data.substring(0,40).match(/^data:[^\/]+\/[^,]+,/)) {
      return this.data;
    } else if (TarGZ.prototype.cleanHighByte(this.data.substring(0,10)).match(/\377\330\377\340..JFIF/)) {
      return 'data:image/jpeg;base64,'+btoa(TarGZ.prototype.cleanHighByte(this.data));
    } else if (TarGZ.prototype.cleanHighByte(this.data.substring(0,6)) == "\211PNG\r\n") {
      return 'data:image/png;base64,'+btoa(TarGZ.prototype.cleanHighByte(this.data));
    } else if (TarGZ.prototype.cleanHighByte(this.data.substring(0,6)).match(/GIF8[79]a/)) {
      return 'data:image/gif;base64,'+btoa(TarGZ.prototype.cleanHighByte(this.data));
    } else 
    {
      //console.log("toDataURL: I don't know how to handle " + this.filename);
      return 'data:audio/wav;base64,'+btoa(TarGZ.prototype.cleanHighByte(this.data));
    }
  }
};



Bin = {
  byte : function(s, offset) {
    return s.charCodeAt(offset) & 0xff;
  },

  UInt16BE : function(s, offset) {
    return ((Bin.byte(s, offset) << 8) | Bin.byte(s, offset+1));
  },

  UInt32BE : function(s, offset) {
    return (
      (Bin.byte(s, offset) << 24) |
      (Bin.byte(s, offset+1) << 16) |
      (Bin.byte(s, offset+2) << 8) |
       Bin.byte(s, offset+3));
  },

  UInt16LE : function(s, offset) {
    return ((Bin.byte(s, offset+1) << 8) | Bin.byte(s, offset));
  },

  UInt32LE : function(s, offset) {
    return (
      (Bin.byte(s, offset+3) << 24) |
      (Bin.byte(s, offset+2) << 16) |
      (Bin.byte(s, offset+1) << 8) |
       Bin.byte(s, offset));
  },

  CString : function(s, offset) {
    var zeroIdx = offset;
    for (; zeroIdx<s.length; zeroIdx++) {
      if (Bin.byte(s, zeroIdx) == 0)
        break;
    }
    if (zeroIdx == s.length)
      throw("No null byte encountered");
    return s.substring(offset, zeroIdx);
  },

  CRC16 : function(s, start, length, crc) {
    return crc32(s, start, length, crc) & 0xffff;
  },

  CRC32 : function(s, start, length, crc) {
    return crc32(s, start, length, crc);
  }
};

GZip = {
  DEFLATE:  8,
  FTEXT:    1 << 0,
  FHCRC:    1 << 1,
  FEXTRA:   1 << 2,
  FNAME:    1 << 3,
  FCOMMENT: 1 << 4,

  loadlocal : function(data, onload, onstream, onerror) 
  {
    var self = this;
    var h = null;
    var s = data;

    try 
    {
    	var t = new Date;
    	if (!h) h = self.parseHeader(s);
    	self.parseAllBody(s, h, onstream);
    	self.parseFooter(s, h);
    	var elapsed = new Date() - t;
    	h.decompressionTime += elapsed;
    } 
    catch(e) 
    {
        console.log('error');
        return;
    }
    if (onload)
	{
    	onload(h, null);
	}
  },	

  load : function(data, url, onload, onstream, onerror) 
  {
    var xhr = new XMLHttpRequest();
    var self = this;
    var h = null;
    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4) {
        if (xhr.status == 200 || xhr.status == 0) {
          var s = xhr.responseText;

	      console.log('data');		
		  console.log(s);


          try {
            var t = new Date;
            if (!h) h = self.parseHeader(s);
            self.parseAllBody(s, h, onstream);
            self.parseFooter(s, h);
            var elapsed = new Date() - t;
            h.decompressionTime += elapsed;
          } catch(e) {
            onerror(xhr, e, h);
            return;
          }
          if (onload)
            onload(h, xhr);
        } else {
          if (onerror)
            onerror(xhr);
        }
      } else if (xhr.readyState == 3) {
        if (xhr.status == 200 || xhr.status == 0) {
          var s = xhr.responseText;
          if (s.length < 1024) return; // read in header
          try {
            var t = new Date;
            if (!h) h = self.parseHeader(s);
            self.parseBody(s, h, onstream);
            var elapsed = new Date() - t;
            h.decompressionTime += elapsed;
          } catch(e) {
            return;
          }
        }
      }
    };
    xhr.open("GET", url, true);
    xhr.overrideMimeType("text/plain; charset=x-user-defined");
    xhr.setRequestHeader("Content-Type", "text/plain");
    
    console.log('send');
    xhr.send(null);
  },

  parseHeader : function(s) {
    var h = {};
    h.decompressionTime = 0;
    h.id1 = Bin.byte(s,0);
    h.id2 = Bin.byte(s,1);
    h.compressionMethod = Bin.byte(s,2);
    if (h.id1 != 0x1f || h.id2 != 0x8b || h.compressionMethod != GZip.DEFLATE) {
      throw("Not a GZip file: " + h.id1 + ',' + h.id2 + ',' + h.compressionMethod);
    }
    h.flags = Bin.byte(s,3);
    h.mtime = Bin.UInt32LE(s, 4);
    h.extraFlags = Bin.byte(s, 8);
    h.operatingSystem = Bin.byte(s, 9);
    var offset = 10;
    if (h.flags & GZip.FEXTRA) {
      var xlen = Bin.UInt16LE(s, offset);
      offset += 2;
      h.extraField = s.substring(offset, offset+xlen);
      offset += xlen;
    }
    if (h.flags & GZip.FNAME) {
      h.filename = Bin.CString(s, offset);
      offset += h.filename.length + 1;
    }
    if (h.flags & GZip.FCOMMENT) {
      h.comment = Bin.CString(s, offset);
      offset += h.comment.length + 1;
    }
    h.computedHeaderCRC16 = Bin.CRC16(s, 0, offset, 0);
    if (h.flags & GZip.FHCRC) {
      h.headerCRC16 = Bin.UInt16LE(s, offset);
      if (h.computedHeaderCRC16 != null && h.headerCRC16 != h.computedHeaderCRC16)
        throw("Header CRC16 check failed");
      offset += 2;
    }
    h.offset = offset;
    h.data = [];
    h.outputSize = 0;
    h.inflater = new Inflater();
    h.inflater.start_inflate(h);
    return h;
  },
  
  parseBody : function(s, h, onstream) {
    h.inflater.continue_inflate(s, h, onstream);
    return h;
  },
  
  parseAllBody : function(s, h, onstream) {
    h.inflater.final_inflate(s, h, onstream);
    return h;
  },
  
  parseFooter : function(s, h) {
    h.CRC32 = Bin.UInt32LE(s, s.length-8);
    if (h.computedCRC32 && h.computedCRC32 != h.CRC32)
      throw("Data CRC32 check failed");
    h.inputSize = Bin.UInt32LE(s, s.length-4);
    if (h.data != null && h.inputSize != (h.outputSize % 0xffffffff))
      throw("Data length check failed");
    return h;
  }
};

/*   
=============================================================================== 
Crc32 is a JavaScript function for computing the CRC32 of a string 
............................................................................... 
 
Version: 1.2 - 2006/11 - http://noteslog.com/category/javascript/ 
 
------------------------------------------------------------------------------- 
Copyright (c) 2006 Andrea Ercolino 
http://www.opensource.org/licenses/mit-license.php 
=============================================================================== 
*/ 
 
(function() { 
    var table = "00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";
    var intTable = [];
    for (var i=0; i < table.length / 9; i++) {
      intTable.push(parseInt(table.substr( i*9, 8), 16));
    }
    /* Number */ 
    crc32 = function( /* String */ str, start, length, /* Number */ crc ) { 
        crc = crc ^ (-1);
        var end = Math.min(str.length, start + length);
        for( var i = start; i < end; i++ ) {
            var n = ( crc ^ str.charCodeAt( i ) ) & 0xFF; 
            crc = ( crc >>> 8 ) ^ intTable[n];
        } 
        return crc ^ (-1); 
    }; 
})();

/*
 * $Id: rawinflate.js,v 0.2 2009/03/01 18:32:24 dankogai Exp $
 *
 * original:
 * http://www.onicos.com/staff/iz/amuse/javascript/expert/inflate.txt
 */

Inflater = (function(){

/* Copyright (C) 1999 Masanao Izumo <iz@onicos.co.jp>
 * Version: 1.0.0.1
 * LastModified: Dec 25 1999
 */

/* Interface:
 * data = zip_inflate(src);
 */

/* constant parameters */
var zip_WSIZE = 32768;        // Sliding Window size
var zip_STORED_BLOCK = 0;
var zip_STATIC_TREES = 1;
var zip_DYN_TREES  = 2;

/* for inflate */
var zip_lbits = 9;         // bits in base literal/length lookup table
var zip_dbits = 6;         // bits in base distance lookup table
var zip_INBUFSIZ = 32768;    // Input buffer size
var zip_INBUF_EXTRA = 64;    // Extra buffer

/* variables (inflate) */
var zip_slide;
var zip_wp;            // current position in slide
var zip_fixed_tl = null;    // inflate static
var zip_fixed_td;        // inflate static
var zip_fixed_bl, fixed_bd;    // inflate static
var zip_bit_buf;        // bit buffer
var zip_bit_len;        // bits in bit buffer
var zip_method;
var zip_eof;
var zip_copy_leng;
var zip_copy_dist;
var zip_tl, zip_td;    // literal/length and distance decoder tables
var zip_bl, zip_bd;    // number of bits decoded by tl and td

var zip_inflate_data;
var zip_inflate_pos;


/* constant tables (inflate) */
var zip_MASK_BITS = new Array(
  0x0000,
  0x0001, 0x0003, 0x0007, 0x000f, 0x001f, 0x003f, 0x007f, 0x00ff,
  0x01ff, 0x03ff, 0x07ff, 0x0fff, 0x1fff, 0x3fff, 0x7fff, 0xffff);
// Tables for deflate from PKZIP's appnote.txt.
var zip_cplens = new Array( // Copy lengths for literal codes 257..285
  3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,
  35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0);
/* note: see note #13 above about the 258 in this list. */
var zip_cplext = new Array( // Extra bits for literal codes 257..285
  0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2,
  3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 99, 99); // 99==invalid
var zip_cpdist = new Array( // Copy offsets for distance codes 0..29
  1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,
  257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,
  8193, 12289, 16385, 24577);
var zip_cpdext = new Array( // Extra bits for distance codes
  0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6,
  7, 7, 8, 8, 9, 9, 10, 10, 11, 11,
  12, 12, 13, 13);
var zip_border = new Array(  // Order of the bit length code lengths
  16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15);
/* objects (inflate) */

var zip_HuftList = function() {
  this.next = null;
  this.list = null;
};

var zip_HuftNode = function() {
  this.e = 0; // number of extra bits or operation
  this.b = 0; // number of bits in this code or subcode

  // union
  this.n = 0; // literal, length base, or distance base
  this.t = null; // (zip_HuftNode) pointer to next level of table
};

var zip_HuftBuild = function(b,    // code lengths in bits (all assumed <= BMAX)
             n,    // number of codes (assumed <= N_MAX)
             s,    // number of simple-valued codes (0..s-1)
             d,    // list of base values for non-simple codes
             e,    // list of extra bits for non-simple codes
             mm    // maximum lookup bits
           ) {
  this.BMAX = 16;   // maximum bit length of any code
  this.N_MAX = 288; // maximum number of codes in any set
  this.status = 0;    // 0: success, 1: incomplete table, 2: bad input
  this.root = null;    // (zip_HuftList) starting table
  this.m = 0;        // maximum lookup bits, returns actual

/* Given a list of code lengths and a maximum table size, make a set of
   tables to decode that set of codes.    Return zero on success, one if
   the given code set is incomplete (the tables are still built in this
   case), two if the input is invalid (all zero length codes or an
   oversubscribed set of lengths), and three if not enough memory.
   The code with value 256 is special, and the tables are constructed
   so that no bits beyond that code are fetched when that code is
   decoded. */
  {
    var a;            // counter for codes of length k
    var c = new Array(this.BMAX+1);    // bit length count table
    var el;            // length of EOB code (value 256)
    var f;            // i repeats in table every f entries
    var g;            // maximum code length
    var h;            // table level
    var i;            // counter, current code
    var j;            // counter
    var k;            // number of bits in current code
    var lx = new Array(this.BMAX+1);    // stack of bits per table
    var p;            // pointer into c[], b[], or v[]
    var pidx;        // index of p
    var q;            // (zip_HuftNode) points to current table
    var r = new zip_HuftNode(); // table entry for structure assignment
    var u = new Array(this.BMAX); // zip_HuftNode[BMAX][]  table stack
    var v = new Array(this.N_MAX); // values in order of bit length
    var w;
    var x = new Array(this.BMAX+1);// bit offsets, then code stack
    var xp;            // pointer into x or c
    var y;            // number of dummy codes added
    var z;            // number of entries in current table
    var o;
    var tail;        // (zip_HuftList)

    tail = this.root = null;
    for(i = 0; i < c.length; i++)
      c[i] = 0;
    for(i = 0; i < lx.length; i++)
      lx[i] = 0;
    for(i = 0; i < u.length; i++)
      u[i] = null;
    for(i = 0; i < v.length; i++)
      v[i] = 0;
    for(i = 0; i < x.length; i++)
      x[i] = 0;

    // Generate counts for each bit length
    el = n > 256 ? b[256] : this.BMAX; // set length of EOB code, if any
    p = b; pidx = 0;
    i = n;
    do {
      c[p[pidx]]++;    // assume all entries <= BMAX
      pidx++;
    } while(--i > 0);
    if(c[0] == n) {    // null input--all zero length codes
      this.root = null;
      this.m = 0;
      this.status = 0;
      return;
    }

    // Find minimum and maximum length, bound *m by those
    for(j = 1; j <= this.BMAX; j++)
      if(c[j] != 0)
        break;
    k = j;            // minimum code length
    if(mm < j)
      mm = j;
    for(i = this.BMAX; i != 0; i--)
      if(c[i] != 0)
        break;
    g = i;            // maximum code length
    if(mm > i)
      mm = i;

    // Adjust last length count to fill out codes, if needed
    for(y = 1 << j; j < i; j++, y <<= 1)
      if((y -= c[j]) < 0) {
        this.status = 2;    // bad input: more codes than bits
        this.m = mm;
        return;
      }
    if((y -= c[i]) < 0) {
      this.status = 2;
      this.m = mm;
      return;
    }
    c[i] += y;

    // Generate starting offsets into the value table for each length
    x[1] = j = 0;
    p = c;
    pidx = 1;
    xp = 2;
    while(--i > 0)        // note that i == g from above
      x[xp++] = (j += p[pidx++]);

    // Make a table of values in order of bit lengths
    p = b; pidx = 0;
    i = 0;
    do {
      if((j = p[pidx++]) != 0)
        v[x[j]++] = i;
    } while(++i < n);
    n = x[g];            // set n to length of v

    // Generate the Huffman codes and for each, make the table entries
    x[0] = i = 0;        // first Huffman code is zero
    p = v; pidx = 0;        // grab values in bit order
    h = -1;            // no tables yet--level -1
    w = lx[0] = 0;        // no bits decoded yet
    q = null;            // ditto
    z = 0;            // ditto

    // go through the bit lengths (k already is bits in shortest code)
    for(; k <= g; k++) {
      a = c[k];
      while(a-- > 0) {
        // here i is the Huffman code of length k bits for value p[pidx]
        // make tables up to required level
        while(k > w + lx[1 + h]) {
          w += lx[1 + h]; // add bits already decoded
          h++;

          // compute minimum size table less than or equal to *m bits
          z = (z = g - w) > mm ? mm : z; // upper limit
          if((f = 1 << (j = k - w)) > a + 1) { // try a k-w bit table
            // too few codes for k-w bit table
            f -= a + 1;    // deduct codes from patterns left
            xp = k;
            while(++j < z) { // try smaller tables up to z bits
              if((f <<= 1) <= c[++xp])
                break;    // enough codes to use up j bits
              f -= c[xp];    // else deduct codes from patterns
            }
          }
          if(w + j > el && w < el)
            j = el - w;    // make EOB code end at table
          z = 1 << j;    // table entries for j-bit table
          lx[1 + h] = j; // set table size in stack

          // allocate and link in new table
          q = new Array(z);
          for(o = 0; o < z; o++) {
            q[o] = new zip_HuftNode();
          }

          if(tail == null)
            tail = this.root = new zip_HuftList();
          else
            tail = tail.next = new zip_HuftList();
          tail.next = null;
          tail.list = q;
          u[h] = q;    // table starts after link

          /* connect to last table, if there is one */
          if(h > 0) {
            x[h] = i;        // save pattern for backing up
            r.b = lx[h];    // bits to dump before this table
            r.e = 16 + j;    // bits in this table
            r.t = q;        // pointer to this table
            j = (i & ((1 << w) - 1)) >> (w - lx[h]);
            u[h-1][j].e = r.e;
            u[h-1][j].b = r.b;
            u[h-1][j].n = r.n;
            u[h-1][j].t = r.t;
          }
        }

        // set up table entry in r
        r.b = k - w;
        if(pidx >= n)
          r.e = 99;        // out of values--invalid code
        else if(p[pidx] < s) {
          r.e = (p[pidx] < 256 ? 16 : 15); // 256 is end-of-block code
          r.n = p[pidx++];    // simple code is just the value
        } else {
          r.e = e[p[pidx] - s];    // non-simple--look up in lists
          r.n = d[p[pidx++] - s];
        }

        // fill code-like entries with r //
        f = 1 << (k - w);
        for(j = i >> w; j < z; j += f) {
          q[j].e = r.e;
          q[j].b = r.b;
          q[j].n = r.n;
          q[j].t = r.t;
        }

        // backwards increment the k-bit code i
        for(j = 1 << (k - 1); (i & j) != 0; j >>= 1)
          i ^= j;
        i ^= j;

        // backup over finished tables
        while((i & ((1 << w) - 1)) != x[h]) {
          w -= lx[h];        // don't need to update q
          h--;
        }
      }
    }

    /* return actual size of base table */
    this.m = lx[1];

    /* Return true (1) if we were given an incomplete table */
    this.status = ((y != 0 && g != 1) ? 1 : 0);
  } /* end of constructor */
};


/* routines (inflate) */

var zip_GET_BYTE = function() {
  if(zip_inflate_data.length <= zip_inflate_pos)
    return -1;
  return zip_inflate_data.charCodeAt(zip_inflate_pos++) & 0xff;
};

var zip_NEEDBITS = function(n) {
  while(zip_bit_len < n) {
    zip_bit_buf |= zip_GET_BYTE() << zip_bit_len;
    zip_bit_len += 8;
  }
};

var zip_GETBITS = function(n) {
  return zip_bit_buf & zip_MASK_BITS[n];
};

var zip_DUMPBITS = function(n) {
  zip_bit_buf >>= n;
  zip_bit_len -= n;
};

var zip_inflate_codes = function(buff, off, size) {
  /* inflate (decompress) the codes in a deflated (compressed) block.
     Return an error code or zero if it all goes ok. */
  var e;        // table entry flag/number of extra bits
  var t;        // (zip_HuftNode) pointer to table entry
  var n;

  if(size == 0)
    return 0;

  // inflate the coded data
  n = 0;
  for(;;) {            // do until end of block
    zip_NEEDBITS(zip_bl);
    t = zip_tl.list[zip_GETBITS(zip_bl)];
    e = t.e;
    while(e > 16) {
      if(e == 99)
        return -1;
      zip_DUMPBITS(t.b);
      e -= 16;
      zip_NEEDBITS(e);
      t = t.t[zip_GETBITS(e)];
      e = t.e;
    }
    zip_DUMPBITS(t.b);

    if(e == 16) {        // then it's a literal
      zip_wp &= zip_WSIZE - 1;
      buff[off + n++] = zip_slide[zip_wp++] = t.n;
      if(n == size)
        return size;
      continue;
    }

    // exit if end of block
    if(e == 15)
      break;

    // it's an EOB or a length

    // get length of block to copy
    zip_NEEDBITS(e);
    zip_copy_leng = t.n + zip_GETBITS(e);
    zip_DUMPBITS(e);

    // decode distance of block to copy
    zip_NEEDBITS(zip_bd);
    t = zip_td.list[zip_GETBITS(zip_bd)];
    e = t.e;

    while(e > 16) {
      if(e == 99)
        return -1;
      zip_DUMPBITS(t.b);
      e -= 16;
      zip_NEEDBITS(e);
      t = t.t[zip_GETBITS(e)];
      e = t.e;
    }
    zip_DUMPBITS(t.b);
    zip_NEEDBITS(e);
    zip_copy_dist = zip_wp - t.n - zip_GETBITS(e);
    zip_DUMPBITS(e);

    // do the copy
    while(zip_copy_leng > 0 && n < size) {
      zip_copy_leng--;
      zip_copy_dist &= zip_WSIZE - 1;
      zip_wp &= zip_WSIZE - 1;
      buff[off + n++] = zip_slide[zip_wp++]
        = zip_slide[zip_copy_dist++];
    }

    if(n == size)
      return size;
  }

  zip_method = -1; // done
  return n;
};

var zip_inflate_stored = function(buff, off, size) {
  /* "decompress" an inflated type 0 (stored) block. */
  var n;

  // go to byte boundary
  n = zip_bit_len & 7;
  zip_DUMPBITS(n);

  // get the length and its complement
  zip_NEEDBITS(16);
  n = zip_GETBITS(16);
  zip_DUMPBITS(16);
  zip_NEEDBITS(16);
  if(n != ((~zip_bit_buf) & 0xffff))
    return -1;            // error in compressed data
  zip_DUMPBITS(16);

  // read and output the compressed data
  zip_copy_leng = n;

  n = 0;
  while(zip_copy_leng > 0 && n < size) {
    zip_copy_leng--;
    zip_wp &= zip_WSIZE - 1;
    zip_NEEDBITS(8);
    buff[off + n++] = zip_slide[zip_wp++] =
      zip_GETBITS(8);
    zip_DUMPBITS(8);
  }

  if(zip_copy_leng == 0)
    zip_method = -1; // done
  return n;
};

var zip_inflate_fixed = function(buff, off, size) {
  /* decompress an inflated type 1 (fixed Huffman codes) block.  We should
     either replace this with a custom decoder, or at least precompute the
     Huffman tables. */

  // if first time, set up tables for fixed blocks
  if(zip_fixed_tl == null) {
    var i;            // temporary variable
    var l = new Array(288);    // length list for huft_build
    var h;    // zip_HuftBuild

    // literal table
    for(i = 0; i < 144; i++)
      l[i] = 8;
    for(; i < 256; i++)
      l[i] = 9;
    for(; i < 280; i++)
      l[i] = 7;
    for(; i < 288; i++)    // make a complete, but wrong code set
      l[i] = 8;
    zip_fixed_bl = 7;

    h = new zip_HuftBuild(l, 288, 257, zip_cplens, zip_cplext,
                zip_fixed_bl);
    if(h.status != 0) {
      alert("HufBuild error: "+h.status);
      return -1;
    }
    zip_fixed_tl = h.root;
    zip_fixed_bl = h.m;

    // distance table
    for(i = 0; i < 30; i++)    // make an incomplete code set
      l[i] = 5;
    zip_fixed_bd = 5;

    h = new zip_HuftBuild(l, 30, 0, zip_cpdist, zip_cpdext, zip_fixed_bd);
    if(h.status > 1) {
      zip_fixed_tl = null;
      throw("HufBuild error: "+h.status);
      return -1;
    }
    zip_fixed_td = h.root;
    zip_fixed_bd = h.m;
  }

  zip_tl = zip_fixed_tl;
  zip_td = zip_fixed_td;
  zip_bl = zip_fixed_bl;
  zip_bd = zip_fixed_bd;
  return zip_inflate_codes(buff, off, size);
};

var zip_inflate_dynamic = function(buff, off, size) {
  // decompress an inflated type 2 (dynamic Huffman codes) block.
  var i;        // temporary variables
  var j;
  var l;        // last length
  var n;        // number of lengths to get
  var t;        // (zip_HuftNode) literal/length code table
  var nb;        // number of bit length codes
  var nl;        // number of literal/length codes
  var nd;        // number of distance codes
  var ll = new Array(286+30); // literal/length and distance code lengths
  var h;        // (zip_HuftBuild)

  for(i = 0; i < ll.length; i++)
    ll[i] = 0;

  // read in table lengths
  zip_NEEDBITS(5);
  nl = 257 + zip_GETBITS(5);    // number of literal/length codes
  zip_DUMPBITS(5);
  zip_NEEDBITS(5);
  nd = 1 + zip_GETBITS(5);    // number of distance codes
  zip_DUMPBITS(5);
  zip_NEEDBITS(4);
  nb = 4 + zip_GETBITS(4);    // number of bit length codes
  zip_DUMPBITS(4);
  if(nl > 286 || nd > 30)
    return -1;        // bad lengths

  // read in bit-length-code lengths
  for(j = 0; j < nb; j++)
  {
    zip_NEEDBITS(3);
    ll[zip_border[j]] = zip_GETBITS(3);
    zip_DUMPBITS(3);
  }
  for(; j < 19; j++)
    ll[zip_border[j]] = 0;

  // build decoding table for trees--single level, 7 bit lookup
  zip_bl = 7;
  h = new zip_HuftBuild(ll, 19, 19, null, null, zip_bl);
  if(h.status != 0)
    return -1;    // incomplete code set

  zip_tl = h.root;
  zip_bl = h.m;

  // read in literal and distance code lengths
  n = nl + nd;
  i = l = 0;
  while(i < n) {
    zip_NEEDBITS(zip_bl);
    t = zip_tl.list[zip_GETBITS(zip_bl)];
    j = t.b;
    zip_DUMPBITS(j);
    j = t.n;
    if(j < 16)        // length of code in bits (0..15)
      ll[i++] = l = j;    // save last length in l
    else if(j == 16) {    // repeat last length 3 to 6 times
      zip_NEEDBITS(2);
      j = 3 + zip_GETBITS(2);
      zip_DUMPBITS(2);
      if(i + j > n)
        return -1;
      while(j-- > 0)
        ll[i++] = l;
    } else if(j == 17) {    // 3 to 10 zero length codes
      zip_NEEDBITS(3);
      j = 3 + zip_GETBITS(3);
      zip_DUMPBITS(3);
      if(i + j > n)
        return -1;
      while(j-- > 0)
        ll[i++] = 0;
      l = 0;
    } else {        // j == 18: 11 to 138 zero length codes
      zip_NEEDBITS(7);
      j = 11 + zip_GETBITS(7);
      zip_DUMPBITS(7);
      if(i + j > n)
        return -1;
      while(j-- > 0)
        ll[i++] = 0;
      l = 0;
    }
  }

  // build the decoding tables for literal/length and distance codes
  zip_bl = zip_lbits;
  h = new zip_HuftBuild(ll, nl, 257, zip_cplens, zip_cplext, zip_bl);
  if(zip_bl == 0)    // no literals or lengths
    h.status = 1;
  if(h.status != 0) {
    if(h.status == 1)
      ;// **incomplete literal tree**
    return -1;        // incomplete code set
  }
  zip_tl = h.root;
  zip_bl = h.m;

  for(i = 0; i < nd; i++)
    ll[i] = ll[i + nl];
  zip_bd = zip_dbits;
  h = new zip_HuftBuild(ll, nd, 0, zip_cpdist, zip_cpdext, zip_bd);
  zip_td = h.root;
  zip_bd = h.m;

  if(zip_bd == 0 && nl > 257) {   // lengths but no distances
    // **incomplete distance tree**
    return -1;
  }

  if(h.status == 1) {
    ;// **incomplete distance tree**
  }
  if(h.status != 0)
    return -1;

  // decompress until an end-of-block code
  return zip_inflate_codes(buff, off, size);
};

var zip_inflate_start = function() {
  var i;

  if(zip_slide == null)
    zip_slide = new Array(2 * zip_WSIZE);
  zip_wp = 0;
  zip_bit_buf = 0;
  zip_bit_len = 0;
  zip_method = -1;
  zip_eof = false;
  zip_copy_leng = zip_copy_dist = 0;
  zip_tl = null;
};

var zip_inflate_internal = function(buff, off, size) {
  // decompress an inflated entry
  var n, i;

  n = 0;
  while(n < size) {
    if(zip_eof && zip_method == -1)
      return n;

    if(zip_copy_leng > 0) {
      if(zip_method != zip_STORED_BLOCK) {
        // STATIC_TREES or DYN_TREES
        while(zip_copy_leng > 0 && n < size) {
          zip_copy_leng--;
          zip_copy_dist &= zip_WSIZE - 1;
          zip_wp &= zip_WSIZE - 1;
          buff[off + n++] = zip_slide[zip_wp++] =
            zip_slide[zip_copy_dist++];
        }
      } else {
        while(zip_copy_leng > 0 && n < size) {
          zip_copy_leng--;
          zip_wp &= zip_WSIZE - 1;
          zip_NEEDBITS(8);
          buff[off + n++] = zip_slide[zip_wp++] = zip_GETBITS(8);
          zip_DUMPBITS(8);
        }
        if(zip_copy_leng == 0)
          zip_method = -1; // done
      }
      if(n == size)
        return n;
    }

    if(zip_method == -1) {
      if(zip_eof)
        break;

      // read in last block bit
      zip_NEEDBITS(1);
      if(zip_GETBITS(1) != 0)
        zip_eof = true;
      zip_DUMPBITS(1);

      // read in block type
      zip_NEEDBITS(2);
      zip_method = zip_GETBITS(2);
      zip_DUMPBITS(2);
      zip_tl = null;
      zip_copy_leng = 0;
    }

    switch(zip_method) {
      case 0: // zip_STORED_BLOCK
      i = zip_inflate_stored(buff, off + n, size - n);
      break;

      case 1: // zip_STATIC_TREES
      if(zip_tl != null)
        i = zip_inflate_codes(buff, off + n, size - n);
      else
        i = zip_inflate_fixed(buff, off + n, size - n);
      break;

      case 2: // zip_DYN_TREES
      if(zip_tl != null)
        i = zip_inflate_codes(buff, off + n, size - n);
      else
        i = zip_inflate_dynamic(buff, off + n, size - n);
      break;

      default: // error
      i = -1;
      break;
    }

    if(i == -1) {
      if(zip_eof)
        return 0;
      return -1;
    }
    n += i;
  }
  return n;
};

var final_data = false;
var start_inflate = function(h) {
  final_data = false;
  zip_inflate_start();
  zip_inflate_pos = h.offset;
  h.computedCRC32 = 0;
};
var continue_inflate = function(str, h, onstream) {
  var i, j;
  var BUFSZ = 4096;
  zip_inflate_data = str;
  if (!final_data && str.length <= zip_inflate_pos+BUFSZ+64)
    return h;

  var buff = new Array(BUFSZ);
  while((i = zip_inflate_internal(buff, 0, buff.length)) > 0) {
    var cbuf = new Array(i);
    for(j = 0; j < i; j++){
      cbuf[j] = String.fromCharCode(buff[j]);
    }
    var s = cbuf.join("");
    h.data.push(s);
    h.outputSize += s.length;
    h.offset = zip_inflate_pos;
    h.computedCRC32 = Bin.CRC32(s, 0, s.length, h.computedCRC32);
    if (!final_data && str.length <= zip_inflate_pos+BUFSZ+64)
      break;
  }
  zip_inflate_data = null; // G.C.
  if (onstream) onstream(h);
  return h;
};
var final_inflate = function(str, h, onstream) {
  final_data = true;
  continue_inflate(str, h, onstream);
};

this.inflate = function(str,h,onstream) {
  start_inflate(h);
  return final_inflate(str,h,onstream);
};
this.start_inflate = start_inflate;
this.continue_inflate = continue_inflate;
this.final_inflate = final_inflate;
});
/*  Prototype JavaScript framework, version 1.7.2
 *  (c) 2005-2010 Sam Stephenson
 *
 *  Prototype is freely distributable under the terms of an MIT-style license.
 *  For details, see the Prototype web site: http://www.prototypejs.org/
 *
 *--------------------------------------------------------------------------*/

var Prototype = {

  Version: '1.7.2',

  Browser: (function(){
    var ua = navigator.userAgent;
    var isOpera = Object.prototype.toString.call(window.opera) == '[object Opera]';
    return {
      IE:             !!window.attachEvent && !isOpera,
      Opera:          isOpera,
      WebKit:         ua.indexOf('AppleWebKit/') > -1,
      Gecko:          ua.indexOf('Gecko') > -1 && ua.indexOf('KHTML') === -1,
      MobileSafari:   /Apple.*Mobile/.test(ua)
    }
  })(),

  BrowserFeatures: {
    XPath: !!document.evaluate,

    SelectorsAPI: !!document.querySelector,

    ElementExtensions: (function() {
      var constructor = window.Element || window.HTMLElement;
      return !!(constructor && constructor.prototype);
    })(),
    SpecificElementExtensions: (function() {
      if (typeof window.HTMLDivElement !== 'undefined')
        return true;

      var div = document.createElement('div'),
          form = document.createElement('form'),
          isSupported = false;

      if (div['__proto__'] && (div['__proto__'] !== form['__proto__'])) {
        isSupported = true;
      }

      div = form = null;

      return isSupported;
    })()
  },

  ScriptFragment: '<script[^>]*>([\\S\\s]*?)<\/script\\s*>',
  JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,

  emptyFunction: function() { },

  K: function(x) { return x }
};

if (Prototype.Browser.MobileSafari)
  Prototype.BrowserFeatures.SpecificElementExtensions = false;
/* Based on Alex Arnell's inheritance implementation. */

var Class = (function() {

  var IS_DONTENUM_BUGGY = (function(){
    for (var p in { toString: 1 }) {
      if (p === 'toString') return false;
    }
    return true;
  })();

  function subclass() {};
  function create() {
    var parent = null, properties = $A(arguments);
    if (Object.isFunction(properties[0]))
      parent = properties.shift();

    function klass() {
      this.initialize.apply(this, arguments);
    }

    Object.extend(klass, Class.Methods);
    klass.superclass = parent;
    klass.subclasses = [];

    if (parent) {
      subclass.prototype = parent.prototype;
      klass.prototype = new subclass;
      parent.subclasses.push(klass);
    }

    for (var i = 0, length = properties.length; i < length; i++)
      klass.addMethods(properties[i]);

    if (!klass.prototype.initialize)
      klass.prototype.initialize = Prototype.emptyFunction;

    klass.prototype.constructor = klass;
    return klass;
  }

  function addMethods(source) {
    var ancestor   = this.superclass && this.superclass.prototype,
        properties = Object.keys(source);

    if (IS_DONTENUM_BUGGY) {
      if (source.toString != Object.prototype.toString)
        properties.push("toString");
      if (source.valueOf != Object.prototype.valueOf)
        properties.push("valueOf");
    }

    for (var i = 0, length = properties.length; i < length; i++) {
      var property = properties[i], value = source[property];
      if (ancestor && Object.isFunction(value) &&
          value.argumentNames()[0] == "$super") {
        var method = value;
        value = (function(m) {
          return function() { return ancestor[m].apply(this, arguments); };
        })(property).wrap(method);

        value.valueOf = (function(method) {
          return function() { return method.valueOf.call(method); };
        })(method);

        value.toString = (function(method) {
          return function() { return method.toString.call(method); };
        })(method);
      }
      this.prototype[property] = value;
    }

    return this;
  }

  return {
    create: create,
    Methods: {
      addMethods: addMethods
    }
  };
})();
(function() {

  var _toString = Object.prototype.toString,
      _hasOwnProperty = Object.prototype.hasOwnProperty,
      NULL_TYPE = 'Null',
      UNDEFINED_TYPE = 'Undefined',
      BOOLEAN_TYPE = 'Boolean',
      NUMBER_TYPE = 'Number',
      STRING_TYPE = 'String',
      OBJECT_TYPE = 'Object',
      FUNCTION_CLASS = '[object Function]',
      BOOLEAN_CLASS = '[object Boolean]',
      NUMBER_CLASS = '[object Number]',
      STRING_CLASS = '[object String]',
      ARRAY_CLASS = '[object Array]',
      DATE_CLASS = '[object Date]',
      NATIVE_JSON_STRINGIFY_SUPPORT = window.JSON &&
        typeof JSON.stringify === 'function' &&
        JSON.stringify(0) === '0' &&
        typeof JSON.stringify(Prototype.K) === 'undefined';



  var DONT_ENUMS = ['toString', 'toLocaleString', 'valueOf',
   'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'];

  var IS_DONTENUM_BUGGY = (function(){
    for (var p in { toString: 1 }) {
      if (p === 'toString') return false;
    }
    return true;
  })();

  function Type(o) {
    switch(o) {
      case null: return NULL_TYPE;
      case (void 0): return UNDEFINED_TYPE;
    }
    var type = typeof o;
    switch(type) {
      case 'boolean': return BOOLEAN_TYPE;
      case 'number':  return NUMBER_TYPE;
      case 'string':  return STRING_TYPE;
    }
    return OBJECT_TYPE;
  }

  function extend(destination, source) {
    for (var property in source)
      destination[property] = source[property];
    return destination;
  }

  function inspect(object) {
    try {
      if (isUndefined(object)) return 'undefined';
      if (object === null) return 'null';
      return object.inspect ? object.inspect() : String(object);
    } catch (e) {
      if (e instanceof RangeError) return '...';
      throw e;
    }
  }

  function toJSON(value) {
    return Str('', { '': value }, []);
  }

  function Str(key, holder, stack) {
    var value = holder[key];
    if (Type(value) === OBJECT_TYPE && typeof value.toJSON === 'function') {
      value = value.toJSON(key);
    }

    var _class = _toString.call(value);

    switch (_class) {
      case NUMBER_CLASS:
      case BOOLEAN_CLASS:
      case STRING_CLASS:
        value = value.valueOf();
    }

    switch (value) {
      case null: return 'null';
      case true: return 'true';
      case false: return 'false';
    }

    var type = typeof value;
    switch (type) {
      case 'string':
        return value.inspect(true);
      case 'number':
        return isFinite(value) ? String(value) : 'null';
      case 'object':

        for (var i = 0, length = stack.length; i < length; i++) {
          if (stack[i] === value) {
            throw new TypeError("Cyclic reference to '" + value + "' in object");
          }
        }
        stack.push(value);

        var partial = [];
        if (_class === ARRAY_CLASS) {
          for (var i = 0, length = value.length; i < length; i++) {
            var str = Str(i, value, stack);
            partial.push(typeof str === 'undefined' ? 'null' : str);
          }
          partial = '[' + partial.join(',') + ']';
        } else {
          var keys = Object.keys(value);
          for (var i = 0, length = keys.length; i < length; i++) {
            var key = keys[i], str = Str(key, value, stack);
            if (typeof str !== "undefined") {
               partial.push(key.inspect(true)+ ':' + str);
             }
          }
          partial = '{' + partial.join(',') + '}';
        }
        stack.pop();
        return partial;
    }
  }

  function stringify(object) {
    return JSON.stringify(object);
  }

  function toQueryString(object) {
    return $H(object).toQueryString();
  }

  function toHTML(object) {
    return object && object.toHTML ? object.toHTML() : String.interpret(object);
  }

  function keys(object) {
    if (Type(object) !== OBJECT_TYPE) { throw new TypeError(); }
    var results = [];
    for (var property in object) {
      if (_hasOwnProperty.call(object, property))
        results.push(property);
    }

    if (IS_DONTENUM_BUGGY) {
      for (var i = 0; property = DONT_ENUMS[i]; i++) {
        if (_hasOwnProperty.call(object, property))
          results.push(property);
      }
    }

    return results;
  }

  function values(object) {
    var results = [];
    for (var property in object)
      results.push(object[property]);
    return results;
  }

  function clone(object) {
    return extend({ }, object);
  }

  function isElement(object) {
    return !!(object && object.nodeType == 1);
  }

  function isArray(object) {
    return _toString.call(object) === ARRAY_CLASS;
  }

  var hasNativeIsArray = (typeof Array.isArray == 'function')
    && Array.isArray([]) && !Array.isArray({});

  if (hasNativeIsArray) {
    isArray = Array.isArray;
  }

  function isHash(object) {
    return object instanceof Hash;
  }

  function isFunction(object) {
    return _toString.call(object) === FUNCTION_CLASS;
  }

  function isString(object) {
    return _toString.call(object) === STRING_CLASS;
  }

  function isNumber(object) {
    return _toString.call(object) === NUMBER_CLASS;
  }

  function isDate(object) {
    return _toString.call(object) === DATE_CLASS;
  }

  function isUndefined(object) {
    return typeof object === "undefined";
  }

  extend(Object, {
    extend:        extend,
    inspect:       inspect,
    toJSON:        NATIVE_JSON_STRINGIFY_SUPPORT ? stringify : toJSON,
    toQueryString: toQueryString,
    toHTML:        toHTML,
    keys:          Object.keys || keys,
    values:        values,
    clone:         clone,
    isElement:     isElement,
    isArray:       isArray,
    isHash:        isHash,
    isFunction:    isFunction,
    isString:      isString,
    isNumber:      isNumber,
    isDate:        isDate,
    isUndefined:   isUndefined
  });
})();
Object.extend(Function.prototype, (function() {
  var slice = Array.prototype.slice;

  function update(array, args) {
    var arrayLength = array.length, length = args.length;
    while (length--) array[arrayLength + length] = args[length];
    return array;
  }

  function merge(array, args) {
    array = slice.call(array, 0);
    return update(array, args);
  }

  function argumentNames() {
    var names = this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1]
      .replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, '')
      .replace(/\s+/g, '').split(',');
    return names.length == 1 && !names[0] ? [] : names;
  }


  function bind(context) {
    if (arguments.length < 2 && Object.isUndefined(arguments[0]))
      return this;

    if (!Object.isFunction(this))
      throw new TypeError("The object is not callable.");

    var nop = function() {};
    var __method = this, args = slice.call(arguments, 1);

    var bound = function() {
      var a = merge(args, arguments);
      var c = this instanceof bound ? this : context;
      return __method.apply(c, a);
    };

    nop.prototype   = this.prototype;
    bound.prototype = new nop();

    return bound;
  }

  function bindAsEventListener(context) {
    var __method = this, args = slice.call(arguments, 1);
    return function(event) {
      var a = update([event || window.event], args);
      return __method.apply(context, a);
    }
  }

  function curry() {
    if (!arguments.length) return this;
    var __method = this, args = slice.call(arguments, 0);
    return function() {
      var a = merge(args, arguments);
      return __method.apply(this, a);
    }
  }

  function delay(timeout) {
    var __method = this, args = slice.call(arguments, 1);
    timeout = timeout * 1000;
    return window.setTimeout(function() {
      return __method.apply(__method, args);
    }, timeout);
  }

  function defer() {
    var args = update([0.01], arguments);
    return this.delay.apply(this, args);
  }

  function wrap(wrapper) {
    var __method = this;
    return function() {
      var a = update([__method.bind(this)], arguments);
      return wrapper.apply(this, a);
    }
  }

  function methodize() {
    if (this._methodized) return this._methodized;
    var __method = this;
    return this._methodized = function() {
      var a = update([this], arguments);
      return __method.apply(null, a);
    };
  }

  var extensions = {
    argumentNames:       argumentNames,
    bindAsEventListener: bindAsEventListener,
    curry:               curry,
    delay:               delay,
    defer:               defer,
    wrap:                wrap,
    methodize:           methodize
  };

  if (!Function.prototype.bind)
    extensions.bind = bind;

  return extensions;
})());



(function(proto) {


  function toISOString() {
    return this.getUTCFullYear() + '-' +
      (this.getUTCMonth() + 1).toPaddedString(2) + '-' +
      this.getUTCDate().toPaddedString(2) + 'T' +
      this.getUTCHours().toPaddedString(2) + ':' +
      this.getUTCMinutes().toPaddedString(2) + ':' +
      this.getUTCSeconds().toPaddedString(2) + 'Z';
  }


  function toJSON() {
    return this.toISOString();
  }

  if (!proto.toISOString) proto.toISOString = toISOString;
  if (!proto.toJSON) proto.toJSON = toJSON;

})(Date.prototype);


RegExp.prototype.match = RegExp.prototype.test;

RegExp.escape = function(str) {
  return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
};
var PeriodicalExecuter = Class.create({
  initialize: function(callback, frequency) {
    this.callback = callback;
    this.frequency = frequency;
    this.currentlyExecuting = false;

    this.registerCallback();
  },

  registerCallback: function() {
    this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
  },

  execute: function() {
    this.callback(this);
  },

  stop: function() {
    if (!this.timer) return;
    clearInterval(this.timer);
    this.timer = null;
  },

  onTimerEvent: function() {
    if (!this.currentlyExecuting) {
      try {
        this.currentlyExecuting = true;
        this.execute();
        this.currentlyExecuting = false;
      } catch(e) {
        this.currentlyExecuting = false;
        throw e;
      }
    }
  }
});
Object.extend(String, {
  interpret: function(value) {
    return value == null ? '' : String(value);
  },
  specialChar: {
    '\b': '\\b',
    '\t': '\\t',
    '\n': '\\n',
    '\f': '\\f',
    '\r': '\\r',
    '\\': '\\\\'
  }
});

Object.extend(String.prototype, (function() {
  var NATIVE_JSON_PARSE_SUPPORT = window.JSON &&
    typeof JSON.parse === 'function' &&
    JSON.parse('{"test": true}').test;

  function prepareReplacement(replacement) {
    if (Object.isFunction(replacement)) return replacement;
    var template = new Template(replacement);
    return function(match) { return template.evaluate(match) };
  }

  function isNonEmptyRegExp(regexp) {
    return regexp.source && regexp.source !== '(?:)';
  }


  function gsub(pattern, replacement) {
    var result = '', source = this, match;
    replacement = prepareReplacement(replacement);

    if (Object.isString(pattern))
      pattern = RegExp.escape(pattern);

    if (!(pattern.length || isNonEmptyRegExp(pattern))) {
      replacement = replacement('');
      return replacement + source.split('').join(replacement) + replacement;
    }

    while (source.length > 0) {
      match = source.match(pattern)
      if (match && match[0].length > 0) {
        result += source.slice(0, match.index);
        result += String.interpret(replacement(match));
        source  = source.slice(match.index + match[0].length);
      } else {
        result += source, source = '';
      }
    }
    return result;
  }

  function sub(pattern, replacement, count) {
    replacement = prepareReplacement(replacement);
    count = Object.isUndefined(count) ? 1 : count;

    return this.gsub(pattern, function(match) {
      if (--count < 0) return match[0];
      return replacement(match);
    });
  }

  function scan(pattern, iterator) {
    this.gsub(pattern, iterator);
    return String(this);
  }

  function truncate(length, truncation) {
    length = length || 30;
    truncation = Object.isUndefined(truncation) ? '...' : truncation;
    return this.length > length ?
      this.slice(0, length - truncation.length) + truncation : String(this);
  }

  function strip() {
    return this.replace(/^\s+/, '').replace(/\s+$/, '');
  }

  function stripTags() {
    return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, '');
  }

  function stripScripts() {
    return this.replace(new RegExp(Prototype.ScriptFragment, 'img'), '');
  }

  function extractScripts() {
    var matchAll = new RegExp(Prototype.ScriptFragment, 'img'),
        matchOne = new RegExp(Prototype.ScriptFragment, 'im');
    return (this.match(matchAll) || []).map(function(scriptTag) {
      return (scriptTag.match(matchOne) || ['', ''])[1];
    });
  }

  function evalScripts() {
    return this.extractScripts().map(function(script) { return eval(script); });
  }

  function escapeHTML() {
    return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function unescapeHTML() {
    return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');
  }


  function toQueryParams(separator) {
    var match = this.strip().match(/([^?#]*)(#.*)?$/);
    if (!match) return { };

    return match[1].split(separator || '&').inject({ }, function(hash, pair) {
      if ((pair = pair.split('='))[0]) {
        var key = decodeURIComponent(pair.shift()),
            value = pair.length > 1 ? pair.join('=') : pair[0];

        if (value != undefined) {
          value = value.gsub('+', ' ');
          value = decodeURIComponent(value);
        }

        if (key in hash) {
          if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
          hash[key].push(value);
        }
        else hash[key] = value;
      }
      return hash;
    });
  }

  function toArray() {
    return this.split('');
  }

  function succ() {
    return this.slice(0, this.length - 1) +
      String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
  }

  function times(count) {
    return count < 1 ? '' : new Array(count + 1).join(this);
  }

  function camelize() {
    return this.replace(/-+(.)?/g, function(match, chr) {
      return chr ? chr.toUpperCase() : '';
    });
  }

  function capitalize() {
    return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
  }

  function underscore() {
    return this.replace(/::/g, '/')
               .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
               .replace(/([a-z\d])([A-Z])/g, '$1_$2')
               .replace(/-/g, '_')
               .toLowerCase();
  }

  function dasherize() {
    return this.replace(/_/g, '-');
  }

  function inspect(useDoubleQuotes) {
    var escapedString = this.replace(/[\x00-\x1f\\]/g, function(character) {
      if (character in String.specialChar) {
        return String.specialChar[character];
      }
      return '\\u00' + character.charCodeAt().toPaddedString(2, 16);
    });
    if (useDoubleQuotes) return '"' + escapedString.replace(/"/g, '\\"') + '"';
    return "'" + escapedString.replace(/'/g, '\\\'') + "'";
  }

  function unfilterJSON(filter) {
    return this.replace(filter || Prototype.JSONFilter, '$1');
  }

  function isJSON() {
    var str = this;
    if (str.blank()) return false;
    str = str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@');
    str = str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']');
    str = str.replace(/(?:^|:|,)(?:\s*\[)+/g, '');
    return (/^[\],:{}\s]*$/).test(str);
  }

  function evalJSON(sanitize) {
    var json = this.unfilterJSON(),
        cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
    if (cx.test(json)) {
      json = json.replace(cx, function (a) {
        return '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
      });
    }
    try {
      if (!sanitize || json.isJSON()) return eval('(' + json + ')');
    } catch (e) { }
    throw new SyntaxError('Badly formed JSON string: ' + this.inspect());
  }

  function parseJSON() {
    var json = this.unfilterJSON();
    return JSON.parse(json);
  }

  function include(pattern) {
    return this.indexOf(pattern) > -1;
  }

  function startsWith(pattern, position) {
    position = Object.isNumber(position) ? position : 0;
    return this.lastIndexOf(pattern, position) === position;
  }

  function endsWith(pattern, position) {
    pattern = String(pattern);
    position = Object.isNumber(position) ? position : this.length;
    if (position < 0) position = 0;
    if (position > this.length) position = this.length;
    var d = position - pattern.length;
    return d >= 0 && this.indexOf(pattern, d) === d;
  }

  function empty() {
    return this == '';
  }

  function blank() {
    return /^\s*$/.test(this);
  }

  function interpolate(object, pattern) {
    return new Template(this, pattern).evaluate(object);
  }

  return {
    gsub:           gsub,
    sub:            sub,
    scan:           scan,
    truncate:       truncate,
    strip:          String.prototype.trim || strip,
    stripTags:      stripTags,
    stripScripts:   stripScripts,
    extractScripts: extractScripts,
    evalScripts:    evalScripts,
    escapeHTML:     escapeHTML,
    unescapeHTML:   unescapeHTML,
    toQueryParams:  toQueryParams,
    parseQuery:     toQueryParams,
    toArray:        toArray,
    succ:           succ,
    times:          times,
    camelize:       camelize,
    capitalize:     capitalize,
    underscore:     underscore,
    dasherize:      dasherize,
    inspect:        inspect,
    unfilterJSON:   unfilterJSON,
    isJSON:         isJSON,
    evalJSON:       NATIVE_JSON_PARSE_SUPPORT ? parseJSON : evalJSON,
    include:        include,
    startsWith:     String.prototype.startsWith || startsWith,
    endsWith:       String.prototype.endsWith || endsWith,
    empty:          empty,
    blank:          blank,
    interpolate:    interpolate
  };
})());

var Template = Class.create({
  initialize: function(template, pattern) {
    this.template = template.toString();
    this.pattern = pattern || Template.Pattern;
  },

  evaluate: function(object) {
    if (object && Object.isFunction(object.toTemplateReplacements))
      object = object.toTemplateReplacements();

    return this.template.gsub(this.pattern, function(match) {
      if (object == null) return (match[1] + '');

      var before = match[1] || '';
      if (before == '\\') return match[2];

      var ctx = object, expr = match[3],
          pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;

      match = pattern.exec(expr);
      if (match == null) return before;

      while (match != null) {
        var comp = match[1].startsWith('[') ? match[2].replace(/\\\\]/g, ']') : match[1];
        ctx = ctx[comp];
        if (null == ctx || '' == match[3]) break;
        expr = expr.substring('[' == match[3] ? match[1].length : match[0].length);
        match = pattern.exec(expr);
      }

      return before + String.interpret(ctx);
    });
  }
});
Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;

var $break = { };

var Enumerable = (function() {
  function each(iterator, context) {
    try {
      this._each(iterator, context);
    } catch (e) {
      if (e != $break) throw e;
    }
    return this;
  }

  function eachSlice(number, iterator, context) {
    var index = -number, slices = [], array = this.toArray();
    if (number < 1) return array;
    while ((index += number) < array.length)
      slices.push(array.slice(index, index+number));
    return slices.collect(iterator, context);
  }

  function all(iterator, context) {
    iterator = iterator || Prototype.K;
    var result = true;
    this.each(function(value, index) {
      result = result && !!iterator.call(context, value, index, this);
      if (!result) throw $break;
    }, this);
    return result;
  }

  function any(iterator, context) {
    iterator = iterator || Prototype.K;
    var result = false;
    this.each(function(value, index) {
      if (result = !!iterator.call(context, value, index, this))
        throw $break;
    }, this);
    return result;
  }

  function collect(iterator, context) {
    iterator = iterator || Prototype.K;
    var results = [];
    this.each(function(value, index) {
      results.push(iterator.call(context, value, index, this));
    }, this);
    return results;
  }

  function detect(iterator, context) {
    var result;
    this.each(function(value, index) {
      if (iterator.call(context, value, index, this)) {
        result = value;
        throw $break;
      }
    }, this);
    return result;
  }

  function findAll(iterator, context) {
    var results = [];
    this.each(function(value, index) {
      if (iterator.call(context, value, index, this))
        results.push(value);
    }, this);
    return results;
  }

  function grep(filter, iterator, context) {
    iterator = iterator || Prototype.K;
    var results = [];

    if (Object.isString(filter))
      filter = new RegExp(RegExp.escape(filter));

    this.each(function(value, index) {
      if (filter.match(value))
        results.push(iterator.call(context, value, index, this));
    }, this);
    return results;
  }

  function include(object) {
    if (Object.isFunction(this.indexOf) && this.indexOf(object) != -1)
      return true;

    var found = false;
    this.each(function(value) {
      if (value == object) {
        found = true;
        throw $break;
      }
    });
    return found;
  }

  function inGroupsOf(number, fillWith) {
    fillWith = Object.isUndefined(fillWith) ? null : fillWith;
    return this.eachSlice(number, function(slice) {
      while(slice.length < number) slice.push(fillWith);
      return slice;
    });
  }

  function inject(memo, iterator, context) {
    this.each(function(value, index) {
      memo = iterator.call(context, memo, value, index, this);
    }, this);
    return memo;
  }

  function invoke(method) {
    var args = $A(arguments).slice(1);
    return this.map(function(value) {
      return value[method].apply(value, args);
    });
  }

  function max(iterator, context) {
    iterator = iterator || Prototype.K;
    var result;
    this.each(function(value, index) {
      value = iterator.call(context, value, index, this);
      if (result == null || value >= result)
        result = value;
    }, this);
    return result;
  }

  function min(iterator, context) {
    iterator = iterator || Prototype.K;
    var result;
    this.each(function(value, index) {
      value = iterator.call(context, value, index, this);
      if (result == null || value < result)
        result = value;
    }, this);
    return result;
  }

  function partition(iterator, context) {
    iterator = iterator || Prototype.K;
    var trues = [], falses = [];
    this.each(function(value, index) {
      (iterator.call(context, value, index, this) ?
        trues : falses).push(value);
    }, this);
    return [trues, falses];
  }

  function pluck(property) {
    var results = [];
    this.each(function(value) {
      results.push(value[property]);
    });
    return results;
  }

  function reject(iterator, context) {
    var results = [];
    this.each(function(value, index) {
      if (!iterator.call(context, value, index, this))
        results.push(value);
    }, this);
    return results;
  }

  function sortBy(iterator, context) {
    return this.map(function(value, index) {
      return {
        value: value,
        criteria: iterator.call(context, value, index, this)
      };
    }, this).sort(function(left, right) {
      var a = left.criteria, b = right.criteria;
      return a < b ? -1 : a > b ? 1 : 0;
    }).pluck('value');
  }

  function toArray() {
    return this.map();
  }

  function zip() {
    var iterator = Prototype.K, args = $A(arguments);
    if (Object.isFunction(args.last()))
      iterator = args.pop();

    var collections = [this].concat(args).map($A);
    return this.map(function(value, index) {
      return iterator(collections.pluck(index));
    });
  }

  function size() {
    return this.toArray().length;
  }

  function inspect() {
    return '#<Enumerable:' + this.toArray().inspect() + '>';
  }









  return {
    each:       each,
    eachSlice:  eachSlice,
    all:        all,
    every:      all,
    any:        any,
    some:       any,
    collect:    collect,
    map:        collect,
    detect:     detect,
    findAll:    findAll,
    select:     findAll,
    filter:     findAll,
    grep:       grep,
    include:    include,
    member:     include,
    inGroupsOf: inGroupsOf,
    inject:     inject,
    invoke:     invoke,
    max:        max,
    min:        min,
    partition:  partition,
    pluck:      pluck,
    reject:     reject,
    sortBy:     sortBy,
    toArray:    toArray,
    entries:    toArray,
    zip:        zip,
    size:       size,
    inspect:    inspect,
    find:       detect
  };
})();

function $A(iterable) {
  if (!iterable) return [];
  if ('toArray' in Object(iterable)) return iterable.toArray();
  var length = iterable.length || 0, results = new Array(length);
  while (length--) results[length] = iterable[length];
  return results;
}


function $w(string) {
  if (!Object.isString(string)) return [];
  string = string.strip();
  return string ? string.split(/\s+/) : [];
}

Array.from = $A;


(function() {
  var arrayProto = Array.prototype,
      slice = arrayProto.slice,
      _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available

  function each(iterator, context) {
    for (var i = 0, length = this.length >>> 0; i < length; i++) {
      if (i in this) iterator.call(context, this[i], i, this);
    }
  }
  if (!_each) _each = each;

  function clear() {
    this.length = 0;
    return this;
  }

  function first() {
    return this[0];
  }

  function last() {
    return this[this.length - 1];
  }

  function compact() {
    return this.select(function(value) {
      return value != null;
    });
  }

  function flatten() {
    return this.inject([], function(array, value) {
      if (Object.isArray(value))
        return array.concat(value.flatten());
      array.push(value);
      return array;
    });
  }

  function without() {
    var values = slice.call(arguments, 0);
    return this.select(function(value) {
      return !values.include(value);
    });
  }

  function reverse(inline) {
    return (inline === false ? this.toArray() : this)._reverse();
  }

  function uniq(sorted) {
    return this.inject([], function(array, value, index) {
      if (0 == index || (sorted ? array.last() != value : !array.include(value)))
        array.push(value);
      return array;
    });
  }

  function intersect(array) {
    return this.uniq().findAll(function(item) {
      return array.indexOf(item) !== -1;
    });
  }


  function clone() {
    return slice.call(this, 0);
  }

  function size() {
    return this.length;
  }

  function inspect() {
    return '[' + this.map(Object.inspect).join(', ') + ']';
  }

  function indexOf(item, i) {
    if (this == null) throw new TypeError();

    var array = Object(this), length = array.length >>> 0;
    if (length === 0) return -1;

    i = Number(i);
    if (isNaN(i)) {
      i = 0;
    } else if (i !== 0 && isFinite(i)) {
      i = (i > 0 ? 1 : -1) * Math.floor(Math.abs(i));
    }

    if (i > length) return -1;

    var k = i >= 0 ? i : Math.max(length - Math.abs(i), 0);
    for (; k < length; k++)
      if (k in array && array[k] === item) return k;
    return -1;
  }


  function lastIndexOf(item, i) {
    if (this == null) throw new TypeError();

    var array = Object(this), length = array.length >>> 0;
    if (length === 0) return -1;

    if (!Object.isUndefined(i)) {
      i = Number(i);
      if (isNaN(i)) {
        i = 0;
      } else if (i !== 0 && isFinite(i)) {
        i = (i > 0 ? 1 : -1) * Math.floor(Math.abs(i));
      }
    } else {
      i = length;
    }

    var k = i >= 0 ? Math.min(i, length - 1) :
     length - Math.abs(i);

    for (; k >= 0; k--)
      if (k in array && array[k] === item) return k;
    return -1;
  }

  function concat(_) {
    var array = [], items = slice.call(arguments, 0), item, n = 0;
    items.unshift(this);
    for (var i = 0, length = items.length; i < length; i++) {
      item = items[i];
      if (Object.isArray(item) && !('callee' in item)) {
        for (var j = 0, arrayLength = item.length; j < arrayLength; j++) {
          if (j in item) array[n] = item[j];
          n++;
        }
      } else {
        array[n++] = item;
      }
    }
    array.length = n;
    return array;
  }


  function wrapNative(method) {
    return function() {
      if (arguments.length === 0) {
        return method.call(this, Prototype.K);
      } else if (arguments[0] === undefined) {
        var args = slice.call(arguments, 1);
        args.unshift(Prototype.K);
        return method.apply(this, args);
      } else {
        return method.apply(this, arguments);
      }
    };
  }


  function map(iterator) {
    if (this == null) throw new TypeError();
    iterator = iterator || Prototype.K;

    var object = Object(this);
    var results = [], context = arguments[1], n = 0;

    for (var i = 0, length = object.length >>> 0; i < length; i++) {
      if (i in object) {
        results[n] = iterator.call(context, object[i], i, object);
      }
      n++;
    }
    results.length = n;
    return results;
  }

  if (arrayProto.map) {
    map = wrapNative(Array.prototype.map);
  }

  function filter(iterator) {
    if (this == null || !Object.isFunction(iterator))
      throw new TypeError();

    var object = Object(this);
    var results = [], context = arguments[1], value;

    for (var i = 0, length = object.length >>> 0; i < length; i++) {
      if (i in object) {
        value = object[i];
        if (iterator.call(context, value, i, object)) {
          results.push(value);
        }
      }
    }
    return results;
  }

  if (arrayProto.filter) {
    filter = Array.prototype.filter;
  }

  function some(iterator) {
    if (this == null) throw new TypeError();
    iterator = iterator || Prototype.K;
    var context = arguments[1];

    var object = Object(this);
    for (var i = 0, length = object.length >>> 0; i < length; i++) {
      if (i in object && iterator.call(context, object[i], i, object)) {
        return true;
      }
    }

    return false;
  }

  if (arrayProto.some) {
    var some = wrapNative(Array.prototype.some);
  }


  function every(iterator) {
    if (this == null) throw new TypeError();
    iterator = iterator || Prototype.K;
    var context = arguments[1];

    var object = Object(this);
    for (var i = 0, length = object.length >>> 0; i < length; i++) {
      if (i in object && !iterator.call(context, object[i], i, object)) {
        return false;
      }
    }

    return true;
  }

  if (arrayProto.every) {
    var every = wrapNative(Array.prototype.every);
  }

  var _reduce = arrayProto.reduce;
  function inject(memo, iterator) {
    iterator = iterator || Prototype.K;
    var context = arguments[2];
    return _reduce.call(this, iterator.bind(context), memo);
  }

  if (!arrayProto.reduce) {
    var inject = Enumerable.inject;
  }

  Object.extend(arrayProto, Enumerable);

  if (!arrayProto._reverse)
    arrayProto._reverse = arrayProto.reverse;

  Object.extend(arrayProto, {
    _each:     _each,

    map:       map,
    collect:   map,
    select:    filter,
    filter:    filter,
    findAll:   filter,
    some:      some,
    any:       some,
    every:     every,
    all:       every,
    inject:    inject,

    clear:     clear,
    first:     first,
    last:      last,
    compact:   compact,
    flatten:   flatten,
    without:   without,
    reverse:   reverse,
    uniq:      uniq,
    intersect: intersect,
    clone:     clone,
    toArray:   clone,
    size:      size,
    inspect:   inspect
  });

  var CONCAT_ARGUMENTS_BUGGY = (function() {
    return [].concat(arguments)[0][0] !== 1;
  })(1,2);

  if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;

  if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;
  if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;
})();
function $H(object) {
  return new Hash(object);
};

var Hash = Class.create(Enumerable, (function() {
  function initialize(object) {
    this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);
  }


  function _each(iterator, context) {
    var i = 0;
    for (var key in this._object) {
      var value = this._object[key], pair = [key, value];
      pair.key = key;
      pair.value = value;
      iterator.call(context, pair, i);
      i++;
    }
  }

  function set(key, value) {
    return this._object[key] = value;
  }

  function get(key) {
    if (this._object[key] !== Object.prototype[key])
      return this._object[key];
  }

  function unset(key) {
    var value = this._object[key];
    delete this._object[key];
    return value;
  }

  function toObject() {
    return Object.clone(this._object);
  }



  function keys() {
    return this.pluck('key');
  }

  function values() {
    return this.pluck('value');
  }

  function index(value) {
    var match = this.detect(function(pair) {
      return pair.value === value;
    });
    return match && match.key;
  }

  function merge(object) {
    return this.clone().update(object);
  }

  function update(object) {
    return new Hash(object).inject(this, function(result, pair) {
      result.set(pair.key, pair.value);
      return result;
    });
  }

  function toQueryPair(key, value) {
    if (Object.isUndefined(value)) return key;

    value = String.interpret(value);

    value = value.gsub(/(\r)?\n/, '\r\n');
    value = encodeURIComponent(value);
    value = value.gsub(/%20/, '+');
    return key + '=' + value;
  }

  function toQueryString() {
    return this.inject([], function(results, pair) {
      var key = encodeURIComponent(pair.key), values = pair.value;

      if (values && typeof values == 'object') {
        if (Object.isArray(values)) {
          var queryValues = [];
          for (var i = 0, len = values.length, value; i < len; i++) {
            value = values[i];
            queryValues.push(toQueryPair(key, value));
          }
          return results.concat(queryValues);
        }
      } else results.push(toQueryPair(key, values));
      return results;
    }).join('&');
  }

  function inspect() {
    return '#<Hash:{' + this.map(function(pair) {
      return pair.map(Object.inspect).join(': ');
    }).join(', ') + '}>';
  }

  function clone() {
    return new Hash(this);
  }

  return {
    initialize:             initialize,
    _each:                  _each,
    set:                    set,
    get:                    get,
    unset:                  unset,
    toObject:               toObject,
    toTemplateReplacements: toObject,
    keys:                   keys,
    values:                 values,
    index:                  index,
    merge:                  merge,
    update:                 update,
    toQueryString:          toQueryString,
    inspect:                inspect,
    toJSON:                 toObject,
    clone:                  clone
  };
})());

Hash.from = $H;
Object.extend(Number.prototype, (function() {
  function toColorPart() {
    return this.toPaddedString(2, 16);
  }

  function succ() {
    return this + 1;
  }

  function times(iterator, context) {
    $R(0, this, true).each(iterator, context);
    return this;
  }

  function toPaddedString(length, radix) {
    var string = this.toString(radix || 10);
    return '0'.times(length - string.length) + string;
  }

  function abs() {
    return Math.abs(this);
  }

  function round() {
    return Math.round(this);
  }

  function ceil() {
    return Math.ceil(this);
  }

  function floor() {
    return Math.floor(this);
  }

  return {
    toColorPart:    toColorPart,
    succ:           succ,
    times:          times,
    toPaddedString: toPaddedString,
    abs:            abs,
    round:          round,
    ceil:           ceil,
    floor:          floor
  };
})());

function $R(start, end, exclusive) {
  return new ObjectRange(start, end, exclusive);
}

var ObjectRange = Class.create(Enumerable, (function() {
  function initialize(start, end, exclusive) {
    this.start = start;
    this.end = end;
    this.exclusive = exclusive;
  }

  function _each(iterator, context) {
    var value = this.start, i;
    for (i = 0; this.include(value); i++) {
      iterator.call(context, value, i);
      value = value.succ();
    }
  }

  function include(value) {
    if (value < this.start)
      return false;
    if (this.exclusive)
      return value < this.end;
    return value <= this.end;
  }

  return {
    initialize: initialize,
    _each:      _each,
    include:    include
  };
})());



var Abstract = { };


var Try = {
  these: function() {
    var returnValue;

    for (var i = 0, length = arguments.length; i < length; i++) {
      var lambda = arguments[i];
      try {
        returnValue = lambda();
        break;
      } catch (e) { }
    }

    return returnValue;
  }
};

var Ajax = {
  getTransport: function() {
    return Try.these(
      function() {return new XMLHttpRequest()},
      function() {return new ActiveXObject('Msxml2.XMLHTTP')},
      function() {return new ActiveXObject('Microsoft.XMLHTTP')}
    ) || false;
  },

  activeRequestCount: 0
};

Ajax.Responders = {
  responders: [],

  _each: function(iterator, context) {
    this.responders._each(iterator, context);
  },

  register: function(responder) {
    if (!this.include(responder))
      this.responders.push(responder);
  },

  unregister: function(responder) {
    this.responders = this.responders.without(responder);
  },

  dispatch: function(callback, request, transport, json) {
    this.each(function(responder) {
      if (Object.isFunction(responder[callback])) {
        try {
          responder[callback].apply(responder, [request, transport, json]);
        } catch (e) { }
      }
    });
  }
};

Object.extend(Ajax.Responders, Enumerable);

Ajax.Responders.register({
  onCreate:   function() { Ajax.activeRequestCount++ },
  onComplete: function() { Ajax.activeRequestCount-- }
});
Ajax.Base = Class.create({
  initialize: function(options) {
    this.options = {
      method:       'post',
      asynchronous: true,
      contentType:  'application/x-www-form-urlencoded',
      encoding:     'UTF-8',
      parameters:   '',
      evalJSON:     true,
      evalJS:       true
    };
    Object.extend(this.options, options || { });

    this.options.method = this.options.method.toLowerCase();

    if (Object.isHash(this.options.parameters))
      this.options.parameters = this.options.parameters.toObject();
  }
});
Ajax.Request = Class.create(Ajax.Base, {
  _complete: false,

  initialize: function($super, url, options) {
    $super(options);
    this.transport = Ajax.getTransport();
    this.request(url);
  },

  request: function(url) {
    this.url = url;
    this.method = this.options.method;
    var params = Object.isString(this.options.parameters) ?
          this.options.parameters :
          Object.toQueryString(this.options.parameters);

    if (!['get', 'post'].include(this.method)) {
      params += (params ? '&' : '') + "_method=" + this.method;
      this.method = 'post';
    }

    if (params && this.method === 'get') {
      this.url += (this.url.include('?') ? '&' : '?') + params;
    }

    this.parameters = params.toQueryParams();

    try {
      var response = new Ajax.Response(this);
      if (this.options.onCreate) this.options.onCreate(response);
      Ajax.Responders.dispatch('onCreate', this, response);

      this.transport.open(this.method.toUpperCase(), this.url,
        this.options.asynchronous);

      if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);

      this.transport.onreadystatechange = this.onStateChange.bind(this);
      this.setRequestHeaders();

      this.body = this.method == 'post' ? (this.options.postBody || params) : null;
      this.transport.send(this.body);

      /* Force Firefox to handle ready state 4 for synchronous requests */
      if (!this.options.asynchronous && this.transport.overrideMimeType)
        this.onStateChange();

    }
    catch (e) {
      this.dispatchException(e);
    }
  },

  onStateChange: function() {
    var readyState = this.transport.readyState;
    if (readyState > 1 && !((readyState == 4) && this._complete))
      this.respondToReadyState(this.transport.readyState);
  },

  setRequestHeaders: function() {
    var headers = {
      'X-Requested-With': 'XMLHttpRequest',
      'X-Prototype-Version': Prototype.Version,
      'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
    };

    if (this.method == 'post') {
      headers['Content-type'] = this.options.contentType +
        (this.options.encoding ? '; charset=' + this.options.encoding : '');

      /* Force "Connection: close" for older Mozilla browsers to work
       * around a bug where XMLHttpRequest sends an incorrect
       * Content-length header. See Mozilla Bugzilla #246651.
       */
      if (this.transport.overrideMimeType &&
          (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] < 2005)
            headers['Connection'] = 'close';
    }

    if (typeof this.options.requestHeaders == 'object') {
      var extras = this.options.requestHeaders;

      if (Object.isFunction(extras.push))
        for (var i = 0, length = extras.length; i < length; i += 2)
          headers[extras[i]] = extras[i+1];
      else
        $H(extras).each(function(pair) { headers[pair.key] = pair.value });
    }

    for (var name in headers)
      if (headers[name] != null)
        this.transport.setRequestHeader(name, headers[name]);
  },

  success: function() {
    var status = this.getStatus();
    return !status || (status >= 200 && status < 300) || status == 304;
  },

  getStatus: function() {
    try {
      if (this.transport.status === 1223) return 204;
      return this.transport.status || 0;
    } catch (e) { return 0 }
  },

  respondToReadyState: function(readyState) {
    var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);

    if (state == 'Complete') {
      try {
        this._complete = true;
        (this.options['on' + response.status]
         || this.options['on' + (this.success() ? 'Success' : 'Failure')]
         || Prototype.emptyFunction)(response, response.headerJSON);
      } catch (e) {
        this.dispatchException(e);
      }

      var contentType = response.getHeader('Content-type');
      if (this.options.evalJS == 'force'
          || (this.options.evalJS && this.isSameOrigin() && contentType
          && contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
        this.evalResponse();
    }

    try {
      (this.options['on' + state] || Prototype.emptyFunction)(response, response.headerJSON);
      Ajax.Responders.dispatch('on' + state, this, response, response.headerJSON);
    } catch (e) {
      this.dispatchException(e);
    }

    if (state == 'Complete') {
      this.transport.onreadystatechange = Prototype.emptyFunction;
    }
  },

  isSameOrigin: function() {
    var m = this.url.match(/^\s*https?:\/\/[^\/]*/);
    return !m || (m[0] == '#{protocol}//#{domain}#{port}'.interpolate({
      protocol: location.protocol,
      domain: document.domain,
      port: location.port ? ':' + location.port : ''
    }));
  },

  getHeader: function(name) {
    try {
      return this.transport.getResponseHeader(name) || null;
    } catch (e) { return null; }
  },

  evalResponse: function() {
    try {
      return eval((this.transport.responseText || '').unfilterJSON());
    } catch (e) {
      this.dispatchException(e);
    }
  },

  dispatchException: function(exception) {
    (this.options.onException || Prototype.emptyFunction)(this, exception);
    Ajax.Responders.dispatch('onException', this, exception);
  }
});

Ajax.Request.Events =
  ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];








Ajax.Response = Class.create({
  initialize: function(request){
    this.request = request;
    var transport  = this.transport  = request.transport,
        readyState = this.readyState = transport.readyState;

    if ((readyState > 2 && !Prototype.Browser.IE) || readyState == 4) {
      this.status       = this.getStatus();
      this.statusText   = this.getStatusText();
      this.responseText = String.interpret(transport.responseText);
      this.headerJSON   = this._getHeaderJSON();
    }

    if (readyState == 4) {
      var xml = transport.responseXML;
      this.responseXML  = Object.isUndefined(xml) ? null : xml;
      this.responseJSON = this._getResponseJSON();
    }
  },

  status:      0,

  statusText: '',

  getStatus: Ajax.Request.prototype.getStatus,

  getStatusText: function() {
    try {
      return this.transport.statusText || '';
    } catch (e) { return '' }
  },

  getHeader: Ajax.Request.prototype.getHeader,

  getAllHeaders: function() {
    try {
      return this.getAllResponseHeaders();
    } catch (e) { return null }
  },

  getResponseHeader: function(name) {
    return this.transport.getResponseHeader(name);
  },

  getAllResponseHeaders: function() {
    return this.transport.getAllResponseHeaders();
  },

  _getHeaderJSON: function() {
    var json = this.getHeader('X-JSON');
    if (!json) return null;

    try {
      json = decodeURIComponent(escape(json));
    } catch(e) {
    }

    try {
      return json.evalJSON(this.request.options.sanitizeJSON ||
        !this.request.isSameOrigin());
    } catch (e) {
      this.request.dispatchException(e);
    }
  },

  _getResponseJSON: function() {
    var options = this.request.options;
    if (!options.evalJSON || (options.evalJSON != 'force' &&
      !(this.getHeader('Content-type') || '').include('application/json')) ||
        this.responseText.blank())
          return null;
    try {
      return this.responseText.evalJSON(options.sanitizeJSON ||
        !this.request.isSameOrigin());
    } catch (e) {
      this.request.dispatchException(e);
    }
  }
});

Ajax.Updater = Class.create(Ajax.Request, {
  initialize: function($super, container, url, options) {
    this.container = {
      success: (container.success || container),
      failure: (container.failure || (container.success ? null : container))
    };

    options = Object.clone(options);
    var onComplete = options.onComplete;
    options.onComplete = (function(response, json) {
      this.updateContent(response.responseText);
      if (Object.isFunction(onComplete)) onComplete(response, json);
    }).bind(this);

    $super(url, options);
  },

  updateContent: function(responseText) {
    var receiver = this.container[this.success() ? 'success' : 'failure'],
        options = this.options;

    if (!options.evalScripts) responseText = responseText.stripScripts();

    if (receiver = $(receiver)) {
      if (options.insertion) {
        if (Object.isString(options.insertion)) {
          var insertion = { }; insertion[options.insertion] = responseText;
          receiver.insert(insertion);
        }
        else options.insertion(receiver, responseText);
      }
      else receiver.update(responseText);
    }
  }
});

Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {
  initialize: function($super, container, url, options) {
    $super(options);
    this.onComplete = this.options.onComplete;

    this.frequency = (this.options.frequency || 2);
    this.decay = (this.options.decay || 1);

    this.updater = { };
    this.container = container;
    this.url = url;

    this.start();
  },

  start: function() {
    this.options.onComplete = this.updateComplete.bind(this);
    this.onTimerEvent();
  },

  stop: function() {
    this.updater.options.onComplete = undefined;
    clearTimeout(this.timer);
    (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
  },

  updateComplete: function(response) {
    if (this.options.decay) {
      this.decay = (response.responseText == this.lastText ?
        this.decay * this.options.decay : 1);

      this.lastText = response.responseText;
    }
    this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
  },

  onTimerEvent: function() {
    this.updater = new Ajax.Updater(this.container, this.url, this.options);
  }
});

(function(GLOBAL) {

  var UNDEFINED;
  var SLICE = Array.prototype.slice;

  var DIV = document.createElement('div');


  function $(element) {
    if (arguments.length > 1) {
      for (var i = 0, elements = [], length = arguments.length; i < length; i++)
        elements.push($(arguments[i]));
      return elements;
    }

    if (Object.isString(element))
      element = document.getElementById(element);
    return Element.extend(element);
  }

  GLOBAL.$ = $;


  if (!GLOBAL.Node) GLOBAL.Node = {};

  if (!GLOBAL.Node.ELEMENT_NODE) {
    Object.extend(GLOBAL.Node, {
      ELEMENT_NODE:                1,
      ATTRIBUTE_NODE:              2,
      TEXT_NODE:                   3,
      CDATA_SECTION_NODE:          4,
      ENTITY_REFERENCE_NODE:       5,
      ENTITY_NODE:                 6,
      PROCESSING_INSTRUCTION_NODE: 7,
      COMMENT_NODE:                8,
      DOCUMENT_NODE:               9,
      DOCUMENT_TYPE_NODE:         10,
      DOCUMENT_FRAGMENT_NODE:     11,
      NOTATION_NODE:              12
    });
  }

  var ELEMENT_CACHE = {};

  function shouldUseCreationCache(tagName, attributes) {
    if (tagName === 'select') return false;
    if ('type' in attributes) return false;
    return true;
  }

  var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX = (function(){
    try {
      var el = document.createElement('<input name="x">');
      return el.tagName.toLowerCase() === 'input' && el.name === 'x';
    }
    catch(err) {
      return false;
    }
  })();


  var oldElement = GLOBAL.Element;
  function Element(tagName, attributes) {
    attributes = attributes || {};
    tagName = tagName.toLowerCase();

    if (HAS_EXTENDED_CREATE_ELEMENT_SYNTAX && attributes.name) {
      tagName = '<' + tagName + ' name="' + attributes.name + '">';
      delete attributes.name;
      return Element.writeAttribute(document.createElement(tagName), attributes);
    }

    if (!ELEMENT_CACHE[tagName])
      ELEMENT_CACHE[tagName] = Element.extend(document.createElement(tagName));

    var node = shouldUseCreationCache(tagName, attributes) ?
     ELEMENT_CACHE[tagName].cloneNode(false) : document.createElement(tagName);

    return Element.writeAttribute(node, attributes);
  }

  GLOBAL.Element = Element;

  Object.extend(GLOBAL.Element, oldElement || {});
  if (oldElement) GLOBAL.Element.prototype = oldElement.prototype;

  Element.Methods = { ByTag: {}, Simulated: {} };

  var methods = {};

  var INSPECT_ATTRIBUTES = { id: 'id', className: 'class' };
  function inspect(element) {
    element = $(element);
    var result = '<' + element.tagName.toLowerCase();

    var attribute, value;
    for (var property in INSPECT_ATTRIBUTES) {
      attribute = INSPECT_ATTRIBUTES[property];
      value = (element[property] || '').toString();
      if (value) result += ' ' + attribute + '=' + value.inspect(true);
    }

    return result + '>';
  }

  methods.inspect = inspect;


  function visible(element) {
    return $(element).style.display !== 'none';
  }

  function toggle(element, bool) {
    element = $(element);
    if (Object.isUndefined(bool))
      bool = !Element.visible(element);
    Element[bool ? 'show' : 'hide'](element);

    return element;
  }

  function hide(element) {
    element = $(element);
    element.style.display = 'none';
    return element;
  }

  function show(element) {
    element = $(element);
    element.style.display = '';
    return element;
  }


  Object.extend(methods, {
    visible: visible,
    toggle:  toggle,
    hide:    hide,
    show:    show
  });


  function remove(element) {
    element = $(element);
    element.parentNode.removeChild(element);
    return element;
  }

  var SELECT_ELEMENT_INNERHTML_BUGGY = (function(){
    var el = document.createElement("select"),
        isBuggy = true;
    el.innerHTML = "<option value=\"test\">test</option>";
    if (el.options && el.options[0]) {
      isBuggy = el.options[0].nodeName.toUpperCase() !== "OPTION";
    }
    el = null;
    return isBuggy;
  })();

  var TABLE_ELEMENT_INNERHTML_BUGGY = (function(){
    try {
      var el = document.createElement("table");
      if (el && el.tBodies) {
        el.innerHTML = "<tbody><tr><td>test</td></tr></tbody>";
        var isBuggy = typeof el.tBodies[0] == "undefined";
        el = null;
        return isBuggy;
      }
    } catch (e) {
      return true;
    }
  })();

  var LINK_ELEMENT_INNERHTML_BUGGY = (function() {
    try {
      var el = document.createElement('div');
      el.innerHTML = "<link />";
      var isBuggy = (el.childNodes.length === 0);
      el = null;
      return isBuggy;
    } catch(e) {
      return true;
    }
  })();

  var ANY_INNERHTML_BUGGY = SELECT_ELEMENT_INNERHTML_BUGGY ||
   TABLE_ELEMENT_INNERHTML_BUGGY || LINK_ELEMENT_INNERHTML_BUGGY;

  var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () {
    var s = document.createElement("script"),
        isBuggy = false;
    try {
      s.appendChild(document.createTextNode(""));
      isBuggy = !s.firstChild ||
        s.firstChild && s.firstChild.nodeType !== 3;
    } catch (e) {
      isBuggy = true;
    }
    s = null;
    return isBuggy;
  })();

  function update(element, content) {
    element = $(element);

    var descendants = element.getElementsByTagName('*'),
     i = descendants.length;
    while (i--) purgeElement(descendants[i]);

    if (content && content.toElement)
      content = content.toElement();

    if (Object.isElement(content))
      return element.update().insert(content);


    content = Object.toHTML(content);
    var tagName = element.tagName.toUpperCase();

    if (tagName === 'SCRIPT' && SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) {
      element.text = content;
      return element;
    }

    if (ANY_INNERHTML_BUGGY) {
      if (tagName in INSERTION_TRANSLATIONS.tags) {
        while (element.firstChild)
          element.removeChild(element.firstChild);

        var nodes = getContentFromAnonymousElement(tagName, content.stripScripts());
        for (var i = 0, node; node = nodes[i]; i++)
          element.appendChild(node);

      } else if (LINK_ELEMENT_INNERHTML_BUGGY && Object.isString(content) && content.indexOf('<link') > -1) {
        while (element.firstChild)
          element.removeChild(element.firstChild);

        var nodes = getContentFromAnonymousElement(tagName,
         content.stripScripts(), true);

        for (var i = 0, node; node = nodes[i]; i++)
          element.appendChild(node);
      } else {
        element.innerHTML = content.stripScripts();
      }
    } else {
      element.innerHTML = content.stripScripts();
    }

    content.evalScripts.bind(content).defer();
    return element;
  }

  function replace(element, content) {
    element = $(element);

    if (content && content.toElement) {
      content = content.toElement();
    } else if (!Object.isElement(content)) {
      content = Object.toHTML(content);
      var range = element.ownerDocument.createRange();
      range.selectNode(element);
      content.evalScripts.bind(content).defer();
      content = range.createContextualFragment(content.stripScripts());
    }

    element.parentNode.replaceChild(content, element);
    return element;
  }

  var INSERTION_TRANSLATIONS = {
    before: function(element, node) {
      element.parentNode.insertBefore(node, element);
    },
    top: function(element, node) {
      element.insertBefore(node, element.firstChild);
    },
    bottom: function(element, node) {
      element.appendChild(node);
    },
    after: function(element, node) {
      element.parentNode.insertBefore(node, element.nextSibling);
    },

    tags: {
      TABLE:  ['<table>',                '</table>',                   1],
      TBODY:  ['<table><tbody>',         '</tbody></table>',           2],
      TR:     ['<table><tbody><tr>',     '</tr></tbody></table>',      3],
      TD:     ['<table><tbody><tr><td>', '</td></tr></tbody></table>', 4],
      SELECT: ['<select>',               '</select>',                  1]
    }
  };

  var tags = INSERTION_TRANSLATIONS.tags;

  Object.extend(tags, {
    THEAD: tags.TBODY,
    TFOOT: tags.TBODY,
    TH:    tags.TD
  });

  function replace_IE(element, content) {
    element = $(element);
    if (content && content.toElement)
      content = content.toElement();
    if (Object.isElement(content)) {
      element.parentNode.replaceChild(content, element);
      return element;
    }

    content = Object.toHTML(content);
    var parent = element.parentNode, tagName = parent.tagName.toUpperCase();

    if (tagName in INSERTION_TRANSLATIONS.tags) {
      var nextSibling = Element.next(element);
      var fragments = getContentFromAnonymousElement(
       tagName, content.stripScripts());

      parent.removeChild(element);

      var iterator;
      if (nextSibling)
        iterator = function(node) { parent.insertBefore(node, nextSibling) };
      else
        iterator = function(node) { parent.appendChild(node); }

      fragments.each(iterator);
    } else {
      element.outerHTML = content.stripScripts();
    }

    content.evalScripts.bind(content).defer();
    return element;
  }

  if ('outerHTML' in document.documentElement)
    replace = replace_IE;

  function isContent(content) {
    if (Object.isUndefined(content) || content === null) return false;

    if (Object.isString(content) || Object.isNumber(content)) return true;
    if (Object.isElement(content)) return true;
    if (content.toElement || content.toHTML) return true;

    return false;
  }

  function insertContentAt(element, content, position) {
    position   = position.toLowerCase();
    var method = INSERTION_TRANSLATIONS[position];

    if (content && content.toElement) content = content.toElement();
    if (Object.isElement(content)) {
      method(element, content);
      return element;
    }

    content = Object.toHTML(content);
    var tagName = ((position === 'before' || position === 'after') ?
     element.parentNode : element).tagName.toUpperCase();

    var childNodes = getContentFromAnonymousElement(tagName, content.stripScripts());

    if (position === 'top' || position === 'after') childNodes.reverse();

    for (var i = 0, node; node = childNodes[i]; i++)
      method(element, node);

    content.evalScripts.bind(content).defer();
  }

  function insert(element, insertions) {
    element = $(element);

    if (isContent(insertions))
      insertions = { bottom: insertions };

    for (var position in insertions)
      insertContentAt(element, insertions[position], position);

    return element;
  }

  function wrap(element, wrapper, attributes) {
    element = $(element);

    if (Object.isElement(wrapper)) {
      $(wrapper).writeAttribute(attributes || {});
    } else if (Object.isString(wrapper)) {
      wrapper = new Element(wrapper, attributes);
    } else {
      wrapper = new Element('div', wrapper);
    }

    if (element.parentNode)
      element.parentNode.replaceChild(wrapper, element);

    wrapper.appendChild(element);

    return wrapper;
  }

  function cleanWhitespace(element) {
    element = $(element);
    var node = element.firstChild;

    while (node) {
      var nextNode = node.nextSibling;
      if (node.nodeType === Node.TEXT_NODE && !/\S/.test(node.nodeValue))
        element.removeChild(node);
      node = nextNode;
    }
    return element;
  }

  function empty(element) {
    return $(element).innerHTML.blank();
  }

  function getContentFromAnonymousElement(tagName, html, force) {
    var t = INSERTION_TRANSLATIONS.tags[tagName], div = DIV;

    var workaround = !!t;
    if (!workaround && force) {
      workaround = true;
      t = ['', '', 0];
    }

    if (workaround) {
      div.innerHTML = '&#160;' + t[0] + html + t[1];
      div.removeChild(div.firstChild);
      for (var i = t[2]; i--; )
        div = div.firstChild;
    } else {
      div.innerHTML = html;
    }

    return $A(div.childNodes);
  }

  function clone(element, deep) {
    if (!(element = $(element))) return;
    var clone = element.cloneNode(deep);
    if (!HAS_UNIQUE_ID_PROPERTY) {
      clone._prototypeUID = UNDEFINED;
      if (deep) {
        var descendants = Element.select(clone, '*'),
         i = descendants.length;
        while (i--)
          descendants[i]._prototypeUID = UNDEFINED;
      }
    }
    return Element.extend(clone);
  }

  function purgeElement(element) {
    var uid = getUniqueElementID(element);
    if (uid) {
      Element.stopObserving(element);
      if (!HAS_UNIQUE_ID_PROPERTY)
        element._prototypeUID = UNDEFINED;
      delete Element.Storage[uid];
    }
  }

  function purgeCollection(elements) {
    var i = elements.length;
    while (i--)
      purgeElement(elements[i]);
  }

  function purgeCollection_IE(elements) {
    var i = elements.length, element, uid;
    while (i--) {
      element = elements[i];
      uid = getUniqueElementID(element);
      delete Element.Storage[uid];
      delete Event.cache[uid];
    }
  }

  if (HAS_UNIQUE_ID_PROPERTY) {
    purgeCollection = purgeCollection_IE;
  }


  function purge(element) {
    if (!(element = $(element))) return;
    purgeElement(element);

    var descendants = element.getElementsByTagName('*'),
     i = descendants.length;

    while (i--) purgeElement(descendants[i]);

    return null;
  }

  Object.extend(methods, {
    remove:  remove,
    update:  update,
    replace: replace,
    insert:  insert,
    wrap:    wrap,
    cleanWhitespace: cleanWhitespace,
    empty:   empty,
    clone:   clone,
    purge:   purge
  });



  function recursivelyCollect(element, property, maximumLength) {
    element = $(element);
    maximumLength = maximumLength || -1;
    var elements = [];

    while (element = element[property]) {
      if (element.nodeType === Node.ELEMENT_NODE)
        elements.push(Element.extend(element));

      if (elements.length === maximumLength) break;
    }

    return elements;
  }


  function ancestors(element) {
    return recursivelyCollect(element, 'parentNode');
  }

  function descendants(element) {
    return Element.select(element, '*');
  }

  function firstDescendant(element) {
    element = $(element).firstChild;
    while (element && element.nodeType !== Node.ELEMENT_NODE)
      element = element.nextSibling;

    return $(element);
  }

  function immediateDescendants(element) {
    var results = [], child = $(element).firstChild;

    while (child) {
      if (child.nodeType === Node.ELEMENT_NODE)
        results.push(Element.extend(child));

      child = child.nextSibling;
    }

    return results;
  }

  function previousSiblings(element) {
    return recursivelyCollect(element, 'previousSibling');
  }

  function nextSiblings(element) {
    return recursivelyCollect(element, 'nextSibling');
  }

  function siblings(element) {
    element = $(element);
    var previous = previousSiblings(element),
     next = nextSiblings(element);
    return previous.reverse().concat(next);
  }

  function match(element, selector) {
    element = $(element);

    if (Object.isString(selector))
      return Prototype.Selector.match(element, selector);

    return selector.match(element);
  }


  function _recursivelyFind(element, property, expression, index) {
    element = $(element), expression = expression || 0, index = index || 0;
    if (Object.isNumber(expression)) {
      index = expression, expression = null;
    }

    while (element = element[property]) {
      if (element.nodeType !== 1) continue;
      if (expression && !Prototype.Selector.match(element, expression))
        continue;
      if (--index >= 0) continue;

      return Element.extend(element);
    }
  }


  function up(element, expression, index) {
    element = $(element);

    if (arguments.length === 1) return $(element.parentNode);
    return _recursivelyFind(element, 'parentNode', expression, index);
  }

  function down(element, expression, index) {
    if (arguments.length === 1) return firstDescendant(element);
    element = $(element), expression = expression || 0, index = index || 0;

    if (Object.isNumber(expression))
      index = expression, expression = '*';

    var node = Prototype.Selector.select(expression, element)[index];
    return Element.extend(node);
  }

  function previous(element, expression, index) {
    return _recursivelyFind(element, 'previousSibling', expression, index);
  }

  function next(element, expression, index) {
    return _recursivelyFind(element, 'nextSibling', expression, index);
  }

  function select(element) {
    element = $(element);
    var expressions = SLICE.call(arguments, 1).join(', ');
    return Prototype.Selector.select(expressions, element);
  }

  function adjacent(element) {
    element = $(element);
    var expressions = SLICE.call(arguments, 1).join(', ');
    var siblings = Element.siblings(element), results = [];
    for (var i = 0, sibling; sibling = siblings[i]; i++) {
      if (Prototype.Selector.match(sibling, expressions))
        results.push(sibling);
    }

    return results;
  }

  function descendantOf_DOM(element, ancestor) {
    element = $(element), ancestor = $(ancestor);
    while (element = element.parentNode)
      if (element === ancestor) return true;
    return false;
  }

  function descendantOf_contains(element, ancestor) {
    element = $(element), ancestor = $(ancestor);
    if (!ancestor.contains) return descendantOf_DOM(element, ancestor);
    return ancestor.contains(element) && ancestor !== element;
  }

  function descendantOf_compareDocumentPosition(element, ancestor) {
    element = $(element), ancestor = $(ancestor);
    return (element.compareDocumentPosition(ancestor) & 8) === 8;
  }

  var descendantOf;
  if (DIV.compareDocumentPosition) {
    descendantOf = descendantOf_compareDocumentPosition;
  } else if (DIV.contains) {
    descendantOf = descendantOf_contains;
  } else {
    descendantOf = descendantOf_DOM;
  }


  Object.extend(methods, {
    recursivelyCollect:   recursivelyCollect,
    ancestors:            ancestors,
    descendants:          descendants,
    firstDescendant:      firstDescendant,
    immediateDescendants: immediateDescendants,
    previousSiblings:     previousSiblings,
    nextSiblings:         nextSiblings,
    siblings:             siblings,
    match:                match,
    up:                   up,
    down:                 down,
    previous:             previous,
    next:                 next,
    select:               select,
    adjacent:             adjacent,
    descendantOf:         descendantOf,

    getElementsBySelector: select,

    childElements:         immediateDescendants
  });


  var idCounter = 1;
  function identify(element) {
    element = $(element);
    var id = Element.readAttribute(element, 'id');
    if (id) return id;

    do { id = 'anonymous_element_' + idCounter++ } while ($(id));

    Element.writeAttribute(element, 'id', id);
    return id;
  }


  function readAttribute(element, name) {
    return $(element).getAttribute(name);
  }

  function readAttribute_IE(element, name) {
    element = $(element);

    var table = ATTRIBUTE_TRANSLATIONS.read;
    if (table.values[name])
      return table.values[name](element, name);

    if (table.names[name]) name = table.names[name];

    if (name.include(':')) {
      if (!element.attributes || !element.attributes[name]) return null;
      return element.attributes[name].value;
    }

    return element.getAttribute(name);
  }

  function readAttribute_Opera(element, name) {
    if (name === 'title') return element.title;
    return element.getAttribute(name);
  }

  var PROBLEMATIC_ATTRIBUTE_READING = (function() {
    DIV.setAttribute('onclick', []);
    var value = DIV.getAttribute('onclick');
    var isFunction = Object.isArray(value);
    DIV.removeAttribute('onclick');
    return isFunction;
  })();

  if (PROBLEMATIC_ATTRIBUTE_READING) {
    readAttribute = readAttribute_IE;
  } else if (Prototype.Browser.Opera) {
    readAttribute = readAttribute_Opera;
  }


  function writeAttribute(element, name, value) {
    element = $(element);
    var attributes = {}, table = ATTRIBUTE_TRANSLATIONS.write;

    if (typeof name === 'object') {
      attributes = name;
    } else {
      attributes[name] = Object.isUndefined(value) ? true : value;
    }

    for (var attr in attributes) {
      name = table.names[attr] || attr;
      value = attributes[attr];
      if (table.values[attr])
        name = table.values[attr](element, value) || name;
      if (value === false || value === null)
        element.removeAttribute(name);
      else if (value === true)
        element.setAttribute(name, name);
      else element.setAttribute(name, value);
    }

    return element;
  }

  var PROBLEMATIC_HAS_ATTRIBUTE_WITH_CHECKBOXES = (function () {
    if (!HAS_EXTENDED_CREATE_ELEMENT_SYNTAX) {
      return false;
    }
    var checkbox = document.createElement('<input type="checkbox">');
    checkbox.checked = true;
    var node = checkbox.getAttributeNode('checked');
    return !node || !node.specified;
  })();

  function hasAttribute(element, attribute) {
    attribute = ATTRIBUTE_TRANSLATIONS.has[attribute] || attribute;
    var node = $(element).getAttributeNode(attribute);
    return !!(node && node.specified);
  }

  function hasAttribute_IE(element, attribute) {
    if (attribute === 'checked') {
      return element.checked;
    }
    return hasAttribute(element, attribute);
  }

  GLOBAL.Element.Methods.Simulated.hasAttribute =
   PROBLEMATIC_HAS_ATTRIBUTE_WITH_CHECKBOXES ?
   hasAttribute_IE : hasAttribute;

  function classNames(element) {
    return new Element.ClassNames(element);
  }

  var regExpCache = {};
  function getRegExpForClassName(className) {
    if (regExpCache[className]) return regExpCache[className];

    var re = new RegExp("(^|\\s+)" + className + "(\\s+|$)");
    regExpCache[className] = re;
    return re;
  }

  function hasClassName(element, className) {
    if (!(element = $(element))) return;

    var elementClassName = element.className;

    if (elementClassName.length === 0) return false;
    if (elementClassName === className) return true;

    return getRegExpForClassName(className).test(elementClassName);
  }

  function addClassName(element, className) {
    if (!(element = $(element))) return;

    if (!hasClassName(element, className))
      element.className += (element.className ? ' ' : '') + className;

    return element;
  }

  function removeClassName(element, className) {
    if (!(element = $(element))) return;

    element.className = element.className.replace(
     getRegExpForClassName(className), ' ').strip();

    return element;
  }

  function toggleClassName(element, className, bool) {
    if (!(element = $(element))) return;

    if (Object.isUndefined(bool))
      bool = !hasClassName(element, className);

    var method = Element[bool ? 'addClassName' : 'removeClassName'];
    return method(element, className);
  }

  var ATTRIBUTE_TRANSLATIONS = {};

  var classProp = 'className', forProp = 'for';

  DIV.setAttribute(classProp, 'x');
  if (DIV.className !== 'x') {
    DIV.setAttribute('class', 'x');
    if (DIV.className === 'x')
      classProp = 'class';
  }

  var LABEL = document.createElement('label');
  LABEL.setAttribute(forProp, 'x');
  if (LABEL.htmlFor !== 'x') {
    LABEL.setAttribute('htmlFor', 'x');
    if (LABEL.htmlFor === 'x')
      forProp = 'htmlFor';
  }
  LABEL = null;

  function _getAttr(element, attribute) {
    return element.getAttribute(attribute);
  }

  function _getAttr2(element, attribute) {
    return element.getAttribute(attribute, 2);
  }

  function _getAttrNode(element, attribute) {
    var node = element.getAttributeNode(attribute);
    return node ? node.value : '';
  }

  function _getFlag(element, attribute) {
    return $(element).hasAttribute(attribute) ? attribute : null;
  }

  DIV.onclick = Prototype.emptyFunction;
  var onclickValue = DIV.getAttribute('onclick');

  var _getEv;

  if (String(onclickValue).indexOf('{') > -1) {
    _getEv = function(element, attribute) {
      var value = element.getAttribute(attribute);
      if (!value) return null;
      value = value.toString();
      value = value.split('{')[1];
      value = value.split('}')[0];
      return value.strip();
    };
  }
  else if (onclickValue === '') {
    _getEv = function(element, attribute) {
      var value = element.getAttribute(attribute);
      if (!value) return null;
      return value.strip();
    };
  }

  ATTRIBUTE_TRANSLATIONS.read = {
    names: {
      'class':     classProp,
      'className': classProp,
      'for':       forProp,
      'htmlFor':   forProp
    },

    values: {
      style: function(element) {
        return element.style.cssText.toLowerCase();
      },
      title: function(element) {
        return element.title;
      }
    }
  };

  ATTRIBUTE_TRANSLATIONS.write = {
    names: {
      className:   'class',
      htmlFor:     'for',
      cellpadding: 'cellPadding',
      cellspacing: 'cellSpacing'
    },

    values: {
      checked: function(element, value) {
        element.checked = !!value;
      },

      style: function(element, value) {
        element.style.cssText = value ? value : '';
      }
    }
  };

  ATTRIBUTE_TRANSLATIONS.has = { names: {} };

  Object.extend(ATTRIBUTE_TRANSLATIONS.write.names,
   ATTRIBUTE_TRANSLATIONS.read.names);

  var CAMEL_CASED_ATTRIBUTE_NAMES = $w('colSpan rowSpan vAlign dateTime ' +
   'accessKey tabIndex encType maxLength readOnly longDesc frameBorder');

  for (var i = 0, attr; attr = CAMEL_CASED_ATTRIBUTE_NAMES[i]; i++) {
    ATTRIBUTE_TRANSLATIONS.write.names[attr.toLowerCase()] = attr;
    ATTRIBUTE_TRANSLATIONS.has.names[attr.toLowerCase()]   = attr;
  }

  Object.extend(ATTRIBUTE_TRANSLATIONS.read.values, {
    href:        _getAttr2,
    src:         _getAttr2,
    type:        _getAttr,
    action:      _getAttrNode,
    disabled:    _getFlag,
    checked:     _getFlag,
    readonly:    _getFlag,
    multiple:    _getFlag,
    onload:      _getEv,
    onunload:    _getEv,
    onclick:     _getEv,
    ondblclick:  _getEv,
    onmousedown: _getEv,
    onmouseup:   _getEv,
    onmouseover: _getEv,
    onmousemove: _getEv,
    onmouseout:  _getEv,
    onfocus:     _getEv,
    onblur:      _getEv,
    onkeypress:  _getEv,
    onkeydown:   _getEv,
    onkeyup:     _getEv,
    onsubmit:    _getEv,
    onreset:     _getEv,
    onselect:    _getEv,
    onchange:    _getEv
  });


  Object.extend(methods, {
    identify:        identify,
    readAttribute:   readAttribute,
    writeAttribute:  writeAttribute,
    classNames:      classNames,
    hasClassName:    hasClassName,
    addClassName:    addClassName,
    removeClassName: removeClassName,
    toggleClassName: toggleClassName
  });


  function normalizeStyleName(style) {
    if (style === 'float' || style === 'styleFloat')
      return 'cssFloat';
    return style.camelize();
  }

  function normalizeStyleName_IE(style) {
    if (style === 'float' || style === 'cssFloat')
      return 'styleFloat';
    return style.camelize();
  }

  function setStyle(element, styles) {
    element = $(element);
    var elementStyle = element.style, match;

    if (Object.isString(styles)) {
      elementStyle.cssText += ';' + styles;
      if (styles.include('opacity')) {
        var opacity = styles.match(/opacity:\s*(\d?\.?\d*)/)[1];
        Element.setOpacity(element, opacity);
      }
      return element;
    }

    for (var property in styles) {
      if (property === 'opacity') {
        Element.setOpacity(element, styles[property]);
      } else {
        var value = styles[property];
        if (property === 'float' || property === 'cssFloat') {
          property = Object.isUndefined(elementStyle.styleFloat) ?
           'cssFloat' : 'styleFloat';
        }
        elementStyle[property] = value;
      }
    }

    return element;
  }


  function getStyle(element, style) {
    element = $(element);
    style = normalizeStyleName(style);

    var value = element.style[style];
    if (!value || value === 'auto') {
      var css = document.defaultView.getComputedStyle(element, null);
      value = css ? css[style] : null;
    }

    if (style === 'opacity') return value ? parseFloat(value) : 1.0;
    return value === 'auto' ? null : value;
  }

  function getStyle_Opera(element, style) {
    switch (style) {
      case 'height': case 'width':
        if (!Element.visible(element)) return null;

        var dim = parseInt(getStyle(element, style), 10);

        if (dim !== element['offset' + style.capitalize()])
          return dim + 'px';

        return Element.measure(element, style);

      default: return getStyle(element, style);
    }
  }

  function getStyle_IE(element, style) {
    element = $(element);
    style = normalizeStyleName_IE(style);

    var value = element.style[style];
    if (!value && element.currentStyle) {
      value = element.currentStyle[style];
    }

    if (style === 'opacity' && !STANDARD_CSS_OPACITY_SUPPORTED)
      return getOpacity_IE(element);

    if (value === 'auto') {
      if ((style === 'width' || style === 'height') && Element.visible(element))
        return Element.measure(element, style) + 'px';
      return null;
    }

    return value;
  }

  function stripAlphaFromFilter_IE(filter) {
    return (filter || '').replace(/alpha\([^\)]*\)/gi, '');
  }

  function hasLayout_IE(element) {
    if (!element.currentStyle || !element.currentStyle.hasLayout)
      element.style.zoom = 1;
    return element;
  }

  var STANDARD_CSS_OPACITY_SUPPORTED = (function() {
    DIV.style.cssText = "opacity:.55";
    return /^0.55/.test(DIV.style.opacity);
  })();

  function setOpacity(element, value) {
    element = $(element);
    if (value == 1 || value === '') value = '';
    else if (value < 0.00001) value = 0;
    element.style.opacity = value;
    return element;
  }

  function setOpacity_IE(element, value) {
    if (STANDARD_CSS_OPACITY_SUPPORTED)
      return setOpacity(element, value);

    element = hasLayout_IE($(element));
    var filter = Element.getStyle(element, 'filter'),
     style = element.style;

    if (value == 1 || value === '') {
      filter = stripAlphaFromFilter_IE(filter);
      if (filter) style.filter = filter;
      else style.removeAttribute('filter');
      return element;
    }

    if (value < 0.00001) value = 0;

    style.filter = stripAlphaFromFilter_IE(filter) +
     'alpha(opacity=' + (value * 100) + ')';

    return element;
  }


  function getOpacity(element) {
    return Element.getStyle(element, 'opacity');
  }

  function getOpacity_IE(element) {
    if (STANDARD_CSS_OPACITY_SUPPORTED)
      return getOpacity(element);

    var filter = Element.getStyle(element, 'filter');
    if (filter.length === 0) return 1.0;
    var match = (filter || '').match(/alpha\(opacity=(.*)\)/);
    if (match && match[1]) return parseFloat(match[1]) / 100;
    return 1.0;
  }


  Object.extend(methods, {
    setStyle:   setStyle,
    getStyle:   getStyle,
    setOpacity: setOpacity,
    getOpacity: getOpacity
  });

  if ('styleFloat' in DIV.style) {
    methods.getStyle = getStyle_IE;
    methods.setOpacity = setOpacity_IE;
    methods.getOpacity = getOpacity_IE;
  }

  var UID = 0;

  GLOBAL.Element.Storage = { UID: 1 };

  function getUniqueElementID(element) {
    if (element === window) return 0;

    if (typeof element._prototypeUID === 'undefined')
      element._prototypeUID = Element.Storage.UID++;
    return element._prototypeUID;
  }

  function getUniqueElementID_IE(element) {
    if (element === window) return 0;
    if (element == document) return 1;
    return element.uniqueID;
  }

  var HAS_UNIQUE_ID_PROPERTY = ('uniqueID' in DIV);
  if (HAS_UNIQUE_ID_PROPERTY)
    getUniqueElementID = getUniqueElementID_IE;

  function getStorage(element) {
    if (!(element = $(element))) return;

    var uid = getUniqueElementID(element);

    if (!Element.Storage[uid])
      Element.Storage[uid] = $H();

    return Element.Storage[uid];
  }

  function store(element, key, value) {
    if (!(element = $(element))) return;
    var storage = getStorage(element);
    if (arguments.length === 2) {
      storage.update(key);
    } else {
      storage.set(key, value);
    }
    return element;
  }

  function retrieve(element, key, defaultValue) {
    if (!(element = $(element))) return;
    var storage = getStorage(element), value = storage.get(key);

    if (Object.isUndefined(value)) {
      storage.set(key, defaultValue);
      value = defaultValue;
    }

    return value;
  }


  Object.extend(methods, {
    getStorage: getStorage,
    store:      store,
    retrieve:   retrieve
  });


  var Methods = {}, ByTag = Element.Methods.ByTag,
   F = Prototype.BrowserFeatures;

  if (!F.ElementExtensions && ('__proto__' in DIV)) {
    GLOBAL.HTMLElement = {};
    GLOBAL.HTMLElement.prototype = DIV['__proto__'];
    F.ElementExtensions = true;
  }

  function checkElementPrototypeDeficiency(tagName) {
    if (typeof window.Element === 'undefined') return false;
    if (!HAS_EXTENDED_CREATE_ELEMENT_SYNTAX) return false;
    var proto = window.Element.prototype;
    if (proto) {
      var id = '_' + (Math.random() + '').slice(2),
       el = document.createElement(tagName);
      proto[id] = 'x';
      var isBuggy = (el[id] !== 'x');
      delete proto[id];
      el = null;
      return isBuggy;
    }

    return false;
  }

  var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY =
   checkElementPrototypeDeficiency('object');

  function extendElementWith(element, methods) {
    for (var property in methods) {
      var value = methods[property];
      if (Object.isFunction(value) && !(property in element))
        element[property] = value.methodize();
    }
  }

  var EXTENDED = {};
  function elementIsExtended(element) {
    var uid = getUniqueElementID(element);
    return (uid in EXTENDED);
  }

  function extend(element) {
    if (!element || elementIsExtended(element)) return element;
    if (element.nodeType !== Node.ELEMENT_NODE || element == window)
      return element;

    var methods = Object.clone(Methods),
     tagName = element.tagName.toUpperCase();

    if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);

    extendElementWith(element, methods);
    EXTENDED[getUniqueElementID(element)] = true;
    return element;
  }

  function extend_IE8(element) {
    if (!element || elementIsExtended(element)) return element;

    var t = element.tagName;
    if (t && (/^(?:object|applet|embed)$/i.test(t))) {
      extendElementWith(element, Element.Methods);
      extendElementWith(element, Element.Methods.Simulated);
      extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);
    }

    return element;
  }

  if (F.SpecificElementExtensions) {
    extend = HTMLOBJECTELEMENT_PROTOTYPE_BUGGY ? extend_IE8 : Prototype.K;
  }

  function addMethodsToTagName(tagName, methods) {
    tagName = tagName.toUpperCase();
    if (!ByTag[tagName]) ByTag[tagName] = {};
    Object.extend(ByTag[tagName], methods);
  }

  function mergeMethods(destination, methods, onlyIfAbsent) {
    if (Object.isUndefined(onlyIfAbsent)) onlyIfAbsent = false;
    for (var property in methods) {
      var value = methods[property];
      if (!Object.isFunction(value)) continue;
      if (!onlyIfAbsent || !(property in destination))
        destination[property] = value.methodize();
    }
  }

  function findDOMClass(tagName) {
    var klass;
    var trans = {
      "OPTGROUP": "OptGroup", "TEXTAREA": "TextArea", "P": "Paragraph",
      "FIELDSET": "FieldSet", "UL": "UList", "OL": "OList", "DL": "DList",
      "DIR": "Directory", "H1": "Heading", "H2": "Heading", "H3": "Heading",
      "H4": "Heading", "H5": "Heading", "H6": "Heading", "Q": "Quote",
      "INS": "Mod", "DEL": "Mod", "A": "Anchor", "IMG": "Image", "CAPTION":
      "TableCaption", "COL": "TableCol", "COLGROUP": "TableCol", "THEAD":
      "TableSection", "TFOOT": "TableSection", "TBODY": "TableSection", "TR":
      "TableRow", "TH": "TableCell", "TD": "TableCell", "FRAMESET":
      "FrameSet", "IFRAME": "IFrame"
    };
    if (trans[tagName]) klass = 'HTML' + trans[tagName] + 'Element';
    if (window[klass]) return window[klass];
    klass = 'HTML' + tagName + 'Element';
    if (window[klass]) return window[klass];
    klass = 'HTML' + tagName.capitalize() + 'Element';
    if (window[klass]) return window[klass];

    var element = document.createElement(tagName),
     proto = element['__proto__'] || element.constructor.prototype;

    element = null;
    return proto;
  }

  function addMethods(methods) {
    if (arguments.length === 0) addFormMethods();

    if (arguments.length === 2) {
      var tagName = methods;
      methods = arguments[1];
    }

    if (!tagName) {
      Object.extend(Element.Methods, methods || {});
    } else {
      if (Object.isArray(tagName)) {
        for (var i = 0, tag; tag = tagName[i]; i++)
          addMethodsToTagName(tag, methods);
      } else {
        addMethodsToTagName(tagName, methods);
      }
    }

    var ELEMENT_PROTOTYPE = window.HTMLElement ? HTMLElement.prototype :
     Element.prototype;

    if (F.ElementExtensions) {
      mergeMethods(ELEMENT_PROTOTYPE, Element.Methods);
      mergeMethods(ELEMENT_PROTOTYPE, Element.Methods.Simulated, true);
    }

    if (F.SpecificElementExtensions) {
      for (var tag in Element.Methods.ByTag) {
        var klass = findDOMClass(tag);
        if (Object.isUndefined(klass)) continue;
        mergeMethods(klass.prototype, ByTag[tag]);
      }
    }

    Object.extend(Element, Element.Methods);
    Object.extend(Element, Element.Methods.Simulated);
    delete Element.ByTag;
    delete Element.Simulated;

    Element.extend.refresh();

    ELEMENT_CACHE = {};
  }

  Object.extend(GLOBAL.Element, {
    extend:     extend,
    addMethods: addMethods
  });

  if (extend === Prototype.K) {
    GLOBAL.Element.extend.refresh = Prototype.emptyFunction;
  } else {
    GLOBAL.Element.extend.refresh = function() {
      if (Prototype.BrowserFeatures.ElementExtensions) return;
      Object.extend(Methods, Element.Methods);
      Object.extend(Methods, Element.Methods.Simulated);

      EXTENDED = {};
    };
  }

  function addFormMethods() {
    Object.extend(Form, Form.Methods);
    Object.extend(Form.Element, Form.Element.Methods);
    Object.extend(Element.Methods.ByTag, {
      "FORM":     Object.clone(Form.Methods),
      "INPUT":    Object.clone(Form.Element.Methods),
      "SELECT":   Object.clone(Form.Element.Methods),
      "TEXTAREA": Object.clone(Form.Element.Methods),
      "BUTTON":   Object.clone(Form.Element.Methods)
    });
  }

  Element.addMethods(methods);

  function destroyCache_IE() {
    DIV = null;
    ELEMENT_CACHE = null;
  }

  if (window.attachEvent)
    window.attachEvent('onunload', destroyCache_IE);

})(this);
(function() {

  function toDecimal(pctString) {
    var match = pctString.match(/^(\d+)%?$/i);
    if (!match) return null;
    return (Number(match[1]) / 100);
  }

  function getRawStyle(element, style) {
    element = $(element);

    var value = element.style[style];
    if (!value || value === 'auto') {
      var css = document.defaultView.getComputedStyle(element, null);
      value = css ? css[style] : null;
    }

    if (style === 'opacity') return value ? parseFloat(value) : 1.0;
    return value === 'auto' ? null : value;
  }

  function getRawStyle_IE(element, style) {
    var value = element.style[style];
    if (!value && element.currentStyle) {
      value = element.currentStyle[style];
    }
    return value;
  }

  function getContentWidth(element, context) {
    var boxWidth = element.offsetWidth;

    var bl = getPixelValue(element, 'borderLeftWidth',  context) || 0;
    var br = getPixelValue(element, 'borderRightWidth', context) || 0;
    var pl = getPixelValue(element, 'paddingLeft',      context) || 0;
    var pr = getPixelValue(element, 'paddingRight',     context) || 0;

    return boxWidth - bl - br - pl - pr;
  }

  if ('currentStyle' in document.documentElement) {
    getRawStyle = getRawStyle_IE;
  }


  function getPixelValue(value, property, context) {
    var element = null;
    if (Object.isElement(value)) {
      element = value;
      value = getRawStyle(element, property);
    }

    if (value === null || Object.isUndefined(value)) {
      return null;
    }

    if ((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)) {
      return window.parseFloat(value);
    }

    var isPercentage = value.include('%'), isViewport = (context === document.viewport);

    if (/\d/.test(value) && element && element.runtimeStyle && !(isPercentage && isViewport)) {
      var style = element.style.left, rStyle = element.runtimeStyle.left;
      element.runtimeStyle.left = element.currentStyle.left;
      element.style.left = value || 0;
      value = element.style.pixelLeft;
      element.style.left = style;
      element.runtimeStyle.left = rStyle;

      return value;
    }

    if (element && isPercentage) {
      context = context || element.parentNode;
      var decimal = toDecimal(value), whole = null;

      var isHorizontal = property.include('left') || property.include('right') ||
       property.include('width');

      var isVertical   = property.include('top') || property.include('bottom') ||
        property.include('height');

      if (context === document.viewport) {
        if (isHorizontal) {
          whole = document.viewport.getWidth();
        } else if (isVertical) {
          whole = document.viewport.getHeight();
        }
      } else {
        if (isHorizontal) {
          whole = $(context).measure('width');
        } else if (isVertical) {
          whole = $(context).measure('height');
        }
      }

      return (whole === null) ? 0 : whole * decimal;
    }

    return 0;
  }

  function toCSSPixels(number) {
    if (Object.isString(number) && number.endsWith('px'))
      return number;
    return number + 'px';
  }

  function isDisplayed(element) {
    while (element && element.parentNode) {
      var display = element.getStyle('display');
      if (display === 'none') {
        return false;
      }
      element = $(element.parentNode);
    }
    return true;
  }

  var hasLayout = Prototype.K;
  if ('currentStyle' in document.documentElement) {
    hasLayout = function(element) {
      if (!element.currentStyle.hasLayout) {
        element.style.zoom = 1;
      }
      return element;
    };
  }

  function cssNameFor(key) {
    if (key.include('border')) key = key + '-width';
    return key.camelize();
  }

  Element.Layout = Class.create(Hash, {
    initialize: function($super, element, preCompute) {
      $super();
      this.element = $(element);

      Element.Layout.PROPERTIES.each( function(property) {
        this._set(property, null);
      }, this);

      if (preCompute) {
        this._preComputing = true;
        this._begin();
        Element.Layout.PROPERTIES.each( this._compute, this );
        this._end();
        this._preComputing = false;
      }
    },

    _set: function(property, value) {
      return Hash.prototype.set.call(this, property, value);
    },

    set: function(property, value) {
      throw "Properties of Element.Layout are read-only.";
    },

    get: function($super, property) {
      var value = $super(property);
      return value === null ? this._compute(property) : value;
    },

    _begin: function() {
      if (this._isPrepared()) return;

      var element = this.element;
      if (isDisplayed(element)) {
        this._setPrepared(true);
        return;
      }


      var originalStyles = {
        position:   element.style.position   || '',
        width:      element.style.width      || '',
        visibility: element.style.visibility || '',
        display:    element.style.display    || ''
      };

      element.store('prototype_original_styles', originalStyles);

      var position = getRawStyle(element, 'position'), width = element.offsetWidth;

      if (width === 0 || width === null) {
        element.style.display = 'block';
        width = element.offsetWidth;
      }

      var context = (position === 'fixed') ? document.viewport :
       element.parentNode;

      var tempStyles = {
        visibility: 'hidden',
        display:    'block'
      };

      if (position !== 'fixed') tempStyles.position = 'absolute';

      element.setStyle(tempStyles);

      var positionedWidth = element.offsetWidth, newWidth;
      if (width && (positionedWidth === width)) {
        newWidth = getContentWidth(element, context);
      } else if (position === 'absolute' || position === 'fixed') {
        newWidth = getContentWidth(element, context);
      } else {
        var parent = element.parentNode, pLayout = $(parent).getLayout();

        newWidth = pLayout.get('width') -
         this.get('margin-left') -
         this.get('border-left') -
         this.get('padding-left') -
         this.get('padding-right') -
         this.get('border-right') -
         this.get('margin-right');
      }

      element.setStyle({ width: newWidth + 'px' });

      this._setPrepared(true);
    },

    _end: function() {
      var element = this.element;
      var originalStyles = element.retrieve('prototype_original_styles');
      element.store('prototype_original_styles', null);
      element.setStyle(originalStyles);
      this._setPrepared(false);
    },

    _compute: function(property) {
      var COMPUTATIONS = Element.Layout.COMPUTATIONS;
      if (!(property in COMPUTATIONS)) {
        throw "Property not found.";
      }

      return this._set(property, COMPUTATIONS[property].call(this, this.element));
    },

    _isPrepared: function() {
      return this.element.retrieve('prototype_element_layout_prepared', false);
    },

    _setPrepared: function(bool) {
      return this.element.store('prototype_element_layout_prepared', bool);
    },

    toObject: function() {
      var args = $A(arguments);
      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
       args.join(' ').split(' ');
      var obj = {};
      keys.each( function(key) {
        if (!Element.Layout.PROPERTIES.include(key)) return;
        var value = this.get(key);
        if (value != null) obj[key] = value;
      }, this);
      return obj;
    },

    toHash: function() {
      var obj = this.toObject.apply(this, arguments);
      return new Hash(obj);
    },

    toCSS: function() {
      var args = $A(arguments);
      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
       args.join(' ').split(' ');
      var css = {};

      keys.each( function(key) {
        if (!Element.Layout.PROPERTIES.include(key)) return;
        if (Element.Layout.COMPOSITE_PROPERTIES.include(key)) return;

        var value = this.get(key);
        if (value != null) css[cssNameFor(key)] = value + 'px';
      }, this);
      return css;
    },

    inspect: function() {
      return "#<Element.Layout>";
    }
  });

  Object.extend(Element.Layout, {
    PROPERTIES: $w('height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height'),

    COMPOSITE_PROPERTIES: $w('padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height'),

    COMPUTATIONS: {
      'height': function(element) {
        if (!this._preComputing) this._begin();

        var bHeight = this.get('border-box-height');
        if (bHeight <= 0) {
          if (!this._preComputing) this._end();
          return 0;
        }

        var bTop = this.get('border-top'),
         bBottom = this.get('border-bottom');

        var pTop = this.get('padding-top'),
         pBottom = this.get('padding-bottom');

        if (!this._preComputing) this._end();

        return bHeight - bTop - bBottom - pTop - pBottom;
      },

      'width': function(element) {
        if (!this._preComputing) this._begin();

        var bWidth = this.get('border-box-width');
        if (bWidth <= 0) {
          if (!this._preComputing) this._end();
          return 0;
        }

        var bLeft = this.get('border-left'),
         bRight = this.get('border-right');

        var pLeft = this.get('padding-left'),
         pRight = this.get('padding-right');

        if (!this._preComputing) this._end();
        return bWidth - bLeft - bRight - pLeft - pRight;
      },

      'padding-box-height': function(element) {
        var height = this.get('height'),
         pTop = this.get('padding-top'),
         pBottom = this.get('padding-bottom');

        return height + pTop + pBottom;
      },

      'padding-box-width': function(element) {
        var width = this.get('width'),
         pLeft = this.get('padding-left'),
         pRight = this.get('padding-right');

        return width + pLeft + pRight;
      },

      'border-box-height': function(element) {
        if (!this._preComputing) this._begin();
        var height = element.offsetHeight;
        if (!this._preComputing) this._end();
        return height;
      },

      'border-box-width': function(element) {
        if (!this._preComputing) this._begin();
        var width = element.offsetWidth;
        if (!this._preComputing) this._end();
        return width;
      },

      'margin-box-height': function(element) {
        var bHeight = this.get('border-box-height'),
         mTop = this.get('margin-top'),
         mBottom = this.get('margin-bottom');

        if (bHeight <= 0) return 0;

        return bHeight + mTop + mBottom;
      },

      'margin-box-width': function(element) {
        var bWidth = this.get('border-box-width'),
         mLeft = this.get('margin-left'),
         mRight = this.get('margin-right');

        if (bWidth <= 0) return 0;

        return bWidth + mLeft + mRight;
      },

      'top': function(element) {
        var offset = element.positionedOffset();
        return offset.top;
      },

      'bottom': function(element) {
        var offset = element.positionedOffset(),
         parent = element.getOffsetParent(),
         pHeight = parent.measure('height');

        var mHeight = this.get('border-box-height');

        return pHeight - mHeight - offset.top;
      },

      'left': function(element) {
        var offset = element.positionedOffset();
        return offset.left;
      },

      'right': function(element) {
        var offset = element.positionedOffset(),
         parent = element.getOffsetParent(),
         pWidth = parent.measure('width');

        var mWidth = this.get('border-box-width');

        return pWidth - mWidth - offset.left;
      },

      'padding-top': function(element) {
        return getPixelValue(element, 'paddingTop');
      },

      'padding-bottom': function(element) {
        return getPixelValue(element, 'paddingBottom');
      },

      'padding-left': function(element) {
        return getPixelValue(element, 'paddingLeft');
      },

      'padding-right': function(element) {
        return getPixelValue(element, 'paddingRight');
      },

      'border-top': function(element) {
        return getPixelValue(element, 'borderTopWidth');
      },

      'border-bottom': function(element) {
        return getPixelValue(element, 'borderBottomWidth');
      },

      'border-left': function(element) {
        return getPixelValue(element, 'borderLeftWidth');
      },

      'border-right': function(element) {
        return getPixelValue(element, 'borderRightWidth');
      },

      'margin-top': function(element) {
        return getPixelValue(element, 'marginTop');
      },

      'margin-bottom': function(element) {
        return getPixelValue(element, 'marginBottom');
      },

      'margin-left': function(element) {
        return getPixelValue(element, 'marginLeft');
      },

      'margin-right': function(element) {
        return getPixelValue(element, 'marginRight');
      }
    }
  });

  if ('getBoundingClientRect' in document.documentElement) {
    Object.extend(Element.Layout.COMPUTATIONS, {
      'right': function(element) {
        var parent = hasLayout(element.getOffsetParent());
        var rect = element.getBoundingClientRect(),
         pRect = parent.getBoundingClientRect();

        return (pRect.right - rect.right).round();
      },

      'bottom': function(element) {
        var parent = hasLayout(element.getOffsetParent());
        var rect = element.getBoundingClientRect(),
         pRect = parent.getBoundingClientRect();

        return (pRect.bottom - rect.bottom).round();
      }
    });
  }

  Element.Offset = Class.create({
    initialize: function(left, top) {
      this.left = left.round();
      this.top  = top.round();

      this[0] = this.left;
      this[1] = this.top;
    },

    relativeTo: function(offset) {
      return new Element.Offset(
        this.left - offset.left,
        this.top  - offset.top
      );
    },

    inspect: function() {
      return "#<Element.Offset left: #{left} top: #{top}>".interpolate(this);
    },

    toString: function() {
      return "[#{left}, #{top}]".interpolate(this);
    },

    toArray: function() {
      return [this.left, this.top];
    }
  });

  function getLayout(element, preCompute) {
    return new Element.Layout(element, preCompute);
  }

  function measure(element, property) {
    return $(element).getLayout().get(property);
  }

  function getHeight(element) {
    return Element.getDimensions(element).height;
  }

  function getWidth(element) {
    return Element.getDimensions(element).width;
  }

  function getDimensions(element) {
    element = $(element);
    var display = Element.getStyle(element, 'display');

    if (display && display !== 'none') {
      return { width: element.offsetWidth, height: element.offsetHeight };
    }

    var style = element.style;
    var originalStyles = {
      visibility: style.visibility,
      position:   style.position,
      display:    style.display
    };

    var newStyles = {
      visibility: 'hidden',
      display:    'block'
    };

    if (originalStyles.position !== 'fixed')
      newStyles.position = 'absolute';

    Element.setStyle(element, newStyles);

    var dimensions = {
      width:  element.offsetWidth,
      height: element.offsetHeight
    };

    Element.setStyle(element, originalStyles);

    return dimensions;
  }

  function getOffsetParent(element) {
    element = $(element);

    if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
      return $(document.body);

    var isInline = (Element.getStyle(element, 'display') === 'inline');
    if (!isInline && element.offsetParent) return $(element.offsetParent);

    while ((element = element.parentNode) && element !== document.body) {
      if (Element.getStyle(element, 'position') !== 'static') {
        return isHtml(element) ? $(document.body) : $(element);
      }
    }

    return $(document.body);
  }


  function cumulativeOffset(element) {
    element = $(element);
    var valueT = 0, valueL = 0;
    if (element.parentNode) {
      do {
        valueT += element.offsetTop  || 0;
        valueL += element.offsetLeft || 0;
        element = element.offsetParent;
      } while (element);
    }
    return new Element.Offset(valueL, valueT);
  }

  function positionedOffset(element) {
    element = $(element);

    var layout = element.getLayout();

    var valueT = 0, valueL = 0;
    do {
      valueT += element.offsetTop  || 0;
      valueL += element.offsetLeft || 0;
      element = element.offsetParent;
      if (element) {
        if (isBody(element)) break;
        var p = Element.getStyle(element, 'position');
        if (p !== 'static') break;
      }
    } while (element);

    valueL -= layout.get('margin-top');
    valueT -= layout.get('margin-left');

    return new Element.Offset(valueL, valueT);
  }

  function cumulativeScrollOffset(element) {
    var valueT = 0, valueL = 0;
    do {
      if (element === document.body) {
        var bodyScrollNode = document.documentElement || document.body.parentNode || document.body;
        valueT += !Object.isUndefined(window.pageYOffset) ? window.pageYOffset : bodyScrollNode.scrollTop || 0;
        valueL += !Object.isUndefined(window.pageXOffset) ? window.pageXOffset : bodyScrollNode.scrollLeft || 0;
        break;
      } else {
        valueT += element.scrollTop  || 0;
        valueL += element.scrollLeft || 0;
        element = element.parentNode;
      }
    } while (element);
    return new Element.Offset(valueL, valueT);
  }

  function viewportOffset(forElement) {
    var valueT = 0, valueL = 0, docBody = document.body;

    forElement = $(forElement);
    var element = forElement;
    do {
      valueT += element.offsetTop  || 0;
      valueL += element.offsetLeft || 0;
      if (element.offsetParent == docBody &&
        Element.getStyle(element, 'position') == 'absolute') break;
    } while (element = element.offsetParent);

    element = forElement;
    do {
      if (element != docBody) {
        valueT -= element.scrollTop  || 0;
        valueL -= element.scrollLeft || 0;
      }
    } while (element = element.parentNode);
    return new Element.Offset(valueL, valueT);
  }

  function absolutize(element) {
    element = $(element);

    if (Element.getStyle(element, 'position') === 'absolute') {
      return element;
    }

    var offsetParent = getOffsetParent(element);
    var eOffset = element.viewportOffset(),
     pOffset = offsetParent.viewportOffset();

    var offset = eOffset.relativeTo(pOffset);
    var layout = element.getLayout();

    element.store('prototype_absolutize_original_styles', {
      position: element.getStyle('position'),
      left:     element.getStyle('left'),
      top:      element.getStyle('top'),
      width:    element.getStyle('width'),
      height:   element.getStyle('height')
    });

    element.setStyle({
      position: 'absolute',
      top:    offset.top + 'px',
      left:   offset.left + 'px',
      width:  layout.get('width') + 'px',
      height: layout.get('height') + 'px'
    });

    return element;
  }

  function relativize(element) {
    element = $(element);
    if (Element.getStyle(element, 'position') === 'relative') {
      return element;
    }

    var originalStyles =
     element.retrieve('prototype_absolutize_original_styles');

    if (originalStyles) element.setStyle(originalStyles);
    return element;
  }


  function scrollTo(element) {
    element = $(element);
    var pos = Element.cumulativeOffset(element);
    window.scrollTo(pos.left, pos.top);
    return element;
  }


  function makePositioned(element) {
    element = $(element);
    var position = Element.getStyle(element, 'position'), styles = {};
    if (position === 'static' || !position) {
      styles.position = 'relative';
      if (Prototype.Browser.Opera) {
        styles.top  = 0;
        styles.left = 0;
      }
      Element.setStyle(element, styles);
      Element.store(element, 'prototype_made_positioned', true);
    }
    return element;
  }

  function undoPositioned(element) {
    element = $(element);
    var storage = Element.getStorage(element),
     madePositioned = storage.get('prototype_made_positioned');

    if (madePositioned) {
      storage.unset('prototype_made_positioned');
      Element.setStyle(element, {
        position: '',
        top:      '',
        bottom:   '',
        left:     '',
        right:    ''
      });
    }
    return element;
  }

  function makeClipping(element) {
    element = $(element);

    var storage = Element.getStorage(element),
     madeClipping = storage.get('prototype_made_clipping');

    if (Object.isUndefined(madeClipping)) {
      var overflow = Element.getStyle(element, 'overflow');
      storage.set('prototype_made_clipping', overflow);
      if (overflow !== 'hidden')
        element.style.overflow = 'hidden';
    }

    return element;
  }

  function undoClipping(element) {
    element = $(element);
    var storage = Element.getStorage(element),
     overflow = storage.get('prototype_made_clipping');

    if (!Object.isUndefined(overflow)) {
      storage.unset('prototype_made_clipping');
      element.style.overflow = overflow || '';
    }

    return element;
  }

  function clonePosition(element, source, options) {
    options = Object.extend({
      setLeft:    true,
      setTop:     true,
      setWidth:   true,
      setHeight:  true,
      offsetTop:  0,
      offsetLeft: 0
    }, options || {});

    source  = $(source);
    element = $(element);
    var p, delta, layout, styles = {};

    if (options.setLeft || options.setTop) {
      p = Element.viewportOffset(source);
      delta = [0, 0];
      if (Element.getStyle(element, 'position') === 'absolute') {
        var parent = Element.getOffsetParent(element);
        if (parent !== document.body) delta = Element.viewportOffset(parent);
      }
    }

    if (options.setWidth || options.setHeight) {
      layout = Element.getLayout(source);
    }

    if (options.setLeft)
      styles.left = (p[0] - delta[0] + options.offsetLeft) + 'px';
    if (options.setTop)
      styles.top  = (p[1] - delta[1] + options.offsetTop)  + 'px';

    if (options.setWidth)
      styles.width  = layout.get('border-box-width')  + 'px';
    if (options.setHeight)
      styles.height = layout.get('border-box-height') + 'px';

    return Element.setStyle(element, styles);
  }


  if (Prototype.Browser.IE) {
    getOffsetParent = getOffsetParent.wrap(
      function(proceed, element) {
        element = $(element);

        if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
          return $(document.body);

        var position = element.getStyle('position');
        if (position !== 'static') return proceed(element);

        element.setStyle({ position: 'relative' });
        var value = proceed(element);
        element.setStyle({ position: position });
        return value;
      }
    );

    positionedOffset = positionedOffset.wrap(function(proceed, element) {
      element = $(element);
      if (!element.parentNode) return new Element.Offset(0, 0);
      var position = element.getStyle('position');
      if (position !== 'static') return proceed(element);

      var offsetParent = element.getOffsetParent();
      if (offsetParent && offsetParent.getStyle('position') === 'fixed')
        hasLayout(offsetParent);

      element.setStyle({ position: 'relative' });
      var value = proceed(element);
      element.setStyle({ position: position });
      return value;
    });
  } else if (Prototype.Browser.Webkit) {
    cumulativeOffset = function(element) {
      element = $(element);
      var valueT = 0, valueL = 0;
      do {
        valueT += element.offsetTop  || 0;
        valueL += element.offsetLeft || 0;
        if (element.offsetParent == document.body) {
          if (Element.getStyle(element, 'position') == 'absolute') break;
        }

        element = element.offsetParent;
      } while (element);

      return new Element.Offset(valueL, valueT);
    };
  }


  Element.addMethods({
    getLayout:              getLayout,
    measure:                measure,
    getWidth:               getWidth,
    getHeight:              getHeight,
    getDimensions:          getDimensions,
    getOffsetParent:        getOffsetParent,
    cumulativeOffset:       cumulativeOffset,
    positionedOffset:       positionedOffset,
    cumulativeScrollOffset: cumulativeScrollOffset,
    viewportOffset:         viewportOffset,
    absolutize:             absolutize,
    relativize:             relativize,
    scrollTo:               scrollTo,
    makePositioned:         makePositioned,
    undoPositioned:         undoPositioned,
    makeClipping:           makeClipping,
    undoClipping:           undoClipping,
    clonePosition:          clonePosition
  });

  function isBody(element) {
    return element.nodeName.toUpperCase() === 'BODY';
  }

  function isHtml(element) {
    return element.nodeName.toUpperCase() === 'HTML';
  }

  function isDocument(element) {
    return element.nodeType === Node.DOCUMENT_NODE;
  }

  function isDetached(element) {
    return element !== document.body &&
     !Element.descendantOf(element, document.body);
  }

  if ('getBoundingClientRect' in document.documentElement) {
    Element.addMethods({
      viewportOffset: function(element) {
        element = $(element);
        if (isDetached(element)) return new Element.Offset(0, 0);

        var rect = element.getBoundingClientRect(),
         docEl = document.documentElement;
        return new Element.Offset(rect.left - docEl.clientLeft,
         rect.top - docEl.clientTop);
      }
    });
  }


})();

(function() {

  var IS_OLD_OPERA = Prototype.Browser.Opera &&
   (window.parseFloat(window.opera.version()) < 9.5);
  var ROOT = null;
  function getRootElement() {
    if (ROOT) return ROOT;
    ROOT = IS_OLD_OPERA ? document.body : document.documentElement;
    return ROOT;
  }

  function getDimensions() {
    return { width: this.getWidth(), height: this.getHeight() };
  }

  function getWidth() {
    return getRootElement().clientWidth;
  }

  function getHeight() {
    return getRootElement().clientHeight;
  }

  function getScrollOffsets() {
    var x = window.pageXOffset || document.documentElement.scrollLeft ||
     document.body.scrollLeft;
    var y = window.pageYOffset || document.documentElement.scrollTop ||
     document.body.scrollTop;

    return new Element.Offset(x, y);
  }

  document.viewport = {
    getDimensions:    getDimensions,
    getWidth:         getWidth,
    getHeight:        getHeight,
    getScrollOffsets: getScrollOffsets
  };

})();
window.$$ = function() {
  var expression = $A(arguments).join(', ');
  return Prototype.Selector.select(expression, document);
};

Prototype.Selector = (function() {

  function select() {
    throw new Error('Method "Prototype.Selector.select" must be defined.');
  }

  function match() {
    throw new Error('Method "Prototype.Selector.match" must be defined.');
  }

  function find(elements, expression, index) {
    index = index || 0;
    var match = Prototype.Selector.match, length = elements.length, matchIndex = 0, i;

    for (i = 0; i < length; i++) {
      if (match(elements[i], expression) && index == matchIndex++) {
        return Element.extend(elements[i]);
      }
    }
  }

  function extendElements(elements) {
    for (var i = 0, length = elements.length; i < length; i++) {
      Element.extend(elements[i]);
    }
    return elements;
  }


  var K = Prototype.K;

  return {
    select: select,
    match: match,
    find: find,
    extendElements: (Element.extend === K) ? K : extendElements,
    extendElement: Element.extend
  };
})();
Prototype._original_property = window.Sizzle;
/*!
 * Sizzle CSS Selector Engine v@VERSION
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: @DATE
 */
(function( window ) {

var i,
	support,
	Expr,
	getText,
	isXML,
	compile,
	select,
	outermostContext,
	sortInput,
	hasDuplicate,

	setDocument,
	document,
	docElem,
	documentIsHTML,
	rbuggyQSA,
	rbuggyMatches,
	matches,
	contains,

	expando = "sizzle" + -(new Date()),
	preferredDoc = window.document,
	dirruns = 0,
	done = 0,
	classCache = createCache(),
	tokenCache = createCache(),
	compilerCache = createCache(),
	sortOrder = function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
		}
		return 0;
	},

	strundefined = typeof undefined,
	MAX_NEGATIVE = 1 << 31,

	hasOwn = ({}).hasOwnProperty,
	arr = [],
	pop = arr.pop,
	push_native = arr.push,
	push = arr.push,
	slice = arr.slice,
	indexOf = arr.indexOf || function( elem ) {
		var i = 0,
			len = this.length;
		for ( ; i < len; i++ ) {
			if ( this[i] === elem ) {
				return i;
			}
		}
		return -1;
	},

	booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",


	whitespace = "[\\x20\\t\\r\\n\\f]",
	characterEncoding = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",

	identifier = characterEncoding.replace( "w", "w#" ),

	attributes = "\\[" + whitespace + "*(" + characterEncoding + ")" + whitespace +
		"*(?:([*^$|!~]?=)" + whitespace + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + identifier + ")|)|)" + whitespace + "*\\]",

	pseudos = ":(" + characterEncoding + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + attributes.replace( 3, 8 ) + ")*)|.*)\\)|)",

	rtrim = new RegExp( "^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g" ),

	rcomma = new RegExp( "^" + whitespace + "*," + whitespace + "*" ),
	rcombinators = new RegExp( "^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*" ),

	rattributeQuotes = new RegExp( "=" + whitespace + "*([^\\]'\"]*?)" + whitespace + "*\\]", "g" ),

	rpseudo = new RegExp( pseudos ),
	ridentifier = new RegExp( "^" + identifier + "$" ),

	matchExpr = {
		"ID": new RegExp( "^#(" + characterEncoding + ")" ),
		"CLASS": new RegExp( "^\\.(" + characterEncoding + ")" ),
		"TAG": new RegExp( "^(" + characterEncoding.replace( "w", "w*" ) + ")" ),
		"ATTR": new RegExp( "^" + attributes ),
		"PSEUDO": new RegExp( "^" + pseudos ),
		"CHILD": new RegExp( "^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace +
			"*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
			"*(\\d+)|))" + whitespace + "*\\)|)", "i" ),
		"bool": new RegExp( "^(?:" + booleans + ")$", "i" ),
		"needsContext": new RegExp( "^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" +
			whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)", "i" )
	},

	rinputs = /^(?:input|select|textarea|button)$/i,
	rheader = /^h\d$/i,

	rnative = /^[^{]+\{\s*\[native \w/,

	rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,

	rsibling = /[+~]/,
	rescape = /'|\\/g,

	runescape = new RegExp( "\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)", "ig" ),
	funescape = function( _, escaped, escapedWhitespace ) {
		var high = "0x" + escaped - 0x10000;
		return high !== high || escapedWhitespace ?
			escaped :
			high < 0 ?
				String.fromCharCode( high + 0x10000 ) :
				String.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );
	};

try {
	push.apply(
		(arr = slice.call( preferredDoc.childNodes )),
		preferredDoc.childNodes
	);
	arr[ preferredDoc.childNodes.length ].nodeType;
} catch ( e ) {
	push = { apply: arr.length ?

		function( target, els ) {
			push_native.apply( target, slice.call(els) );
		} :

		function( target, els ) {
			var j = target.length,
				i = 0;
			while ( (target[j++] = els[i++]) ) {}
			target.length = j - 1;
		}
	};
}

function Sizzle( selector, context, results, seed ) {
	var match, elem, m, nodeType,
		i, groups, old, nid, newContext, newSelector;

	if ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {
		setDocument( context );
	}

	context = context || document;
	results = results || [];

	if ( !selector || typeof selector !== "string" ) {
		return results;
	}

	if ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {
		return [];
	}

	if ( documentIsHTML && !seed ) {

		if ( (match = rquickExpr.exec( selector )) ) {
			if ( (m = match[1]) ) {
				if ( nodeType === 9 ) {
					elem = context.getElementById( m );
					if ( elem && elem.parentNode ) {
						if ( elem.id === m ) {
							results.push( elem );
							return results;
						}
					} else {
						return results;
					}
				} else {
					if ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&
						contains( context, elem ) && elem.id === m ) {
						results.push( elem );
						return results;
					}
				}

			} else if ( match[2] ) {
				push.apply( results, context.getElementsByTagName( selector ) );
				return results;

			} else if ( (m = match[3]) && support.getElementsByClassName && context.getElementsByClassName ) {
				push.apply( results, context.getElementsByClassName( m ) );
				return results;
			}
		}

		if ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {
			nid = old = expando;
			newContext = context;
			newSelector = nodeType === 9 && selector;

			if ( nodeType === 1 && context.nodeName.toLowerCase() !== "object" ) {
				groups = tokenize( selector );

				if ( (old = context.getAttribute("id")) ) {
					nid = old.replace( rescape, "\\$&" );
				} else {
					context.setAttribute( "id", nid );
				}
				nid = "[id='" + nid + "'] ";

				i = groups.length;
				while ( i-- ) {
					groups[i] = nid + toSelector( groups[i] );
				}
				newContext = rsibling.test( selector ) && testContext( context.parentNode ) || context;
				newSelector = groups.join(",");
			}

			if ( newSelector ) {
				try {
					push.apply( results,
						newContext.querySelectorAll( newSelector )
					);
					return results;
				} catch(qsaError) {
				} finally {
					if ( !old ) {
						context.removeAttribute("id");
					}
				}
			}
		}
	}

	return select( selector.replace( rtrim, "$1" ), context, results, seed );
}

/**
 * Create key-value caches of limited size
 * @returns {Function(string, Object)} Returns the Object data after storing it on itself with
 *	property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
 *	deleting the oldest entry
 */
function createCache() {
	var keys = [];

	function cache( key, value ) {
		if ( keys.push( key + " " ) > Expr.cacheLength ) {
			delete cache[ keys.shift() ];
		}
		return (cache[ key + " " ] = value);
	}
	return cache;
}

/**
 * Mark a function for special use by Sizzle
 * @param {Function} fn The function to mark
 */
function markFunction( fn ) {
	fn[ expando ] = true;
	return fn;
}

/**
 * Support testing using an element
 * @param {Function} fn Passed the created div and expects a boolean result
 */
function assert( fn ) {
	var div = document.createElement("div");

	try {
		return !!fn( div );
	} catch (e) {
		return false;
	} finally {
		if ( div.parentNode ) {
			div.parentNode.removeChild( div );
		}
		div = null;
	}
}

/**
 * Adds the same handler for all of the specified attrs
 * @param {String} attrs Pipe-separated list of attributes
 * @param {Function} handler The method that will be applied
 */
function addHandle( attrs, handler ) {
	var arr = attrs.split("|"),
		i = attrs.length;

	while ( i-- ) {
		Expr.attrHandle[ arr[i] ] = handler;
	}
}

/**
 * Checks document order of two siblings
 * @param {Element} a
 * @param {Element} b
 * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
 */
function siblingCheck( a, b ) {
	var cur = b && a,
		diff = cur && a.nodeType === 1 && b.nodeType === 1 &&
			( ~b.sourceIndex || MAX_NEGATIVE ) -
			( ~a.sourceIndex || MAX_NEGATIVE );

	if ( diff ) {
		return diff;
	}

	if ( cur ) {
		while ( (cur = cur.nextSibling) ) {
			if ( cur === b ) {
				return -1;
			}
		}
	}

	return a ? 1 : -1;
}

/**
 * Returns a function to use in pseudos for input types
 * @param {String} type
 */
function createInputPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return name === "input" && elem.type === type;
	};
}

/**
 * Returns a function to use in pseudos for buttons
 * @param {String} type
 */
function createButtonPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return (name === "input" || name === "button") && elem.type === type;
	};
}

/**
 * Returns a function to use in pseudos for positionals
 * @param {Function} fn
 */
function createPositionalPseudo( fn ) {
	return markFunction(function( argument ) {
		argument = +argument;
		return markFunction(function( seed, matches ) {
			var j,
				matchIndexes = fn( [], seed.length, argument ),
				i = matchIndexes.length;

			while ( i-- ) {
				if ( seed[ (j = matchIndexes[i]) ] ) {
					seed[j] = !(matches[j] = seed[j]);
				}
			}
		});
	});
}

/**
 * Checks a node for validity as a Sizzle context
 * @param {Element|Object=} context
 * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value
 */
function testContext( context ) {
	return context && typeof context.getElementsByTagName !== strundefined && context;
}

support = Sizzle.support = {};

/**
 * Detects XML nodes
 * @param {Element|Object} elem An element or a document
 * @returns {Boolean} True iff elem is a non-HTML XML node
 */
isXML = Sizzle.isXML = function( elem ) {
	var documentElement = elem && (elem.ownerDocument || elem).documentElement;
	return documentElement ? documentElement.nodeName !== "HTML" : false;
};

/**
 * Sets document-related variables once based on the current document
 * @param {Element|Object} [doc] An element or document object to use to set the document
 * @returns {Object} Returns the current document
 */
setDocument = Sizzle.setDocument = function( node ) {
	var hasCompare,
		doc = node ? node.ownerDocument || node : preferredDoc,
		parent = doc.defaultView;

	if ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {
		return document;
	}

	document = doc;
	docElem = doc.documentElement;

	documentIsHTML = !isXML( doc );

	if ( parent && parent !== parent.top ) {
		if ( parent.addEventListener ) {
			parent.addEventListener( "unload", function() {
				setDocument();
			}, false );
		} else if ( parent.attachEvent ) {
			parent.attachEvent( "onunload", function() {
				setDocument();
			});
		}
	}

	/* Attributes
	---------------------------------------------------------------------- */

	support.attributes = assert(function( div ) {
		div.className = "i";
		return !div.getAttribute("className");
	});

	/* getElement(s)By*
	---------------------------------------------------------------------- */

	support.getElementsByTagName = assert(function( div ) {
		div.appendChild( doc.createComment("") );
		return !div.getElementsByTagName("*").length;
	});

	support.getElementsByClassName = rnative.test( doc.getElementsByClassName ) && assert(function( div ) {
		div.innerHTML = "<div class='a'></div><div class='a i'></div>";

		div.firstChild.className = "i";
		return div.getElementsByClassName("i").length === 2;
	});

	support.getById = assert(function( div ) {
		docElem.appendChild( div ).id = expando;
		return !doc.getElementsByName || !doc.getElementsByName( expando ).length;
	});

	if ( support.getById ) {
		Expr.find["ID"] = function( id, context ) {
			if ( typeof context.getElementById !== strundefined && documentIsHTML ) {
				var m = context.getElementById( id );
				return m && m.parentNode ? [m] : [];
			}
		};
		Expr.filter["ID"] = function( id ) {
			var attrId = id.replace( runescape, funescape );
			return function( elem ) {
				return elem.getAttribute("id") === attrId;
			};
		};
	} else {
		delete Expr.find["ID"];

		Expr.filter["ID"] =  function( id ) {
			var attrId = id.replace( runescape, funescape );
			return function( elem ) {
				var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode("id");
				return node && node.value === attrId;
			};
		};
	}

	Expr.find["TAG"] = support.getElementsByTagName ?
		function( tag, context ) {
			if ( typeof context.getElementsByTagName !== strundefined ) {
				return context.getElementsByTagName( tag );
			}
		} :
		function( tag, context ) {
			var elem,
				tmp = [],
				i = 0,
				results = context.getElementsByTagName( tag );

			if ( tag === "*" ) {
				while ( (elem = results[i++]) ) {
					if ( elem.nodeType === 1 ) {
						tmp.push( elem );
					}
				}

				return tmp;
			}
			return results;
		};

	Expr.find["CLASS"] = support.getElementsByClassName && function( className, context ) {
		if ( typeof context.getElementsByClassName !== strundefined && documentIsHTML ) {
			return context.getElementsByClassName( className );
		}
	};

	/* QSA/matchesSelector
	---------------------------------------------------------------------- */


	rbuggyMatches = [];

	rbuggyQSA = [];

	if ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {
		assert(function( div ) {
			div.innerHTML = "<select t=''><option selected=''></option></select>";

			if ( div.querySelectorAll("[t^='']").length ) {
				rbuggyQSA.push( "[*^$]=" + whitespace + "*(?:''|\"\")" );
			}

			if ( !div.querySelectorAll("[selected]").length ) {
				rbuggyQSA.push( "\\[" + whitespace + "*(?:value|" + booleans + ")" );
			}

			if ( !div.querySelectorAll(":checked").length ) {
				rbuggyQSA.push(":checked");
			}
		});

		assert(function( div ) {
			var input = doc.createElement("input");
			input.setAttribute( "type", "hidden" );
			div.appendChild( input ).setAttribute( "name", "D" );

			if ( div.querySelectorAll("[name=d]").length ) {
				rbuggyQSA.push( "name" + whitespace + "*[*^$|!~]?=" );
			}

			if ( !div.querySelectorAll(":enabled").length ) {
				rbuggyQSA.push( ":enabled", ":disabled" );
			}

			div.querySelectorAll("*,:x");
			rbuggyQSA.push(",.*:");
		});
	}

	if ( (support.matchesSelector = rnative.test( (matches = docElem.webkitMatchesSelector ||
		docElem.mozMatchesSelector ||
		docElem.oMatchesSelector ||
		docElem.msMatchesSelector) )) ) {

		assert(function( div ) {
			support.disconnectedMatch = matches.call( div, "div" );

			matches.call( div, "[s!='']:x" );
			rbuggyMatches.push( "!=", pseudos );
		});
	}

	rbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join("|") );
	rbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join("|") );

	/* Contains
	---------------------------------------------------------------------- */
	hasCompare = rnative.test( docElem.compareDocumentPosition );

	contains = hasCompare || rnative.test( docElem.contains ) ?
		function( a, b ) {
			var adown = a.nodeType === 9 ? a.documentElement : a,
				bup = b && b.parentNode;
			return a === bup || !!( bup && bup.nodeType === 1 && (
				adown.contains ?
					adown.contains( bup ) :
					a.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16
			));
		} :
		function( a, b ) {
			if ( b ) {
				while ( (b = b.parentNode) ) {
					if ( b === a ) {
						return true;
					}
				}
			}
			return false;
		};

	/* Sorting
	---------------------------------------------------------------------- */

	sortOrder = hasCompare ?
	function( a, b ) {

		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
		if ( compare ) {
			return compare;
		}

		compare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?
			a.compareDocumentPosition( b ) :

			1;

		if ( compare & 1 ||
			(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {

			if ( a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {
				return -1;
			}
			if ( b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {
				return 1;
			}

			return sortInput ?
				( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :
				0;
		}

		return compare & 4 ? -1 : 1;
	} :
	function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		var cur,
			i = 0,
			aup = a.parentNode,
			bup = b.parentNode,
			ap = [ a ],
			bp = [ b ];

		if ( !aup || !bup ) {
			return a === doc ? -1 :
				b === doc ? 1 :
				aup ? -1 :
				bup ? 1 :
				sortInput ?
				( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :
				0;

		} else if ( aup === bup ) {
			return siblingCheck( a, b );
		}

		cur = a;
		while ( (cur = cur.parentNode) ) {
			ap.unshift( cur );
		}
		cur = b;
		while ( (cur = cur.parentNode) ) {
			bp.unshift( cur );
		}

		while ( ap[i] === bp[i] ) {
			i++;
		}

		return i ?
			siblingCheck( ap[i], bp[i] ) :

			ap[i] === preferredDoc ? -1 :
			bp[i] === preferredDoc ? 1 :
			0;
	};

	return doc;
};

Sizzle.matches = function( expr, elements ) {
	return Sizzle( expr, null, null, elements );
};

Sizzle.matchesSelector = function( elem, expr ) {
	if ( ( elem.ownerDocument || elem ) !== document ) {
		setDocument( elem );
	}

	expr = expr.replace( rattributeQuotes, "='$1']" );

	if ( support.matchesSelector && documentIsHTML &&
		( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&
		( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {

		try {
			var ret = matches.call( elem, expr );

			if ( ret || support.disconnectedMatch ||
					elem.document && elem.document.nodeType !== 11 ) {
				return ret;
			}
		} catch(e) {}
	}

	return Sizzle( expr, document, null, [elem] ).length > 0;
};

Sizzle.contains = function( context, elem ) {
	if ( ( context.ownerDocument || context ) !== document ) {
		setDocument( context );
	}
	return contains( context, elem );
};

Sizzle.attr = function( elem, name ) {
	if ( ( elem.ownerDocument || elem ) !== document ) {
		setDocument( elem );
	}

	var fn = Expr.attrHandle[ name.toLowerCase() ],
		val = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?
			fn( elem, name, !documentIsHTML ) :
			undefined;

	return val !== undefined ?
		val :
		support.attributes || !documentIsHTML ?
			elem.getAttribute( name ) :
			(val = elem.getAttributeNode(name)) && val.specified ?
				val.value :
				null;
};

Sizzle.error = function( msg ) {
	throw new Error( "Syntax error, unrecognized expression: " + msg );
};

/**
 * Document sorting and removing duplicates
 * @param {ArrayLike} results
 */
Sizzle.uniqueSort = function( results ) {
	var elem,
		duplicates = [],
		j = 0,
		i = 0;

	hasDuplicate = !support.detectDuplicates;
	sortInput = !support.sortStable && results.slice( 0 );
	results.sort( sortOrder );

	if ( hasDuplicate ) {
		while ( (elem = results[i++]) ) {
			if ( elem === results[ i ] ) {
				j = duplicates.push( i );
			}
		}
		while ( j-- ) {
			results.splice( duplicates[ j ], 1 );
		}
	}

	sortInput = null;

	return results;
};

/**
 * Utility function for retrieving the text value of an array of DOM nodes
 * @param {Array|Element} elem
 */
getText = Sizzle.getText = function( elem ) {
	var node,
		ret = "",
		i = 0,
		nodeType = elem.nodeType;

	if ( !nodeType ) {
		while ( (node = elem[i++]) ) {
			ret += getText( node );
		}
	} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
		if ( typeof elem.textContent === "string" ) {
			return elem.textContent;
		} else {
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				ret += getText( elem );
			}
		}
	} else if ( nodeType === 3 || nodeType === 4 ) {
		return elem.nodeValue;
	}

	return ret;
};

Expr = Sizzle.selectors = {

	cacheLength: 50,

	createPseudo: markFunction,

	match: matchExpr,

	attrHandle: {},

	find: {},

	relative: {
		">": { dir: "parentNode", first: true },
		" ": { dir: "parentNode" },
		"+": { dir: "previousSibling", first: true },
		"~": { dir: "previousSibling" }
	},

	preFilter: {
		"ATTR": function( match ) {
			match[1] = match[1].replace( runescape, funescape );

			match[3] = ( match[4] || match[5] || "" ).replace( runescape, funescape );

			if ( match[2] === "~=" ) {
				match[3] = " " + match[3] + " ";
			}

			return match.slice( 0, 4 );
		},

		"CHILD": function( match ) {
			/* matches from matchExpr["CHILD"]
				1 type (only|nth|...)
				2 what (child|of-type)
				3 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
				4 xn-component of xn+y argument ([+-]?\d*n|)
				5 sign of xn-component
				6 x of xn-component
				7 sign of y-component
				8 y of y-component
			*/
			match[1] = match[1].toLowerCase();

			if ( match[1].slice( 0, 3 ) === "nth" ) {
				if ( !match[3] ) {
					Sizzle.error( match[0] );
				}

				match[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === "even" || match[3] === "odd" ) );
				match[5] = +( ( match[7] + match[8] ) || match[3] === "odd" );

			} else if ( match[3] ) {
				Sizzle.error( match[0] );
			}

			return match;
		},

		"PSEUDO": function( match ) {
			var excess,
				unquoted = !match[5] && match[2];

			if ( matchExpr["CHILD"].test( match[0] ) ) {
				return null;
			}

			if ( match[3] && match[4] !== undefined ) {
				match[2] = match[4];

			} else if ( unquoted && rpseudo.test( unquoted ) &&
				(excess = tokenize( unquoted, true )) &&
				(excess = unquoted.indexOf( ")", unquoted.length - excess ) - unquoted.length) ) {

				match[0] = match[0].slice( 0, excess );
				match[2] = unquoted.slice( 0, excess );
			}

			return match.slice( 0, 3 );
		}
	},

	filter: {

		"TAG": function( nodeNameSelector ) {
			var nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();
			return nodeNameSelector === "*" ?
				function() { return true; } :
				function( elem ) {
					return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
				};
		},

		"CLASS": function( className ) {
			var pattern = classCache[ className + " " ];

			return pattern ||
				(pattern = new RegExp( "(^|" + whitespace + ")" + className + "(" + whitespace + "|$)" )) &&
				classCache( className, function( elem ) {
					return pattern.test( typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute("class") || "" );
				});
		},

		"ATTR": function( name, operator, check ) {
			return function( elem ) {
				var result = Sizzle.attr( elem, name );

				if ( result == null ) {
					return operator === "!=";
				}
				if ( !operator ) {
					return true;
				}

				result += "";

				return operator === "=" ? result === check :
					operator === "!=" ? result !== check :
					operator === "^=" ? check && result.indexOf( check ) === 0 :
					operator === "*=" ? check && result.indexOf( check ) > -1 :
					operator === "$=" ? check && result.slice( -check.length ) === check :
					operator === "~=" ? ( " " + result + " " ).indexOf( check ) > -1 :
					operator === "|=" ? result === check || result.slice( 0, check.length + 1 ) === check + "-" :
					false;
			};
		},

		"CHILD": function( type, what, argument, first, last ) {
			var simple = type.slice( 0, 3 ) !== "nth",
				forward = type.slice( -4 ) !== "last",
				ofType = what === "of-type";

			return first === 1 && last === 0 ?

				function( elem ) {
					return !!elem.parentNode;
				} :

				function( elem, context, xml ) {
					var cache, outerCache, node, diff, nodeIndex, start,
						dir = simple !== forward ? "nextSibling" : "previousSibling",
						parent = elem.parentNode,
						name = ofType && elem.nodeName.toLowerCase(),
						useCache = !xml && !ofType;

					if ( parent ) {

						if ( simple ) {
							while ( dir ) {
								node = elem;
								while ( (node = node[ dir ]) ) {
									if ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {
										return false;
									}
								}
								start = dir = type === "only" && !start && "nextSibling";
							}
							return true;
						}

						start = [ forward ? parent.firstChild : parent.lastChild ];

						if ( forward && useCache ) {
							outerCache = parent[ expando ] || (parent[ expando ] = {});
							cache = outerCache[ type ] || [];
							nodeIndex = cache[0] === dirruns && cache[1];
							diff = cache[0] === dirruns && cache[2];
							node = nodeIndex && parent.childNodes[ nodeIndex ];

							while ( (node = ++nodeIndex && node && node[ dir ] ||

								(diff = nodeIndex = 0) || start.pop()) ) {

								if ( node.nodeType === 1 && ++diff && node === elem ) {
									outerCache[ type ] = [ dirruns, nodeIndex, diff ];
									break;
								}
							}

						} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {
							diff = cache[1];

						} else {
							while ( (node = ++nodeIndex && node && node[ dir ] ||
								(diff = nodeIndex = 0) || start.pop()) ) {

								if ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {
									if ( useCache ) {
										(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];
									}

									if ( node === elem ) {
										break;
									}
								}
							}
						}

						diff -= last;
						return diff === first || ( diff % first === 0 && diff / first >= 0 );
					}
				};
		},

		"PSEUDO": function( pseudo, argument ) {
			var args,
				fn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||
					Sizzle.error( "unsupported pseudo: " + pseudo );

			if ( fn[ expando ] ) {
				return fn( argument );
			}

			if ( fn.length > 1 ) {
				args = [ pseudo, pseudo, "", argument ];
				return Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?
					markFunction(function( seed, matches ) {
						var idx,
							matched = fn( seed, argument ),
							i = matched.length;
						while ( i-- ) {
							idx = indexOf.call( seed, matched[i] );
							seed[ idx ] = !( matches[ idx ] = matched[i] );
						}
					}) :
					function( elem ) {
						return fn( elem, 0, args );
					};
			}

			return fn;
		}
	},

	pseudos: {
		"not": markFunction(function( selector ) {
			var input = [],
				results = [],
				matcher = compile( selector.replace( rtrim, "$1" ) );

			return matcher[ expando ] ?
				markFunction(function( seed, matches, context, xml ) {
					var elem,
						unmatched = matcher( seed, null, xml, [] ),
						i = seed.length;

					while ( i-- ) {
						if ( (elem = unmatched[i]) ) {
							seed[i] = !(matches[i] = elem);
						}
					}
				}) :
				function( elem, context, xml ) {
					input[0] = elem;
					matcher( input, null, xml, results );
					return !results.pop();
				};
		}),

		"has": markFunction(function( selector ) {
			return function( elem ) {
				return Sizzle( selector, elem ).length > 0;
			};
		}),

		"contains": markFunction(function( text ) {
			return function( elem ) {
				return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;
			};
		}),

		"lang": markFunction( function( lang ) {
			if ( !ridentifier.test(lang || "") ) {
				Sizzle.error( "unsupported lang: " + lang );
			}
			lang = lang.replace( runescape, funescape ).toLowerCase();
			return function( elem ) {
				var elemLang;
				do {
					if ( (elemLang = documentIsHTML ?
						elem.lang :
						elem.getAttribute("xml:lang") || elem.getAttribute("lang")) ) {

						elemLang = elemLang.toLowerCase();
						return elemLang === lang || elemLang.indexOf( lang + "-" ) === 0;
					}
				} while ( (elem = elem.parentNode) && elem.nodeType === 1 );
				return false;
			};
		}),

		"target": function( elem ) {
			var hash = window.location && window.location.hash;
			return hash && hash.slice( 1 ) === elem.id;
		},

		"root": function( elem ) {
			return elem === docElem;
		},

		"focus": function( elem ) {
			return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
		},

		"enabled": function( elem ) {
			return elem.disabled === false;
		},

		"disabled": function( elem ) {
			return elem.disabled === true;
		},

		"checked": function( elem ) {
			var nodeName = elem.nodeName.toLowerCase();
			return (nodeName === "input" && !!elem.checked) || (nodeName === "option" && !!elem.selected);
		},

		"selected": function( elem ) {
			if ( elem.parentNode ) {
				elem.parentNode.selectedIndex;
			}

			return elem.selected === true;
		},

		"empty": function( elem ) {
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				if ( elem.nodeType < 6 ) {
					return false;
				}
			}
			return true;
		},

		"parent": function( elem ) {
			return !Expr.pseudos["empty"]( elem );
		},

		"header": function( elem ) {
			return rheader.test( elem.nodeName );
		},

		"input": function( elem ) {
			return rinputs.test( elem.nodeName );
		},

		"button": function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return name === "input" && elem.type === "button" || name === "button";
		},

		"text": function( elem ) {
			var attr;
			return elem.nodeName.toLowerCase() === "input" &&
				elem.type === "text" &&

				( (attr = elem.getAttribute("type")) == null || attr.toLowerCase() === "text" );
		},

		"first": createPositionalPseudo(function() {
			return [ 0 ];
		}),

		"last": createPositionalPseudo(function( matchIndexes, length ) {
			return [ length - 1 ];
		}),

		"eq": createPositionalPseudo(function( matchIndexes, length, argument ) {
			return [ argument < 0 ? argument + length : argument ];
		}),

		"even": createPositionalPseudo(function( matchIndexes, length ) {
			var i = 0;
			for ( ; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"odd": createPositionalPseudo(function( matchIndexes, length ) {
			var i = 1;
			for ( ; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"lt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			var i = argument < 0 ? argument + length : argument;
			for ( ; --i >= 0; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"gt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			var i = argument < 0 ? argument + length : argument;
			for ( ; ++i < length; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		})
	}
};

Expr.pseudos["nth"] = Expr.pseudos["eq"];

for ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {
	Expr.pseudos[ i ] = createInputPseudo( i );
}
for ( i in { submit: true, reset: true } ) {
	Expr.pseudos[ i ] = createButtonPseudo( i );
}

function setFilters() {}
setFilters.prototype = Expr.filters = Expr.pseudos;
Expr.setFilters = new setFilters();

function tokenize( selector, parseOnly ) {
	var matched, match, tokens, type,
		soFar, groups, preFilters,
		cached = tokenCache[ selector + " " ];

	if ( cached ) {
		return parseOnly ? 0 : cached.slice( 0 );
	}

	soFar = selector;
	groups = [];
	preFilters = Expr.preFilter;

	while ( soFar ) {

		if ( !matched || (match = rcomma.exec( soFar )) ) {
			if ( match ) {
				soFar = soFar.slice( match[0].length ) || soFar;
			}
			groups.push( (tokens = []) );
		}

		matched = false;

		if ( (match = rcombinators.exec( soFar )) ) {
			matched = match.shift();
			tokens.push({
				value: matched,
				type: match[0].replace( rtrim, " " )
			});
			soFar = soFar.slice( matched.length );
		}

		for ( type in Expr.filter ) {
			if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||
				(match = preFilters[ type ]( match ))) ) {
				matched = match.shift();
				tokens.push({
					value: matched,
					type: type,
					matches: match
				});
				soFar = soFar.slice( matched.length );
			}
		}

		if ( !matched ) {
			break;
		}
	}

	return parseOnly ?
		soFar.length :
		soFar ?
			Sizzle.error( selector ) :
			tokenCache( selector, groups ).slice( 0 );
}

function toSelector( tokens ) {
	var i = 0,
		len = tokens.length,
		selector = "";
	for ( ; i < len; i++ ) {
		selector += tokens[i].value;
	}
	return selector;
}

function addCombinator( matcher, combinator, base ) {
	var dir = combinator.dir,
		checkNonElements = base && dir === "parentNode",
		doneName = done++;

	return combinator.first ?
		function( elem, context, xml ) {
			while ( (elem = elem[ dir ]) ) {
				if ( elem.nodeType === 1 || checkNonElements ) {
					return matcher( elem, context, xml );
				}
			}
		} :

		function( elem, context, xml ) {
			var oldCache, outerCache,
				newCache = [ dirruns, doneName ];

			if ( xml ) {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						if ( matcher( elem, context, xml ) ) {
							return true;
						}
					}
				}
			} else {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						outerCache = elem[ expando ] || (elem[ expando ] = {});
						if ( (oldCache = outerCache[ dir ]) &&
							oldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {

							return (newCache[ 2 ] = oldCache[ 2 ]);
						} else {
							outerCache[ dir ] = newCache;

							if ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {
								return true;
							}
						}
					}
				}
			}
		};
}

function elementMatcher( matchers ) {
	return matchers.length > 1 ?
		function( elem, context, xml ) {
			var i = matchers.length;
			while ( i-- ) {
				if ( !matchers[i]( elem, context, xml ) ) {
					return false;
				}
			}
			return true;
		} :
		matchers[0];
}

function multipleContexts( selector, contexts, results ) {
	var i = 0,
		len = contexts.length;
	for ( ; i < len; i++ ) {
		Sizzle( selector, contexts[i], results );
	}
	return results;
}

function condense( unmatched, map, filter, context, xml ) {
	var elem,
		newUnmatched = [],
		i = 0,
		len = unmatched.length,
		mapped = map != null;

	for ( ; i < len; i++ ) {
		if ( (elem = unmatched[i]) ) {
			if ( !filter || filter( elem, context, xml ) ) {
				newUnmatched.push( elem );
				if ( mapped ) {
					map.push( i );
				}
			}
		}
	}

	return newUnmatched;
}

function setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {
	if ( postFilter && !postFilter[ expando ] ) {
		postFilter = setMatcher( postFilter );
	}
	if ( postFinder && !postFinder[ expando ] ) {
		postFinder = setMatcher( postFinder, postSelector );
	}
	return markFunction(function( seed, results, context, xml ) {
		var temp, i, elem,
			preMap = [],
			postMap = [],
			preexisting = results.length,

			elems = seed || multipleContexts( selector || "*", context.nodeType ? [ context ] : context, [] ),

			matcherIn = preFilter && ( seed || !selector ) ?
				condense( elems, preMap, preFilter, context, xml ) :
				elems,

			matcherOut = matcher ?
				postFinder || ( seed ? preFilter : preexisting || postFilter ) ?

					[] :

					results :
				matcherIn;

		if ( matcher ) {
			matcher( matcherIn, matcherOut, context, xml );
		}

		if ( postFilter ) {
			temp = condense( matcherOut, postMap );
			postFilter( temp, [], context, xml );

			i = temp.length;
			while ( i-- ) {
				if ( (elem = temp[i]) ) {
					matcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);
				}
			}
		}

		if ( seed ) {
			if ( postFinder || preFilter ) {
				if ( postFinder ) {
					temp = [];
					i = matcherOut.length;
					while ( i-- ) {
						if ( (elem = matcherOut[i]) ) {
							temp.push( (matcherIn[i] = elem) );
						}
					}
					postFinder( null, (matcherOut = []), temp, xml );
				}

				i = matcherOut.length;
				while ( i-- ) {
					if ( (elem = matcherOut[i]) &&
						(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {

						seed[temp] = !(results[temp] = elem);
					}
				}
			}

		} else {
			matcherOut = condense(
				matcherOut === results ?
					matcherOut.splice( preexisting, matcherOut.length ) :
					matcherOut
			);
			if ( postFinder ) {
				postFinder( null, results, matcherOut, xml );
			} else {
				push.apply( results, matcherOut );
			}
		}
	});
}

function matcherFromTokens( tokens ) {
	var checkContext, matcher, j,
		len = tokens.length,
		leadingRelative = Expr.relative[ tokens[0].type ],
		implicitRelative = leadingRelative || Expr.relative[" "],
		i = leadingRelative ? 1 : 0,

		matchContext = addCombinator( function( elem ) {
			return elem === checkContext;
		}, implicitRelative, true ),
		matchAnyContext = addCombinator( function( elem ) {
			return indexOf.call( checkContext, elem ) > -1;
		}, implicitRelative, true ),
		matchers = [ function( elem, context, xml ) {
			return ( !leadingRelative && ( xml || context !== outermostContext ) ) || (
				(checkContext = context).nodeType ?
					matchContext( elem, context, xml ) :
					matchAnyContext( elem, context, xml ) );
		} ];

	for ( ; i < len; i++ ) {
		if ( (matcher = Expr.relative[ tokens[i].type ]) ) {
			matchers = [ addCombinator(elementMatcher( matchers ), matcher) ];
		} else {
			matcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );

			if ( matcher[ expando ] ) {
				j = ++i;
				for ( ; j < len; j++ ) {
					if ( Expr.relative[ tokens[j].type ] ) {
						break;
					}
				}
				return setMatcher(
					i > 1 && elementMatcher( matchers ),
					i > 1 && toSelector(
						tokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === " " ? "*" : "" })
					).replace( rtrim, "$1" ),
					matcher,
					i < j && matcherFromTokens( tokens.slice( i, j ) ),
					j < len && matcherFromTokens( (tokens = tokens.slice( j )) ),
					j < len && toSelector( tokens )
				);
			}
			matchers.push( matcher );
		}
	}

	return elementMatcher( matchers );
}

function matcherFromGroupMatchers( elementMatchers, setMatchers ) {
	var bySet = setMatchers.length > 0,
		byElement = elementMatchers.length > 0,
		superMatcher = function( seed, context, xml, results, outermost ) {
			var elem, j, matcher,
				matchedCount = 0,
				i = "0",
				unmatched = seed && [],
				setMatched = [],
				contextBackup = outermostContext,
				elems = seed || byElement && Expr.find["TAG"]( "*", outermost ),
				dirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),
				len = elems.length;

			if ( outermost ) {
				outermostContext = context !== document && context;
			}

			for ( ; i !== len && (elem = elems[i]) != null; i++ ) {
				if ( byElement && elem ) {
					j = 0;
					while ( (matcher = elementMatchers[j++]) ) {
						if ( matcher( elem, context, xml ) ) {
							results.push( elem );
							break;
						}
					}
					if ( outermost ) {
						dirruns = dirrunsUnique;
					}
				}

				if ( bySet ) {
					if ( (elem = !matcher && elem) ) {
						matchedCount--;
					}

					if ( seed ) {
						unmatched.push( elem );
					}
				}
			}

			matchedCount += i;
			if ( bySet && i !== matchedCount ) {
				j = 0;
				while ( (matcher = setMatchers[j++]) ) {
					matcher( unmatched, setMatched, context, xml );
				}

				if ( seed ) {
					if ( matchedCount > 0 ) {
						while ( i-- ) {
							if ( !(unmatched[i] || setMatched[i]) ) {
								setMatched[i] = pop.call( results );
							}
						}
					}

					setMatched = condense( setMatched );
				}

				push.apply( results, setMatched );

				if ( outermost && !seed && setMatched.length > 0 &&
					( matchedCount + setMatchers.length ) > 1 ) {

					Sizzle.uniqueSort( results );
				}
			}

			if ( outermost ) {
				dirruns = dirrunsUnique;
				outermostContext = contextBackup;
			}

			return unmatched;
		};

	return bySet ?
		markFunction( superMatcher ) :
		superMatcher;
}

compile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {
	var i,
		setMatchers = [],
		elementMatchers = [],
		cached = compilerCache[ selector + " " ];

	if ( !cached ) {
		if ( !match ) {
			match = tokenize( selector );
		}
		i = match.length;
		while ( i-- ) {
			cached = matcherFromTokens( match[i] );
			if ( cached[ expando ] ) {
				setMatchers.push( cached );
			} else {
				elementMatchers.push( cached );
			}
		}

		cached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );

		cached.selector = selector;
	}
	return cached;
};

/**
 * A low-level selection function that works with Sizzle's compiled
 *  selector functions
 * @param {String|Function} selector A selector or a pre-compiled
 *  selector function built with Sizzle.compile
 * @param {Element} context
 * @param {Array} [results]
 * @param {Array} [seed] A set of elements to match against
 */
select = Sizzle.select = function( selector, context, results, seed ) {
	var i, tokens, token, type, find,
		compiled = typeof selector === "function" && selector,
		match = !seed && tokenize( (selector = compiled.selector || selector) );

	results = results || [];

	if ( match.length === 1 ) {

		tokens = match[0] = match[0].slice( 0 );
		if ( tokens.length > 2 && (token = tokens[0]).type === "ID" &&
				support.getById && context.nodeType === 9 && documentIsHTML &&
				Expr.relative[ tokens[1].type ] ) {

			context = ( Expr.find["ID"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];
			if ( !context ) {
				return results;

			} else if ( compiled ) {
				context = context.parentNode;
			}

			selector = selector.slice( tokens.shift().value.length );
		}

		i = matchExpr["needsContext"].test( selector ) ? 0 : tokens.length;
		while ( i-- ) {
			token = tokens[i];

			if ( Expr.relative[ (type = token.type) ] ) {
				break;
			}
			if ( (find = Expr.find[ type ]) ) {
				if ( (seed = find(
					token.matches[0].replace( runescape, funescape ),
					rsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context
				)) ) {

					tokens.splice( i, 1 );
					selector = seed.length && toSelector( tokens );
					if ( !selector ) {
						push.apply( results, seed );
						return results;
					}

					break;
				}
			}
		}
	}

	( compiled || compile( selector, match ) )(
		seed,
		context,
		!documentIsHTML,
		results,
		rsibling.test( selector ) && testContext( context.parentNode ) || context
	);
	return results;
};


support.sortStable = expando.split("").sort( sortOrder ).join("") === expando;

support.detectDuplicates = !!hasDuplicate;

setDocument();

support.sortDetached = assert(function( div1 ) {
	return div1.compareDocumentPosition( document.createElement("div") ) & 1;
});

if ( !assert(function( div ) {
	div.innerHTML = "<a href='#'></a>";
	return div.firstChild.getAttribute("href") === "#" ;
}) ) {
	addHandle( "type|href|height|width", function( elem, name, isXML ) {
		if ( !isXML ) {
			return elem.getAttribute( name, name.toLowerCase() === "type" ? 1 : 2 );
		}
	});
}

if ( !support.attributes || !assert(function( div ) {
	div.innerHTML = "<input/>";
	div.firstChild.setAttribute( "value", "" );
	return div.firstChild.getAttribute( "value" ) === "";
}) ) {
	addHandle( "value", function( elem, name, isXML ) {
		if ( !isXML && elem.nodeName.toLowerCase() === "input" ) {
			return elem.defaultValue;
		}
	});
}

if ( !assert(function( div ) {
	return div.getAttribute("disabled") == null;
}) ) {
	addHandle( booleans, function( elem, name, isXML ) {
		var val;
		if ( !isXML ) {
			return elem[ name ] === true ? name.toLowerCase() :
					(val = elem.getAttributeNode( name )) && val.specified ?
					val.value :
				null;
		}
	});
}

if ( typeof define === "function" && define.amd ) {
	define(function() { return Sizzle; });
} else if ( typeof module !== "undefined" && module.exports ) {
	module.exports = Sizzle;
} else {
	window.Sizzle = Sizzle;
}

})( window );

;(function(engine) {
  var extendElements = Prototype.Selector.extendElements;

  function select(selector, scope) {
    return extendElements(engine(selector, scope || document));
  }

  function match(element, selector) {
    return engine.matches(selector, [element]).length == 1;
  }

  Prototype.Selector.engine = engine;
  Prototype.Selector.select = select;
  Prototype.Selector.match = match;
})(Sizzle);

window.Sizzle = Prototype._original_property;
delete Prototype._original_property;

var Form = {
  reset: function(form) {
    form = $(form);
    form.reset();
    return form;
  },

  serializeElements: function(elements, options) {
    if (typeof options != 'object') options = { hash: !!options };
    else if (Object.isUndefined(options.hash)) options.hash = true;
    var key, value, submitted = false, submit = options.submit, accumulator, initial;

    if (options.hash) {
      initial = {};
      accumulator = function(result, key, value) {
        if (key in result) {
          if (!Object.isArray(result[key])) result[key] = [result[key]];
          result[key] = result[key].concat(value);
        } else result[key] = value;
        return result;
      };
    } else {
      initial = '';
      accumulator = function(result, key, values) {
        if (!Object.isArray(values)) {values = [values];}
        if (!values.length) {return result;}
        var encodedKey = encodeURIComponent(key).gsub(/%20/, '+');
        return result + (result ? "&" : "") + values.map(function (value) {
          value = value.gsub(/(\r)?\n/, '\r\n');
          value = encodeURIComponent(value);
          value = value.gsub(/%20/, '+');
          return encodedKey + "=" + value;
        }).join("&");
      };
    }

    return elements.inject(initial, function(result, element) {
      if (!element.disabled && element.name) {
        key = element.name; value = $(element).getValue();
        if (value != null && element.type != 'file' && (element.type != 'submit' || (!submitted &&
            submit !== false && (!submit || key == submit) && (submitted = true)))) {
          result = accumulator(result, key, value);
        }
      }
      return result;
    });
  }
};

Form.Methods = {
  serialize: function(form, options) {
    return Form.serializeElements(Form.getElements(form), options);
  },


  getElements: function(form) {
    var elements = $(form).getElementsByTagName('*');
    var element, results = [], serializers = Form.Element.Serializers;

    for (var i = 0; element = elements[i]; i++) {
      if (serializers[element.tagName.toLowerCase()])
        results.push(Element.extend(element));
    }
    return results;
  },

  getInputs: function(form, typeName, name) {
    form = $(form);
    var inputs = form.getElementsByTagName('input');

    if (!typeName && !name) return $A(inputs).map(Element.extend);

    for (var i = 0, matchingInputs = [], length = inputs.length; i < length; i++) {
      var input = inputs[i];
      if ((typeName && input.type != typeName) || (name && input.name != name))
        continue;
      matchingInputs.push(Element.extend(input));
    }

    return matchingInputs;
  },

  disable: function(form) {
    form = $(form);
    Form.getElements(form).invoke('disable');
    return form;
  },

  enable: function(form) {
    form = $(form);
    Form.getElements(form).invoke('enable');
    return form;
  },

  findFirstElement: function(form) {
    var elements = $(form).getElements().findAll(function(element) {
      return 'hidden' != element.type && !element.disabled;
    });
    var firstByIndex = elements.findAll(function(element) {
      return element.hasAttribute('tabIndex') && element.tabIndex >= 0;
    }).sortBy(function(element) { return element.tabIndex }).first();

    return firstByIndex ? firstByIndex : elements.find(function(element) {
      return /^(?:input|select|textarea)$/i.test(element.tagName);
    });
  },

  focusFirstElement: function(form) {
    form = $(form);
    var element = form.findFirstElement();
    if (element) element.activate();
    return form;
  },

  request: function(form, options) {
    form = $(form), options = Object.clone(options || { });

    var params = options.parameters, action = form.readAttribute('action') || '';
    if (action.blank()) action = window.location.href;
    options.parameters = form.serialize(true);

    if (params) {
      if (Object.isString(params)) params = params.toQueryParams();
      Object.extend(options.parameters, params);
    }

    if (form.hasAttribute('method') && !options.method)
      options.method = form.method;

    return new Ajax.Request(action, options);
  }
};

/*--------------------------------------------------------------------------*/


Form.Element = {
  focus: function(element) {
    $(element).focus();
    return element;
  },

  select: function(element) {
    $(element).select();
    return element;
  }
};

Form.Element.Methods = {

  serialize: function(element) {
    element = $(element);
    if (!element.disabled && element.name) {
      var value = element.getValue();
      if (value != undefined) {
        var pair = { };
        pair[element.name] = value;
        return Object.toQueryString(pair);
      }
    }
    return '';
  },

  getValue: function(element) {
    element = $(element);
    var method = element.tagName.toLowerCase();
    return Form.Element.Serializers[method](element);
  },

  setValue: function(element, value) {
    element = $(element);
    var method = element.tagName.toLowerCase();
    Form.Element.Serializers[method](element, value);
    return element;
  },

  clear: function(element) {
    $(element).value = '';
    return element;
  },

  present: function(element) {
    return $(element).value != '';
  },

  activate: function(element) {
    element = $(element);
    try {
      element.focus();
      if (element.select && (element.tagName.toLowerCase() != 'input' ||
          !(/^(?:button|reset|submit)$/i.test(element.type))))
        element.select();
    } catch (e) { }
    return element;
  },

  disable: function(element) {
    element = $(element);
    element.disabled = true;
    return element;
  },

  enable: function(element) {
    element = $(element);
    element.disabled = false;
    return element;
  }
};

/*--------------------------------------------------------------------------*/

var Field = Form.Element;

var $F = Form.Element.Methods.getValue;

/*--------------------------------------------------------------------------*/

Form.Element.Serializers = (function() {
  function input(element, value) {
    switch (element.type.toLowerCase()) {
      case 'checkbox':
      case 'radio':
        return inputSelector(element, value);
      default:
        return valueSelector(element, value);
    }
  }

  function inputSelector(element, value) {
    if (Object.isUndefined(value))
      return element.checked ? element.value : null;
    else element.checked = !!value;
  }

  function valueSelector(element, value) {
    if (Object.isUndefined(value)) return element.value;
    else element.value = value;
  }

  function select(element, value) {
    if (Object.isUndefined(value))
      return (element.type === 'select-one' ? selectOne : selectMany)(element);

    var opt, currentValue, single = !Object.isArray(value);
    for (var i = 0, length = element.length; i < length; i++) {
      opt = element.options[i];
      currentValue = this.optionValue(opt);
      if (single) {
        if (currentValue == value) {
          opt.selected = true;
          return;
        }
      }
      else opt.selected = value.include(currentValue);
    }
  }

  function selectOne(element) {
    var index = element.selectedIndex;
    return index >= 0 ? optionValue(element.options[index]) : null;
  }

  function selectMany(element) {
    var values, length = element.length;
    if (!length) return null;

    for (var i = 0, values = []; i < length; i++) {
      var opt = element.options[i];
      if (opt.selected) values.push(optionValue(opt));
    }
    return values;
  }

  function optionValue(opt) {
    return Element.hasAttribute(opt, 'value') ? opt.value : opt.text;
  }

  return {
    input:         input,
    inputSelector: inputSelector,
    textarea:      valueSelector,
    select:        select,
    selectOne:     selectOne,
    selectMany:    selectMany,
    optionValue:   optionValue,
    button:        valueSelector
  };
})();

/*--------------------------------------------------------------------------*/


Abstract.TimedObserver = Class.create(PeriodicalExecuter, {
  initialize: function($super, element, frequency, callback) {
    $super(callback, frequency);
    this.element   = $(element);
    this.lastValue = this.getValue();
  },

  execute: function() {
    var value = this.getValue();
    if (Object.isString(this.lastValue) && Object.isString(value) ?
        this.lastValue != value : String(this.lastValue) != String(value)) {
      this.callback(this.element, value);
      this.lastValue = value;
    }
  }
});

Form.Element.Observer = Class.create(Abstract.TimedObserver, {
  getValue: function() {
    return Form.Element.getValue(this.element);
  }
});

Form.Observer = Class.create(Abstract.TimedObserver, {
  getValue: function() {
    return Form.serialize(this.element);
  }
});

/*--------------------------------------------------------------------------*/

Abstract.EventObserver = Class.create({
  initialize: function(element, callback) {
    this.element  = $(element);
    this.callback = callback;

    this.lastValue = this.getValue();
    if (this.element.tagName.toLowerCase() == 'form')
      this.registerFormCallbacks();
    else
      this.registerCallback(this.element);
  },

  onElementEvent: function() {
    var value = this.getValue();
    if (this.lastValue != value) {
      this.callback(this.element, value);
      this.lastValue = value;
    }
  },

  registerFormCallbacks: function() {
    Form.getElements(this.element).each(this.registerCallback, this);
  },

  registerCallback: function(element) {
    if (element.type) {
      switch (element.type.toLowerCase()) {
        case 'checkbox':
        case 'radio':
          Event.observe(element, 'click', this.onElementEvent.bind(this));
          break;
        default:
          Event.observe(element, 'change', this.onElementEvent.bind(this));
          break;
      }
    }
  }
});

Form.Element.EventObserver = Class.create(Abstract.EventObserver, {
  getValue: function() {
    return Form.Element.getValue(this.element);
  }
});

Form.EventObserver = Class.create(Abstract.EventObserver, {
  getValue: function() {
    return Form.serialize(this.element);
  }
});
(function(GLOBAL) {
  var DIV = document.createElement('div');
  var docEl = document.documentElement;
  var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
   && 'onmouseleave' in docEl;

  var Event = {
    KEY_BACKSPACE: 8,
    KEY_TAB:       9,
    KEY_RETURN:   13,
    KEY_ESC:      27,
    KEY_LEFT:     37,
    KEY_UP:       38,
    KEY_RIGHT:    39,
    KEY_DOWN:     40,
    KEY_DELETE:   46,
    KEY_HOME:     36,
    KEY_END:      35,
    KEY_PAGEUP:   33,
    KEY_PAGEDOWN: 34,
    KEY_INSERT:   45
  };


  var isIELegacyEvent = function(event) { return false; };

  if (window.attachEvent) {
    if (window.addEventListener) {
      isIELegacyEvent = function(event) {
        return !(event instanceof window.Event);
      };
    } else {
      isIELegacyEvent = function(event) { return true; };
    }
  }

  var _isButton;

  function _isButtonForDOMEvents(event, code) {
    return event.which ? (event.which === code + 1) : (event.button === code);
  }

  var legacyButtonMap = { 0: 1, 1: 4, 2: 2 };
  function _isButtonForLegacyEvents(event, code) {
    return event.button === legacyButtonMap[code];
  }

  function _isButtonForWebKit(event, code) {
    switch (code) {
      case 0: return event.which == 1 && !event.metaKey;
      case 1: return event.which == 2 || (event.which == 1 && event.metaKey);
      case 2: return event.which == 3;
      default: return false;
    }
  }

  if (window.attachEvent) {
    if (!window.addEventListener) {
      _isButton = _isButtonForLegacyEvents;
    } else {
      _isButton = function(event, code) {
        return isIELegacyEvent(event) ? _isButtonForLegacyEvents(event, code) :
         _isButtonForDOMEvents(event, code);
      }
    }
  } else if (Prototype.Browser.WebKit) {
    _isButton = _isButtonForWebKit;
  } else {
    _isButton = _isButtonForDOMEvents;
  }

  function isLeftClick(event)   { return _isButton(event, 0) }

  function isMiddleClick(event) { return _isButton(event, 1) }

  function isRightClick(event)  { return _isButton(event, 2) }

  function element(event) {
    return Element.extend(_element(event));
  }

  function _element(event) {
    event = Event.extend(event);

    var node = event.target, type = event.type,
     currentTarget = event.currentTarget;

    if (currentTarget && currentTarget.tagName) {
      if (type === 'load' || type === 'error' ||
        (type === 'click' && currentTarget.tagName.toLowerCase() === 'input'
          && currentTarget.type === 'radio'))
            node = currentTarget;
    }

    return node.nodeType == Node.TEXT_NODE ? node.parentNode : node;
  }

  function findElement(event, expression) {
    var element = _element(event), selector = Prototype.Selector;
    if (!expression) return Element.extend(element);
    while (element) {
      if (Object.isElement(element) && selector.match(element, expression))
        return Element.extend(element);
      element = element.parentNode;
    }
  }

  function pointer(event) {
    return { x: pointerX(event), y: pointerY(event) };
  }

  function pointerX(event) {
    var docElement = document.documentElement,
     body = document.body || { scrollLeft: 0 };

    return event.pageX || (event.clientX +
      (docElement.scrollLeft || body.scrollLeft) -
      (docElement.clientLeft || 0));
  }

  function pointerY(event) {
    var docElement = document.documentElement,
     body = document.body || { scrollTop: 0 };

    return  event.pageY || (event.clientY +
       (docElement.scrollTop || body.scrollTop) -
       (docElement.clientTop || 0));
  }


  function stop(event) {
    Event.extend(event);
    event.preventDefault();
    event.stopPropagation();

    event.stopped = true;
  }


  Event.Methods = {
    isLeftClick:   isLeftClick,
    isMiddleClick: isMiddleClick,
    isRightClick:  isRightClick,

    element:     element,
    findElement: findElement,

    pointer:  pointer,
    pointerX: pointerX,
    pointerY: pointerY,

    stop: stop
  };

  var methods = Object.keys(Event.Methods).inject({ }, function(m, name) {
    m[name] = Event.Methods[name].methodize();
    return m;
  });

  if (window.attachEvent) {
    function _relatedTarget(event) {
      var element;
      switch (event.type) {
        case 'mouseover':
        case 'mouseenter':
          element = event.fromElement;
          break;
        case 'mouseout':
        case 'mouseleave':
          element = event.toElement;
          break;
        default:
          return null;
      }
      return Element.extend(element);
    }

    var additionalMethods = {
      stopPropagation: function() { this.cancelBubble = true },
      preventDefault:  function() { this.returnValue = false },
      inspect: function() { return '[object Event]' }
    };

    Event.extend = function(event, element) {
      if (!event) return false;

      if (!isIELegacyEvent(event)) return event;

      if (event._extendedByPrototype) return event;
      event._extendedByPrototype = Prototype.emptyFunction;

      var pointer = Event.pointer(event);

      Object.extend(event, {
        target: event.srcElement || element,
        relatedTarget: _relatedTarget(event),
        pageX:  pointer.x,
        pageY:  pointer.y
      });

      Object.extend(event, methods);
      Object.extend(event, additionalMethods);

      return event;
    };
  } else {
    Event.extend = Prototype.K;
  }

  if (window.addEventListener) {
    Event.prototype = window.Event.prototype || document.createEvent('HTMLEvents').__proto__;
    Object.extend(Event.prototype, methods);
  }

  var EVENT_TRANSLATIONS = {
    mouseenter: 'mouseover',
    mouseleave: 'mouseout'
  };

  function getDOMEventName(eventName) {
    return EVENT_TRANSLATIONS[eventName] || eventName;
  }

  if (MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED)
    getDOMEventName = Prototype.K;

  function getUniqueElementID(element) {
    if (element === window) return 0;

    if (typeof element._prototypeUID === 'undefined')
      element._prototypeUID = Element.Storage.UID++;
    return element._prototypeUID;
  }

  function getUniqueElementID_IE(element) {
    if (element === window) return 0;
    if (element == document) return 1;
    return element.uniqueID;
  }

  if ('uniqueID' in DIV)
    getUniqueElementID = getUniqueElementID_IE;

  function isCustomEvent(eventName) {
    return eventName.include(':');
  }

  Event._isCustomEvent = isCustomEvent;

  function getRegistryForElement(element, uid) {
    var CACHE = GLOBAL.Event.cache;
    if (Object.isUndefined(uid))
      uid = getUniqueElementID(element);
    if (!CACHE[uid]) CACHE[uid] = { element: element };
    return CACHE[uid];
  }

  function destroyRegistryForElement(element, uid) {
    if (Object.isUndefined(uid))
      uid = getUniqueElementID(element);
    delete GLOBAL.Event.cache[uid];
  }


  function register(element, eventName, handler) {
    var registry = getRegistryForElement(element);
    if (!registry[eventName]) registry[eventName] = [];
    var entries = registry[eventName];

    var i = entries.length;
    while (i--)
      if (entries[i].handler === handler) return null;

    var uid = getUniqueElementID(element);
    var responder = GLOBAL.Event._createResponder(uid, eventName, handler);
    var entry = {
      responder: responder,
      handler:   handler
    };

    entries.push(entry);
    return entry;
  }

  function unregister(element, eventName, handler) {
    var registry = getRegistryForElement(element);
    var entries = registry[eventName];
    if (!entries) return;

    var i = entries.length, entry;
    while (i--) {
      if (entries[i].handler === handler) {
        entry = entries[i];
        break;
      }
    }

    if (!entry) return;

    var index = entries.indexOf(entry);
    entries.splice(index, 1);

    return entry;
  }


  function observe(element, eventName, handler) {
    element = $(element);
    var entry = register(element, eventName, handler);

    if (entry === null) return element;

    var responder = entry.responder;
    if (isCustomEvent(eventName))
      observeCustomEvent(element, eventName, responder);
    else
      observeStandardEvent(element, eventName, responder);

    return element;
  }

  function observeStandardEvent(element, eventName, responder) {
    var actualEventName = getDOMEventName(eventName);
    if (element.addEventListener) {
      element.addEventListener(actualEventName, responder, false);
    } else {
      element.attachEvent('on' + actualEventName, responder);
    }
  }

  function observeCustomEvent(element, eventName, responder) {
    if (element.addEventListener) {
      element.addEventListener('dataavailable', responder, false);
    } else {
      element.attachEvent('ondataavailable', responder);
      element.attachEvent('onlosecapture',   responder);
    }
  }

  function stopObserving(element, eventName, handler) {
    element = $(element);
    var handlerGiven = !Object.isUndefined(handler),
     eventNameGiven = !Object.isUndefined(eventName);

    if (!eventNameGiven && !handlerGiven) {
      stopObservingElement(element);
      return element;
    }

    if (!handlerGiven) {
      stopObservingEventName(element, eventName);
      return element;
    }

    var entry = unregister(element, eventName, handler);

    if (!entry) return element;
    removeEvent(element, eventName, entry.responder);
    return element;
  }

  function stopObservingStandardEvent(element, eventName, responder) {
    var actualEventName = getDOMEventName(eventName);
    if (element.removeEventListener) {
      element.removeEventListener(actualEventName, responder, false);
    } else {
      element.detachEvent('on' + actualEventName, responder);
    }
  }

  function stopObservingCustomEvent(element, eventName, responder) {
    if (element.removeEventListener) {
      element.removeEventListener('dataavailable', responder, false);
    } else {
      element.detachEvent('ondataavailable', responder);
      element.detachEvent('onlosecapture',   responder);
    }
  }



  function stopObservingElement(element) {
    var uid = getUniqueElementID(element), registry = GLOBAL.Event.cache[uid];
    if (!registry) return;

    destroyRegistryForElement(element, uid);

    var entries, i;
    for (var eventName in registry) {
      if (eventName === 'element') continue;

      entries = registry[eventName];
      i = entries.length;
      while (i--)
        removeEvent(element, eventName, entries[i].responder);
    }
  }

  function stopObservingEventName(element, eventName) {
    var registry = getRegistryForElement(element);
    var entries = registry[eventName];
    if (!entries) return;
    delete registry[eventName];

    var i = entries.length;
    while (i--)
      removeEvent(element, eventName, entries[i].responder);
  }


  function removeEvent(element, eventName, handler) {
    if (isCustomEvent(eventName))
      stopObservingCustomEvent(element, eventName, handler);
    else
      stopObservingStandardEvent(element, eventName, handler);
  }



  function getFireTarget(element) {
    if (element !== document) return element;
    if (document.createEvent && !element.dispatchEvent)
      return document.documentElement;
    return element;
  }

  function fire(element, eventName, memo, bubble) {
    element = getFireTarget($(element));
    if (Object.isUndefined(bubble)) bubble = true;
    memo = memo || {};

    var event = fireEvent(element, eventName, memo, bubble);
    return Event.extend(event);
  }

  function fireEvent_DOM(element, eventName, memo, bubble) {
    var event = document.createEvent('HTMLEvents');
    event.initEvent('dataavailable', bubble, true);

    event.eventName = eventName;
    event.memo = memo;

    element.dispatchEvent(event);
    return event;
  }

  function fireEvent_IE(element, eventName, memo, bubble) {
    var event = document.createEventObject();
    event.eventType = bubble ? 'ondataavailable' : 'onlosecapture';

    event.eventName = eventName;
    event.memo = memo;

    element.fireEvent(event.eventType, event);
    return event;
  }

  var fireEvent = document.createEvent ? fireEvent_DOM : fireEvent_IE;



  Event.Handler = Class.create({
    initialize: function(element, eventName, selector, callback) {
      this.element   = $(element);
      this.eventName = eventName;
      this.selector  = selector;
      this.callback  = callback;
      this.handler   = this.handleEvent.bind(this);
    },


    start: function() {
      Event.observe(this.element, this.eventName, this.handler);
      return this;
    },

    stop: function() {
      Event.stopObserving(this.element, this.eventName, this.handler);
      return this;
    },

    handleEvent: function(event) {
      var element = Event.findElement(event, this.selector);
      if (element) this.callback.call(this.element, event, element);
    }
  });

  function on(element, eventName, selector, callback) {
    element = $(element);
    if (Object.isFunction(selector) && Object.isUndefined(callback)) {
      callback = selector, selector = null;
    }

    return new Event.Handler(element, eventName, selector, callback).start();
  }

  Object.extend(Event, Event.Methods);

  Object.extend(Event, {
    fire:          fire,
    observe:       observe,
    stopObserving: stopObserving,
    on:            on
  });

  Element.addMethods({
    fire:          fire,

    observe:       observe,

    stopObserving: stopObserving,

    on:            on
  });

  Object.extend(document, {
    fire:          fire.methodize(),

    observe:       observe.methodize(),

    stopObserving: stopObserving.methodize(),

    on:            on.methodize(),

    loaded:        false
  });

  if (GLOBAL.Event) Object.extend(window.Event, Event);
  else GLOBAL.Event = Event;

  GLOBAL.Event.cache = {};

  function destroyCache_IE() {
    GLOBAL.Event.cache = null;
  }

  if (window.attachEvent)
    window.attachEvent('onunload', destroyCache_IE);

  DIV = null;
  docEl = null;
})(this);

(function(GLOBAL) {
  /* Code for creating leak-free event responders is based on work by
   John-David Dalton. */

  var docEl = document.documentElement;
  var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
    && 'onmouseleave' in docEl;

  function isSimulatedMouseEnterLeaveEvent(eventName) {
    return !MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &&
     (eventName === 'mouseenter' || eventName === 'mouseleave');
  }

  function createResponder(uid, eventName, handler) {
    if (Event._isCustomEvent(eventName))
      return createResponderForCustomEvent(uid, eventName, handler);
    if (isSimulatedMouseEnterLeaveEvent(eventName))
      return createMouseEnterLeaveResponder(uid, eventName, handler);

    return function(event) {
      if (!Event.cache) return;

      var element = Event.cache[uid].element;
      Event.extend(event, element);
      handler.call(element, event);
    };
  }

  function createResponderForCustomEvent(uid, eventName, handler) {
    return function(event) {
      var element = Event.cache[uid].element;

      if (Object.isUndefined(event.eventName))
        return false;

      if (event.eventName !== eventName)
        return false;

      Event.extend(event, element);
      handler.call(element, event);
    };
  }

  function createMouseEnterLeaveResponder(uid, eventName, handler) {
    return function(event) {
      var element = Event.cache[uid].element;

      Event.extend(event, element);
      var parent = event.relatedTarget;

      while (parent && parent !== element) {
        try { parent = parent.parentNode; }
        catch(e) { parent = element; }
      }

      if (parent === element) return;
      handler.call(element, event);
    }
  }

  GLOBAL.Event._createResponder = createResponder;
  docEl = null;
})(this);

(function(GLOBAL) {
  /* Support for the DOMContentLoaded event is based on work by Dan Webb,
     Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */

  var TIMER;

  function fireContentLoadedEvent() {
    if (document.loaded) return;
    if (TIMER) window.clearTimeout(TIMER);
    document.loaded = true;
    document.fire('dom:loaded');
  }

  function checkReadyState() {
    if (document.readyState === 'complete') {
      document.detachEvent('onreadystatechange', checkReadyState);
      fireContentLoadedEvent();
    }
  }

  function pollDoScroll() {
    try {
      document.documentElement.doScroll('left');
    } catch (e) {
      TIMER = pollDoScroll.defer();
      return;
    }

    fireContentLoadedEvent();
  }


  if (document.readyState === 'complete') {
    fireContentLoadedEvent();
    return;
  }

  if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', fireContentLoadedEvent, false);
  } else {
    document.attachEvent('onreadystatechange', checkReadyState);
    if (window == top) TIMER = pollDoScroll.defer();
  }

  Event.observe(window, 'load', fireContentLoadedEvent);
})(this);


Element.addMethods();
/*------------------------------- DEPRECATED -------------------------------*/

Hash.toQueryString = Object.toQueryString;

var Toggle = { display: Element.toggle };

Element.Methods.childOf = Element.Methods.descendantOf;

var Insertion = {
  Before: function(element, content) {
    return Element.insert(element, {before:content});
  },

  Top: function(element, content) {
    return Element.insert(element, {top:content});
  },

  Bottom: function(element, content) {
    return Element.insert(element, {bottom:content});
  },

  After: function(element, content) {
    return Element.insert(element, {after:content});
  }
};

var $continue = new Error('"throw $continue" is deprecated, use "return" instead');

var Position = {
  includeScrollOffsets: false,

  prepare: function() {
    this.deltaX =  window.pageXOffset
                || document.documentElement.scrollLeft
                || document.body.scrollLeft
                || 0;
    this.deltaY =  window.pageYOffset
                || document.documentElement.scrollTop
                || document.body.scrollTop
                || 0;
  },

  within: function(element, x, y) {
    if (this.includeScrollOffsets)
      return this.withinIncludingScrolloffsets(element, x, y);
    this.xcomp = x;
    this.ycomp = y;
    this.offset = Element.cumulativeOffset(element);

    return (y >= this.offset[1] &&
            y <  this.offset[1] + element.offsetHeight &&
            x >= this.offset[0] &&
            x <  this.offset[0] + element.offsetWidth);
  },

  withinIncludingScrolloffsets: function(element, x, y) {
    var offsetcache = Element.cumulativeScrollOffset(element);

    this.xcomp = x + offsetcache[0] - this.deltaX;
    this.ycomp = y + offsetcache[1] - this.deltaY;
    this.offset = Element.cumulativeOffset(element);

    return (this.ycomp >= this.offset[1] &&
            this.ycomp <  this.offset[1] + element.offsetHeight &&
            this.xcomp >= this.offset[0] &&
            this.xcomp <  this.offset[0] + element.offsetWidth);
  },

  overlap: function(mode, element) {
    if (!mode) return 0;
    if (mode == 'vertical')
      return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
        element.offsetHeight;
    if (mode == 'horizontal')
      return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
        element.offsetWidth;
  },


  cumulativeOffset: Element.Methods.cumulativeOffset,

  positionedOffset: Element.Methods.positionedOffset,

  absolutize: function(element) {
    Position.prepare();
    return Element.absolutize(element);
  },

  relativize: function(element) {
    Position.prepare();
    return Element.relativize(element);
  },

  realOffset: Element.Methods.cumulativeScrollOffset,

  offsetParent: Element.Methods.getOffsetParent,

  page: Element.Methods.viewportOffset,

  clone: function(source, target, options) {
    options = options || { };
    return Element.clonePosition(target, source, options);
  }
};

/*--------------------------------------------------------------------------*/

if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods){
  function iter(name) {
    return name.blank() ? null : "[contains(concat(' ', @class, ' '), ' " + name + " ')]";
  }

  instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
  function(element, className) {
    className = className.toString().strip();
    var cond = /\s/.test(className) ? $w(className).map(iter).join('') : iter(className);
    return cond ? document._getElementsByXPath('.//*' + cond, element) : [];
  } : function(element, className) {
    className = className.toString().strip();
    var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);
    if (!classNames && !className) return elements;

    var nodes = $(element).getElementsByTagName('*');
    className = ' ' + className + ' ';

    for (var i = 0, child, cn; child = nodes[i]; i++) {
      if (child.className && (cn = ' ' + child.className + ' ') && (cn.include(className) ||
          (classNames && classNames.all(function(name) {
            return !name.toString().blank() && cn.include(' ' + name + ' ');
          }))))
        elements.push(Element.extend(child));
    }
    return elements;
  };

  return function(className, parentElement) {
    return $(parentElement || document.body).getElementsByClassName(className);
  };
}(Element.Methods);

/*--------------------------------------------------------------------------*/

Element.ClassNames = Class.create();
Element.ClassNames.prototype = {
  initialize: function(element) {
    this.element = $(element);
  },

  _each: function(iterator, context) {
    this.element.className.split(/\s+/).select(function(name) {
      return name.length > 0;
    })._each(iterator, context);
  },

  set: function(className) {
    this.element.className = className;
  },

  add: function(classNameToAdd) {
    if (this.include(classNameToAdd)) return;
    this.set($A(this).concat(classNameToAdd).join(' '));
  },

  remove: function(classNameToRemove) {
    if (!this.include(classNameToRemove)) return;
    this.set($A(this).without(classNameToRemove).join(' '));
  },

  toString: function() {
    return $A(this).join(' ');
  }
};

Object.extend(Element.ClassNames.prototype, Enumerable);

/*--------------------------------------------------------------------------*/

(function() {
  window.Selector = Class.create({
    initialize: function(expression) {
      this.expression = expression.strip();
    },

    findElements: function(rootElement) {
      return Prototype.Selector.select(this.expression, rootElement);
    },

    match: function(element) {
      return Prototype.Selector.match(element, this.expression);
    },

    toString: function() {
      return this.expression;
    },

    inspect: function() {
      return "#<Selector: " + this.expression + ">";
    }
  });

  Object.extend(Selector, {
    matchElements: function(elements, expression) {
      var match = Prototype.Selector.match,
          results = [];

      for (var i = 0, length = elements.length; i < length; i++) {
        var element = elements[i];
        if (match(element, expression)) {
          results.push(Element.extend(element));
        }
      }
      return results;
    },

    findElement: function(elements, expression, index) {
      index = index || 0;
      var matchIndex = 0, element;
      for (var i = 0, length = elements.length; i < length; i++) {
        element = elements[i];
        if (Prototype.Selector.match(element, expression) && index === matchIndex++) {
          return Element.extend(element);
        }
      }
    },

    findChildElements: function(element, expressions) {
      var selector = expressions.toArray().join(', ');
      return Prototype.Selector.select(selector, element || document);
    }
  });
})();

"use strict";
/*	============================================================================
									Gibson Research Corporation
				UHEPRNG - Ultra High Entropy Pseudo-Random Number Generator
	============================================================================
	This is GRC's cryptographically strong PRNG (pseudo-random number generator)
	for JavaScript. It is driven by 1536 bits of entropy, stored in an array of
	48, 32-bit JavaScript variables.  Since many applications of this generator,
	including ours with the "Off The Grid" Latin Square generator, may require
	the deteriministic re-generation of a sequence of PRNs, this PRNG's initial
	entropic state can be read and written as a static whole, and incrementally
	evolved by pouring new source entropy into the generator's internal state.
	----------------------------------------------------------------------------
	ENDLESS THANKS are due Johannes Baagoe for his careful development of highly
	robust JavaScript implementations of JS PRNGs.  This work was based upon his
	JavaScript "Alea" PRNG which is based upon the extremely robust Multiply-
	With-Carry (MWC) PRNG invented by George Marsaglia. MWC Algorithm References:
	http://www.GRC.com/otg/Marsaglia_PRNGs.pdf
	http://www.GRC.com/otg/Marsaglia_MWC_Generators.pdf
	----------------------------------------------------------------------------
	The quality of this algorithm's pseudo-random numbers have been verified by
	multiple independent researchers. It handily passes the fermilab.ch tests as
	well as the "diehard" and "dieharder" test suites.  For individuals wishing
	to further verify the quality of this algorithm's pseudo-random numbers, a
	256-megabyte file of this algorithm's output may be downloaded from GRC.com,
	and a Microsoft Windows scripting host (WSH) version of this algorithm may be
	downloaded and run from the Windows command prompt to generate unique files
	of any size:
	The Fermilab "ENT" tests: http://fourmilab.ch/random/
	The 256-megabyte sample PRN file at GRC: https://www.GRC.com/otg/uheprng.bin
	The Windows scripting host version: https://www.GRC.com/otg/wsh-uheprng.js
	----------------------------------------------------------------------------
	Qualifying MWC multipliers are: 187884, 686118, 898134, 1104375, 1250205,
	1460910 and 1768863. (We use the largest one that's < 2^21)
	============================================================================ */

function uheprng() {
	return (function() {
  		var o = 48;					// set the 'order' number of ENTROPY-holding 32-bit values
		var c = 1;					// init the 'carry' used by the multiply-with-carry (MWC) algorithm
		var p = o;					// init the 'phase' (max-1) of the intermediate variable pointer
		var s = new Array(o);	// declare our intermediate variables array
		var i,j,k=0;				// general purpose locals

		// when our "uheprng" is initially invoked our PRNG state is initialized from the
		// browser's own local PRNG. This is okay since although its generator might not
		// be wonderful, it's useful for establishing large startup entropy for our usage.		
		var mash = Mash();		// get a pointer to our high-performance "Mash" hash
		for (i = 0; i < o; i++) s[i] = mash( Math.random() );	// fill the array with initial mash hash values

		// this PRIVATE (internal access only) function is the heart of the multiply-with-carry
		// (MWC) PRNG algorithm. When called it returns a pseudo-random number in the form of a
		// 32-bit JavaScript fraction (0.0 to <1.0) it is a PRIVATE function used by the default
		// [0-1] return function, and by the random 'string(n)' function which returns 'n'
		// characters from 33 to 126.
		function rawprng() {
			if (++p >= o) p = 0;
			var t = 1768863 * s[p] + c * 2.3283064365386963e-10; // 2^-32
      	return s[p] = t - (c = t | 0);
		};
		
		// this EXPORTED function is the default function returned by this library.
		// The values returned are integers in the range from 0 to range-1. We first
		// obtain two 32-bit fractions (from rawprng) to synthesize a single high
		// resolution 53-bit prng (0 to <1), then we multiply this by the caller's
		// "range" param and take the "floor" to return a equally probable integer.
		var random = function( range ) {
			return Math.floor(range * (rawprng() + (rawprng() * 0x200000 | 0) * 1.1102230246251565e-16)); // 2^-53
		};

		// this EXPORTED function 'string(n)' returns a pseudo-random string of
		// 'n' printable characters ranging from chr(33) to chr(126) inclusive.
		random.string = function( count ) {
			var i, s='';
			for ( i=0; i<count; i++ ) s += String.fromCharCode( 33+random(94) );
			return s;
		};

		// this PRIVATE "hash" function is used to evolve the generator's internal
		// entropy state. It is also called by the EXPORTED addEntropy() function
		// which is used to pour entropy into the PRNG.
		function hash() {
			var args = Array.prototype.slice.call(arguments)
			for (i = 0; i < args.length; i++) {
				for (j = 0; j < o; j++) {
					s[j] -= mash(args[i]);
					if (s[j] < 0) s[j] += 1;
				}
			}
		};

		// this EXPORTED "clean string" function removes leading and trailing spaces and non-printing
		// control characters, including any embedded carriage-return (CR) and line-feed (LF) characters,
		// from any string it is handed. this is also used by the 'hashstring' function (below) to help
		// users always obtain the same EFFECTIVE uheprng seeding key.
		random.cleanString = function( inStr ) {
			inStr = inStr.replace(/(^\s*)|(\s*$)/gi,""); // remove any/all leading spaces
			inStr = inStr.replace(/[\x00-\x1F]/gi,"");	// remove any/all control characters
			inStr = inStr.replace(/\n /,"\n");				// remove any/all trailing spaces
			return inStr;											// return the cleaned up result
		}
		
		// this EXPORTED "hash string" function hashes the provided character string after first removing
		// any leading or trailing spaces and ignoring any embedded carriage returns (CR) or Line Feeds (LF)
		random.hashString = function( inStr ) {
			inStr = random.cleanString( inStr );
			mash( inStr );											// use the string to evolve the 'mash' state
			for ( i = 0; i < inStr.length; i++) {			// scan through the characters in our string
				k = inStr.charCodeAt( i );						// get the character code at the location
				for (j = 0; j < o; j++) {						//	"mash" it into the UHEPRNG state
					s[j] -= mash( k );
					if (s[j] < 0) s[j] += 1;
				}
			}
		};
				
		// this handy exported function is used to add entropy to our uheprng at any time
		random.addEntropy = function( /* accept zero or more arguments */ ) {
			var args = [];
			for ( i = 0; i < arguments.length; i++ ) args.push( arguments[i] );
			hash( (k++) + (new Date().getTime()) + args.join('') + Math.random() );
		};
		
		// if we want to provide a deterministic startup context for our PRNG,
		// but without directly setting the internal state variables, this allows
		// us to initialize the mash hash and PRNG's internal state before providing
		// some hashing input
		random.initState = function() {
			mash();													// pass a null arg to force mash hash to init
			for (i = 0; i < o; i++) s[i] = mash( ' ' );	// fill the array with initial mash hash values
			c = 1;													// init our multiply-with-carry carry
			p = o;													// init our phase
		};
		
		// we use this (optional) exported function to signal the JavaScript interpreter
		// that we're finished using the "Mash" hash function so that it can free up the
		// local "instance variables" is will have been maintaining.  It's not strictly
		// necessary, of course, but it's good JavaScript citizenship.
		random.done = function() {
			mash = null;
		};

		// when our main outer "uheprng" function is called, after setting up our
		// initial variables and entropic state, we return an "instance pointer"
		// to the internal anonymous function which can then be used to access
		// the uheprng's various exported functions.  As with the ".done" function
		// above, we should set the returned value to 'null' once we're finished
		// using any of these functions.
		return random;
  } ());
};

/*	============================================================================
	This is based upon Johannes Baagoe's carefully designed and efficient hash
	function for use with JavaScript.  It has a proven "avalanche" effect such
	that every bit of the input affects every bit of the output 50% of the time,
	which is good.	See: http://baagoe.com/en/RandomMusings/hash/avalanche.xhtml
	============================================================================
*/
function Mash() {
	var n = 0xefc8249d;
	var mash = function(data) {
		if ( data ) {
			data = data.toString();
			for (var i = 0; i < data.length; i++) {
				n += data.charCodeAt(i);
				var h = 0.02519603282416938 * n;
				n = h >>> 0;
				h -= n;
				h *= n;
				n = h >>> 0;
				h -= n;
				n += h * 0x100000000; // 2^32
			}
			return (n >>> 0) * 2.3283064365386963e-10; // 2^-32
		} else n = 0xefc8249d;
	};
  return mash;
}

/*
 * osweb 
 *  
 * An experiment research tool written in Javascript and HTML to be used in 
 * Qualtrics or other web-based tools. Based upon OpenSesame.         
 *
 * Author: drs. J. Bos
 *
 * Copyright (c) University of Groningen 
 * Faculty of Behavioural and Social Sciences
 * Technical Support Service 
 *
 */

// Use strict mode.     
"use strict";

// Set osweb namespace.
this.osweb = this.osweb||{};

// Definition of osweb version constants. 
osweb.VERSION_NAME   = 'osweb';
osweb.VERSION_NUMBER = '0.039 (18-07-2016)';

// Definition of osweb class utility methods.
osweb.extendClass = function(sub_class, super_class) {
    function o() { 
        this.constructor = sub_class; 
    }
    o.prototype = super_class.prototype;
    return (sub_class.prototype = new o());
}; 

osweb.isClass = function(class_name) {
    // Return true if the classname is defined within the osweb namespace.
    return (this[class_name] !== undefined);
};

osweb.newItemClass = function(type, experiment, name, string) {
    // Create the element.
    var element = new this[type](experiment, name, string);
   
    // Set the type of the item.
    element.type = type;
    
    // Return the element
    return element;
};

osweb.newElementClass = function(type, sketchpad, string) {
    // Create the element.
    var element = new this[type](sketchpad, string);
    
    // Return the element
    return element;
};

osweb.newWidgetClass = function(type, form, variables) {
    // Create the element.
    var widget = new this[type](form, variables);
   	
    // Return the element
    return widget;
}; 

osweb.promoteClass = function(sub_class, prefix) {
    var subP = sub_class.prototype, supP = (Object.getPrototypeOf&&Object.getPrototypeOf(subP))||subP.__proto__;
    if (supP) {
    	subP[(prefix+="_") + "constructor"] = supP.constructor; 
    	for (var n in supP) {
            if (subP.hasOwnProperty(n) && (typeof supP[n] === "function")) {
                subP[prefix + n] = supP[n]; 
            }
	}
    }
    return sub_class;
}; 


(function() {
    // Definition of the class constants.
    function constants() {
    	throw 'The class constants cannot be instantiated!';
    }

    // Definition of error constants. 
    constants.ERROR_001 = 'osweb has stopped running due a fatal error.';
    constants.ERROR_002 = 'No content parameter specified.';
    constants.ERROR_003 = 'No context parameter specified.';
    constants.ERROR_004 = 'Invalid scriptID or scriptURL for retrieving script from external location.';
    constants.ERROR_005 = 'Failure to retrieve script from external location (Ajax call error).';
    constants.ERROR_006 = 'Failure to retrieve script from external location (database response error)';
    constants.ERROR_007 = 'Failure to retrieve script from external location (database retrieve error).';
    constants.ERROR_008 = 'Invalid script definition, parsing error.';
    constants.ERROR_009 = 'Unknown class definition within osweb script - ';

    // Definition of message constants. 
    constants.MESSAGE_001 = 'Os';
    constants.MESSAGE_002 = 'web - version ';
    constants.MESSAGE_003 = 'Start up osweb experiment session.';
    constants.MESSAGE_004 = 'Retrieving stimuli files.';
    constants.MESSAGE_005 = 'Retrieving input parameters.';
    constants.MESSAGE_006 = 'Press with the mouse on this screen to continue.';
    constants.MESSAGE_007 = 'Warning: this method is not implemented in the current version of OsWeb - ';
    constants.MESSAGE_008 = 'Retrieving session information.';

    // Definition of general constants. 
    constants.STATUS_NONE = 0;                   // Running status of an item.   
    constants.STATUS_BUILD = 1;
    constants.STATUS_INITIALIZE = 2;
    constants.STATUS_EXECUTE = 3;
    constants.STATUS_FINALIZE = 4;
    constants.PARSER_NONE = 0;                   // Running status of the parser.
    constants.PARSER_EXECUTE = 1;
    constants.STATUS_PENDING = 2;
    constants.STATUS_DONE = 3;
    constants.PRESSES_ONLY = 1;                  // Type of used collection mode.           
    constants.RELEASES_ONLY = 2;
    constants.PRESSES_AND_RELEASES = 3;
    constants.RESPONSE_NONE = 0;                 // Type of response used.
    constants.RESPONSE_DURATION = 1;
    constants.RESPONSE_KEYBOARD = 2;
    constants.RESPONSE_MOUSE = 3;
    constants.RESPONSE_SOUND = 4;
    constants.RESPONSE_AUTOKEYBOARD = 5;
    constants.RESPONSE_AUTOMOUSE = 6;
    constants.UPDATE_NONE = 0;                  // Item update status flag.
    constants.UPDATE_ONSET = 1;
    constants.UPDATE_OFFSET = 2;
    constants.SEQUENTIAL = 0;                   // Loop randomization type.
    constants.RANDOM = 1;
    constants.RANDOMREPLACEMENT = 2;

    // Bind the constants class to the osweb namespace.
    osweb.constants = constants;
}()); 


(function() {
// Definition of the class canvas.
    function canvas(experiment, auto_prepare) {
	// set the class public properties.
        this.auto_prepare = (typeof auto_prepare === 'undefined') ? true : auto_prepare;              // Set autoprepare toggle (not supported yet). 	
        this.experiment = (typeof experiment === 'undefined') ? osweb.runner.experiment : experiment; // Anchor to the experiment object.
		
        // Set the public properties. 
    	this.background_color = this.experiment.vars.background;                         // Backgropund color of canvas.     
        this.bidi = (this.experiment.vars.bidi === 'yes');                               // If true bidi mode is enabled.
        this.color = this.experiment.vars.foregound;                                     // Foreground color of canvas.
        this.fill = false;                                                               // If true fill mode is used.
        this.font_bold = (this.experiment.vars.font_bold === 'yes');                     // If true font style bold is enabled.
        this.font_family = (this.experiment.vars.font_family);                           // Family name of the font used.
        this.font_italic = (this.experiment.vars.font_italic === 'yes');                 // If true font style italic is enabled.
        this.font_size = (this.experiment.vars.font_size);                               // Size of the font in pixels.
        this.font_underline = (this.experiment.vars.font_underline === 'yes');           // If true font style underline is enabled.
        this.html = true;                                                                // If true html is used (not supported yet).
        this.penwidth = 1;                                                               // Default penwidth for drawing shapes. 
        
        // Set the private properties.  
    	this._container = new createjs.Container();                                      // EASELJS: Container which holds the shapes
        this._font_string = 'bold 18px Courier New';                                     // EASELJS: Default font definition string.
	this._height = osweb.runner._canvas.height;                                      // Height of the HTML canvas used for drawing.
	this._width = osweb.runner._canvas.width;                                        // Width of the HTML canvas used for drawing.
    }; 
	
    // Extend the class from its base class.
    var p = canvas.prototype;
    
    // Definition of public properties. 
    p.auto_prepare= false;
    p.experiment = null;
    p.uniform_coordinates = false;
	
    // Definition of private methods. 
    
    p._arrow_shape = function(sx, sy, ex, ey, body_length, body_width, head_width) {
        // Length
        var d = Math.sqrt(Math.pow(ey - sy,2) + Math.pow(sx - ex,2));
        var angle = Math.atan2(ey - sy, ex - sx);
	var _head_width = (1 - body_width) / 2.0;
	body_width = body_width / 2.0;
	
        // calculate coordinates
	var p4 = [ex, ey];
	var p1 = [sx + body_width * head_width * Math.cos(angle - Math.PI / 2), sy + body_width * head_width * Math.sin(angle - Math.PI / 2)];
	var p2 = [p1[0] + body_length * Math.cos(angle) * d, p1[1] + body_length * Math.sin(angle) * d];
	var p3 = [p2[0] + _head_width * head_width * Math.cos(angle - Math.PI / 2), p2[1] + _head_width * head_width * Math.sin(angle - Math.PI / 2)];
	var p7 = [sx + body_width * head_width * Math.cos(angle + Math.PI / 2), sy + body_width * head_width * Math.sin(angle + Math.PI / 2)];
	var p6 = [p7[0] + body_length * Math.cos(angle) * d, p7[1] + body_length * Math.sin(angle) * d];
	var p5 = [p6[0] + _head_width * head_width * Math.cos(angle + Math.PI / 2), p6[1] + _head_width * head_width * Math.sin(angle + Math.PI / 2)];
	
        return [p1, p2, p3, p4, p5, p6, p7];
    };    
        
    // Definition of public methods. 
    
    p.arrow = function (sx, sy, ex, ey, color, penwidth, body_length, body_width, head_width, fill) {
        var points = this._arrow_shape(sx, sy, ex, ey, body_width, body_length, head_width);
    	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
        
        shape.graphics.moveTo(points[0][0],points[0][1]);
	shape.graphics.lineTo(points[1][0],points[1][1]);
	shape.graphics.lineTo(points[2][0],points[2][1]);
	shape.graphics.lineTo(points[3][0],points[3][1]);
	shape.graphics.lineTo(points[4][0],points[4][1]);
	shape.graphics.lineTo(points[5][0],points[5][1]);
	shape.graphics.lineTo(points[6][0],points[6][1]);
	shape.graphics.lineTo(points[0][0],points[0][1]);
	
       	// Add the line item to container.
	this._container.addChild(shape); 
    }; 
    		
    p.circle = function(x, y, r, fill, color, penwidth) {
	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
	if (fill == 1)
	{
            shape.graphics.beginFill(color);
	}
	shape.graphics.drawCircle(x, y, r);
		
	// Add the line item to container.
	this._container.addChild(shape); 
    };

    p.clear = function(backround_color) {
	// Remove the container from the stage object.
	osweb.runner._stage.removeChild(this._container);
	
        // Remove the children from the container.
        this._container.removeAllChildren();
    };

    p.close_display = function(experiment) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.close_display().');
    };

    p.copy = function(canvas) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.copy().');
    };

    p.ellipse = function(x, y, w, h, fill, color, penwidth) {
	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
	if (fill == 1)
	{
            shape.graphics.beginFill(color);
	}
	shape.graphics.drawEllipse(x, y, w, h); 

	// Add the text item to the parten frame.
	this._container.addChild(shape);
    };

    p.fixdot = function(x, y, color, style) {
        // Check the color and style arguments.      
        color = (typeof color === 'undefined') ? 'white' : color;
        style = (typeof style === 'undefined') ? 'default' : style;
        
        if (typeof x === 'undefined') {
            if (this.uniform_coordinates === true) {
		x = 0;
            }
            else {
                x = this._width / 2;
            }
	}
	if (typeof y === 'undefined') {
            if (this.uniform_coordinates === true) {
		y = 0;
            }
            else {
		y = this._height / 2;
            }	
	}
		
	var s = 4;
	var h = 2;
	if (style.indexOf('large') !== -1) {
            s = 16;
	}
	else if ((style.indexOf('medium') !== -1) || (style === 'default')) {
            s = 8;
	}
	else if (style.indexOf('small') !== -1) {
            s = 4;
	}
	else {
            osweb.debug.addError('Unknown style: ' + style);
	}	
		
	if ((style.indexOf('open') !== -1) || (style === 'default')) {	
            this.ellipse(x - s, y - s, 2 * s, 2 * s, 1, color, 1);
            this.ellipse(x - h, y - h, 2 * h, 2 * h, 1, 'black', 1);
	}
	else if (style.indexOf('filled') !== -1)	{	
            this.ellipse(x - s, y - s, 2 * s, 2 * s, 1, color, 1);
	}
        else if (style.indexOf('cross') !== -1)	{
            this.line(x, y - s, x, y + s);
            this.line(x - s, y, x + s, y);
	}
	else {
            osweb.debug.addError('Unknown style: ' + style);
	}	
    };

    p.gabor = function(x, y, orient, freq, env, size, stdev, phase, color1, color2, bgmode) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.gabor().');
    };

    p.height = function() {
    	return this._heigth();
    };

    p.image = function(fname, center, x, y, scale) {
	// Set the class private properties. 
	var image = new createjs.Bitmap();
        image.image = fname.data;
	image.scaleX = scale;
        image.scaleY = scale;
        image.snapToPixel = true;
        image.x = x - ((image.image.width  * scale) / 2);
    	image.y = y - ((image.image.height * scale) / 2);
	
	// Add the text item to the parten frame.
	this._container.addChild(image);
    };
	
    p.init_display = function(experiment) {
	// Set the dimension properties.
	this._height = experiment.vars.height;
    	this._width  = experiment.vars.width;
	
	// Initialize the display dimensions.
	osweb.runner._canvas.height = experiment.vars.height;
	osweb.runner._canvas.width  = experiment.vars.width;
		
	// Initialize the display color.
	osweb.runner._canvas.style.background = experiment.vars.background;

        // Set the cursor visibility to none (default).
        osweb.runner._canvas.style.cursor = 'none';

        // Set focus to the experiment canvas.
        osweb.runner._canvas.focus(); 
    };

    p.line = function(sx, sy, ex, ey, color, penwidth) {
    	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
	shape.graphics.moveTo(sx, sy);
	shape.graphics.lineTo(ex, ey); 

	// Add the line item to container..
	this._container.addChild(shape); 
    };
	
    p.noise_patch = function(pX, pY, pEnv, pSize, pStdev, pColor1, pColor2, pBgmode) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.noise_patch().');
    };
	
    p.polygon = function(verticles) {
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.polygon().');
    };
	
    p.prepare = function() {
    };
	
    p.rect = function(x, y, w, h, fill, color, penwidth) {
    	var shape = new createjs.Shape();
	shape.graphics.setStrokeStyle(penwidth);
	shape.graphics.beginStroke(color);
	if (fill == 1)
	{
            shape.graphics.beginFill(color);
	}
	shape.graphics.rect(x, y, w, h); 

	// Add the line item to container..
	this._container.addChild(shape); 
    };
	
    p.set_font = function(family, size, italic, bold, underline) {
   	// Define the the font styles.
    	var font_bold = (bold === true) ? 'bold ' : '';
        var font_italic = (italic === true) ? 'italic ' : '';
        var font_underline = (underline === true) ? 'underline ' : '';
        
        // Set the font string.
        this._font_string = font_bold + font_italic + font_underline + size + 'px ' + family; 
     };
        
    p.show = function() {
    	// Add the container to the stage object and update the stage.
	osweb.runner._stage.addChild(this._container);
	osweb.runner._stage.update(); 

	// Return the current time.
	if (this.experiment != null) {
            return this.experiment.clock.time();
        }    
        else {    
            return null;
        }
    };
	
    p.size = function() {
    	// Create object tuple.
    	var size = {width: this._width, height: this._height};
	return size;
    };
	
    p.text = function(text, center, x, y , color, html) {
	// Create the text element.          
	var text_element = new createjs.Text(text, this._font_string, color);

	// Set the text element properties.
	text_element.x = x - (text_element.getMeasuredWidth() / 2);
	text_element.y = y - (text_element.getMeasuredHeight() / 2);
		 
	// Add the text item to the parten frame.
	this._container.addChild(text_element);
    };

    p.text_size = function(text, max_width, style_args) {
        // Return the text size in pixels.
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'canvas.text_size().');
    };

    // Bind the canvas class to the osweb namespace.
    osweb.canvas = canvas;
}());



(function() {
    // Definition of the class clock.
    function clock(experiment) {
        // Definition of private properties. 
        this._startTime = this._now();                     // Start time anchor of the experiment.
		
        // Set the class public properties. 
	this.experiment = experiment;                      // Anchor to the experiment object.
    }; 
	
    // Extend the class from its base class.
    var p = clock.prototype;
    
    // Definition of public properties. 
    p.experiment = null;

    // Definition of private methods.   
    
    p._now = function() {
	// Get the current time stamp using the best available timing method.
	if (window.performance.now) {
            return Math.round(window.performance.now());
	} 
	else if (window.performance.webkitNow) {
            return Math.round(window.performance.webkitNow());
	} 
	else {
            return new Date().getTime();
	}
    };

    // Definition of public methods.   

    p.initialize = function() {
        // Set the absolute start time of the expeirment.
        this._startTime = this._now();
    };

    p.sleep = function(duration) {
        // Sleeps (pauses) for a duration (in milliseconds).
	if (this.experiment !==  null) {
            // Set the event processor.
            osweb.events._run(this, duration, osweb.constants.RESPONSE_DURATION, null);
	}
    };
	
    p.time = function() {
        // Gives the current timestamp in milliseconds. 
        if (this._startTime !== -1) {
            return (this._now() - this._startTime);
        }    
        else {
            return 0;
        }    
    };
 	
    // Bind the clock class to the osweb namespace.
    osweb.clock = clock;
}());



(function() {
    // Definition of the class keyboard.
    function keyboard(experiment, timeout, keylist) {
        // Set the public properties. 
	this.experiment = experiment;                                          // Anchor to the experiment object. 
	this.keylist = (typeof keylist === 'undefined') ? [] : keylist;	       // List of acceptable response keys. 
	this.timeout = (typeof timeout === 'undefined') ? null : timeout;      // Duration in millisecond for time-out.
    }; 
	
    // Extend the class from its base class.
    var p = keyboard.prototype;
    
    // Definition of public properties. 
    p.experiment = null;
    p.keylist = [];
    p.timeout = null;
	
    // Definition of the synoniem map for all keys.                                  
    p.SYNONIEM_MAP = [[' ','space','SPACE'],['"','quotedbl','QUOTEDBL'],['!','exclaim','EXCLAIM'],['#','hash','HASH'],
        ['$','dollar','DOLLAR'],['&','ampersand','AMPERSAND'],["'",'quote','QUOTE'],['(','leftbracket','leftparen','LEFTBRACKET','LEFTPAREN'],
        [')','rightbracket','rightparen','RIGHTBRACKET','RIGHTPAREN'],['*','asteriks','ASTERISK'],['+','plus','PLUS'],[',','comma','COMMA'],
        ['-','minus','MINUS'],['.','period','PERIOD'],['/','slash','SLASH'],
        ['1'],['2'],['3'],['4'],['5'],['6'],['7'],['8'],['9'],['0'],['=','equals','EQUALS'],
        [':','colon','COLON'],[';','semicolon','SEMICOLON'],['<','less','LESS'],['>','greater','GREATER'],
        ['?','question','QUESTION'],['@','at','AT'],
        ['a','A'],['b','B'],['c','C'],['d','D'],['e','E'],['f','F'],
        ['g','G'],['h','H'],['i','I'],['j','J'],['k','K'],['l','L'],
        ['m','M'],['n','N'],['o','O'],['p','P'],['q','Q'],['r','R'],
        ['s','S'],['t','T'],['u','U'],['v','V'],['w','W'],['x','X'],
        ['y','Y'],['z','Z'],
        ['kp0','KP0'],['kp1','KP1'],['kp2','KP2'],['kp3','KP3'],['kp4','KP4'],['kp5','KP5'],['kp6','KP6'],['kp7','KP7'],['kp8','KP8'],['kp9','KP9'],  
        ['kp_divide','KP_DIVIDE'],['kp_enter','KP_ENTER'],['kp_equals','KP_EQUALS'],['kp_minus','KP_MINUS'],['kp_multiply','KP_MULTIPLY'],['kp_period','KP_PERIOD'],['kp_plus','KP_PLUS'],
        ['\\','backslash','BACKSLASH'],['^','power','caret','POWER','CARET'],['_','underscore','UNDERSCORE'],['`','backquote','BACKQUOTE'],
        ['f1','F1','help','HELP'],['f2','F2'],['f3','F3'],['f4','F4'],['f5','F5'],['f6','F6'],
        ['f7','F7'],['f8','F8'],['f9','F9'],['f10','F10'],['f11','F11'],['f12','F12'],
        ['f13','F13'],['f14','F14'],['f15','F15'],
        ['up','UP'],['down','DOWN'],['left','LEFT'],['right','RIGHT'],['menu','MENU'],
        ['lshift','left shift','LSHIFT','LEFT SHIFT'],['lctrl','left ctrl','LCTRL','LEFT CTRL'],['lalt','left alt','LALT','LEFT ALT'],
        ['rshift','right shift','RSHIFT','RIGHT SHIFT'],['rctrl','right ctrl','RCTRL','RIGHT CTRL'],['ralt','right alt','alt gr','RALT','RIGHT ALT','ALT GR'],
        ['page up','pageup','PAGE UP','PAGEUP'],['page down','pagedown','PAGE DOWN','PAGEDOWN'],['pause','PAUSE'],
        ['scroll lock','scrollock','SCROLL LOCK','SCROLLOCK'],['caps lock','capslock','CAPS LOCK','CAPSLOCK'],['nummlock','NUMMLOCK'],
        ['clear','CLEAR'],['enter','ENTER','return','RETURN'],['tab','TAB'],['backspace','BACKSPACE'],['end','END'],['home','HOME'],['insert','INSERT'],['delete','DELETE'],
        ['sysreq','sys req','SYSREQ','SYS REQ'],['break','BREAK'],['escape','ESCAPE'],['print','PRINT'],['print screen','PRINT SCREEN'],
        ['lmeta','left meta','LMETA','LEFT META',,'lsuper','LSUPER','left super','LEFT SUPER'],                  
        ['rmeta','right meta','RMETA','RIGHT META','rsuper','right super','RSUPER','RIGHT SUPER'],                  
        // key defined below are not supported yet.
        ['euro','EURO'],['first','FIRST'],['last','LAST'],['kp enter','KP ENTER'],['kp equals','KP EQUALS'],
        ['mode','MODE'],['unknown','UNKNOWN'],['unknown key','UNKNOWN KEY']];  

    // Definition of private methods.

    p._get_default_from_synoniem = function(responses) {
        var defaults = [];
        for (var i = 0;i < responses.length; i++) {
            var synoniem = this.synonyms(responses[i]);
            defaults.push(synoniem[0]);
        }
        return defaults;    
    };
    
    // Definition of public methods.

    p.default_config = function() {
        // Return the default configuration.
	return {'timeout': null, 'keylist': []};
    };
    
    p.flush = function() {
	// Clear all pending keyboard input, not limited to the keyboard.
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'keyboard.flush().');
    };
 	
    p.get_key = function(timeout, keylist) {
	// Collects a single key press.
	this.keylist = (typeof keylist === 'undefined') ? this.keylist : keylist;	
	this.timeout = (typeof timeout === 'undefined') ? this.timeout : timeout;
		
	if (this.experiment != null) {
            // Set the event processor.
            osweb.events._run(this, this.timeout, osweb.constants.RESPONSE_KEYBOARD, this.keylist);
	};
    };

    p.get_mods = function() {
    	var moderators = [];
        if (osweb.events._keyboard_event !== null) {
            if (osweb.events._keyboard_event.shiftKey === true) {
                moderators.push('shift');
            };    
            if (osweb.events._keyboard_event.ctrlKey === true) {
                moderators.push('ctrl');
            };    
            if (osweb.events._keyboard_event.altKey === true) {
                moderators.push('alt');
            };    
        } 
        return moderators;    
    };

    p.set_config = function(timeout, keylist) {
	// Set the properties.
	this.keylist = keylist;	
	this.timeout = timeout;
    };
	
    p.show_virtual_keyboard = function(visible) {
        // Shows or hides a virtual keyboard.		
    	if (visible === true) {
            // Hack to show the virutal keyboard. ## Must be tested!
            osweb.runner._canvas.setfocus();
	}
	else {
            // Hack to hide the virtual keyboard. ## Must be tested!
            var tmp = document.createElement("input");
            document.body.appendChild(tmp);
            tmp.focus();
            document.body.removeChild(tmp);
	}
    };

    p.synonyms = function(button) {
        if (typeof button !== 'undefined') {
            for (var i = 0;i < this.SYNONIEM_MAP.length;i++) {
                for (var j = 0;j < this.SYNONIEM_MAP[i].length; j++) {
                    if (this.SYNONIEM_MAP[i][j] == button) {
                        return this.SYNONIEM_MAP[i];
                        break;
                    }
                }   
            }
        }
        else {
            return null;
        }    
    };

    // Bind the keyboard class to the osweb namespace.
    osweb.keyboard = keyboard;
}());


(function() {
    // Definition of the class log.
    function log(experiment, path) {
        // Set the class private properties. 
    	this._all_vars = null;                             // If true all variables are written to the log.  
	this._header_written = false;	                   // If true the header has been written to the log.
	this._log = [];                                    // Array containing the log entries.
	this._path = '';                                   // Path to wich the log is written.

        // Set the class public properties. 
	this.experiment = experiment;                      // Anchor to the experiment object.
    	this.experiment.vars.logfile = path;               // Store the path location into the vars list.   
    }; 
	
    // Extend the class from its base class.
    var p = log.prototype;
    
    // Definition of public properties. 
    p.experiment = null;
	
    // Definition of public methods.   

    p.all_vars = function() {
	// Retrieves a list of all variables that exist in the experiment.
	if (this._all_vars === null) {
            this._all_vars = this.experiment.vars.inspect();
	}
	return this._all_vars;
    };

    p.close = function() {
	// Closes the current log.
	if (this._log.length > 0) {
            // Echo the data to the runner.
            osweb.runner.data = this._log.join('');    
        };

	// Clear the log file.
	this._log = [];
    };

    p.flush = function() {
    	// Flush the log file.
        this._log = [];
    };

    p.open = function(path) {	
	// Opens the current log. If a log was already open, it is closed.
	this._header_written = false;
	this._path = path; 
	
	// Check for old data.
	if (this._log !== null) {
            // Clear the old data.
            this.close();
	}
    };

    p.write = function(msg, new_line) {
    	// Write one message to the log.
	new_line = (typeof new_line === 'undefined') ? true : new_line;
	
	// Write a new line.
	if (new_line === true) {
            this._log.push(msg + '\n');
	}
	else {
            // Write the Message line.
            this._log.push(msg);
	}
    };

    p.write_vars = function(var_list) {
    	// Writes variables to the log.
	var_list = (typeof var_list === 'undefined') ? null : var_list;
		
	var value; 
	var l = [];
        // If no var list defines, retrieve all variable.
	if (var_list == null) {
            var_list = this.all_vars();
	}

        // Sort the var list.
        var_list.sort();
        
	// Add the header to the log file.
        if (this._header_written === false) {
            for (var i = 0; i < var_list.length; i++) {
		l.push('"' + var_list[i] + '"');
            }		
            this.write(l.join());
            this._header_written = true;
	}
		
        // Add the data entries to the log file.        
        l = [];
	for (var i = 0; i < var_list.length; i++) {
            value = this.experiment.vars.get(var_list[i], 'NA', false);
            l.push('"' + value + '"');
	}
        this.write(l.join());
    };
 	
    // Bind the log class to the osweb namespace.
    osweb.log = log;
}());


(function() {
    // Definition of the class mouse.
    function mouse(experiment, timeout, buttonlist, visible)
    {
        // Set the class public properties. 
	this.experiment = experiment;                                               // Anchor to the experiment object.
	this.timeout = (typeof timeout === 'undefined') ? null : timeout;           // Duration in millisecond for time-out. 
	this.buttonlist = (typeof buttonlist === 'undefined') ? null : buttonlist;  // List of acceptable response buttons.	
	this.visible = (typeof visible === 'undefined') ? false : visible;	    // if true the mouse cursor is visible.
    }; 
	
    // Extend the class from its base class.
    var p = mouse.prototype;
    
    // Definition of public properties. 
    p.experiment = null;
    p.buttonlist = [];
    p.timeout = -1;
    p.visible = false;
	
    // Definition of the synoniem map for all keys.                                  
    p.SYNONIEM_MAP = [['1','left_button'], ['2','middle_button'], ['3','right_button'], ['4','scroll_up'], ['5','scroll_down']];
        
    // Definition of private methods.

    p._get_default_from_synoniem = function(responses) {
        // Return the default synoniem value from a response.
        var defaults = [];
        for (var i = 0;i < responses.length;i++) {
            var synoniem = this.synonyms(responses[i]);
            defaults.push(synoniem[0]);
        }
        return defaults;    
    };

    // Definition of class public methods.
    
    p.default_config = function() {
        // Return the default configuration.
        return {'timeout': null, 'buttonlist': null, 'visible': false};
    };

    p.flush = function() {
	// Clears all pending mouse input, not limited to the mouse.
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'mouse.flush().');
    };
 	
    p.get_click = function(timeout, buttonlist, visible) {
	// Collects a single mouse click.
	this.timeout = (typeof timeout === 'undefined') ? this.timeout : timeout;
	this.buttonlist = (typeof buttonlist === 'undefined') ? this.buttonlist : buttonlist;	
	this.visible = (typeof visible === 'undefined') ? this.visible : visible;	

	if (this.experiment != null) {
            // Hide or show the mouse.
            this.show_cursor(this.visible);
	
            // Set the event processor.
            osweb.events._run(this, this.timeout, osweb.constants.RESPONSE_MOUSE, this.buttonlist);
	};
    };

    p.get_pos = function() {
    	// Returns the current mouse position. !Warning: this methods uses the state in the last known mouse respone, not the current state.
        if (osweb.events._mouse_move !== null) {
            return {'rtTime': osweb.events._mouse_move.rtTime, 'x': osweb.events._mouse_move.event.clientX, 'y': osweb.events._mouse_move.event.clientY};
        }
        else {
            return {'rtTime': -1, 'x': -1, 'y': -1};
        }    
    };

    p.get_pressed = function() {
        // Returns the current button state of the mouse buttons. !Warning: this methods uses the state in the last known mouse respone, not the current state.
        if (osweb.events._mouse_press !== null) {
            return { 'buttons': [(osweb.events._mouse_press.button === 0), (osweb.events._mouse_press.button === 1), (osweb.events._mouse_press.button === 2)]};
        }
        else {
            return { 'buttons': [null, null, null]};
        }    
    };

    p.set_config = function(timeout, buttonlist, visible) {
	// Set mouse properties.          
	this.timeout = timeout;
	this.buttonlist = buttonlist;	
	this.visible = visible;	
    };

    p.set_pos = function(pos) {
    	// Returns the current position of the cursor.	
        osweb.debug.addMessage(osweb.constants.MESSAGE_007 + 'mouse.set_pos().');
    };

    p.show_cursor = function(visible) {
    	// Set the property
	this.visible = visible;
		
	// Immediately changes the visibility of the mouse cursor.	
	if (visible === true) {
            // Show the mouse cursor.
            osweb.runner._stage.canvas.style.cursor = "default";
	}
	else {
            // Set the cursor visibility to none.
            osweb.runner._stage.canvas.style.cursor = "none";
        }
    };

    p.synonyms = function(button)
    {
        if (typeof button !== 'undefined') {
            for (var i = 0;i < this.SYNONIEM_MAP.length;i++) {
                for (var j = 0;j < this.SYNONIEM_MAP[i].length;j++) {
                    if (this.SYNONIEM_MAP[i][j] == button) {
                        return this.SYNONIEM_MAP[i];
                        break;
                    }
                }   
            }
        }
        else {
            return null;
        }    
    };

    // Bind the mouse class to the osweb namespace.
    osweb.mouse = mouse;
}()); 



(function() {
    // Definition of the class sampler.
    function sampler(experiment, src, volume, pitch, pan, duration, fade, block) {
      	// Set the class public properties. 
	this.experiment = experiment;
	
	// Check if optional parameters are defined.
	this.block = (typeof block === 'undefined') ? false : block;	
	this.duration = (typeof duration === 'undefined') ? 'sound' : duration;	
	this.fade = (typeof fade === 'undefined') ? 0 : fade;	
	this.pan = (typeof pan === 'undefined') ? 0 : pan;	
	this.pitch = (typeof pitch === 'undefined') ? 1 : pitch;	
	this.src = (typeof src === 'undefined') ? '' : src;	
	this.volume = (typeof volume   === 'undefined') ? 1 : volume;	

	// Create the sound instance
	if (src !== null) {
            // Set the sound object.
            this._instance = src.data;
		
            // Set the event anchor for 
            this._instance.on("ended", osweb.events._audioEnded.bind(this));
    	}
    }; 
	
    // Extend the class from its base class.
    var p = sampler.prototype;
    
    // Definition of public properties. 
    p.duration = 'sound';	
    p.block = false;
    p.fade = '0';
    p.pan = '0';
    p.pitch = '1';
    p.src = null;
    p.volume = 1;
    
    // Definition of public methods.

    p.play = function(volume, pitch, pan, duration, fade, block) {
	// Check if optional parameters are defined.
	this.block = (typeof block === 'undefined') ? this.block : block;	
	this.duration = (typeof duration === 'undefined') ? this.duration : duration;	
	this.fade = (typeof fade === 'undefined') ? this.fade : fade;	
	this.pan = (typeof pan === 'undefined') ? this.pan : pan;	
	this.pitch = (typeof pitch === 'undefined') ? this.pitch : pitch;	
	this.volume = (typeof volume === 'undefined') ? this.volume : volume;	

	// Set the sound properties.
	this._instance.volume = this.volume;
		
	// Play the actual sound.
	this._instance.play();	
    };

    p.wait = function() {
        // Set the blocking of the sound.
        osweb.events._run(this, -1, osweb.constants.RESPONSE_SOUND,[]);
    };
    
    // Bind the sampler class to the osweb namespace.
    osweb.sampler_backend = sampler;
}());



(function() {
    // Definition of the class video.
    function video(experiment, src) {
      	// Set the class public properties. 
	this.experiment = experiment;
	
        // Set the class pivate properties. 
        this._playing = false; 
        this._script = null;

	// Create the video instance
	if (src !== null) {
            // Set the video object.
            this._ctx = osweb.runner._canvas.getContext('2d');
            this._video = src.data;
            
            // Set the event anchors.
            this._video.on("ended", osweb.events._videoEnded.bind(this));
            this._video.on("play" , osweb.events._videoPlay.bind(this));
    	}
    }; 
	
    // Extend the class from its base class.
    var p = video.prototype;
    
    // Definition of public properties. 
    p.audio = true;
    p.duration = 'keypress';	
    p.full_screen = false;
    
    // Definition of private methods.
    
    p._update_video_canvas = function() {
        // Clip the content of the video to the canvas.
        if (this._playing === true) {    
            this._ctx.drawImage(this._video, 0, 0);

            // execute script.
            if ((this._script !== null) && (this._event_handler_always === true)) {
                // Start the parser
                osweb.parser._run(null, this._script);    		
            }    
        }    
    };    
    
    // Definition of public methods.
    
    p.play = function() {
	// Play the actual video.
        this._video.play();
        
        // Set the volume
        this._video.volume = (this.audio === true) ? 1 : 0;
        
        // Check if the video must be scaled.
        if (this.full_screen == true) {    
            // Draw the first image with scaling.
            var xScale = (this.experiment._canvas._width  / this._video.videoWidth);
            var yScale = (this.experiment._canvas._height / this._video.videoHeight);
            this._ctx.scale(xScale,yScale);
        }
        
        // Draw the first frame.
        this._ctx.drawImage(this._video, 0, 0);
        
        // Set the play toggle.
        this._playing = true;
    };

    p.stop = function() {
	// Pause the actual sound.
	this._video.pause();
        this._playing = false;
    };

    p.wait = function() {
        // Set the blocking of the sound.
        osweb.events._run(this, -1, osweb.constants.RESPONSE_VIDEO,[]);
    };
    
    // Bind the video class to the osweb namespace.
    osweb.video_backend = video;
}());


(function() {
    // Definition of the class debug.
    function debug() {
    	throw 'The class debug cannot be instantiated!';
    }

    // Definition of public properties.
    debug.enabled = false;                        // Enable the debugger  
    debug.error = false;                         // true if an error occured.
    debug.messageLog = new Array();              // Arraty with alle log messages.

    // Definition of class private methods.               
   
    debug._initialize = function() {
    	// Enabled/disable the debugger.
    	this.debug = osweb.runner.debug;
    	// Clear the log.
        this.messageLog = [];
    };	

    debug._finalize = function() {
	// If enabled push the messages to the javascript console.
	if (this.enabled === true) {
            console.log(this.messageLog);			
	}

	// Clear the log.
	this.messageLog = [];
    };

    // Definition of the public methods.               
   
    debug.addError = function(error_text) {
    	// Set the error flag.
    	this.error = true;

        // Show the fatal error warning.
	console.log(error_text);
	console.log(osweb.constants.ERROR_001);

	// Throw the exception.
	throw new Error(error_text);	
    };
	
    debug.addMessage = function(message_text) {
        // Push the error message to the log.
	this.messageLog.push(message_text);		
	
	if (debug.enabled === true) {
            console.log(message_text);
        }    
    };

    debug.msg = function(message_text) {
	// Push the error message to the log.
	this.addMesage(message_text);
    };

    // Bind the debug class to the osweb namespace.
    osweb.debug = debug;
}());


/*
 * Definition of the class file_pool_store.
 */

(function() 
{
    function file_pool_store()
    {
    	throw "The class file_pool_store cannot be instantiated!";
    }; 
	
    // Definition of private class properties.
    file_pool_store._data  = [];
    file_pool_store._items = [];  
	
    /*
     * Definition of private class methods.   
     */

    file_pool_store.add_from_local_source = function(pItem)
    {
        var ext = pItem.filename.substr(pItem.filename.lastIndexOf('.') + 1);
        
        if ((ext == 'jpg') || (ext == 'png'))
	{
            // Create a new file pool mage item.
            var img = new Image();
            img.src = pItem.toDataURL();
            var item = {data: img, folder: pItem.filename, name: pItem.filename.replace(/^.*[\\\/]/, ''), size: pItem.length, type: 'image'};
	}
        else if ((ext == 'wav') || (ext == 'ogg'))
	{
            var ado = new Audio();
            ado.src = pItem.toDataURL();
            var item = {data: ado, folder: pItem.filename, name: pItem.filename.replace(/^.*[\\\/]/, ''), size: pItem.length, type: 'sound'};
	}
	else if (ext == 'ogv')
        {
            var ado = document.createElement("VIDEO");
            ado.src = pItem.toDataURL();
            var item = {data: ado, folder: pItem.filename, name: pItem.filename.replace(/^.*[\\\/]/, ''), size: pItem.length, type: 'video'};
        }    
        
	// Add the item to the pool.
	this._items.push(item);

	// Link the item as property
	this[item.name] = item;
    };

    file_pool_store.add_from_server_source = function(pPath, pFiles)
    {
        console.log('--');
        console.log(pFiles);

        // Check if there are stimuli files.
        if (pFiles.length > 0)
	{
            // Set the preloader.
            this._queue = new createjs.LoadQueue(false);
            createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);  // need this so it doesn't default to Web Audio
            this._queue.installPlugin(createjs.Sound);
 		
            this._queue.on("fileload", this._file_complete, this);
            this._queue.on("complete", this._load_complete, this);

            // Add the stimuli information to the loader.
            for (var i=0;i < pFiles.length;i++)
            {
                var re = /(?:\.([^.]+))?$/;
                var extention = re.exec(pFiles[i]);
                console.log(extention);
                
                if (extention[0] == '.ogg')
                {
                    console.log('sound');
                    this._queue.loadFile({id: pFiles[i], src: pPath + pFiles[i], type: createjs.AbstractLoader.SOUND});
                }    
                else
                { 
                    this._queue.loadFile({id: pFiles[i], src: pPath + pFiles[i], type: createjs.AbstractLoader.IMAGE});
                }        
            }
	
            // Load the stimuli files.
            this._queue.load();
        }
        else
        {
            // Build the experiment objects using the given script.
            osweb.runner._buildExperiment();
        } 
    }; 
    
    file_pool_store._file_complete = function(pEvent)
    {
	// Update the loader text.
	osweb.runner._updateIntroScreen(osweb.constants.MESSAGE_007);

        // Push the stimulus item to the stimuli object.
        var item = {data: pEvent.result, folder: pEvent.item.id, name: pEvent.item.id.replace(/^.*[\\\/]/, ''), size: pEvent.item.id, type: 'image'};
        
        // Add the item to the pool.
	this._items.push(item);

	// Link the item as property
	this[item.name] = item;
    };	
	
    file_pool_store._load_complete = function()
    {
	// Update the loader text.
	osweb.runner._updateIntroScreen(osweb.constants.MESSAGE_006);

        console.log(this._items);

	// Building is done, go to next phase.
        osweb.runner._buildExperiment();
    };	

    /*
     * Definition of public class methods.   
     */

    file_pool_store.add = function(pPath, pNew_Name)
    {
    	// Copies a file to the file pool. 
    };
	
    file_pool_store.fallback_folder = function()
    {	
    	// The full path to the fallback pool folder.
    };
	
    file_pool_store.files = function()
    {
    	// Returns all files in the file pool.
    };

    file_pool_store.folder = function()
    {
    	// The full path to the (main) pool folder.
    };
	
    file_pool_store.folders = function()
    {
    	// Gives a list of all folders that are searched when retrieving the full path to a file. 
    };

    file_pool_store.in_folder = function(pPath)
    {
    	// Checks whether path is in the pool folder. 
    };

    file_pool_store.rename = function(pOld_path, pNew_path)
    {
	// Renames a file in the pool folder.
    };
	
    file_pool_store.size = function()
    {
	// The combined size in bytes of all files in the file pool.
    };

    // Bind the stack file_pole_store to the osweb namespace.
    osweb.pool = file_pool_store;
}());


/*
 * Definition of the class functions.
 */

(function() 
{
    function functions() 
    {
	throw "The class functions cannot be instantiated!";
    }

    /*
     * Definition of general function methods.   
     */

    functions._initialize = function()
    {
	window['print']		 = this.print;
	window['randint']        = this.randint;
        
	// Create the global function calls for use in the inlide script item.
	window['canvas']         = this.canvas;
	window['copy_sketchpad'] = this.copy_sketchpad;
	window['keyboard']       = this.keyboard;
	window['mouse']          = this.mouse;
	window['pause']          = this.pause;
	window['reset_feedback'] = this.reset_feedback;	
	window['sampler']        = this.sampler;
	window['set_response']   = this.set_response;
	window['set_subject_nr'] = this.set_subject_nr;	
	window['sometimes']      = this.sometimes;
	window['synth'] 	 = this.synth;
	window['xy_circle'] 	 = this.xy_circle;
	window['xy_distance'] 	 = this.xy_distance;
	window['xy_from_polar']  = this.xy_from_polar;
	window['xy_grid'] 	 = this.xy_grid;
	window['xy_random'] 	 = this.xy_random;
	window['xy_to_polar']    = this.xy_to_polar;
    };
		
    /*
     * Definition of general function methods.   
     */

    functions.print = function(pString)
    {
	console.log('print output:' + pString);
    };

    functions.randint = function(pStart, pEnd)
    {
        var multiplier = pEnd - pStart;
        var rand = Math.floor(Math.random() * multiplier);
        return rand + pStart;
    };

    /*
     * Definition of general function methods.   
     */

    functions.canvas = function(pAuto_prepare, pStyle_args)
    {
        console.log('warning: function "canvas" not available yet.');
    };

    functions.copy_sketchpad = function(pName)
    {
        console.log('warning: function "copy_sketchpad" not available yet.');
    };

    functions.keyboard = function(pResp_args)
    {
        console.log('warning: function "keyboard" not available yet.');
    };

    functions.mouse = function(pResp_args)
    {
        console.log('warning: function "mouse" not available yet.');
    };

    functions.pause = function()
    {
        console.log('warning: function "pause" not available yet.');
    };

    functions.reset_feedback = function()
    {
        console.log('warning: function "reset_feedback" not available yet.');
    };

    functions.sampler = function(pSrc, pPlayback_args)
    {
        console.log('warning: function "sampler" not available yet.');
    };

    functions.set_response = function(pResponse, pResponse_time, pCorrect)
    {
        console.log('warning: function "set_response" not available yet.');
    };
	
    functions.set_subject_nr = function(pNr)
    {
        console.log('warning: function "set_subject_nr" not available yet.');
    };

    functions.sometimes = function(pP)
    {
        console.log('warning: function "sometimes" not available yet.');
    };

    functions.synth = function(pOsc, pFreq, pLength, pAttack, pDecay)
    {
        console.log('warning: function "synth" not available yet.');
    };

    functions.xy_circle = function(pN, pRho, pPhi0, pPole)
    {
        console.log('warning: function "xy_circle" not available yet.');
    };

    functions.xy_distance = function(pX1, pY1, pX2, pY2)
    {
        console.log('warning: function "xy_distance" not available yet.');
    };

    functions.xy_from_polar = function(pRho, pPhi, pPole)
    {
        console.log('warning: function "xy_from_polar" not available yet.');
    };

    functions.xy_grid = function(pN, pSpacing, pPole)
    {
        console.log('warning: function "xy_grid" not available yet.');
    };

    functions.xy_random = function(pN, pWidth, pHeight, pMin_dist, pPole)
    {
        console.log('warning: function "xy_random" not available yet.');
    };

    functions.xy_to_polar = function(pX, pY, pPole)
    {
        console.log('warning: function "xy_to_polar" not available yet.');
    };

    // Bind the functions class to the osweb namespace.
    osweb.functions = functions;
}()); 


/*
 * Definition of the class heartbeat.
 */

(function() 
{
    function heartbeat(pExperiment, pInterval)
    {
        // Set the class public properties. 
    	this.experiment = pExperiment;
	this.interval   = (typeof pInterval === 'undefined') ? 1 : pInterval;	
    }; 
	
    // Extend the class from its base class.
    var p = heartbeat.prototype;
    
    // Define the class public properties. 
    p.experiment = null;
    p.interval   = -1;

    /*
     * Definition of class private methods.   
     */

    p.beat = function()
    {
    };

    p.run = function()
    {
    };

    p.start = function()
    {
    };
	
    // Bind the heartbeat class to the osweb namespace.
    osweb.heartbeat = heartbeat;
}());


/*
 * Definition of the class item_stack.
 */

(function() 
{
    function item_stack()
    {
   	throw "The class item_stack cannot be instantiated!";
    }; 
	
    // Definition of private class properties.
    item_stack._items = [];  
	
    /*
     * Definition of public class methods.   
     */

    item_stack.clear = function()
    {
    	// Clears the stack.
	this._items = [];
    };

    item_stack.push = function(pItem, pPhase)
    {
    	// Create the stack item.
	var StackItem = {'item': pItem, 'phase': pPhase};

	// Push the item onto the stack.
	this._items.push(StackItem);
    };	

    item_stack.pop = function()
    {
	// Pops the last item from the stack.
	return this._items.pop();
    };

    // Bind the item_stack class to the osweb namespace.
    osweb.item_stack = item_stack;
}());


/*
 * Definition of the class item_store.
 */

(function() 
{
    function item_store()
    {
	throw "The class item_store cannot be instantiated!";
    } 
		
    // Set the class private properties. 
    item_store._experiment = null;
    item_store._items      = {};
    
    /*
     * Definition of public methods - running item.         
     */
    
    item_store.execute = function(pName, pParent)
    {
	// Executes the run and prepare phases of an item, and updates the item stack.
	this.prepare(pName);
	this.run(pName, pParent);
    };

    item_store.items = function()
    {
	// Create a list o keys.
        var items = [];
        for (var key in this._items) 
        {
            items.push([key ,this._items[key]]);
        }    
        
        // Returns a list of item names.
	return items;
    };

    item_store.keys = function()
    {
	// Create a list o keys.
        var keys = [];
        for (var key in this._items) 
        {
            keys.push(key);
        }    
        
        // Returns a list of item names.
	return keys;
    };

    item_store.new = function(pType, pName, pScript)
    {
	// Check if the element is part of the osweb name space
	if (osweb.isClass(pType) == true)
	{
            // Add the new item as property of items.
            this._items[pName] = osweb.newItemClass(pType, this._experiment, pName, pScript);
        }
	else
	{
            // Unkwone class definition, show error message.
            osweb.debug.addError(osweb.constants.ERROR_009 + pType);
	}
    };
    
    item_store.prepare = function(pName, pParent)
    {
        // Executes the prepare phase of an item, and updates the item stack.
	osweb.item_stack.push(pName, 'prepare');
        
        this._items[pName]._parent = pParent;
        this._items[pName].prepare();
    };	

    item_store.run = function(pName, pParent)
    {
	// Set the current and its parent item.
	osweb.events._current_item         = this._items[pName];
	osweb.events._current_item._parent = pParent;
		
	// Executes the run phase of an item, and updates the item stack.
	osweb.item_stack.push(pName, 'run');
	this._items[pName].run();
    };

    item_store.valid_name = function(pItem_type, pSuggestion)
    {
        // Check the optional parameters.
        pSuggestion = (typeof pSuggestion === 'undefined') ? null : pSuggestion;
        
        if (pSuggestion == null)
        {
            var name = 'new_' + pItem_type;
        }
        else
        {
            var name = this._experiment.syntax.sanitize(pSuggestion, true, false);
        }   
        
        // Create a unique name.
        var i     = 1;
        var _name = name;
        while (this._items.hasOwnProperty(_name) == true)
        {
            _name = name + '_' + String(i);
	    i++;
        } 

        // Return function result
        return _name; 
    };    
    
    item_store.values = function()
    {
  	// Create a list o keys.
        var values = [];
        for (var key in this._items) 
        {
            values.push(this._items[key]);
        }    
        
        // Returns a list of item names.
	return values;
    };

    // Bind the item_store class to the osweb namespace.
    osweb.item_store = item_store;
}());


/*
 * Definition of the class prng.
 */

(function() 
{
    function prng()
    {
    	throw "The class prng cannot be instantiated!";
    }; 
	
    // Set the class private properties. 
    prng._previous = 0;
    prng._prng     = uheprng();    
    prng._seed     = '0';

    /*
     * Definition of class methods - run cycle.   
     */
    
    prng._initialize = function()
    {
        // Create the random seed. 
        this._prng.initState();
        this._prng.hashString(this._seed); 
    };

    /*
     * Definition of class methods.   
     */

    prng._getNext = function() 
    {
        // Get the next random number.
        this._previous = (this._prng(1000000000000000) / 1000000000000000);
        
        // Return function result.
        return this._previous;
	};

    prng._getPrevious = function() 
    {
        // Return function result.
        return this._previous;
    };

    prng._getSeed = function() 
    {
        // Return the current seed value.
        return this._seed;        
    };

    prng._random = function(pMin, pMax) 
    {
        // Calculate the range devider.
        var devider = (1 / ((pMax - pMin) + 1));
         
        // Get the random number and devide it.
        this._previous = ((this._prng(1000000000000000) / 1000000000000000));
        
        // Set the devider.
        this._previous = pMin + Math.floor(this._previous / devider);
               
        // Return function result. 
        return this._previous;
    };

    prng._reset = function() 
    {
        // Set the random seed value to 0. 
        this._seed = '0';

        // Reset the PRNG range.
        this._prng.initState();
        this._prng.hashString(String(this._seed));
    };
    
    prng._setSeed = function(pSeed) 
    {
        // Set the random seed value. 
        this._seed = String(pSeed);
        
        // Reset the PRNG range.
        this._prng.initState();
        this._prng.hashString(this._seed);
    };

    // Bind the prng class to the osweb namespace.
    osweb.prng = prng;
}());


/*
 * Definition of the class python_workspace.
 */

(function() 
{
    function python_workspace()
    {
    	throw "The class python_workspace cannot be instantiated!";
    }; 
	
    /*
     * Definition of public class methods.   
     */
    
    python_workspace._eval = function(pBytecode)
    {
        // Check wich type of expression must be evaled.
        if (typeof pBytecode === 'boolean')    
        {
            return pBytecode;
        }
        else if (typeof pBytecode === 'string')
        {
            // Open sesame script, first check for parameter values. 
            pBytecode = osweb.syntax.eval_text(pBytecode);
           
            // Evaluate the expression.
            eval_string = osweb.syntax.remove_quotes(pBytecode)
            if(eval_string == "always"){
                b;
                return true;
            }else if(eval_string == "never"){
                return false;
            }else{
                return eval(eval_string);
            }    
        }
        else
        {
            console.log('>python script - not supported yet');
            return eval(pBytecode);
        }    
    };
	
    python_workspace.init_globals = function()
    {
    };
	
    // Bind the python_workspace class to the osweb namespace.
    osweb.python_workspace = python_workspace;
}());

 
/*
 * Definition of the class syntax.
 */

(function() 
{
    function syntax()
    {
    	throw "The class syntax cannot be instantiated!";
    }; 

    /*
     * Definition of private class methods.   
     */

    syntax._convertPython = function(pScript)
    {
    	return pScript;
    };

    syntax.isNumber = function(n)
    {
        return Number(n) == n; // aangepast van == naar === en weer terug naar '==' anders werkt duration niet.
    };

    syntax.isFloat = function(n)
    {
        return Number(n) === n && n % 1 !== 0;
    };

    syntax.remove_quotes = function(pString)
    {
        if (pString == '""')
        {
            return '';
        }    
        else if ((pString[0] == '"') && (pString[pString.length - 1] == '"'))
	{
            return pString.slice(1, pString.length - 1);
	}
	else
	{
            return pString;
	}	
    };

    /*
     * Definition of public class methods.   
     */
    
    syntax.compile_cond = function(pCnd, pBytecode)
    {
	// Check for conditional paramters.
	pBytecode = (typeof pBytecode === 'undefined') ? true : pBytecode;	
		
	if (pCnd == 'always')
	{
            return true;
	} 
	else if (pCnd == 'never')
	{
            return false;
	} 
        else
	{
            if (pCnd.substring(0,1) == '=')
            {
                // Python script, compile it to an ast tree.
                console.log('python script is not supported yet');
            } 
            else
            {
                // opensesame script, convert it to javascript.
                pCnd = pCnd.replace(/[^(!=)][=]/g, '==');
            }
        }    

        return pCnd;
    };
	
    syntax.eval_text = function(pTxt, pVars, pRound_float, pVar)
    {
	// Evaluates variables and inline Python in a text string.
	var result     = pTxt;
	var processing = result.search(/[^[\]]+(?=])/g);
		
	while (processing != -1)
	{
            // Replace the found value with the variable.
            var variable = result.slice(processing,result.indexOf(']'));
           
            if (typeof pVars === 'undefined')
            {
                var value = osweb.runner.experiment.vars[variable];
            }
            else
            {
                var value = pVars[variable];
            } 
            
            result	 = result.replace('[' + variable + ']',value);			
            processing   = result.search(/[^[\]]+(?=])/g);
        }

        return result;
    };

    syntax.parse_cmd = function(pString)
    {
	// split the astring.
	var tokens = this.split(pString);
	tokens.shift();
	tokens.shift();
	return tokens;
    };

    syntax.sanitize = function(pString, pStrict, pAllowVars)
    {
	// Removes invalid characters (notably quotes) from the string.
	return pString;
    };

    syntax.split = function(pLine)
    {
    	// Return an array with tokens ignoring whitespaces within. 
	var result = pLine.match(/(?:[^\s"]+|"[^"]*")+/g);
        
        return (result != null) ? result : [];
    };    

    // Bind the syntax class to the osweb namespace.
    osweb.syntax = syntax;
}());


/*
 * Definition of the class var_store.
 */

(function() 
{
    function var_store(pItem, pParent)
    {
        // Set the class properties. 
        this._item   = pItem;
        this._parent = pParent;
    }; 
	
    // Extend the class from its base class.
    var p = var_store.prototype;
    
    // Set the class default properties. 
    p._item   = null;
    p._parent = null;        
	
    /*
     * Definition of public class methods.   
     */

    p.get = function(pVar, pDefault, pEval, pValid)
    {
	// Set the optional arguments
	pDefault = (typeof pDefault === 'undefined') ? null : pDefault;
	pEval    = (typeof pEval === 'undefined')    ? true : pEval;
	pValid   = (typeof pValid === 'undefined')   ? null : pValid;
		
	var value = null;

	// Gets an experimental variable.
	if (pVar in this)
	{
            if (typeof this[pVar] == 'string')
            {
	 	value = osweb.syntax.eval_text(this[pVar]);
            }
            else
            {
 		value = this[pVar];
            }
 	}

	// Return function result.
	return value;
    };

    p.inspect = function()
    {
	var keys = [];
	for(var key in this)
  	{
            keys.push(key);
   	}
   		
   	// Slide default properties. 
   	keys = keys.slice(2,keys.length - 3);
   		
	return keys;
    };

    p.set = function(pVar, pVal)
    {
	// Sets and experimental variable.
	this[pVar] = pVal;
    };
	
    // Bind the vars class to the osweb namespace.
    osweb.var_store = var_store;
}());

	
/*
 * Definition of the class item.
 */

(function() 
{
    function item(pExperiment, pName, pScript)
    {
	// Set the class private properties.
	this._get_lock = null;
	this._parent   = null;
	this._status   = osweb.constants.STATUS_NONE;

        // Set the class public properties.
	this.count      = 0;	
	this.debug	= osweb.debug.enabled;
	this.experiment = (pExperiment == null) ? this : pExperiment;
	this.name       = pName;	
	this.vars 	= (this.vars) ? this.vars : new osweb.var_store(this, null);

        // Set the object realted properties.
	this.clock            = this.experiment._clock;		
	this.log              = this.experiment._log;
	this.python_workspace = this.experiment._python_workspace;	
        this.syntax           = this.experiment._syntax; 	
	
        // Read the item definition string.	
	this.from_string(pScript);
    } 
	
    // Extend the class from its base class.
    var p = item.prototype;

    // Definition of class public properties. 
    p.clock            = null;
    p.comments         = null;
    p.count            = 0;
    p.debug            = false;
    p.experiment       = null;
    p.log              = null;
    p.name             = '';
    p.syntax           = null;
    p.python_workspace = null;
    p.vars             = null;
    p.variables        = null;

    /*
     * Definition of public methods - general function.
     */

    p.dummy = function()
    {
    	// Dummy function, continue execution of an item directly.
    };
   
    p.resolution = function()
    {
    	/* // Returns the display resolution and checks whether the resolution is valid.
        var w = this.vars.get('width');
	var h = this.vars.get('height');
	if ((typeof w !== 'number') || (typeof h !== 'number'))
	{
            osweb.debug.addError('(' + String(w) + ',' + String(h) + ') is not a valid resolution');
        }
        
        return [w, h]; */
    };
   
    p.set_response = function(pResponse, pResponse_time, pCorrect)
    {
	// Processes a response in such a way that feedback variables are updated as well.
        console.log('warning: method "item.set_response" not implemented yet.');
    };
 
    p.sleep = function(pMs)
    {
	// Pauses the object execution. !WARNING This function can not be implemented due the script blocking of javascript.
	this.clock.sleep(pMs);
    };

    p.time = function()
    {
	// Returns the current time.
    	return this.clock.time();
    };

     /*
     * Definition of public methods - build cycle.         
     */

    p.from_string = function(pString)
    {
	// Parses the item from a definition string.
	osweb.debug.addMessage('');
        this.variables = {};
	this.reset();
	this.comments = [];
	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
                if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                   
                    this.parse_line(lines[i]);
                }
            }
	}					
    };
	
    p.parse_comment = function(pLine)
    {
	// Parses comments from a single definition line, indicated by # // or '.
	pLine = pLine.trim();
	if ((pLine.length > 0) && (pLine.charAt(0) == '#'))
	{
            // Add comments to the array removing the first character.
            this.comments.push(pLine.slice(1));

            return true;
	}	
	else if ((pLine.length > 1) && (pLine.charAt(0) == '/'))
	{
            // Add comments to the array removing the first two characters.
            this.comments.push(pLine.slice(2));
            
            return true;			
	}
	else
	{
            return false;
	}
    };	
	
    p.parse_keyword = function(pLine, pFrom_ascii, pEval)
    {
    };

    p.parse_line = function(pLine)
    {
	// Allows for arbitrary line parsing, for item-specific requirements.
    };

    p.parse_variable = function(pLine)
    {
        // Reads a single variable from a single definition line.
        if (this.parse_comment(pLine))
        {
            return true;
        }
        else
        {
            var tokens = osweb.syntax.split(pLine);
            if ((tokens != null) && (tokens.length > 0) && (tokens[0] == 'set'))
            {
		if (tokens.length != 3)
		{
                    osweb.debug.addError('Error parsing variable definition: ' + pLine);
		}	
            	else
		{
                    // Rettrieve the value of the variable, remove additional quotes.
                    var value = osweb.syntax.remove_quotes(tokens[2]);
                 
                    // Check for number types.
                    value = osweb.syntax.isNumber(value) ? Number(value) : value;
                    
                    this.vars.set(tokens[1], value);

                    return true;
		}
            }
            else
            {
		return false;
            }
        }	
    };
	
    /*
     * Definition of public methods - runn cycle. 
     */
    
    p.reset = function()
    {
	// Resets all item variables to their default value.
    };

    p.prepare = function()
    {
	// Implements the prepare phase of the item.
	this.experiment.vars.set('count_' + this.name, this.count);
	this.count++;
		
	// Set the status to initialize.
	this._status = osweb.constants.STATUS_INITIALIZE;
    	
        // For debugging.
        osweb.debug.addMessage('prepare' + this.name);
        
        // Implements the complete phase of the item (to support blocking script in the prepare phase).
	if ((this._parent !== null) && (this.type !== 'feedback'))
	{
            // Prepare cycle of parent.
            this._parent.prepare_complete();
        }
    };

    p.prepare_complete = function()
    {
        // Dummy function for completion process.
    };

    p.set_item_onset = function(pTime)
    {
 	// Set a timestamp for the item's executions
	var time = (pTime != null) ? pTime : this.clock.time();
	this.experiment.vars.set('time_' + this.name, time);
    };	

    p.run = function()
    {
    	// Implements the run phase of the item.
        osweb.debug.addMessage('run' + this.name);
    };

    p.update = function()
    {
    	// Implements the update phase of the item.
    };
    
    p.update_response = function(pResponse)
    {
	// Implements the update_response phase of an item.
    };	

    p.complete = function()
    {
    	// Implements the complete phase of the item.
	if (this._parent !== null)
	{
            // Return the process control to the parent of the element.
            osweb.events._current_item = this._parent;
            osweb.events._current_item.run();  
	}
    };
  
    // Bind the item class to the osweb namespace.
    osweb.item = item;
}());


/*
 * Definition of the class generic_response.
 */

(function() 
{
    function generic_response(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.item_constructor(pExperiment, pName, pScript);
	
	// Definition of private properties.
	this._allowed_responses = null;
	this._duration          = 0;
	this._duration_func 	= null;
	this._keyboard		= null;
	this._mouse             = null;
	this._responsetype	= osweb.constants.RESPONSE_NONE;
	this._timeout           = -1;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(generic_response, osweb.item);

    // Definition of public properties.
    p.auto_response    = "a";
    p.process_feedback = false;
    p.synonyms         = null;
  
    /*
     * Definition of public methods - build cycle. 
     */

    p.auto_responser = function()
    {
    };

    p.auto_responser_mouse = function()
    {
    };

    p.prepare_allowed_responses = function()
    {
        // Prepare the allowed responses..
        if (this.vars.get('allowed_responses') == null)
	{
            this._allowed_responses = null;
	}
	else
	{	
            // Create a list of allowed responses that are separated by semicolons. Also trim any whitespace.
            var allowed_responses = String(this.vars.allowed_responses).split(';');
            
            if (this.vars.duration == 'keypress')
            {	
		//this._allowed_responses = allowed_responses;
                this._allowed_responses = this._keyboard._get_default_from_synoniem(allowed_responses);
            }
            else if (this.vars.duration == 'mouseclick')
            {
                // For mouse responses, we don't check if the allowed responses make sense.
            	this._allowed_responses = this._mouse._get_default_from_synoniem(allowed_responses);
            }
            
            // If allowed responses are provided, the list should not be empty.
            if (this._allowed_responses.length == 0)
            {
		osweb.debug.addError(this.vars.get('allowed_responses') + ' are not valid allowed responses in keyboard_response '+ this.name);	
            } 
	}
    };
		
    p.prepare_duration = function()
    {
	// Prepare the duration.
        if (this.vars.get('duration') != null)
	{
            if (typeof this.vars.duration == 'number')
            {
        	// Prepare a duration in milliseconds
		this._duration = this.vars.duration;
		if (this._duration == 0)
		{
                    this._responsetype = osweb.constants.RESPONSE_NONE;
		}
		else
		{	
                    this._responsetype = osweb.constants.RESPONSE_DURATION;
		}
            }
            else
            {
		this._duration = -1;
		if (this.vars.duration == 'keypress')
		{
                    this.prepare_duration_keypress();
                    this._responsetype = osweb.constants.RESPONSE_KEYBOARD;
		}
		else if (this.vars.duration == 'mouseclick')
		{
                    this.prepare_duration_mouseclick();
                    this._responsetype = osweb.constants.RESPONSE_MOUSE;
		}
                else if (this.vars.duration == 'sound')
                {
                    this._responsetype = osweb.constants.RESPONSE_SOUND;
                } 
                else if (this.vars.duration == 'video')
                {
                    this._responsetype = osweb.constants.RESPONSE_VIDEO;
                } 
            }		
	}
    };
	
    p.prepare_duration_keypress = function()
    {
        // Prepare a keyboard duration.
	this._keyboard = new osweb.keyboard(this.experiment);
	if (this.experiment.auto_response == true)
	{
            this._duration_func = this.auto_responder;
	}
	else
	{
            var final_duration = (this._timeout != -1) ? this._timeout : this._duration;
            this._keyboard.set_config(final_duration, this._allowed_responses);
	}
    };
	
    p.prepare_duration_mouseclick = function(self)
    {
	// Prepare a mouseclick duration.
	this._mouse = new osweb.mouse(this.experiment);
	if (this.experiment.auto_response == true)
	{
            this._duration_func = this.auto_responder_mouse;
	}
	else
	{
            var final_duration = (this._timeout != -1) ? this._timeout : this._duration;
            this._mouse.set_config(final_duration, this._allowed_responses, false);
	}
    };	

    p.prepare_timeout = function()
    {
	// Prepare the timeout.
	if (this.vars.get('timeout') != null) 
	{
            if (typeof this.vars.timeout == 'number')
            {
		// Prepare a duration in milliseconds
            	this._timeout = this.vars.timeout;
            }
            else
            {
		this._timeout = -1;
            }		
	}
    };	
    
    /*
     * Definition of public methods - run cycle. 
     */

    p.process_response_keypress = function(pRetval)
    {
	this.experiment._start_response_interval = this.sri;
	this.experiment._end_response_interval   = pRetval.rtTime;
	this.experiment.vars.response            = this.syntax.sanitize(pRetval.resp);
	this.synonyms                            = this._keyboard.synonyms(this.experiment.vars.response); 
	this.response_bookkeeping();
    };
	
    p.process_response_mouseclick = function(pRetval)
    {
 	this.experiment._start_response_interval = this.sri;
	this.experiment._end_response_interval   = pRetval.rtTime;
	this.experiment.vars.response		 = pRetval.resp;
	this.synonyms                            = this._mouse.synonyms(this.experiment.vars.response);
	this.experiment.vars.cursor_x            = pRetval.event.clientX;
	this.experiment.vars.cursor_y            = pRetval.event.clientY;
	this.response_bookkeeping();
    };

    p.response_bookkeeping = function()
    {
	// The respone and response_time variables are always set, for every response item
	this.experiment.vars.set('response_time', this.experiment._end_response_interval - this.experiment._start_response_interval);
	this.experiment.vars.set('response_' + this.name, this.experiment.vars.get('response'));
	this.experiment.vars.set('response_time_' + this.name, this.experiment.vars.get('response_time'));
	this.experiment._start_response_interval = null;

	// But correctness information is only set for dedicated response items, such as keyboard_response items, because otherwise we might confound the feedback
	if (this.process_feedback == true)
	{
            // debug.msg(u"processing feedback for '%s'" % self.name)
            if (this.vars.correct_response != null)
            {
                // If a correct_resbponse has been defined, we use it to determine accuracy etc.
		if (this.synonyms != null)  
		{
                    if (this.synonyms.indexOf(String(this.vars.get('correct_response'))) != -1)
                    { 
                        this.experiment.vars.correct       = 1;
			this.experiment.vars.total_correct = this.experiment.vars.total_correct + 1;
                    }
                    else
                    {
                        this.experiment.vars.correct = 0;
                    }
		}	
		else
		{
                    this.experiment.vars.correct = 'undefined';
                    /* if self.experiment.response in (correct_response, safe_decode(correct_response)):
                    	self.experiment.var.correct = 1
			self.experiment.var.total_correct += 1
                    else:
                    	self.experiment.var.correct = 0 */
		}
            }
            else
            {
                // If a correct_response hasn't been defined, we simply set correct to undefined.
		this.experiment.vars.correct = 'undefined';
            }	

            // Do some response bookkeeping
            this.experiment.vars.total_response_time   = this.experiment.vars.total_response_time + this.experiment.vars.response_time;
            this.experiment.vars.total_responses       = this.experiment.vars.total_responses + 1;
            this.experiment.vars.accuracy              = Math.round(100.0 * this.experiment.vars.total_correct / this.experiment.vars.total_responses);
            this.experiment.vars.acc        	       = this.experiment.vars.accuracy;
            this.experiment.vars.average_response_time = Math.round(this.experiment.vars.total_response_time / this.experiment.vars.total_responses);
            this.experiment.vars.avg_rt                = this.experiment.vars.average_response_time;
            this.experiment.vars.set('correct_' + this.name, this.vars.correct); 
	} 
    };	
	
    p.process_response = function()
    {
        // Start stimulus response cycle.
   	switch (this._responsetype)
   	{
            case osweb.constants.RESPONSE_NONE:
 		// Duration is 0, so complete the stimulus/response cycle.
 		this._status = osweb.constants.STATUS_FINALIZE;
                this.complete();
           
            break;
            case osweb.constants.RESPONSE_DURATION:
		this.sleep_for_duration();
            
            break;
            case osweb.constants.RESPONSE_KEYBOARD:
                this._keyboard.get_key();
            
            break;
            case osweb.constants.RESPONSE_MOUSE:
                this._mouse.get_click();
            
            break;
            case osweb.constants.RESPONSE_SOUND:
               this._sampler.wait();

            break;
            case osweb.constants.RESPONSE_VIDEO:
               this._video.wait();
            
            break;
   	}		
    };

    p.set_sri = function(pReset)
    {
	// Sets the start of the response interval.
	if (pReset == true)
	{
            this.sri = self.vars.get('time_' + this.name);
            this.experiment._start_response_interval = this.vars.get('time_' + this.name);
	}
	
	if (this.experiment._start_response_interval == null)
	{
            this.sri = this.experiment.vars.get('time_' + this.name);
	}
	else
	{
            this.sri = this.experiment._start_response_interval;
	}
    };		

    p.sleep_for_duration = function()
    {
	// Sleep for a specified time.
	this.sleep(this._duration);		
    };
   
    /*
     * Definition of public methods - running item. 
     */
    
    p.prepare = function()
    {
	// Implements the prepare phase of the item.
	this.prepare_timeout();
	this.prepare_allowed_responses();
	this.prepare_duration();
    
        // Inherited.	
	this.item_prepare();
    };
    
    p.update_response = function(pResponse)
    {
        // Implements the update response phase of the item.
	if ((this._responsetype == osweb.constants.RESPONSE_KEYBOARD) && (pResponse.type == osweb.constants.RESPONSE_KEYBOARD)) 
	{
            this.process_response_keypress(pResponse);
	}
	else if ((this._responsetype == osweb.constants.RESPONSE_MOUSE) && (pResponse.type == osweb.constants.RESPONSE_MOUSE)) 
	{
            this.process_response_mouseclick(pResponse);     
	}
    }; 

    // Bind the generic_response class to the osweb namespace.
    osweb.generic_response = osweb.promoteClass(generic_response, "item");
}());


/*
 * Definition of the class experiment.
 */

(function() 
{
    function experiment(pExperiment, pName, pScript, pPool_folder, pExperiment_path, pFullscreen, pAuto_response, pLogfile, pSubject_nr, pWorkspace, pResources, pHeartbeat_interval)
    {
	// Set the items property for this experiment.
	osweb.item_store._experiment = this;

	// Set the optional arguments
	pLogfile = (typeof pLogfile === 'undefined') ? null : pLogfile;

	// Set the private properties. 
	this._end_response_interval   = null;
	this._start_response_interval = null;
	this._syntax                  = osweb.syntax;
	this._python_workspace        = (pWorkspace) ? pWorkspace : osweb.python_workspace;

	// Set the public properties. 
	this.auto_response      = (pAuto_response) ? pAuto_response : false;
	this.cleanup_functions  = [];
	this.heartbeat_interval = (pHeartbeat_interval) ? pHeartbeat_interval : 1;
	this.items              = osweb.item_store;
	this.output_channel 	= null;
	this.paused 		= false;
	this.plugin_folder 	= 'plugins';
	this.pool               = osweb.file_pool_store;
	this.resources 		= (pResources) ? pResources : {};
	this.restart 		= false;
	this.running		= false;
	this.vars               = new osweb.var_store(this, null);
		
	// Set default variables
	this.vars.start               = 'experiment';
	this.vars.title               = 'My Experiment';
	this.vars.bidi                = 'no';
	this.vars.round_decimals      = 2;
	this.vars.form_clicks         = 'no';
	this.vars.uniform_coordinates = 'no';

        // Sound parameters.
	this.vars.sound_freq          = 48000;
	this.vars.sound_sample_size   = -16; 
	this.vars.sound_channels      = 2;
	this.vars.sound_buf_size      = 1024;

	// Default backend
	this.vars.canvas_backend      = 'xpyriment';

	// Display parameters.
	this.vars.width               = 1024;
	this.vars.height              = 768;
	this.vars.background          = 'black';
	this.vars.foreground          = 'white';
	this.vars.fullscreen          = (pFullscreen) ? 'yes' : 'no';

	// Font parameters.
	this.vars.font_size           = 18;
	this.vars.font_family         = 'mono';
	this.vars.font_italic         = 'no';
	this.vars.font_bold 	      = 'no';
	this.vars.font_underline      = 'no'; 

	// Logfile parameters
	this.logfile = pLogfile;
	this.debug   = osweb.debug.enabled;

	// Create the backend objects.
	this._canvas = new osweb.canvas(this);
	this._clock  = new osweb.clock(this);
	this._log    = new osweb.log(this, this.logfile);
	
        // Set the global anchors.
        window['clock'] = this._clock;
        window['log']   = this._log;    
        
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(experiment, osweb.item);
  
    // Definition of public properties. 
    p.auto_response      = false;
    p.cleanup_functions  = [];
    p.heartbeat_interval = 1;
    p.items              = null;
    p.output_channel     = null;
    p.paused             = false;
    p.plugin_folder      = '';
    p.pool               = null;
    p.resources          = null;
    p.restart            = false;
    p.running            = false;
  	
    /*
     * Definition of public methods - general function.
     */

    p.item_prefix = function()
    {
	// A prefix for the plug-in classes, so that [prefix][plugin] class is used instead of the [plugin] class.
	return '';		
    };

    p.reset_feedback = function()
    {
	// Resets the feedback variables (acc, avg_rt, etc.)."""
	this.vars.total_responses       = 0;
	this.vars.total_correct         = 0;
	this.vars.total_response_time   = 0;
	this.vars.avg_rt                = 'undefined';
	this.vars.average_response_time = 'undefined';
	this.vars.accuracy              = 'undefined';
	this.vars.acc                   = 'undefined';
    };

    p.set_subject = function(pNr)
    {
	// Sets the subject number and parity (even/ odd). This function is called automatically when an experiment is started, so you do not generally need to call it yourself.
	this.vars.subject_nr = pNr;
	if ((pNr % 2) == 0)
	{
            this.vars.subject_parity = 'even';
	}
	else
	{
            this.vars.subject_parity = 'odd';
	}
    };
  
    /*
     * Definition of public methods - building item.         
     */

    p.read_definition = function(pString)
    {
    	// Extracts a the definition of a single item from the string.
	var line = pString.shift();
	var def_str = '';
    	while ((line != null) && (line.length > 0) && (line.charAt(0) == '\t'))
	{
            def_str = def_str + line + '\n';
            line = pString.shift();
	}	
	return def_str;
    };	

    p.from_string = function(pString)
    {
    	// Set debug message.
	osweb.debug.addMessage('building experiment');
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            this._source = pString.split('\n');
            var l = this._source.shift();
            while (l != null)
            {
		// Set the processing of the next line.
		var get_next = true;

                try
		{
                    // Split the single line into a set of tokens.
                    var t = osweb.syntax.split(l);					
		}
		catch(e)
		{
                    // u"Failed to parse script. Maybe it contains illegal characters or unclosed quotes?", \
		}	

		if ((t != null) && (t.length > 0))
		{
                    // Try to parse the line as variable (or comment)
                    if (this.parse_variable(l) == false)
                    {
                        if (t[0] == 'define') 
			{
                            if (t.length == 3)
                            {
				// Get the type, name and definition string of an item.
				var item_type = t[1];
                                var item_name = osweb.syntax.sanitize(t[2]);
				var def_str = this.read_definition(this._source);
					
				osweb.item_store.new(item_type, item_name, def_str); 
                            }
                            else
                            {
                                // raise osexception(u'Failed to parse definition',line=line);
                            }
			}
                    }
		}

		// Get the next line.
		if (get_next == true)
		{
                    l = this._source.shift();
		}
            }
	};
    };
    
    /*
     * Definition of public methods - backends.
     */

    p.init_clock = function()
    {
	// Initializes the clock backend.
	this._clock.initialize;
    };	

    p.init_display = function()
    {
	// Initializes the canvas backend.
	this._canvas.init_display(this);

        this._python_workspace['win'] = window;
    };

    p.init_heartbeat = function()
    {
	// Initializes heartbeat.
	if ((this.heartbeat_interval <= 0) || (this.vars.fullscreen == 'yes') || (this.output_channel == null))
	{
            this.heartbeat = null;
	}
	else
	{
            this.heartbeat = new osweb.heartbeat(this, 1); 	
            this.heartbeat.start();
	}
    };	

    p.init_log = function()
    {
    	// Open a connection to the log file.
	this._log.open(this.logfile); 	
    };

    p.init_random = function()
    {
	// Initializes the random number generators. For some reason
	/* import random
	random.seed()
	try:
            # Don't assume that numpy is available
            import numpy
            numpy.random.seed()
            except:
            pass */
    };

    p.init_sound = function()
    {
	// Intializes the sound backend.
	/* from openexp import sampler
	sampler.init_sound(self) */
    };

    /*
     * Definition of public methods - running item.         
     */

    p.run = function()
    {
	// Inherited.	
	this.item_run();
	
	// Runs the experiment.
        switch (this._status)
        {
            case osweb.constants.STATUS_INITIALIZE:

                // Set the status to finalize.
		this._status = osweb.constants.STATUS_FINALIZE;

		// Save the date and time, and the version of OpenSesame
		this.vars.datetime            = new Date().toString();
		this.vars.opensesame_version  = osweb.VERSION_NUMBER; 
		this.vars.opensesame_codename = osweb.VERSION_NAME; 
		this.running = true;
		this.init_random();
		this.init_display();
		this.init_clock();
		this.init_sound();
		this.init_log();
		this.python_workspace.init_globals();
		this.reset_feedback();
		this.init_heartbeat(); 
	
		// Add closing message to debug system.
		osweb.debug.addMessage('experiment.run(): experiment started at ' + new Date().toUTCString()); 

		if (osweb.item_store._items[this.vars.start] != null)
		{
                    osweb.item_stack.clear();
                    osweb.item_store.prepare(this.vars.start, this);
                    //osweb.item_store.execute(this.vars.start, this);
		}
		else
		{
                    osweb.debug.addError('Could not find item ' + self.vars.start +  ' , which is the entry point of the experiment');
		}

            break;
            case osweb.constants.STATUS_FINALIZE:

		// Add closing message to debug system.
                osweb.debug.addMessage('experiment.run(): experiment finished at ' +  new Date().toUTCString());

		// Complete the run process.
		this.end();
	
            break;
        }; 
    };

    p.end = function()
    {
	// Disable the run toggle.
        this.running = false;
	
        // Close the log file.
        this._log.close();
		
	// Disable the processing unit.
	osweb.events._current_item = null;
	
	// Clear the exprimental stage and enabled the mouse.
	osweb.runner._canvas.style.cursor = 'default';
        osweb.runner._stage.update(); 
			
	// Finalize the parent (runner).	
    	osweb.runner._finalize();
    };

    // Bind the experiment class to the osweb namespace.
    osweb.experiment = osweb.promoteClass(experiment, "item");
}());


/*
 * Definition of the class inline_script.
 */

(function() 
{
    function inline_script(pExperiment, pName, pScript)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
	
	// Define and set the public properties. 
	this._prepare_run  = false;   
        this._prepare_tree = null;
	this._run_tree     = null;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(inline_script, osweb.item);

    // Define and set the public properties. 
    p.description = 'Executes Python code';

    /*
     * Definition of private methods - compiling script.
     */

    p._compile = function(pScript)
    {
        if (pScript != '')
        {
            var locations = false;
            var parseFn   = filbert_loose.parse_dammit;
            var ranges    = false;
        		
            try 
	    {
        	var code  = pScript;
         	var ast   = parseFn(code, { locations: locations, ranges: ranges });
        
	       	return ast;
    	    }
       	    catch (e) 
            {
        	console.log('error');
        	console.log(e.toString());
    	   	
                return null;
            }
	}
	else
	{
            return null;
        }	   	
    };

    /*
     * Definition of public methods - building item.         
     */
		
    p.reset = function()
    {
	// Resets all item variables to their default value.
	this._var_info     = null;
	this.vars._prepare = '';
	this.vars._run     = '';
    };

    p.from_string = function(pString)
    {
    	// Parses a definition string.
	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var read_run_lines     = false;
            var read_prepare_lines = false;
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		var tokens = osweb.syntax.split(lines[i]);
			
		if ((tokens != null) && (tokens.length > 0))
		{
                    switch (tokens[0])
                    {
			case 'set': 
                            this.parse_variable(lines[i]);
                            
                        break;
			case '__end__':
                            read_run_lines     = false;
                            read_prepare_lines = false;
                            
			break;	
			case '___prepare__':
                            read_prepare_lines = true;
                            
			break;
			case '___run__':
                            read_run_lines = true;
                            
			break;
			default:
                            if (read_run_lines == true)
                            {
				this.vars._run = this.vars._run + lines[i] + '\n';
                            }
                            else if (read_prepare_lines == true)
                            {
                            	this.vars._prepare = this.vars._prepare + lines[i] + '\n';
                            }
                    }
		}
		else 
		{
                    if (read_run_lines == true)
                    {
			this.vars._run = this.vars._run + lines[i] + '\n';
                    }
                    else if (read_prepare_lines == true)
                    {
			this.vars._prepare = this.vars._prepare + lines[i] + '\n';
                    }
            	} 
            }
	}
    };

    /*
     * Definition of public methods - running item.         
     */

    p.prepare = function()
    {
        // Compile the script code to ast trees.
        this._prepare_tree = osweb.parser._prepare(this.vars._prepare);
        this._run_tree     = osweb.parser._prepare(this.vars._run);
	
        // Execute the run code.
 	if (this._prepare_tree != null)
    	{
            // Set the current item.
            osweb.events._current_item = this;
            
            // Set the prepare run toggle.
            this._prepare_run = true;
            
            // Start the parser
            osweb.parser._run(this, this._prepare_tree);    		
        }
        else
        {
            // Inherited.	
            this.item_prepare();
        }    
    };

    p.run = function()
    {
    	// Inherited.	
	this.item_run();
        
        // Record the onset of the current item.
	this.set_item_onset(); 

        // Execute the run code.
 	if (this._run_tree != null)
    	{
            // Set the prepare run toggle.
            this._prepare_run = false;
            
            // Start the parser
            osweb.parser._run(this, this._run_tree);    		
    	}
    };

    p.complete = function()
    {
        // Check if the parser is ready. 
        if (osweb.parser._status == 1)
        {
            // Process the current active node.
            osweb.parser._process_node();
        }
        else
        {    
            if (this._prepare_run === true)             
            {
                // Inherited prepare.	
                this.item_prepare();
            }    
            else
            { 
                // Inherited.           
                this.item_complete();
            }
        }    
    }; 
	
    p.complete_script = function()
    {
        // Added for video script functionaliry.
        this.complete();
    };

    // Bind the Sequence class to the osweb namespace.
    osweb.inline_script = osweb.promoteClass(inline_script, "item");
}());


/*
 * Definition of the class keyboard_response.
 */

(function() 
{
    function keyboard_response(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.generic_response_constructor(pExperiment, pName, pScript);

        // Definition of private properties. 
	this._flush    = 'yes';
	this._keyboard = new osweb.keyboard(this.experiment); 
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(keyboard_response, osweb.generic_response);

        // Definition of public properties. 
    p.description = 'Collects keyboard responses';
	
    /*
     * Definition of public methods - build cycle.
     */

    p.reset = function()
    {
	// Resets all item variables to their default value.
	this.auto_response          = 'space';
	this.process_feedback       = true; 
	this.vars.allowed_responses = null;
	this.vars.correct_response  = null;
	this.vars.duration          = 'keypress';
	this.vars.flush             = 'yes';
	this.vars.timeout           = 'infinite';
    };

    /*
     * Definition of public methods - run cycle.
     */

    p.prepare = function()
    {	
	// Set the internal flush property.
	this._flush = (this.vars.flush) ? this.vars.flush : 'yes';

    	// Inherited.	
	this.generic_response_prepare();
    };

    p.run = function()
    {
	// Inherited.	
	this.generic_response_run();

        // Record the onset of the current item.
	this.set_item_onset(); 
	
	// Flush responses, to make sure that earlier responses are not carried over.
        if (this._flush == 'yes')
	{	
            this._keyboard.flush();
	}		
	
        this.set_sri();
	this.process_response();
    };
	
    // Bind the keyboard_response class to the osweb namespace.
    osweb.keyboard_response = osweb.promoteClass(keyboard_response, "generic_response");
}());


/*
 * Definition of the class logger.
 */

(function() 
{
    function logger(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.item_constructor(pExperiment, pName, pScript);
	
        // Definition of private properties. 
	this._logvars = null;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(logger, osweb.item);

    // Definition of public properties. 
    p.description = 'Logs experimental data';
    p.logvars	  = [];
	
    /*
     * Definition of public class methods - build cycle.
     */

    p.reset = function()
    {
        // Resets all item variables to their default value.
	this._logvars      = null;
	this.logvars       = [];
	this.vars.auto_log = 'yes';
    };

    p.from_string = function(pString)
    {
	// Parses a definition string.
	this.variables = {};
	this.comments  = [];
	this.reset();

	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                    var tokens = osweb.syntax.split(lines[i]);
                    if ((tokens[0] == 'log') && (tokens.length > 0))
                    {
			this.logvars.push(tokens[1]);
                    }	
		}
            }
        }
    };	

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function()
    {
	// Inherited.	
	this.item_run();
		
	// Run item only one time.   
	if (this._status != osweb.constants.STATUS_FINALIZE)
	{
            // item is finalized.
            this._status = osweb.constants.STATUS_FINALIZE;

            this.set_item_onset();
            if (this._logvars == null)
            {
		if (this.vars.auto_log == 'yes')
		{
                    this._logvars = this.experiment._log.all_vars();
		}
		else
		{
                    this._logvars = [];
                    for (variable in this.logvars)
                    {
 			if ((variable in this._logvars) == false)
 			{
                            this._logvars.push(variable);
			}
                    }
                    this._logvars.sort();		
		}
            }
            this.experiment._log.write_vars(this._logvars); 

            // Complete the cycle.
            this.complete();
        };
    };

    p.complete = function()
    {
        // Inherited.	
        this.item_complete();
    };

    // Bind the logger class to the osweb namespace.
    osweb.logger = osweb.promoteClass(logger, "item");
}());


/*
 * Definition of the class loop.
 */

(function() 
{
    function loop(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.item_constructor(pExperiment, pName, pScript);

        // Definition of private properties. 
        this._break_if = '';
        this._cycles   = [];
        this._index    = -1;
        this._keyboard = null;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(loop, osweb.item);

    // Definition of public properties. 
    p.description = 'Repeatedly runs another item';
    p.matrix      = null;

    /*
     * Definition of public methods - building cycle.         
     */

    p.reset = function()
    {
	// Resets all item variables to their default value.
	this.matrix        = {};
	this.vars.cycles   = 1;
	this.vars.repeat   = 1;
	this.vars.skip     = 0;
	this.vars.offset   = 'no';
	this.vars.order    = 'random';
	this.vars.item     = '';
	this.vars.break_if = 'never';
    };

    p.from_string = function(pString)
    {
    	// Creates a loop from a definition in a string.
    	this.comments  = [];
	this.variables = {};
	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                    var tokens = osweb.syntax.split(lines[i]);
                    if ((tokens[0] == 'run') && (tokens.length > 1))
                    {
                    	this.vars.item = tokens[1];
                    }	
                    else if ((tokens[0] == 'setcycle') && (tokens.length > 3))
                    {
			var cycle = tokens[1];
			var name  = tokens[2];
			var value = osweb.syntax.remove_quotes(tokens[3]);
					
			// Check if the value is numeric
                        value = osweb.syntax.isNumber(value) ? Number(value) : value;

                        // Convert the python expression to javascript.
			if (value[0] == '=')
			{
                            // Parse the python statement. 
                            value = osweb.parser._prepare(value.slice(1));
                            
                            if (value !== null)        
                            {
                                value = value.body[0];
                            }    
			}

                        if (this.matrix[cycle] == undefined)
			{
                            this.matrix[cycle] = {};
			}
			
                        this.matrix[cycle][name] = value;
                    }	
		}
            }	
	}
    };
  
    /*
     * Definition of public methods - runn cycle.         
     */

    p.shuffle = function(list)
    {
        var i, j, t;
	for (i = 1; i < list.length; i++) 
	{
	    j = Math.floor(Math.random() * (1 + i));  
	    if (j != i) 
	    {
	        t       = list[i];                        
                list[i] = list[j];
	        list[j] = t;
            }
	}			
    };

    p.apply_cycle = function(cycle)
    {
	// Sets all the loop variables according to the cycle.
	if (cycle in this.matrix)
	{
            for (var variable in this.matrix[cycle])
            {
		// Get the value of the variable.
		var value = this.matrix[cycle][variable];

		// Check for python expression.
		if (typeof value === 'object')
                {
                    // value contains ast tree, run the parser.
                    try
                    {	
                        // Evaluate the expression
                        value = osweb.parser._runstatement(value);
                    }
                    catch (e)
                    {
                        // Error during evaluation.
                        osweb.debug.addError('Failed to evaluate ' + value + ' in loop item ' + this.name);
                    }						
                }
				
                // Set the variable.
                this.experiment.vars.set(variable, value);
            }
	}
    };
	
    p.prepare = function()
    {
	// Prepare the break if condition.
	if ((this.vars.break_if != '') && (this.vars.break_if != 'never'))
	{
            this._break_if = this.syntax.compile_cond(this.vars.break_if);
        }
	else
	{
            this._break_if = null;
	}

	//  First generate a list of cycle numbers
	this._cycles = [];
	this._index  = 0;
		
	// Walk through all complete repeats
	var whole_repeats = Math.floor(this.vars.repeat);
	for (var j = 0; j < whole_repeats; j++)
	{
            for (var i = 0; i < this.vars.cycles; i++)
            {
		this._cycles.push(i);
            }
	}
				
	// Add the leftover repeats.
	var partial_repeats = this.vars.repeat - whole_repeats;
	if (partial_repeats > 0)
	{
            var all_cycles = Array.apply(null, {length: this.vars.cycles}).map(Number.call, Number);    
            var remainder  = Math.floor(this.vars.cycles * partial_repeats);
            for (var i = 0; i < remainder; i++)
            {
                // Calculate random position.
                var position = Math.floor(Math.random() * all_cycles.length);     
                // Add position to cycles.
                this._cycles.push(position);
                // Remove position from array.
                all_cycles.splice(position,1);
            }
	}		

	// Randomize the list if necessary.
	if (this.vars.order == 'random')
	{
            this.shuffle(this._cycles);
	}	
	else
	{
            // In sequential order, the offset and the skip are relevant.
            if (this._cycles.length < this.vars.skip)  
            {
		osweb.debug.addError('The value of skip is too high in loop item ' + this.name + '. You cannot skip more cycles than there are.');
            }
            else
            {
		if (this.vars.offset == 'yes')
		{
                    // Get the skip elements.
                    var skip = this._cycles.slice(0, this.vars.skip);
					
                    // Remove the skip elements from the original location.
                    this._cycles = this._cycles.slice(this.vars.skip);

                    // Add the skip element to the end.
                    this._cycles = this._cycles.concat(skip);										
		}
		else
		{
                    this._cycles = this._cycles.slice(this.vars.skip);
		}
            }
	}
		
	// Create a keyboard to flush responses between cycles.
	this._keyboard = new osweb.keyboard(this.experiment);
	
        // Make sure the item to run exists.
	if (this.experiment.items._items[this.vars.item] === 'undefined')
        {
            osweb.debug.addError('Could not find item ' + this.vars.item + ', which is called by loop item ' + this.name);
        }    

        // Inherited.	
	this.item_prepare();
	
	// Set the onset time.
	this.set_item_onset();
    };

    p.run = function()
    {
        // Inherited.	
        this.item_run();

        if (this._cycles.length > 0)
        {
            var exit = false;
            this._index = this._cycles.shift();
            this.apply_cycle(this._index);
		
            if (this._break_if != null)
            {
                this.python_workspace['this'] = this;
                
                var break_if = osweb.syntax.eval_text(this._break_if); 
                
                if (this.python_workspace._eval(break_if) == true)
                {
                    exit = true;
                }	
            }
			
            if (exit == false)
            {
		this.experiment.vars.repeat_cycle = 0;
		
                osweb.item_store.prepare(this.vars.item, this);
                //osweb.item_store.execute(this.vars.item, this);
            }
            else
            {
                // Break the loop.
                this.complete();
            }
        }
        else
        {
            // Break the loop.
            this.complete();
        }
    };	

    p.complete = function()
    {
        // Check if if the cycle must be repeated.
	if (this.experiment.vars.repeat_cycle == 1)
	{
            osweb.debug.msg('repeating cycle ' + this._index);
			
            this._cycles.push(this._index);
            
            if (this.vars.order == 'random')
            {
		this.shuffle(this._cycles);
            }
    	}
        else
        {
            // All items are processed, set the status to finalized.
            this._status = osweb.constants.STATUS_FINALIZE;

            // Inherited.	
            this.item_complete();
        }    
    };

    // Bind the loop class to the osweb namespace.
    osweb.loop = osweb.promoteClass(loop, "item");
}());


/*
 * Definition of the class mouse_response.
 */

(function() 
{
    function mouse_response(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.generic_response_constructor(pExperiment, pName, pScript);

        // Definition of private properties. 
	this._flush = 'yes';
	this._mouse = new osweb.mouse(this.experiment);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(mouse_response, osweb.generic_response);

    // Definition of public properties. 
    p.description = 'Collects mouse responses';
    p.resp_codes  = {};
	
    /*
     * Definition of public methods - build cycle.
     */
	
    p.reset = function()
    {
	// Resets all item variables to their default value.
	this.auto_response          = 1;
	this.process_feedback       = true;
	this.resp_codes             = {};
	this.resp_codes['0']        = 'timeout';
	this.resp_codes['1']        = 'left_button';
	this.resp_codes['2']        = 'middle_button';
	this.resp_codes['3']        = 'right_button';
	this.resp_codes['4']        = 'scroll_up';
	this.resp_codes['5']        = 'scroll_down';
	this.vars.allowed_responses = null;
	this.vars.correct_response  = null;
	this.vars.duration          = 'mouseclick';
	this.vars.flush             = 'yes';
	this.vars.show_cursor       = 'yes';
	this.vars.timeout           = 'infinite';
    };

    /*
     * Definition of public methods - run cycle.
     */

    p.prepare = function()
    {	
	// Set the internal flush property.
	this._flush = (this.vars.flush) ? this.vars.flush : 'yes';
 
        // Inherited.	
	this.generic_response_prepare();
   };

    p.run = function()
    {
	// Inherited.	
	this.generic_response_run();

        // Record the onset of the current item.
	this.set_item_onset(); 
        
	// Show the cursor if defined.
        if (this.vars.show_cursor == 'yes')
	{	
            this._mouse.show_cursor(true);
        }

	// Flush responses, to make sure that earlier responses are not carried over.
	if (this._flush == 'yes')
	{	
            this._mouse.flush();
	}		
    
        this.set_sri();
        this.process_response();
    };

    p.complete = function()
    {
        // Hide the mouse cursor.    
        this._mouse.show_cursor(false);
       
        // Inherited.	
        this.generic_response_complete();
    };

    // Bind the mouse_response class to the osweb namespace.
    osweb.mouse_response = osweb.promoteClass(mouse_response, "generic_response");
}());


/*
 * Definition of the class sampler.
 */

(function() 
{
    function sampler(pExperiment, pName, pScript)
    {
	// Inherited.
	this.generic_response_constructor(pExperiment, pName, pScript);

    	// Definition of private properties.
        this._sample  = null;
        this._sampler = null;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(sampler, osweb.generic_response);

    // Definition of public properties.
    p.block	  = false;
    p.description = 'Plays a sound file in .wav or .ogg format';
    
    /*
     * Definition of public methods - build cycle. 
     */

    p.reset = function()
    {
	// Resets all item variables to their default value.
	this.block           = false;
	this.vars.sample     = '';
	this.vars.pan        = 0;
	this.vars.pitch      = 1;
	this.vars.fade_in    = 0;
	this.vars.stop_after = 0;
	this.vars.volume     = 1;
	this.vars.duration   = 'sound';
    };

    /*
     * Definition of public methods - run cycle. 
     */

    p.prepare = function()
    {
        // Create the sample
	if (this.vars.sample != '')
	{
            // Retrieve the content from the file pool.
            this._sample         = osweb.pool[this.syntax.eval_text(this.vars.sample)];  
            this._sampler        = new osweb.sampler_backend(this.experiment, this._sample);
            this._sampler.volume = this.vars.volume;
	}
	else
	{
            /* raise osexception(
            u'No sample has been specified in sampler "%s"' % self.name) */
	}
    
        // Inherited.	
	this.generic_response_prepare();
    };

    p.run = function()
    {
    	this.set_item_onset();
	this.set_sri();
	this._sampler.play();
	this.process_response();
    };	

    // Bind the sampler class to the osweb namespace.
    osweb.sampler = osweb.promoteClass(sampler, "generic_response");
}());


/*
 * Definition of the class sequence.
 */

(function() 
{
    function sequence(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.item_constructor(pExperiment, pName, pScript);
	
        // Definition of private properties. 
	this._index         = -1;
	this._index_prepare = -1;
        this._items         = null;
        this._keyboard      = null;    
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(sequence, osweb.item);

    // Definition of public properties. 
    p.description    = 'Runs a number of items in sequence';
    p.flush_keyboard = 'yes';
    p.items          = null;
	
    /*
     * Definition of public methods - build cycle.         
     */

    p.reset = function()
    {
	// Resets all item variables to their default value..
	this.items               = [];
	this.vars.flush_keyboard = 'yes';
    };

    p.from_string = function(pString)
    {
	// Parses a definition string.
	this.variables = {};
	this.comments  = [];
	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                    var tokens = osweb.syntax.split(lines[i]);
                    if ((tokens.length > 0) && (tokens[0] == 'run'))
                    {
                        var item = tokens[1];
			var cond = 'always';
			if (tokens.length > 2)
			{
                            cond = tokens[2];
			}	

			// Push the item and condition definition to the items list.
			this.items.push({'item': item, 'cond': cond});
                    }	
            	} 
            }
	}					
    };

    /*
     * Definition of public methods - run cycle.         
     */

    p.prepare = function()
    {
	// Inherited.	
	this.item_prepare();
	
        // Create a keyboard to flush responses at the start of the run phase
	if (this.vars.flush_keyboard == 'yes')
        {	
            this._keyboard = new osweb.keyboard(this.experiment);
        }
        else
        {    
            this._keyboard = null;
        }    
	
        // Generate the items list for the run cycle.
        this._index = 0;
	this._items = [];
        
        // Prepare the items.
        this.prepare_complete();
        
                /* this._items = [];
	for (var i=0; i < this.items.length; i++)
	{
            if ((this.items[i].item in osweb.item_store._items) === false)
            {
		osweb.debug.addError('Could not find item ' + this.items[i].item.name + ' which is called by sequence item ' + this.name);
            }
            else 
            {
                // Prepare the items.
                osweb.item_store.prepare(this.items[i].item);
		
                // Add the item to the internal list.
                this._items.push({'item': this.items[i].item, 'cond': osweb.syntax.compile_cond(this.items[i].cond)});
            }
	} */	
    };
    
    p.prepare_complete = function()
    {
        // Generate the items list for the run cycle.
        if (this._index < this.items.length)
        {
            if ((this.items[this._index].item in osweb.item_store._items) === false)
            {
		osweb.debug.addError('Could not find item ' + this.items[this._index].item.name + ' which is called by sequence item ' + this.name);
            }
            else 
            {
                // Increase the current index.
                this._index++;
                
                // Add the item to the internal list.
                this._items.push({'item': this.items[this._index - 1].item, 'cond': osweb.syntax.compile_cond(this.items[this._index - 1].cond)});
                
                // Prepare the item.
                osweb.item_store.prepare(this.items[this._index - 1].item, this);
	    }
        }
        else
        {
            // Prepare process is done, start execution.
            this._index = 0;
            
            // Remove the prepare phase form the stack.    
            osweb.item_stack.pop();
    
  	    // Execute the next cycle of the sequnce itself.
            osweb.item_store.run(this.name, this._parent);
        }    
    };
    
    p.run = function()
    {
        // Inherited.	
        this.item_run();

        // Check if all items have been processed.
        if (this._index < this._items.length)
        {
            // Flush the keyboard at the beginning of the sequence.
            if ((this._index == 0) && (this.vars.flush_keyboard == 'yes'))
            {
                this._keyboard.flush();
            }

            // Increase the current index.
            this._index++;
            current_item = this._items[this._index - 1]

            // Set the workspace.
            osweb.python_workspace['self'] = this;

            console.log(current_item);
            // Check if the item may run.                            
            if (osweb.python_workspace._eval(current_item.cond) == true) 
            {   
                // run the current item of the sequence object.
                osweb.item_store.run(current_item.item, this);
            }
  	    else
  	    {
  	    	// Execute the next cycle of the sequnce itself.
  	    	this.run();	
  	    }
	}
	else
	{
            // sequence is finalized.
            this.complete();
        }
    };
	
    p.complete = function()
    {
        // sequence is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;
 
        // Inherited.	
        this.item_complete();
    };

    // Bind the sequence class to the osweb namespace.
    osweb.sequence = osweb.promoteClass(sequence, "item");
}());

/*
 * Definition of the class sketchpad.
 */

(function() 
{
    function sketchpad(pExperiment, pName, pScript)
    {
	// Set publice properties.
    	this.canvas   = new osweb.canvas(pExperiment, false);
	this.elements = [];

	// Inherited create.
	this.generic_response_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(sketchpad, osweb.generic_response);

    // Definition of public properties. 
    p.canvas   = null;
    p.elements = [];

    /*
     * Definition of private methods - build cycle.         
     */
    
    p._compare = function(a,b) 
    {
        // Sort function used for determining the draw index (z-index) of alle elemente.
        if (a.z_index() < b.z_index())
            return 1;
        else if (a.z_index() > b.z_index())
            return -1;
        else 
            return 0;
    };
    
    /*
     * Definition of public methods - build cycle..         
     */

    p.reset = function()
    {
    	// Resets all item variables to their default value.
    	this.elements      = [];
	this.vars.duration = 'keypress';
    };

    p.from_string = function(pString)
    {
        // Define and reset variables to their defaults.
        this.variables = {};
        this.comments  = [];
 	this.reset();
		
	// Split the string into an array of lines.  
	if (pString != null)
	{
            var lines = pString.split('\n');
            for (var i=0; i < lines.length; i++)
            {
		if ((lines[i] != '') && (this.parse_variable(lines[i]) == false))
		{
                    var tokens = osweb.syntax.split(lines[i]);
                    if ((tokens.length > 0) && (tokens[0] == 'draw'))
                    {
			if (osweb.isClass(tokens[1]) == true)
			{
                            var element = osweb.newElementClass(tokens[1], this, lines[i]);
                            this.elements.push(element);	
			}	
                        else
			{
                            // error.
			}
                    }
		}
            }

            // Sort the elements usin the z-index.
            this.elements.sort(this._compare);
        }					
    };
	
    /*
     * Definition of public methods - runn cycle.         
     */

    p.prepare = function()
    {
        // Draw the elements. 
	for (var i=0; i < this.elements.length; i++)
	{
            if (this.elements[i].is_shown() == true)
            {
		this.elements[i].draw();
            }			
	}				
    
        // Inherited.	
	this.generic_response_prepare();
    };

    p.run = function()
    {
	// Inherited.	
	this.generic_response_run();
		
        // Set the onset and start the stimulus response process.        
	this.set_item_onset(this.canvas.show()); 
	this.set_sri(false);
	this.process_response();
    };
	
    p.complete = function()
    {
	// Clear the canvas.
	this.canvas.clear();
		
	// Inherited.	
	this.generic_response_complete();
    };

    // Bind the sketchpad class to the osweb namespace.
    osweb.sketchpad = osweb.promoteClass(sketchpad, "generic_response");
}());


/*
 * Definition of the class feedback.
 */

(function() 
{
    function feedback(pExperiment, pName, pScript)
    {
	// Inherited create.
	this.sketchpad_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(feedback, osweb.sketchpad);

    // Definition of public properties. 
    p.description = 'Provides feedback to the participant';

    /*
     * Definition of public methods - build cycle.
     */

    p.reset = function()
    {
    	// Resets all item variables to their default value.
	this.sketchpad_reset();
	this.vars.reset_variables = 'yes';
    };	
    
    /*
     * Definition of public methods - run cycle.
     */

    p.prepare = function()
    {
        // Prepares the item.
        this._parent.prepare_complete();
    };

    p.run = function()
    {
    	// Inherited.	
	this.sketchpad_prepare();
	this.sketchpad_run();
    };

    p.complete = function()
    {
    	// Inherited.	
	this.sketchpad_complete();

	// Reset feedback variables.
	if (this.vars.reset_variables == 'yes')
	{
            this.experiment.reset_feedback();
	}
    };

    // Bind the feedback class to the osweb namespace.
    osweb.feedback = osweb.promoteClass(feedback, "sketchpad");
}());


/*
 * Definition of the class synth.
 */

(function() 
{
    function synth(pExperiment, pName, pScript)
    {
	// Inherited.
	this.sampler_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(synth, osweb.sampler);

    // Define and set the public properties. 
    p.description = 'A basic sound synthesizer';

    /*
     * Definition of public class methods.
     */

    // Bind the synth class to the osweb namespace.
    osweb.synth = osweb.promoteClass(synth, "sampler");
}());


/*
 * Definition of the class advanced_delay.
 */

(function() 
{
    function advanced_delay(pExperiment, pName, pScript)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    
        // Set private properties.
        this._duration = -1;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(advanced_delay, osweb.item);

    // Define and set the public properties. 
    p.description = 'Waits for a specified duration';

    /*
     * Definition of public class methods - build cycle.
     */

    p.reset = function()
    {
    	// Resets all item variables to their default value.
	this.vars.duration    = 1000;
	this.vars.jitter      = 0;
	this.vars.jitter_mode = 'Uniform';
    }; 
    
    /*
     * Definition of public class methods - run cycle.
     */

    p.prepare = function()
    {
	this._duration = this.vars.duration;
        /* # Sanity check on the duration value, which should be a positive numeric
	# value.
	if type(self.var.duration) not in (int, float) or self.var.duration < 0:
		raise osexception(
			u'Duration should be a positive numeric value in advanced_delay %s' \
			% self.name)
	if self.var.jitter_mode == u'Uniform':
		self._duration = random.uniform(self.var.duration-self.var.jitter/2,
			self.var.duration+self.var.jitter/2)
	elif self.var.jitter_mode == u'Std. Dev.':
		self._duration = random.gauss(self.var.duration, self.var.jitter)
	else:
		raise osexception(
			u'Unknown jitter mode in advanced_delay %s' % self.name)
	# Don't allow negative durations.
	if self._duration < 0:
		self._duration = 0
	self._duration = int(self._duration)
	self.experiment.var.set(u'delay_%s' % self.name, self._duration)
	debug.msg(u"delay for %s ms" % self._duration) */

        // Inherited.	
	this.item_prepare();
    };
    
    p.run = function() 
    {
        // Inherited.	
    	this.item_run();

        // Set the onset time.
        this.set_item_onset(this.time());
        this.sleep(this._duration);		
    };

    // Bind the advanced_delay class to the osweb namespace.
    osweb.advanced_delay = osweb.promoteClass(advanced_delay, "item");
}());


/*
 * Definition of the class form_base.
 */

(function() 
{
    function form_base(pName, pExperiment, pScript, pItem_type, pDescription)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);

        // Set the class private properties.
        this._form_text = false;
    
        // Set the class public properties.
        this.description = pDescription;
        this.item_type   = pItem_type;
    }   
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_base, osweb.item);

    // Define and set the public properties. 
    p.cols        = [];
    p.description = 'A generic form plug-in';
    p.form        = null;
    p.rows        = [];
    
    /*
     * Definition of public class methods - build cycle.
     */

    p.reset = function() 
    {
  	// Resets all item variables to their default value.
  	this.vars.cols        = '2;2';
	this.vars.rows        = '2;2';
	this.vars.spacing     = 10;
	this.vars._theme      = 'gray';
	this.vars.only_render = 'no';
	this.vars.timeout     = 'infinite';
	this.vars.margins     = '50;50;50;50';
	this._variables       = [];   
	this._widgets         = [];
    };    

    p.parse_line = function(pString)
    {
        // Split the line in tokens.
        var list = this.syntax.split(pString);

        if ((this._form_text == true) && (list[0] != '__end__'))
        {
            this.vars['form_text'] = this.vars['form_text'] + pString.replace('\t','');
        };

        // Check for widget definition.
        if (list[0] == 'widget')
        {
            // Remove widget command.
            list.shift();

            // Add widget to the list.
            this._widgets.push(list);
        }
        else if (list[0] == '__form_text__')
        {
            this.vars['form_text'] = '';
            this._form_text        = true;
        }
        else if (list[0] == '__end__')
        {
            this._form_text = false;
        }
        
        /* if u'var' in kwdict:
	 self._variables.append(kwdict[u'var'])   */  
    };

    /*
     * Definition of public class methods - run cycle.
     */

    p.prepare = function()
    {
        // Inherited.	
    	this.item_prepare();

        // Retrieve the column, rows and margins.
        var cols    = this.vars.cols.split(';');
        var rows    = this.vars.rows.split(';');
        var margins = this.vars.margins.split(';'); 
        
        // Get the time out paramter.
        if (this.vars.timeout == 'infinite')
        {                
            var timeout = null;
        }    
        else
        {    
            var timeout = this.vars.timeout;
        }    
        
        // Create the basic form.    
        this.form = new osweb.form(this.experiment, cols, rows, this.vars.spacing, margins, this.vars._theme, this, timeout, this.vars.form_clicks == 'yes');

        for (var i=0;i < this._widgets.length; i++)
        {
            this.focus_widget = null;
            var kwdict = {};
            var parameters = [];
            parameters.push(this.form);
            if (this._widgets[i].length > 5) 
            {
                for (var j=5;j < this._widgets[i].length;j++)
                {
                    var varName  = String(this._widgets[i][j]).substr(0,String(this._widgets[i][j]).indexOf('='));
                    var varValue = String(this._widgets[i][j]).substring(String(this._widgets[i][j]).indexOf('=') + 1,String(this._widgets[i][j]).length);
                    kwdict[varName] = osweb.syntax.remove_quotes(varValue);
                    kwdict[varName] = osweb.syntax.eval_text(kwdict[varName], this.vars);
                
                    parameters.push(osweb.syntax.remove_quotes(varValue));
                } 
            }

            /* # Process focus keyword
            focus = False
            if u'focus' in kwdict:
                if kwdict[u'focus'] == u'yes':
                    focus = True
                del kwdict[u'focus'] */
            
            // Parse arguments
            var _type   = this._widgets[i][4];
            var col     = this._widgets[i][0];
            var row     = this._widgets[i][1];
            var colspan = this._widgets[i][2];
            var rowspan = this._widgets[i][3];
	
            // Create the widget.
            try 
            {
                var _w = osweb.newWidgetClass(_type, this.form, kwdict);
                //console.log(parameters);
                //var _w = osweb.newWidgetClass(_type, parameters);
            }
            catch(e)
            {
                osweb.debug.addError('Failed to create widget ' + _type + ', error:' + e);
            }    
                
            // Set the width position and form.                    
            this.form.set_widget(_w, [col, row], colspan, rowspan);
            
            // Add as focus widget
            if (focus == true) 
            {
            	if (this.focus_widget != null)
                {
                    osweb.debug.addError('Osweb error: You can only specify one focus widget');
                } 
                else
                {
                    this.focus_widget = _w;
                }
            }    
        }
    };

    p.run = function() 
    {
        // Inherited.	
    	this.item_run();

        // Set dimensions.
        this.form._parentform.style.width      = osweb.runner._canvas.width;
        this.form._parentform.style.height     = osweb.runner._canvas.height;
        this.form._parentform.style.background = this.experiment.vars.background;
                
        // Hide the canvas, show the form.
        osweb.runner._canvas.style.display  = 'none';
        this.form._parentform.style.display = 'block';
        this.form._form.style.display       = 'block';
    };

    p.complete = function()
    {
        // Hide the form
        this.form._parentform.style.display = 'none';
        this.form._form.style.display       = 'none';
        osweb.runner._canvas.style.display  = 'inline';

        // form is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;

        // Inherited.	
        this.item_complete();
    };

    // Bind the form_base class to the osweb namespace.
    osweb.form_base = osweb.promoteClass(form_base, "item");
}());


/*
 * Definition of the class form_consent.
 */

(function() 
{
    function form_consent(pExperiment, pName, pScript)
    {
        // Inherited.
	this.form_base_constructor(pName, pExperiment, pScript, 'form_consent', 'A simple consent form');
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_consent, osweb.form_base);

    // Define and set the public properties. 
    p.description = 'A simple consent form';

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function() 
    {
        // Inherited.	
    	this.form_base_run();
    };

    p.complete = function()
    {
        // Inherited.	
    	this.form_base_complete();
    };

    // Bind the form_consent class to the osweb namespace.
    osweb.form_consent = osweb.promoteClass(form_consent, "form_base");
}());


/*
 * Definition of the class form_multiple_choice.
 */

(function() 
{
    function form_multiple_choice(pExperiment, pName, pScript)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_multiple_choice, osweb.item);
    
    // Define and set the public properties. 
    p.description = 'A simple multiple choice item';

    // Bind the form_base class to the osweb namespace.
    osweb.form_multiple_choice = osweb.promoteClass(form_multiple_choice, "item");
}());


/*
 * Definition of the class form_text_display.
 */

(function() 
{
    function form_text_display(pExperiment, pName, pScript)
    {
        // Inherited.
	this.form_base_constructor(pName, pExperiment, pScript, 'form_text_display', 'A simple text display form');
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_text_display, osweb.form_base);

    // Define and set the public properties. 
    p.description = 'A simple text display form';

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function() 
    {
        // Inherited.	
    	this.form_base_run();
     };

    p.complete = function()
    {
        // Inherited.	
    	this.form_base_complete();
    };

    // Bind the form_text_display class to the osweb namespace.
    osweb.form_text_display = osweb.promoteClass(form_text_display, "form_base");
}());


/*
 * Definition of the class form_text_input.
 */

(function() 
{
    function form_text_input(pExperiment, pName, pScript)
    {
	// Inherited.
	this.form_base_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_text_input, osweb.form_base);

    // Define and set the public properties. 
    p.description = 'A simple text input form';

    // Bind the form_base class to the osweb namespace.
    osweb.form_text_input = osweb.promoteClass(form_text_input, "form_base");
}());


/*
 * Definition of the class form_text_render.
 */

(function() 
{
    function form_text_render(pExperiment, pName, pScript)
    {
	// Inherited.
	this.form_base_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(form_text_render, osweb.form_base);

    // Define and set the public properties. 
    p.description = 'A simple text display form';

    // Bind the form_base class to the osweb namespace.
    osweb.form_text_render = osweb.promoteClass(form_text_render, "form_base");
}());


/*
 * Definition of the class media_player_vlc.
 */

(function() 
{
    function media_player_vlc(pExperiment, pName, pScript)
    {
	// Inherited.
	this.generic_response_constructor(pExperiment, pName, pScript);
    
        // Define and set the private properties. 
        this._script_executed = false;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(media_player_vlc, osweb.generic_response);

    // Define and set the public properties. 
    p.description = 'A video player';

    /*
     * Definition of public class methods - run cycle.
     */

    p.prepare = function()
    {
        // Opens the video file for playback.
        this._video        = osweb.pool[this.vars.get('video_src')];  
        this._video_player = new osweb.video_backend(this.experiment, this._video);
        
        // Set the inline code options.
        if (this.vars.event_handler !== '')
        {
            this._video_player._script = osweb.parser._prepare(this.vars.event_handler);
        }
        this._video_player._event_handler_always = (this.vars.event_handler_trigger == 'after every frame');
		
        // Set the audio option.
        this._video_player.audio = (this.vars.get('playaudio') == 'yes');
        
        // Set the full screen option (if enabled).
        this._video_player.full_screen = (this.vars.get('resizeVideo') == 'yes');
	
      	// Inherited.	
	this.generic_response_prepare();
    };    
    
    p.run = function() 
    {
        // Set the onset time.
        this.set_item_onset();
	this.set_sri();

        // Start the video player.
        this._video_player.play();    

        // Start response processing.
        this.process_response();
    };

    p.complete = function() 
    {
        if (this._script_executed == false)
        {
            // Stop the video playing.  
            this._video_player.stop();
	
            // execute script.
            if ((this._video_player._script !== null) && (this.vars.get('event_handler_trigger') == 'on keypress'))
            {
                // Set the execute toggle.
                this._script_executed = true;
            
                // Execute the script code.
                osweb.parser._run(this, this._video_player._script);
            }   
            else
            {    
                // Inherited.	
                this.generic_response_complete();
            }
        }
        else
        {
            // Inherited.	
            this.generic_response_complete();
        };    
    };    

    p.update = function()
    {
        // Update the video canvas.
        this._video_player._update_video_canvas();
    };
    
    // Bind the media_player_vlc class to the osweb namespace.
    osweb.media_player_vlc = osweb.promoteClass(media_player_vlc, "generic_response");
}());


/*
 * Definition of the class notepad.
 */

(function() 
{
    function notepad(pExperiment, pName, pScript)
    {
	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(notepad, osweb.item);

    // Define and set the public properties. 
    p.description = 'A simple notepad to document your experiment. This plug-in does nothing.';
    p.note        = '';

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function() 
    {
        // Inherited.	
    	this.item_run();

	// Show the information of the notepad on the console.
	//osweb.debug.addMessage(this.note);

        // Complete the current cycle.
        this.complete();
    };

    p.complete = function()
    {
        // sequence is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;
 
        // Inherited.	
        this.item_complete();
    };

    // Bind the notepad class to the osweb namespace.
    osweb.notepad = osweb.promoteClass(notepad, "item");
}());


/*
 * Definition of the class repeat_cycle.
 */

(function() 
{
    function repeat_cycle(pExperiment, pName, pScript)
    {
    	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(repeat_cycle, osweb.item);

   // Define and set the public properties. 
    p.description = 'Optionally repeat a cycle from a loop';
    
    /*
     * Definition of public class methods - run cycle.
     */

    p.prepare = function()
    {
        // Prepare the condtion for which the repeat_cycle must fire.
        this._condition = osweb.syntax.compile_cond(this.vars.get('condition'));

        // Inherited.	
	this.item_prepare();
    }; 

    p.run = function()
    {
    	// Inherited.	
	this.item_run();
		
	// Run item only one time.   
	if (this._status != osweb.constants.STATUS_FINALIZE)
        {
            if (osweb.python_workspace._eval(this._condition) == true) 
            {            
                this.experiment.vars.repeat_cycle = 1;
            }
            
            // Complete the current cycle.
            this.complete();
        }
    };

    p.complete = function()
    {
        // sequence is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;
 
        // Inherited.	
        this.item_complete();
    };
    
    // Bind the repeat_cycle class to the osweb namespace.
    osweb.repeat_cycle = osweb.promoteClass(repeat_cycle, "item");
}());


/*
 * Definition of the class reset_feedback.
 */

(function() 
{
    function reset_feedback(pExperiment, pName, pScript)
    {
    	// Inherited.
	this.item_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(reset_feedback, osweb.item);

    // Define and set the public properties. 
    p.description = 'Resets the feedback variables, such as "avg_rt" and "acc"';

    /*
     * Definition of public class methods - run cycle.
     */

    p.run = function()
    {
    	// Inherited.	
	this.item_run();
		
	// Run item only one time.   
	if (this._status != osweb.constants.STATUS_FINALIZE)
	{
            // Run the item.
            this.experiment.reset_feedback();

            // Complete the current cycle.
            this.complete();
        }
    };

    p.complete = function()
    {
        // sequence is finalized.
        this._status = osweb.constants.STATUS_FINALIZE;
 
        // Inherited.	
        this.item_complete();
    };
    
    // Bind the reset_feedback class to the osweb namespace.
    osweb.reset_feedback = osweb.promoteClass(reset_feedback, "item");
}());


/*
 * Definition of the class touch_response.
 */

(function() 
{
    function touch_response(pExperiment, pName, pScript)
    {
	// Inherited.
	this.mouse_response_constructor(pExperiment, pName, pScript);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(touch_response, osweb.mouse_response);

    // Define and set the public properties. 
    p.description = 'A grid-based response item, convenient for touch screens';

    /*
     * Definition of public methods - build cycle.
     */
	
    p.reset = function()
    {
        // Inherited.
        this.mouse_response_reset();
        this.vars.set('allowed_responses',null);
	
        // Resets all item variables to their default value.
        this.vars._ncol = 2;
	this.vars._nrow = 1;
    };

    /*
     * Definition of public methods - run cycle.
     */
    
    p.prepare = function()
    {
        // Temp hack
        this.experiment.vars.correct = -1;
   
        // Inherited.
        this.mouse_response_prepare();
    };
        
    p.process_response_mouseclick = function(pRetval)
    {
        // Processes a mouseclick response.
	this.experiment._start_response_interval = this.sri;
	this.experiment._end_response_interval   = pRetval.rtTime;
	this.experiment.vars.response		 = pRetval.resp;
	this.synonyms                            = this._mouse.synonyms(this.experiment.vars.response);
	this.experiment.vars.cursor_x            = pRetval.event.clientX;
	this.experiment.vars.cursor_y            = pRetval.event.clientY;
	
        var rect = osweb.runner._canvas.getBoundingClientRect();
        if (this.experiment.vars.uniform_coordinates == 'yes')
        {
            this._x = pRetval.event.clientX + (this.experiment.vars.width / 2);
	    this._y = pRetval.event.clientY + (this.experiment.vars.height / 2);
        }
        else
        {
            this._x = pRetval.event.clientX - rect.left;
	    this._y = pRetval.event.clientY - rect.top;
        }    
        
        // Calulate the row, column and cell. 
        this.col  = Math.floor(this._x / (this.experiment.vars.width  / this.vars._ncol));
	this.row  = Math.floor(this._y / (this.experiment.vars.height / this.vars._nrow));
	this.cell = this.row * this.vars._ncol + this.col + 1;
        this.experiment.vars.response = this.cell;
        this.synonyms                 = [String(this.experiment.vars.response)];
                
        // Do the bookkeeping 
        this.response_bookkeeping();
    };            

    // Bind the touch_response class to the osweb namespace.
    osweb.touch_response = osweb.promoteClass(touch_response, "mouse_response");
}());


/*
 * Definition of the class base_element.
 */

(function() 
{
    function base_element(pSketchpad, pScript, pDefaults)
    {
	// Set the public properties.		
	this.canvas           = pSketchpad.canvas;
	this.defaults         = pDefaults;
	this.defaults.show_if = 'always';
	this.defaults.z_index = 0;
        this.experiment       = pSketchpad.experiment;
	this.fix_coordinates  = (pSketchpad.vars.uniform_coordinates == 'yes');
	this.name             = pSketchpad.name;
	this.only_keywords    = false;
	this.pool             = pSketchpad.experiment.pool;
	this.sketchpad        = pSketchpad;
	this.syntax           = pSketchpad.syntax;
	this.vars             = pSketchpad.vars;

        // Set the private properties.		
        this._properties      = null;   

        // Read the definition string.
	this.from_string(pScript);
    }; 
	
    // Extend the class from its base class.
    var p = base_element.prototype;

    // Set the class public properties. 
    p.defaults        = {};
    p.fix_coordinates = true;
    p.only_keywords   = false;
    p.properties      = {};
    p.sketchpad       = null;	
    p.vars            = null;
	        	
    /*
     * Definition of public methods - building cycle.         
     */

    p.from_string = function(pString)
    {
	var tokens = osweb.syntax.parse_cmd(pString);
	
	// Set the default properties.
	this.properties = {};
			
	// Set the define properties.
	for (var i=0; i < tokens.length; i++)
	{
            var name  = tokens[i].slice(0,tokens[i].indexOf('='));
            var value = tokens[i].slice(tokens[i].indexOf('=') + 1,tokens[i].length);
            var value = osweb.syntax.remove_quotes(value);
			
            // Set (and overwrite) the properties.
            this.properties[name] = value;
	}
    };

    /*
     * Definition of public methods - running cycle.         
     */

    p.z_index = function()
    {
    	//  Determines the drawing order of the elements. 
    	return this.properties.z_index;
    };

    p.eval_properties = function()
    {
	// Evaluates all properties and return them.
	this._properties = {};
		
	var xc = this.experiment.vars.width / 2;
	var yc = this.experiment.vars.height / 2;

    	for (var property in this.properties) 
	{
            var value = this.sketchpad.syntax.eval_text(this.properties[property]);
            /* if var == u'text':
			round_float = True
                else:
			round_float = False
		val = self.sketchpad.syntax.auto_type(
			self.sketchpad.syntax.eval_text(val, round_float=round_float))
		if self.fix_coordinates and type(val) in (int, float): */
            if ((property  == 'x') || (property  == 'x1') || (property  == 'x2'))
            {
            	value = Number(value) + xc;
            };
            if ((property  == 'y') || (property  == 'y1') || (property  == 'y2'))
            {
		value = Number(value) + yc;
            };

            this._properties[property] = value; 
	}
    };		
		
    p.is_shown = function()
    {
        // Set the self of the current workspace.
        this.experiment.python_workspace['self'] = this.sketchpad;
        
        // Determines whether the element should be shown, based on the show-if statement.
	return this.experiment.python_workspace._eval(this.experiment.syntax.compile_cond(this.properties['show_if']));
    };
	
    p.draw = function()
    {
        // Calculate the dynamic properties.
        this.eval_properties();
    };

    // Bind the base_element class to the osweb namespace.
    osweb.base_element = base_element;
}());


/*
 * Definition of the class arrow.
 */

(function() 
{
    function arrow(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults		        = {};
	this.defaults.arrow_body_length = 0.8;
	this.defaults.arrow_body_width  = 0.5;
	this.defaults.arrow_head_width  = 30;
	this.defaults.fill     		= 1;
	this.defaults.color    		= pSketchpad.vars.get('foreground');
	this.defaults.penwidth 		= 1;
	this.defaults.x1       		= null;
	this.defaults.y1       		= null;
	this.defaults.x2                = null;
	this.defaults.y2       		= null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(arrow, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */

    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the arrow element to the canvas of the sketchpad.
	this.sketchpad.canvas.arrow(this._properties.x1, this._properties.y1, this._properties.x2, this._properties.y2, this._properties.color, this._properties.penwidth, 
                                    this._properties.arrow_head_width, this._properties.arrow_body_width, this._properties.arrow_body_length, this._properties.fill);
    };
    
    // Bind the Arrow class to the osweb namespace.
    osweb.arrow = osweb.promoteClass(arrow, "base_element");
}());


/*
 * Definition of the class circle.
 */

(function() 
{
    function circle(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.fill     = 0;
	this.defaults.penwidth = 1;
	this.defaults.x        = null;
	this.defaults.y        = null;
	this.defaults.r        = null;
		
	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(circle, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */
	
    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the circle element to the canvas of the sketchpad.
	this.sketchpad.canvas.circle(this._properties.x, this._properties.y, this._properties.r, this._properties.fill, this._properties.color, this._properties.penwidth);
    };
    
    // Bind the Circle class to the osweb namespace.
    osweb.circle = osweb.promoteClass(circle,"base_element");
}());


/*
 * Definition of the class ellipse.
 */

(function() 
{
    function ellipse(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.fill     = 1;
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.penwidth = 1;
	this.defaults.x        = null;
	this.defaults.y        = null;
	this.defaults.w        = null;
	this.defaults.h        = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(ellipse, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */
	
    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the ellipse element to the canvas of the sketchpad.
        this.sketchpad.canvas.ellipse(Number(this._properties.x), Number(this._properties.y), Number(this._properties.w), Number(this._properties.h), 
                                      this._properties.fill, this._properties.color, this._properties.penwidth);
    };
    
    // Bind the ellipse class to the osweb namespace.
    osweb.ellipse = osweb.promoteClass(ellipse,"base_element");
}());


/*
 * Definition of the class fixdot.
 */

(function() 
{
    function fixdot(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.style    = 'default';
	this.defaults.x        = null;
	this.defaults.y        = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(fixdot, osweb.base_element);

    /*
     * Definition of public methods - running cycle.         
     */
	
    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the fixdot element to the canvas of the sketchpad.
	this.sketchpad.canvas.fixdot(this._properties.x, this._properties.y, this._properties.color, this._properties.style);
    };
    
    // Bind the fixdot class to the osweb namespace.
    osweb.fixdot = osweb.promoteClass(fixdot,"base_element");
}());


/*
 * Definition of the class gabor.
 */

(function() 
{
    function gabor(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults        = {};
	this.defaults.bgmode = 'avg';
	this.defaults.color1 = 'white';
	this.defaults.color2 = 'black';
	this.defaults.env    = 'gaussian';
	this.defaults.freq   = 1;
	this.defaults.orient = 0;
	this.defaults.phase  = 0;
	this.defaults.size   = 96;
	this.defaults.stdev  = 12;
	this.defaults.x      = null;
	this.defaults.y      = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(gabor, osweb.base_element);

    /*
     * Definition of public methods (run cycle).   
     */

    p.draw = function()
    {
        // Inherited.	
    	this.base_element_draw();
		
	// Draw the gabor element to the canvas of the sketchpad.
	this.sketchpad.canvas.gabor(this._properties.x, this._properties.y, this._properties.orient, this._properties.freq, this._properties.env, 
                                    this._properties.size, this._properties.stdev, this._properties.phase, this._properties.color1, this._properties.color2, this._properties.bgmode);
    };
    
    // Bind the gabor class to the osweb namespace.
    osweb.gabor = osweb.promoteClass(gabor,"base_element");
}());


/*
 * Definition of the class image.
 */

(function() 
{
    function image(pSketchpad, pScript)
    {
	// Set the class public properties.
	this.defaults	     = {};
	this.defaults.center = 1;
	this.defaults.file   = null;
	this.defaults.scale  = 1;
	this.defaults.x      = null;
	this.defaults.y      = null;

	// Set the class private properties. 
	this._file           = null;
		
	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(image, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */

    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();

    	// Retrieve the content from the file pool.
	this._file = osweb.pool[this._properties['file']];  

	// Draw the image element to the canvas of the sketchpad.
	this.sketchpad.canvas.image(this._file, this._properties.center, this._properties.x, this._properties.y, this._properties.scale);
    };
    
    // Bind the image class to the osweb namespace.
    osweb.image = osweb.promoteClass(image, "base_element");
}());


/*
 * Definition of the class line.
 */

(function() 
{
    function line(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.penwidth = 1;
	this.defaults.x1       = null;
	this.defaults.y1       = null;
	this.defaults.x2       = null;
	this.defaults.y2       = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 

    // Extend the class from its base class.
    var p = osweb.extendClass(line, osweb.base_element);

    /*
     * Definition of public methods - run cycle.   
     */
	
    p.draw = function()
    {
        // Inherited.	
	this.base_element_draw();
		
	// Draw the line element to the canvas of the sketchpad.
	this.sketchpad.canvas.line(this._properties.x1, this._properties.y1, this._properties.x2, this._properties.y2, 
                                   this._properties.color, this._properties.penwidth);
    };
        
    // Bind the line class to the osweb namespace.
    osweb.line = osweb.promoteClass(line,"base_element");
}());


/*
 * Definition of the class noise.
 */

(function() 
{
    function noise(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults	     = {};
	this.defaults.color1 = 'white';
	this.defaults.color2 = 'black';
	this.defaults.env    = 'gaussian';
	this.defaults.size   = 96;
	this.defaults.stdev  = 12;
	this.defaults.x      = null;
	this.defaults.y      = null;
	this.defaults.bgmode = 'avg';

        // Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(noise, osweb.base_element);

    /*
     * Definition of public methods (run cycle).   
     */

    p.draw = function()
    {
        // Inherited.	
    	this.base_element_draw();
		
	// Draw the noise element to the canvas of the sketchpad.
	this.sketchpad.canvas.noise(this._properties.x, this._properties.y, this._properties.env, this._properties.size, 
                                    this._properties.stdev, this._properties.color1, this._properties.color2, this._properties.bgmode);
    };
    
    // Bind the noise class to the osweb namespace.
    osweb.noise = osweb.promoteClass(noise,"base_element");
}());


/*
 * Definition of the class rect.
 */

(function() 
{
    function rect(pSketchpad, pScript)
    {
	// Set the default properties.
	this.defaults          = {};
	this.defaults.fill     = 1;
	this.defaults.color    = pSketchpad.vars.get('foreground');
	this.defaults.penwidth = 1;
	this.defaults.x        = null;
	this.defaults.y        = null;
	this.defaults.w        = null;
	this.defaults.h        = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(rect, osweb.base_element);
	
    /*
     * Definition of public methods - run cycle.   
     */

    p.draw = function()
    {
        // Inherited.	
    	this.base_element_draw();
		
	// Draw the rectangle element to the canvas of the sketchpad.
	this.sketchpad.canvas.rect(this._properties.x, this._properties.y, this._properties.w, this._properties.h, 
                                   this._properties.fill, this._properties.color, this._properties.penwidth);
    };
    
    // Bind the Rect class to the osweb namespace.
    osweb.rect = osweb.promoteClass(rect,"base_element");
}());


/*
 * Definition of the class textline.
 */

(function() 
{
    function textline(pSketchpad, pScript)
    {
        // Set the default properties.
	this.defaults             = {};
	this.defaults.center      = 1;
	this.defaults.color       = pSketchpad.vars.get('foreground');
	this.defaults.font_family = pSketchpad.vars.get('font_family');
	this.defaults.font_size   = pSketchpad.vars.get('font_size');
	this.defaults.font_bold   = pSketchpad.vars.get('font_bold');
	this.defaults.font_italic = pSketchpad.vars.get('font_italic');
	this.defaults.html        = 'yes';
	this.defaults.text        = null;
	this.defaults.x           = null;
	this.defaults.y           = null;

	// Inherited.
	this.base_element_constructor(pSketchpad, pScript, this.defaults);
    } 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(textline, osweb.base_element);
	
    /*
     * Definition of public methods - running cycle.         
     */

    p.draw = function()
    {
        // Inherited.	
    	this.base_element_draw();
		
    	// Set the font style and draw the text element to the canvas of the sketchpad.
	this.sketchpad.canvas.set_font(this._properties.font_family, this._properties.font_size, this._properties.font_italic == 'yes', this._properties.font_bold == 'yes', this._properties.font_underline == 'yes');		
        this.sketchpad.canvas.text(this._properties.text, this._properties.center, this._properties.x, this._properties.y, this._properties.color, this._properties.html);
    };
    
    // Bind the Text class to the osweb namespace.
    osweb.textline = osweb.promoteClass(textline, "base_element");
}());

	
/*
 * Definition of the class form.
 */

(function() 
{
    function form(pExperiment, pCols, pRows, pSpacing, pMargins, pTheme, pItem, pTimeout, pClicks)
    {
        // Set the class public properties.
        this.clicks     = pClicks;
	this.experiment = pExperiment;
	this.height     = this.experiment.vars.height;
	this.item       = (pItem != null) ? pItem : pExperiment;
	this.margins    = pMargins;
        this.spacing    = pSpacing;
	this.span       = [];
        this.timeout    = pTimeout;
	this.widgets    = []; 
        this.width      = this.experiment.vars.width;
        
        // Set the class public properties - columns and rows.
        var colSize = 0;
        for (var i=0;i < pCols.length;i++)
        {
            colSize = colSize + Number(pCols[i]);
        }
        this.cols = [];
        for (var i=0;i < pCols.length;i++)
        {
            this.cols.push(Math.round((pCols[i] / colSize) * 100));
        }    
        var rowSize = 0;
        for (var i=0;i < pRows.length;i++)
        {
            rowSize = rowSize + Number(pRows[i]);
        }
        this.rows = [];
        for (var i=0;i < pRows.length;i++)
        {
            this.rows.push(Math.round((pRows[i] / rowSize) * 100));
        }

        // Set the class private properties.
        this._parentform         = document.getElementById('osweb_form');
        this._form               = document.createElement("DIV");
        this._form.style.height  = '100%';
        this._form.style.width   = '100%';
        this._form.style.display = 'none';
        
        // Set the table properties and content.
        this._table                  = document.createElement("TABLE");
        this._table.style.padding    = this.margins[0] + 'px ' + this.margins[1] + 'px ' + this.margins[2] + 'px ' + this.margins[3] + 'px';
        this._table.style.height     = '100%';
        this._table.style.width      = '100%';
        this._table.style.fontStyle  = this.experiment.vars.font_italic == 'yes' ? 'italic' : 'normal'; 
        this._table.style.fontWeight = this.experiment.vars.font_bold   == 'yes' ? 'bold'   : 'normal'; 
        this._table.style.fontFamily = this.experiment.vars.font_family;
        this._table.style.color      = this.experiment.vars.foreground;
        this._table.style.fontSize   = this.experiment.vars.font_size + 'px';
        
        for (var i=0;i < this.rows.length;i++)
        {
            // Insert the row into the table.
            var row          = this._table.insertRow();
            row.style.height = this.rows[i] + '%';
            
            // Inser the cells.
            for (var j=0;j < this.cols.length;j++)
            {
                var cell = row.insertCell(j);
                cell.style.width   = this.cols[j] + '%';
                cell.style.padding = '5px';
            }    
        }        

        // Append the table to the form.
        this._parentform.appendChild(this._form);
        this._form.appendChild(this._table);
        
        // Dynamically load the theme object
	/* theme_mod = __import__(u'libopensesame.widgets.themes.%s' % theme, fromlist=[u'dummy'])
	theme_cls = getattr(theme_mod, theme)
	self.theme_engine = theme_cls(self) */
    } 
	
    // Extend the class from its base class.
    var p = form.prototype;

    // Definition of class public properties. 
    p.clicks     = null;
    p.experiment = null;
    p.height     = -1;
    p.item       = null;
    p.spacing    = null;
    p.timeout    = -1;
    p.width      = -1;
    
    /*
     * Definition of public methods - general function.
     */

    p._exec = function(pFocus_widget)
    {
    };   

    p.timed_out = function()
    {
    };

    p.cell_index = function(pPos)
    {
    };

    p.validate_geometry = function()
    {
    };

    p.get_cell = function(pIndex)
    {
    };
    
    p.get_rect = function(pIndex)
    {
    };

    p.render = function()
    {
	this.validate_geometry();
	this.canvas.clear();
	for (var widget in this.widgets)
	{
            if (widget !== null)
            {
                widget.render();
            }    
        }		
        
        this.canvas.show();
    };    

    p.set_widget = function(pWidget, pPos, pColspan, pRowspan)
    {
        // Get the row postition of the widget.
        var row  = this._table.rows[Number(pPos[1])];
        var cell = row.cells[Number(pPos[0])]; 
        if (Number(pColspan) > 1)
        {
            cell.colSpan = Number(pColspan);
        }
        if (Number(pRowspan) > 1)
        {
            cell.rowSpan = Number(pRowspan);
        }
        
        // Append widget to the cell.
        cell.appendChild(pWidget._element);
        
        /* var index = this.cell_index(nPos;)
	if (index >= len(this.widgets)
        {
            // raise osexception(u'Widget position (%s, %s) is outside of the form' % pos)
        }
        if type(colspan) != int or colspan < 1 or colspan > len(self.cols):
			raise osexception( \
				u'Column span %s is invalid (i.e. too large, too small, or not a number)' \
				% colspan)
		if type(rowspan) != int or rowspan < 1 or rowspan > len(self.rows):
			raise osexception( \
				u'Row span %s is invalid (i.e. too large, too small, or not a number)' \
				% rowspan) 
	this.widgets[index] = widget;
	this.span[index]    = colspan, rowspan
        this.widget.set_rect(this.get_rect(index)) */
    };

    p.xy_to_index = function(pXy)
    {
    };
  
    // Bind the form class to the osweb namespace.
    osweb.form = form;
}());

	
/*
 * Definition of the class widget.
 */

(function() 
{
    function widget(pForm)
    {
        // Set the class public properties.
	this.focus = false;
	this.form  = pForm;
	this.rect  = null;
	this.type  = 'widget';
	this.vars  = null;
    } 
	
    // Extend the class from its base class.
    var p = widget.prototype;

    // Definition of class public properties. 
    p.form  = null;
    p.focus = false;
    p.rect  = null;
    p.type  = '';	
    p.vars  = null;

    /*
     * Definition of public methods - general function.
     */

    p.box_size = function()
    {
        return null;
    };            

    p.theme_engine = function()
    {
        return null;
    };
    
    p.draw_frame = function(pRect, pStyle)
    {
    };    

    p.on_mouse_click = function(pevent)
    {
    };        

    p.render = function()
    {
    };

    p.set_rect = function(pRect)
    {
    };
    
    p.set_var = function(pVal, pVar)
    {
        // Sets an experimental variable.
        if (pVar == null)
        {
            pVar = this.vars;
        }    
	
        if (pVar != null)
        {
            this.form.experiment.vars.set(pVar, pVal);  
        }  
    };    
    
    // Bind the widget class to the osweb namespace.
    osweb.widget = widget;
}());


/*
 * Definition of the class button.
 */

(function() 
{
    function button(pForm, pProperties)
    {
	// Inherited create.
	this.widget_constructor(pForm);
	
        // Set the class private properties.
        this._element = document.createElement("BUTTON");
        this._element.style.width  = '100%';
        this._element.style.height = '100%';
        this._element.textContent = pProperties['text'];
        this._element.style.fontStyle  = this.form.experiment.vars.font_italic == 'yes' ? 'italic' : 'normal'; 
        this._element.style.fontWeight = this.form.experiment.vars.font_bold   == 'yes' ? 'bold'   : 'normal'; 
        this._element.style.fontFamily = this.form.experiment.vars.font_family;
        this._element.style.color      = this.form.experiment.vars.foreground;
        this._element.style.fontSize   = this.form.experiment.vars.font_size + 'px';

        // Add event listener to the element.
        this._element.addEventListener("click", this.response.bind(this));

        // Set the class public properties.
	this.center  = (typeof pProperties['center'] == 'boolean') ? pProperties['center'] : false; 
        this.frame   = (typeof pProperties['frame']  == 'boolean') ? pProperties['frame']  : false; 
        this.tab_str = '    ';
	this.type    = 'button';
	this.x_pad   = 8;
	this.y_pad   = 8;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(button, osweb.widget);

    // Definition of public properties. 
    p.center  = false;
    p.frame   = null;
    p.tab_str = '';
    p.text    = '';
    p.x_pad   = 0;
    p.y_pad   = 0;

    /*
     * Definition of public class methods - build cycle.
     */

    p.response = function(event)
    {
        console.log(this);
        // Complete the parent form.
        this.form.item.complete();
    };

    p.draw_text = function(pText, pHtml)
    {
        // Draws text inside the widget.
	pText = this.form.experiment.syntax.eval_text(pText);
	pText = safe_decode(pText).replace('\t', this.tab_str);

        if (this.center == true)
        {
            var x = this.rect.x + this.rect.w / 2;
            var y = this.rect.y + this.rect.h / 2;
        }  
        else
        {        
            var x = this.rect.x + this.x_pad;
            var y = this.rect.y + this.y_pad;
        }
        
        var w = this.rect.w - 2 * this.x_pad;
        
	this.form.canvas.text(pText, this.center, x, y, w, pHtml);
    };    

    p.render = function()
    {
	// Draws the widget.
        if (this.frame == true)
        {    
            this.draw_frame(this.rect);
        }
        
        this.draw_text(this.text); 
    };            
                
    // Bind the button class to the osweb namespace.
    osweb.button = osweb.promoteClass(button, "widget");
}());


/*
 * Definition of the class checkbox.
 */

(function() 
{
    function checkbox(pForm, pProperties)
    {
	// Inherited create.
	this.widget_constructor(pForm);
	
        // Set the class private properties.
        this._element       = document.createElement("LABEL"); 
        this._element_check = document.createElement("INPUT");
        this._element_check.setAttribute("type", "checkbox");
        this._element.style.width      = '100%';
        this._element.style.height     = '100%';
        this._element.textContent        = pProperties['text'];
        
        //this._element.innerHTML        = pProperties['text'];
        this._element.style.fontStyle  = this.form.experiment.vars.font_italic == 'yes' ? 'italic' : 'normal'; 
        this._element.style.fontWeight = this.form.experiment.vars.font_bold   == 'yes' ? 'bold'   : 'normal'; 
        this._element.style.fontFamily = this.form.experiment.vars.font_family;
        this._element.style.color      = this.form.experiment.vars.foreground;
        this._element.style.fontSize   = this.form.experiment.vars.font_size + 'px';
        this._element.appendChild(this._element_check);

        // Add event listener to the element.
        this._element.addEventListener("click", this.on_mouse_click.bind(this));

        console.log('---');
        console.log(pProperties);

        // Set the class public properties.
	this.click_accepts = (typeof pProperties.click_accepts === 'undefined') ? false : pProperties.click_accepts;
	this.group         = (typeof pProperties.group === 'undefined') ? null : pProperties.group;
	this.type          = 'checkbox';
        this.var           = (typeof pProperties.var === 'undefined') ? null : pProperties.var;
        this.checked       = (typeof pProperties.checked === 'checked') ? false  : pProperties.checked;
        
        // Set the current status of the checkbox.
        this.set_var(this.checked);
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(checkbox, osweb.widget);

    // Definition of public properties. 
    p.center  = false;
    p.frame   = null;
    p.tab_str = '';
    p.text    = '';
    p.x_pad   = 0;
    p.y_pad   = 0;

    /*
     * Definition of public class methods.
     */

    p.on_mouse_click = function(event)
    {
       console.log('checkbox clicked'); 
    
    };
                
    // Bind the checkbox class to the osweb namespace.
    osweb.checkbox = osweb.promoteClass(checkbox, "widget");
}());


/*
 * Definition of the class label.
 */

(function() 
{
    function label(pForm, pProperties)
    {
	// Inherited create.
	this.widget_constructor(pForm);
	
        // Set the class private properties.
        this._element = document.createElement("SPAN");
        this._element.innerHTML = pProperties['text'];
        
        // Set the class public properties.
	this.center  = (typeof pProperties['center'] == 'boolean') ? pProperties['center'] : false; 
        this.frame   = (typeof pProperties['frame']  == 'boolean') ? pProperties['frame']  : false; 
        this.tab_str = '    ';
	this.type    = 'label';
	this.x_pad   = 8;
	this.y_pad   = 8;
    }; 
	
    // Extend the class from its base class.
    var p = osweb.extendClass(label, osweb.widget);

    // Definition of public properties. 
    p.center  = false;
    p.frame   = false;
    p.tab_str = '';
    p.text    = '';
    p.x_pad   = 0;
    p.y_pad   = 0;

    /*
     * Definition of public class methods - build cycle.
     */

    p.draw_text = function(pText, pHtml)
    {
        // Draws text inside the widget.
	pText = this.form.experiment.syntax.eval_text(pText);
	pText = safe_decode(pText).replace('\t', this.tab_str);

        if (this.center == true)
        {
            var x = this.rect.x + this.rect.w / 2;
            var y = this.rect.y + this.rect.h / 2;
        }  
        else
        {        
            var x = this.rect.x + this.x_pad;
            var y = this.rect.y + this.y_pad;
        }
        
        var w = this.rect.w - 2 * this.x_pad;
        
	this.form.canvas.text(pText, this.center, x, y, w, pHtml);
    };    

    p.render = function()
    {
	// Draws the widget.
        if (this.frame == true)
        {    
            this.draw_frame(this.rect);
        }
        
        this.draw_text(this.text); 
    };            
                
    // Bind the label class to the osweb namespace.
    osweb.label = osweb.promoteClass(label, "widget");
}());


(function() {
    // Class events - processing all user and system evens within osweb.
    function events() {
    	throw 'The class events cannot be instantiated!';
    }; 
	
    // Definition of private properties.
    events._active = false;                                // If true event processing is active.
    events._caller = null;                                 // The caller object (clock, keyboard, mouse).
    events._current_item = null;			   // Contain the current active item. 			
    events._keyboard_mode = osweb.constants.PRESSES_ONLY;  // Keyboard collecting mode (down/up/both).
    events._keyboard_event = null;                         // Contains the last known keyboard event.
    events._mouse_mode = osweb.constants.PRESSES_ONLY;     // Mouse collecting mode (down/up/both).
    events._mouse_move = null;                             // Contains the last known mouse move event (used within the mouse class).
    events._mouse_press = null;				   // Contains the last known mouse press event (used within the mouse class).	
    events._response_given = false;			   // Valid response toggle
    events._response_type = -1;				   // Set type of response (0 = none, 1 = keyboard, 2 = mouse, 3 = sound). 
    events._response_list = null;	                   // Items to respond on.
    events._sound_ended = false;			   // Sound play is finished.
    events._timeout = -1;                                  // Duration for timeout.
    events._video_ended = false;			   // Video play is finished.
    
    // Definition of the conversion table to convert keycodes to OpenSesame codes.
    events.KEY_CODES = ['','','','','','','help','','backspace','tab','','','clear','enter','enter_special','','shift','ctrl','alt','pause',         // 00  .. 19
        'caps','','','','','','','escape','','','','','space','page up','page down','end','home','left','up','right',                                // 20  .. 39
        'down','select','print','execute','print screen','insert','delete','','0','1','2','3','4','5','6','7','8','9',':',';',                       // 40  .. 59
        '<','=','>','?','@','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o',                                                             // 60  .. 79
        'p','q','r','s','t','u','v','w','x','y','z','left meta','right meta','menu','','','kp0','kp1','kp2','kp3',                                   // 80  .. 99
        'kp4','kp5','kp6','kp7','kp8','kp9','kp_multiply','kp_plus','','kp_minus','kp_period','kp_divide','f1','f2','f3','f4','f5','f6','f7','f8',   // 100 .. 119
        'f9','f10','f11','f12','','','','','','','','','','','','','','','','',                                                                      // 120 .. 139
        '','','','','numlock','scrollock','','','','','','','','','','','','','','',                                                                 // 140 .. 159
        '^','!','"','#','$','%','&','_','(',')','*','+','|','_','{','}','~','','','',                                                                // 160 .. 179
        '','','','','','',';','=',',','-','.','/','`','','','','','','','',                                                                          // 180 .. 199
        '','','','','','','','','','','','','','','','','','','','[',                                                                                // 200 .. 219
        '\\',']','\'','','','','','','','','','','','','','','','','','',                                                                            // 220 .. 239
        '','','','','','','','','','','','','','','',''];                                                                                            // 240 .. 255
    // Definition of the conversion table to convert shift keycodes to OpenSesame codes.
    events.KEY_SCODES = ['','','','','','','','','','','','','','','','','','','','pause',                                                           // 00  .. 19
        '','','','','','','','','','','','','','','','','','','','',                                                                                 // 20  .. 39
        '','','','','','','','',')','!','@','#','$','%','^','&','*','(','',':',                                                                      // 40  .. 59
        '','+','','','','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o',                                                                 // 60  .. 79
        'p','q','r','s','t','u','v','w','y','z','','','','','','','','','','',                                                                       // 80  .. 99
        '','','','','','','','','','','','','','','','','','','','',                                                                                 // 100 .. 119
        '','','','','','','','','','','','','','','','','','','','',                                                                                 // 120 .. 139
        '','','','','','','','','','','','','','','','','','','','',                                                                                 // 140 .. 159
        '','','','','','','','','','','','','','_','','','','','','',                                                                                // 160 .. 179
        '','','','','','','','','<','','>','?','~','','','','','','','',                                                                             // 180 .. 199
        '','','','','','','','','','','','','','','','','','','','{',                                                                                // 200 .. 219
        '|','}','"','','','','','','','','','','','','','','','','','',                                                                              // 220 .. 239
        '','','','','','','','','','','','','','','',''];                                                                                            // 240 .. 255
   
    // Definition of methods for general event processing.    

    events._initialize = function() {
	// Initialize the keyboard event listeners.
        window.addEventListener("keydown", this._keyDown.bind(this), false); 
        window.addEventListener("keyup", this._keyUp.bind(this), false);

	// Initialize the mouse event listeners.
    	osweb.runner._canvas.addEventListener("mousedown", this._mouseDown.bind(this), false);
	osweb.runner._canvas.addEventListener("mousemove", this._mouseMove.bind(this), false);
	osweb.runner._canvas.addEventListener("mouseup", this._mouseUp.bind(this), false);
        
    	// Initialize the mouse context event listeners.
        osweb.runner._canvas.addEventListener("contextmenu", this._mouseContext.bind(this), false);

	// Initialize the tick event listener.
	createjs.Ticker.setInterval(15);
	createjs.Ticker.addEventListener("tick", this._tick.bind(this));	
    };
 
    events._finalize = function() {
    	// Finalize the tick event listener.             
	createjs.Ticker.removeEventListener("tick");

	// Finalize the mouse context event listeners.
	osweb.runner._canvas.removeEventListener("contextmenu", this._mouseContext, false);

	// Finalize the mouse event listeners.
	osweb.runner._canvas.removeEventListener("mousedown", this._mouseDown, false);
	osweb.runner._canvas.removeEventListener("mousemove", this._mouseMove, false); 
	osweb.runner._canvas.removeEventListener("mouseup", this._mouseUp, false); 

	// Finalize the keyboard event listeners.
        window.removeEventListener("keydown", this._keyDown, false);
	window.removeEventListener("keyup", this._keyUp, false);
    };
	
    events._run = function(caller, timeout, response_type, response_list) {
	// Set the event running properties.     
	this._caller = caller;
	this._response_list = response_list;
	this._response_type = response_type;
	this._timeout = timeout;

	// Activate the event running.  
	this._response_given = false;
	this._sound_ended = false;							    
	this._video_ended = false;
        this._active = true;	
    };

    events._update = function() {
    	// Check if the duration is finisdhed.
   	if (((this._timeout === -1) && ((this._response_given === true) || (this._sound_ended === true) || (this._video_ended === true))) ||
            ((this._timeout > 0) && ((this._response_type === osweb.constants.RESPONSE_KEYBOARD) || (this._response_type === osweb.constants.RESPONSE_MOUSE)) && (this._response_given === true)) ||
            (((this._timeout > 0) && (this._current_item.clock.time() - this._current_item.experiment.vars.get('time_' + this._current_item.name)) > this._timeout))) {
            // Set the status of the current item to finalize.
            this._current_item._status = osweb.constants.STATUS_FINALIZE;
  	}
        else {
            // Update the current item.
            this._current_item.update();
        }    
    };
    
    events._complete = function() {
        // Disable the ticker
        this._active = false;
        
        // Remove the items from the general stack.
	osweb.item_stack.pop();

        // Execute the post-run phase after duration is finished or response is received.
	this._current_item.complete();
    };

    // Definition of methods for keyboard event processing.
	
    events._convertKeyCode = function(event)
    {
        // Check for special characters
        var key = '';
        if ((event.shiftKey === true) && (event.keyCode !== 16))
        {
            // Shift key pressed with other key, so convert shift keys.
            key = this.KEY_SCODES[event.keyCode];
        } 
        else if ((event.shiftKey === true) && (event.keyCode === 16))
        {
            // Shift code pressed, check for location (left or right)
            key = (event.location == 1) ? 'lshift' : 'rshift'; 
        } 
        else if ((event.ctrlKey === true) && (event.keyCode === 17))
        {
            // Ctrl code pressed, check for location (left or right)
            key = (event.location == 1) ? 'lctrl' : 'rctrl'; 
        } 
        else if ((event.altKey === true) && (event.keyCode === 18))
        {
            // Alt code pressed, check for location (left or right)
            key = (event.location == 1) ? 'lalt' : 'ralt'; 
        } 
        else
        {
            // Convert standard keycode.
            key  = this.KEY_CODES[event.keyCode];
        } 
        
        // Return function result.
        return key;
    };
        
    events._keyDown = function(event) {
        // Store the keyboard event.    
	this.keyboard_event = event;

        // Only select this event when the collection mode is set for this.
    	if ((this._keyboard_mode === osweb.constants.PRESSES_ONLY) || (this._keyboard_mode === osweb.constants.PRESSES_AND_RELEASES)) {
            // Process the event.
            this._processKeyboardEvent(event, 1);
    	} 
    };	 

    events._keyUp = function(event) {
    	// Only select this event when the collection mode is set for this.
    	if ((this._keyboard_mode === osweb.constants.RELEASES_ONLY) || (this._keyboard_mode === osweb.constants.PRESSES_AND_RELEASES)) {
            // Process the event.
            this._processKeyboardEvent(event, 0);
    	} 	 
    };

    events._processKeyboardEvent = function(event, keyboard_state) {
        // Create a new keyboard response object.
        var KeyboardResponses = {'event': event, 'rtTime':  osweb.runner.experiment.clock.time(), 'state': keyboard_state, 'type': osweb.constants.RESPONSE_KEYBOARD};
      
        // Convert response to proper keyboard token. 
        KeyboardResponses.resp = this._convertKeyCode(event);
        
        // Process the response to the current object.
        if ((this._response_type === osweb.constants.RESPONSE_KEYBOARD) && ((this._response_list === null) || (this._response_list.indexOf(KeyboardResponses.resp) >= 0))) {
            // Process the current item.
	    if (this._current_item !== null) {
                // Process the response.
                this._current_item.update_response(KeyboardResponses);
            } 	 
        
            // Set the valid response given toggle.
            this._response_given = true;
        }
    };
	
    // Definition of methods for mouse event processing.
 
    events._mouseContext = function(event) {
        // Prevent default action. 
        event.preventDefault();
        
        // Return false to prevent the context menu from pushing up.
        return false;
    };            
 
    events._mouseDown = function(event) {
        // Store the mouse press status for use in the mousee class.
        this._mouse_press = event;

	// Only select this event when the collection mode is set for this.
    	if ((this._mouse_mode === osweb.constants.PRESSES_ONLY) || (this._mouse_mode === osweb.constants.PRESSES_AND_RELEASES)) {
            // Process the event.
            this._processMouseEvent(event, 1);
    	}	
    };	

    events._mouseMove = function(event) {
        // Store the mouse move event and its timestamp for use in the mouse class.
        this._mouse_move = {'event': event, 'rtTime': osweb.runner.experiment.clock.time()};
    };	

    events._mouseUp = function(event) {
	// Only select this event when the collection mode is set for this.
    	if ((this._mouse_mode === osweb.constants.RELEASES_ONLY) || (this._mouse_mode === osweb.constants.PRESSES_AND_RELEASES)) {
            // Process the event.
            this._processMouseEvent(event, 0);
    	} 	
    };

    events._processMouseEvent = function(event, mouse_state) {
        // Create a new mouse response object.
        var MouseResponses = {'event': event, 'rtTime': osweb.runner.experiment.clock.time(), 'state': mouse_state, 'type': osweb.constants.RESPONSE_MOUSE};
     	
     	// Adjust mouse response.  
     	MouseResponses.resp = String(event.button + 1);  
     	 
        // Process the response to the current object.
        if ((this._response_type === osweb.constants.RESPONSE_MOUSE) && ((this._response_list === null) || (this._response_list.indexOf(MouseResponses.resp) >= 0))) {
            // Process the response to the current object.
            if (this._current_item !== null) {
                this._current_item.update_response(MouseResponses);
            }   

            // Set the valid response given toggle.
            this._response_given = true;
	}
    };
	
    // Definition of methods for sound event processing.

    events._audioEnded = function() {
        // If duration isequal to sound exit the sound item.
        osweb.events._sound_ended = true;
    };

    // Definition of methods for video event processing.

    events._videoEnded = function() {
        osweb.events._video_ended = true;
    };

    events._videoPlay = function(event) {
    };

    // Definition of methods for tick event processing (timing).
 
    events._tick = function(event) {
    	// Only check for status if there is a current item and the ticker is activated.
        if ((this._current_item !== null) && (this._active === true)) {
            switch (this._current_item._status) {
                case osweb.constants.STATUS_FINALIZE:
                   // End action. Complete current active item.
                    events._complete();
                break;
		default:
                    // Default action, update section of the current active item.
                    events._update();
            }
	}
    };	 

    // Bind the events class to the osweb namespace.
    osweb.events = events;
}());


(function() {
    // Definition of the class Parameters.
    function parameters() {
	throw 'The class parameters cannot be instantiated!';
    } 

    // Define the private properties. 
    parameters._itemCounter = 0;
    parameters._parameters  = new Array();

    // Define the public properties. 
    parameters.displaySummary   = false;
    parameters.useDefaultValues = false;

    // Definition of private methods - initialize parameters.   

    parameters._initialize = function() {
      	// Set properties if defined.
    	var parameter = {dataType: '0', defaultValue: '0', name: 'subject_nr', prompt: 'Please enter the subject number', promptEnabled: true};
        
        // Add the subject parameter to the parameters list.
        this._parameters.push(parameter);
    };

    // Definition of private methods - process parameters.   
    
    parameters._processParameters = function() {
    	// Process all items for which a user input is required.
        if (this._itemCounter < this._parameters.length) {	
            // Process the Parameter.
            if (this.useDefaultValues == false) {
                this._processParameter(this._parameters[this._itemCounter]);
            }
            else {
                // Transfer the startup info to the context.
                this._transferParameters();
            }    
        }
        else {
            // All items have been processed, contine the Runner processing.
            if (this.displaySummary == true) {
                // Show a summary of the the startup information. 
                this._showParameters();
            }
            else {            
                // Transfer the startup info to the context.
                this._transferParameters();
            }
        }
    };

    parameters._processParameter = function(parameter) {
        // Check if a user request is required.
        if (parameter.promptEnabled == true) {
            this._showDialog(parameter.dataType);

            // Set the dialog interface.
            if (parameter.response == '') {
            	document.getElementById('qpdialoginput').value = parameter.defaultValue;
            }
            else {
            	document.getElementById('qpdialoginput').value = parameter.defaultValue;
            }

            document.getElementById('dialogboxhead').innerHTML = parameter.prompt;
            document.getElementById('qpbuttonyes').onclick = function() {
                // Get the response information
                parameter.response = document.getElementById('qpdialoginput').value;
                            
                // Close the dialog.
                this._hideDialog();
            
                // Increase the counter.
                this._itemCounter++;

                // Continue processing.
                this._processParameters();

            }.bind(this);
        	
            document.getElementById('qpbuttonno').onclick = function() {
                // Close the dialog.
	        this._hideDialog();
                
   		// Finalize the introscreen elements.
		osweb.runner._exit();
            }.bind(this);
        }
        else {
            // Assign default value to the Startup item.
            parameter.response = parameter.defaultValue;
           
            // Increase the counter.
            this._itemCounter++;

            // Continue processing.
            this._processParameters();
        }    
    };

    parameters._showParameters = function() {
        document.getElementById('dialogboxhead').innerHTML = 'Summary of startup info';
        document.getElementById('qpbuttonyes').onclick = function() {
            // Close the dialog.
	    this._hideDialog();
                        
            // Transfer the startup info to the context.
            this._transferParameters(); 
        
        }.bind(this);    
        
        document.getElementById('qpbuttonno').onclick = function() {
            // Close the dialog.
            this._hideDialog();
                       
            // Reset the item counter.
            this._itemCounter = 0;
                        
            // Restat the input process.    
            this._processParameters(); 
            
        }.bind(this);    

        document.getElementById('qpbuttoncancel').onclick = function() {
            // Close the dialog.
	    this._hideDialog();
        
            // Finalize the introscreen elements.
            osweb.runner._exit();
        }.bind(this);    
       
  	// Set the dialog interface.
        var TmpString = '';
        for (var i = 0;i < this._parameters.length; i++) {
            if ((this._parameters[i].enabled != 0) && (this._parameters[i].promptEnabled != 0)) {
		TmpString = TmpString + this._parameters[i].name + ': ' + this._parameters[i].response + '\r\n';  	        	
            }
        }

        document.getElementById('qpdialogtextarea').innerHTML = TmpString;
    };

    parameters._transferParameters = function() {
    	// Transfer the startup info items to the context.
        for (var i = 0;i < this._parameters.length; i++) {
            osweb.runner.experiment.vars.set(this._parameters[i].name,this._parameters[i].response);
        }
        
	// Parameters are processed, next phase.
        osweb.runner._prepareStartScreen();
    };
    
    /*
     * Definition of class methods (dialogs).   
     */
     
    parameters._showDialog = function(dialog_type) {
        var dialogoverlay = document.getElementById('dialogoverlay');
	var dialogbox = document.getElementById('dialogbox');
		                
	dialogoverlay.style.display = "block";
	dialogoverlay.style.height = window.innerHeight + "px";
	dialogbox.style.left = (window.innerWidth / 2) - (400 * .5) + "px";
	dialogbox.style.top = "200px";
	dialogbox.style.display = "inline";

	switch (dialog_type)
        {
	    case "0": 
                document.getElementById('dialogboxbody').innerHTML = '<input id="qpdialoginput"></input>';
	    	document.getElementById('dialogboxfoot').innerHTML = '<button id="qpbuttonyes">Ok</button><button id="qpbuttonno">Cancel</button>';
                document.getElementById('qpdialoginput').focus();
            break;
            case "1": 
	        document.getElementById('dialogboxbody').innerHTML = '<input id="qpdialoginput"></input>';
		document.getElementById('dialogboxfoot').innerHTML = '<button id="qpbuttonyes">Ok</button><button id="qpbuttonno">Cancel</button>';
                document.getElementById('qpdialoginput').focus();
            break;
            case "2": 
	        document.getElementById('dialogboxbody').innerHTML = '<input id="qpdialoginput"></input>';
		document.getElementById('dialogboxfoot').innerHTML = '<button id="qpbuttonyes">Ok</button><button id="qpbuttonno">Cancel</button>';
                document.getElementById('qpdialoginput').focus();
            break;
            case "3": 
	        document.getElementById('dialogboxbody').innerHTML = '<textarea id="qpdialogtextarea"></textarea>';
                document.getElementById('dialogboxfoot').innerHTML = '<button id="qpbuttonyes">Yes</button><button id="qpbuttonno">No</button><button id="qpbuttoncancel">Cancel</button>';
                document.getElementById('qpdialogtextarea').focus();
            break;
	}
    };
	 
    parameters._hideDialog = function() {
        dialogoverlay.style.display = "none";
	dialogbox.style.display = "none";
	document.getElementById('dialogboxbody').innerHTML = '';
	document.getElementById('dialogboxfoot').innerHTML = '';
    };	

    // Bind the parameters class to the osweb namespace.
    osweb.parameters = parameters;
}());


(function() {
    // Definition of the class session.
    function parser() {
	throw 'The class parser cannot be instantiated!';
    }

    // Definition of private properties.
    parser._ast_tree = null;    
    parser._current_node = null;
    parser._inline_script = null;
    parser._status = 0;                      
                
    // Definition of private methods - prepare cycle.   

    parser._prepare = function(script) {
        if (script !== '') {
            var locations = false;
            var parseFn = filbert_loose.parse_dammit;
            var ranges = false;
        		
	    try {
                var code = script;
           	var ast = parseFn(code, { locations: locations, ranges: ranges });
	        return ast;
    	    }
       	    catch (e) {
        	console.log('error');
        	console.log(e.toString());
                return null;
            }
        } else
	{
            return null;
        }	   	
    };
    
    // Definition of private methods - general parser functions.

    parser._set_return_value = function(node, value) {
        var index = 0;
        while (typeof node['returnvalue' + String(index)] !== 'undefined') {
            index++;
        }    
        
        // Set the return value\
        node['returnvalue' + String(index)] = value;
    };
    
    // Definition of private methods - node processing.
    
    parser._node_binary_expression = function() {
        // Initialize status property.
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0  : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // process right expression;
                this._current_node.status = 1;
                this._current_node.right.parent = this._current_node;
                this._current_node = this._current_node.right;

                // Return to the node processessor.
                this._process_node();
            break;        
            case 1: 
                // process right expression;
                this._current_node.status = 2;
                this._current_node.left.parent = this._current_node;
                this._current_node = this._current_node.left;

                // Return to the node processessor.
                this._process_node();
            break;        
            case 2: 
                var left,right;
                if  (typeof window[this._current_node.returnvalue0] === 'undefined') {
                    var right = this._current_node.returnvalue0;
                }
                else {
                    var right = window[this._current_node.returnvalue0];
                }
                var left,right;
                if  (typeof window[this._current_node.returnvalue1] === 'undefined') {
                    var left = this._current_node.returnvalue1;
                }
                else {
                    var left = window[this._current_node.returnvalue1];
                }
            
                // Select the binary operator to perform.
                switch (this._current_node.operator) {
                    case '-':
                        // Process call - check for blocking methods.
                        this._set_return_value(this._current_node.parent,left - right);
                    break;
                }

                // Set parent node.
                this._current_node.status = 3;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;        
        }    
    };    

    parser._node_call_expression = function() {
        // Initialize status property.
        this._current_node.arguments = (typeof this._current_node.arguments === 'undefined') ? [] : this._current_node.arguments;
        this._current_node.index = (typeof this._current_node.index === 'undefined') ? 0  : this._current_node.index; 
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0  : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Process arguments.
                if (this._current_node.index < this._current_node.arguments.length) {
                    // Set current node to next node in list.
                    this._current_node.index++;
                    this._current_node.arguments[this._current_node.index - 1].parent = this._current_node;
                    this._current_node = this._current_node.arguments[this._current_node.index - 1];
        
                    // Return to the node processessor.
                    this._process_node();
                } 
                else { 
                    // Set parent node.
                    this._current_node.status = 1;

                    // Return to the node processessor.
                    this._process_node();
                }
            break;
            case 1: 
                // Set parent node.
                this._current_node.status = 2;
                this._current_node.callee.parent = this._current_node;
                this._current_node = this._current_node.callee;

                // Return to the node processessor.
                this._process_node();
            break;    
            case 2: 
                // Set status of node.
                this._current_node.status = 3;
            
                // Create the aruments array.
                var tmp_arguments = [];
                for (var i=0;i< this._current_node.arguments.length; i++) {
                    if (typeof window[this._current_node['returnvalue' + String(i)]] !== 'undefined') {
                        tmp_arguments.push(window[this._current_node['returnvalue' + String(i)]]);
                    }    
                    else {    
                        tmp_arguments.push(this._current_node['returnvalue' + String(i)]);
                    }    
                }    
                    
                // Select the type of call to process
                var callee = this._current_node['returnvalue' + String(this._current_node.arguments.length)];
                var returnvalue = null;
                if (callee.type == 'function') {
                    // function call
                    returnvalue = window[callee.obj].apply(null, tmp_arguments);
                    
                    // Process call - check for blocking methods.
                    this._current_node.parent['returnvalue' + String(this._current_node.arguments.length)] = returnvalue;
                
                    // Return to the node processessor.
                    this._process_node();
                }    
                else if (callee.type == 'object') {
                    if ((callee.obj == 'clock') && (callee.prop == 'sleep')) {
                        // Process special calls with blocking (no direct result processing).
                        window[callee.obj][callee.prop].apply(window[callee.obj], tmp_arguments);
                    }    
                    else {    
                        // object methods calls.
                        returnvalue = window[callee.obj][callee.prop]();
                    
                        // Process call - check for blocking methods.
                        this._current_node.parent['returnvalue' + String(this._current_node.arguments.length)] = returnvalue;
                
                        // Return to the node processessor.
                        this._process_node();
                    }        
                }
                else {
                    switch (callee) {   
                        case 'canvas':
                            returnvalue = new osweb.canvas();
                        break;    
                    }    
                  
                    // Process call - check for blocking methods.
                    this._current_node.parent['returnvalue' + String(this._current_node.arguments.length)] = returnvalue;
                
                    // Return to the node processessor.
                    this._process_node();
                }    
            break;    
            case 3: 
                // Set parent node.
                this._current_node.status = 4;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;        
        }    
    };

    parser._node_expression_statement = function() {
        // Initialize status property.
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0  : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Set parent node.
                this._current_node.status = 1;
                this._current_node.expression.parent = this._current_node;
                this._current_node = this._current_node.expression;

                // Return to the node processessor.
                 this._process_node();
            break;
            case 1: 
                // Set parent node.
                this._current_node.status = 2;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;
        ;}    
    };

    parser._node_identifier = function() {
        // Return function result.
        if (typeof window[this._current_node.name] === 'undefined') {
            // Item is undefined, create it without value/type definition.
            window[this._current_node.name] = null;
        }
        
        // Set the return value.
        this._set_return_value(this._current_node.parent, this._current_node.name);

        // Set parent node.
        this._current_node = this._current_node.parent;

        // Return to the node processessor.
        this._process_node();
    };

    parser._node_literal = function()
    {
        // Set the return value.
        this._set_return_value(this._current_node.parent, this._current_node.value);
        
        // Set parent node.
        this._current_node = this._current_node.parent;

        // Return to the node processessor.
        this._process_node();
    };

    parser._node_member_expression = function()
    {
        // Initialize status property.
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0 : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Process object.
                this._current_node.status = 1;
                this._current_node.object.parent = this._current_node;
                this._current_node = this._current_node.object;
                
                // Return to the node processessor.
                this._process_node();
            break;    
            case 1: 
                // Process object.
                this._current_node.status = 2;
                this._current_node.property.parent = this._current_node;
                this._current_node = this._current_node.property;

                // Return to the node processessor.
                this._process_node();
            break;    
            case 2: 
                // Set the return value.
                //console.log('member->');
                //console.log(typeof this._current_node.returnvalue0);
                    
                if (typeof this._current_node.returnvalue0 == 'object') {
                    this._set_return_value(this._current_node.parent,{ 'obj': this._current_node.returnvalue1, 'prop': null, 'type': 'function'});
                }
                else {    
                    this._set_return_value(this._current_node.parent,{ 'obj': this._current_node.returnvalue0, 'prop': this._current_node.returnvalue1,'type':'object'});
                }
                
                // Set parent node.
                this._current_node.status = 3;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;    
        }        
    };

    parser._node_program = function()
    {
        // Initialize index counter only the fitst time.
        this._current_node.index = (typeof this._current_node.index === 'undefined') ? 0 : this._current_node.index; 
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0 : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Check if all nodes in script have been processed.
                if (this._current_node.index < this._current_node.body.length) {
                    // Set current node to next node in list.
                    this._current_node.index++;
                    this._current_node.body[this._current_node.index - 1].parent = this._current_node;
                    this._current_node = this._current_node.body[this._current_node.index - 1];

                    // Return to the node processessor.
                    this._process_node();
                }
                else {
                    // End status.
                    this._current_node.status = 1;
                
                    // Return to the node processessor.
                    this._process_node();
                }    
            break;
            case 1:
                // Change the node stats.                                
                this._current_node.status = 2;

                // All nodes are processed, set status to finished.
                this._status = 2;
        
                // Complete the inline item.    
                if (this._inline_script != null) {    
                    this._inline_script.complete();
                }    
            break;    
        }   
    };    

    parser._node_variable_declaration = function()
    {
        // Initialize index counter only the fitst time.
        this._current_node.index = (typeof this._current_node.index === 'undefined') ? 0 : this._current_node.index; 
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0 : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Check if all nodes in script have been processed.
                if (this._current_node.index < this._current_node.declarations.length) {
                    // Set current node to next node in list.
                    this._current_node.index++;
                    this._current_node.declarations[this._current_node.index - 1].parent = this._current_node;
                    this._current_node = this._current_node.declarations[this._current_node.index - 1];

                    // Return to the node processessor.
                    this._process_node();
                } 
                else {
                    // Change the node stats.                                
                    this._current_node.status = 1;

                    // Return to the node processessor.
                    this._process_node();
                }    
            break; 
            case 1:
                // Change the node stats.                                
                this._current_node.status = 2;

                // Set parent node.
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;
        }   
    };

    parser._node_variable_declarator = function()
    {
        // Initialize status property.
        this._current_node.status = (typeof this._current_node.status === 'undefined') ? 0 : this._current_node.status; 
        
        // Process the current status.
        switch (this._current_node.status) {
            case 0: 
                // Process init.
                this._current_node.status      = 1;
                this._current_node.init.parent = this._current_node;
                this._current_node             = this._current_node.init;
                
                // Return to the node processessor.
                this._process_node();
            break;    
            case 1: 
                // process id.
                this._current_node.status    = 2;
                this._current_node.id.parent = this._current_node;
                this._current_node           = this._current_node.id;

                // Return to the node processessor.
                this._process_node();
            break;    
            case 2: 
                // Set variable.
                window[this._current_node.returnvalue1] = this._current_node.returnvalue0;      
                
                // Set parent node.
                this._current_node.status = 3;
                this._current_node = this._current_node.parent;

                // Return to the node processessor.
                this._process_node();
            break;    
        }
    };

    // Definition of private methods - general node processing.

    parser._process_node = function() {
        console.log('processing node');
        console.log(this._current_node);
        
        // Select the type of node to process
        switch(this._current_node.type) { 
            case 'BinaryExpression':
                this._node_binary_expression();
            break;
            case 'CallExpression':
                this._node_call_expression();
            break;
            case 'ExpressionStatement':
                this._node_expression_statement();
            break;
            case 'Identifier':
                this._node_identifier();
            break;
            case 'Literal':
                this._node_literal();
            break;
            case 'MemberExpression':
                this._node_member_expression();
            break;
            case 'Program':
                this._node_program();
            break;
            case 'VariableDeclaration':
                this._node_variable_declaration();
            break; 
            case 'VariableDeclarator':
                this._node_variable_declarator();
            break; 
        }
    };

    // Definition of private methods - run cycle.

    parser._runstatement = function(node) {
        // Call the expression statement en return the value.       
        return this._node_call_expression(node.expression);
    };
    
    parser._run = function(inline_script, ast_tree) {
        // Set the inline item. 
	this._inline_script = inline_script;
	
	// Set the first node and its parent.
	this._current_node = ast_tree;
        this._current_node.parent = null;
        this._status = 1;
        
    	// Process the nodes. 
	osweb.parser._process_node();
    };

    // Bind the parser class to the osweb namespace.
    osweb.parser = parser;
}()); 


(function() {
    // Definition of the class session - store user session information. 
    function session() {
    	throw 'The class session cannot be instantiated!';
    }

    // Definition of private methods.   

    session._initialize = function() {
    	// Update the loader text.
    	osweb.runner._updateIntroScreen(osweb.constants.MESSAGE_008);
	
    	// Get the session information.
	this._getSessionInformation();
    };

    session._getSessionInformation = function() {
    	// Get the session information from the client system.
    	this._date = new Date();
	this._session = {
            'browser': {
                'codename': navigator.appCodeName,
                'name': navigator.appName,
                'version': navigator.appVersion
            },
            'date': {
                'startdate': ('0' + this._date.getDate()).slice(-2) + '-' + ('0' + this._date.getMonth()).slice(-2) + '-' + ('0' + this._date.getFullYear()).slice(-2),
                'starttime': ('0' + this._date.getHours()).slice(-2) + ':' + ('0' + this._date.getMinutes()).slice(-2) + ':' + ('0' + this._date.getSeconds()).slice(-2),
                'startdateUTC' : ('0' + this._date.getUTCDate()).slice(-2) + '-' + ('0' + this._date.getUTCMonth()).slice(-2) + '-' + ('0' + this._date.getUTCFullYear()).slice(-2)
            },
            'experiment': {
		'debug': 0,
                'parameters': 0,
		'pilot': 0,
                'taskname': 0,
                'taskversion': 0
            },
            'screen': {
                'availableHeight': screen.availHeight,
                'availableWidth': screen.availWidth,
                'colorDepth': screen.colorDepth,
                'height': screen.height,
                'outerheight': window.outerheight,
                'outerwidth': window.outerwidth,
                'pixelDepth': screen.pixelDepth,
                'screenX': window.screenX,
                'screenY': window.screenY,
                'width': screen.width
            },
            'system': {
                'os': navigator.platform
            }
        };
    };

    // Bind the session class to the osweb namespace.
    osweb.session = session;
}()); 


(function() {
    // Definition of the class runner.
    function runner() {
    	throw 'The class runner cannot be instantiated!';
    };

    // Show library name and library version number in the console.
    console.log(osweb.VERSION_NAME + ' - ' + osweb.VERSION_NUMBER);	

    // Definition of private properties.
    runner._canvas = null;                       // Canvas on which the experiment is shown.
    runner._qualtrics = null;                    // Link to the qualtrics interface (optional)
    runner._stage = null;                        // Links to the stage object (CreateJS).

    // Definition of public properties.
    runner.data = null;                          // Container for the experiment result data (if defined).
    runner.debug = false;                        // Debug toggle.
    runner.experiment = null;                    // The root experiment object to run.           
    runner.onFinished = null;                    // Event triggered on finishing the experiment.
    runner.screenIntro = true;                   // Show introscreen toggle.
    runner.screenClick = true;                   // Show clickscreen toggle
    runner.script = null;                        // Container for the JSON script definition of the experiment.
    runner.scriptID = 0;                         // Id used when retrieving the script from the database.
    runner.scriptURL = '';                       // Path pointing to the AMFPHP database files.
    runner.session = null;                       // Container for the JSON session information.
    
    /*
    // Definition of private methods - setup runner.      
     */

    runner._setupContent = function(content) {
    	// Check if the experiment container is defined.                     
	if (typeof content !== "undefined") {
            // Get the canvas from the DOM Element tree.
            this._canvas = (typeof content === 'string') ? document.getElementById(content) : content; 		
		
            // Set the stage object (easelJS). 
            this._stage = new createjs.Stage(this._canvas);
            this._stage.snapToPixelEnabled = true;
            this._stage.regX = -.5;
            this._stage.regY = -.5;
		
            // Build the initialization screen.
            this._setupIntroScreen();
	}
	else {
            osweb.debug.addError(osweb.constants.ERROR_002);
	}
    };

    runner._setupContext = function(context) {
	// Check if the script parameter is defined.                        
	if (typeof context !== "undefined") {
            // Initialize the context parameters.
            this.debug = (typeof context.debug !== 'undefined') ? context.debug : false; 
            this.file = (typeof context.file !== 'undefined') ? context.file : null;
            this.onFinished = (typeof context.onFinished !== 'undefined') ? context.onFinished : null;
            this.screenClick = (typeof context.screenClick !== 'undefined') ? context.screenClick : true;				      
            this.screenIntro = (typeof context.screenIntro !== 'undefined') ? context.screenIntro : true; 
            this.script = (typeof context.script !== 'undefined') ? context.script : null;      
            this.scriptID = (typeof context.scriptID !== 'undefined') ? context.scriptID : 0;         
            this.scriptURL = (typeof context.scriptURL !== 'undefined') ? context.scriptURL : '';		 
            this.session = (typeof context.session !== 'undefined') ? context.session : null;
					
            // Check if an osexp script is given as parameter.                            
            if (this.script !== null) {	
                // Start building the experiment structure.      
		this._buildExperiment();
            }
            // Check if an osexp file is given as parameter. 
            else if (this.file !== null) {
                this._setupScriptFromFile();
            }	
            else {
                // Retrieve the script from an external location.
		this._setupScriptFromDatabase();
            }
	}
	else {
            osweb.debug.addError(osweb.constants.ERROR_003);
	}
    };

    runner._setupScriptFromFile = function() {
        // Check for binary or text file definition.
        if (this.file.substring(0,3) == '---') {
            this.script = String(this.file);
        } 
        else {
            // Decompress the gizp file and splitt the tar result.	
            GZip.loadlocal(this.file, function(h) {
                var tar = new TarGZ;
                tar.parseTar(h.data.join(''));
                tar.files.forEach(this.setupScriptFromFileResult.bind(this)); 
            }.bind(this), this.setupScriptFromFileProgress, this.setupScriptFromFileAlert);
        }    
        
        // Start building the experiment structure.      
	this._buildExperiment();
    };

    runner.setupScriptFromFileAlert = function() {
    };

    runner.setupScriptFromFileProgress = function() {
    };

    runner.setupScriptFromFileResult = function(pFile) {
	// Check if the file is the scriptfile.
    	if (pFile.filename === 'script.opensesame') {
            // Create the script.
            this.script = String(pFile.data);
   	}
	else if ((pFile.data !== null) && (pFile.data !== '')) {
            // Create a file pool element.
            osweb.pool.add_from_local_source(pFile);			
	}
    };

    runner._setupScriptFromDatabase = function() {
	// Check if the URL and ID is propertly defined.
       	if ((this.scriptID >= 0) && (this.scriptURL !== '')) {
            var url = this.scriptURL + '/php/index.php?/ajax/group/get_status';
            var parameters = {group_id: 99, task_number: this.scriptID};
		
            new Ajax.Request(url, {
            	parameters: parameters,
		onCreate: function(response) {
                    var t = response.transport;
                    t.setRequestHeader = t.setRequestHeader.wrap(function(original, k, v) {
			if (/^(accept|accept-language|content-language)$/i.test(k))
                            return original(k, v);
			if (/^content-type$/i.test(k) &&
                            /^(application\/x-www-form-urlencoded|multipart\/form-data|text\/plain)(;.+)?$/i.test(v))
                            return original(k, v);
			return;
                    });
		},
		onSuccess: function(transport) {
                    // Process the response
                    if (transport.responseText) {
                        // Retrieve the response text.
			var jsonresponse = JSON.parse(transport.responseText);
					
			// Check if the task is available.
			if (jsonresponse.task_available === '1') {
                            // Set the script parameter.
                            this.script = jsonresponse.data_available;
                            this.files  = jsonresponse.file_available.split('\r\n');    
                                    
                            // Create a file pool element.
                            osweb.pool.add_from_server_source(this.scriptURL + '/user/4/', this.files);			
                        }
			else {
                            // Show erorr message within the concole.
                            osweb.debug.addError(osweb.constants.ERROR_007);
			}
                    }	
                    else {
			// Show erorr message within the concole.
			osweb.debug.addError(osweb.constants.ERROR_006);
                    }
		}.bind(this),
		onFailure: function() {
                    // Show erorr message within the concole.
                    osweb.debug.addError(osweb.constants.ERROR_005);
		}.bind(this) 
            }); 
	}
	else {
            // Show erorr message within the concole.
            osweb.debug.addError(osweb.constants.ERROR_004);
	} 
    };

    // Definition of private methods - Introduction screen.

    runner._setupIntroScreen =  function() {
    	// Set the introscreen elements.
	if (this.screenIntro === true) {
            this._introScreen  = new createjs.Shape();
            this._introScreen.graphics.beginFill('#000000').drawRect(0,0,this._stage.width,this._stage.height);
            this._introLine    = new createjs.Shape();
            this._introLine.graphics.beginFill('#AAAAAA').drawRect(200,155,400,1);
            this._introText1   = new createjs.Text('OS', "24px bold Times", "#FF0000");
            this._introText1.x = 200;
            this._introText1.y = 135;
            this._introText2   = new createjs.Text(osweb.constants.MESSAGE_002 + osweb.VERSION_NUMBER, "14px Arial", "#FFFFFF");
            this._introText2.x = 231;
            this._introText2.y = 142;
            this._introText3   = new createjs.Text(osweb.constants.MESSAGE_003,"12px Arial", "#FFFFFF");
            this._introText3.x = 200;
            this._introText3.y = 168;
            this._stage.addChild(this._introScreen,this._introLine,this._introText1,this._introText2,this._introText3);
            this._stage.update();
	}
    };
	
    runner._clearIntroScreen = function(){
        // Update the introscreen elements.
	if (this.screenIntro === true) {
            this._stage.removeChild(this._introScreen,this._introLine,this._introText1,this._introText2,this._introText3);
            this._stage.update();
	}		
    };
	
    runner._updateIntroScreen = function(text) {
	// Update the introscreen elements.
	if (this.screenIntro === true) {
            this._introText3.text = text;
            this._stage.update();
	}		
    };

    // Definition of the private methods - build cycle.      

    runner._buildExperiment = function() {
    	// Build the base experiment object.
	this.experiment = new osweb.experiment(null, 'test', this.script);
	
        // Create the global static object classes.
	window['items'] = osweb.item_store;
	window['pool']  = osweb.file_pole_store;
	window['vars']  = this.experiment.vars;
		
	// Pepare the experiment to run.
	this._prepare();
    };

    // Definition of private methods - prepare cycle.   

    runner._prepare = function() {
	// Update inroscreen.
	this._updateIntroScreen(osweb.constants.MESSAGE_004);
		
	// Start the stimuli loader.
	osweb.parameters._initialize();
        osweb.functions._initialize();
	osweb.session._initialize();

        // Start the parameter screen (subject number).
        this._prepareParameters();
    };

    runner._prepareParameters = function() {
        // Update inroscreen.
	this._updateIntroScreen(osweb.constants.MESSAGE_005);

	// Check if items must be processed. 
	if (osweb.parameters._parameters.length > 0) {
		// Process the Parameters.        
   	    osweb.parameters._processParameters();
	}
	else { 
            // Start the experiment.
   	    this._prepareStartScreen();
	}
    };

    runner._prepareStartScreen = function() {
        // Check if the experiment must be clicked to start.
        if (this.screenClick === true) {
            // Update inroscreen.
            this._updateIntroScreen(osweb.constants.MESSAGE_006);
		
            // Setup the mouse click response handler.
            var clickHandler = function(event) {
		// Remove the handler.
		this._canvas.removeEventListener("click", clickHandler);

		// Finalize the introscreen elements.
		this._clearIntroScreen();

                // Start the task.
		this._initialize();
            }.bind(this); 

            // Set the temporary mouse click.
            this._canvas.addEventListener("click", clickHandler, false);
	}
	else {
            // Finalize the introscreen elements.
            this._clearIntroScreen();

            // Start the runner.
            this._initialize(); 
	}
    };

    // Definition of private methods - run cycle.   
    
    runner._initialize = function() {
	// Initialize the debugger. 
	osweb.debug._initialize();

        // Initialize the devices.
	osweb.events._initialize();

        // Prepare and execute the experiment item.
	this.experiment.prepare();
	this.experiment.run();
    };
	
    runner._finalize = function() {   
        // Finalize the devices.
    	osweb.events._finalize();
        
    	// Finalize the debugger. 
	osweb.debug._finalize();

        // Exit the application.
        this._exit();
    };

    runner._exit = function() {
        // Clear the canvas.
        this._stage.clear();
        
        // Set the cursor visibility to default.
        this._stage.canvas.style.cursor = "default";

        // Check if an event handler is attached.
	if (this.onFinished) {
            // Execute.
            this.onFinished(this.data, osweb.session._session);
	}
    };

    // Definition of public methods - run cycle.      

    runner.run = function(content, context) {
        // Initialize the content container.
	this._setupContent(content);

	// Initialize the context parameter
	this._setupContext(context);
    };

    // Bind the runner class to the osweb namespace.
    osweb.runner = runner;
}()); 

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZWpzLmpzIiwiZmlsYmVydC5qcyIsImZpbGJlcnRfbG9vc2UuanMiLCJnemlwLmpzIiwicHJvdG90eXBlLmpzIiwidWhlcHJuZy5qcyIsIm9zd2ViLmpzIiwiY29uc3RhbnRzLmpzIiwiY2FudmFzLmpzIiwiY2xvY2suanMiLCJrZXlib2FyZC5qcyIsImxvZy5qcyIsIm1vdXNlLmpzIiwic2FtcGxlci5qcyIsInZpZGVvLmpzIiwiZGVidWcuanMiLCJmaWxlX3Bvb2xfc3RvcmUuanMiLCJmdW5jdGlvbnMuanMiLCJoZWFydGJlYXQuanMiLCJpdGVtX3N0YWNrLmpzIiwiaXRlbV9zdG9yZS5qcyIsInBybmcuanMiLCJweXRob25fd29ya3NwYWNlLmpzIiwic3ludGF4LmpzIiwidmFyX3N0b3JlLmpzIiwiaXRlbS5qcyIsImdlbmVyaWNfcmVzcG9uc2UuanMiLCJleHBlcmltZW50LmpzIiwiaW5saW5lX3NjcmlwdC5qcyIsImtleWJvYXJkX3Jlc3BvbnNlLmpzIiwibG9nZ2VyLmpzIiwibG9vcC5qcyIsIm1vdXNlX3Jlc3BvbnNlLmpzIiwic2VxdWVuY2UuanMiLCJza2V0Y2hwYWQuanMiLCJmZWVkYmFjay5qcyIsInN5bnRoLmpzIiwiYWR2YW5jZWRfZGVsYXkuanMiLCJmb3JtX2Jhc2UuanMiLCJmb3JtX2NvbnNlbnQuanMiLCJmb3JtX211bHRpcGxlX2Nob2ljZS5qcyIsImZvcm1fdGV4dF9kaXNwbGF5LmpzIiwiZm9ybV90ZXh0X2lucHV0LmpzIiwiZm9ybV90ZXh0X3JlbmRlci5qcyIsIm1lZGlhX3BsYXllcl92bGMuanMiLCJub3RlcGFkLmpzIiwicmVwZWF0X2N5Y2xlLmpzIiwicmVzZXRfZmVlZGJhY2suanMiLCJ0b3VjaF9yZXNwb25zZS5qcyIsImJhc2VfZWxlbWVudC5qcyIsImFycm93LmpzIiwiY2lyY2xlLmpzIiwiZWxsaXBzZS5qcyIsImZpeGRvdC5qcyIsImdhYm9yLmpzIiwiaW1hZ2UuanMiLCJsaW5lLmpzIiwibm9pc2UuanMiLCJyZWN0LmpzIiwidGV4dGxpbmUuanMiLCJmb3JtLmpzIiwid2lkZ2V0LmpzIiwiYnV0dG9uLmpzIiwiY2hlY2tib3guanMiLCJsYWJlbC5qcyIsImV2ZW50cy5qcyIsInBhcmFtZXRlcnMuanMiLCJwYXJzZXIuanMiLCJzZXNzaW9uLmpzIiwicnVubmVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzc0R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Z0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdG9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdDFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9QQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM1VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNVZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9HQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBbkJqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBb0I1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoib3N3ZWIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiogQGxpY2Vuc2UgQ3JlYXRlSlNcbiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLlxuKlxuKiBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxNSBnc2tpbm5lci5jb20sIGluYy5cbipcbiogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZS5cbiogaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5odG1sXG4qXG4qIFRoaXMgbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuKi9cbnRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sY3JlYXRlanMuZXh0ZW5kPWZ1bmN0aW9uKGEsYil7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYygpe3RoaXMuY29uc3RydWN0b3I9YX1yZXR1cm4gYy5wcm90b3R5cGU9Yi5wcm90b3R5cGUsYS5wcm90b3R5cGU9bmV3IGN9LHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sY3JlYXRlanMucHJvbW90ZT1mdW5jdGlvbihhLGIpe1widXNlIHN0cmljdFwiO3ZhciBjPWEucHJvdG90eXBlLGQ9T2JqZWN0LmdldFByb3RvdHlwZU9mJiZPYmplY3QuZ2V0UHJvdG90eXBlT2YoYyl8fGMuX19wcm90b19fO2lmKGQpe2NbKGIrPVwiX1wiKStcImNvbnN0cnVjdG9yXCJdPWQuY29uc3RydWN0b3I7Zm9yKHZhciBlIGluIGQpYy5oYXNPd25Qcm9wZXJ0eShlKSYmXCJmdW5jdGlvblwiPT10eXBlb2YgZFtlXSYmKGNbYitlXT1kW2VdKX1yZXR1cm4gYX0sdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxjcmVhdGVqcy5pbmRleE9mPWZ1bmN0aW9uKGEsYil7XCJ1c2Ugc3RyaWN0XCI7Zm9yKHZhciBjPTAsZD1hLmxlbmd0aDtkPmM7YysrKWlmKGI9PT1hW2NdKXJldHVybiBjO3JldHVybi0xfSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyl7dGhpcy50eXBlPWEsdGhpcy50YXJnZXQ9bnVsbCx0aGlzLmN1cnJlbnRUYXJnZXQ9bnVsbCx0aGlzLmV2ZW50UGhhc2U9MCx0aGlzLmJ1YmJsZXM9ISFiLHRoaXMuY2FuY2VsYWJsZT0hIWMsdGhpcy50aW1lU3RhbXA9KG5ldyBEYXRlKS5nZXRUaW1lKCksdGhpcy5kZWZhdWx0UHJldmVudGVkPSExLHRoaXMucHJvcGFnYXRpb25TdG9wcGVkPSExLHRoaXMuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkPSExLHRoaXMucmVtb3ZlZD0hMX12YXIgYj1hLnByb3RvdHlwZTtiLnByZXZlbnREZWZhdWx0PWZ1bmN0aW9uKCl7dGhpcy5kZWZhdWx0UHJldmVudGVkPXRoaXMuY2FuY2VsYWJsZSYmITB9LGIuc3RvcFByb3BhZ2F0aW9uPWZ1bmN0aW9uKCl7dGhpcy5wcm9wYWdhdGlvblN0b3BwZWQ9ITB9LGIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uPWZ1bmN0aW9uKCl7dGhpcy5pbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9dGhpcy5wcm9wYWdhdGlvblN0b3BwZWQ9ITB9LGIucmVtb3ZlPWZ1bmN0aW9uKCl7dGhpcy5yZW1vdmVkPSEwfSxiLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBhKHRoaXMudHlwZSx0aGlzLmJ1YmJsZXMsdGhpcy5jYW5jZWxhYmxlKX0sYi5zZXQ9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpdGhpc1tiXT1hW2JdO3JldHVybiB0aGlzfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbRXZlbnQgKHR5cGU9XCIrdGhpcy50eXBlK1wiKV1cIn0sY3JlYXRlanMuRXZlbnQ9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3RoaXMuX2xpc3RlbmVycz1udWxsLHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnM9bnVsbH12YXIgYj1hLnByb3RvdHlwZTthLmluaXRpYWxpemU9ZnVuY3Rpb24oYSl7YS5hZGRFdmVudExpc3RlbmVyPWIuYWRkRXZlbnRMaXN0ZW5lcixhLm9uPWIub24sYS5yZW1vdmVFdmVudExpc3RlbmVyPWEub2ZmPWIucmVtb3ZlRXZlbnRMaXN0ZW5lcixhLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzPWIucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnMsYS5oYXNFdmVudExpc3RlbmVyPWIuaGFzRXZlbnRMaXN0ZW5lcixhLmRpc3BhdGNoRXZlbnQ9Yi5kaXNwYXRjaEV2ZW50LGEuX2Rpc3BhdGNoRXZlbnQ9Yi5fZGlzcGF0Y2hFdmVudCxhLndpbGxUcmlnZ2VyPWIud2lsbFRyaWdnZXJ9LGIuYWRkRXZlbnRMaXN0ZW5lcj1mdW5jdGlvbihhLGIsYyl7dmFyIGQ7ZD1jP3RoaXMuX2NhcHR1cmVMaXN0ZW5lcnM9dGhpcy5fY2FwdHVyZUxpc3RlbmVyc3x8e306dGhpcy5fbGlzdGVuZXJzPXRoaXMuX2xpc3RlbmVyc3x8e307dmFyIGU9ZFthXTtyZXR1cm4gZSYmdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKGEsYixjKSxlPWRbYV0sZT9lLnB1c2goYik6ZFthXT1bYl0sYn0sYi5vbj1mdW5jdGlvbihhLGIsYyxkLGUsZil7cmV0dXJuIGIuaGFuZGxlRXZlbnQmJihjPWN8fGIsYj1iLmhhbmRsZUV2ZW50KSxjPWN8fHRoaXMsdGhpcy5hZGRFdmVudExpc3RlbmVyKGEsZnVuY3Rpb24oYSl7Yi5jYWxsKGMsYSxlKSxkJiZhLnJlbW92ZSgpfSxmKX0sYi5yZW1vdmVFdmVudExpc3RlbmVyPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1jP3RoaXMuX2NhcHR1cmVMaXN0ZW5lcnM6dGhpcy5fbGlzdGVuZXJzO2lmKGQpe3ZhciBlPWRbYV07aWYoZSlmb3IodmFyIGY9MCxnPWUubGVuZ3RoO2c+ZjtmKyspaWYoZVtmXT09Yil7MT09Zz9kZWxldGUgZFthXTplLnNwbGljZShmLDEpO2JyZWFrfX19LGIub2ZmPWIucmVtb3ZlRXZlbnRMaXN0ZW5lcixiLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzPWZ1bmN0aW9uKGEpe2E/KHRoaXMuX2xpc3RlbmVycyYmZGVsZXRlIHRoaXMuX2xpc3RlbmVyc1thXSx0aGlzLl9jYXB0dXJlTGlzdGVuZXJzJiZkZWxldGUgdGhpcy5fY2FwdHVyZUxpc3RlbmVyc1thXSk6dGhpcy5fbGlzdGVuZXJzPXRoaXMuX2NhcHR1cmVMaXN0ZW5lcnM9bnVsbH0sYi5kaXNwYXRjaEV2ZW50PWZ1bmN0aW9uKGEsYixjKXtpZihcInN0cmluZ1wiPT10eXBlb2YgYSl7dmFyIGQ9dGhpcy5fbGlzdGVuZXJzO2lmKCEoYnx8ZCYmZFthXSkpcmV0dXJuITA7YT1uZXcgY3JlYXRlanMuRXZlbnQoYSxiLGMpfWVsc2UgYS50YXJnZXQmJmEuY2xvbmUmJihhPWEuY2xvbmUoKSk7dHJ5e2EudGFyZ2V0PXRoaXN9Y2F0Y2goZSl7fWlmKGEuYnViYmxlcyYmdGhpcy5wYXJlbnQpe2Zvcih2YXIgZj10aGlzLGc9W2ZdO2YucGFyZW50OylnLnB1c2goZj1mLnBhcmVudCk7dmFyIGgsaT1nLmxlbmd0aDtmb3IoaD1pLTE7aD49MCYmIWEucHJvcGFnYXRpb25TdG9wcGVkO2gtLSlnW2hdLl9kaXNwYXRjaEV2ZW50KGEsMSsoMD09aCkpO2ZvcihoPTE7aT5oJiYhYS5wcm9wYWdhdGlvblN0b3BwZWQ7aCsrKWdbaF0uX2Rpc3BhdGNoRXZlbnQoYSwzKX1lbHNlIHRoaXMuX2Rpc3BhdGNoRXZlbnQoYSwyKTtyZXR1cm4hYS5kZWZhdWx0UHJldmVudGVkfSxiLmhhc0V2ZW50TGlzdGVuZXI9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fbGlzdGVuZXJzLGM9dGhpcy5fY2FwdHVyZUxpc3RlbmVycztyZXR1cm4hIShiJiZiW2FdfHxjJiZjW2FdKX0sYi53aWxsVHJpZ2dlcj1mdW5jdGlvbihhKXtmb3IodmFyIGI9dGhpcztiOyl7aWYoYi5oYXNFdmVudExpc3RlbmVyKGEpKXJldHVybiEwO2I9Yi5wYXJlbnR9cmV0dXJuITF9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltFdmVudERpc3BhdGNoZXJdXCJ9LGIuX2Rpc3BhdGNoRXZlbnQ9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPTE9PWI/dGhpcy5fY2FwdHVyZUxpc3RlbmVyczp0aGlzLl9saXN0ZW5lcnM7aWYoYSYmZCl7dmFyIGU9ZFthLnR5cGVdO2lmKCFlfHwhKGM9ZS5sZW5ndGgpKXJldHVybjt0cnl7YS5jdXJyZW50VGFyZ2V0PXRoaXN9Y2F0Y2goZil7fXRyeXthLmV2ZW50UGhhc2U9Yn1jYXRjaChmKXt9YS5yZW1vdmVkPSExLGU9ZS5zbGljZSgpO2Zvcih2YXIgZz0wO2M+ZyYmIWEuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkO2crKyl7dmFyIGg9ZVtnXTtoLmhhbmRsZUV2ZW50P2guaGFuZGxlRXZlbnQoYSk6aChhKSxhLnJlbW92ZWQmJih0aGlzLm9mZihhLnR5cGUsaCwxPT1iKSxhLnJlbW92ZWQ9ITEpfX19LGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlcj1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhyb3dcIlRpY2tlciBjYW5ub3QgYmUgaW5zdGFudGlhdGVkLlwifWEuUkFGX1NZTkNIRUQ9XCJzeW5jaGVkXCIsYS5SQUY9XCJyYWZcIixhLlRJTUVPVVQ9XCJ0aW1lb3V0XCIsYS51c2VSQUY9ITEsYS50aW1pbmdNb2RlPW51bGwsYS5tYXhEZWx0YT0wLGEucGF1c2VkPSExLGEucmVtb3ZlRXZlbnRMaXN0ZW5lcj1udWxsLGEucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnM9bnVsbCxhLmRpc3BhdGNoRXZlbnQ9bnVsbCxhLmhhc0V2ZW50TGlzdGVuZXI9bnVsbCxhLl9saXN0ZW5lcnM9bnVsbCxjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIuaW5pdGlhbGl6ZShhKSxhLl9hZGRFdmVudExpc3RlbmVyPWEuYWRkRXZlbnRMaXN0ZW5lcixhLmFkZEV2ZW50TGlzdGVuZXI9ZnVuY3Rpb24oKXtyZXR1cm4hYS5faW5pdGVkJiZhLmluaXQoKSxhLl9hZGRFdmVudExpc3RlbmVyLmFwcGx5KGEsYXJndW1lbnRzKX0sYS5faW5pdGVkPSExLGEuX3N0YXJ0VGltZT0wLGEuX3BhdXNlZFRpbWU9MCxhLl90aWNrcz0wLGEuX3BhdXNlZFRpY2tzPTAsYS5faW50ZXJ2YWw9NTAsYS5fbGFzdFRpbWU9MCxhLl90aW1lcz1udWxsLGEuX3RpY2tUaW1lcz1udWxsLGEuX3RpbWVySWQ9bnVsbCxhLl9yYWY9ITAsYS5zZXRJbnRlcnZhbD1mdW5jdGlvbihiKXthLl9pbnRlcnZhbD1iLGEuX2luaXRlZCYmYS5fc2V0dXBUaWNrKCl9LGEuZ2V0SW50ZXJ2YWw9ZnVuY3Rpb24oKXtyZXR1cm4gYS5faW50ZXJ2YWx9LGEuc2V0RlBTPWZ1bmN0aW9uKGIpe2Euc2V0SW50ZXJ2YWwoMWUzL2IpfSxhLmdldEZQUz1mdW5jdGlvbigpe3JldHVybiAxZTMvYS5faW50ZXJ2YWx9O3RyeXtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhhLHtpbnRlcnZhbDp7Z2V0OmEuZ2V0SW50ZXJ2YWwsc2V0OmEuc2V0SW50ZXJ2YWx9LGZyYW1lcmF0ZTp7Z2V0OmEuZ2V0RlBTLHNldDphLnNldEZQU319KX1jYXRjaChiKXtjb25zb2xlLmxvZyhiKX1hLmluaXQ9ZnVuY3Rpb24oKXthLl9pbml0ZWR8fChhLl9pbml0ZWQ9ITAsYS5fdGltZXM9W10sYS5fdGlja1RpbWVzPVtdLGEuX3N0YXJ0VGltZT1hLl9nZXRUaW1lKCksYS5fdGltZXMucHVzaChhLl9sYXN0VGltZT0wKSxhLmludGVydmFsPWEuX2ludGVydmFsKX0sYS5yZXNldD1mdW5jdGlvbigpe2lmKGEuX3JhZil7dmFyIGI9d2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lfHx3aW5kb3cud2Via2l0Q2FuY2VsQW5pbWF0aW9uRnJhbWV8fHdpbmRvdy5tb3pDYW5jZWxBbmltYXRpb25GcmFtZXx8d2luZG93Lm9DYW5jZWxBbmltYXRpb25GcmFtZXx8d2luZG93Lm1zQ2FuY2VsQW5pbWF0aW9uRnJhbWU7YiYmYihhLl90aW1lcklkKX1lbHNlIGNsZWFyVGltZW91dChhLl90aW1lcklkKTthLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzKFwidGlja1wiKSxhLl90aW1lcklkPWEuX3RpbWVzPWEuX3RpY2tUaW1lcz1udWxsLGEuX3N0YXJ0VGltZT1hLl9sYXN0VGltZT1hLl90aWNrcz0wLGEuX2luaXRlZD0hMX0sYS5nZXRNZWFzdXJlZFRpY2tUaW1lPWZ1bmN0aW9uKGIpe3ZhciBjPTAsZD1hLl90aWNrVGltZXM7aWYoIWR8fGQubGVuZ3RoPDEpcmV0dXJuLTE7Yj1NYXRoLm1pbihkLmxlbmd0aCxifHwwfGEuZ2V0RlBTKCkpO2Zvcih2YXIgZT0wO2I+ZTtlKyspYys9ZFtlXTtyZXR1cm4gYy9ifSxhLmdldE1lYXN1cmVkRlBTPWZ1bmN0aW9uKGIpe3ZhciBjPWEuX3RpbWVzO3JldHVybiFjfHxjLmxlbmd0aDwyPy0xOihiPU1hdGgubWluKGMubGVuZ3RoLTEsYnx8MHxhLmdldEZQUygpKSwxZTMvKChjWzBdLWNbYl0pL2IpKX0sYS5zZXRQYXVzZWQ9ZnVuY3Rpb24oYil7YS5wYXVzZWQ9Yn0sYS5nZXRQYXVzZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gYS5wYXVzZWR9LGEuZ2V0VGltZT1mdW5jdGlvbihiKXtyZXR1cm4gYS5fc3RhcnRUaW1lP2EuX2dldFRpbWUoKS0oYj9hLl9wYXVzZWRUaW1lOjApOi0xfSxhLmdldEV2ZW50VGltZT1mdW5jdGlvbihiKXtyZXR1cm4gYS5fc3RhcnRUaW1lPyhhLl9sYXN0VGltZXx8YS5fc3RhcnRUaW1lKS0oYj9hLl9wYXVzZWRUaW1lOjApOi0xfSxhLmdldFRpY2tzPWZ1bmN0aW9uKGIpe3JldHVybiBhLl90aWNrcy0oYj9hLl9wYXVzZWRUaWNrczowKX0sYS5faGFuZGxlU3luY2g9ZnVuY3Rpb24oKXthLl90aW1lcklkPW51bGwsYS5fc2V0dXBUaWNrKCksYS5fZ2V0VGltZSgpLWEuX2xhc3RUaW1lPj0uOTcqKGEuX2ludGVydmFsLTEpJiZhLl90aWNrKCl9LGEuX2hhbmRsZVJBRj1mdW5jdGlvbigpe2EuX3RpbWVySWQ9bnVsbCxhLl9zZXR1cFRpY2soKSxhLl90aWNrKCl9LGEuX2hhbmRsZVRpbWVvdXQ9ZnVuY3Rpb24oKXthLl90aW1lcklkPW51bGwsYS5fc2V0dXBUaWNrKCksYS5fdGljaygpfSxhLl9zZXR1cFRpY2s9ZnVuY3Rpb24oKXtpZihudWxsPT1hLl90aW1lcklkKXt2YXIgYj1hLnRpbWluZ01vZGV8fGEudXNlUkFGJiZhLlJBRl9TWU5DSEVEO2lmKGI9PWEuUkFGX1NZTkNIRUR8fGI9PWEuUkFGKXt2YXIgYz13aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lfHx3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHx3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHx3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZXx8d2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lO2lmKGMpcmV0dXJuIGEuX3RpbWVySWQ9YyhiPT1hLlJBRj9hLl9oYW5kbGVSQUY6YS5faGFuZGxlU3luY2gpLHZvaWQoYS5fcmFmPSEwKX1hLl9yYWY9ITEsYS5fdGltZXJJZD1zZXRUaW1lb3V0KGEuX2hhbmRsZVRpbWVvdXQsYS5faW50ZXJ2YWwpfX0sYS5fdGljaz1mdW5jdGlvbigpe3ZhciBiPWEucGF1c2VkLGM9YS5fZ2V0VGltZSgpLGQ9Yy1hLl9sYXN0VGltZTtpZihhLl9sYXN0VGltZT1jLGEuX3RpY2tzKyssYiYmKGEuX3BhdXNlZFRpY2tzKyssYS5fcGF1c2VkVGltZSs9ZCksYS5oYXNFdmVudExpc3RlbmVyKFwidGlja1wiKSl7dmFyIGU9bmV3IGNyZWF0ZWpzLkV2ZW50KFwidGlja1wiKSxmPWEubWF4RGVsdGE7ZS5kZWx0YT1mJiZkPmY/ZjpkLGUucGF1c2VkPWIsZS50aW1lPWMsZS5ydW5UaW1lPWMtYS5fcGF1c2VkVGltZSxhLmRpc3BhdGNoRXZlbnQoZSl9Zm9yKGEuX3RpY2tUaW1lcy51bnNoaWZ0KGEuX2dldFRpbWUoKS1jKTthLl90aWNrVGltZXMubGVuZ3RoPjEwMDspYS5fdGlja1RpbWVzLnBvcCgpO2ZvcihhLl90aW1lcy51bnNoaWZ0KGMpO2EuX3RpbWVzLmxlbmd0aD4xMDA7KWEuX3RpbWVzLnBvcCgpfTt2YXIgYz13aW5kb3cucGVyZm9ybWFuY2UmJihwZXJmb3JtYW5jZS5ub3d8fHBlcmZvcm1hbmNlLm1vek5vd3x8cGVyZm9ybWFuY2UubXNOb3d8fHBlcmZvcm1hbmNlLm9Ob3d8fHBlcmZvcm1hbmNlLndlYmtpdE5vdyk7YS5fZ2V0VGltZT1mdW5jdGlvbigpe3JldHVybihjJiZjLmNhbGwocGVyZm9ybWFuY2UpfHwobmV3IERhdGUpLmdldFRpbWUoKSktYS5fc3RhcnRUaW1lfSxjcmVhdGVqcy5UaWNrZXI9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3Rocm93XCJVSUQgY2Fubm90IGJlIGluc3RhbnRpYXRlZFwifWEuX25leHRJRD0wLGEuZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuX25leHRJRCsrfSxjcmVhdGVqcy5VSUQ9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyxkLGUsZixnLGgsaSxqLGspe3RoaXMuRXZlbnRfY29uc3RydWN0b3IoYSxiLGMpLHRoaXMuc3RhZ2VYPWQsdGhpcy5zdGFnZVk9ZSx0aGlzLnJhd1g9bnVsbD09aT9kOmksdGhpcy5yYXdZPW51bGw9PWo/ZTpqLHRoaXMubmF0aXZlRXZlbnQ9Zix0aGlzLnBvaW50ZXJJRD1nLHRoaXMucHJpbWFyeT0hIWgsdGhpcy5yZWxhdGVkVGFyZ2V0PWt9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRXZlbnQpO2IuX2dldF9sb2NhbFg9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jdXJyZW50VGFyZ2V0Lmdsb2JhbFRvTG9jYWwodGhpcy5yYXdYLHRoaXMucmF3WSkueH0sYi5fZ2V0X2xvY2FsWT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmN1cnJlbnRUYXJnZXQuZ2xvYmFsVG9Mb2NhbCh0aGlzLnJhd1gsdGhpcy5yYXdZKS55fSxiLl9nZXRfaXNUb3VjaD1mdW5jdGlvbigpe3JldHVybi0xIT09dGhpcy5wb2ludGVySUR9O3RyeXtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhiLHtsb2NhbFg6e2dldDpiLl9nZXRfbG9jYWxYfSxsb2NhbFk6e2dldDpiLl9nZXRfbG9jYWxZfSxpc1RvdWNoOntnZXQ6Yi5fZ2V0X2lzVG91Y2h9fSl9Y2F0Y2goYyl7fWIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy50eXBlLHRoaXMuYnViYmxlcyx0aGlzLmNhbmNlbGFibGUsdGhpcy5zdGFnZVgsdGhpcy5zdGFnZVksdGhpcy5uYXRpdmVFdmVudCx0aGlzLnBvaW50ZXJJRCx0aGlzLnByaW1hcnksdGhpcy5yYXdYLHRoaXMucmF3WSl9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltNb3VzZUV2ZW50ICh0eXBlPVwiK3RoaXMudHlwZStcIiBzdGFnZVg9XCIrdGhpcy5zdGFnZVgrXCIgc3RhZ2VZPVwiK3RoaXMuc3RhZ2VZK1wiKV1cIn0sY3JlYXRlanMuTW91c2VFdmVudD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJFdmVudFwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyxkLGUsZil7dGhpcy5zZXRWYWx1ZXMoYSxiLGMsZCxlLGYpfXZhciBiPWEucHJvdG90eXBlO2EuREVHX1RPX1JBRD1NYXRoLlBJLzE4MCxhLmlkZW50aXR5PW51bGwsYi5zZXRWYWx1ZXM9ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe3JldHVybiB0aGlzLmE9bnVsbD09YT8xOmEsdGhpcy5iPWJ8fDAsdGhpcy5jPWN8fDAsdGhpcy5kPW51bGw9PWQ/MTpkLHRoaXMudHg9ZXx8MCx0aGlzLnR5PWZ8fDAsdGhpc30sYi5hcHBlbmQ9ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe3ZhciBnPXRoaXMuYSxoPXRoaXMuYixpPXRoaXMuYyxqPXRoaXMuZDtyZXR1cm4oMSE9YXx8MCE9Ynx8MCE9Y3x8MSE9ZCkmJih0aGlzLmE9ZyphK2kqYix0aGlzLmI9aCphK2oqYix0aGlzLmM9ZypjK2kqZCx0aGlzLmQ9aCpjK2oqZCksdGhpcy50eD1nKmUraSpmK3RoaXMudHgsdGhpcy50eT1oKmUraipmK3RoaXMudHksdGhpc30sYi5wcmVwZW5kPWZ1bmN0aW9uKGEsYixjLGQsZSxmKXt2YXIgZz10aGlzLmEsaD10aGlzLmMsaT10aGlzLnR4O3JldHVybiB0aGlzLmE9YSpnK2MqdGhpcy5iLHRoaXMuYj1iKmcrZCp0aGlzLmIsdGhpcy5jPWEqaCtjKnRoaXMuZCx0aGlzLmQ9YipoK2QqdGhpcy5kLHRoaXMudHg9YSppK2MqdGhpcy50eStlLHRoaXMudHk9YippK2QqdGhpcy50eStmLHRoaXN9LGIuYXBwZW5kTWF0cml4PWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmFwcGVuZChhLmEsYS5iLGEuYyxhLmQsYS50eCxhLnR5KX0sYi5wcmVwZW5kTWF0cml4PWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnByZXBlbmQoYS5hLGEuYixhLmMsYS5kLGEudHgsYS50eSl9LGIuYXBwZW5kVHJhbnNmb3JtPWZ1bmN0aW9uKGIsYyxkLGUsZixnLGgsaSxqKXtpZihmJTM2MCl2YXIgaz1mKmEuREVHX1RPX1JBRCxsPU1hdGguY29zKGspLG09TWF0aC5zaW4oayk7ZWxzZSBsPTEsbT0wO3JldHVybiBnfHxoPyhnKj1hLkRFR19UT19SQUQsaCo9YS5ERUdfVE9fUkFELHRoaXMuYXBwZW5kKE1hdGguY29zKGgpLE1hdGguc2luKGgpLC1NYXRoLnNpbihnKSxNYXRoLmNvcyhnKSxiLGMpLHRoaXMuYXBwZW5kKGwqZCxtKmQsLW0qZSxsKmUsMCwwKSk6dGhpcy5hcHBlbmQobCpkLG0qZCwtbSplLGwqZSxiLGMpLChpfHxqKSYmKHRoaXMudHgtPWkqdGhpcy5hK2oqdGhpcy5jLHRoaXMudHktPWkqdGhpcy5iK2oqdGhpcy5kKSx0aGlzfSxiLnByZXBlbmRUcmFuc2Zvcm09ZnVuY3Rpb24oYixjLGQsZSxmLGcsaCxpLGope2lmKGYlMzYwKXZhciBrPWYqYS5ERUdfVE9fUkFELGw9TWF0aC5jb3MoayksbT1NYXRoLnNpbihrKTtlbHNlIGw9MSxtPTA7cmV0dXJuKGl8fGopJiYodGhpcy50eC09aSx0aGlzLnR5LT1qKSxnfHxoPyhnKj1hLkRFR19UT19SQUQsaCo9YS5ERUdfVE9fUkFELHRoaXMucHJlcGVuZChsKmQsbSpkLC1tKmUsbCplLDAsMCksdGhpcy5wcmVwZW5kKE1hdGguY29zKGgpLE1hdGguc2luKGgpLC1NYXRoLnNpbihnKSxNYXRoLmNvcyhnKSxiLGMpKTp0aGlzLnByZXBlbmQobCpkLG0qZCwtbSplLGwqZSxiLGMpLHRoaXN9LGIucm90YXRlPWZ1bmN0aW9uKGIpe2IqPWEuREVHX1RPX1JBRDt2YXIgYz1NYXRoLmNvcyhiKSxkPU1hdGguc2luKGIpLGU9dGhpcy5hLGY9dGhpcy5iO3JldHVybiB0aGlzLmE9ZSpjK3RoaXMuYypkLHRoaXMuYj1mKmMrdGhpcy5kKmQsdGhpcy5jPS1lKmQrdGhpcy5jKmMsdGhpcy5kPS1mKmQrdGhpcy5kKmMsdGhpc30sYi5za2V3PWZ1bmN0aW9uKGIsYyl7cmV0dXJuIGIqPWEuREVHX1RPX1JBRCxjKj1hLkRFR19UT19SQUQsdGhpcy5hcHBlbmQoTWF0aC5jb3MoYyksTWF0aC5zaW4oYyksLU1hdGguc2luKGIpLE1hdGguY29zKGIpLDAsMCksdGhpc30sYi5zY2FsZT1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmEqPWEsdGhpcy5iKj1hLHRoaXMuYyo9Yix0aGlzLmQqPWIsdGhpc30sYi50cmFuc2xhdGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy50eCs9dGhpcy5hKmErdGhpcy5jKmIsdGhpcy50eSs9dGhpcy5iKmErdGhpcy5kKmIsdGhpc30sYi5pZGVudGl0eT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmE9dGhpcy5kPTEsdGhpcy5iPXRoaXMuYz10aGlzLnR4PXRoaXMudHk9MCx0aGlzfSxiLmludmVydD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuYSxiPXRoaXMuYixjPXRoaXMuYyxkPXRoaXMuZCxlPXRoaXMudHgsZj1hKmQtYipjO3JldHVybiB0aGlzLmE9ZC9mLHRoaXMuYj0tYi9mLHRoaXMuYz0tYy9mLHRoaXMuZD1hL2YsdGhpcy50eD0oYyp0aGlzLnR5LWQqZSkvZix0aGlzLnR5PS0oYSp0aGlzLnR5LWIqZSkvZix0aGlzfSxiLmlzSWRlbnRpdHk9ZnVuY3Rpb24oKXtyZXR1cm4gMD09PXRoaXMudHgmJjA9PT10aGlzLnR5JiYxPT09dGhpcy5hJiYwPT09dGhpcy5iJiYwPT09dGhpcy5jJiYxPT09dGhpcy5kfSxiLmVxdWFscz1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy50eD09PWEudHgmJnRoaXMudHk9PT1hLnR5JiZ0aGlzLmE9PT1hLmEmJnRoaXMuYj09PWEuYiYmdGhpcy5jPT09YS5jJiZ0aGlzLmQ9PT1hLmR9LGIudHJhbnNmb3JtUG9pbnQ9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjPWN8fHt9LGMueD1hKnRoaXMuYStiKnRoaXMuYyt0aGlzLnR4LGMueT1hKnRoaXMuYitiKnRoaXMuZCt0aGlzLnR5LGN9LGIuZGVjb21wb3NlPWZ1bmN0aW9uKGIpe251bGw9PWImJihiPXt9KSxiLng9dGhpcy50eCxiLnk9dGhpcy50eSxiLnNjYWxlWD1NYXRoLnNxcnQodGhpcy5hKnRoaXMuYSt0aGlzLmIqdGhpcy5iKSxiLnNjYWxlWT1NYXRoLnNxcnQodGhpcy5jKnRoaXMuYyt0aGlzLmQqdGhpcy5kKTt2YXIgYz1NYXRoLmF0YW4yKC10aGlzLmMsdGhpcy5kKSxkPU1hdGguYXRhbjIodGhpcy5iLHRoaXMuYSksZT1NYXRoLmFicygxLWMvZCk7cmV0dXJuIDFlLTU+ZT8oYi5yb3RhdGlvbj1kL2EuREVHX1RPX1JBRCx0aGlzLmE8MCYmdGhpcy5kPj0wJiYoYi5yb3RhdGlvbis9Yi5yb3RhdGlvbjw9MD8xODA6LTE4MCksYi5za2V3WD1iLnNrZXdZPTApOihiLnNrZXdYPWMvYS5ERUdfVE9fUkFELGIuc2tld1k9ZC9hLkRFR19UT19SQUQpLGJ9LGIuY29weT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5zZXRWYWx1ZXMoYS5hLGEuYixhLmMsYS5kLGEudHgsYS50eSl9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy5hLHRoaXMuYix0aGlzLmMsdGhpcy5kLHRoaXMudHgsdGhpcy50eSl9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltNYXRyaXgyRCAoYT1cIit0aGlzLmErXCIgYj1cIit0aGlzLmIrXCIgYz1cIit0aGlzLmMrXCIgZD1cIit0aGlzLmQrXCIgdHg9XCIrdGhpcy50eCtcIiB0eT1cIit0aGlzLnR5K1wiKV1cIn0sYS5pZGVudGl0eT1uZXcgYSxjcmVhdGVqcy5NYXRyaXgyRD1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQsZSl7dGhpcy5zZXRWYWx1ZXMoYSxiLGMsZCxlKX12YXIgYj1hLnByb3RvdHlwZTtiLnNldFZhbHVlcz1mdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiB0aGlzLnZpc2libGU9bnVsbD09YT8hMDohIWEsdGhpcy5hbHBoYT1udWxsPT1iPzE6Yix0aGlzLnNoYWRvdz1jLHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uPWQsdGhpcy5tYXRyaXg9ZXx8dGhpcy5tYXRyaXgmJnRoaXMubWF0cml4LmlkZW50aXR5KCl8fG5ldyBjcmVhdGVqcy5NYXRyaXgyRCx0aGlzfSxiLmFwcGVuZD1mdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiB0aGlzLmFscGhhKj1iLHRoaXMuc2hhZG93PWN8fHRoaXMuc2hhZG93LHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uPWR8fHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uLHRoaXMudmlzaWJsZT10aGlzLnZpc2libGUmJmEsZSYmdGhpcy5tYXRyaXguYXBwZW5kTWF0cml4KGUpLHRoaXN9LGIucHJlcGVuZD1mdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiB0aGlzLmFscGhhKj1iLHRoaXMuc2hhZG93PXRoaXMuc2hhZG93fHxjLHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uPXRoaXMuY29tcG9zaXRlT3BlcmF0aW9ufHxkLHRoaXMudmlzaWJsZT10aGlzLnZpc2libGUmJmEsZSYmdGhpcy5tYXRyaXgucHJlcGVuZE1hdHJpeChlKSx0aGlzfSxiLmlkZW50aXR5PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudmlzaWJsZT0hMCx0aGlzLmFscGhhPTEsdGhpcy5zaGFkb3c9dGhpcy5jb21wb3NpdGVPcGVyYXRpb249bnVsbCx0aGlzLm1hdHJpeC5pZGVudGl0eSgpLHRoaXN9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy5hbHBoYSx0aGlzLnNoYWRvdyx0aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbix0aGlzLnZpc2libGUsdGhpcy5tYXRyaXguY2xvbmUoKSl9LGNyZWF0ZWpzLkRpc3BsYXlQcm9wcz1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYil7dGhpcy5zZXRWYWx1ZXMoYSxiKX12YXIgYj1hLnByb3RvdHlwZTtiLnNldFZhbHVlcz1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLng9YXx8MCx0aGlzLnk9Ynx8MCx0aGlzfSxiLmNvcHk9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMueD1hLngsdGhpcy55PWEueSx0aGlzfSxiLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBhKHRoaXMueCx0aGlzLnkpfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbUG9pbnQgKHg9XCIrdGhpcy54K1wiIHk9XCIrdGhpcy55K1wiKV1cIn0sY3JlYXRlanMuUG9pbnQ9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyxkKXt0aGlzLnNldFZhbHVlcyhhLGIsYyxkKX12YXIgYj1hLnByb3RvdHlwZTtiLnNldFZhbHVlcz1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy54PWF8fDAsdGhpcy55PWJ8fDAsdGhpcy53aWR0aD1jfHwwLHRoaXMuaGVpZ2h0PWR8fDAsdGhpc30sYi5leHRlbmQ9ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIGM9Y3x8MCxkPWR8fDAsYStjPnRoaXMueCt0aGlzLndpZHRoJiYodGhpcy53aWR0aD1hK2MtdGhpcy54KSxiK2Q+dGhpcy55K3RoaXMuaGVpZ2h0JiYodGhpcy5oZWlnaHQ9YitkLXRoaXMueSksYTx0aGlzLngmJih0aGlzLndpZHRoKz10aGlzLngtYSx0aGlzLng9YSksYjx0aGlzLnkmJih0aGlzLmhlaWdodCs9dGhpcy55LWIsdGhpcy55PWIpLHRoaXN9LGIucGFkPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLngtPWIsdGhpcy55LT1hLHRoaXMud2lkdGgrPWIrZCx0aGlzLmhlaWdodCs9YStjLHRoaXN9LGIuY29weT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5zZXRWYWx1ZXMoYS54LGEueSxhLndpZHRoLGEuaGVpZ2h0KX0sYi5jb250YWlucz1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gYz1jfHwwLGQ9ZHx8MCxhPj10aGlzLngmJmErYzw9dGhpcy54K3RoaXMud2lkdGgmJmI+PXRoaXMueSYmYitkPD10aGlzLnkrdGhpcy5oZWlnaHR9LGIudW5pb249ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuY2xvbmUoKS5leHRlbmQoYS54LGEueSxhLndpZHRoLGEuaGVpZ2h0KX0sYi5pbnRlcnNlY3Rpb249ZnVuY3Rpb24oYil7dmFyIGM9Yi54LGQ9Yi55LGU9YytiLndpZHRoLGY9ZCtiLmhlaWdodDtyZXR1cm4gdGhpcy54PmMmJihjPXRoaXMueCksdGhpcy55PmQmJihkPXRoaXMueSksdGhpcy54K3RoaXMud2lkdGg8ZSYmKGU9dGhpcy54K3RoaXMud2lkdGgpLHRoaXMueSt0aGlzLmhlaWdodDxmJiYoZj10aGlzLnkrdGhpcy5oZWlnaHQpLGM+PWV8fGQ+PWY/bnVsbDpuZXcgYShjLGQsZS1jLGYtZCl9LGIuaW50ZXJzZWN0cz1mdW5jdGlvbihhKXtyZXR1cm4gYS54PD10aGlzLngrdGhpcy53aWR0aCYmdGhpcy54PD1hLngrYS53aWR0aCYmYS55PD10aGlzLnkrdGhpcy5oZWlnaHQmJnRoaXMueTw9YS55K2EuaGVpZ2h0fSxiLmlzRW1wdHk9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy53aWR0aDw9MHx8dGhpcy5oZWlnaHQ8PTB9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy54LHRoaXMueSx0aGlzLndpZHRoLHRoaXMuaGVpZ2h0KX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1JlY3RhbmdsZSAoeD1cIit0aGlzLngrXCIgeT1cIit0aGlzLnkrXCIgd2lkdGg9XCIrdGhpcy53aWR0aCtcIiBoZWlnaHQ9XCIrdGhpcy5oZWlnaHQrXCIpXVwifSxjcmVhdGVqcy5SZWN0YW5nbGU9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyxkLGUsZixnKXthLmFkZEV2ZW50TGlzdGVuZXImJih0aGlzLnRhcmdldD1hLHRoaXMub3ZlckxhYmVsPW51bGw9PWM/XCJvdmVyXCI6Yyx0aGlzLm91dExhYmVsPW51bGw9PWI/XCJvdXRcIjpiLHRoaXMuZG93bkxhYmVsPW51bGw9PWQ/XCJkb3duXCI6ZCx0aGlzLnBsYXk9ZSx0aGlzLl9pc1ByZXNzZWQ9ITEsdGhpcy5faXNPdmVyPSExLHRoaXMuX2VuYWJsZWQ9ITEsYS5tb3VzZUNoaWxkcmVuPSExLHRoaXMuZW5hYmxlZD0hMCx0aGlzLmhhbmRsZUV2ZW50KHt9KSxmJiYoZyYmKGYuYWN0aW9uc0VuYWJsZWQ9ITEsZi5nb3RvQW5kU3RvcCYmZi5nb3RvQW5kU3RvcChnKSksYS5oaXRBcmVhPWYpKX12YXIgYj1hLnByb3RvdHlwZTtiLnNldEVuYWJsZWQ9ZnVuY3Rpb24oYSl7aWYoYSE9dGhpcy5fZW5hYmxlZCl7dmFyIGI9dGhpcy50YXJnZXQ7dGhpcy5fZW5hYmxlZD1hLGE/KGIuY3Vyc29yPVwicG9pbnRlclwiLGIuYWRkRXZlbnRMaXN0ZW5lcihcInJvbGxvdmVyXCIsdGhpcyksYi5hZGRFdmVudExpc3RlbmVyKFwicm9sbG91dFwiLHRoaXMpLGIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLHRoaXMpLGIuYWRkRXZlbnRMaXN0ZW5lcihcInByZXNzdXBcIix0aGlzKSxiLl9yZXNldCYmKGIuX19yZXNldD1iLl9yZXNldCxiLl9yZXNldD10aGlzLl9yZXNldCkpOihiLmN1cnNvcj1udWxsLGIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJvbGxvdmVyXCIsdGhpcyksYi5yZW1vdmVFdmVudExpc3RlbmVyKFwicm9sbG91dFwiLHRoaXMpLGIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLHRoaXMpLGIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInByZXNzdXBcIix0aGlzKSxiLl9fcmVzZXQmJihiLl9yZXNldD1iLl9fcmVzZXQsZGVsZXRlIGIuX19yZXNldCkpfX0sYi5nZXRFbmFibGVkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2VuYWJsZWR9O3RyeXtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhiLHtlbmFibGVkOntnZXQ6Yi5nZXRFbmFibGVkLHNldDpiLnNldEVuYWJsZWR9fSl9Y2F0Y2goYyl7fWIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltCdXR0b25IZWxwZXJdXCJ9LGIuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oYSl7dmFyIGIsYz10aGlzLnRhcmdldCxkPWEudHlwZTtcIm1vdXNlZG93blwiPT1kPyh0aGlzLl9pc1ByZXNzZWQ9ITAsYj10aGlzLmRvd25MYWJlbCk6XCJwcmVzc3VwXCI9PWQ/KHRoaXMuX2lzUHJlc3NlZD0hMSxiPXRoaXMuX2lzT3Zlcj90aGlzLm92ZXJMYWJlbDp0aGlzLm91dExhYmVsKTpcInJvbGxvdmVyXCI9PWQ/KHRoaXMuX2lzT3Zlcj0hMCxiPXRoaXMuX2lzUHJlc3NlZD90aGlzLmRvd25MYWJlbDp0aGlzLm92ZXJMYWJlbCk6KHRoaXMuX2lzT3Zlcj0hMSxiPXRoaXMuX2lzUHJlc3NlZD90aGlzLm92ZXJMYWJlbDp0aGlzLm91dExhYmVsKSx0aGlzLnBsYXk/Yy5nb3RvQW5kUGxheSYmYy5nb3RvQW5kUGxheShiKTpjLmdvdG9BbmRTdG9wJiZjLmdvdG9BbmRTdG9wKGIpfSxiLl9yZXNldD1mdW5jdGlvbigpe3ZhciBhPXRoaXMucGF1c2VkO3RoaXMuX19yZXNldCgpLHRoaXMucGF1c2VkPWF9LGNyZWF0ZWpzLkJ1dHRvbkhlbHBlcj1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQpe3RoaXMuY29sb3I9YXx8XCJibGFja1wiLHRoaXMub2Zmc2V0WD1ifHwwLHRoaXMub2Zmc2V0WT1jfHwwLHRoaXMuYmx1cj1kfHwwfXZhciBiPWEucHJvdG90eXBlO2EuaWRlbnRpdHk9bmV3IGEoXCJ0cmFuc3BhcmVudFwiLDAsMCwwKSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbU2hhZG93XVwifSxiLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBhKHRoaXMuY29sb3IsdGhpcy5vZmZzZXRYLHRoaXMub2Zmc2V0WSx0aGlzLmJsdXIpfSxjcmVhdGVqcy5TaGFkb3c9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLkV2ZW50RGlzcGF0Y2hlcl9jb25zdHJ1Y3RvcigpLHRoaXMuY29tcGxldGU9ITAsdGhpcy5mcmFtZXJhdGU9MCx0aGlzLl9hbmltYXRpb25zPW51bGwsdGhpcy5fZnJhbWVzPW51bGwsdGhpcy5faW1hZ2VzPW51bGwsdGhpcy5fZGF0YT1udWxsLHRoaXMuX2xvYWRDb3VudD0wLHRoaXMuX2ZyYW1lSGVpZ2h0PTAsdGhpcy5fZnJhbWVXaWR0aD0wLHRoaXMuX251bUZyYW1lcz0wLHRoaXMuX3JlZ1g9MCx0aGlzLl9yZWdZPTAsdGhpcy5fc3BhY2luZz0wLHRoaXMuX21hcmdpbj0wLHRoaXMuX3BhcnNlRGF0YShhKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIpO2IuZ2V0QW5pbWF0aW9ucz1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9hbmltYXRpb25zLnNsaWNlKCl9O3RyeXtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhiLHthbmltYXRpb25zOntnZXQ6Yi5nZXRBbmltYXRpb25zfX0pfWNhdGNoKGMpe31iLmdldE51bUZyYW1lcz1mdW5jdGlvbihhKXtpZihudWxsPT1hKXJldHVybiB0aGlzLl9mcmFtZXM/dGhpcy5fZnJhbWVzLmxlbmd0aDp0aGlzLl9udW1GcmFtZXN8fDA7dmFyIGI9dGhpcy5fZGF0YVthXTtyZXR1cm4gbnVsbD09Yj8wOmIuZnJhbWVzLmxlbmd0aH0sYi5nZXRBbmltYXRpb249ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX2RhdGFbYV19LGIuZ2V0RnJhbWU9ZnVuY3Rpb24oYSl7dmFyIGI7cmV0dXJuIHRoaXMuX2ZyYW1lcyYmKGI9dGhpcy5fZnJhbWVzW2FdKT9iOm51bGx9LGIuZ2V0RnJhbWVCb3VuZHM9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmdldEZyYW1lKGEpO3JldHVybiBjPyhifHxuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKS5zZXRWYWx1ZXMoLWMucmVnWCwtYy5yZWdZLGMucmVjdC53aWR0aCxjLnJlY3QuaGVpZ2h0KTpudWxsfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbU3ByaXRlU2hlZXRdXCJ9LGIuY2xvbmU9ZnVuY3Rpb24oKXt0aHJvd1wiU3ByaXRlU2hlZXQgY2Fubm90IGJlIGNsb25lZC5cIn0sYi5fcGFyc2VEYXRhPWZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlO2lmKG51bGwhPWEpe2lmKHRoaXMuZnJhbWVyYXRlPWEuZnJhbWVyYXRlfHwwLGEuaW1hZ2VzJiYoYz1hLmltYWdlcy5sZW5ndGgpPjApZm9yKGU9dGhpcy5faW1hZ2VzPVtdLGI9MDtjPmI7YisrKXt2YXIgZj1hLmltYWdlc1tiXTtpZihcInN0cmluZ1wiPT10eXBlb2YgZil7dmFyIGc9ZjtmPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIiksZi5zcmM9Z31lLnB1c2goZiksZi5nZXRDb250ZXh0fHxmLm5hdHVyYWxXaWR0aHx8KHRoaXMuX2xvYWRDb3VudCsrLHRoaXMuY29tcGxldGU9ITEsZnVuY3Rpb24oYSxiKXtmLm9ubG9hZD1mdW5jdGlvbigpe2EuX2hhbmRsZUltYWdlTG9hZChiKX19KHRoaXMsZyksZnVuY3Rpb24oYSxiKXtmLm9uZXJyb3I9ZnVuY3Rpb24oKXthLl9oYW5kbGVJbWFnZUVycm9yKGIpfX0odGhpcyxnKSl9aWYobnVsbD09YS5mcmFtZXMpO2Vsc2UgaWYoQXJyYXkuaXNBcnJheShhLmZyYW1lcykpZm9yKHRoaXMuX2ZyYW1lcz1bXSxlPWEuZnJhbWVzLGI9MCxjPWUubGVuZ3RoO2M+YjtiKyspe3ZhciBoPWVbYl07dGhpcy5fZnJhbWVzLnB1c2goe2ltYWdlOnRoaXMuX2ltYWdlc1toWzRdP2hbNF06MF0scmVjdDpuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKGhbMF0saFsxXSxoWzJdLGhbM10pLHJlZ1g6aFs1XXx8MCxyZWdZOmhbNl18fDB9KX1lbHNlIGQ9YS5mcmFtZXMsdGhpcy5fZnJhbWVXaWR0aD1kLndpZHRoLHRoaXMuX2ZyYW1lSGVpZ2h0PWQuaGVpZ2h0LHRoaXMuX3JlZ1g9ZC5yZWdYfHwwLHRoaXMuX3JlZ1k9ZC5yZWdZfHwwLHRoaXMuX3NwYWNpbmc9ZC5zcGFjaW5nfHwwLHRoaXMuX21hcmdpbj1kLm1hcmdpbnx8MCx0aGlzLl9udW1GcmFtZXM9ZC5jb3VudCwwPT10aGlzLl9sb2FkQ291bnQmJnRoaXMuX2NhbGN1bGF0ZUZyYW1lcygpO2lmKHRoaXMuX2FuaW1hdGlvbnM9W10sbnVsbCE9KGQ9YS5hbmltYXRpb25zKSl7dGhpcy5fZGF0YT17fTt2YXIgaTtmb3IoaSBpbiBkKXt2YXIgaj17bmFtZTppfSxrPWRbaV07aWYoXCJudW1iZXJcIj09dHlwZW9mIGspZT1qLmZyYW1lcz1ba107ZWxzZSBpZihBcnJheS5pc0FycmF5KGspKWlmKDE9PWsubGVuZ3RoKWouZnJhbWVzPVtrWzBdXTtlbHNlIGZvcihqLnNwZWVkPWtbM10sai5uZXh0PWtbMl0sZT1qLmZyYW1lcz1bXSxiPWtbMF07Yjw9a1sxXTtiKyspZS5wdXNoKGIpO2Vsc2V7ai5zcGVlZD1rLnNwZWVkLGoubmV4dD1rLm5leHQ7dmFyIGw9ay5mcmFtZXM7ZT1qLmZyYW1lcz1cIm51bWJlclwiPT10eXBlb2YgbD9bbF06bC5zbGljZSgwKX0oai5uZXh0PT09ITB8fHZvaWQgMD09PWoubmV4dCkmJihqLm5leHQ9aSksKGoubmV4dD09PSExfHxlLmxlbmd0aDwyJiZqLm5leHQ9PWkpJiYoai5uZXh0PW51bGwpLGouc3BlZWR8fChqLnNwZWVkPTEpLHRoaXMuX2FuaW1hdGlvbnMucHVzaChpKSx0aGlzLl9kYXRhW2ldPWp9fX19LGIuX2hhbmRsZUltYWdlTG9hZD1mdW5jdGlvbihhKXswPT0tLXRoaXMuX2xvYWRDb3VudCYmKHRoaXMuX2NhbGN1bGF0ZUZyYW1lcygpLHRoaXMuY29tcGxldGU9ITAsdGhpcy5kaXNwYXRjaEV2ZW50KFwiY29tcGxldGVcIikpfSxiLl9oYW5kbGVJbWFnZUVycm9yPWZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBjcmVhdGVqcy5FdmVudChcImVycm9yXCIpO2Iuc3JjPWEsdGhpcy5kaXNwYXRjaEV2ZW50KGIpLDA9PS0tdGhpcy5fbG9hZENvdW50JiZ0aGlzLmRpc3BhdGNoRXZlbnQoXCJjb21wbGV0ZVwiKX0sYi5fY2FsY3VsYXRlRnJhbWVzPWZ1bmN0aW9uKCl7aWYoIXRoaXMuX2ZyYW1lcyYmMCE9dGhpcy5fZnJhbWVXaWR0aCl7dGhpcy5fZnJhbWVzPVtdO3ZhciBhPXRoaXMuX251bUZyYW1lc3x8MWU1LGI9MCxjPXRoaXMuX2ZyYW1lV2lkdGgsZD10aGlzLl9mcmFtZUhlaWdodCxlPXRoaXMuX3NwYWNpbmcsZj10aGlzLl9tYXJnaW47YTpmb3IodmFyIGc9MCxoPXRoaXMuX2ltYWdlcztnPGgubGVuZ3RoO2crKylmb3IodmFyIGk9aFtnXSxqPWkud2lkdGgsaz1pLmhlaWdodCxsPWY7ay1mLWQ+PWw7KXtmb3IodmFyIG09ZjtqLWYtYz49bTspe2lmKGI+PWEpYnJlYWsgYTtiKyssdGhpcy5fZnJhbWVzLnB1c2goe2ltYWdlOmkscmVjdDpuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKG0sbCxjLGQpLHJlZ1g6dGhpcy5fcmVnWCxyZWdZOnRoaXMuX3JlZ1l9KSxtKz1jK2V9bCs9ZCtlfXRoaXMuX251bUZyYW1lcz1ifX0sY3JlYXRlanMuU3ByaXRlU2hlZXQ9Y3JlYXRlanMucHJvbW90ZShhLFwiRXZlbnREaXNwYXRjaGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhpcy5jb21tYW5kPW51bGwsdGhpcy5fc3Ryb2tlPW51bGwsdGhpcy5fc3Ryb2tlU3R5bGU9bnVsbCx0aGlzLl9vbGRTdHJva2VTdHlsZT1udWxsLHRoaXMuX3N0cm9rZURhc2g9bnVsbCx0aGlzLl9vbGRTdHJva2VEYXNoPW51bGwsdGhpcy5fc3Ryb2tlSWdub3JlU2NhbGU9ITEsdGhpcy5fZmlsbD1udWxsLHRoaXMuX2luc3RydWN0aW9ucz1bXSx0aGlzLl9jb21taXRJbmRleD0wLHRoaXMuX2FjdGl2ZUluc3RydWN0aW9ucz1bXSx0aGlzLl9kaXJ0eT0hMSx0aGlzLl9zdG9yZUluZGV4PTAsdGhpcy5jbGVhcigpfXZhciBiPWEucHJvdG90eXBlLGM9YTthLmdldFJHQj1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gbnVsbCE9YSYmbnVsbD09YyYmKGQ9YixjPTI1NSZhLGI9YT4+OCYyNTUsYT1hPj4xNiYyNTUpLG51bGw9PWQ/XCJyZ2IoXCIrYStcIixcIitiK1wiLFwiK2MrXCIpXCI6XCJyZ2JhKFwiK2ErXCIsXCIrYitcIixcIitjK1wiLFwiK2QrXCIpXCJ9LGEuZ2V0SFNMPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiBudWxsPT1kP1wiaHNsKFwiK2ElMzYwK1wiLFwiK2IrXCIlLFwiK2MrXCIlKVwiOlwiaHNsYShcIithJTM2MCtcIixcIitiK1wiJSxcIitjK1wiJSxcIitkK1wiKVwifSxhLkJBU0VfNjQ9e0E6MCxCOjEsQzoyLEQ6MyxFOjQsRjo1LEc6NixIOjcsSTo4LEo6OSxLOjEwLEw6MTEsTToxMixOOjEzLE86MTQsUDoxNSxROjE2LFI6MTcsUzoxOCxUOjE5LFU6MjAsVjoyMSxXOjIyLFg6MjMsWToyNCxaOjI1LGE6MjYsYjoyNyxjOjI4LGQ6MjksZTozMCxmOjMxLGc6MzIsaDozMyxpOjM0LGo6MzUsazozNixsOjM3LG06MzgsbjozOSxvOjQwLHA6NDEscTo0MixyOjQzLHM6NDQsdDo0NSx1OjQ2LHY6NDcsdzo0OCx4OjQ5LHk6NTAsejo1MSwwOjUyLDE6NTMsMjo1NCwzOjU1LDQ6NTYsNTo1Nyw2OjU4LDc6NTksODo2MCw5OjYxLFwiK1wiOjYyLFwiL1wiOjYzfSxhLlNUUk9LRV9DQVBTX01BUD1bXCJidXR0XCIsXCJyb3VuZFwiLFwic3F1YXJlXCJdLGEuU1RST0tFX0pPSU5UU19NQVA9W1wibWl0ZXJcIixcInJvdW5kXCIsXCJiZXZlbFwiXTt2YXIgZD1jcmVhdGVqcy5jcmVhdGVDYW52YXM/Y3JlYXRlanMuY3JlYXRlQ2FudmFzKCk6ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtkLmdldENvbnRleHQmJihhLl9jdHg9ZC5nZXRDb250ZXh0KFwiMmRcIiksZC53aWR0aD1kLmhlaWdodD0xKSxiLmdldEluc3RydWN0aW9ucz1mdW5jdGlvbigpe3JldHVybiB0aGlzLl91cGRhdGVJbnN0cnVjdGlvbnMoKSx0aGlzLl9pbnN0cnVjdGlvbnN9O3RyeXtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhiLHtpbnN0cnVjdGlvbnM6e2dldDpiLmdldEluc3RydWN0aW9uc319KX1jYXRjaChlKXt9Yi5pc0VtcHR5PWZ1bmN0aW9uKCl7cmV0dXJuISh0aGlzLl9pbnN0cnVjdGlvbnMubGVuZ3RofHx0aGlzLl9hY3RpdmVJbnN0cnVjdGlvbnMubGVuZ3RoKX0sYi5kcmF3PWZ1bmN0aW9uKGEsYil7dGhpcy5fdXBkYXRlSW5zdHJ1Y3Rpb25zKCk7Zm9yKHZhciBjPXRoaXMuX2luc3RydWN0aW9ucyxkPXRoaXMuX3N0b3JlSW5kZXgsZT1jLmxlbmd0aDtlPmQ7ZCsrKWNbZF0uZXhlYyhhLGIpfSxiLmRyYXdBc1BhdGg9ZnVuY3Rpb24oYSl7dGhpcy5fdXBkYXRlSW5zdHJ1Y3Rpb25zKCk7Zm9yKHZhciBiLGM9dGhpcy5faW5zdHJ1Y3Rpb25zLGQ9dGhpcy5fc3RvcmVJbmRleCxlPWMubGVuZ3RoO2U+ZDtkKyspKGI9Y1tkXSkucGF0aCE9PSExJiZiLmV4ZWMoYSl9LGIubW92ZVRvPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuYXBwZW5kKG5ldyBjLk1vdmVUbyhhLGIpLCEwKX0sYi5saW5lVG89ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuTGluZVRvKGEsYikpfSxiLmFyY1RvPWZ1bmN0aW9uKGEsYixkLGUsZil7cmV0dXJuIHRoaXMuYXBwZW5kKG5ldyBjLkFyY1RvKGEsYixkLGUsZikpfSxiLmFyYz1mdW5jdGlvbihhLGIsZCxlLGYsZyl7cmV0dXJuIHRoaXMuYXBwZW5kKG5ldyBjLkFyYyhhLGIsZCxlLGYsZykpfSxiLnF1YWRyYXRpY0N1cnZlVG89ZnVuY3Rpb24oYSxiLGQsZSl7cmV0dXJuIHRoaXMuYXBwZW5kKG5ldyBjLlF1YWRyYXRpY0N1cnZlVG8oYSxiLGQsZSkpfSxiLmJlemllckN1cnZlVG89ZnVuY3Rpb24oYSxiLGQsZSxmLGcpe3JldHVybiB0aGlzLmFwcGVuZChuZXcgYy5CZXppZXJDdXJ2ZVRvKGEsYixkLGUsZixnKSl9LGIucmVjdD1mdW5jdGlvbihhLGIsZCxlKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuUmVjdChhLGIsZCxlKSl9LGIuY2xvc2VQYXRoPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2FjdGl2ZUluc3RydWN0aW9ucy5sZW5ndGg/dGhpcy5hcHBlbmQobmV3IGMuQ2xvc2VQYXRoKTp0aGlzfSxiLmNsZWFyPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2luc3RydWN0aW9ucy5sZW5ndGg9dGhpcy5fYWN0aXZlSW5zdHJ1Y3Rpb25zLmxlbmd0aD10aGlzLl9jb21taXRJbmRleD0wLHRoaXMuX3N0cm9rZVN0eWxlPXRoaXMuX29sZFN0cm9rZVN0eWxlPXRoaXMuX3N0cm9rZT10aGlzLl9maWxsPXRoaXMuX3N0cm9rZURhc2g9dGhpcy5fb2xkU3Ryb2tlRGFzaD1udWxsLHRoaXMuX2RpcnR5PXRoaXMuX3N0cm9rZUlnbm9yZVNjYWxlPSExLHRoaXN9LGIuYmVnaW5GaWxsPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9zZXRGaWxsKGE/bmV3IGMuRmlsbChhKTpudWxsKX0sYi5iZWdpbkxpbmVhckdyYWRpZW50RmlsbD1mdW5jdGlvbihhLGIsZCxlLGYsZyl7cmV0dXJuIHRoaXMuX3NldEZpbGwoKG5ldyBjLkZpbGwpLmxpbmVhckdyYWRpZW50KGEsYixkLGUsZixnKSl9LGIuYmVnaW5SYWRpYWxHcmFkaWVudEZpbGw9ZnVuY3Rpb24oYSxiLGQsZSxmLGcsaCxpKXtyZXR1cm4gdGhpcy5fc2V0RmlsbCgobmV3IGMuRmlsbCkucmFkaWFsR3JhZGllbnQoYSxiLGQsZSxmLGcsaCxpKSl9LGIuYmVnaW5CaXRtYXBGaWxsPWZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gdGhpcy5fc2V0RmlsbChuZXcgYy5GaWxsKG51bGwsZCkuYml0bWFwKGEsYikpfSxiLmVuZEZpbGw9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5iZWdpbkZpbGwoKX0sYi5zZXRTdHJva2VTdHlsZT1mdW5jdGlvbihhLGIsZCxlLGYpe3JldHVybiB0aGlzLl91cGRhdGVJbnN0cnVjdGlvbnMoITApLHRoaXMuX3N0cm9rZVN0eWxlPXRoaXMuY29tbWFuZD1uZXcgYy5TdHJva2VTdHlsZShhLGIsZCxlLGYpLHRoaXMuX3N0cm9rZSYmKHRoaXMuX3N0cm9rZS5pZ25vcmVTY2FsZT1mKSx0aGlzLl9zdHJva2VJZ25vcmVTY2FsZT1mLHRoaXN9LGIuc2V0U3Ryb2tlRGFzaD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLl91cGRhdGVJbnN0cnVjdGlvbnMoITApLHRoaXMuX3N0cm9rZURhc2g9dGhpcy5jb21tYW5kPW5ldyBjLlN0cm9rZURhc2goYSxiKSx0aGlzfSxiLmJlZ2luU3Ryb2tlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9zZXRTdHJva2UoYT9uZXcgYy5TdHJva2UoYSk6bnVsbCl9LGIuYmVnaW5MaW5lYXJHcmFkaWVudFN0cm9rZT1mdW5jdGlvbihhLGIsZCxlLGYsZyl7cmV0dXJuIHRoaXMuX3NldFN0cm9rZSgobmV3IGMuU3Ryb2tlKS5saW5lYXJHcmFkaWVudChhLGIsZCxlLGYsZykpfSxiLmJlZ2luUmFkaWFsR3JhZGllbnRTdHJva2U9ZnVuY3Rpb24oYSxiLGQsZSxmLGcsaCxpKXtyZXR1cm4gdGhpcy5fc2V0U3Ryb2tlKChuZXcgYy5TdHJva2UpLnJhZGlhbEdyYWRpZW50KGEsYixkLGUsZixnLGgsaSkpfSxiLmJlZ2luQml0bWFwU3Ryb2tlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuX3NldFN0cm9rZSgobmV3IGMuU3Ryb2tlKS5iaXRtYXAoYSxiKSl9LGIuZW5kU3Ryb2tlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYmVnaW5TdHJva2UoKX0sYi5jdXJ2ZVRvPWIucXVhZHJhdGljQ3VydmVUbyxiLmRyYXdSZWN0PWIucmVjdCxiLmRyYXdSb3VuZFJlY3Q9ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4gdGhpcy5kcmF3Um91bmRSZWN0Q29tcGxleChhLGIsYyxkLGUsZSxlLGUpfSxiLmRyYXdSb3VuZFJlY3RDb21wbGV4PWZ1bmN0aW9uKGEsYixkLGUsZixnLGgsaSl7cmV0dXJuIHRoaXMuYXBwZW5kKG5ldyBjLlJvdW5kUmVjdChhLGIsZCxlLGYsZyxoLGkpKX0sYi5kcmF3Q2lyY2xlPWZ1bmN0aW9uKGEsYixkKXtyZXR1cm4gdGhpcy5hcHBlbmQobmV3IGMuQ2lyY2xlKGEsYixkKSl9LGIuZHJhd0VsbGlwc2U9ZnVuY3Rpb24oYSxiLGQsZSl7cmV0dXJuIHRoaXMuYXBwZW5kKG5ldyBjLkVsbGlwc2UoYSxiLGQsZSkpfSxiLmRyYXdQb2x5U3Rhcj1mdW5jdGlvbihhLGIsZCxlLGYsZyl7cmV0dXJuIHRoaXMuYXBwZW5kKG5ldyBjLlBvbHlTdGFyKGEsYixkLGUsZixnKSl9LGIuYXBwZW5kPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuX2FjdGl2ZUluc3RydWN0aW9ucy5wdXNoKGEpLHRoaXMuY29tbWFuZD1hLGJ8fCh0aGlzLl9kaXJ0eT0hMCksdGhpc30sYi5kZWNvZGVQYXRoPWZ1bmN0aW9uKGIpe2Zvcih2YXIgYz1bdGhpcy5tb3ZlVG8sdGhpcy5saW5lVG8sdGhpcy5xdWFkcmF0aWNDdXJ2ZVRvLHRoaXMuYmV6aWVyQ3VydmVUbyx0aGlzLmNsb3NlUGF0aF0sZD1bMiwyLDQsNiwwXSxlPTAsZj1iLmxlbmd0aCxnPVtdLGg9MCxpPTAsaj1hLkJBU0VfNjQ7Zj5lOyl7dmFyIGs9Yi5jaGFyQXQoZSksbD1qW2tdLG09bD4+MyxuPWNbbV07aWYoIW58fDMmbCl0aHJvd1wiYmFkIHBhdGggZGF0YSAoQFwiK2UrXCIpOiBcIitrO3ZhciBvPWRbbV07bXx8KGg9aT0wKSxnLmxlbmd0aD0wLGUrKztmb3IodmFyIHA9KGw+PjImMSkrMixxPTA7bz5xO3ErKyl7dmFyIHI9altiLmNoYXJBdChlKV0scz1yPj41Py0xOjE7cj0oMzEmcik8PDZ8altiLmNoYXJBdChlKzEpXSwzPT1wJiYocj1yPDw2fGpbYi5jaGFyQXQoZSsyKV0pLHI9cypyLzEwLHElMj9oPXIrPWg6aT1yKz1pLGdbcV09cixlKz1wfW4uYXBwbHkodGhpcyxnKX1yZXR1cm4gdGhpc30sYi5zdG9yZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl91cGRhdGVJbnN0cnVjdGlvbnMoITApLHRoaXMuX3N0b3JlSW5kZXg9dGhpcy5faW5zdHJ1Y3Rpb25zLmxlbmd0aCx0aGlzfSxiLnVuc3RvcmU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc3RvcmVJbmRleD0wLHRoaXN9LGIuY2xvbmU9ZnVuY3Rpb24oKXt2YXIgYj1uZXcgYTtyZXR1cm4gYi5jb21tYW5kPXRoaXMuY29tbWFuZCxiLl9zdHJva2U9dGhpcy5fc3Ryb2tlLGIuX3N0cm9rZVN0eWxlPXRoaXMuX3N0cm9rZVN0eWxlLGIuX3N0cm9rZURhc2g9dGhpcy5fc3Ryb2tlRGFzaCxiLl9zdHJva2VJZ25vcmVTY2FsZT10aGlzLl9zdHJva2VJZ25vcmVTY2FsZSxiLl9maWxsPXRoaXMuX2ZpbGwsYi5faW5zdHJ1Y3Rpb25zPXRoaXMuX2luc3RydWN0aW9ucy5zbGljZSgpLGIuX2NvbW1pdEluZGV4PXRoaXMuX2NvbW1pdEluZGV4LGIuX2FjdGl2ZUluc3RydWN0aW9ucz10aGlzLl9hY3RpdmVJbnN0cnVjdGlvbnMuc2xpY2UoKSxiLl9kaXJ0eT10aGlzLl9kaXJ0eSxiLl9zdG9yZUluZGV4PXRoaXMuX3N0b3JlSW5kZXgsYn0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0dyYXBoaWNzXVwifSxiLm10PWIubW92ZVRvLGIubHQ9Yi5saW5lVG8sYi5hdD1iLmFyY1RvLGIuYnQ9Yi5iZXppZXJDdXJ2ZVRvLGIucXQ9Yi5xdWFkcmF0aWNDdXJ2ZVRvLGIuYT1iLmFyYyxiLnI9Yi5yZWN0LGIuY3A9Yi5jbG9zZVBhdGgsYi5jPWIuY2xlYXIsYi5mPWIuYmVnaW5GaWxsLGIubGY9Yi5iZWdpbkxpbmVhckdyYWRpZW50RmlsbCxiLnJmPWIuYmVnaW5SYWRpYWxHcmFkaWVudEZpbGwsYi5iZj1iLmJlZ2luQml0bWFwRmlsbCxiLmVmPWIuZW5kRmlsbCxiLnNzPWIuc2V0U3Ryb2tlU3R5bGUsYi5zZD1iLnNldFN0cm9rZURhc2gsYi5zPWIuYmVnaW5TdHJva2UsYi5scz1iLmJlZ2luTGluZWFyR3JhZGllbnRTdHJva2UsYi5ycz1iLmJlZ2luUmFkaWFsR3JhZGllbnRTdHJva2UsYi5icz1iLmJlZ2luQml0bWFwU3Ryb2tlLGIuZXM9Yi5lbmRTdHJva2UsYi5kcj1iLmRyYXdSZWN0LGIucnI9Yi5kcmF3Um91bmRSZWN0LGIucmM9Yi5kcmF3Um91bmRSZWN0Q29tcGxleCxiLmRjPWIuZHJhd0NpcmNsZSxiLmRlPWIuZHJhd0VsbGlwc2UsYi5kcD1iLmRyYXdQb2x5U3RhcixiLnA9Yi5kZWNvZGVQYXRoLGIuX3VwZGF0ZUluc3RydWN0aW9ucz1mdW5jdGlvbihiKXt2YXIgYz10aGlzLl9pbnN0cnVjdGlvbnMsZD10aGlzLl9hY3RpdmVJbnN0cnVjdGlvbnMsZT10aGlzLl9jb21taXRJbmRleDtpZih0aGlzLl9kaXJ0eSYmZC5sZW5ndGgpe2MubGVuZ3RoPWUsYy5wdXNoKGEuYmVnaW5DbWQpO3ZhciBmPWQubGVuZ3RoLGc9Yy5sZW5ndGg7Yy5sZW5ndGg9ZytmO2Zvcih2YXIgaD0wO2Y+aDtoKyspY1toK2ddPWRbaF07dGhpcy5fZmlsbCYmYy5wdXNoKHRoaXMuX2ZpbGwpLHRoaXMuX3N0cm9rZSYmKHRoaXMuX3N0cm9rZURhc2ghPT10aGlzLl9vbGRTdHJva2VEYXNoJiYodGhpcy5fb2xkU3Ryb2tlRGFzaD10aGlzLl9zdHJva2VEYXNoLGMucHVzaCh0aGlzLl9zdHJva2VEYXNoKSksdGhpcy5fc3Ryb2tlU3R5bGUhPT10aGlzLl9vbGRTdHJva2VTdHlsZSYmKHRoaXMuX29sZFN0cm9rZVN0eWxlPXRoaXMuX3N0cm9rZVN0eWxlLGMucHVzaCh0aGlzLl9zdHJva2VTdHlsZSkpLGMucHVzaCh0aGlzLl9zdHJva2UpKSx0aGlzLl9kaXJ0eT0hMX1iJiYoZC5sZW5ndGg9MCx0aGlzLl9jb21taXRJbmRleD1jLmxlbmd0aCl9LGIuX3NldEZpbGw9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3VwZGF0ZUluc3RydWN0aW9ucyghMCksdGhpcy5jb21tYW5kPXRoaXMuX2ZpbGw9YSx0aGlzfSxiLl9zZXRTdHJva2U9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3VwZGF0ZUluc3RydWN0aW9ucyghMCksKHRoaXMuY29tbWFuZD10aGlzLl9zdHJva2U9YSkmJihhLmlnbm9yZVNjYWxlPXRoaXMuX3N0cm9rZUlnbm9yZVNjYWxlKSx0aGlzfSwoYy5MaW5lVG89ZnVuY3Rpb24oYSxiKXt0aGlzLng9YSx0aGlzLnk9Yn0pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe2EubGluZVRvKHRoaXMueCx0aGlzLnkpfSwoYy5Nb3ZlVG89ZnVuY3Rpb24oYSxiKXt0aGlzLng9YSx0aGlzLnk9Yn0pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe2EubW92ZVRvKHRoaXMueCx0aGlzLnkpfSwoYy5BcmNUbz1mdW5jdGlvbihhLGIsYyxkLGUpe3RoaXMueDE9YSx0aGlzLnkxPWIsdGhpcy54Mj1jLHRoaXMueTI9ZCx0aGlzLnJhZGl1cz1lfSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5hcmNUbyh0aGlzLngxLHRoaXMueTEsdGhpcy54Mix0aGlzLnkyLHRoaXMucmFkaXVzKX0sKGMuQXJjPWZ1bmN0aW9uKGEsYixjLGQsZSxmKXt0aGlzLng9YSx0aGlzLnk9Yix0aGlzLnJhZGl1cz1jLHRoaXMuc3RhcnRBbmdsZT1kLHRoaXMuZW5kQW5nbGU9ZSx0aGlzLmFudGljbG9ja3dpc2U9ISFmfSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5hcmModGhpcy54LHRoaXMueSx0aGlzLnJhZGl1cyx0aGlzLnN0YXJ0QW5nbGUsdGhpcy5lbmRBbmdsZSx0aGlzLmFudGljbG9ja3dpc2UpfSwoYy5RdWFkcmF0aWNDdXJ2ZVRvPWZ1bmN0aW9uKGEsYixjLGQpe3RoaXMuY3B4PWEsdGhpcy5jcHk9Yix0aGlzLng9Yyx0aGlzLnk9ZH0pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe2EucXVhZHJhdGljQ3VydmVUbyh0aGlzLmNweCx0aGlzLmNweSx0aGlzLngsdGhpcy55KX0sKGMuQmV6aWVyQ3VydmVUbz1mdW5jdGlvbihhLGIsYyxkLGUsZil7dGhpcy5jcDF4PWEsdGhpcy5jcDF5PWIsdGhpcy5jcDJ4PWMsdGhpcy5jcDJ5PWQsdGhpcy54PWUsdGhpcy55PWZ9KS5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihhKXthLmJlemllckN1cnZlVG8odGhpcy5jcDF4LHRoaXMuY3AxeSx0aGlzLmNwMngsdGhpcy5jcDJ5LHRoaXMueCx0aGlzLnkpfSwoYy5SZWN0PWZ1bmN0aW9uKGEsYixjLGQpe3RoaXMueD1hLHRoaXMueT1iLHRoaXMudz1jLHRoaXMuaD1kfSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5yZWN0KHRoaXMueCx0aGlzLnksdGhpcy53LHRoaXMuaCl9LChjLkNsb3NlUGF0aD1mdW5jdGlvbigpe30pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe2EuY2xvc2VQYXRoKCl9LChjLkJlZ2luUGF0aD1mdW5jdGlvbigpe30pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe2EuYmVnaW5QYXRoKCl9LGI9KGMuRmlsbD1mdW5jdGlvbihhLGIpe3RoaXMuc3R5bGU9YSx0aGlzLm1hdHJpeD1ifSkucHJvdG90eXBlLGIuZXhlYz1mdW5jdGlvbihhKXtpZih0aGlzLnN0eWxlKXthLmZpbGxTdHlsZT10aGlzLnN0eWxlO3ZhciBiPXRoaXMubWF0cml4O2ImJihhLnNhdmUoKSxhLnRyYW5zZm9ybShiLmEsYi5iLGIuYyxiLmQsYi50eCxiLnR5KSksYS5maWxsKCksYiYmYS5yZXN0b3JlKCl9fSxiLmxpbmVhckdyYWRpZW50PWZ1bmN0aW9uKGIsYyxkLGUsZixnKXtmb3IodmFyIGg9dGhpcy5zdHlsZT1hLl9jdHguY3JlYXRlTGluZWFyR3JhZGllbnQoZCxlLGYsZyksaT0wLGo9Yi5sZW5ndGg7aj5pO2krKyloLmFkZENvbG9yU3RvcChjW2ldLGJbaV0pO3JldHVybiBoLnByb3BzPXtjb2xvcnM6YixyYXRpb3M6Yyx4MDpkLHkwOmUseDE6Zix5MTpnLHR5cGU6XCJsaW5lYXJcIn0sdGhpc30sYi5yYWRpYWxHcmFkaWVudD1mdW5jdGlvbihiLGMsZCxlLGYsZyxoLGkpe2Zvcih2YXIgaj10aGlzLnN0eWxlPWEuX2N0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChkLGUsZixnLGgsaSksaz0wLGw9Yi5sZW5ndGg7bD5rO2srKylqLmFkZENvbG9yU3RvcChjW2tdLGJba10pO3JldHVybiBqLnByb3BzPXtjb2xvcnM6YixyYXRpb3M6Yyx4MDpkLHkwOmUscjA6Zix4MTpnLHkxOmgscjE6aSx0eXBlOlwicmFkaWFsXCJ9LHRoaXN9LGIuYml0bWFwPWZ1bmN0aW9uKGIsYyl7aWYoYi5uYXR1cmFsV2lkdGh8fGIuZ2V0Q29udGV4dHx8Yi5yZWFkeVN0YXRlPj0yKXt2YXIgZD10aGlzLnN0eWxlPWEuX2N0eC5jcmVhdGVQYXR0ZXJuKGIsY3x8XCJcIik7ZC5wcm9wcz17aW1hZ2U6YixyZXBldGl0aW9uOmMsdHlwZTpcImJpdG1hcFwifX1yZXR1cm4gdGhpc30sYi5wYXRoPSExLGI9KGMuU3Ryb2tlPWZ1bmN0aW9uKGEsYil7dGhpcy5zdHlsZT1hLHRoaXMuaWdub3JlU2NhbGU9Yn0pLnByb3RvdHlwZSxiLmV4ZWM9ZnVuY3Rpb24oYSl7dGhpcy5zdHlsZSYmKGEuc3Ryb2tlU3R5bGU9dGhpcy5zdHlsZSx0aGlzLmlnbm9yZVNjYWxlJiYoYS5zYXZlKCksYS5zZXRUcmFuc2Zvcm0oMSwwLDAsMSwwLDApKSxhLnN0cm9rZSgpLHRoaXMuaWdub3JlU2NhbGUmJmEucmVzdG9yZSgpKX0sYi5saW5lYXJHcmFkaWVudD1jLkZpbGwucHJvdG90eXBlLmxpbmVhckdyYWRpZW50LGIucmFkaWFsR3JhZGllbnQ9Yy5GaWxsLnByb3RvdHlwZS5yYWRpYWxHcmFkaWVudCxiLmJpdG1hcD1jLkZpbGwucHJvdG90eXBlLmJpdG1hcCxiLnBhdGg9ITEsYj0oYy5TdHJva2VTdHlsZT1mdW5jdGlvbihhLGIsYyxkLGUpe3RoaXMud2lkdGg9YSx0aGlzLmNhcHM9Yix0aGlzLmpvaW50cz1jLHRoaXMubWl0ZXJMaW1pdD1kLHRoaXMuaWdub3JlU2NhbGU9ZX0pLnByb3RvdHlwZSxiLmV4ZWM9ZnVuY3Rpb24oYil7Yi5saW5lV2lkdGg9bnVsbD09dGhpcy53aWR0aD9cIjFcIjp0aGlzLndpZHRoLGIubGluZUNhcD1udWxsPT10aGlzLmNhcHM/XCJidXR0XCI6aXNOYU4odGhpcy5jYXBzKT90aGlzLmNhcHM6YS5TVFJPS0VfQ0FQU19NQVBbdGhpcy5jYXBzXSxiLmxpbmVKb2luPW51bGw9PXRoaXMuam9pbnRzP1wibWl0ZXJcIjppc05hTih0aGlzLmpvaW50cyk/dGhpcy5qb2ludHM6YS5TVFJPS0VfSk9JTlRTX01BUFt0aGlzLmpvaW50c10sYi5taXRlckxpbWl0PW51bGw9PXRoaXMubWl0ZXJMaW1pdD9cIjEwXCI6dGhpcy5taXRlckxpbWl0LGIuaWdub3JlU2NhbGU9bnVsbD09dGhpcy5pZ25vcmVTY2FsZT8hMTp0aGlzLmlnbm9yZVNjYWxlfSxiLnBhdGg9ITEsKGMuU3Ryb2tlRGFzaD1mdW5jdGlvbihhLGIpe3RoaXMuc2VnbWVudHM9YSx0aGlzLm9mZnNldD1ifHwwfSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7YS5zZXRMaW5lRGFzaCYmKGEuc2V0TGluZURhc2godGhpcy5zZWdtZW50c3x8Yy5TdHJva2VEYXNoLkVNUFRZX1NFR01FTlRTKSxhLmxpbmVEYXNoT2Zmc2V0PXRoaXMub2Zmc2V0fHwwKX0sYy5TdHJva2VEYXNoLkVNUFRZX1NFR01FTlRTPVtdLChjLlJvdW5kUmVjdD1mdW5jdGlvbihhLGIsYyxkLGUsZixnLGgpe3RoaXMueD1hLHRoaXMueT1iLHRoaXMudz1jLHRoaXMuaD1kLHRoaXMucmFkaXVzVEw9ZSx0aGlzLnJhZGl1c1RSPWYsdGhpcy5yYWRpdXNCUj1nLHRoaXMucmFkaXVzQkw9aH0pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe3ZhciBiPShqPmk/aTpqKS8yLGM9MCxkPTAsZT0wLGY9MCxnPXRoaXMueCxoPXRoaXMueSxpPXRoaXMudyxqPXRoaXMuaCxrPXRoaXMucmFkaXVzVEwsbD10aGlzLnJhZGl1c1RSLG09dGhpcy5yYWRpdXNCUixuPXRoaXMucmFkaXVzQkw7MD5rJiYoayo9Yz0tMSksaz5iJiYoaz1iKSwwPmwmJihsKj1kPS0xKSxsPmImJihsPWIpLDA+bSYmKG0qPWU9LTEpLG0+YiYmKG09YiksMD5uJiYobio9Zj0tMSksbj5iJiYobj1iKSxhLm1vdmVUbyhnK2ktbCxoKSxhLmFyY1RvKGcraStsKmQsaC1sKmQsZytpLGgrbCxsKSxhLmxpbmVUbyhnK2ksaCtqLW0pLGEuYXJjVG8oZytpK20qZSxoK2orbSplLGcraS1tLGgraixtKSxhLmxpbmVUbyhnK24saCtqKSxhLmFyY1RvKGctbipmLGgraituKmYsZyxoK2otbixuKSxhLmxpbmVUbyhnLGgrayksYS5hcmNUbyhnLWsqYyxoLWsqYyxnK2ssaCxrKSxhLmNsb3NlUGF0aCgpfSwoYy5DaXJjbGU9ZnVuY3Rpb24oYSxiLGMpe3RoaXMueD1hLHRoaXMueT1iLHRoaXMucmFkaXVzPWN9KS5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihhKXthLmFyYyh0aGlzLngsdGhpcy55LHRoaXMucmFkaXVzLDAsMipNYXRoLlBJKX0sKGMuRWxsaXBzZT1mdW5jdGlvbihhLGIsYyxkKXt0aGlzLng9YSx0aGlzLnk9Yix0aGlzLnc9Yyx0aGlzLmg9ZH0pLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMueCxjPXRoaXMueSxkPXRoaXMudyxlPXRoaXMuaCxmPS41NTIyODQ4LGc9ZC8yKmYsaD1lLzIqZixpPWIrZCxqPWMrZSxrPWIrZC8yLGw9YytlLzI7YS5tb3ZlVG8oYixsKSxhLmJlemllckN1cnZlVG8oYixsLWgsay1nLGMsayxjKSxhLmJlemllckN1cnZlVG8oaytnLGMsaSxsLWgsaSxsKSxhLmJlemllckN1cnZlVG8oaSxsK2gsaytnLGosayxqKSxhLmJlemllckN1cnZlVG8oay1nLGosYixsK2gsYixsKX0sKGMuUG9seVN0YXI9ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe3RoaXMueD1hLHRoaXMueT1iLHRoaXMucmFkaXVzPWMsdGhpcy5zaWRlcz1kLHRoaXMucG9pbnRTaXplPWUsdGhpcy5hbmdsZT1mfSkucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy54LGM9dGhpcy55LGQ9dGhpcy5yYWRpdXMsZT0odGhpcy5hbmdsZXx8MCkvMTgwKk1hdGguUEksZj10aGlzLnNpZGVzLGc9MS0odGhpcy5wb2ludFNpemV8fDApLGg9TWF0aC5QSS9mO2EubW92ZVRvKGIrTWF0aC5jb3MoZSkqZCxjK01hdGguc2luKGUpKmQpO2Zvcih2YXIgaT0wO2Y+aTtpKyspZSs9aCwxIT1nJiZhLmxpbmVUbyhiK01hdGguY29zKGUpKmQqZyxjK01hdGguc2luKGUpKmQqZyksZSs9aCxhLmxpbmVUbyhiK01hdGguY29zKGUpKmQsYytNYXRoLnNpbihlKSpkKTthLmNsb3NlUGF0aCgpfSxhLmJlZ2luQ21kPW5ldyBjLkJlZ2luUGF0aCxjcmVhdGVqcy5HcmFwaGljcz1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhpcy5FdmVudERpc3BhdGNoZXJfY29uc3RydWN0b3IoKSx0aGlzLmFscGhhPTEsdGhpcy5jYWNoZUNhbnZhcz1udWxsLHRoaXMuY2FjaGVJRD0wLHRoaXMuaWQ9Y3JlYXRlanMuVUlELmdldCgpLHRoaXMubW91c2VFbmFibGVkPSEwLHRoaXMudGlja0VuYWJsZWQ9ITAsdGhpcy5uYW1lPW51bGwsdGhpcy5wYXJlbnQ9bnVsbCx0aGlzLnJlZ1g9MCx0aGlzLnJlZ1k9MCx0aGlzLnJvdGF0aW9uPTAsdGhpcy5zY2FsZVg9MSx0aGlzLnNjYWxlWT0xLHRoaXMuc2tld1g9MCx0aGlzLnNrZXdZPTAsdGhpcy5zaGFkb3c9bnVsbCx0aGlzLnZpc2libGU9ITAsdGhpcy54PTAsdGhpcy55PTAsdGhpcy50cmFuc2Zvcm1NYXRyaXg9bnVsbCx0aGlzLmNvbXBvc2l0ZU9wZXJhdGlvbj1udWxsLHRoaXMuc25hcFRvUGl4ZWw9ITAsdGhpcy5maWx0ZXJzPW51bGwsXG50aGlzLm1hc2s9bnVsbCx0aGlzLmhpdEFyZWE9bnVsbCx0aGlzLmN1cnNvcj1udWxsLHRoaXMuX2NhY2hlT2Zmc2V0WD0wLHRoaXMuX2NhY2hlT2Zmc2V0WT0wLHRoaXMuX2ZpbHRlck9mZnNldFg9MCx0aGlzLl9maWx0ZXJPZmZzZXRZPTAsdGhpcy5fY2FjaGVTY2FsZT0xLHRoaXMuX2NhY2hlRGF0YVVSTElEPTAsdGhpcy5fY2FjaGVEYXRhVVJMPW51bGwsdGhpcy5fcHJvcHM9bmV3IGNyZWF0ZWpzLkRpc3BsYXlQcm9wcyx0aGlzLl9yZWN0YW5nbGU9bmV3IGNyZWF0ZWpzLlJlY3RhbmdsZSx0aGlzLl9ib3VuZHM9bnVsbH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIpO2EuX01PVVNFX0VWRU5UUz1bXCJjbGlja1wiLFwiZGJsY2xpY2tcIixcIm1vdXNlZG93blwiLFwibW91c2VvdXRcIixcIm1vdXNlb3ZlclwiLFwicHJlc3Ntb3ZlXCIsXCJwcmVzc3VwXCIsXCJyb2xsb3V0XCIsXCJyb2xsb3ZlclwiXSxhLnN1cHByZXNzQ3Jvc3NEb21haW5FcnJvcnM9ITEsYS5fc25hcFRvUGl4ZWxFbmFibGVkPSExO3ZhciBjPWNyZWF0ZWpzLmNyZWF0ZUNhbnZhcz9jcmVhdGVqcy5jcmVhdGVDYW52YXMoKTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO2MuZ2V0Q29udGV4dCYmKGEuX2hpdFRlc3RDYW52YXM9YyxhLl9oaXRUZXN0Q29udGV4dD1jLmdldENvbnRleHQoXCIyZFwiKSxjLndpZHRoPWMuaGVpZ2h0PTEpLGEuX25leHRDYWNoZUlEPTEsYi5nZXRTdGFnZT1mdW5jdGlvbigpe2Zvcih2YXIgYT10aGlzLGI9Y3JlYXRlanMuU3RhZ2U7YS5wYXJlbnQ7KWE9YS5wYXJlbnQ7cmV0dXJuIGEgaW5zdGFuY2VvZiBiP2E6bnVsbH07dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGIse3N0YWdlOntnZXQ6Yi5nZXRTdGFnZX19KX1jYXRjaChkKXt9Yi5pc1Zpc2libGU9ZnVuY3Rpb24oKXtyZXR1cm4hISh0aGlzLnZpc2libGUmJnRoaXMuYWxwaGE+MCYmMCE9dGhpcy5zY2FsZVgmJjAhPXRoaXMuc2NhbGVZKX0sYi5kcmF3PWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5jYWNoZUNhbnZhcztpZihifHwhYylyZXR1cm4hMTt2YXIgZD10aGlzLl9jYWNoZVNjYWxlO3JldHVybiBhLmRyYXdJbWFnZShjLHRoaXMuX2NhY2hlT2Zmc2V0WCt0aGlzLl9maWx0ZXJPZmZzZXRYLHRoaXMuX2NhY2hlT2Zmc2V0WSt0aGlzLl9maWx0ZXJPZmZzZXRZLGMud2lkdGgvZCxjLmhlaWdodC9kKSwhMH0sYi51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMsZD1jLm1hc2ssZT1jLl9wcm9wcy5tYXRyaXg7ZCYmZC5ncmFwaGljcyYmIWQuZ3JhcGhpY3MuaXNFbXB0eSgpJiYoZC5nZXRNYXRyaXgoZSksYi50cmFuc2Zvcm0oZS5hLGUuYixlLmMsZS5kLGUudHgsZS50eSksZC5ncmFwaGljcy5kcmF3QXNQYXRoKGIpLGIuY2xpcCgpLGUuaW52ZXJ0KCksYi50cmFuc2Zvcm0oZS5hLGUuYixlLmMsZS5kLGUudHgsZS50eSkpLHRoaXMuZ2V0TWF0cml4KGUpO3ZhciBmPWUudHgsZz1lLnR5O2EuX3NuYXBUb1BpeGVsRW5hYmxlZCYmYy5zbmFwVG9QaXhlbCYmKGY9ZisoMD5mPy0uNTouNSl8MCxnPWcrKDA+Zz8tLjU6LjUpfDApLGIudHJhbnNmb3JtKGUuYSxlLmIsZS5jLGUuZCxmLGcpLGIuZ2xvYmFsQWxwaGEqPWMuYWxwaGEsYy5jb21wb3NpdGVPcGVyYXRpb24mJihiLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbj1jLmNvbXBvc2l0ZU9wZXJhdGlvbiksYy5zaGFkb3cmJnRoaXMuX2FwcGx5U2hhZG93KGIsYy5zaGFkb3cpfSxiLmNhY2hlPWZ1bmN0aW9uKGEsYixjLGQsZSl7ZT1lfHwxLHRoaXMuY2FjaGVDYW52YXN8fCh0aGlzLmNhY2hlQ2FudmFzPWNyZWF0ZWpzLmNyZWF0ZUNhbnZhcz9jcmVhdGVqcy5jcmVhdGVDYW52YXMoKTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpKSx0aGlzLl9jYWNoZVdpZHRoPWMsdGhpcy5fY2FjaGVIZWlnaHQ9ZCx0aGlzLl9jYWNoZU9mZnNldFg9YSx0aGlzLl9jYWNoZU9mZnNldFk9Yix0aGlzLl9jYWNoZVNjYWxlPWUsdGhpcy51cGRhdGVDYWNoZSgpfSxiLnVwZGF0ZUNhY2hlPWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuY2FjaGVDYW52YXM7aWYoIWMpdGhyb3dcImNhY2hlKCkgbXVzdCBiZSBjYWxsZWQgYmVmb3JlIHVwZGF0ZUNhY2hlKClcIjt2YXIgZD10aGlzLl9jYWNoZVNjYWxlLGU9dGhpcy5fY2FjaGVPZmZzZXRYKmQsZj10aGlzLl9jYWNoZU9mZnNldFkqZCxnPXRoaXMuX2NhY2hlV2lkdGgsaD10aGlzLl9jYWNoZUhlaWdodCxpPWMuZ2V0Q29udGV4dChcIjJkXCIpLGo9dGhpcy5fZ2V0RmlsdGVyQm91bmRzKCk7ZSs9dGhpcy5fZmlsdGVyT2Zmc2V0WD1qLngsZis9dGhpcy5fZmlsdGVyT2Zmc2V0WT1qLnksZz1NYXRoLmNlaWwoZypkKStqLndpZHRoLGg9TWF0aC5jZWlsKGgqZCkrai5oZWlnaHQsZyE9Yy53aWR0aHx8aCE9Yy5oZWlnaHQ/KGMud2lkdGg9ZyxjLmhlaWdodD1oKTpifHxpLmNsZWFyUmVjdCgwLDAsZysxLGgrMSksaS5zYXZlKCksaS5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb249YixpLnNldFRyYW5zZm9ybShkLDAsMCxkLC1lLC1mKSx0aGlzLmRyYXcoaSwhMCksdGhpcy5fYXBwbHlGaWx0ZXJzKCksaS5yZXN0b3JlKCksdGhpcy5jYWNoZUlEPWEuX25leHRDYWNoZUlEKyt9LGIudW5jYWNoZT1mdW5jdGlvbigpe3RoaXMuX2NhY2hlRGF0YVVSTD10aGlzLmNhY2hlQ2FudmFzPW51bGwsdGhpcy5jYWNoZUlEPXRoaXMuX2NhY2hlT2Zmc2V0WD10aGlzLl9jYWNoZU9mZnNldFk9dGhpcy5fZmlsdGVyT2Zmc2V0WD10aGlzLl9maWx0ZXJPZmZzZXRZPTAsdGhpcy5fY2FjaGVTY2FsZT0xfSxiLmdldENhY2hlRGF0YVVSTD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNhY2hlQ2FudmFzPyh0aGlzLmNhY2hlSUQhPXRoaXMuX2NhY2hlRGF0YVVSTElEJiYodGhpcy5fY2FjaGVEYXRhVVJMPXRoaXMuY2FjaGVDYW52YXMudG9EYXRhVVJMKCkpLHRoaXMuX2NhY2hlRGF0YVVSTCk6bnVsbH0sYi5sb2NhbFRvR2xvYmFsPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5nZXRDb25jYXRlbmF0ZWRNYXRyaXgodGhpcy5fcHJvcHMubWF0cml4KS50cmFuc2Zvcm1Qb2ludChhLGIsY3x8bmV3IGNyZWF0ZWpzLlBvaW50KX0sYi5nbG9iYWxUb0xvY2FsPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5nZXRDb25jYXRlbmF0ZWRNYXRyaXgodGhpcy5fcHJvcHMubWF0cml4KS5pbnZlcnQoKS50cmFuc2Zvcm1Qb2ludChhLGIsY3x8bmV3IGNyZWF0ZWpzLlBvaW50KX0sYi5sb2NhbFRvTG9jYWw9ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIGQ9dGhpcy5sb2NhbFRvR2xvYmFsKGEsYixkKSxjLmdsb2JhbFRvTG9jYWwoZC54LGQueSxkKX0sYi5zZXRUcmFuc2Zvcm09ZnVuY3Rpb24oYSxiLGMsZCxlLGYsZyxoLGkpe3JldHVybiB0aGlzLng9YXx8MCx0aGlzLnk9Ynx8MCx0aGlzLnNjYWxlWD1udWxsPT1jPzE6Yyx0aGlzLnNjYWxlWT1udWxsPT1kPzE6ZCx0aGlzLnJvdGF0aW9uPWV8fDAsdGhpcy5za2V3WD1mfHwwLHRoaXMuc2tld1k9Z3x8MCx0aGlzLnJlZ1g9aHx8MCx0aGlzLnJlZ1k9aXx8MCx0aGlzfSxiLmdldE1hdHJpeD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLGM9YSYmYS5pZGVudGl0eSgpfHxuZXcgY3JlYXRlanMuTWF0cml4MkQ7cmV0dXJuIGIudHJhbnNmb3JtTWF0cml4P2MuY29weShiLnRyYW5zZm9ybU1hdHJpeCk6Yy5hcHBlbmRUcmFuc2Zvcm0oYi54LGIueSxiLnNjYWxlWCxiLnNjYWxlWSxiLnJvdGF0aW9uLGIuc2tld1gsYi5za2V3WSxiLnJlZ1gsYi5yZWdZKX0sYi5nZXRDb25jYXRlbmF0ZWRNYXRyaXg9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPXRoaXMsYz10aGlzLmdldE1hdHJpeChhKTtiPWIucGFyZW50OyljLnByZXBlbmRNYXRyaXgoYi5nZXRNYXRyaXgoYi5fcHJvcHMubWF0cml4KSk7cmV0dXJuIGN9LGIuZ2V0Q29uY2F0ZW5hdGVkRGlzcGxheVByb3BzPWZ1bmN0aW9uKGEpe2E9YT9hLmlkZW50aXR5KCk6bmV3IGNyZWF0ZWpzLkRpc3BsYXlQcm9wczt2YXIgYj10aGlzLGM9Yi5nZXRNYXRyaXgoYS5tYXRyaXgpO2RvIGEucHJlcGVuZChiLnZpc2libGUsYi5hbHBoYSxiLnNoYWRvdyxiLmNvbXBvc2l0ZU9wZXJhdGlvbiksYiE9dGhpcyYmYy5wcmVwZW5kTWF0cml4KGIuZ2V0TWF0cml4KGIuX3Byb3BzLm1hdHJpeCkpO3doaWxlKGI9Yi5wYXJlbnQpO3JldHVybiBhfSxiLmhpdFRlc3Q9ZnVuY3Rpb24oYixjKXt2YXIgZD1hLl9oaXRUZXN0Q29udGV4dDtkLnNldFRyYW5zZm9ybSgxLDAsMCwxLC1iLC1jKSx0aGlzLmRyYXcoZCk7dmFyIGU9dGhpcy5fdGVzdEhpdChkKTtyZXR1cm4gZC5zZXRUcmFuc2Zvcm0oMSwwLDAsMSwwLDApLGQuY2xlYXJSZWN0KDAsMCwyLDIpLGV9LGIuc2V0PWZ1bmN0aW9uKGEpe2Zvcih2YXIgYiBpbiBhKXRoaXNbYl09YVtiXTtyZXR1cm4gdGhpc30sYi5nZXRCb3VuZHM9ZnVuY3Rpb24oKXtpZih0aGlzLl9ib3VuZHMpcmV0dXJuIHRoaXMuX3JlY3RhbmdsZS5jb3B5KHRoaXMuX2JvdW5kcyk7dmFyIGE9dGhpcy5jYWNoZUNhbnZhcztpZihhKXt2YXIgYj10aGlzLl9jYWNoZVNjYWxlO3JldHVybiB0aGlzLl9yZWN0YW5nbGUuc2V0VmFsdWVzKHRoaXMuX2NhY2hlT2Zmc2V0WCx0aGlzLl9jYWNoZU9mZnNldFksYS53aWR0aC9iLGEuaGVpZ2h0L2IpfXJldHVybiBudWxsfSxiLmdldFRyYW5zZm9ybWVkQm91bmRzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2dldEJvdW5kcygpfSxiLnNldEJvdW5kcz1mdW5jdGlvbihhLGIsYyxkKXtudWxsPT1hJiYodGhpcy5fYm91bmRzPWEpLHRoaXMuX2JvdW5kcz0odGhpcy5fYm91bmRzfHxuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKS5zZXRWYWx1ZXMoYSxiLGMsZCl9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fY2xvbmVQcm9wcyhuZXcgYSl9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltEaXNwbGF5T2JqZWN0IChuYW1lPVwiK3RoaXMubmFtZStcIildXCJ9LGIuX2Nsb25lUHJvcHM9ZnVuY3Rpb24oYSl7cmV0dXJuIGEuYWxwaGE9dGhpcy5hbHBoYSxhLm1vdXNlRW5hYmxlZD10aGlzLm1vdXNlRW5hYmxlZCxhLnRpY2tFbmFibGVkPXRoaXMudGlja0VuYWJsZWQsYS5uYW1lPXRoaXMubmFtZSxhLnJlZ1g9dGhpcy5yZWdYLGEucmVnWT10aGlzLnJlZ1ksYS5yb3RhdGlvbj10aGlzLnJvdGF0aW9uLGEuc2NhbGVYPXRoaXMuc2NhbGVYLGEuc2NhbGVZPXRoaXMuc2NhbGVZLGEuc2hhZG93PXRoaXMuc2hhZG93LGEuc2tld1g9dGhpcy5za2V3WCxhLnNrZXdZPXRoaXMuc2tld1ksYS52aXNpYmxlPXRoaXMudmlzaWJsZSxhLng9dGhpcy54LGEueT10aGlzLnksYS5jb21wb3NpdGVPcGVyYXRpb249dGhpcy5jb21wb3NpdGVPcGVyYXRpb24sYS5zbmFwVG9QaXhlbD10aGlzLnNuYXBUb1BpeGVsLGEuZmlsdGVycz1udWxsPT10aGlzLmZpbHRlcnM/bnVsbDp0aGlzLmZpbHRlcnMuc2xpY2UoMCksYS5tYXNrPXRoaXMubWFzayxhLmhpdEFyZWE9dGhpcy5oaXRBcmVhLGEuY3Vyc29yPXRoaXMuY3Vyc29yLGEuX2JvdW5kcz10aGlzLl9ib3VuZHMsYX0sYi5fYXBwbHlTaGFkb3c9ZnVuY3Rpb24oYSxiKXtiPWJ8fFNoYWRvdy5pZGVudGl0eSxhLnNoYWRvd0NvbG9yPWIuY29sb3IsYS5zaGFkb3dPZmZzZXRYPWIub2Zmc2V0WCxhLnNoYWRvd09mZnNldFk9Yi5vZmZzZXRZLGEuc2hhZG93Qmx1cj1iLmJsdXJ9LGIuX3RpY2s9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fbGlzdGVuZXJzO2ImJmIudGljayYmKGEudGFyZ2V0PW51bGwsYS5wcm9wYWdhdGlvblN0b3BwZWQ9YS5pbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9ITEsdGhpcy5kaXNwYXRjaEV2ZW50KGEpKX0sYi5fdGVzdEhpdD1mdW5jdGlvbihiKXt0cnl7dmFyIGM9Yi5nZXRJbWFnZURhdGEoMCwwLDEsMSkuZGF0YVszXT4xfWNhdGNoKGQpe2lmKCFhLnN1cHByZXNzQ3Jvc3NEb21haW5FcnJvcnMpdGhyb3dcIkFuIGVycm9yIGhhcyBvY2N1cnJlZC4gVGhpcyBpcyBtb3N0IGxpa2VseSBkdWUgdG8gc2VjdXJpdHkgcmVzdHJpY3Rpb25zIG9uIHJlYWRpbmcgY2FudmFzIHBpeGVsIGRhdGEgd2l0aCBsb2NhbCBvciBjcm9zcy1kb21haW4gaW1hZ2VzLlwifXJldHVybiBjfSxiLl9hcHBseUZpbHRlcnM9ZnVuY3Rpb24oKXtpZih0aGlzLmZpbHRlcnMmJjAhPXRoaXMuZmlsdGVycy5sZW5ndGgmJnRoaXMuY2FjaGVDYW52YXMpZm9yKHZhciBhPXRoaXMuZmlsdGVycy5sZW5ndGgsYj10aGlzLmNhY2hlQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKSxjPXRoaXMuY2FjaGVDYW52YXMud2lkdGgsZD10aGlzLmNhY2hlQ2FudmFzLmhlaWdodCxlPTA7YT5lO2UrKyl0aGlzLmZpbHRlcnNbZV0uYXBwbHlGaWx0ZXIoYiwwLDAsYyxkKX0sYi5fZ2V0RmlsdGVyQm91bmRzPWZ1bmN0aW9uKGEpe3ZhciBiLGM9dGhpcy5maWx0ZXJzLGQ9dGhpcy5fcmVjdGFuZ2xlLnNldFZhbHVlcygwLDAsMCwwKTtpZighY3x8IShiPWMubGVuZ3RoKSlyZXR1cm4gZDtmb3IodmFyIGU9MDtiPmU7ZSsrKXt2YXIgZj10aGlzLmZpbHRlcnNbZV07Zi5nZXRCb3VuZHMmJmYuZ2V0Qm91bmRzKGQpfXJldHVybiBkfSxiLl9nZXRCb3VuZHM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5fdHJhbnNmb3JtQm91bmRzKHRoaXMuZ2V0Qm91bmRzKCksYSxiKX0sYi5fdHJhbnNmb3JtQm91bmRzPWZ1bmN0aW9uKGEsYixjKXtpZighYSlyZXR1cm4gYTt2YXIgZD1hLngsZT1hLnksZj1hLndpZHRoLGc9YS5oZWlnaHQsaD10aGlzLl9wcm9wcy5tYXRyaXg7aD1jP2guaWRlbnRpdHkoKTp0aGlzLmdldE1hdHJpeChoKSwoZHx8ZSkmJmguYXBwZW5kVHJhbnNmb3JtKDAsMCwxLDEsMCwwLDAsLWQsLWUpLGImJmgucHJlcGVuZE1hdHJpeChiKTt2YXIgaT1mKmguYSxqPWYqaC5iLGs9ZypoLmMsbD1nKmguZCxtPWgudHgsbj1oLnR5LG89bSxwPW0scT1uLHI9bjtyZXR1cm4oZD1pK20pPG8/bz1kOmQ+cCYmKHA9ZCksKGQ9aStrK20pPG8/bz1kOmQ+cCYmKHA9ZCksKGQ9ayttKTxvP289ZDpkPnAmJihwPWQpLChlPWorbik8cT9xPWU6ZT5yJiYocj1lKSwoZT1qK2wrbik8cT9xPWU6ZT5yJiYocj1lKSwoZT1sK24pPHE/cT1lOmU+ciYmKHI9ZSksYS5zZXRWYWx1ZXMobyxxLHAtbyxyLXEpfSxiLl9oYXNNb3VzZUV2ZW50TGlzdGVuZXI9ZnVuY3Rpb24oKXtmb3IodmFyIGI9YS5fTU9VU0VfRVZFTlRTLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspaWYodGhpcy5oYXNFdmVudExpc3RlbmVyKGJbY10pKXJldHVybiEwO3JldHVybiEhdGhpcy5jdXJzb3J9LGNyZWF0ZWpzLkRpc3BsYXlPYmplY3Q9Y3JlYXRlanMucHJvbW90ZShhLFwiRXZlbnREaXNwYXRjaGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhpcy5EaXNwbGF5T2JqZWN0X2NvbnN0cnVjdG9yKCksdGhpcy5jaGlsZHJlbj1bXSx0aGlzLm1vdXNlQ2hpbGRyZW49ITAsdGhpcy50aWNrQ2hpbGRyZW49ITB9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRGlzcGxheU9iamVjdCk7Yi5nZXROdW1DaGlsZHJlbj1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNoaWxkcmVuLmxlbmd0aH07dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGIse251bUNoaWxkcmVuOntnZXQ6Yi5nZXROdW1DaGlsZHJlbn19KX1jYXRjaChjKXt9Yi5pbml0aWFsaXplPWEsYi5pc1Zpc2libGU9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNhY2hlQ2FudmFzfHx0aGlzLmNoaWxkcmVuLmxlbmd0aDtyZXR1cm4hISh0aGlzLnZpc2libGUmJnRoaXMuYWxwaGE+MCYmMCE9dGhpcy5zY2FsZVgmJjAhPXRoaXMuc2NhbGVZJiZhKX0sYi5kcmF3PWZ1bmN0aW9uKGEsYil7aWYodGhpcy5EaXNwbGF5T2JqZWN0X2RyYXcoYSxiKSlyZXR1cm4hMDtmb3IodmFyIGM9dGhpcy5jaGlsZHJlbi5zbGljZSgpLGQ9MCxlPWMubGVuZ3RoO2U+ZDtkKyspe3ZhciBmPWNbZF07Zi5pc1Zpc2libGUoKSYmKGEuc2F2ZSgpLGYudXBkYXRlQ29udGV4dChhKSxmLmRyYXcoYSksYS5yZXN0b3JlKCkpfXJldHVybiEwfSxiLmFkZENoaWxkPWZ1bmN0aW9uKGEpe2lmKG51bGw9PWEpcmV0dXJuIGE7dmFyIGI9YXJndW1lbnRzLmxlbmd0aDtpZihiPjEpe2Zvcih2YXIgYz0wO2I+YztjKyspdGhpcy5hZGRDaGlsZChhcmd1bWVudHNbY10pO3JldHVybiBhcmd1bWVudHNbYi0xXX1yZXR1cm4gYS5wYXJlbnQmJmEucGFyZW50LnJlbW92ZUNoaWxkKGEpLGEucGFyZW50PXRoaXMsdGhpcy5jaGlsZHJlbi5wdXNoKGEpLGEuZGlzcGF0Y2hFdmVudChcImFkZGVkXCIpLGF9LGIuYWRkQ2hpbGRBdD1mdW5jdGlvbihhLGIpe3ZhciBjPWFyZ3VtZW50cy5sZW5ndGgsZD1hcmd1bWVudHNbYy0xXTtpZigwPmR8fGQ+dGhpcy5jaGlsZHJlbi5sZW5ndGgpcmV0dXJuIGFyZ3VtZW50c1tjLTJdO2lmKGM+Mil7Zm9yKHZhciBlPTA7Yy0xPmU7ZSsrKXRoaXMuYWRkQ2hpbGRBdChhcmd1bWVudHNbZV0sZCtlKTtyZXR1cm4gYXJndW1lbnRzW2MtMl19cmV0dXJuIGEucGFyZW50JiZhLnBhcmVudC5yZW1vdmVDaGlsZChhKSxhLnBhcmVudD10aGlzLHRoaXMuY2hpbGRyZW4uc3BsaWNlKGIsMCxhKSxhLmRpc3BhdGNoRXZlbnQoXCJhZGRlZFwiKSxhfSxiLnJlbW92ZUNoaWxkPWZ1bmN0aW9uKGEpe3ZhciBiPWFyZ3VtZW50cy5sZW5ndGg7aWYoYj4xKXtmb3IodmFyIGM9ITAsZD0wO2I+ZDtkKyspYz1jJiZ0aGlzLnJlbW92ZUNoaWxkKGFyZ3VtZW50c1tkXSk7cmV0dXJuIGN9cmV0dXJuIHRoaXMucmVtb3ZlQ2hpbGRBdChjcmVhdGVqcy5pbmRleE9mKHRoaXMuY2hpbGRyZW4sYSkpfSxiLnJlbW92ZUNoaWxkQXQ9ZnVuY3Rpb24oYSl7dmFyIGI9YXJndW1lbnRzLmxlbmd0aDtpZihiPjEpe2Zvcih2YXIgYz1bXSxkPTA7Yj5kO2QrKyljW2RdPWFyZ3VtZW50c1tkXTtjLnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gYi1hfSk7Zm9yKHZhciBlPSEwLGQ9MDtiPmQ7ZCsrKWU9ZSYmdGhpcy5yZW1vdmVDaGlsZEF0KGNbZF0pO3JldHVybiBlfWlmKDA+YXx8YT50aGlzLmNoaWxkcmVuLmxlbmd0aC0xKXJldHVybiExO3ZhciBmPXRoaXMuY2hpbGRyZW5bYV07cmV0dXJuIGYmJihmLnBhcmVudD1udWxsKSx0aGlzLmNoaWxkcmVuLnNwbGljZShhLDEpLGYuZGlzcGF0Y2hFdmVudChcInJlbW92ZWRcIiksITB9LGIucmVtb3ZlQWxsQ2hpbGRyZW49ZnVuY3Rpb24oKXtmb3IodmFyIGE9dGhpcy5jaGlsZHJlbjthLmxlbmd0aDspdGhpcy5yZW1vdmVDaGlsZEF0KDApfSxiLmdldENoaWxkQXQ9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuY2hpbGRyZW5bYV19LGIuZ2V0Q2hpbGRCeU5hbWU9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPXRoaXMuY2hpbGRyZW4sYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKylpZihiW2NdLm5hbWU9PWEpcmV0dXJuIGJbY107cmV0dXJuIG51bGx9LGIuc29ydENoaWxkcmVuPWZ1bmN0aW9uKGEpe3RoaXMuY2hpbGRyZW4uc29ydChhKX0sYi5nZXRDaGlsZEluZGV4PWZ1bmN0aW9uKGEpe3JldHVybiBjcmVhdGVqcy5pbmRleE9mKHRoaXMuY2hpbGRyZW4sYSl9LGIuc3dhcENoaWxkcmVuQXQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmNoaWxkcmVuLGQ9Y1thXSxlPWNbYl07ZCYmZSYmKGNbYV09ZSxjW2JdPWQpfSxiLnN3YXBDaGlsZHJlbj1mdW5jdGlvbihhLGIpe2Zvcih2YXIgYyxkLGU9dGhpcy5jaGlsZHJlbixmPTAsZz1lLmxlbmd0aDtnPmYmJihlW2ZdPT1hJiYoYz1mKSxlW2ZdPT1iJiYoZD1mKSxudWxsPT1jfHxudWxsPT1kKTtmKyspO2YhPWcmJihlW2NdPWIsZVtkXT1hKX0sYi5zZXRDaGlsZEluZGV4PWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5jaGlsZHJlbixkPWMubGVuZ3RoO2lmKCEoYS5wYXJlbnQhPXRoaXN8fDA+Ynx8Yj49ZCkpe2Zvcih2YXIgZT0wO2Q+ZSYmY1tlXSE9YTtlKyspO2UhPWQmJmUhPWImJihjLnNwbGljZShlLDEpLGMuc3BsaWNlKGIsMCxhKSl9fSxiLmNvbnRhaW5zPWZ1bmN0aW9uKGEpe2Zvcig7YTspe2lmKGE9PXRoaXMpcmV0dXJuITA7YT1hLnBhcmVudH1yZXR1cm4hMX0sYi5oaXRUZXN0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIG51bGwhPXRoaXMuZ2V0T2JqZWN0VW5kZXJQb2ludChhLGIpfSxiLmdldE9iamVjdHNVbmRlclBvaW50PWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1bXSxlPXRoaXMubG9jYWxUb0dsb2JhbChhLGIpO3JldHVybiB0aGlzLl9nZXRPYmplY3RzVW5kZXJQb2ludChlLngsZS55LGQsYz4wLDE9PWMpLGR9LGIuZ2V0T2JqZWN0VW5kZXJQb2ludD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5sb2NhbFRvR2xvYmFsKGEsYik7cmV0dXJuIHRoaXMuX2dldE9iamVjdHNVbmRlclBvaW50KGQueCxkLnksbnVsbCxjPjAsMT09Yyl9LGIuZ2V0Qm91bmRzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2dldEJvdW5kcyhudWxsLCEwKX0sYi5nZXRUcmFuc2Zvcm1lZEJvdW5kcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9nZXRCb3VuZHMoKX0sYi5jbG9uZT1mdW5jdGlvbihiKXt2YXIgYz10aGlzLl9jbG9uZVByb3BzKG5ldyBhKTtyZXR1cm4gYiYmdGhpcy5fY2xvbmVDaGlsZHJlbihjKSxjfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbQ29udGFpbmVyIChuYW1lPVwiK3RoaXMubmFtZStcIildXCJ9LGIuX3RpY2s9ZnVuY3Rpb24oYSl7aWYodGhpcy50aWNrQ2hpbGRyZW4pZm9yKHZhciBiPXRoaXMuY2hpbGRyZW4ubGVuZ3RoLTE7Yj49MDtiLS0pe3ZhciBjPXRoaXMuY2hpbGRyZW5bYl07Yy50aWNrRW5hYmxlZCYmYy5fdGljayYmYy5fdGljayhhKX10aGlzLkRpc3BsYXlPYmplY3RfX3RpY2soYSl9LGIuX2Nsb25lQ2hpbGRyZW49ZnVuY3Rpb24oYSl7YS5jaGlsZHJlbi5sZW5ndGgmJmEucmVtb3ZlQWxsQ2hpbGRyZW4oKTtmb3IodmFyIGI9YS5jaGlsZHJlbixjPTAsZD10aGlzLmNoaWxkcmVuLmxlbmd0aDtkPmM7YysrKXt2YXIgZT10aGlzLmNoaWxkcmVuW2NdLmNsb25lKCEwKTtlLnBhcmVudD1hLGIucHVzaChlKX19LGIuX2dldE9iamVjdHNVbmRlclBvaW50PWZ1bmN0aW9uKGIsYyxkLGUsZixnKXtpZihnPWd8fDAsIWcmJiF0aGlzLl90ZXN0TWFzayh0aGlzLGIsYykpcmV0dXJuIG51bGw7dmFyIGgsaT1jcmVhdGVqcy5EaXNwbGF5T2JqZWN0Ll9oaXRUZXN0Q29udGV4dDtmPWZ8fGUmJnRoaXMuX2hhc01vdXNlRXZlbnRMaXN0ZW5lcigpO2Zvcih2YXIgaj10aGlzLmNoaWxkcmVuLGs9ai5sZW5ndGgsbD1rLTE7bD49MDtsLS0pe3ZhciBtPWpbbF0sbj1tLmhpdEFyZWE7aWYobS52aXNpYmxlJiYobnx8bS5pc1Zpc2libGUoKSkmJighZXx8bS5tb3VzZUVuYWJsZWQpJiYobnx8dGhpcy5fdGVzdE1hc2sobSxiLGMpKSlpZighbiYmbSBpbnN0YW5jZW9mIGEpe3ZhciBvPW0uX2dldE9iamVjdHNVbmRlclBvaW50KGIsYyxkLGUsZixnKzEpO2lmKCFkJiZvKXJldHVybiBlJiYhdGhpcy5tb3VzZUNoaWxkcmVuP3RoaXM6b31lbHNle2lmKGUmJiFmJiYhbS5faGFzTW91c2VFdmVudExpc3RlbmVyKCkpY29udGludWU7dmFyIHA9bS5nZXRDb25jYXRlbmF0ZWREaXNwbGF5UHJvcHMobS5fcHJvcHMpO2lmKGg9cC5tYXRyaXgsbiYmKGguYXBwZW5kTWF0cml4KG4uZ2V0TWF0cml4KG4uX3Byb3BzLm1hdHJpeCkpLHAuYWxwaGE9bi5hbHBoYSksaS5nbG9iYWxBbHBoYT1wLmFscGhhLGkuc2V0VHJhbnNmb3JtKGguYSxoLmIsaC5jLGguZCxoLnR4LWIsaC50eS1jKSwobnx8bSkuZHJhdyhpKSwhdGhpcy5fdGVzdEhpdChpKSljb250aW51ZTtpZihpLnNldFRyYW5zZm9ybSgxLDAsMCwxLDAsMCksaS5jbGVhclJlY3QoMCwwLDIsMiksIWQpcmV0dXJuIGUmJiF0aGlzLm1vdXNlQ2hpbGRyZW4/dGhpczptO2QucHVzaChtKX19cmV0dXJuIG51bGx9LGIuX3Rlc3RNYXNrPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1hLm1hc2s7aWYoIWR8fCFkLmdyYXBoaWNzfHxkLmdyYXBoaWNzLmlzRW1wdHkoKSlyZXR1cm4hMDt2YXIgZT10aGlzLl9wcm9wcy5tYXRyaXgsZj1hLnBhcmVudDtlPWY/Zi5nZXRDb25jYXRlbmF0ZWRNYXRyaXgoZSk6ZS5pZGVudGl0eSgpLGU9ZC5nZXRNYXRyaXgoZC5fcHJvcHMubWF0cml4KS5wcmVwZW5kTWF0cml4KGUpO3ZhciBnPWNyZWF0ZWpzLkRpc3BsYXlPYmplY3QuX2hpdFRlc3RDb250ZXh0O3JldHVybiBnLnNldFRyYW5zZm9ybShlLmEsZS5iLGUuYyxlLmQsZS50eC1iLGUudHktYyksZC5ncmFwaGljcy5kcmF3QXNQYXRoKGcpLGcuZmlsbFN0eWxlPVwiIzAwMFwiLGcuZmlsbCgpLHRoaXMuX3Rlc3RIaXQoZyk/KGcuc2V0VHJhbnNmb3JtKDEsMCwwLDEsMCwwKSxnLmNsZWFyUmVjdCgwLDAsMiwyKSwhMCk6ITF9LGIuX2dldEJvdW5kcz1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuRGlzcGxheU9iamVjdF9nZXRCb3VuZHMoKTtpZihjKXJldHVybiB0aGlzLl90cmFuc2Zvcm1Cb3VuZHMoYyxhLGIpO3ZhciBkPXRoaXMuX3Byb3BzLm1hdHJpeDtkPWI/ZC5pZGVudGl0eSgpOnRoaXMuZ2V0TWF0cml4KGQpLGEmJmQucHJlcGVuZE1hdHJpeChhKTtmb3IodmFyIGU9dGhpcy5jaGlsZHJlbi5sZW5ndGgsZj1udWxsLGc9MDtlPmc7ZysrKXt2YXIgaD10aGlzLmNoaWxkcmVuW2ddO2gudmlzaWJsZSYmKGM9aC5fZ2V0Qm91bmRzKGQpKSYmKGY/Zi5leHRlbmQoYy54LGMueSxjLndpZHRoLGMuaGVpZ2h0KTpmPWMuY2xvbmUoKSl9cmV0dXJuIGZ9LGNyZWF0ZWpzLkNvbnRhaW5lcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJEaXNwbGF5T2JqZWN0XCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuQ29udGFpbmVyX2NvbnN0cnVjdG9yKCksdGhpcy5hdXRvQ2xlYXI9ITAsdGhpcy5jYW52YXM9XCJzdHJpbmdcIj09dHlwZW9mIGE/ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYSk6YSx0aGlzLm1vdXNlWD0wLHRoaXMubW91c2VZPTAsdGhpcy5kcmF3UmVjdD1udWxsLHRoaXMuc25hcFRvUGl4ZWxFbmFibGVkPSExLHRoaXMubW91c2VJbkJvdW5kcz0hMSx0aGlzLnRpY2tPblVwZGF0ZT0hMCx0aGlzLm1vdXNlTW92ZU91dHNpZGU9ITEsdGhpcy5wcmV2ZW50U2VsZWN0aW9uPSEwLHRoaXMuX3BvaW50ZXJEYXRhPXt9LHRoaXMuX3BvaW50ZXJDb3VudD0wLHRoaXMuX3ByaW1hcnlQb2ludGVySUQ9bnVsbCx0aGlzLl9tb3VzZU92ZXJJbnRlcnZhbElEPW51bGwsdGhpcy5fbmV4dFN0YWdlPW51bGwsdGhpcy5fcHJldlN0YWdlPW51bGwsdGhpcy5lbmFibGVET01FdmVudHMoITApfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkNvbnRhaW5lcik7Yi5fZ2V0X25leHRTdGFnZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9uZXh0U3RhZ2V9LGIuX3NldF9uZXh0U3RhZ2U9ZnVuY3Rpb24oYSl7dGhpcy5fbmV4dFN0YWdlJiYodGhpcy5fbmV4dFN0YWdlLl9wcmV2U3RhZ2U9bnVsbCksYSYmKGEuX3ByZXZTdGFnZT10aGlzKSx0aGlzLl9uZXh0U3RhZ2U9YX07dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGIse25leHRTdGFnZTp7Z2V0OmIuX2dldF9uZXh0U3RhZ2Usc2V0OmIuX3NldF9uZXh0U3RhZ2V9fSl9Y2F0Y2goYyl7fWIudXBkYXRlPWZ1bmN0aW9uKGEpe2lmKHRoaXMuY2FudmFzJiYodGhpcy50aWNrT25VcGRhdGUmJnRoaXMudGljayhhKSx0aGlzLmRpc3BhdGNoRXZlbnQoXCJkcmF3c3RhcnRcIiwhMSwhMCkhPT0hMSkpe2NyZWF0ZWpzLkRpc3BsYXlPYmplY3QuX3NuYXBUb1BpeGVsRW5hYmxlZD10aGlzLnNuYXBUb1BpeGVsRW5hYmxlZDt2YXIgYj10aGlzLmRyYXdSZWN0LGM9dGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO2Muc2V0VHJhbnNmb3JtKDEsMCwwLDEsMCwwKSx0aGlzLmF1dG9DbGVhciYmKGI/Yy5jbGVhclJlY3QoYi54LGIueSxiLndpZHRoLGIuaGVpZ2h0KTpjLmNsZWFyUmVjdCgwLDAsdGhpcy5jYW52YXMud2lkdGgrMSx0aGlzLmNhbnZhcy5oZWlnaHQrMSkpLGMuc2F2ZSgpLHRoaXMuZHJhd1JlY3QmJihjLmJlZ2luUGF0aCgpLGMucmVjdChiLngsYi55LGIud2lkdGgsYi5oZWlnaHQpLGMuY2xpcCgpKSx0aGlzLnVwZGF0ZUNvbnRleHQoYyksdGhpcy5kcmF3KGMsITEpLGMucmVzdG9yZSgpLHRoaXMuZGlzcGF0Y2hFdmVudChcImRyYXdlbmRcIil9fSxiLnRpY2s9ZnVuY3Rpb24oYSl7aWYodGhpcy50aWNrRW5hYmxlZCYmdGhpcy5kaXNwYXRjaEV2ZW50KFwidGlja3N0YXJ0XCIsITEsITApIT09ITEpe3ZhciBiPW5ldyBjcmVhdGVqcy5FdmVudChcInRpY2tcIik7aWYoYSlmb3IodmFyIGMgaW4gYSlhLmhhc093blByb3BlcnR5KGMpJiYoYltjXT1hW2NdKTt0aGlzLl90aWNrKGIpLHRoaXMuZGlzcGF0Y2hFdmVudChcInRpY2tlbmRcIil9fSxiLmhhbmRsZUV2ZW50PWZ1bmN0aW9uKGEpe1widGlja1wiPT1hLnR5cGUmJnRoaXMudXBkYXRlKGEpfSxiLmNsZWFyPWZ1bmN0aW9uKCl7aWYodGhpcy5jYW52YXMpe3ZhciBhPXRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTthLnNldFRyYW5zZm9ybSgxLDAsMCwxLDAsMCksYS5jbGVhclJlY3QoMCwwLHRoaXMuY2FudmFzLndpZHRoKzEsdGhpcy5jYW52YXMuaGVpZ2h0KzEpfX0sYi50b0RhdGFVUkw9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPXRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSxlPXRoaXMuY2FudmFzLndpZHRoLGY9dGhpcy5jYW52YXMuaGVpZ2h0O2lmKGEpe2M9ZC5nZXRJbWFnZURhdGEoMCwwLGUsZik7dmFyIGc9ZC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb247ZC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb249XCJkZXN0aW5hdGlvbi1vdmVyXCIsZC5maWxsU3R5bGU9YSxkLmZpbGxSZWN0KDAsMCxlLGYpfXZhciBoPXRoaXMuY2FudmFzLnRvRGF0YVVSTChifHxcImltYWdlL3BuZ1wiKTtyZXR1cm4gYSYmKGQucHV0SW1hZ2VEYXRhKGMsMCwwKSxkLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbj1nKSxofSxiLmVuYWJsZU1vdXNlT3Zlcj1mdW5jdGlvbihhKXtpZih0aGlzLl9tb3VzZU92ZXJJbnRlcnZhbElEJiYoY2xlYXJJbnRlcnZhbCh0aGlzLl9tb3VzZU92ZXJJbnRlcnZhbElEKSx0aGlzLl9tb3VzZU92ZXJJbnRlcnZhbElEPW51bGwsMD09YSYmdGhpcy5fdGVzdE1vdXNlT3ZlcighMCkpLG51bGw9PWEpYT0yMDtlbHNlIGlmKDA+PWEpcmV0dXJuO3ZhciBiPXRoaXM7dGhpcy5fbW91c2VPdmVySW50ZXJ2YWxJRD1zZXRJbnRlcnZhbChmdW5jdGlvbigpe2IuX3Rlc3RNb3VzZU92ZXIoKX0sMWUzL01hdGgubWluKDUwLGEpKX0sYi5lbmFibGVET01FdmVudHM9ZnVuY3Rpb24oYSl7bnVsbD09YSYmKGE9ITApO3ZhciBiLGMsZD10aGlzLl9ldmVudExpc3RlbmVycztpZighYSYmZCl7Zm9yKGIgaW4gZCljPWRbYl0sYy50LnJlbW92ZUV2ZW50TGlzdGVuZXIoYixjLmYsITEpO3RoaXMuX2V2ZW50TGlzdGVuZXJzPW51bGx9ZWxzZSBpZihhJiYhZCYmdGhpcy5jYW52YXMpe3ZhciBlPXdpbmRvdy5hZGRFdmVudExpc3RlbmVyP3dpbmRvdzpkb2N1bWVudCxmPXRoaXM7ZD10aGlzLl9ldmVudExpc3RlbmVycz17fSxkLm1vdXNldXA9e3Q6ZSxmOmZ1bmN0aW9uKGEpe2YuX2hhbmRsZU1vdXNlVXAoYSl9fSxkLm1vdXNlbW92ZT17dDplLGY6ZnVuY3Rpb24oYSl7Zi5faGFuZGxlTW91c2VNb3ZlKGEpfX0sZC5kYmxjbGljaz17dDp0aGlzLmNhbnZhcyxmOmZ1bmN0aW9uKGEpe2YuX2hhbmRsZURvdWJsZUNsaWNrKGEpfX0sZC5tb3VzZWRvd249e3Q6dGhpcy5jYW52YXMsZjpmdW5jdGlvbihhKXtmLl9oYW5kbGVNb3VzZURvd24oYSl9fTtmb3IoYiBpbiBkKWM9ZFtiXSxjLnQuYWRkRXZlbnRMaXN0ZW5lcihiLGMuZiwhMSl9fSxiLmNsb25lPWZ1bmN0aW9uKCl7dGhyb3dcIlN0YWdlIGNhbm5vdCBiZSBjbG9uZWQuXCJ9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltTdGFnZSAobmFtZT1cIit0aGlzLm5hbWUrXCIpXVwifSxiLl9nZXRFbGVtZW50UmVjdD1mdW5jdGlvbihhKXt2YXIgYjt0cnl7Yj1hLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpfWNhdGNoKGMpe2I9e3RvcDphLm9mZnNldFRvcCxsZWZ0OmEub2Zmc2V0TGVmdCx3aWR0aDphLm9mZnNldFdpZHRoLGhlaWdodDphLm9mZnNldEhlaWdodH19dmFyIGQ9KHdpbmRvdy5wYWdlWE9mZnNldHx8ZG9jdW1lbnQuc2Nyb2xsTGVmdHx8MCktKGRvY3VtZW50LmNsaWVudExlZnR8fGRvY3VtZW50LmJvZHkuY2xpZW50TGVmdHx8MCksZT0od2luZG93LnBhZ2VZT2Zmc2V0fHxkb2N1bWVudC5zY3JvbGxUb3B8fDApLShkb2N1bWVudC5jbGllbnRUb3B8fGRvY3VtZW50LmJvZHkuY2xpZW50VG9wfHwwKSxmPXdpbmRvdy5nZXRDb21wdXRlZFN0eWxlP2dldENvbXB1dGVkU3R5bGUoYSxudWxsKTphLmN1cnJlbnRTdHlsZSxnPXBhcnNlSW50KGYucGFkZGluZ0xlZnQpK3BhcnNlSW50KGYuYm9yZGVyTGVmdFdpZHRoKSxoPXBhcnNlSW50KGYucGFkZGluZ1RvcCkrcGFyc2VJbnQoZi5ib3JkZXJUb3BXaWR0aCksaT1wYXJzZUludChmLnBhZGRpbmdSaWdodCkrcGFyc2VJbnQoZi5ib3JkZXJSaWdodFdpZHRoKSxqPXBhcnNlSW50KGYucGFkZGluZ0JvdHRvbSkrcGFyc2VJbnQoZi5ib3JkZXJCb3R0b21XaWR0aCk7cmV0dXJue2xlZnQ6Yi5sZWZ0K2QrZyxyaWdodDpiLnJpZ2h0K2QtaSx0b3A6Yi50b3ArZStoLGJvdHRvbTpiLmJvdHRvbStlLWp9fSxiLl9nZXRQb2ludGVyRGF0YT1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9wb2ludGVyRGF0YVthXTtyZXR1cm4gYnx8KGI9dGhpcy5fcG9pbnRlckRhdGFbYV09e3g6MCx5OjB9KSxifSxiLl9oYW5kbGVNb3VzZU1vdmU9ZnVuY3Rpb24oYSl7YXx8KGE9d2luZG93LmV2ZW50KSx0aGlzLl9oYW5kbGVQb2ludGVyTW92ZSgtMSxhLGEucGFnZVgsYS5wYWdlWSl9LGIuX2hhbmRsZVBvaW50ZXJNb3ZlPWZ1bmN0aW9uKGEsYixjLGQsZSl7aWYoKCF0aGlzLl9wcmV2U3RhZ2V8fHZvaWQgMCE9PWUpJiZ0aGlzLmNhbnZhcyl7dmFyIGY9dGhpcy5fbmV4dFN0YWdlLGc9dGhpcy5fZ2V0UG9pbnRlckRhdGEoYSksaD1nLmluQm91bmRzO3RoaXMuX3VwZGF0ZVBvaW50ZXJQb3NpdGlvbihhLGIsYyxkKSwoaHx8Zy5pbkJvdW5kc3x8dGhpcy5tb3VzZU1vdmVPdXRzaWRlKSYmKC0xPT09YSYmZy5pbkJvdW5kcz09IWgmJnRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudCh0aGlzLGg/XCJtb3VzZWxlYXZlXCI6XCJtb3VzZWVudGVyXCIsITEsYSxnLGIpLHRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudCh0aGlzLFwic3RhZ2Vtb3VzZW1vdmVcIiwhMSxhLGcsYiksdGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KGcudGFyZ2V0LFwicHJlc3Ntb3ZlXCIsITAsYSxnLGIpKSxmJiZmLl9oYW5kbGVQb2ludGVyTW92ZShhLGIsYyxkLG51bGwpfX0sYi5fdXBkYXRlUG9pbnRlclBvc2l0aW9uPWZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPXRoaXMuX2dldEVsZW1lbnRSZWN0KHRoaXMuY2FudmFzKTtjLT1lLmxlZnQsZC09ZS50b3A7dmFyIGY9dGhpcy5jYW52YXMud2lkdGgsZz10aGlzLmNhbnZhcy5oZWlnaHQ7Yy89KGUucmlnaHQtZS5sZWZ0KS9mLGQvPShlLmJvdHRvbS1lLnRvcCkvZzt2YXIgaD10aGlzLl9nZXRQb2ludGVyRGF0YShhKTsoaC5pbkJvdW5kcz1jPj0wJiZkPj0wJiZmLTE+PWMmJmctMT49ZCk/KGgueD1jLGgueT1kKTp0aGlzLm1vdXNlTW92ZU91dHNpZGUmJihoLng9MD5jPzA6Yz5mLTE/Zi0xOmMsaC55PTA+ZD8wOmQ+Zy0xP2ctMTpkKSxoLnBvc0V2dE9iaj1iLGgucmF3WD1jLGgucmF3WT1kLChhPT09dGhpcy5fcHJpbWFyeVBvaW50ZXJJRHx8LTE9PT1hKSYmKHRoaXMubW91c2VYPWgueCx0aGlzLm1vdXNlWT1oLnksdGhpcy5tb3VzZUluQm91bmRzPWguaW5Cb3VuZHMpfSxiLl9oYW5kbGVNb3VzZVVwPWZ1bmN0aW9uKGEpe3RoaXMuX2hhbmRsZVBvaW50ZXJVcCgtMSxhLCExKX0sYi5faGFuZGxlUG9pbnRlclVwPWZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPXRoaXMuX25leHRTdGFnZSxmPXRoaXMuX2dldFBvaW50ZXJEYXRhKGEpO2lmKCF0aGlzLl9wcmV2U3RhZ2V8fHZvaWQgMCE9PWQpe3ZhciBnPW51bGwsaD1mLnRhcmdldDtkfHwhaCYmIWV8fChnPXRoaXMuX2dldE9iamVjdHNVbmRlclBvaW50KGYueCxmLnksbnVsbCwhMCkpLGYuZG93biYmKHRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudCh0aGlzLFwic3RhZ2Vtb3VzZXVwXCIsITEsYSxmLGIsZyksZi5kb3duPSExKSxnPT1oJiZ0aGlzLl9kaXNwYXRjaE1vdXNlRXZlbnQoaCxcImNsaWNrXCIsITAsYSxmLGIpLHRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudChoLFwicHJlc3N1cFwiLCEwLGEsZixiKSxjPyhhPT10aGlzLl9wcmltYXJ5UG9pbnRlcklEJiYodGhpcy5fcHJpbWFyeVBvaW50ZXJJRD1udWxsKSxkZWxldGUgdGhpcy5fcG9pbnRlckRhdGFbYV0pOmYudGFyZ2V0PW51bGwsZSYmZS5faGFuZGxlUG9pbnRlclVwKGEsYixjLGR8fGcmJnRoaXMpfX0sYi5faGFuZGxlTW91c2VEb3duPWZ1bmN0aW9uKGEpe3RoaXMuX2hhbmRsZVBvaW50ZXJEb3duKC0xLGEsYS5wYWdlWCxhLnBhZ2VZKX0sYi5faGFuZGxlUG9pbnRlckRvd249ZnVuY3Rpb24oYSxiLGMsZCxlKXt0aGlzLnByZXZlbnRTZWxlY3Rpb24mJmIucHJldmVudERlZmF1bHQoKSwobnVsbD09dGhpcy5fcHJpbWFyeVBvaW50ZXJJRHx8LTE9PT1hKSYmKHRoaXMuX3ByaW1hcnlQb2ludGVySUQ9YSksbnVsbCE9ZCYmdGhpcy5fdXBkYXRlUG9pbnRlclBvc2l0aW9uKGEsYixjLGQpO3ZhciBmPW51bGwsZz10aGlzLl9uZXh0U3RhZ2UsaD10aGlzLl9nZXRQb2ludGVyRGF0YShhKTtlfHwoZj1oLnRhcmdldD10aGlzLl9nZXRPYmplY3RzVW5kZXJQb2ludChoLngsaC55LG51bGwsITApKSxoLmluQm91bmRzJiYodGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KHRoaXMsXCJzdGFnZW1vdXNlZG93blwiLCExLGEsaCxiLGYpLGguZG93bj0hMCksdGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KGYsXCJtb3VzZWRvd25cIiwhMCxhLGgsYiksZyYmZy5faGFuZGxlUG9pbnRlckRvd24oYSxiLGMsZCxlfHxmJiZ0aGlzKX0sYi5fdGVzdE1vdXNlT3Zlcj1mdW5jdGlvbihhLGIsYyl7aWYoIXRoaXMuX3ByZXZTdGFnZXx8dm9pZCAwIT09Yil7dmFyIGQ9dGhpcy5fbmV4dFN0YWdlO2lmKCF0aGlzLl9tb3VzZU92ZXJJbnRlcnZhbElEKXJldHVybiB2b2lkKGQmJmQuX3Rlc3RNb3VzZU92ZXIoYSxiLGMpKTt2YXIgZT10aGlzLl9nZXRQb2ludGVyRGF0YSgtMSk7aWYoZSYmKGF8fHRoaXMubW91c2VYIT10aGlzLl9tb3VzZU92ZXJYfHx0aGlzLm1vdXNlWSE9dGhpcy5fbW91c2VPdmVyWXx8IXRoaXMubW91c2VJbkJvdW5kcykpe3ZhciBmLGcsaCxpPWUucG9zRXZ0T2JqLGo9Y3x8aSYmaS50YXJnZXQ9PXRoaXMuY2FudmFzLGs9bnVsbCxsPS0xLG09XCJcIjshYiYmKGF8fHRoaXMubW91c2VJbkJvdW5kcyYmaikmJihrPXRoaXMuX2dldE9iamVjdHNVbmRlclBvaW50KHRoaXMubW91c2VYLHRoaXMubW91c2VZLG51bGwsITApLHRoaXMuX21vdXNlT3Zlclg9dGhpcy5tb3VzZVgsdGhpcy5fbW91c2VPdmVyWT10aGlzLm1vdXNlWSk7dmFyIG49dGhpcy5fbW91c2VPdmVyVGFyZ2V0fHxbXSxvPW5bbi5sZW5ndGgtMV0scD10aGlzLl9tb3VzZU92ZXJUYXJnZXQ9W107Zm9yKGY9aztmOylwLnVuc2hpZnQoZiksbXx8KG09Zi5jdXJzb3IpLGY9Zi5wYXJlbnQ7Zm9yKHRoaXMuY2FudmFzLnN0eWxlLmN1cnNvcj1tLCFiJiZjJiYoYy5jYW52YXMuc3R5bGUuY3Vyc29yPW0pLGc9MCxoPXAubGVuZ3RoO2g+ZyYmcFtnXT09bltnXTtnKyspbD1nO2ZvcihvIT1rJiZ0aGlzLl9kaXNwYXRjaE1vdXNlRXZlbnQobyxcIm1vdXNlb3V0XCIsITAsLTEsZSxpLGspLGc9bi5sZW5ndGgtMTtnPmw7Zy0tKXRoaXMuX2Rpc3BhdGNoTW91c2VFdmVudChuW2ddLFwicm9sbG91dFwiLCExLC0xLGUsaSxrKTtmb3IoZz1wLmxlbmd0aC0xO2c+bDtnLS0pdGhpcy5fZGlzcGF0Y2hNb3VzZUV2ZW50KHBbZ10sXCJyb2xsb3ZlclwiLCExLC0xLGUsaSxvKTtvIT1rJiZ0aGlzLl9kaXNwYXRjaE1vdXNlRXZlbnQoayxcIm1vdXNlb3ZlclwiLCEwLC0xLGUsaSxvKSxkJiZkLl90ZXN0TW91c2VPdmVyKGEsYnx8ayYmdGhpcyxjfHxqJiZ0aGlzKX19fSxiLl9oYW5kbGVEb3VibGVDbGljaz1mdW5jdGlvbihhLGIpe3ZhciBjPW51bGwsZD10aGlzLl9uZXh0U3RhZ2UsZT10aGlzLl9nZXRQb2ludGVyRGF0YSgtMSk7Ynx8KGM9dGhpcy5fZ2V0T2JqZWN0c1VuZGVyUG9pbnQoZS54LGUueSxudWxsLCEwKSx0aGlzLl9kaXNwYXRjaE1vdXNlRXZlbnQoYyxcImRibGNsaWNrXCIsITAsLTEsZSxhKSksZCYmZC5faGFuZGxlRG91YmxlQ2xpY2soYSxifHxjJiZ0aGlzKX0sYi5fZGlzcGF0Y2hNb3VzZUV2ZW50PWZ1bmN0aW9uKGEsYixjLGQsZSxmLGcpe2lmKGEmJihjfHxhLmhhc0V2ZW50TGlzdGVuZXIoYikpKXt2YXIgaD1uZXcgY3JlYXRlanMuTW91c2VFdmVudChiLGMsITEsZS54LGUueSxmLGQsZD09PXRoaXMuX3ByaW1hcnlQb2ludGVySUR8fC0xPT09ZCxlLnJhd1gsZS5yYXdZLGcpO2EuZGlzcGF0Y2hFdmVudChoKX19LGNyZWF0ZWpzLlN0YWdlPWNyZWF0ZWpzLnByb21vdGUoYSxcIkNvbnRhaW5lclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShhKXt0aGlzLkRpc3BsYXlPYmplY3RfY29uc3RydWN0b3IoKSxcInN0cmluZ1wiPT10eXBlb2YgYT8odGhpcy5pbWFnZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpLHRoaXMuaW1hZ2Uuc3JjPWEpOnRoaXMuaW1hZ2U9YSx0aGlzLnNvdXJjZVJlY3Q9bnVsbH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5EaXNwbGF5T2JqZWN0KTtiLmluaXRpYWxpemU9YSxiLmlzVmlzaWJsZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMuaW1hZ2UsYj10aGlzLmNhY2hlQ2FudmFzfHxhJiYoYS5uYXR1cmFsV2lkdGh8fGEuZ2V0Q29udGV4dHx8YS5yZWFkeVN0YXRlPj0yKTtyZXR1cm4hISh0aGlzLnZpc2libGUmJnRoaXMuYWxwaGE+MCYmMCE9dGhpcy5zY2FsZVgmJjAhPXRoaXMuc2NhbGVZJiZiKX0sYi5kcmF3PWZ1bmN0aW9uKGEsYil7aWYodGhpcy5EaXNwbGF5T2JqZWN0X2RyYXcoYSxiKXx8IXRoaXMuaW1hZ2UpcmV0dXJuITA7dmFyIGM9dGhpcy5pbWFnZSxkPXRoaXMuc291cmNlUmVjdDtpZihkKXt2YXIgZT1kLngsZj1kLnksZz1lK2Qud2lkdGgsaD1mK2QuaGVpZ2h0LGk9MCxqPTAsaz1jLndpZHRoLGw9Yy5oZWlnaHQ7MD5lJiYoaS09ZSxlPTApLGc+ayYmKGc9ayksMD5mJiYoai09ZixmPTApLGg+bCYmKGg9bCksYS5kcmF3SW1hZ2UoYyxlLGYsZy1lLGgtZixpLGosZy1lLGgtZil9ZWxzZSBhLmRyYXdJbWFnZShjLDAsMCk7cmV0dXJuITB9LGIuZ2V0Qm91bmRzPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5EaXNwbGF5T2JqZWN0X2dldEJvdW5kcygpO2lmKGEpcmV0dXJuIGE7dmFyIGI9dGhpcy5pbWFnZSxjPXRoaXMuc291cmNlUmVjdHx8YixkPWImJihiLm5hdHVyYWxXaWR0aHx8Yi5nZXRDb250ZXh0fHxiLnJlYWR5U3RhdGU+PTIpO3JldHVybiBkP3RoaXMuX3JlY3RhbmdsZS5zZXRWYWx1ZXMoMCwwLGMud2lkdGgsYy5oZWlnaHQpOm51bGx9LGIuY2xvbmU9ZnVuY3Rpb24oKXt2YXIgYj1uZXcgYSh0aGlzLmltYWdlKTtyZXR1cm4gdGhpcy5zb3VyY2VSZWN0JiYoYi5zb3VyY2VSZWN0PXRoaXMuc291cmNlUmVjdC5jbG9uZSgpKSx0aGlzLl9jbG9uZVByb3BzKGIpLGJ9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltCaXRtYXAgKG5hbWU9XCIrdGhpcy5uYW1lK1wiKV1cIn0sY3JlYXRlanMuQml0bWFwPWNyZWF0ZWpzLnByb21vdGUoYSxcIkRpc3BsYXlPYmplY3RcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiKXt0aGlzLkRpc3BsYXlPYmplY3RfY29uc3RydWN0b3IoKSx0aGlzLmN1cnJlbnRGcmFtZT0wLHRoaXMuY3VycmVudEFuaW1hdGlvbj1udWxsLHRoaXMucGF1c2VkPSEwLHRoaXMuc3ByaXRlU2hlZXQ9YSx0aGlzLmN1cnJlbnRBbmltYXRpb25GcmFtZT0wLHRoaXMuZnJhbWVyYXRlPTAsdGhpcy5fYW5pbWF0aW9uPW51bGwsdGhpcy5fY3VycmVudEZyYW1lPW51bGwsdGhpcy5fc2tpcEFkdmFuY2U9ITEsbnVsbCE9YiYmdGhpcy5nb3RvQW5kUGxheShiKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5EaXNwbGF5T2JqZWN0KTtiLmluaXRpYWxpemU9YSxiLmlzVmlzaWJsZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMuY2FjaGVDYW52YXN8fHRoaXMuc3ByaXRlU2hlZXQuY29tcGxldGU7cmV0dXJuISEodGhpcy52aXNpYmxlJiZ0aGlzLmFscGhhPjAmJjAhPXRoaXMuc2NhbGVYJiYwIT10aGlzLnNjYWxlWSYmYSl9LGIuZHJhdz1mdW5jdGlvbihhLGIpe2lmKHRoaXMuRGlzcGxheU9iamVjdF9kcmF3KGEsYikpcmV0dXJuITA7dGhpcy5fbm9ybWFsaXplRnJhbWUoKTt2YXIgYz10aGlzLnNwcml0ZVNoZWV0LmdldEZyYW1lKDB8dGhpcy5fY3VycmVudEZyYW1lKTtpZighYylyZXR1cm4hMTt2YXIgZD1jLnJlY3Q7cmV0dXJuIGQud2lkdGgmJmQuaGVpZ2h0JiZhLmRyYXdJbWFnZShjLmltYWdlLGQueCxkLnksZC53aWR0aCxkLmhlaWdodCwtYy5yZWdYLC1jLnJlZ1ksZC53aWR0aCxkLmhlaWdodCksITB9LGIucGxheT1mdW5jdGlvbigpe3RoaXMucGF1c2VkPSExfSxiLnN0b3A9ZnVuY3Rpb24oKXt0aGlzLnBhdXNlZD0hMH0sYi5nb3RvQW5kUGxheT1mdW5jdGlvbihhKXt0aGlzLnBhdXNlZD0hMSx0aGlzLl9za2lwQWR2YW5jZT0hMCx0aGlzLl9nb3RvKGEpfSxiLmdvdG9BbmRTdG9wPWZ1bmN0aW9uKGEpe3RoaXMucGF1c2VkPSEwLHRoaXMuX2dvdG8oYSl9LGIuYWR2YW5jZT1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmZyYW1lcmF0ZXx8dGhpcy5zcHJpdGVTaGVldC5mcmFtZXJhdGUsYz1iJiZudWxsIT1hP2EvKDFlMy9iKToxO3RoaXMuX25vcm1hbGl6ZUZyYW1lKGMpfSxiLmdldEJvdW5kcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLkRpc3BsYXlPYmplY3RfZ2V0Qm91bmRzKCl8fHRoaXMuc3ByaXRlU2hlZXQuZ2V0RnJhbWVCb3VuZHModGhpcy5jdXJyZW50RnJhbWUsdGhpcy5fcmVjdGFuZ2xlKX0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9jbG9uZVByb3BzKG5ldyBhKHRoaXMuc3ByaXRlU2hlZXQpKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1Nwcml0ZSAobmFtZT1cIit0aGlzLm5hbWUrXCIpXVwifSxiLl9jbG9uZVByb3BzPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLkRpc3BsYXlPYmplY3RfX2Nsb25lUHJvcHMoYSksYS5jdXJyZW50RnJhbWU9dGhpcy5jdXJyZW50RnJhbWUsYS5jdXJyZW50QW5pbWF0aW9uPXRoaXMuY3VycmVudEFuaW1hdGlvbixhLnBhdXNlZD10aGlzLnBhdXNlZCxhLmN1cnJlbnRBbmltYXRpb25GcmFtZT10aGlzLmN1cnJlbnRBbmltYXRpb25GcmFtZSxhLmZyYW1lcmF0ZT10aGlzLmZyYW1lcmF0ZSxhLl9hbmltYXRpb249dGhpcy5fYW5pbWF0aW9uLGEuX2N1cnJlbnRGcmFtZT10aGlzLl9jdXJyZW50RnJhbWUsYS5fc2tpcEFkdmFuY2U9dGhpcy5fc2tpcEFkdmFuY2UsYX0sYi5fdGljaz1mdW5jdGlvbihhKXt0aGlzLnBhdXNlZHx8KHRoaXMuX3NraXBBZHZhbmNlfHx0aGlzLmFkdmFuY2UoYSYmYS5kZWx0YSksdGhpcy5fc2tpcEFkdmFuY2U9ITEpLHRoaXMuRGlzcGxheU9iamVjdF9fdGljayhhKX0sYi5fbm9ybWFsaXplRnJhbWU9ZnVuY3Rpb24oYSl7YT1hfHwwO3ZhciBiLGM9dGhpcy5fYW5pbWF0aW9uLGQ9dGhpcy5wYXVzZWQsZT10aGlzLl9jdXJyZW50RnJhbWU7aWYoYyl7dmFyIGY9Yy5zcGVlZHx8MSxnPXRoaXMuY3VycmVudEFuaW1hdGlvbkZyYW1lO2lmKGI9Yy5mcmFtZXMubGVuZ3RoLGcrYSpmPj1iKXt2YXIgaD1jLm5leHQ7aWYodGhpcy5fZGlzcGF0Y2hBbmltYXRpb25FbmQoYyxlLGQsaCxiLTEpKXJldHVybjtpZihoKXJldHVybiB0aGlzLl9nb3RvKGgsYS0oYi1nKS9mKTt0aGlzLnBhdXNlZD0hMCxnPWMuZnJhbWVzLmxlbmd0aC0xfWVsc2UgZys9YSpmO3RoaXMuY3VycmVudEFuaW1hdGlvbkZyYW1lPWcsdGhpcy5fY3VycmVudEZyYW1lPWMuZnJhbWVzWzB8Z119ZWxzZSBpZihlPXRoaXMuX2N1cnJlbnRGcmFtZSs9YSxiPXRoaXMuc3ByaXRlU2hlZXQuZ2V0TnVtRnJhbWVzKCksZT49YiYmYj4wJiYhdGhpcy5fZGlzcGF0Y2hBbmltYXRpb25FbmQoYyxlLGQsYi0xKSYmKHRoaXMuX2N1cnJlbnRGcmFtZS09Yik+PWIpcmV0dXJuIHRoaXMuX25vcm1hbGl6ZUZyYW1lKCk7ZT0wfHRoaXMuX2N1cnJlbnRGcmFtZSx0aGlzLmN1cnJlbnRGcmFtZSE9ZSYmKHRoaXMuY3VycmVudEZyYW1lPWUsdGhpcy5kaXNwYXRjaEV2ZW50KFwiY2hhbmdlXCIpKX0sYi5fZGlzcGF0Y2hBbmltYXRpb25FbmQ9ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZj1hP2EubmFtZTpudWxsO2lmKHRoaXMuaGFzRXZlbnRMaXN0ZW5lcihcImFuaW1hdGlvbmVuZFwiKSl7dmFyIGc9bmV3IGNyZWF0ZWpzLkV2ZW50KFwiYW5pbWF0aW9uZW5kXCIpO2cubmFtZT1mLGcubmV4dD1kLHRoaXMuZGlzcGF0Y2hFdmVudChnKX12YXIgaD10aGlzLl9hbmltYXRpb24hPWF8fHRoaXMuX2N1cnJlbnRGcmFtZSE9YjtyZXR1cm4gaHx8Y3x8IXRoaXMucGF1c2VkfHwodGhpcy5jdXJyZW50QW5pbWF0aW9uRnJhbWU9ZSxoPSEwKSxofSxiLl9nb3RvPWZ1bmN0aW9uKGEsYil7aWYodGhpcy5jdXJyZW50QW5pbWF0aW9uRnJhbWU9MCxpc05hTihhKSl7dmFyIGM9dGhpcy5zcHJpdGVTaGVldC5nZXRBbmltYXRpb24oYSk7YyYmKHRoaXMuX2FuaW1hdGlvbj1jLHRoaXMuY3VycmVudEFuaW1hdGlvbj1hLHRoaXMuX25vcm1hbGl6ZUZyYW1lKGIpKX1lbHNlIHRoaXMuY3VycmVudEFuaW1hdGlvbj10aGlzLl9hbmltYXRpb249bnVsbCx0aGlzLl9jdXJyZW50RnJhbWU9YSx0aGlzLl9ub3JtYWxpemVGcmFtZSgpfSxjcmVhdGVqcy5TcHJpdGU9Y3JlYXRlanMucHJvbW90ZShhLFwiRGlzcGxheU9iamVjdFwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLkRpc3BsYXlPYmplY3RfY29uc3RydWN0b3IoKSx0aGlzLmdyYXBoaWNzPWE/YTpuZXcgY3JlYXRlanMuR3JhcGhpY3N9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRGlzcGxheU9iamVjdCk7Yi5pc1Zpc2libGU9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNhY2hlQ2FudmFzfHx0aGlzLmdyYXBoaWNzJiYhdGhpcy5ncmFwaGljcy5pc0VtcHR5KCk7cmV0dXJuISEodGhpcy52aXNpYmxlJiZ0aGlzLmFscGhhPjAmJjAhPXRoaXMuc2NhbGVYJiYwIT10aGlzLnNjYWxlWSYmYSl9LGIuZHJhdz1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLkRpc3BsYXlPYmplY3RfZHJhdyhhLGIpPyEwOih0aGlzLmdyYXBoaWNzLmRyYXcoYSx0aGlzKSwhMCl9LGIuY2xvbmU9ZnVuY3Rpb24oYil7dmFyIGM9YiYmdGhpcy5ncmFwaGljcz90aGlzLmdyYXBoaWNzLmNsb25lKCk6dGhpcy5ncmFwaGljcztyZXR1cm4gdGhpcy5fY2xvbmVQcm9wcyhuZXcgYShjKSl9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltTaGFwZSAobmFtZT1cIit0aGlzLm5hbWUrXCIpXVwifSxjcmVhdGVqcy5TaGFwZT1jcmVhdGVqcy5wcm9tb3RlKGEsXCJEaXNwbGF5T2JqZWN0XCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjKXt0aGlzLkRpc3BsYXlPYmplY3RfY29uc3RydWN0b3IoKSx0aGlzLnRleHQ9YSx0aGlzLmZvbnQ9Yix0aGlzLmNvbG9yPWMsdGhpcy50ZXh0QWxpZ249XCJsZWZ0XCIsdGhpcy50ZXh0QmFzZWxpbmU9XCJ0b3BcIix0aGlzLm1heFdpZHRoPW51bGwsdGhpcy5vdXRsaW5lPTAsdGhpcy5saW5lSGVpZ2h0PTAsdGhpcy5saW5lV2lkdGg9bnVsbH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5EaXNwbGF5T2JqZWN0KSxjPWNyZWF0ZWpzLmNyZWF0ZUNhbnZhcz9jcmVhdGVqcy5jcmVhdGVDYW52YXMoKTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO2MuZ2V0Q29udGV4dCYmKGEuX3dvcmtpbmdDb250ZXh0PWMuZ2V0Q29udGV4dChcIjJkXCIpLGMud2lkdGg9Yy5oZWlnaHQ9MSksYS5IX09GRlNFVFM9e3N0YXJ0OjAsbGVmdDowLGNlbnRlcjotLjUsZW5kOi0xLHJpZ2h0Oi0xfSxhLlZfT0ZGU0VUUz17dG9wOjAsaGFuZ2luZzotLjAxLG1pZGRsZTotLjQsYWxwaGFiZXRpYzotLjgsaWRlb2dyYXBoaWM6LS44NSxib3R0b206LTF9LGIuaXNWaXNpYmxlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jYWNoZUNhbnZhc3x8bnVsbCE9dGhpcy50ZXh0JiZcIlwiIT09dGhpcy50ZXh0O3JldHVybiEhKHRoaXMudmlzaWJsZSYmdGhpcy5hbHBoYT4wJiYwIT10aGlzLnNjYWxlWCYmMCE9dGhpcy5zY2FsZVkmJmEpfSxiLmRyYXc9ZnVuY3Rpb24oYSxiKXtpZih0aGlzLkRpc3BsYXlPYmplY3RfZHJhdyhhLGIpKXJldHVybiEwO3ZhciBjPXRoaXMuY29sb3J8fFwiIzAwMFwiO3JldHVybiB0aGlzLm91dGxpbmU/KGEuc3Ryb2tlU3R5bGU9YyxhLmxpbmVXaWR0aD0xKnRoaXMub3V0bGluZSk6YS5maWxsU3R5bGU9Yyx0aGlzLl9kcmF3VGV4dCh0aGlzLl9wcmVwQ29udGV4dChhKSksITB9LGIuZ2V0TWVhc3VyZWRXaWR0aD1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9nZXRNZWFzdXJlZFdpZHRoKHRoaXMudGV4dCl9LGIuZ2V0TWVhc3VyZWRMaW5lSGVpZ2h0PWZ1bmN0aW9uKCl7cmV0dXJuIDEuMip0aGlzLl9nZXRNZWFzdXJlZFdpZHRoKFwiTVwiKX0sYi5nZXRNZWFzdXJlZEhlaWdodD1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9kcmF3VGV4dChudWxsLHt9KS5oZWlnaHR9LGIuZ2V0Qm91bmRzPWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5EaXNwbGF5T2JqZWN0X2dldEJvdW5kcygpO2lmKGIpcmV0dXJuIGI7aWYobnVsbD09dGhpcy50ZXh0fHxcIlwiPT09dGhpcy50ZXh0KXJldHVybiBudWxsO3ZhciBjPXRoaXMuX2RyYXdUZXh0KG51bGwse30pLGQ9dGhpcy5tYXhXaWR0aCYmdGhpcy5tYXhXaWR0aDxjLndpZHRoP3RoaXMubWF4V2lkdGg6Yy53aWR0aCxlPWQqYS5IX09GRlNFVFNbdGhpcy50ZXh0QWxpZ258fFwibGVmdFwiXSxmPXRoaXMubGluZUhlaWdodHx8dGhpcy5nZXRNZWFzdXJlZExpbmVIZWlnaHQoKSxnPWYqYS5WX09GRlNFVFNbdGhpcy50ZXh0QmFzZWxpbmV8fFwidG9wXCJdO3JldHVybiB0aGlzLl9yZWN0YW5nbGUuc2V0VmFsdWVzKGUsZyxkLGMuaGVpZ2h0KX0sYi5nZXRNZXRyaWNzPWZ1bmN0aW9uKCl7dmFyIGI9e2xpbmVzOltdfTtyZXR1cm4gYi5saW5lSGVpZ2h0PXRoaXMubGluZUhlaWdodHx8dGhpcy5nZXRNZWFzdXJlZExpbmVIZWlnaHQoKSxiLnZPZmZzZXQ9Yi5saW5lSGVpZ2h0KmEuVl9PRkZTRVRTW3RoaXMudGV4dEJhc2VsaW5lfHxcInRvcFwiXSx0aGlzLl9kcmF3VGV4dChudWxsLGIsYi5saW5lcyl9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fY2xvbmVQcm9wcyhuZXcgYSh0aGlzLnRleHQsdGhpcy5mb250LHRoaXMuY29sb3IpKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1RleHQgKHRleHQ9XCIrKHRoaXMudGV4dC5sZW5ndGg+MjA/dGhpcy50ZXh0LnN1YnN0cigwLDE3KStcIi4uLlwiOnRoaXMudGV4dCkrXCIpXVwifSxiLl9jbG9uZVByb3BzPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLkRpc3BsYXlPYmplY3RfX2Nsb25lUHJvcHMoYSksYS50ZXh0QWxpZ249dGhpcy50ZXh0QWxpZ24sYS50ZXh0QmFzZWxpbmU9dGhpcy50ZXh0QmFzZWxpbmUsYS5tYXhXaWR0aD10aGlzLm1heFdpZHRoLGEub3V0bGluZT10aGlzLm91dGxpbmUsYS5saW5lSGVpZ2h0PXRoaXMubGluZUhlaWdodCxhLmxpbmVXaWR0aD10aGlzLmxpbmVXaWR0aCxhfSxiLl9wcmVwQ29udGV4dD1mdW5jdGlvbihhKXtyZXR1cm4gYS5mb250PXRoaXMuZm9udHx8XCIxMHB4IHNhbnMtc2VyaWZcIixhLnRleHRBbGlnbj10aGlzLnRleHRBbGlnbnx8XCJsZWZ0XCIsYS50ZXh0QmFzZWxpbmU9dGhpcy50ZXh0QmFzZWxpbmV8fFwidG9wXCIsYX0sYi5fZHJhd1RleHQ9ZnVuY3Rpb24oYixjLGQpe3ZhciBlPSEhYjtlfHwoYj1hLl93b3JraW5nQ29udGV4dCxiLnNhdmUoKSx0aGlzLl9wcmVwQ29udGV4dChiKSk7Zm9yKHZhciBmPXRoaXMubGluZUhlaWdodHx8dGhpcy5nZXRNZWFzdXJlZExpbmVIZWlnaHQoKSxnPTAsaD0wLGk9U3RyaW5nKHRoaXMudGV4dCkuc3BsaXQoLyg/OlxcclxcbnxcXHJ8XFxuKS8pLGo9MCxrPWkubGVuZ3RoO2s+ajtqKyspe3ZhciBsPWlbal0sbT1udWxsO2lmKG51bGwhPXRoaXMubGluZVdpZHRoJiYobT1iLm1lYXN1cmVUZXh0KGwpLndpZHRoKT50aGlzLmxpbmVXaWR0aCl7dmFyIG49bC5zcGxpdCgvKFxccykvKTtsPW5bMF0sbT1iLm1lYXN1cmVUZXh0KGwpLndpZHRoO2Zvcih2YXIgbz0xLHA9bi5sZW5ndGg7cD5vO28rPTIpe3ZhciBxPWIubWVhc3VyZVRleHQobltvXStuW28rMV0pLndpZHRoO20rcT50aGlzLmxpbmVXaWR0aD8oZSYmdGhpcy5fZHJhd1RleHRMaW5lKGIsbCxoKmYpLGQmJmQucHVzaChsKSxtPmcmJihnPW0pLGw9bltvKzFdLG09Yi5tZWFzdXJlVGV4dChsKS53aWR0aCxoKyspOihsKz1uW29dK25bbysxXSxtKz1xKX19ZSYmdGhpcy5fZHJhd1RleHRMaW5lKGIsbCxoKmYpLGQmJmQucHVzaChsKSxjJiZudWxsPT1tJiYobT1iLm1lYXN1cmVUZXh0KGwpLndpZHRoKSxtPmcmJihnPW0pLGgrK31yZXR1cm4gYyYmKGMud2lkdGg9ZyxjLmhlaWdodD1oKmYpLGV8fGIucmVzdG9yZSgpLGN9LGIuX2RyYXdUZXh0TGluZT1mdW5jdGlvbihhLGIsYyl7dGhpcy5vdXRsaW5lP2Euc3Ryb2tlVGV4dChiLDAsYyx0aGlzLm1heFdpZHRofHw2NTUzNSk6YS5maWxsVGV4dChiLDAsYyx0aGlzLm1heFdpZHRofHw2NTUzNSl9LGIuX2dldE1lYXN1cmVkV2lkdGg9ZnVuY3Rpb24oYil7dmFyIGM9YS5fd29ya2luZ0NvbnRleHQ7Yy5zYXZlKCk7dmFyIGQ9dGhpcy5fcHJlcENvbnRleHQoYykubWVhc3VyZVRleHQoYikud2lkdGg7cmV0dXJuIGMucmVzdG9yZSgpLGR9LGNyZWF0ZWpzLlRleHQ9Y3JlYXRlanMucHJvbW90ZShhLFwiRGlzcGxheU9iamVjdFwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIpe3RoaXMuQ29udGFpbmVyX2NvbnN0cnVjdG9yKCksdGhpcy50ZXh0PWF8fFwiXCIsdGhpcy5zcHJpdGVTaGVldD1iLHRoaXMubGluZUhlaWdodD0wLHRoaXMubGV0dGVyU3BhY2luZz0wLHRoaXMuc3BhY2VXaWR0aD0wLHRoaXMuX29sZFByb3BzPXt0ZXh0OjAsc3ByaXRlU2hlZXQ6MCxsaW5lSGVpZ2h0OjAsbGV0dGVyU3BhY2luZzowLHNwYWNlV2lkdGg6MH19dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQ29udGFpbmVyKTthLm1heFBvb2xTaXplPTEwMCxhLl9zcHJpdGVQb29sPVtdLGIuZHJhdz1mdW5jdGlvbihhLGIpe3RoaXMuRGlzcGxheU9iamVjdF9kcmF3KGEsYil8fCh0aGlzLl91cGRhdGVUZXh0KCksdGhpcy5Db250YWluZXJfZHJhdyhhLGIpKX0sYi5nZXRCb3VuZHM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fdXBkYXRlVGV4dCgpLHRoaXMuQ29udGFpbmVyX2dldEJvdW5kcygpfSxiLmlzVmlzaWJsZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMuY2FjaGVDYW52YXN8fHRoaXMuc3ByaXRlU2hlZXQmJnRoaXMuc3ByaXRlU2hlZXQuY29tcGxldGUmJnRoaXMudGV4dDtyZXR1cm4hISh0aGlzLnZpc2libGUmJnRoaXMuYWxwaGE+MCYmMCE9PXRoaXMuc2NhbGVYJiYwIT09dGhpcy5zY2FsZVkmJmEpfSxiLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2Nsb25lUHJvcHMobmV3IGEodGhpcy50ZXh0LHRoaXMuc3ByaXRlU2hlZXQpKX0sYi5hZGRDaGlsZD1iLmFkZENoaWxkQXQ9Yi5yZW1vdmVDaGlsZD1iLnJlbW92ZUNoaWxkQXQ9Yi5yZW1vdmVBbGxDaGlsZHJlbj1mdW5jdGlvbigpe30sYi5fY2xvbmVQcm9wcz1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5Db250YWluZXJfX2Nsb25lUHJvcHMoYSksYS5saW5lSGVpZ2h0PXRoaXMubGluZUhlaWdodCxhLmxldHRlclNwYWNpbmc9dGhpcy5sZXR0ZXJTcGFjaW5nLGEuc3BhY2VXaWR0aD10aGlzLnNwYWNlV2lkdGgsYX0sYi5fZ2V0RnJhbWVJbmRleD1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9Yi5nZXRBbmltYXRpb24oYSk7cmV0dXJuIGR8fChhIT0oYz1hLnRvVXBwZXJDYXNlKCkpfHxhIT0oYz1hLnRvTG93ZXJDYXNlKCkpfHwoYz1udWxsKSxjJiYoZD1iLmdldEFuaW1hdGlvbihjKSkpLGQmJmQuZnJhbWVzWzBdfSxiLl9nZXRGcmFtZT1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX2dldEZyYW1lSW5kZXgoYSxiKTtyZXR1cm4gbnVsbD09Yz9jOmIuZ2V0RnJhbWUoYyl9LGIuX2dldExpbmVIZWlnaHQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZ2V0RnJhbWUoXCIxXCIsYSl8fHRoaXMuX2dldEZyYW1lKFwiVFwiLGEpfHx0aGlzLl9nZXRGcmFtZShcIkxcIixhKXx8YS5nZXRGcmFtZSgwKTtyZXR1cm4gYj9iLnJlY3QuaGVpZ2h0OjF9LGIuX2dldFNwYWNlV2lkdGg9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZ2V0RnJhbWUoXCIxXCIsYSl8fHRoaXMuX2dldEZyYW1lKFwibFwiLGEpfHx0aGlzLl9nZXRGcmFtZShcImVcIixhKXx8dGhpcy5fZ2V0RnJhbWUoXCJhXCIsYSl8fGEuZ2V0RnJhbWUoMCk7cmV0dXJuIGI/Yi5yZWN0LndpZHRoOjF9LGIuX3VwZGF0ZVRleHQ9ZnVuY3Rpb24oKXt2YXIgYixjPTAsZD0wLGU9dGhpcy5fb2xkUHJvcHMsZj0hMSxnPXRoaXMuc3BhY2VXaWR0aCxoPXRoaXMubGluZUhlaWdodCxpPXRoaXMuc3ByaXRlU2hlZXQsaj1hLl9zcHJpdGVQb29sLGs9dGhpcy5jaGlsZHJlbixsPTAsbT1rLmxlbmd0aDtmb3IodmFyIG4gaW4gZSllW25dIT10aGlzW25dJiYoZVtuXT10aGlzW25dLGY9ITApO2lmKGYpe3ZhciBvPSEhdGhpcy5fZ2V0RnJhbWUoXCIgXCIsaSk7b3x8Z3x8KGc9dGhpcy5fZ2V0U3BhY2VXaWR0aChpKSksaHx8KGg9dGhpcy5fZ2V0TGluZUhlaWdodChpKSk7Zm9yKHZhciBwPTAscT10aGlzLnRleHQubGVuZ3RoO3E+cDtwKyspe3ZhciByPXRoaXMudGV4dC5jaGFyQXQocCk7aWYoXCIgXCIhPXJ8fG8paWYoXCJcXG5cIiE9ciYmXCJcXHJcIiE9cil7dmFyIHM9dGhpcy5fZ2V0RnJhbWVJbmRleChyLGkpO251bGwhPXMmJihtPmw/Yj1rW2xdOihrLnB1c2goYj1qLmxlbmd0aD9qLnBvcCgpOm5ldyBjcmVhdGVqcy5TcHJpdGUpLGIucGFyZW50PXRoaXMsbSsrKSxiLnNwcml0ZVNoZWV0PWksYi5nb3RvQW5kU3RvcChzKSxiLng9YyxiLnk9ZCxsKyssYys9Yi5nZXRCb3VuZHMoKS53aWR0aCt0aGlzLmxldHRlclNwYWNpbmcpfWVsc2VcIlxcclwiPT1yJiZcIlxcblwiPT10aGlzLnRleHQuY2hhckF0KHArMSkmJnArKyxjPTAsZCs9aDtlbHNlIGMrPWd9Zm9yKDttPmw7KWoucHVzaChiPWsucG9wKCkpLGIucGFyZW50PW51bGwsbS0tO2oubGVuZ3RoPmEubWF4UG9vbFNpemUmJihqLmxlbmd0aD1hLm1heFBvb2xTaXplKX19LGNyZWF0ZWpzLkJpdG1hcFRleHQ9Y3JlYXRlanMucHJvbW90ZShhLFwiQ29udGFpbmVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGIsYyxkLGUpe3RoaXMuQ29udGFpbmVyX2NvbnN0cnVjdG9yKCksIWEuaW5pdGVkJiZhLmluaXQoKSx0aGlzLm1vZGU9Ynx8YS5JTkRFUEVOREVOVCx0aGlzLnN0YXJ0UG9zaXRpb249Y3x8MCx0aGlzLmxvb3A9ZCx0aGlzLmN1cnJlbnRGcmFtZT0wLHRoaXMudGltZWxpbmU9bmV3IGNyZWF0ZWpzLlRpbWVsaW5lKG51bGwsZSx7cGF1c2VkOiEwLHBvc2l0aW9uOmMsdXNlVGlja3M6ITB9KSx0aGlzLnBhdXNlZD0hMSx0aGlzLmFjdGlvbnNFbmFibGVkPSEwLHRoaXMuYXV0b1Jlc2V0PSEwLHRoaXMuZnJhbWVCb3VuZHM9dGhpcy5mcmFtZUJvdW5kc3x8bnVsbCx0aGlzLmZyYW1lcmF0ZT1udWxsLHRoaXMuX3N5bmNoT2Zmc2V0PTAsdGhpcy5fcHJldlBvcz0tMSx0aGlzLl9wcmV2UG9zaXRpb249MCx0aGlzLl90PTAsdGhpcy5fbWFuYWdlZD17fX1mdW5jdGlvbiBiKCl7dGhyb3dcIk1vdmllQ2xpcFBsdWdpbiBjYW5ub3QgYmUgaW5zdGFudGlhdGVkLlwifXZhciBjPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkNvbnRhaW5lcik7YS5JTkRFUEVOREVOVD1cImluZGVwZW5kZW50XCIsYS5TSU5HTEVfRlJBTUU9XCJzaW5nbGVcIixhLlNZTkNIRUQ9XCJzeW5jaGVkXCIsYS5pbml0ZWQ9ITEsYS5pbml0PWZ1bmN0aW9uKCl7YS5pbml0ZWR8fChiLmluc3RhbGwoKSxhLmluaXRlZD0hMCl9LGMuZ2V0TGFiZWxzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudGltZWxpbmUuZ2V0TGFiZWxzKCl9LGMuZ2V0Q3VycmVudExhYmVsPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3VwZGF0ZVRpbWVsaW5lKCksdGhpcy50aW1lbGluZS5nZXRDdXJyZW50TGFiZWwoKX0sYy5nZXREdXJhdGlvbj1mdW5jdGlvbigpe3JldHVybiB0aGlzLnRpbWVsaW5lLmR1cmF0aW9uO1xufTt0cnl7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMoYyx7bGFiZWxzOntnZXQ6Yy5nZXRMYWJlbHN9LGN1cnJlbnRMYWJlbDp7Z2V0OmMuZ2V0Q3VycmVudExhYmVsfSx0b3RhbEZyYW1lczp7Z2V0OmMuZ2V0RHVyYXRpb259LGR1cmF0aW9uOntnZXQ6Yy5nZXREdXJhdGlvbn19KX1jYXRjaChkKXt9Yy5pbml0aWFsaXplPWEsYy5pc1Zpc2libGU9ZnVuY3Rpb24oKXtyZXR1cm4hISh0aGlzLnZpc2libGUmJnRoaXMuYWxwaGE+MCYmMCE9dGhpcy5zY2FsZVgmJjAhPXRoaXMuc2NhbGVZKX0sYy5kcmF3PWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuRGlzcGxheU9iamVjdF9kcmF3KGEsYik/ITA6KHRoaXMuX3VwZGF0ZVRpbWVsaW5lKCksdGhpcy5Db250YWluZXJfZHJhdyhhLGIpLCEwKX0sYy5wbGF5PWZ1bmN0aW9uKCl7dGhpcy5wYXVzZWQ9ITF9LGMuc3RvcD1mdW5jdGlvbigpe3RoaXMucGF1c2VkPSEwfSxjLmdvdG9BbmRQbGF5PWZ1bmN0aW9uKGEpe3RoaXMucGF1c2VkPSExLHRoaXMuX2dvdG8oYSl9LGMuZ290b0FuZFN0b3A9ZnVuY3Rpb24oYSl7dGhpcy5wYXVzZWQ9ITAsdGhpcy5fZ290byhhKX0sYy5hZHZhbmNlPWZ1bmN0aW9uKGIpe3ZhciBjPWEuSU5ERVBFTkRFTlQ7aWYodGhpcy5tb2RlPT1jKXtmb3IodmFyIGQ9dGhpcyxlPWQuZnJhbWVyYXRlOyhkPWQucGFyZW50KSYmbnVsbD09ZTspZC5tb2RlPT1jJiYoZT1kLl9mcmFtZXJhdGUpO3RoaXMuX2ZyYW1lcmF0ZT1lO3ZhciBmPW51bGwhPWUmJi0xIT1lJiZudWxsIT1iP2IvKDFlMy9lKSt0aGlzLl90OjEsZz0wfGY7Zm9yKHRoaXMuX3Q9Zi1nOyF0aGlzLnBhdXNlZCYmZy0tOyl0aGlzLl9wcmV2UG9zaXRpb249dGhpcy5fcHJldlBvczwwPzA6dGhpcy5fcHJldlBvc2l0aW9uKzEsdGhpcy5fdXBkYXRlVGltZWxpbmUoKX19LGMuY2xvbmU9ZnVuY3Rpb24oKXt0aHJvd1wiTW92aWVDbGlwIGNhbm5vdCBiZSBjbG9uZWQuXCJ9LGMudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltNb3ZpZUNsaXAgKG5hbWU9XCIrdGhpcy5uYW1lK1wiKV1cIn0sYy5fdGljaz1mdW5jdGlvbihhKXt0aGlzLmFkdmFuY2UoYSYmYS5kZWx0YSksdGhpcy5Db250YWluZXJfX3RpY2soYSl9LGMuX2dvdG89ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy50aW1lbGluZS5yZXNvbHZlKGEpO251bGwhPWImJigtMT09dGhpcy5fcHJldlBvcyYmKHRoaXMuX3ByZXZQb3M9TmFOKSx0aGlzLl9wcmV2UG9zaXRpb249Yix0aGlzLl90PTAsdGhpcy5fdXBkYXRlVGltZWxpbmUoKSl9LGMuX3Jlc2V0PWZ1bmN0aW9uKCl7dGhpcy5fcHJldlBvcz0tMSx0aGlzLl90PXRoaXMuY3VycmVudEZyYW1lPTAsdGhpcy5wYXVzZWQ9ITF9LGMuX3VwZGF0ZVRpbWVsaW5lPWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy50aW1lbGluZSxjPXRoaXMubW9kZSE9YS5JTkRFUEVOREVOVDtiLmxvb3A9bnVsbD09dGhpcy5sb29wPyEwOnRoaXMubG9vcDt2YXIgZD1jP3RoaXMuc3RhcnRQb3NpdGlvbisodGhpcy5tb2RlPT1hLlNJTkdMRV9GUkFNRT8wOnRoaXMuX3N5bmNoT2Zmc2V0KTp0aGlzLl9wcmV2UG9zPDA/MDp0aGlzLl9wcmV2UG9zaXRpb24sZT1jfHwhdGhpcy5hY3Rpb25zRW5hYmxlZD9jcmVhdGVqcy5Ud2Vlbi5OT05FOm51bGw7aWYodGhpcy5jdXJyZW50RnJhbWU9Yi5fY2FsY1Bvc2l0aW9uKGQpLGIuc2V0UG9zaXRpb24oZCxlKSx0aGlzLl9wcmV2UG9zaXRpb249Yi5fcHJldlBvc2l0aW9uLHRoaXMuX3ByZXZQb3MhPWIuX3ByZXZQb3Mpe3RoaXMuY3VycmVudEZyYW1lPXRoaXMuX3ByZXZQb3M9Yi5fcHJldlBvcztmb3IodmFyIGYgaW4gdGhpcy5fbWFuYWdlZCl0aGlzLl9tYW5hZ2VkW2ZdPTE7Zm9yKHZhciBnPWIuX3R3ZWVucyxoPTAsaT1nLmxlbmd0aDtpPmg7aCsrKXt2YXIgaj1nW2hdLGs9ai5fdGFyZ2V0O2lmKGshPXRoaXMmJiFqLnBhc3NpdmUpe3ZhciBsPWouX3N0ZXBQb3NpdGlvbjtrIGluc3RhbmNlb2YgY3JlYXRlanMuRGlzcGxheU9iamVjdD90aGlzLl9hZGRNYW5hZ2VkQ2hpbGQoayxsKTp0aGlzLl9zZXRTdGF0ZShrLnN0YXRlLGwpfX12YXIgbT10aGlzLmNoaWxkcmVuO2ZvcihoPW0ubGVuZ3RoLTE7aD49MDtoLS0pe3ZhciBuPW1baF0uaWQ7MT09dGhpcy5fbWFuYWdlZFtuXSYmKHRoaXMucmVtb3ZlQ2hpbGRBdChoKSxkZWxldGUgdGhpcy5fbWFuYWdlZFtuXSl9fX0sYy5fc2V0U3RhdGU9ZnVuY3Rpb24oYSxiKXtpZihhKWZvcih2YXIgYz1hLmxlbmd0aC0xO2M+PTA7Yy0tKXt2YXIgZD1hW2NdLGU9ZC50LGY9ZC5wO2Zvcih2YXIgZyBpbiBmKWVbZ109ZltnXTt0aGlzLl9hZGRNYW5hZ2VkQ2hpbGQoZSxiKX19LGMuX2FkZE1hbmFnZWRDaGlsZD1mdW5jdGlvbihiLGMpe2IuX29mZnx8KHRoaXMuYWRkQ2hpbGRBdChiLDApLGIgaW5zdGFuY2VvZiBhJiYoYi5fc3luY2hPZmZzZXQ9YyxiLm1vZGU9PWEuSU5ERVBFTkRFTlQmJmIuYXV0b1Jlc2V0JiYhdGhpcy5fbWFuYWdlZFtiLmlkXSYmYi5fcmVzZXQoKSksdGhpcy5fbWFuYWdlZFtiLmlkXT0yKX0sYy5fZ2V0Qm91bmRzPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5EaXNwbGF5T2JqZWN0X2dldEJvdW5kcygpO3JldHVybiBjfHwodGhpcy5fdXBkYXRlVGltZWxpbmUoKSx0aGlzLmZyYW1lQm91bmRzJiYoYz10aGlzLl9yZWN0YW5nbGUuY29weSh0aGlzLmZyYW1lQm91bmRzW3RoaXMuY3VycmVudEZyYW1lXSkpKSxjP3RoaXMuX3RyYW5zZm9ybUJvdW5kcyhjLGEsYik6dGhpcy5Db250YWluZXJfX2dldEJvdW5kcyhhLGIpfSxjcmVhdGVqcy5Nb3ZpZUNsaXA9Y3JlYXRlanMucHJvbW90ZShhLFwiQ29udGFpbmVyXCIpLGIucHJpb3JpdHk9MTAwLGIuaW5zdGFsbD1mdW5jdGlvbigpe2NyZWF0ZWpzLlR3ZWVuLmluc3RhbGxQbHVnaW4oYixbXCJzdGFydFBvc2l0aW9uXCJdKX0sYi5pbml0PWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gY30sYi5zdGVwPWZ1bmN0aW9uKCl7fSxiLnR3ZWVuPWZ1bmN0aW9uKGIsYyxkLGUsZixnLGgsaSl7cmV0dXJuIGIudGFyZ2V0IGluc3RhbmNlb2YgYT8xPT1nP2ZbY106ZVtjXTpkfX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3Rocm93XCJTcHJpdGVTaGVldFV0aWxzIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWRcIn12YXIgYj1jcmVhdGVqcy5jcmVhdGVDYW52YXM/Y3JlYXRlanMuY3JlYXRlQ2FudmFzKCk6ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtiLmdldENvbnRleHQmJihhLl93b3JraW5nQ2FudmFzPWIsYS5fd29ya2luZ0NvbnRleHQ9Yi5nZXRDb250ZXh0KFwiMmRcIiksYi53aWR0aD1iLmhlaWdodD0xKSxhLmFkZEZsaXBwZWRGcmFtZXM9ZnVuY3Rpb24oYixjLGQsZSl7aWYoY3x8ZHx8ZSl7dmFyIGY9MDtjJiZhLl9mbGlwKGIsKytmLCEwLCExKSxkJiZhLl9mbGlwKGIsKytmLCExLCEwKSxlJiZhLl9mbGlwKGIsKytmLCEwLCEwKX19LGEuZXh0cmFjdEZyYW1lPWZ1bmN0aW9uKGIsYyl7aXNOYU4oYykmJihjPWIuZ2V0QW5pbWF0aW9uKGMpLmZyYW1lc1swXSk7dmFyIGQ9Yi5nZXRGcmFtZShjKTtpZighZClyZXR1cm4gbnVsbDt2YXIgZT1kLnJlY3QsZj1hLl93b3JraW5nQ2FudmFzO2Yud2lkdGg9ZS53aWR0aCxmLmhlaWdodD1lLmhlaWdodCxhLl93b3JraW5nQ29udGV4dC5kcmF3SW1hZ2UoZC5pbWFnZSxlLngsZS55LGUud2lkdGgsZS5oZWlnaHQsMCwwLGUud2lkdGgsZS5oZWlnaHQpO3ZhciBnPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7cmV0dXJuIGcuc3JjPWYudG9EYXRhVVJMKFwiaW1hZ2UvcG5nXCIpLGd9LGEubWVyZ2VBbHBoYT1mdW5jdGlvbihhLGIsYyl7Y3x8KGM9Y3JlYXRlanMuY3JlYXRlQ2FudmFzP2NyZWF0ZWpzLmNyZWF0ZUNhbnZhcygpOmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIikpLGMud2lkdGg9TWF0aC5tYXgoYi53aWR0aCxhLndpZHRoKSxjLmhlaWdodD1NYXRoLm1heChiLmhlaWdodCxhLmhlaWdodCk7dmFyIGQ9Yy5nZXRDb250ZXh0KFwiMmRcIik7cmV0dXJuIGQuc2F2ZSgpLGQuZHJhd0ltYWdlKGEsMCwwKSxkLmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbj1cImRlc3RpbmF0aW9uLWluXCIsZC5kcmF3SW1hZ2UoYiwwLDApLGQucmVzdG9yZSgpLGN9LGEuX2ZsaXA9ZnVuY3Rpb24oYixjLGQsZSl7Zm9yKHZhciBmPWIuX2ltYWdlcyxnPWEuX3dvcmtpbmdDYW52YXMsaD1hLl93b3JraW5nQ29udGV4dCxpPWYubGVuZ3RoL2Msaj0wO2k+ajtqKyspe3ZhciBrPWZbal07ay5fX3RtcD1qLGguc2V0VHJhbnNmb3JtKDEsMCwwLDEsMCwwKSxoLmNsZWFyUmVjdCgwLDAsZy53aWR0aCsxLGcuaGVpZ2h0KzEpLGcud2lkdGg9ay53aWR0aCxnLmhlaWdodD1rLmhlaWdodCxoLnNldFRyYW5zZm9ybShkPy0xOjEsMCwwLGU/LTE6MSxkP2sud2lkdGg6MCxlP2suaGVpZ2h0OjApLGguZHJhd0ltYWdlKGssMCwwKTt2YXIgbD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO2wuc3JjPWcudG9EYXRhVVJMKFwiaW1hZ2UvcG5nXCIpLGwud2lkdGg9ay53aWR0aCxsLmhlaWdodD1rLmhlaWdodCxmLnB1c2gobCl9dmFyIG09Yi5fZnJhbWVzLG49bS5sZW5ndGgvYztmb3Ioaj0wO24+ajtqKyspe2s9bVtqXTt2YXIgbz1rLnJlY3QuY2xvbmUoKTtsPWZbay5pbWFnZS5fX3RtcCtpKmNdO3ZhciBwPXtpbWFnZTpsLHJlY3Q6byxyZWdYOmsucmVnWCxyZWdZOmsucmVnWX07ZCYmKG8ueD1sLndpZHRoLW8ueC1vLndpZHRoLHAucmVnWD1vLndpZHRoLWsucmVnWCksZSYmKG8ueT1sLmhlaWdodC1vLnktby5oZWlnaHQscC5yZWdZPW8uaGVpZ2h0LWsucmVnWSksbS5wdXNoKHApfXZhciBxPVwiX1wiKyhkP1wiaFwiOlwiXCIpKyhlP1widlwiOlwiXCIpLHI9Yi5fYW5pbWF0aW9ucyxzPWIuX2RhdGEsdD1yLmxlbmd0aC9jO2ZvcihqPTA7dD5qO2orKyl7dmFyIHU9cltqXTtrPXNbdV07dmFyIHY9e25hbWU6dStxLHNwZWVkOmsuc3BlZWQsbmV4dDprLm5leHQsZnJhbWVzOltdfTtrLm5leHQmJih2Lm5leHQrPXEpLG09ay5mcmFtZXM7Zm9yKHZhciB3PTAseD1tLmxlbmd0aDt4Pnc7dysrKXYuZnJhbWVzLnB1c2gobVt3XStuKmMpO3Nbdi5uYW1lXT12LHIucHVzaCh2Lm5hbWUpfX0sY3JlYXRlanMuU3ByaXRlU2hlZXRVdGlscz1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuRXZlbnREaXNwYXRjaGVyX2NvbnN0cnVjdG9yKCksdGhpcy5tYXhXaWR0aD0yMDQ4LHRoaXMubWF4SGVpZ2h0PTIwNDgsdGhpcy5zcHJpdGVTaGVldD1udWxsLHRoaXMuc2NhbGU9MSx0aGlzLnBhZGRpbmc9MSx0aGlzLnRpbWVTbGljZT0uMyx0aGlzLnByb2dyZXNzPS0xLHRoaXMuZnJhbWVyYXRlPWF8fDAsdGhpcy5fZnJhbWVzPVtdLHRoaXMuX2FuaW1hdGlvbnM9e30sdGhpcy5fZGF0YT1udWxsLHRoaXMuX25leHRGcmFtZUluZGV4PTAsdGhpcy5faW5kZXg9MCx0aGlzLl90aW1lcklEPW51bGwsdGhpcy5fc2NhbGU9MX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIpO2EuRVJSX0RJTUVOU0lPTlM9XCJmcmFtZSBkaW1lbnNpb25zIGV4Y2VlZCBtYXggc3ByaXRlc2hlZXQgZGltZW5zaW9uc1wiLGEuRVJSX1JVTk5JTkc9XCJhIGJ1aWxkIGlzIGFscmVhZHkgcnVubmluZ1wiLGIuYWRkRnJhbWU9ZnVuY3Rpb24oYixjLGQsZSxmKXtpZih0aGlzLl9kYXRhKXRocm93IGEuRVJSX1JVTk5JTkc7dmFyIGc9Y3x8Yi5ib3VuZHN8fGIubm9taW5hbEJvdW5kcztyZXR1cm4hZyYmYi5nZXRCb3VuZHMmJihnPWIuZ2V0Qm91bmRzKCkpLGc/KGQ9ZHx8MSx0aGlzLl9mcmFtZXMucHVzaCh7c291cmNlOmIsc291cmNlUmVjdDpnLHNjYWxlOmQsZnVuY3Q6ZSxkYXRhOmYsaW5kZXg6dGhpcy5fZnJhbWVzLmxlbmd0aCxoZWlnaHQ6Zy5oZWlnaHQqZH0pLTEpOm51bGx9LGIuYWRkQW5pbWF0aW9uPWZ1bmN0aW9uKGIsYyxkLGUpe2lmKHRoaXMuX2RhdGEpdGhyb3cgYS5FUlJfUlVOTklORzt0aGlzLl9hbmltYXRpb25zW2JdPXtmcmFtZXM6YyxuZXh0OmQsc3BlZWQ6ZX19LGIuYWRkTW92aWVDbGlwPWZ1bmN0aW9uKGIsYyxkLGUsZixnKXtpZih0aGlzLl9kYXRhKXRocm93IGEuRVJSX1JVTk5JTkc7dmFyIGg9Yi5mcmFtZUJvdW5kcyxpPWN8fGIuYm91bmRzfHxiLm5vbWluYWxCb3VuZHM7aWYoIWkmJmIuZ2V0Qm91bmRzJiYoaT1iLmdldEJvdW5kcygpKSxpfHxoKXt2YXIgaixrLGw9dGhpcy5fZnJhbWVzLmxlbmd0aCxtPWIudGltZWxpbmUuZHVyYXRpb247Zm9yKGo9MDttPmo7aisrKXt2YXIgbj1oJiZoW2pdP2hbal06aTt0aGlzLmFkZEZyYW1lKGIsbixkLHRoaXMuX3NldHVwTW92aWVDbGlwRnJhbWUse2k6aixmOmUsZDpmfSl9dmFyIG89Yi50aW1lbGluZS5fbGFiZWxzLHA9W107Zm9yKHZhciBxIGluIG8pcC5wdXNoKHtpbmRleDpvW3FdLGxhYmVsOnF9KTtpZihwLmxlbmd0aClmb3IocC5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuaW5kZXgtYi5pbmRleH0pLGo9MCxrPXAubGVuZ3RoO2s+ajtqKyspe2Zvcih2YXIgcj1wW2pdLmxhYmVsLHM9bCtwW2pdLmluZGV4LHQ9bCsoaj09ay0xP206cFtqKzFdLmluZGV4KSx1PVtdLHY9czt0PnY7disrKXUucHVzaCh2KTsoIWd8fChyPWcocixiLHMsdCkpKSYmdGhpcy5hZGRBbmltYXRpb24ocix1LCEwKX19fSxiLmJ1aWxkPWZ1bmN0aW9uKCl7aWYodGhpcy5fZGF0YSl0aHJvdyBhLkVSUl9SVU5OSU5HO2Zvcih0aGlzLl9zdGFydEJ1aWxkKCk7dGhpcy5fZHJhd05leHQoKTspO3JldHVybiB0aGlzLl9lbmRCdWlsZCgpLHRoaXMuc3ByaXRlU2hlZXR9LGIuYnVpbGRBc3luYz1mdW5jdGlvbihiKXtpZih0aGlzLl9kYXRhKXRocm93IGEuRVJSX1JVTk5JTkc7dGhpcy50aW1lU2xpY2U9Yix0aGlzLl9zdGFydEJ1aWxkKCk7dmFyIGM9dGhpczt0aGlzLl90aW1lcklEPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtjLl9ydW4oKX0sNTAtNTAqTWF0aC5tYXgoLjAxLE1hdGgubWluKC45OSx0aGlzLnRpbWVTbGljZXx8LjMpKSl9LGIuc3RvcEFzeW5jPWZ1bmN0aW9uKCl7Y2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVySUQpLHRoaXMuX2RhdGE9bnVsbH0sYi5jbG9uZT1mdW5jdGlvbigpe3Rocm93XCJTcHJpdGVTaGVldEJ1aWxkZXIgY2Fubm90IGJlIGNsb25lZC5cIn0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1Nwcml0ZVNoZWV0QnVpbGRlcl1cIn0sYi5fc3RhcnRCdWlsZD1mdW5jdGlvbigpe3ZhciBiPXRoaXMucGFkZGluZ3x8MDt0aGlzLnByb2dyZXNzPTAsdGhpcy5zcHJpdGVTaGVldD1udWxsLHRoaXMuX2luZGV4PTAsdGhpcy5fc2NhbGU9dGhpcy5zY2FsZTt2YXIgYz1bXTt0aGlzLl9kYXRhPXtpbWFnZXM6W10sZnJhbWVzOmMsZnJhbWVyYXRlOnRoaXMuZnJhbWVyYXRlLGFuaW1hdGlvbnM6dGhpcy5fYW5pbWF0aW9uc307dmFyIGQ9dGhpcy5fZnJhbWVzLnNsaWNlKCk7aWYoZC5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuaGVpZ2h0PD1iLmhlaWdodD8tMToxfSksZFtkLmxlbmd0aC0xXS5oZWlnaHQrMipiPnRoaXMubWF4SGVpZ2h0KXRocm93IGEuRVJSX0RJTUVOU0lPTlM7Zm9yKHZhciBlPTAsZj0wLGc9MDtkLmxlbmd0aDspe3ZhciBoPXRoaXMuX2ZpbGxSb3coZCxlLGcsYyxiKTtpZihoLnc+ZiYmKGY9aC53KSxlKz1oLmgsIWguaHx8IWQubGVuZ3RoKXt2YXIgaT1jcmVhdGVqcy5jcmVhdGVDYW52YXM/Y3JlYXRlanMuY3JlYXRlQ2FudmFzKCk6ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtpLndpZHRoPXRoaXMuX2dldFNpemUoZix0aGlzLm1heFdpZHRoKSxpLmhlaWdodD10aGlzLl9nZXRTaXplKGUsdGhpcy5tYXhIZWlnaHQpLHRoaXMuX2RhdGEuaW1hZ2VzW2ddPWksaC5ofHwoZj1lPTAsZysrKX19fSxiLl9zZXR1cE1vdmllQ2xpcEZyYW1lPWZ1bmN0aW9uKGEsYil7dmFyIGM9YS5hY3Rpb25zRW5hYmxlZDthLmFjdGlvbnNFbmFibGVkPSExLGEuZ290b0FuZFN0b3AoYi5pKSxhLmFjdGlvbnNFbmFibGVkPWMsYi5mJiZiLmYoYSxiLmQsYi5pKX0sYi5fZ2V0U2l6ZT1mdW5jdGlvbihhLGIpe2Zvcih2YXIgYz00O01hdGgucG93KDIsKytjKTxhOyk7cmV0dXJuIE1hdGgubWluKGIsTWF0aC5wb3coMixjKSl9LGIuX2ZpbGxSb3c9ZnVuY3Rpb24oYixjLGQsZSxmKXt2YXIgZz10aGlzLm1heFdpZHRoLGg9dGhpcy5tYXhIZWlnaHQ7Yys9Zjtmb3IodmFyIGk9aC1jLGo9ZixrPTAsbD1iLmxlbmd0aC0xO2w+PTA7bC0tKXt2YXIgbT1iW2xdLG49dGhpcy5fc2NhbGUqbS5zY2FsZSxvPW0uc291cmNlUmVjdCxwPW0uc291cmNlLHE9TWF0aC5mbG9vcihuKm8ueC1mKSxyPU1hdGguZmxvb3IobipvLnktZikscz1NYXRoLmNlaWwobipvLmhlaWdodCsyKmYpLHQ9TWF0aC5jZWlsKG4qby53aWR0aCsyKmYpO2lmKHQ+Zyl0aHJvdyBhLkVSUl9ESU1FTlNJT05TO3M+aXx8ait0Pmd8fChtLmltZz1kLG0ucmVjdD1uZXcgY3JlYXRlanMuUmVjdGFuZ2xlKGosYyx0LHMpLGs9a3x8cyxiLnNwbGljZShsLDEpLGVbbS5pbmRleF09W2osYyx0LHMsZCxNYXRoLnJvdW5kKC1xK24qcC5yZWdYLWYpLE1hdGgucm91bmQoLXIrbipwLnJlZ1ktZildLGorPXQpfXJldHVybnt3OmosaDprfX0sYi5fZW5kQnVpbGQ9ZnVuY3Rpb24oKXt0aGlzLnNwcml0ZVNoZWV0PW5ldyBjcmVhdGVqcy5TcHJpdGVTaGVldCh0aGlzLl9kYXRhKSx0aGlzLl9kYXRhPW51bGwsdGhpcy5wcm9ncmVzcz0xLHRoaXMuZGlzcGF0Y2hFdmVudChcImNvbXBsZXRlXCIpfSxiLl9ydW49ZnVuY3Rpb24oKXtmb3IodmFyIGE9NTAqTWF0aC5tYXgoLjAxLE1hdGgubWluKC45OSx0aGlzLnRpbWVTbGljZXx8LjMpKSxiPShuZXcgRGF0ZSkuZ2V0VGltZSgpK2EsYz0hMTtiPihuZXcgRGF0ZSkuZ2V0VGltZSgpOylpZighdGhpcy5fZHJhd05leHQoKSl7Yz0hMDticmVha31pZihjKXRoaXMuX2VuZEJ1aWxkKCk7ZWxzZXt2YXIgZD10aGlzO3RoaXMuX3RpbWVySUQ9c2V0VGltZW91dChmdW5jdGlvbigpe2QuX3J1bigpfSw1MC1hKX12YXIgZT10aGlzLnByb2dyZXNzPXRoaXMuX2luZGV4L3RoaXMuX2ZyYW1lcy5sZW5ndGg7aWYodGhpcy5oYXNFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIikpe3ZhciBmPW5ldyBjcmVhdGVqcy5FdmVudChcInByb2dyZXNzXCIpO2YucHJvZ3Jlc3M9ZSx0aGlzLmRpc3BhdGNoRXZlbnQoZil9fSxiLl9kcmF3TmV4dD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuX2ZyYW1lc1t0aGlzLl9pbmRleF0sYj1hLnNjYWxlKnRoaXMuX3NjYWxlLGM9YS5yZWN0LGQ9YS5zb3VyY2VSZWN0LGU9dGhpcy5fZGF0YS5pbWFnZXNbYS5pbWddLGY9ZS5nZXRDb250ZXh0KFwiMmRcIik7cmV0dXJuIGEuZnVuY3QmJmEuZnVuY3QoYS5zb3VyY2UsYS5kYXRhKSxmLnNhdmUoKSxmLmJlZ2luUGF0aCgpLGYucmVjdChjLngsYy55LGMud2lkdGgsYy5oZWlnaHQpLGYuY2xpcCgpLGYudHJhbnNsYXRlKE1hdGguY2VpbChjLngtZC54KmIpLE1hdGguY2VpbChjLnktZC55KmIpKSxmLnNjYWxlKGIsYiksYS5zb3VyY2UuZHJhdyhmKSxmLnJlc3RvcmUoKSwrK3RoaXMuX2luZGV4PHRoaXMuX2ZyYW1lcy5sZW5ndGh9LGNyZWF0ZWpzLlNwcml0ZVNoZWV0QnVpbGRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJFdmVudERpc3BhdGNoZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5EaXNwbGF5T2JqZWN0X2NvbnN0cnVjdG9yKCksXCJzdHJpbmdcIj09dHlwZW9mIGEmJihhPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGEpKSx0aGlzLm1vdXNlRW5hYmxlZD0hMTt2YXIgYj1hLnN0eWxlO2IucG9zaXRpb249XCJhYnNvbHV0ZVwiLGIudHJhbnNmb3JtT3JpZ2luPWIuV2Via2l0VHJhbnNmb3JtT3JpZ2luPWIubXNUcmFuc2Zvcm1PcmlnaW49Yi5Nb3pUcmFuc2Zvcm1PcmlnaW49Yi5PVHJhbnNmb3JtT3JpZ2luPVwiMCUgMCVcIix0aGlzLmh0bWxFbGVtZW50PWEsdGhpcy5fb2xkUHJvcHM9bnVsbH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5EaXNwbGF5T2JqZWN0KTtiLmlzVmlzaWJsZT1mdW5jdGlvbigpe3JldHVybiBudWxsIT10aGlzLmh0bWxFbGVtZW50fSxiLmRyYXc9ZnVuY3Rpb24oYSxiKXtyZXR1cm4hMH0sYi5jYWNoZT1mdW5jdGlvbigpe30sYi51bmNhY2hlPWZ1bmN0aW9uKCl7fSxiLnVwZGF0ZUNhY2hlPWZ1bmN0aW9uKCl7fSxiLmhpdFRlc3Q9ZnVuY3Rpb24oKXt9LGIubG9jYWxUb0dsb2JhbD1mdW5jdGlvbigpe30sYi5nbG9iYWxUb0xvY2FsPWZ1bmN0aW9uKCl7fSxiLmxvY2FsVG9Mb2NhbD1mdW5jdGlvbigpe30sYi5jbG9uZT1mdW5jdGlvbigpe3Rocm93XCJET01FbGVtZW50IGNhbm5vdCBiZSBjbG9uZWQuXCJ9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltET01FbGVtZW50IChuYW1lPVwiK3RoaXMubmFtZStcIildXCJ9LGIuX3RpY2s9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5nZXRTdGFnZSgpO2ImJmIub24oXCJkcmF3ZW5kXCIsdGhpcy5faGFuZGxlRHJhd0VuZCx0aGlzLCEwKSx0aGlzLkRpc3BsYXlPYmplY3RfX3RpY2soYSl9LGIuX2hhbmRsZURyYXdFbmQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5odG1sRWxlbWVudDtpZihiKXt2YXIgYz1iLnN0eWxlLGQ9dGhpcy5nZXRDb25jYXRlbmF0ZWREaXNwbGF5UHJvcHModGhpcy5fcHJvcHMpLGU9ZC5tYXRyaXgsZj1kLnZpc2libGU/XCJ2aXNpYmxlXCI6XCJoaWRkZW5cIjtpZihmIT1jLnZpc2liaWxpdHkmJihjLnZpc2liaWxpdHk9ZiksZC52aXNpYmxlKXt2YXIgZz10aGlzLl9vbGRQcm9wcyxoPWcmJmcubWF0cml4LGk9MWU0O2lmKCFofHwhaC5lcXVhbHMoZSkpe3ZhciBqPVwibWF0cml4KFwiKyhlLmEqaXwwKS9pK1wiLFwiKyhlLmIqaXwwKS9pK1wiLFwiKyhlLmMqaXwwKS9pK1wiLFwiKyhlLmQqaXwwKS9pK1wiLFwiKyhlLnR4Ky41fDApO2MudHJhbnNmb3JtPWMuV2Via2l0VHJhbnNmb3JtPWMuT1RyYW5zZm9ybT1jLm1zVHJhbnNmb3JtPWorXCIsXCIrKGUudHkrLjV8MCkrXCIpXCIsYy5Nb3pUcmFuc2Zvcm09aitcInB4LFwiKyhlLnR5Ky41fDApK1wicHgpXCIsZ3x8KGc9dGhpcy5fb2xkUHJvcHM9bmV3IGNyZWF0ZWpzLkRpc3BsYXlQcm9wcyghMCxOYU4pKSxnLm1hdHJpeC5jb3B5KGUpfWcuYWxwaGEhPWQuYWxwaGEmJihjLm9wYWNpdHk9XCJcIisoZC5hbHBoYSppfDApL2ksZy5hbHBoYT1kLmFscGhhKX19fSxjcmVhdGVqcy5ET01FbGVtZW50PWNyZWF0ZWpzLnByb21vdGUoYSxcIkRpc3BsYXlPYmplY3RcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt9dmFyIGI9YS5wcm90b3R5cGU7Yi5nZXRCb3VuZHM9ZnVuY3Rpb24oYSl7cmV0dXJuIGF9LGIuYXBwbHlGaWx0ZXI9ZnVuY3Rpb24oYSxiLGMsZCxlLGYsZyxoKXtmPWZ8fGEsbnVsbD09ZyYmKGc9YiksbnVsbD09aCYmKGg9Yyk7dHJ5e3ZhciBpPWEuZ2V0SW1hZ2VEYXRhKGIsYyxkLGUpfWNhdGNoKGope3JldHVybiExfXJldHVybiB0aGlzLl9hcHBseUZpbHRlcihpKT8oZi5wdXRJbWFnZURhdGEoaSxnLGgpLCEwKTohMX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0ZpbHRlcl1cIn0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgYX0sYi5fYXBwbHlGaWx0ZXI9ZnVuY3Rpb24oYSl7cmV0dXJuITB9LGNyZWF0ZWpzLkZpbHRlcj1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjKXsoaXNOYU4oYSl8fDA+YSkmJihhPTApLChpc05hTihiKXx8MD5iKSYmKGI9MCksKGlzTmFOKGMpfHwxPmMpJiYoYz0xKSx0aGlzLmJsdXJYPTB8YSx0aGlzLmJsdXJZPTB8Yix0aGlzLnF1YWxpdHk9MHxjfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkZpbHRlcik7YS5NVUxfVEFCTEU9WzEsMTcxLDIwNSwyOTMsNTcsMzczLDc5LDEzNywyNDEsMjcsMzkxLDM1Nyw0MSwxOSwyODMsMjY1LDQ5Nyw0NjksNDQzLDQyMSwyNSwxOTEsMzY1LDM0OSwzMzUsMTYxLDE1NSwxNDksOSwyNzgsMjY5LDI2MSw1MDUsMjQ1LDQ3NSwyMzEsNDQ5LDQzNywyMTMsNDE1LDQwNSwzOTUsMTkzLDM3NywzNjksMzYxLDM1MywzNDUsMTY5LDMzMSwzMjUsMzE5LDMxMywzMDcsMzAxLDM3LDE0NSwyODUsMjgxLDY5LDI3MSwyNjcsMjYzLDI1OSw1MDksNTAxLDQ5MywyNDMsNDc5LDExOCw0NjUsNDU5LDExMyw0NDYsNTUsNDM1LDQyOSw0MjMsMjA5LDQxMyw1MSw0MDMsMTk5LDM5Myw5NywzLDM3OSwzNzUsMzcxLDM2NywzNjMsMzU5LDM1NSwzNTEsMzQ3LDQzLDg1LDMzNywzMzMsMTY1LDMyNywzMjMsNSwzMTcsMTU3LDMxMSw3NywzMDUsMzAzLDc1LDI5NywyOTQsNzMsMjg5LDI4Nyw3MSwxNDEsMjc5LDI3NywyNzUsNjgsMTM1LDY3LDEzMywzMywyNjIsMjYwLDEyOSw1MTEsNTA3LDUwMyw0OTksNDk1LDQ5MSw2MSwxMjEsNDgxLDQ3NywyMzcsMjM1LDQ2NywyMzIsMTE1LDQ1NywyMjcsNDUxLDcsNDQ1LDIyMSw0MzksMjE4LDQzMywyMTUsNDI3LDQyNSwyMTEsNDE5LDQxNywyMDcsNDExLDQwOSwyMDMsMjAyLDQwMSwzOTksMzk2LDE5Nyw0OSwzODksMzg3LDM4NSwzODMsOTUsMTg5LDQ3LDE4Nyw5MywxODUsMjMsMTgzLDkxLDE4MSw0NSwxNzksODksMTc3LDExLDE3NSw4NywxNzMsMzQ1LDM0MywzNDEsMzM5LDMzNywyMSwxNjcsODMsMzMxLDMyOSwzMjcsMTYzLDgxLDMyMywzMjEsMzE5LDE1OSw3OSwzMTUsMzEzLDM5LDE1NSwzMDksMzA3LDE1MywzMDUsMzAzLDE1MSw3NSwyOTksMTQ5LDM3LDI5NSwxNDcsNzMsMjkxLDE0NSwyODksMjg3LDE0MywyODUsNzEsMTQxLDI4MSwzNSwyNzksMTM5LDY5LDI3NSwxMzcsMjczLDE3LDI3MSwxMzUsMjY5LDI2NywxMzMsMjY1LDMzLDI2MywxMzEsMjYxLDEzMCwyNTksMTI5LDI1NywxXSxhLlNIR19UQUJMRT1bMCw5LDEwLDExLDksMTIsMTAsMTEsMTIsOSwxMywxMywxMCw5LDEzLDEzLDE0LDE0LDE0LDE0LDEwLDEzLDE0LDE0LDE0LDEzLDEzLDEzLDksMTQsMTQsMTQsMTUsMTQsMTUsMTQsMTUsMTUsMTQsMTUsMTUsMTUsMTQsMTUsMTUsMTUsMTUsMTUsMTQsMTUsMTUsMTUsMTUsMTUsMTUsMTIsMTQsMTUsMTUsMTMsMTUsMTUsMTUsMTUsMTYsMTYsMTYsMTUsMTYsMTQsMTYsMTYsMTQsMTYsMTMsMTYsMTYsMTYsMTUsMTYsMTMsMTYsMTUsMTYsMTQsOSwxNiwxNiwxNiwxNiwxNiwxNiwxNiwxNiwxNiwxMywxNCwxNiwxNiwxNSwxNiwxNiwxMCwxNiwxNSwxNiwxNCwxNiwxNiwxNCwxNiwxNiwxNCwxNiwxNiwxNCwxNSwxNiwxNiwxNiwxNCwxNSwxNCwxNSwxMywxNiwxNiwxNSwxNywxNywxNywxNywxNywxNywxNCwxNSwxNywxNywxNiwxNiwxNywxNiwxNSwxNywxNiwxNywxMSwxNywxNiwxNywxNiwxNywxNiwxNywxNywxNiwxNywxNywxNiwxNywxNywxNiwxNiwxNywxNywxNywxNiwxNCwxNywxNywxNywxNywxNSwxNiwxNCwxNiwxNSwxNiwxMywxNiwxNSwxNiwxNCwxNiwxNSwxNiwxMiwxNiwxNSwxNiwxNywxNywxNywxNywxNywxMywxNiwxNSwxNywxNywxNywxNiwxNSwxNywxNywxNywxNiwxNSwxNywxNywxNCwxNiwxNywxNywxNiwxNywxNywxNiwxNSwxNywxNiwxNCwxNywxNiwxNSwxNywxNiwxNywxNywxNiwxNywxNSwxNiwxNywxNCwxNywxNiwxNSwxNywxNiwxNywxMywxNywxNiwxNywxNywxNiwxNywxNCwxNywxNiwxNywxNiwxNywxNiwxNyw5XSxiLmdldEJvdW5kcz1mdW5jdGlvbihhKXt2YXIgYj0wfHRoaXMuYmx1clgsYz0wfHRoaXMuYmx1clk7aWYoMD49YiYmMD49YylyZXR1cm4gYTt2YXIgZD1NYXRoLnBvdyh0aGlzLnF1YWxpdHksLjIpO3JldHVybihhfHxuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKS5wYWQoYipkKzEsYypkKzEsYipkKzEsYypkKzEpfSxiLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBhKHRoaXMuYmx1clgsdGhpcy5ibHVyWSx0aGlzLnF1YWxpdHkpfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbQmx1ckZpbHRlcl1cIn0sYi5fYXBwbHlGaWx0ZXI9ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5ibHVyWD4+MTtpZihpc05hTihjKXx8MD5jKXJldHVybiExO3ZhciBkPXRoaXMuYmx1clk+PjE7aWYoaXNOYU4oZCl8fDA+ZClyZXR1cm4hMTtpZigwPT1jJiYwPT1kKXJldHVybiExO3ZhciBlPXRoaXMucXVhbGl0eTsoaXNOYU4oZSl8fDE+ZSkmJihlPTEpLGV8PTAsZT4zJiYoZT0zKSwxPmUmJihlPTEpO3ZhciBmPWIuZGF0YSxnPTAsaD0wLGk9MCxqPTAsaz0wLGw9MCxtPTAsbj0wLG89MCxwPTAscT0wLHI9MCxzPTAsdD0wLHU9MCx2PWMrYysxfDAsdz1kK2QrMXwwLHg9MHxiLndpZHRoLHk9MHxiLmhlaWdodCx6PXgtMXwwLEE9eS0xfDAsQj1jKzF8MCxDPWQrMXwwLEQ9e3I6MCxiOjAsZzowLGE6MH0sRT1EO2ZvcihpPTE7dj5pO2krKylFPUUubj17cjowLGI6MCxnOjAsYTowfTtFLm49RDt2YXIgRj17cjowLGI6MCxnOjAsYTowfSxHPUY7Zm9yKGk9MTt3Pmk7aSsrKUc9Ry5uPXtyOjAsYjowLGc6MCxhOjB9O0cubj1GO2Zvcih2YXIgSD1udWxsLEk9MHxhLk1VTF9UQUJMRVtjXSxKPTB8YS5TSEdfVEFCTEVbY10sSz0wfGEuTVVMX1RBQkxFW2RdLEw9MHxhLlNIR19UQUJMRVtkXTtlLS0+MDspe209bD0wO3ZhciBNPUksTj1KO2ZvcihoPXk7LS1oPi0xOyl7Zm9yKG49Qioocj1mWzB8bF0pLG89Qioocz1mW2wrMXwwXSkscD1CKih0PWZbbCsyfDBdKSxxPUIqKHU9ZltsKzN8MF0pLEU9RCxpPUI7LS1pPi0xOylFLnI9cixFLmc9cyxFLmI9dCxFLmE9dSxFPUUubjtmb3IoaT0xO0I+aTtpKyspaj1sKygoaT56P3o6aSk8PDIpfDAsbis9RS5yPWZbal0sbys9RS5nPWZbaisxXSxwKz1FLmI9ZltqKzJdLHErPUUuYT1mW2orM10sRT1FLm47Zm9yKEg9RCxnPTA7eD5nO2crKylmW2wrK109bipNPj4+TixmW2wrK109bypNPj4+TixmW2wrK109cCpNPj4+TixmW2wrK109cSpNPj4+TixqPW0rKChqPWcrYysxKTx6P2o6eik8PDIsbi09SC5yLShILnI9ZltqXSksby09SC5nLShILmc9ZltqKzFdKSxwLT1ILmItKEguYj1mW2orMl0pLHEtPUguYS0oSC5hPWZbaiszXSksSD1ILm47bSs9eH1mb3IoTT1LLE49TCxnPTA7eD5nO2crKyl7Zm9yKGw9Zzw8MnwwLG49Qyoocj1mW2xdKXwwLG89Qyoocz1mW2wrMXwwXSl8MCxwPUMqKHQ9ZltsKzJ8MF0pfDAscT1DKih1PWZbbCszfDBdKXwwLEc9RixpPTA7Qz5pO2krKylHLnI9cixHLmc9cyxHLmI9dCxHLmE9dSxHPUcubjtmb3Ioaz14LGk9MTtkPj1pO2krKylsPWsrZzw8MixuKz1HLnI9ZltsXSxvKz1HLmc9ZltsKzFdLHArPUcuYj1mW2wrMl0scSs9Ry5hPWZbbCszXSxHPUcubixBPmkmJihrKz14KTtpZihsPWcsSD1GLGU+MClmb3IoaD0wO3k+aDtoKyspaj1sPDwyLGZbaiszXT11PXEqTT4+Pk4sdT4wPyhmW2pdPW4qTT4+Pk4sZltqKzFdPW8qTT4+Pk4sZltqKzJdPXAqTT4+Pk4pOmZbal09ZltqKzFdPWZbaisyXT0wLGo9ZysoKGo9aCtDKTxBP2o6QSkqeDw8MixuLT1ILnItKEgucj1mW2pdKSxvLT1ILmctKEguZz1mW2orMV0pLHAtPUguYi0oSC5iPWZbaisyXSkscS09SC5hLShILmE9ZltqKzNdKSxIPUgubixsKz14O2Vsc2UgZm9yKGg9MDt5Pmg7aCsrKWo9bDw8MixmW2orM109dT1xKk0+Pj5OLHU+MD8odT0yNTUvdSxmW2pdPShuKk0+Pj5OKSp1LGZbaisxXT0obypNPj4+TikqdSxmW2orMl09KHAqTT4+Pk4pKnUpOmZbal09ZltqKzFdPWZbaisyXT0wLGo9ZysoKGo9aCtDKTxBP2o6QSkqeDw8MixuLT1ILnItKEgucj1mW2pdKSxvLT1ILmctKEguZz1mW2orMV0pLHAtPUguYi0oSC5iPWZbaisyXSkscS09SC5hLShILmE9ZltqKzNdKSxIPUgubixsKz14fX1yZXR1cm4hMH0sY3JlYXRlanMuQmx1ckZpbHRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJGaWx0ZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5hbHBoYU1hcD1hLHRoaXMuX2FscGhhTWFwPW51bGwsdGhpcy5fbWFwRGF0YT1udWxsfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkZpbHRlcik7Yi5jbG9uZT1mdW5jdGlvbigpe3ZhciBiPW5ldyBhKHRoaXMuYWxwaGFNYXApO3JldHVybiBiLl9hbHBoYU1hcD10aGlzLl9hbHBoYU1hcCxiLl9tYXBEYXRhPXRoaXMuX21hcERhdGEsYn0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0FscGhhTWFwRmlsdGVyXVwifSxiLl9hcHBseUZpbHRlcj1mdW5jdGlvbihhKXtpZighdGhpcy5hbHBoYU1hcClyZXR1cm4hMDtpZighdGhpcy5fcHJlcEFscGhhTWFwKCkpcmV0dXJuITE7Zm9yKHZhciBiPWEuZGF0YSxjPXRoaXMuX21hcERhdGEsZD0wLGU9Yi5sZW5ndGg7ZT5kO2QrPTQpYltkKzNdPWNbZF18fDA7cmV0dXJuITB9LGIuX3ByZXBBbHBoYU1hcD1mdW5jdGlvbigpe2lmKCF0aGlzLmFscGhhTWFwKXJldHVybiExO2lmKHRoaXMuYWxwaGFNYXA9PXRoaXMuX2FscGhhTWFwJiZ0aGlzLl9tYXBEYXRhKXJldHVybiEwO3RoaXMuX21hcERhdGE9bnVsbDt2YXIgYSxiPXRoaXMuX2FscGhhTWFwPXRoaXMuYWxwaGFNYXAsYz1iO2IgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudD9hPWMuZ2V0Q29udGV4dChcIjJkXCIpOihjPWNyZWF0ZWpzLmNyZWF0ZUNhbnZhcz9jcmVhdGVqcy5jcmVhdGVDYW52YXMoKTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLGMud2lkdGg9Yi53aWR0aCxjLmhlaWdodD1iLmhlaWdodCxhPWMuZ2V0Q29udGV4dChcIjJkXCIpLGEuZHJhd0ltYWdlKGIsMCwwKSk7dHJ5e3ZhciBkPWEuZ2V0SW1hZ2VEYXRhKDAsMCxiLndpZHRoLGIuaGVpZ2h0KX1jYXRjaChlKXtyZXR1cm4hMX1yZXR1cm4gdGhpcy5fbWFwRGF0YT1kLmRhdGEsITB9LGNyZWF0ZWpzLkFscGhhTWFwRmlsdGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkZpbHRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLm1hc2s9YX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5GaWx0ZXIpO2IuYXBwbHlGaWx0ZXI9ZnVuY3Rpb24oYSxiLGMsZCxlLGYsZyxoKXtyZXR1cm4gdGhpcy5tYXNrPyhmPWZ8fGEsbnVsbD09ZyYmKGc9YiksbnVsbD09aCYmKGg9YyksZi5zYXZlKCksYSE9Zj8hMTooZi5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb249XCJkZXN0aW5hdGlvbi1pblwiLGYuZHJhd0ltYWdlKHRoaXMubWFzayxnLGgpLGYucmVzdG9yZSgpLCEwKSk6ITB9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy5tYXNrKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW0FscGhhTWFza0ZpbHRlcl1cIn0sY3JlYXRlanMuQWxwaGFNYXNrRmlsdGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkZpbHRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyxkLGUsZixnLGgpe3RoaXMucmVkTXVsdGlwbGllcj1udWxsIT1hP2E6MSx0aGlzLmdyZWVuTXVsdGlwbGllcj1udWxsIT1iP2I6MSx0aGlzLmJsdWVNdWx0aXBsaWVyPW51bGwhPWM/YzoxLHRoaXMuYWxwaGFNdWx0aXBsaWVyPW51bGwhPWQ/ZDoxLHRoaXMucmVkT2Zmc2V0PWV8fDAsdGhpcy5ncmVlbk9mZnNldD1mfHwwLHRoaXMuYmx1ZU9mZnNldD1nfHwwLHRoaXMuYWxwaGFPZmZzZXQ9aHx8MH12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5GaWx0ZXIpO2IudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltDb2xvckZpbHRlcl1cIn0sYi5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgYSh0aGlzLnJlZE11bHRpcGxpZXIsdGhpcy5ncmVlbk11bHRpcGxpZXIsdGhpcy5ibHVlTXVsdGlwbGllcix0aGlzLmFscGhhTXVsdGlwbGllcix0aGlzLnJlZE9mZnNldCx0aGlzLmdyZWVuT2Zmc2V0LHRoaXMuYmx1ZU9mZnNldCx0aGlzLmFscGhhT2Zmc2V0KX0sYi5fYXBwbHlGaWx0ZXI9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPWEuZGF0YSxjPWIubGVuZ3RoLGQ9MDtjPmQ7ZCs9NCliW2RdPWJbZF0qdGhpcy5yZWRNdWx0aXBsaWVyK3RoaXMucmVkT2Zmc2V0LGJbZCsxXT1iW2QrMV0qdGhpcy5ncmVlbk11bHRpcGxpZXIrdGhpcy5ncmVlbk9mZnNldCxiW2QrMl09YltkKzJdKnRoaXMuYmx1ZU11bHRpcGxpZXIrdGhpcy5ibHVlT2Zmc2V0LGJbZCszXT1iW2QrM10qdGhpcy5hbHBoYU11bHRpcGxpZXIrdGhpcy5hbHBoYU9mZnNldDtyZXR1cm4hMH0sY3JlYXRlanMuQ29sb3JGaWx0ZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiRmlsdGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQpe3RoaXMuc2V0Q29sb3IoYSxiLGMsZCl9dmFyIGI9YS5wcm90b3R5cGU7YS5ERUxUQV9JTkRFWD1bMCwuMDEsLjAyLC4wNCwuMDUsLjA2LC4wNywuMDgsLjEsLjExLC4xMiwuMTQsLjE1LC4xNiwuMTcsLjE4LC4yLC4yMSwuMjIsLjI0LC4yNSwuMjcsLjI4LC4zLC4zMiwuMzQsLjM2LC4zOCwuNCwuNDIsLjQ0LC40NiwuNDgsLjUsLjUzLC41NiwuNTksLjYyLC42NSwuNjgsLjcxLC43NCwuNzcsLjgsLjgzLC44NiwuODksLjkyLC45NSwuOTgsMSwxLjA2LDEuMTIsMS4xOCwxLjI0LDEuMywxLjM2LDEuNDIsMS40OCwxLjU0LDEuNiwxLjY2LDEuNzIsMS43OCwxLjg0LDEuOSwxLjk2LDIsMi4xMiwyLjI1LDIuMzcsMi41LDIuNjIsMi43NSwyLjg3LDMsMy4yLDMuNCwzLjYsMy44LDQsNC4zLDQuNyw0LjksNSw1LjUsNiw2LjUsNi44LDcsNy4zLDcuNSw3LjgsOCw4LjQsOC43LDksOS40LDkuNiw5LjgsMTBdLGEuSURFTlRJVFlfTUFUUklYPVsxLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwxXSxhLkxFTkdUSD1hLklERU5USVRZX01BVFJJWC5sZW5ndGgsYi5zZXRDb2xvcj1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5yZXNldCgpLmFkanVzdENvbG9yKGEsYixjLGQpfSxiLnJlc2V0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29weShhLklERU5USVRZX01BVFJJWCl9LGIuYWRqdXN0Q29sb3I9ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMuYWRqdXN0SHVlKGQpLHRoaXMuYWRqdXN0Q29udHJhc3QoYiksdGhpcy5hZGp1c3RCcmlnaHRuZXNzKGEpLHRoaXMuYWRqdXN0U2F0dXJhdGlvbihjKX0sYi5hZGp1c3RCcmlnaHRuZXNzPWZ1bmN0aW9uKGEpe3JldHVybiAwPT1hfHxpc05hTihhKT90aGlzOihhPXRoaXMuX2NsZWFuVmFsdWUoYSwyNTUpLHRoaXMuX211bHRpcGx5TWF0cml4KFsxLDAsMCwwLGEsMCwxLDAsMCxhLDAsMCwxLDAsYSwwLDAsMCwxLDAsMCwwLDAsMCwxXSksdGhpcyl9LGIuYWRqdXN0Q29udHJhc3Q9ZnVuY3Rpb24oYil7aWYoMD09Ynx8aXNOYU4oYikpcmV0dXJuIHRoaXM7Yj10aGlzLl9jbGVhblZhbHVlKGIsMTAwKTt2YXIgYztyZXR1cm4gMD5iP2M9MTI3K2IvMTAwKjEyNzooYz1iJTEsYz0wPT1jP2EuREVMVEFfSU5ERVhbYl06YS5ERUxUQV9JTkRFWFtiPDwwXSooMS1jKSthLkRFTFRBX0lOREVYWyhiPDwwKSsxXSpjLGM9MTI3KmMrMTI3KSx0aGlzLl9tdWx0aXBseU1hdHJpeChbYy8xMjcsMCwwLDAsLjUqKDEyNy1jKSwwLGMvMTI3LDAsMCwuNSooMTI3LWMpLDAsMCxjLzEyNywwLC41KigxMjctYyksMCwwLDAsMSwwLDAsMCwwLDAsMV0pLHRoaXN9LGIuYWRqdXN0U2F0dXJhdGlvbj1mdW5jdGlvbihhKXtpZigwPT1hfHxpc05hTihhKSlyZXR1cm4gdGhpczthPXRoaXMuX2NsZWFuVmFsdWUoYSwxMDApO3ZhciBiPTErKGE+MD8zKmEvMTAwOmEvMTAwKSxjPS4zMDg2LGQ9LjYwOTQsZT0uMDgyO3JldHVybiB0aGlzLl9tdWx0aXBseU1hdHJpeChbYyooMS1iKStiLGQqKDEtYiksZSooMS1iKSwwLDAsYyooMS1iKSxkKigxLWIpK2IsZSooMS1iKSwwLDAsYyooMS1iKSxkKigxLWIpLGUqKDEtYikrYiwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMV0pLHRoaXN9LGIuYWRqdXN0SHVlPWZ1bmN0aW9uKGEpe2lmKDA9PWF8fGlzTmFOKGEpKXJldHVybiB0aGlzO2E9dGhpcy5fY2xlYW5WYWx1ZShhLDE4MCkvMTgwKk1hdGguUEk7dmFyIGI9TWF0aC5jb3MoYSksYz1NYXRoLnNpbihhKSxkPS4yMTMsZT0uNzE1LGY9LjA3MjtyZXR1cm4gdGhpcy5fbXVsdGlwbHlNYXRyaXgoW2QrYiooMS1kKStjKi1kLGUrYiotZStjKi1lLGYrYiotZitjKigxLWYpLDAsMCxkK2IqLWQrLjE0MypjLGUrYiooMS1lKSsuMTQqYyxmK2IqLWYrYyotLjI4MywwLDAsZCtiKi1kK2MqLSgxLWQpLGUrYiotZStjKmUsZitiKigxLWYpK2MqZiwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMV0pLHRoaXN9LGIuY29uY2F0PWZ1bmN0aW9uKGIpe3JldHVybiBiPXRoaXMuX2ZpeE1hdHJpeChiKSxiLmxlbmd0aCE9YS5MRU5HVEg/dGhpczoodGhpcy5fbXVsdGlwbHlNYXRyaXgoYiksdGhpcyl9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4obmV3IGEpLmNvcHkodGhpcyl9LGIudG9BcnJheT1mdW5jdGlvbigpe2Zvcih2YXIgYj1bXSxjPTAsZD1hLkxFTkdUSDtkPmM7YysrKWJbY109dGhpc1tjXTtyZXR1cm4gYn0sYi5jb3B5PWZ1bmN0aW9uKGIpe2Zvcih2YXIgYz1hLkxFTkdUSCxkPTA7Yz5kO2QrKyl0aGlzW2RdPWJbZF07cmV0dXJuIHRoaXN9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltDb2xvck1hdHJpeF1cIn0sYi5fbXVsdGlwbHlNYXRyaXg9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGU9W107Zm9yKGI9MDs1PmI7YisrKXtmb3IoYz0wOzU+YztjKyspZVtjXT10aGlzW2MrNSpiXTtmb3IoYz0wOzU+YztjKyspe3ZhciBmPTA7Zm9yKGQ9MDs1PmQ7ZCsrKWYrPWFbYys1KmRdKmVbZF07dGhpc1tjKzUqYl09Zn19fSxiLl9jbGVhblZhbHVlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIE1hdGgubWluKGIsTWF0aC5tYXgoLWIsYSkpfSxiLl9maXhNYXRyaXg9ZnVuY3Rpb24oYil7cmV0dXJuIGIgaW5zdGFuY2VvZiBhJiYoYj1iLnRvQXJyYXkoKSksYi5sZW5ndGg8YS5MRU5HVEg/Yj1iLnNsaWNlKDAsYi5sZW5ndGgpLmNvbmNhdChhLklERU5USVRZX01BVFJJWC5zbGljZShiLmxlbmd0aCxhLkxFTkdUSCkpOmIubGVuZ3RoPmEuTEVOR1RIJiYoYj1iLnNsaWNlKDAsYS5MRU5HVEgpKSxifSxjcmVhdGVqcy5Db2xvck1hdHJpeD1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMubWF0cml4PWF9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRmlsdGVyKTtiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbQ29sb3JNYXRyaXhGaWx0ZXJdXCJ9LGIuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGEodGhpcy5tYXRyaXgpfSxiLl9hcHBseUZpbHRlcj1mdW5jdGlvbihhKXtmb3IodmFyIGIsYyxkLGUsZj1hLmRhdGEsZz1mLmxlbmd0aCxoPXRoaXMubWF0cml4LGk9aFswXSxqPWhbMV0saz1oWzJdLGw9aFszXSxtPWhbNF0sbj1oWzVdLG89aFs2XSxwPWhbN10scT1oWzhdLHI9aFs5XSxzPWhbMTBdLHQ9aFsxMV0sdT1oWzEyXSx2PWhbMTNdLHc9aFsxNF0seD1oWzE1XSx5PWhbMTZdLHo9aFsxN10sQT1oWzE4XSxCPWhbMTldLEM9MDtnPkM7Qys9NCliPWZbQ10sYz1mW0MrMV0sZD1mW0MrMl0sZT1mW0MrM10sZltDXT1iKmkrYypqK2QqaytlKmwrbSxmW0MrMV09YipuK2MqbytkKnArZSpxK3IsZltDKzJdPWIqcytjKnQrZCp1K2Uqdit3LGZbQyszXT1iKngrYyp5K2QqeitlKkErQjtyZXR1cm4hMH0sY3JlYXRlanMuQ29sb3JNYXRyaXhGaWx0ZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiRmlsdGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhyb3dcIlRvdWNoIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWRcIn1hLmlzU3VwcG9ydGVkPWZ1bmN0aW9uKCl7cmV0dXJuISEoXCJvbnRvdWNoc3RhcnRcImluIHdpbmRvd3x8d2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkJiZ3aW5kb3cubmF2aWdhdG9yLm1zTWF4VG91Y2hQb2ludHM+MHx8d2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZCYmd2luZG93Lm5hdmlnYXRvci5tYXhUb3VjaFBvaW50cz4wKX0sYS5lbmFibGU9ZnVuY3Rpb24oYixjLGQpe3JldHVybiBiJiZiLmNhbnZhcyYmYS5pc1N1cHBvcnRlZCgpP2IuX190b3VjaD8hMDooYi5fX3RvdWNoPXtwb2ludGVyczp7fSxtdWx0aXRvdWNoOiFjLHByZXZlbnREZWZhdWx0OiFkLGNvdW50OjB9LFwib250b3VjaHN0YXJ0XCJpbiB3aW5kb3c/YS5fSU9TX2VuYWJsZShiKTood2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkfHx3aW5kb3cubmF2aWdhdG9yLnBvaW50ZXJFbmFibGVkKSYmYS5fSUVfZW5hYmxlKGIpLCEwKTohMX0sYS5kaXNhYmxlPWZ1bmN0aW9uKGIpe2ImJihcIm9udG91Y2hzdGFydFwiaW4gd2luZG93P2EuX0lPU19kaXNhYmxlKGIpOih3aW5kb3cubmF2aWdhdG9yLm1zUG9pbnRlckVuYWJsZWR8fHdpbmRvdy5uYXZpZ2F0b3IucG9pbnRlckVuYWJsZWQpJiZhLl9JRV9kaXNhYmxlKGIpLGRlbGV0ZSBiLl9fdG91Y2gpfSxhLl9JT1NfZW5hYmxlPWZ1bmN0aW9uKGIpe3ZhciBjPWIuY2FudmFzLGQ9Yi5fX3RvdWNoLmY9ZnVuY3Rpb24oYyl7YS5fSU9TX2hhbmRsZUV2ZW50KGIsYyl9O2MuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIixkLCExKSxjLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIixkLCExKSxjLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLGQsITEpLGMuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoY2FuY2VsXCIsZCwhMSl9LGEuX0lPU19kaXNhYmxlPWZ1bmN0aW9uKGEpe3ZhciBiPWEuY2FudmFzO2lmKGIpe3ZhciBjPWEuX190b3VjaC5mO2IucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIixjLCExKSxiLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIixjLCExKSxiLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLGMsITEpLGIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoY2FuY2VsXCIsYywhMSl9fSxhLl9JT1NfaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oYSxiKXtpZihhKXthLl9fdG91Y2gucHJldmVudERlZmF1bHQmJmIucHJldmVudERlZmF1bHQmJmIucHJldmVudERlZmF1bHQoKTtmb3IodmFyIGM9Yi5jaGFuZ2VkVG91Y2hlcyxkPWIudHlwZSxlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKXt2YXIgZz1jW2VdLGg9Zy5pZGVudGlmaWVyO2cudGFyZ2V0PT1hLmNhbnZhcyYmKFwidG91Y2hzdGFydFwiPT1kP3RoaXMuX2hhbmRsZVN0YXJ0KGEsaCxiLGcucGFnZVgsZy5wYWdlWSk6XCJ0b3VjaG1vdmVcIj09ZD90aGlzLl9oYW5kbGVNb3ZlKGEsaCxiLGcucGFnZVgsZy5wYWdlWSk6KFwidG91Y2hlbmRcIj09ZHx8XCJ0b3VjaGNhbmNlbFwiPT1kKSYmdGhpcy5faGFuZGxlRW5kKGEsaCxiKSl9fX0sYS5fSUVfZW5hYmxlPWZ1bmN0aW9uKGIpe3ZhciBjPWIuY2FudmFzLGQ9Yi5fX3RvdWNoLmY9ZnVuY3Rpb24oYyl7YS5fSUVfaGFuZGxlRXZlbnQoYixjKX07dm9pZCAwPT09d2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZD8oYy5hZGRFdmVudExpc3RlbmVyKFwiTVNQb2ludGVyRG93blwiLGQsITEpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiTVNQb2ludGVyTW92ZVwiLGQsITEpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiTVNQb2ludGVyVXBcIixkLCExKSx3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIk1TUG9pbnRlckNhbmNlbFwiLGQsITEpLGIuX190b3VjaC5wcmV2ZW50RGVmYXVsdCYmKGMuc3R5bGUubXNUb3VjaEFjdGlvbj1cIm5vbmVcIikpOihjLmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLGQsITEpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcm1vdmVcIixkLCExKSx3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJ1cFwiLGQsITEpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcmNhbmNlbFwiLGQsITEpLGIuX190b3VjaC5wcmV2ZW50RGVmYXVsdCYmKGMuc3R5bGUudG91Y2hBY3Rpb249XCJub25lXCIpKSxiLl9fdG91Y2guYWN0aXZlSURzPXt9fSxhLl9JRV9kaXNhYmxlPWZ1bmN0aW9uKGEpe3ZhciBiPWEuX190b3VjaC5mO3ZvaWQgMD09PXdpbmRvdy5uYXZpZ2F0b3IucG9pbnRlckVuYWJsZWQ/KHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiTVNQb2ludGVyTW92ZVwiLGIsITEpLHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiTVNQb2ludGVyVXBcIixiLCExKSx3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIk1TUG9pbnRlckNhbmNlbFwiLGIsITEpLGEuY2FudmFzJiZhLmNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKFwiTVNQb2ludGVyRG93blwiLGIsITEpKTood2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVybW92ZVwiLGIsITEpLHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcnVwXCIsYiwhMSksd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVyY2FuY2VsXCIsYiwhMSksYS5jYW52YXMmJmEuY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLGIsITEpKX0sYS5fSUVfaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oYSxiKXtpZihhKXthLl9fdG91Y2gucHJldmVudERlZmF1bHQmJmIucHJldmVudERlZmF1bHQmJmIucHJldmVudERlZmF1bHQoKTt2YXIgYz1iLnR5cGUsZD1iLnBvaW50ZXJJZCxlPWEuX190b3VjaC5hY3RpdmVJRHM7aWYoXCJNU1BvaW50ZXJEb3duXCI9PWN8fFwicG9pbnRlcmRvd25cIj09Yyl7aWYoYi5zcmNFbGVtZW50IT1hLmNhbnZhcylyZXR1cm47ZVtkXT0hMCx0aGlzLl9oYW5kbGVTdGFydChhLGQsYixiLnBhZ2VYLGIucGFnZVkpfWVsc2UgZVtkXSYmKFwiTVNQb2ludGVyTW92ZVwiPT1jfHxcInBvaW50ZXJtb3ZlXCI9PWM/dGhpcy5faGFuZGxlTW92ZShhLGQsYixiLnBhZ2VYLGIucGFnZVkpOihcIk1TUG9pbnRlclVwXCI9PWN8fFwiTVNQb2ludGVyQ2FuY2VsXCI9PWN8fFwicG9pbnRlcnVwXCI9PWN8fFwicG9pbnRlcmNhbmNlbFwiPT1jKSYmKGRlbGV0ZSBlW2RdLHRoaXMuX2hhbmRsZUVuZChhLGQsYikpKX19LGEuX2hhbmRsZVN0YXJ0PWZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9YS5fX3RvdWNoO2lmKGYubXVsdGl0b3VjaHx8IWYuY291bnQpe3ZhciBnPWYucG9pbnRlcnM7Z1tiXXx8KGdbYl09ITAsZi5jb3VudCsrLGEuX2hhbmRsZVBvaW50ZXJEb3duKGIsYyxkLGUpKX19LGEuX2hhbmRsZU1vdmU9ZnVuY3Rpb24oYSxiLGMsZCxlKXthLl9fdG91Y2gucG9pbnRlcnNbYl0mJmEuX2hhbmRsZVBvaW50ZXJNb3ZlKGIsYyxkLGUpfSxhLl9oYW5kbGVFbmQ9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEuX190b3VjaCxlPWQucG9pbnRlcnM7ZVtiXSYmKGQuY291bnQtLSxhLl9oYW5kbGVQb2ludGVyVXAoYixjLCEwKSxkZWxldGUgZVtiXSl9LGNyZWF0ZWpzLlRvdWNoPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO3ZhciBhPWNyZWF0ZWpzLkVhc2VsSlM9Y3JlYXRlanMuRWFzZWxKU3x8e307YS52ZXJzaW9uPVwiMC44LjJcIixhLmJ1aWxkRGF0ZT1cIlRodSwgMjYgTm92IDIwMTUgMjA6NDQ6MzQgR01UXCJ9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO3ZhciBhPWNyZWF0ZWpzLlByZWxvYWRKUz1jcmVhdGVqcy5QcmVsb2FkSlN8fHt9O2EudmVyc2lvbj1cIjAuNi4yXCIsYS5idWlsZERhdGU9XCJUaHUsIDI2IE5vdiAyMDE1IDIwOjQ0OjMxIEdNVFwifSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtjcmVhdGVqcy5wcm94eT1mdW5jdGlvbihhLGIpe3ZhciBjPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywyKTtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShiLEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywwKS5jb25jYXQoYykpfX19KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMpe3RoaXMuRXZlbnRfY29uc3RydWN0b3IoXCJlcnJvclwiKSx0aGlzLnRpdGxlPWEsdGhpcy5tZXNzYWdlPWIsdGhpcy5kYXRhPWN9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuRXZlbnQpO2IuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQodGhpcy50aXRsZSx0aGlzLm1lc3NhZ2UsdGhpcy5kYXRhKX0sY3JlYXRlanMuRXJyb3JFdmVudD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJFdmVudFwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKGEpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGIoYSxiKXt0aGlzLkV2ZW50X2NvbnN0cnVjdG9yKFwicHJvZ3Jlc3NcIiksdGhpcy5sb2FkZWQ9YSx0aGlzLnRvdGFsPW51bGw9PWI/MTpiLHRoaXMucHJvZ3Jlc3M9MD09Yj8wOnRoaXMubG9hZGVkL3RoaXMudG90YWx9dmFyIGM9Y3JlYXRlanMuZXh0ZW5kKGIsY3JlYXRlanMuRXZlbnQpO2MuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGNyZWF0ZWpzLlByb2dyZXNzRXZlbnQodGhpcy5sb2FkZWQsdGhpcy50b3RhbCl9LGNyZWF0ZWpzLlByb2dyZXNzRXZlbnQ9Y3JlYXRlanMucHJvbW90ZShiLFwiRXZlbnRcIil9KHdpbmRvdyksZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIsZCl7ZnVuY3Rpb24gZihhKXtpZihmW2FdIT09cSlyZXR1cm4gZlthXTt2YXIgYjtpZihcImJ1Zy1zdHJpbmctY2hhci1pbmRleFwiPT1hKWI9XCJhXCIhPVwiYVwiWzBdO2Vsc2UgaWYoXCJqc29uXCI9PWEpYj1mKFwianNvbi1zdHJpbmdpZnlcIikmJmYoXCJqc29uLXBhcnNlXCIpO2Vsc2V7dmFyIGMsZT0ne1wiYVwiOlsxLHRydWUsZmFsc2UsbnVsbCxcIlxcXFx1MDAwMFxcXFxiXFxcXG5cXFxcZlxcXFxyXFxcXHRcIl19JztpZihcImpzb24tc3RyaW5naWZ5XCI9PWEpe3ZhciBpPWQuc3RyaW5naWZ5LGs9XCJmdW5jdGlvblwiPT10eXBlb2YgaSYmdDtpZihrKXsoYz1mdW5jdGlvbigpe3JldHVybiAxfSkudG9KU09OPWM7dHJ5e2s9XCIwXCI9PT1pKDApJiZcIjBcIj09PWkobmV3IGcpJiYnXCJcIic9PWkobmV3IGgpJiZpKHMpPT09cSYmaShxKT09PXEmJmkoKT09PXEmJlwiMVwiPT09aShjKSYmXCJbMV1cIj09aShbY10pJiZcIltudWxsXVwiPT1pKFtxXSkmJlwibnVsbFwiPT1pKG51bGwpJiZcIltudWxsLG51bGwsbnVsbF1cIj09aShbcSxzLG51bGxdKSYmaSh7YTpbYywhMCwhMSxudWxsLFwiXFx4MDBcXGJcXG5cXGZcXHJcdFwiXX0pPT1lJiZcIjFcIj09PWkobnVsbCxjKSYmXCJbXFxuIDEsXFxuIDJcXG5dXCI9PWkoWzEsMl0sbnVsbCwxKSYmJ1wiLTI3MTgyMS0wNC0yMFQwMDowMDowMC4wMDBaXCInPT1pKG5ldyBqKC04NjRlMTMpKSYmJ1wiKzI3NTc2MC0wOS0xM1QwMDowMDowMC4wMDBaXCInPT1pKG5ldyBqKDg2NGUxMykpJiYnXCItMDAwMDAxLTAxLTAxVDAwOjAwOjAwLjAwMFpcIic9PWkobmV3IGooLTYyMTk4NzU1MmU1KSkmJidcIjE5NjktMTItMzFUMjM6NTk6NTkuOTk5WlwiJz09aShuZXcgaigtMSkpfWNhdGNoKGwpe2s9ITF9fWI9a31pZihcImpzb24tcGFyc2VcIj09YSl7dmFyIG09ZC5wYXJzZTtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBtKXRyeXtpZigwPT09bShcIjBcIikmJiFtKCExKSl7Yz1tKGUpO3ZhciBuPTU9PWMuYS5sZW5ndGgmJjE9PT1jLmFbMF07aWYobil7dHJ5e249IW0oJ1wiXHRcIicpfWNhdGNoKGwpe31pZihuKXRyeXtuPTEhPT1tKFwiMDFcIil9Y2F0Y2gobCl7fWlmKG4pdHJ5e249MSE9PW0oXCIxLlwiKX1jYXRjaChsKXt9fX19Y2F0Y2gobCl7bj0hMX1iPW59fXJldHVybiBmW2FdPSEhYn1ifHwoYj1lLk9iamVjdCgpKSxkfHwoZD1lLk9iamVjdCgpKTt2YXIgZz1iLk51bWJlcnx8ZS5OdW1iZXIsaD1iLlN0cmluZ3x8ZS5TdHJpbmcsaT1iLk9iamVjdHx8ZS5PYmplY3Qsaj1iLkRhdGV8fGUuRGF0ZSxrPWIuU3ludGF4RXJyb3J8fGUuU3ludGF4RXJyb3IsbD1iLlR5cGVFcnJvcnx8ZS5UeXBlRXJyb3IsbT1iLk1hdGh8fGUuTWF0aCxuPWIuSlNPTnx8ZS5KU09OO1wib2JqZWN0XCI9PXR5cGVvZiBuJiZuJiYoZC5zdHJpbmdpZnk9bi5zdHJpbmdpZnksZC5wYXJzZT1uLnBhcnNlKTt2YXIgbyxwLHEscj1pLnByb3RvdHlwZSxzPXIudG9TdHJpbmcsdD1uZXcgaigtMHhjNzgyYjViODAwY2VjKTt0cnl7dD0tMTA5MjUyPT10LmdldFVUQ0Z1bGxZZWFyKCkmJjA9PT10LmdldFVUQ01vbnRoKCkmJjE9PT10LmdldFVUQ0RhdGUoKSYmMTA9PXQuZ2V0VVRDSG91cnMoKSYmMzc9PXQuZ2V0VVRDTWludXRlcygpJiY2PT10LmdldFVUQ1NlY29uZHMoKSYmNzA4PT10LmdldFVUQ01pbGxpc2Vjb25kcygpfWNhdGNoKHUpe31pZighZihcImpzb25cIikpe3ZhciB2PVwiW29iamVjdCBGdW5jdGlvbl1cIix3PVwiW29iamVjdCBEYXRlXVwiLHg9XCJbb2JqZWN0IE51bWJlcl1cIix5PVwiW29iamVjdCBTdHJpbmddXCIsej1cIltvYmplY3QgQXJyYXldXCIsQT1cIltvYmplY3QgQm9vbGVhbl1cIixCPWYoXCJidWctc3RyaW5nLWNoYXItaW5kZXhcIik7aWYoIXQpdmFyIEM9bS5mbG9vcixEPVswLDMxLDU5LDkwLDEyMCwxNTEsMTgxLDIxMiwyNDMsMjczLDMwNCwzMzRdLEU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gRFtiXSszNjUqKGEtMTk3MCkrQygoYS0xOTY5KyhiPSsoYj4xKSkpLzQpLUMoKGEtMTkwMStiKS8xMDApK0MoKGEtMTYwMStiKS80MDApfTtpZigobz1yLmhhc093blByb3BlcnR5KXx8KG89ZnVuY3Rpb24oYSl7dmFyIGIsYz17fTtyZXR1cm4oYy5fX3Byb3RvX189bnVsbCxjLl9fcHJvdG9fXz17dG9TdHJpbmc6MX0sYykudG9TdHJpbmchPXM/bz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9fcHJvdG9fXyxjPWEgaW4odGhpcy5fX3Byb3RvX189bnVsbCx0aGlzKTtyZXR1cm4gdGhpcy5fX3Byb3RvX189YixjfTooYj1jLmNvbnN0cnVjdG9yLG89ZnVuY3Rpb24oYSl7dmFyIGM9KHRoaXMuY29uc3RydWN0b3J8fGIpLnByb3RvdHlwZTtyZXR1cm4gYSBpbiB0aGlzJiYhKGEgaW4gYyYmdGhpc1thXT09PWNbYV0pfSksYz1udWxsLG8uY2FsbCh0aGlzLGEpfSkscD1mdW5jdGlvbihhLGIpe3ZhciBkLGUsZixnPTA7KGQ9ZnVuY3Rpb24oKXt0aGlzLnZhbHVlT2Y9MH0pLnByb3RvdHlwZS52YWx1ZU9mPTAsZT1uZXcgZDtmb3IoZiBpbiBlKW8uY2FsbChlLGYpJiZnKys7cmV0dXJuIGQ9ZT1udWxsLGc/cD0yPT1nP2Z1bmN0aW9uKGEsYil7dmFyIGMsZD17fSxlPXMuY2FsbChhKT09djtmb3IoYyBpbiBhKWUmJlwicHJvdG90eXBlXCI9PWN8fG8uY2FsbChkLGMpfHwhKGRbY109MSl8fCFvLmNhbGwoYSxjKXx8YihjKX06ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGU9cy5jYWxsKGEpPT12O2ZvcihjIGluIGEpZSYmXCJwcm90b3R5cGVcIj09Y3x8IW8uY2FsbChhLGMpfHwoZD1cImNvbnN0cnVjdG9yXCI9PT1jKXx8YihjKTsoZHx8by5jYWxsKGEsYz1cImNvbnN0cnVjdG9yXCIpKSYmYihjKX06KGU9W1widmFsdWVPZlwiLFwidG9TdHJpbmdcIixcInRvTG9jYWxlU3RyaW5nXCIsXCJwcm9wZXJ0eUlzRW51bWVyYWJsZVwiLFwiaXNQcm90b3R5cGVPZlwiLFwiaGFzT3duUHJvcGVydHlcIixcImNvbnN0cnVjdG9yXCJdLHA9ZnVuY3Rpb24oYSxiKXt2YXIgZCxmLGc9cy5jYWxsKGEpPT12LGg9IWcmJlwiZnVuY3Rpb25cIiE9dHlwZW9mIGEuY29uc3RydWN0b3ImJmNbdHlwZW9mIGEuaGFzT3duUHJvcGVydHldJiZhLmhhc093blByb3BlcnR5fHxvO2ZvcihkIGluIGEpZyYmXCJwcm90b3R5cGVcIj09ZHx8IWguY2FsbChhLGQpfHxiKGQpO2ZvcihmPWUubGVuZ3RoO2Q9ZVstLWZdO2guY2FsbChhLGQpJiZiKGQpKTt9KSxwKGEsYil9LCFmKFwianNvbi1zdHJpbmdpZnlcIikpe3ZhciBGPXs5MjpcIlxcXFxcXFxcXCIsMzQ6J1xcXFxcIicsODpcIlxcXFxiXCIsMTI6XCJcXFxcZlwiLDEwOlwiXFxcXG5cIiwxMzpcIlxcXFxyXCIsOTpcIlxcXFx0XCJ9LEc9XCIwMDAwMDBcIixIPWZ1bmN0aW9uKGEsYil7cmV0dXJuKEcrKGJ8fDApKS5zbGljZSgtYSl9LEk9XCJcXFxcdTAwXCIsSj1mdW5jdGlvbihhKXtmb3IodmFyIGI9J1wiJyxjPTAsZD1hLmxlbmd0aCxlPSFCfHxkPjEwLGY9ZSYmKEI/YS5zcGxpdChcIlwiKTphKTtkPmM7YysrKXt2YXIgZz1hLmNoYXJDb2RlQXQoYyk7c3dpdGNoKGcpe2Nhc2UgODpjYXNlIDk6Y2FzZSAxMDpjYXNlIDEyOmNhc2UgMTM6Y2FzZSAzNDpjYXNlIDkyOmIrPUZbZ107YnJlYWs7ZGVmYXVsdDppZigzMj5nKXtiKz1JK0goMixnLnRvU3RyaW5nKDE2KSk7YnJlYWt9Yis9ZT9mW2NdOmEuY2hhckF0KGMpfX1yZXR1cm4gYisnXCInfSxLPWZ1bmN0aW9uKGEsYixjLGQsZSxmLGcpe3ZhciBoLGksaixrLG0sbixyLHQsdSx2LEIsRCxGLEcsSSxMO3RyeXtoPWJbYV19Y2F0Y2goTSl7fWlmKFwib2JqZWN0XCI9PXR5cGVvZiBoJiZoKWlmKGk9cy5jYWxsKGgpLGkhPXd8fG8uY2FsbChoLFwidG9KU09OXCIpKVwiZnVuY3Rpb25cIj09dHlwZW9mIGgudG9KU09OJiYoaSE9eCYmaSE9eSYmaSE9enx8by5jYWxsKGgsXCJ0b0pTT05cIikpJiYoaD1oLnRvSlNPTihhKSk7ZWxzZSBpZihoPi0xLzAmJjEvMD5oKXtpZihFKXtmb3IobT1DKGgvODY0ZTUpLGo9QyhtLzM2NS4yNDI1KSsxOTcwLTE7RShqKzEsMCk8PW07aisrKTtmb3Ioaz1DKChtLUUoaiwwKSkvMzAuNDIpO0UoaixrKzEpPD1tO2srKyk7bT0xK20tRShqLGspLG49KGglODY0ZTUrODY0ZTUpJTg2NGU1LHI9QyhuLzM2ZTUpJTI0LHQ9QyhuLzZlNCklNjAsdT1DKG4vMWUzKSU2MCx2PW4lMWUzfWVsc2Ugaj1oLmdldFVUQ0Z1bGxZZWFyKCksaz1oLmdldFVUQ01vbnRoKCksbT1oLmdldFVUQ0RhdGUoKSxyPWguZ2V0VVRDSG91cnMoKSx0PWguZ2V0VVRDTWludXRlcygpLHU9aC5nZXRVVENTZWNvbmRzKCksdj1oLmdldFVUQ01pbGxpc2Vjb25kcygpO2g9KDA+PWp8fGo+PTFlND8oMD5qP1wiLVwiOlwiK1wiKStIKDYsMD5qPy1qOmopOkgoNCxqKSkrXCItXCIrSCgyLGsrMSkrXCItXCIrSCgyLG0pK1wiVFwiK0goMixyKStcIjpcIitIKDIsdCkrXCI6XCIrSCgyLHUpK1wiLlwiK0goMyx2KStcIlpcIn1lbHNlIGg9bnVsbDtpZihjJiYoaD1jLmNhbGwoYixhLGgpKSxudWxsPT09aClyZXR1cm5cIm51bGxcIjtpZihpPXMuY2FsbChoKSxpPT1BKXJldHVyblwiXCIraDtpZihpPT14KXJldHVybiBoPi0xLzAmJjEvMD5oP1wiXCIraDpcIm51bGxcIjtpZihpPT15KXJldHVybiBKKFwiXCIraCk7aWYoXCJvYmplY3RcIj09dHlwZW9mIGgpe2ZvcihHPWcubGVuZ3RoO0ctLTspaWYoZ1tHXT09PWgpdGhyb3cgbCgpO2lmKGcucHVzaChoKSxCPVtdLEk9ZixmKz1lLGk9PXope2ZvcihGPTAsRz1oLmxlbmd0aDtHPkY7RisrKUQ9SyhGLGgsYyxkLGUsZixnKSxCLnB1c2goRD09PXE/XCJudWxsXCI6RCk7TD1CLmxlbmd0aD9lP1wiW1xcblwiK2YrQi5qb2luKFwiLFxcblwiK2YpK1wiXFxuXCIrSStcIl1cIjpcIltcIitCLmpvaW4oXCIsXCIpK1wiXVwiOlwiW11cIn1lbHNlIHAoZHx8aCxmdW5jdGlvbihhKXt2YXIgYj1LKGEsaCxjLGQsZSxmLGcpO2IhPT1xJiZCLnB1c2goSihhKStcIjpcIisoZT9cIiBcIjpcIlwiKStiKX0pLEw9Qi5sZW5ndGg/ZT9cIntcXG5cIitmK0Iuam9pbihcIixcXG5cIitmKStcIlxcblwiK0krXCJ9XCI6XCJ7XCIrQi5qb2luKFwiLFwiKStcIn1cIjpcInt9XCI7cmV0dXJuIGcucG9wKCksTH19O2Quc3RyaW5naWZ5PWZ1bmN0aW9uKGEsYixkKXt2YXIgZSxmLGcsaDtpZihjW3R5cGVvZiBiXSYmYilpZigoaD1zLmNhbGwoYikpPT12KWY9YjtlbHNlIGlmKGg9PXope2c9e307Zm9yKHZhciBpLGo9MCxrPWIubGVuZ3RoO2s+ajtpPWJbaisrXSxoPXMuY2FsbChpKSwoaD09eXx8aD09eCkmJihnW2ldPTEpKTt9aWYoZClpZigoaD1zLmNhbGwoZCkpPT14KXtpZigoZC09ZCUxKT4wKWZvcihlPVwiXCIsZD4xMCYmKGQ9MTApO2UubGVuZ3RoPGQ7ZSs9XCIgXCIpO31lbHNlIGg9PXkmJihlPWQubGVuZ3RoPD0xMD9kOmQuc2xpY2UoMCwxMCkpO3JldHVybiBLKFwiXCIsKGk9e30saVtcIlwiXT1hLGkpLGYsZyxlLFwiXCIsW10pfX1pZighZihcImpzb24tcGFyc2VcIikpe3ZhciBMLE0sTj1oLmZyb21DaGFyQ29kZSxPPXs5MjpcIlxcXFxcIiwzNDonXCInLDQ3OlwiL1wiLDk4OlwiXFxiXCIsMTE2OlwiXHRcIiwxMTA6XCJcXG5cIiwxMDI6XCJcXGZcIiwxMTQ6XCJcXHJcIn0sUD1mdW5jdGlvbigpe3Rocm93IEw9TT1udWxsLGsoKX0sUT1mdW5jdGlvbigpe2Zvcih2YXIgYSxiLGMsZCxlLGY9TSxnPWYubGVuZ3RoO2c+TDspc3dpdGNoKGU9Zi5jaGFyQ29kZUF0KEwpKXtjYXNlIDk6Y2FzZSAxMDpjYXNlIDEzOmNhc2UgMzI6TCsrO2JyZWFrO2Nhc2UgMTIzOmNhc2UgMTI1OmNhc2UgOTE6Y2FzZSA5MzpjYXNlIDU4OmNhc2UgNDQ6cmV0dXJuIGE9Qj9mLmNoYXJBdChMKTpmW0xdLEwrKyxhO2Nhc2UgMzQ6Zm9yKGE9XCJAXCIsTCsrO2c+TDspaWYoZT1mLmNoYXJDb2RlQXQoTCksMzI+ZSlQKCk7ZWxzZSBpZig5Mj09ZSlzd2l0Y2goZT1mLmNoYXJDb2RlQXQoKytMKSl7Y2FzZSA5MjpjYXNlIDM0OlxuY2FzZSA0NzpjYXNlIDk4OmNhc2UgMTE2OmNhc2UgMTEwOmNhc2UgMTAyOmNhc2UgMTE0OmErPU9bZV0sTCsrO2JyZWFrO2Nhc2UgMTE3OmZvcihiPSsrTCxjPUwrNDtjPkw7TCsrKWU9Zi5jaGFyQ29kZUF0KEwpLGU+PTQ4JiY1Nz49ZXx8ZT49OTcmJjEwMj49ZXx8ZT49NjUmJjcwPj1lfHxQKCk7YSs9TihcIjB4XCIrZi5zbGljZShiLEwpKTticmVhaztkZWZhdWx0OlAoKX1lbHNle2lmKDM0PT1lKWJyZWFrO2ZvcihlPWYuY2hhckNvZGVBdChMKSxiPUw7ZT49MzImJjkyIT1lJiYzNCE9ZTspZT1mLmNoYXJDb2RlQXQoKytMKTthKz1mLnNsaWNlKGIsTCl9aWYoMzQ9PWYuY2hhckNvZGVBdChMKSlyZXR1cm4gTCsrLGE7UCgpO2RlZmF1bHQ6aWYoYj1MLDQ1PT1lJiYoZD0hMCxlPWYuY2hhckNvZGVBdCgrK0wpKSxlPj00OCYmNTc+PWUpe2Zvcig0OD09ZSYmKGU9Zi5jaGFyQ29kZUF0KEwrMSksZT49NDgmJjU3Pj1lKSYmUCgpLGQ9ITE7Zz5MJiYoZT1mLmNoYXJDb2RlQXQoTCksZT49NDgmJjU3Pj1lKTtMKyspO2lmKDQ2PT1mLmNoYXJDb2RlQXQoTCkpe2ZvcihjPSsrTDtnPmMmJihlPWYuY2hhckNvZGVBdChjKSxlPj00OCYmNTc+PWUpO2MrKyk7Yz09TCYmUCgpLEw9Y31pZihlPWYuY2hhckNvZGVBdChMKSwxMDE9PWV8fDY5PT1lKXtmb3IoZT1mLmNoYXJDb2RlQXQoKytMKSwoNDM9PWV8fDQ1PT1lKSYmTCsrLGM9TDtnPmMmJihlPWYuY2hhckNvZGVBdChjKSxlPj00OCYmNTc+PWUpO2MrKyk7Yz09TCYmUCgpLEw9Y31yZXR1cm4rZi5zbGljZShiLEwpfWlmKGQmJlAoKSxcInRydWVcIj09Zi5zbGljZShMLEwrNCkpcmV0dXJuIEwrPTQsITA7aWYoXCJmYWxzZVwiPT1mLnNsaWNlKEwsTCs1KSlyZXR1cm4gTCs9NSwhMTtpZihcIm51bGxcIj09Zi5zbGljZShMLEwrNCkpcmV0dXJuIEwrPTQsbnVsbDtQKCl9cmV0dXJuXCIkXCJ9LFI9ZnVuY3Rpb24oYSl7dmFyIGIsYztpZihcIiRcIj09YSYmUCgpLFwic3RyaW5nXCI9PXR5cGVvZiBhKXtpZihcIkBcIj09KEI/YS5jaGFyQXQoMCk6YVswXSkpcmV0dXJuIGEuc2xpY2UoMSk7aWYoXCJbXCI9PWEpe2ZvcihiPVtdO2E9USgpLFwiXVwiIT1hO2N8fChjPSEwKSljJiYoXCIsXCI9PWE/KGE9USgpLFwiXVwiPT1hJiZQKCkpOlAoKSksXCIsXCI9PWEmJlAoKSxiLnB1c2goUihhKSk7cmV0dXJuIGJ9aWYoXCJ7XCI9PWEpe2ZvcihiPXt9O2E9USgpLFwifVwiIT1hO2N8fChjPSEwKSljJiYoXCIsXCI9PWE/KGE9USgpLFwifVwiPT1hJiZQKCkpOlAoKSksKFwiLFwiPT1hfHxcInN0cmluZ1wiIT10eXBlb2YgYXx8XCJAXCIhPShCP2EuY2hhckF0KDApOmFbMF0pfHxcIjpcIiE9USgpKSYmUCgpLGJbYS5zbGljZSgxKV09UihRKCkpO3JldHVybiBifVAoKX1yZXR1cm4gYX0sUz1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9VChhLGIsYyk7ZD09PXE/ZGVsZXRlIGFbYl06YVtiXT1kfSxUPWZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlPWFbYl07aWYoXCJvYmplY3RcIj09dHlwZW9mIGUmJmUpaWYocy5jYWxsKGUpPT16KWZvcihkPWUubGVuZ3RoO2QtLTspUyhlLGQsYyk7ZWxzZSBwKGUsZnVuY3Rpb24oYSl7UyhlLGEsYyl9KTtyZXR1cm4gYy5jYWxsKGEsYixlKX07ZC5wYXJzZT1mdW5jdGlvbihhLGIpe3ZhciBjLGQ7cmV0dXJuIEw9MCxNPVwiXCIrYSxjPVIoUSgpKSxcIiRcIiE9USgpJiZQKCksTD1NPW51bGwsYiYmcy5jYWxsKGIpPT12P1QoKGQ9e30sZFtcIlwiXT1jLGQpLFwiXCIsYik6Y319fXJldHVybiBkLnJ1bkluQ29udGV4dD1hLGR9dmFyIGI9XCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kLGM9e1wiZnVuY3Rpb25cIjohMCxvYmplY3Q6ITB9LGQ9Y1t0eXBlb2YgZXhwb3J0c10mJmV4cG9ydHMmJiFleHBvcnRzLm5vZGVUeXBlJiZleHBvcnRzLGU9Y1t0eXBlb2Ygd2luZG93XSYmd2luZG93fHx0aGlzLGY9ZCYmY1t0eXBlb2YgbW9kdWxlXSYmbW9kdWxlJiYhbW9kdWxlLm5vZGVUeXBlJiZcIm9iamVjdFwiPT10eXBlb2YgZ2xvYmFsJiZnbG9iYWw7aWYoIWZ8fGYuZ2xvYmFsIT09ZiYmZi53aW5kb3chPT1mJiZmLnNlbGYhPT1mfHwoZT1mKSxkJiYhYilhKGUsZCk7ZWxzZXt2YXIgZz1lLkpTT04saD1lLkpTT04zLGk9ITEsaj1hKGUsZS5KU09OMz17bm9Db25mbGljdDpmdW5jdGlvbigpe3JldHVybiBpfHwoaT0hMCxlLkpTT049ZyxlLkpTT04zPWgsZz1oPW51bGwpLGp9fSk7ZS5KU09OPXtwYXJzZTpqLnBhcnNlLHN0cmluZ2lmeTpqLnN0cmluZ2lmeX19YiYmZGVmaW5lKGZ1bmN0aW9uKCl7cmV0dXJuIGp9KX0uY2FsbCh0aGlzKSxmdW5jdGlvbigpe3ZhciBhPXt9O2EuYXBwZW5kVG9IZWFkPWZ1bmN0aW9uKGIpe2EuZ2V0SGVhZCgpLmFwcGVuZENoaWxkKGIpfSxhLmdldEhlYWQ9ZnVuY3Rpb24oKXtyZXR1cm4gZG9jdW1lbnQuaGVhZHx8ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdfSxhLmdldEJvZHk9ZnVuY3Rpb24oKXtyZXR1cm4gZG9jdW1lbnQuYm9keXx8ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJib2R5XCIpWzBdfSxjcmVhdGVqcy5Eb21VdGlscz1hfSgpLGZ1bmN0aW9uKCl7dmFyIGE9e307YS5wYXJzZVhNTD1mdW5jdGlvbihhLGIpe3ZhciBjPW51bGw7dHJ5e2lmKHdpbmRvdy5ET01QYXJzZXIpe3ZhciBkPW5ldyBET01QYXJzZXI7Yz1kLnBhcnNlRnJvbVN0cmluZyhhLGIpfX1jYXRjaChlKXt9aWYoIWMpdHJ5e2M9bmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpLGMuYXN5bmM9ITEsYy5sb2FkWE1MKGEpfWNhdGNoKGUpe2M9bnVsbH1yZXR1cm4gY30sYS5wYXJzZUpTT049ZnVuY3Rpb24oYSl7aWYobnVsbD09YSlyZXR1cm4gbnVsbDt0cnl7cmV0dXJuIEpTT04ucGFyc2UoYSl9Y2F0Y2goYil7dGhyb3cgYn19LGNyZWF0ZWpzLkRhdGFVdGlscz1hfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKCl7dGhpcy5zcmM9bnVsbCx0aGlzLnR5cGU9bnVsbCx0aGlzLmlkPW51bGwsdGhpcy5tYWludGFpbk9yZGVyPSExLHRoaXMuY2FsbGJhY2s9bnVsbCx0aGlzLmRhdGE9bnVsbCx0aGlzLm1ldGhvZD1jcmVhdGVqcy5Mb2FkSXRlbS5HRVQsdGhpcy52YWx1ZXM9bnVsbCx0aGlzLmhlYWRlcnM9bnVsbCx0aGlzLndpdGhDcmVkZW50aWFscz0hMSx0aGlzLm1pbWVUeXBlPW51bGwsdGhpcy5jcm9zc09yaWdpbj1udWxsLHRoaXMubG9hZFRpbWVvdXQ9Yy5MT0FEX1RJTUVPVVRfREVGQVVMVH12YXIgYj1hLnByb3RvdHlwZT17fSxjPWE7Yy5MT0FEX1RJTUVPVVRfREVGQVVMVD04ZTMsYy5jcmVhdGU9ZnVuY3Rpb24oYil7aWYoXCJzdHJpbmdcIj09dHlwZW9mIGIpe3ZhciBkPW5ldyBhO3JldHVybiBkLnNyYz1iLGR9aWYoYiBpbnN0YW5jZW9mIGMpcmV0dXJuIGI7aWYoYiBpbnN0YW5jZW9mIE9iamVjdCYmYi5zcmMpcmV0dXJuIG51bGw9PWIubG9hZFRpbWVvdXQmJihiLmxvYWRUaW1lb3V0PWMuTE9BRF9USU1FT1VUX0RFRkFVTFQpLGI7dGhyb3cgbmV3IEVycm9yKFwiVHlwZSBub3QgcmVjb2duaXplZC5cIil9LGIuc2V0PWZ1bmN0aW9uKGEpe2Zvcih2YXIgYiBpbiBhKXRoaXNbYl09YVtiXTtyZXR1cm4gdGhpc30sY3JlYXRlanMuTG9hZEl0ZW09Y30oKSxmdW5jdGlvbigpe3ZhciBhPXt9O2EuQUJTT0xVVEVfUEFUVD0vXig/Olxcdys6KT9cXC97Mn0vaSxhLlJFTEFUSVZFX1BBVFQ9L15bLlxcL10qP1xcLy9pLGEuRVhURU5TSU9OX1BBVFQ9L1xcLz9bXlxcL10rXFwuKFxcd3sxLDV9KSQvaSxhLnBhcnNlVVJJPWZ1bmN0aW9uKGIpe3ZhciBjPXthYnNvbHV0ZTohMSxyZWxhdGl2ZTohMX07aWYobnVsbD09YilyZXR1cm4gYzt2YXIgZD1iLmluZGV4T2YoXCI/XCIpO2Q+LTEmJihiPWIuc3Vic3RyKDAsZCkpO3ZhciBlO3JldHVybiBhLkFCU09MVVRFX1BBVFQudGVzdChiKT9jLmFic29sdXRlPSEwOmEuUkVMQVRJVkVfUEFUVC50ZXN0KGIpJiYoYy5yZWxhdGl2ZT0hMCksKGU9Yi5tYXRjaChhLkVYVEVOU0lPTl9QQVRUKSkmJihjLmV4dGVuc2lvbj1lWzFdLnRvTG93ZXJDYXNlKCkpLGN9LGEuZm9ybWF0UXVlcnlTdHJpbmc9ZnVuY3Rpb24oYSxiKXtpZihudWxsPT1hKXRocm93IG5ldyBFcnJvcihcIllvdSBtdXN0IHNwZWNpZnkgZGF0YS5cIik7dmFyIGM9W107Zm9yKHZhciBkIGluIGEpYy5wdXNoKGQrXCI9XCIrZXNjYXBlKGFbZF0pKTtyZXR1cm4gYiYmKGM9Yy5jb25jYXQoYikpLGMuam9pbihcIiZcIil9LGEuYnVpbGRQYXRoPWZ1bmN0aW9uKGEsYil7aWYobnVsbD09YilyZXR1cm4gYTt2YXIgYz1bXSxkPWEuaW5kZXhPZihcIj9cIik7aWYoLTEhPWQpe3ZhciBlPWEuc2xpY2UoZCsxKTtjPWMuY29uY2F0KGUuc3BsaXQoXCImXCIpKX1yZXR1cm4tMSE9ZD9hLnNsaWNlKDAsZCkrXCI/XCIrdGhpcy5mb3JtYXRRdWVyeVN0cmluZyhiLGMpOmErXCI/XCIrdGhpcy5mb3JtYXRRdWVyeVN0cmluZyhiLGMpfSxhLmlzQ3Jvc3NEb21haW49ZnVuY3Rpb24oYSl7dmFyIGI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7Yi5ocmVmPWEuc3JjO3ZhciBjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO2MuaHJlZj1sb2NhdGlvbi5ocmVmO3ZhciBkPVwiXCIhPWIuaG9zdG5hbWUmJihiLnBvcnQhPWMucG9ydHx8Yi5wcm90b2NvbCE9Yy5wcm90b2NvbHx8Yi5ob3N0bmFtZSE9Yy5ob3N0bmFtZSk7cmV0dXJuIGR9LGEuaXNMb2NhbD1mdW5jdGlvbihhKXt2YXIgYj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtyZXR1cm4gYi5ocmVmPWEuc3JjLFwiXCI9PWIuaG9zdG5hbWUmJlwiZmlsZTpcIj09Yi5wcm90b2NvbH0sYS5pc0JpbmFyeT1mdW5jdGlvbihhKXtzd2l0Y2goYSl7Y2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5JTUFHRTpjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkJJTkFSWTpyZXR1cm4hMDtkZWZhdWx0OnJldHVybiExfX0sYS5pc0ltYWdlVGFnPWZ1bmN0aW9uKGEpe3JldHVybiBhIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudH0sYS5pc0F1ZGlvVGFnPWZ1bmN0aW9uKGEpe3JldHVybiB3aW5kb3cuSFRNTEF1ZGlvRWxlbWVudD9hIGluc3RhbmNlb2YgSFRNTEF1ZGlvRWxlbWVudDohMX0sYS5pc1ZpZGVvVGFnPWZ1bmN0aW9uKGEpe3JldHVybiB3aW5kb3cuSFRNTFZpZGVvRWxlbWVudD9hIGluc3RhbmNlb2YgSFRNTFZpZGVvRWxlbWVudDohMX0sYS5pc1RleHQ9ZnVuY3Rpb24oYSl7c3dpdGNoKGEpe2Nhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVEVYVDpjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT046Y2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5NQU5JRkVTVDpjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlhNTDpjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkNTUzpjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNWRzpjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpBVkFTQ1JJUFQ6Y2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5TUFJJVEVTSEVFVDpyZXR1cm4hMDtkZWZhdWx0OnJldHVybiExfX0sYS5nZXRUeXBlQnlFeHRlbnNpb249ZnVuY3Rpb24oYSl7aWYobnVsbD09YSlyZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVEVYVDtzd2l0Y2goYS50b0xvd2VyQ2FzZSgpKXtjYXNlXCJqcGVnXCI6Y2FzZVwianBnXCI6Y2FzZVwiZ2lmXCI6Y2FzZVwicG5nXCI6Y2FzZVwid2VicFwiOmNhc2VcImJtcFwiOnJldHVybiBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5JTUFHRTtjYXNlXCJvZ2dcIjpjYXNlXCJtcDNcIjpjYXNlXCJ3ZWJtXCI6cmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNPVU5EO2Nhc2VcIm1wNFwiOmNhc2VcIndlYm1cIjpjYXNlXCJ0c1wiOnJldHVybiBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5WSURFTztjYXNlXCJqc29uXCI6cmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT047Y2FzZVwieG1sXCI6cmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlhNTDtjYXNlXCJjc3NcIjpyZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQ1NTO2Nhc2VcImpzXCI6cmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpBVkFTQ1JJUFQ7Y2FzZVwic3ZnXCI6cmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNWRztkZWZhdWx0OnJldHVybiBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5URVhUfX0sY3JlYXRlanMuUmVxdWVzdFV0aWxzPWF9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMpe3RoaXMuRXZlbnREaXNwYXRjaGVyX2NvbnN0cnVjdG9yKCksdGhpcy5sb2FkZWQ9ITEsdGhpcy5jYW5jZWxlZD0hMSx0aGlzLnByb2dyZXNzPTAsdGhpcy50eXBlPWMsdGhpcy5yZXN1bHRGb3JtYXR0ZXI9bnVsbCxhP3RoaXMuX2l0ZW09Y3JlYXRlanMuTG9hZEl0ZW0uY3JlYXRlKGEpOnRoaXMuX2l0ZW09bnVsbCx0aGlzLl9wcmVmZXJYSFI9Yix0aGlzLl9yZXN1bHQ9bnVsbCx0aGlzLl9yYXdSZXN1bHQ9bnVsbCx0aGlzLl9sb2FkZWRJdGVtcz1udWxsLHRoaXMuX3RhZ1NyY0F0dHJpYnV0ZT1udWxsLHRoaXMuX3RhZz1udWxsfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlciksYz1hO2MuUE9TVD1cIlBPU1RcIixjLkdFVD1cIkdFVFwiLGMuQklOQVJZPVwiYmluYXJ5XCIsYy5DU1M9XCJjc3NcIixjLklNQUdFPVwiaW1hZ2VcIixjLkpBVkFTQ1JJUFQ9XCJqYXZhc2NyaXB0XCIsYy5KU09OPVwianNvblwiLGMuSlNPTlA9XCJqc29ucFwiLGMuTUFOSUZFU1Q9XCJtYW5pZmVzdFwiLGMuU09VTkQ9XCJzb3VuZFwiLGMuVklERU89XCJ2aWRlb1wiLGMuU1BSSVRFU0hFRVQ9XCJzcHJpdGVzaGVldFwiLGMuU1ZHPVwic3ZnXCIsYy5URVhUPVwidGV4dFwiLGMuWE1MPVwieG1sXCIsYi5nZXRJdGVtPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2l0ZW19LGIuZ2V0UmVzdWx0PWZ1bmN0aW9uKGEpe3JldHVybiBhP3RoaXMuX3Jhd1Jlc3VsdDp0aGlzLl9yZXN1bHR9LGIuZ2V0VGFnPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3RhZ30sYi5zZXRUYWc9ZnVuY3Rpb24oYSl7dGhpcy5fdGFnPWF9LGIubG9hZD1mdW5jdGlvbigpe3RoaXMuX2NyZWF0ZVJlcXVlc3QoKSx0aGlzLl9yZXF1ZXN0Lm9uKFwiY29tcGxldGVcIix0aGlzLHRoaXMpLHRoaXMuX3JlcXVlc3Qub24oXCJwcm9ncmVzc1wiLHRoaXMsdGhpcyksdGhpcy5fcmVxdWVzdC5vbihcImxvYWRTdGFydFwiLHRoaXMsdGhpcyksdGhpcy5fcmVxdWVzdC5vbihcImFib3J0XCIsdGhpcyx0aGlzKSx0aGlzLl9yZXF1ZXN0Lm9uKFwidGltZW91dFwiLHRoaXMsdGhpcyksdGhpcy5fcmVxdWVzdC5vbihcImVycm9yXCIsdGhpcyx0aGlzKTt2YXIgYT1uZXcgY3JlYXRlanMuRXZlbnQoXCJpbml0aWFsaXplXCIpO2EubG9hZGVyPXRoaXMuX3JlcXVlc3QsdGhpcy5kaXNwYXRjaEV2ZW50KGEpLHRoaXMuX3JlcXVlc3QubG9hZCgpfSxiLmNhbmNlbD1mdW5jdGlvbigpe3RoaXMuY2FuY2VsZWQ9ITAsdGhpcy5kZXN0cm95KCl9LGIuZGVzdHJveT1mdW5jdGlvbigpe3RoaXMuX3JlcXVlc3QmJih0aGlzLl9yZXF1ZXN0LnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzKCksdGhpcy5fcmVxdWVzdC5kZXN0cm95KCkpLHRoaXMuX3JlcXVlc3Q9bnVsbCx0aGlzLl9pdGVtPW51bGwsdGhpcy5fcmF3UmVzdWx0PW51bGwsdGhpcy5fcmVzdWx0PW51bGwsdGhpcy5fbG9hZEl0ZW1zPW51bGwsdGhpcy5yZW1vdmVBbGxFdmVudExpc3RlbmVycygpfSxiLmdldExvYWRlZEl0ZW1zPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2xvYWRlZEl0ZW1zfSxiLl9jcmVhdGVSZXF1ZXN0PWZ1bmN0aW9uKCl7dGhpcy5fcHJlZmVyWEhSP3RoaXMuX3JlcXVlc3Q9bmV3IGNyZWF0ZWpzLlhIUlJlcXVlc3QodGhpcy5faXRlbSk6dGhpcy5fcmVxdWVzdD1uZXcgY3JlYXRlanMuVGFnUmVxdWVzdCh0aGlzLl9pdGVtLHRoaXMuX3RhZ3x8dGhpcy5fY3JlYXRlVGFnKCksdGhpcy5fdGFnU3JjQXR0cmlidXRlKX0sYi5fY3JlYXRlVGFnPWZ1bmN0aW9uKGEpe3JldHVybiBudWxsfSxiLl9zZW5kTG9hZFN0YXJ0PWZ1bmN0aW9uKCl7dGhpcy5faXNDYW5jZWxlZCgpfHx0aGlzLmRpc3BhdGNoRXZlbnQoXCJsb2Fkc3RhcnRcIil9LGIuX3NlbmRQcm9ncmVzcz1mdW5jdGlvbihhKXtpZighdGhpcy5faXNDYW5jZWxlZCgpKXt2YXIgYj1udWxsO1wibnVtYmVyXCI9PXR5cGVvZiBhPyh0aGlzLnByb2dyZXNzPWEsYj1uZXcgY3JlYXRlanMuUHJvZ3Jlc3NFdmVudCh0aGlzLnByb2dyZXNzKSk6KGI9YSx0aGlzLnByb2dyZXNzPWEubG9hZGVkL2EudG90YWwsYi5wcm9ncmVzcz10aGlzLnByb2dyZXNzLChpc05hTih0aGlzLnByb2dyZXNzKXx8dGhpcy5wcm9ncmVzcz09MS8wKSYmKHRoaXMucHJvZ3Jlc3M9MCkpLHRoaXMuaGFzRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIpJiZ0aGlzLmRpc3BhdGNoRXZlbnQoYil9fSxiLl9zZW5kQ29tcGxldGU9ZnVuY3Rpb24oKXtpZighdGhpcy5faXNDYW5jZWxlZCgpKXt0aGlzLmxvYWRlZD0hMDt2YXIgYT1uZXcgY3JlYXRlanMuRXZlbnQoXCJjb21wbGV0ZVwiKTthLnJhd1Jlc3VsdD10aGlzLl9yYXdSZXN1bHQsbnVsbCE9dGhpcy5fcmVzdWx0JiYoYS5yZXN1bHQ9dGhpcy5fcmVzdWx0KSx0aGlzLmRpc3BhdGNoRXZlbnQoYSl9fSxiLl9zZW5kRXJyb3I9ZnVuY3Rpb24oYSl7IXRoaXMuX2lzQ2FuY2VsZWQoKSYmdGhpcy5oYXNFdmVudExpc3RlbmVyKFwiZXJyb3JcIikmJihudWxsPT1hJiYoYT1uZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIlBSRUxPQURfRVJST1JfRU1QVFlcIikpLHRoaXMuZGlzcGF0Y2hFdmVudChhKSl9LGIuX2lzQ2FuY2VsZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbD09d2luZG93LmNyZWF0ZWpzfHx0aGlzLmNhbmNlbGVkPyEwOiExfSxiLnJlc3VsdEZvcm1hdHRlcj1udWxsLGIuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oYSl7c3dpdGNoKGEudHlwZSl7Y2FzZVwiY29tcGxldGVcIjp0aGlzLl9yYXdSZXN1bHQ9YS50YXJnZXQuX3Jlc3BvbnNlO3ZhciBiPXRoaXMucmVzdWx0Rm9ybWF0dGVyJiZ0aGlzLnJlc3VsdEZvcm1hdHRlcih0aGlzKTtiIGluc3RhbmNlb2YgRnVuY3Rpb24/Yi5jYWxsKHRoaXMsY3JlYXRlanMucHJveHkodGhpcy5fcmVzdWx0Rm9ybWF0U3VjY2Vzcyx0aGlzKSxjcmVhdGVqcy5wcm94eSh0aGlzLl9yZXN1bHRGb3JtYXRGYWlsZWQsdGhpcykpOih0aGlzLl9yZXN1bHQ9Ynx8dGhpcy5fcmF3UmVzdWx0LHRoaXMuX3NlbmRDb21wbGV0ZSgpKTticmVhaztjYXNlXCJwcm9ncmVzc1wiOnRoaXMuX3NlbmRQcm9ncmVzcyhhKTticmVhaztjYXNlXCJlcnJvclwiOnRoaXMuX3NlbmRFcnJvcihhKTticmVhaztjYXNlXCJsb2Fkc3RhcnRcIjp0aGlzLl9zZW5kTG9hZFN0YXJ0KCk7YnJlYWs7Y2FzZVwiYWJvcnRcIjpjYXNlXCJ0aW1lb3V0XCI6dGhpcy5faXNDYW5jZWxlZCgpfHx0aGlzLmRpc3BhdGNoRXZlbnQobmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJQUkVMT0FEX1wiK2EudHlwZS50b1VwcGVyQ2FzZSgpK1wiX0VSUk9SXCIpKX19LGIuX3Jlc3VsdEZvcm1hdFN1Y2Nlc3M9ZnVuY3Rpb24oYSl7dGhpcy5fcmVzdWx0PWEsdGhpcy5fc2VuZENvbXBsZXRlKCl9LGIuX3Jlc3VsdEZvcm1hdEZhaWxlZD1mdW5jdGlvbihhKXt0aGlzLl9zZW5kRXJyb3IoYSl9LGIuYnVpbGRQYXRoPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5idWlsZFBhdGgoYSxiKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1ByZWxvYWRKUyBBYnN0cmFjdExvYWRlcl1cIn0sY3JlYXRlanMuQWJzdHJhY3RMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiRXZlbnREaXNwYXRjaGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsYixjKSx0aGlzLnJlc3VsdEZvcm1hdHRlcj10aGlzLl9mb3JtYXRSZXN1bHQsdGhpcy5fdGFnU3JjQXR0cmlidXRlPVwic3JjXCIsdGhpcy5vbihcImluaXRpYWxpemVcIix0aGlzLl91cGRhdGVYSFIsdGhpcyl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpO2IubG9hZD1mdW5jdGlvbigpe3RoaXMuX3RhZ3x8KHRoaXMuX3RhZz10aGlzLl9jcmVhdGVUYWcodGhpcy5faXRlbS5zcmMpKSx0aGlzLl90YWcucHJlbG9hZD1cImF1dG9cIix0aGlzLl90YWcubG9hZCgpLHRoaXMuQWJzdHJhY3RMb2FkZXJfbG9hZCgpfSxiLl9jcmVhdGVUYWc9ZnVuY3Rpb24oKXt9LGIuX2NyZWF0ZVJlcXVlc3Q9ZnVuY3Rpb24oKXt0aGlzLl9wcmVmZXJYSFI/dGhpcy5fcmVxdWVzdD1uZXcgY3JlYXRlanMuWEhSUmVxdWVzdCh0aGlzLl9pdGVtKTp0aGlzLl9yZXF1ZXN0PW5ldyBjcmVhdGVqcy5NZWRpYVRhZ1JlcXVlc3QodGhpcy5faXRlbSx0aGlzLl90YWd8fHRoaXMuX2NyZWF0ZVRhZygpLHRoaXMuX3RhZ1NyY0F0dHJpYnV0ZSl9LGIuX3VwZGF0ZVhIUj1mdW5jdGlvbihhKXthLmxvYWRlci5zZXRSZXNwb25zZVR5cGUmJmEubG9hZGVyLnNldFJlc3BvbnNlVHlwZShcImJsb2JcIil9LGIuX2Zvcm1hdFJlc3VsdD1mdW5jdGlvbihhKXtpZih0aGlzLl90YWcucmVtb3ZlRXZlbnRMaXN0ZW5lciYmdGhpcy5fdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5dGhyb3VnaFwiLHRoaXMuX2xvYWRlZEhhbmRsZXIpLHRoaXMuX3RhZy5vbnN0YWxsZWQ9bnVsbCx0aGlzLl9wcmVmZXJYSFIpe3ZhciBiPXdpbmRvdy5VUkx8fHdpbmRvdy53ZWJraXRVUkwsYz1hLmdldFJlc3VsdCghMCk7YS5nZXRUYWcoKS5zcmM9Yi5jcmVhdGVPYmplY3RVUkwoYyl9cmV0dXJuIGEuZ2V0VGFnKCl9LGNyZWF0ZWpzLkFic3RyYWN0TWVkaWFMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO3ZhciBhPWZ1bmN0aW9uKGEpe3RoaXMuX2l0ZW09YX0sYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIpO2IubG9hZD1mdW5jdGlvbigpe30sYi5kZXN0cm95PWZ1bmN0aW9uKCl7fSxiLmNhbmNlbD1mdW5jdGlvbigpe30sY3JlYXRlanMuQWJzdHJhY3RSZXF1ZXN0PWNyZWF0ZWpzLnByb21vdGUoYSxcIkV2ZW50RGlzcGF0Y2hlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsYyl7dGhpcy5BYnN0cmFjdFJlcXVlc3RfY29uc3RydWN0b3IoYSksdGhpcy5fdGFnPWIsdGhpcy5fdGFnU3JjQXR0cmlidXRlPWMsdGhpcy5fbG9hZGVkSGFuZGxlcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUYWdDb21wbGV0ZSx0aGlzKSx0aGlzLl9hZGRlZFRvRE9NPSExLHRoaXMuX3N0YXJ0VGFnVmlzaWJpbGl0eT1udWxsfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0UmVxdWVzdCk7Yi5sb2FkPWZ1bmN0aW9uKCl7dGhpcy5fdGFnLm9ubG9hZD1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUYWdDb21wbGV0ZSx0aGlzKSx0aGlzLl90YWcub25yZWFkeXN0YXRlY2hhbmdlPWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UsdGhpcyksdGhpcy5fdGFnLm9uZXJyb3I9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlRXJyb3IsdGhpcyk7dmFyIGE9bmV3IGNyZWF0ZWpzLkV2ZW50KFwiaW5pdGlhbGl6ZVwiKTthLmxvYWRlcj10aGlzLl90YWcsdGhpcy5kaXNwYXRjaEV2ZW50KGEpLHRoaXMuX2hpZGVUYWcoKSx0aGlzLl9sb2FkVGltZW91dD1zZXRUaW1lb3V0KGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRpbWVvdXQsdGhpcyksdGhpcy5faXRlbS5sb2FkVGltZW91dCksdGhpcy5fdGFnW3RoaXMuX3RhZ1NyY0F0dHJpYnV0ZV09dGhpcy5faXRlbS5zcmMsbnVsbD09dGhpcy5fdGFnLnBhcmVudE5vZGUmJih3aW5kb3cuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLl90YWcpLHRoaXMuX2FkZGVkVG9ET009ITApfSxiLmRlc3Ryb3k9ZnVuY3Rpb24oKXt0aGlzLl9jbGVhbigpLHRoaXMuX3RhZz1udWxsLHRoaXMuQWJzdHJhY3RSZXF1ZXN0X2Rlc3Ryb3koKX0sYi5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZT1mdW5jdGlvbigpe2NsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7dmFyIGE9dGhpcy5fdGFnOyhcImxvYWRlZFwiPT1hLnJlYWR5U3RhdGV8fFwiY29tcGxldGVcIj09YS5yZWFkeVN0YXRlKSYmdGhpcy5faGFuZGxlVGFnQ29tcGxldGUoKX0sYi5faGFuZGxlRXJyb3I9ZnVuY3Rpb24oKXt0aGlzLl9jbGVhbigpLHRoaXMuZGlzcGF0Y2hFdmVudChcImVycm9yXCIpfSxiLl9oYW5kbGVUYWdDb21wbGV0ZT1mdW5jdGlvbigpe3RoaXMuX3Jhd1Jlc3VsdD10aGlzLl90YWcsdGhpcy5fcmVzdWx0PXRoaXMucmVzdWx0Rm9ybWF0dGVyJiZ0aGlzLnJlc3VsdEZvcm1hdHRlcih0aGlzKXx8dGhpcy5fcmF3UmVzdWx0LHRoaXMuX2NsZWFuKCksdGhpcy5fc2hvd1RhZygpLHRoaXMuZGlzcGF0Y2hFdmVudChcImNvbXBsZXRlXCIpfSxiLl9oYW5kbGVUaW1lb3V0PWZ1bmN0aW9uKCl7dGhpcy5fY2xlYW4oKSx0aGlzLmRpc3BhdGNoRXZlbnQobmV3IGNyZWF0ZWpzLkV2ZW50KFwidGltZW91dFwiKSl9LGIuX2NsZWFuPWZ1bmN0aW9uKCl7dGhpcy5fdGFnLm9ubG9hZD1udWxsLHRoaXMuX3RhZy5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCx0aGlzLl90YWcub25lcnJvcj1udWxsLHRoaXMuX2FkZGVkVG9ET00mJm51bGwhPXRoaXMuX3RhZy5wYXJlbnROb2RlJiZ0aGlzLl90YWcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLl90YWcpLGNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCl9LGIuX2hpZGVUYWc9ZnVuY3Rpb24oKXt0aGlzLl9zdGFydFRhZ1Zpc2liaWxpdHk9dGhpcy5fdGFnLnN0eWxlLnZpc2liaWxpdHksdGhpcy5fdGFnLnN0eWxlLnZpc2liaWxpdHk9XCJoaWRkZW5cIn0sYi5fc2hvd1RhZz1mdW5jdGlvbigpe3RoaXMuX3RhZy5zdHlsZS52aXNpYmlsaXR5PXRoaXMuX3N0YXJ0VGFnVmlzaWJpbGl0eX0sYi5faGFuZGxlU3RhbGxlZD1mdW5jdGlvbigpe30sY3JlYXRlanMuVGFnUmVxdWVzdD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdFJlcXVlc3RcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMpe3RoaXMuQWJzdHJhY3RSZXF1ZXN0X2NvbnN0cnVjdG9yKGEpLHRoaXMuX3RhZz1iLHRoaXMuX3RhZ1NyY0F0dHJpYnV0ZT1jLHRoaXMuX2xvYWRlZEhhbmRsZXI9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGFnQ29tcGxldGUsdGhpcyl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuVGFnUmVxdWVzdCk7Yi5sb2FkPWZ1bmN0aW9uKCl7dmFyIGE9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlU3RhbGxlZCx0aGlzKTt0aGlzLl9zdGFsbGVkQ2FsbGJhY2s9YTt2YXIgYj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVQcm9ncmVzcyx0aGlzKTt0aGlzLl9oYW5kbGVQcm9ncmVzcz1iLHRoaXMuX3RhZy5hZGRFdmVudExpc3RlbmVyKFwic3RhbGxlZFwiLGEpLHRoaXMuX3RhZy5hZGRFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIixiKSx0aGlzLl90YWcuYWRkRXZlbnRMaXN0ZW5lciYmdGhpcy5fdGFnLmFkZEV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5dGhyb3VnaFwiLHRoaXMuX2xvYWRlZEhhbmRsZXIsITEpLHRoaXMuVGFnUmVxdWVzdF9sb2FkKCl9LGIuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2U9ZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQodGhpcy5fbG9hZFRpbWVvdXQpO3ZhciBhPXRoaXMuX3RhZzsoXCJsb2FkZWRcIj09YS5yZWFkeVN0YXRlfHxcImNvbXBsZXRlXCI9PWEucmVhZHlTdGF0ZSkmJnRoaXMuX2hhbmRsZVRhZ0NvbXBsZXRlKCl9LGIuX2hhbmRsZVN0YWxsZWQ9ZnVuY3Rpb24oKXt9LGIuX2hhbmRsZVByb2dyZXNzPWZ1bmN0aW9uKGEpe2lmKGEmJiEoYS5sb2FkZWQ+MCYmMD09YS50b3RhbCkpe3ZhciBiPW5ldyBjcmVhdGVqcy5Qcm9ncmVzc0V2ZW50KGEubG9hZGVkLGEudG90YWwpO3RoaXMuZGlzcGF0Y2hFdmVudChiKX19LGIuX2NsZWFuPWZ1bmN0aW9uKCl7dGhpcy5fdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXImJnRoaXMuX3RhZy5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2FucGxheXRocm91Z2hcIix0aGlzLl9sb2FkZWRIYW5kbGVyKSx0aGlzLl90YWcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN0YWxsZWRcIix0aGlzLl9zdGFsbGVkQ2FsbGJhY2spLHRoaXMuX3RhZy5yZW1vdmVFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIix0aGlzLl9wcm9ncmVzc0NhbGxiYWNrKSx0aGlzLlRhZ1JlcXVlc3RfX2NsZWFuKCl9LGNyZWF0ZWpzLk1lZGlhVGFnUmVxdWVzdD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJUYWdSZXF1ZXN0XCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuQWJzdHJhY3RSZXF1ZXN0X2NvbnN0cnVjdG9yKGEpLHRoaXMuX3JlcXVlc3Q9bnVsbCx0aGlzLl9sb2FkVGltZW91dD1udWxsLHRoaXMuX3hockxldmVsPTEsdGhpcy5fcmVzcG9uc2U9bnVsbCx0aGlzLl9yYXdSZXNwb25zZT1udWxsLHRoaXMuX2NhbmNlbGVkPSExLHRoaXMuX2hhbmRsZUxvYWRTdGFydFByb3h5PWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUxvYWRTdGFydCx0aGlzKSx0aGlzLl9oYW5kbGVQcm9ncmVzc1Byb3h5PWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVByb2dyZXNzLHRoaXMpLHRoaXMuX2hhbmRsZUFib3J0UHJveHk9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlQWJvcnQsdGhpcyksdGhpcy5faGFuZGxlRXJyb3JQcm94eT1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVFcnJvcix0aGlzKSx0aGlzLl9oYW5kbGVUaW1lb3V0UHJveHk9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCx0aGlzKSx0aGlzLl9oYW5kbGVMb2FkUHJveHk9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZCx0aGlzKSx0aGlzLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlUHJveHk9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZSx0aGlzKSwhdGhpcy5fY3JlYXRlWEhSKGEpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0UmVxdWVzdCk7YS5BQ1RJVkVYX1ZFUlNJT05TPVtcIk1zeG1sMi5YTUxIVFRQLjYuMFwiLFwiTXN4bWwyLlhNTEhUVFAuNS4wXCIsXCJNc3htbDIuWE1MSFRUUC40LjBcIixcIk1TWE1MMi5YTUxIVFRQLjMuMFwiLFwiTVNYTUwyLlhNTEhUVFBcIixcIk1pY3Jvc29mdC5YTUxIVFRQXCJdLGIuZ2V0UmVzdWx0PWZ1bmN0aW9uKGEpe3JldHVybiBhJiZ0aGlzLl9yYXdSZXNwb25zZT90aGlzLl9yYXdSZXNwb25zZTp0aGlzLl9yZXNwb25zZX0sYi5jYW5jZWw9ZnVuY3Rpb24oKXt0aGlzLmNhbmNlbGVkPSEwLHRoaXMuX2NsZWFuKCksdGhpcy5fcmVxdWVzdC5hYm9ydCgpfSxiLmxvYWQ9ZnVuY3Rpb24oKXtpZihudWxsPT10aGlzLl9yZXF1ZXN0KXJldHVybiB2b2lkIHRoaXMuX2hhbmRsZUVycm9yKCk7bnVsbCE9dGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyPyh0aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2Fkc3RhcnRcIix0aGlzLl9oYW5kbGVMb2FkU3RhcnRQcm94eSwhMSksdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIix0aGlzLl9oYW5kbGVQcm9ncmVzc1Byb3h5LCExKSx0aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJhYm9ydFwiLHRoaXMuX2hhbmRsZUFib3J0UHJveHksITEpLHRoaXMuX3JlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsdGhpcy5faGFuZGxlRXJyb3JQcm94eSwhMSksdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwidGltZW91dFwiLHRoaXMuX2hhbmRsZVRpbWVvdXRQcm94eSwhMSksdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLHRoaXMuX2hhbmRsZUxvYWRQcm94eSwhMSksdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwicmVhZHlzdGF0ZWNoYW5nZVwiLHRoaXMuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2VQcm94eSwhMSkpOih0aGlzLl9yZXF1ZXN0Lm9ubG9hZHN0YXJ0PXRoaXMuX2hhbmRsZUxvYWRTdGFydFByb3h5LHRoaXMuX3JlcXVlc3Qub25wcm9ncmVzcz10aGlzLl9oYW5kbGVQcm9ncmVzc1Byb3h5LHRoaXMuX3JlcXVlc3Qub25hYm9ydD10aGlzLl9oYW5kbGVBYm9ydFByb3h5LHRoaXMuX3JlcXVlc3Qub25lcnJvcj10aGlzLl9oYW5kbGVFcnJvclByb3h5LHRoaXMuX3JlcXVlc3Qub250aW1lb3V0PXRoaXMuX2hhbmRsZVRpbWVvdXRQcm94eSx0aGlzLl9yZXF1ZXN0Lm9ubG9hZD10aGlzLl9oYW5kbGVMb2FkUHJveHksdGhpcy5fcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2U9dGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZVByb3h5KSwxPT10aGlzLl94aHJMZXZlbCYmKHRoaXMuX2xvYWRUaW1lb3V0PXNldFRpbWVvdXQoY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCx0aGlzKSx0aGlzLl9pdGVtLmxvYWRUaW1lb3V0KSk7dHJ5e3RoaXMuX2l0ZW0udmFsdWVzJiZ0aGlzLl9pdGVtLm1ldGhvZCE9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuR0VUP3RoaXMuX2l0ZW0ubWV0aG9kPT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5QT1NUJiZ0aGlzLl9yZXF1ZXN0LnNlbmQoY3JlYXRlanMuUmVxdWVzdFV0aWxzLmZvcm1hdFF1ZXJ5U3RyaW5nKHRoaXMuX2l0ZW0udmFsdWVzKSk6dGhpcy5fcmVxdWVzdC5zZW5kKCl9Y2F0Y2goYSl7dGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiWEhSX1NFTkRcIixudWxsLGEpKX19LGIuc2V0UmVzcG9uc2VUeXBlPWZ1bmN0aW9uKGEpe1wiYmxvYlwiPT09YSYmKGE9d2luZG93LlVSTD9cImJsb2JcIjpcImFycmF5YnVmZmVyXCIsdGhpcy5fcmVzcG9uc2VUeXBlPWEpLHRoaXMuX3JlcXVlc3QucmVzcG9uc2VUeXBlPWF9LGIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3JlcXVlc3QuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzIGluc3RhbmNlb2YgRnVuY3Rpb24/dGhpcy5fcmVxdWVzdC5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTpudWxsfSxiLmdldFJlc3BvbnNlSGVhZGVyPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9yZXF1ZXN0LmdldFJlc3BvbnNlSGVhZGVyIGluc3RhbmNlb2YgRnVuY3Rpb24/dGhpcy5fcmVxdWVzdC5nZXRSZXNwb25zZUhlYWRlcihhKTpudWxsfSxiLl9oYW5kbGVQcm9ncmVzcz1mdW5jdGlvbihhKXtpZihhJiYhKGEubG9hZGVkPjAmJjA9PWEudG90YWwpKXt2YXIgYj1uZXcgY3JlYXRlanMuUHJvZ3Jlc3NFdmVudChhLmxvYWRlZCxhLnRvdGFsKTt0aGlzLmRpc3BhdGNoRXZlbnQoYil9fSxiLl9oYW5kbGVMb2FkU3RhcnQ9ZnVuY3Rpb24oYSl7Y2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KSx0aGlzLmRpc3BhdGNoRXZlbnQoXCJsb2Fkc3RhcnRcIil9LGIuX2hhbmRsZUFib3J0PWZ1bmN0aW9uKGEpe3RoaXMuX2NsZWFuKCksdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiWEhSX0FCT1JURURcIixudWxsLGEpKX0sYi5faGFuZGxlRXJyb3I9ZnVuY3Rpb24oYSl7dGhpcy5fY2xlYW4oKSx0aGlzLmRpc3BhdGNoRXZlbnQobmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoYS5tZXNzYWdlKSl9LGIuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2U9ZnVuY3Rpb24oYSl7ND09dGhpcy5fcmVxdWVzdC5yZWFkeVN0YXRlJiZ0aGlzLl9oYW5kbGVMb2FkKCl9LGIuX2hhbmRsZUxvYWQ9ZnVuY3Rpb24oYSl7aWYoIXRoaXMubG9hZGVkKXt0aGlzLmxvYWRlZD0hMDt2YXIgYj10aGlzLl9jaGVja0Vycm9yKCk7aWYoYilyZXR1cm4gdm9pZCB0aGlzLl9oYW5kbGVFcnJvcihiKTtpZih0aGlzLl9yZXNwb25zZT10aGlzLl9nZXRSZXNwb25zZSgpLFwiYXJyYXlidWZmZXJcIj09PXRoaXMuX3Jlc3BvbnNlVHlwZSl0cnl7dGhpcy5fcmVzcG9uc2U9bmV3IEJsb2IoW3RoaXMuX3Jlc3BvbnNlXSl9Y2F0Y2goYyl7aWYod2luZG93LkJsb2JCdWlsZGVyPXdpbmRvdy5CbG9iQnVpbGRlcnx8d2luZG93LldlYktpdEJsb2JCdWlsZGVyfHx3aW5kb3cuTW96QmxvYkJ1aWxkZXJ8fHdpbmRvdy5NU0Jsb2JCdWlsZGVyLFwiVHlwZUVycm9yXCI9PT1jLm5hbWUmJndpbmRvdy5CbG9iQnVpbGRlcil7dmFyIGQ9bmV3IEJsb2JCdWlsZGVyO2QuYXBwZW5kKHRoaXMuX3Jlc3BvbnNlKSx0aGlzLl9yZXNwb25zZT1kLmdldEJsb2IoKX19dGhpcy5fY2xlYW4oKSx0aGlzLmRpc3BhdGNoRXZlbnQobmV3IGNyZWF0ZWpzLkV2ZW50KFwiY29tcGxldGVcIikpfX0sYi5faGFuZGxlVGltZW91dD1mdW5jdGlvbihhKXt0aGlzLl9jbGVhbigpLHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIlBSRUxPQURfVElNRU9VVFwiLG51bGwsYSkpfSxiLl9jaGVja0Vycm9yPWZ1bmN0aW9uKCl7dmFyIGE9cGFyc2VJbnQodGhpcy5fcmVxdWVzdC5zdGF0dXMpO3N3aXRjaChhKXtjYXNlIDQwNDpjYXNlIDA6cmV0dXJuIG5ldyBFcnJvcihhKX1yZXR1cm4gbnVsbH0sYi5fZ2V0UmVzcG9uc2U9ZnVuY3Rpb24oKXtpZihudWxsIT10aGlzLl9yZXNwb25zZSlyZXR1cm4gdGhpcy5fcmVzcG9uc2U7aWYobnVsbCE9dGhpcy5fcmVxdWVzdC5yZXNwb25zZSlyZXR1cm4gdGhpcy5fcmVxdWVzdC5yZXNwb25zZTt0cnl7aWYobnVsbCE9dGhpcy5fcmVxdWVzdC5yZXNwb25zZVRleHQpcmV0dXJuIHRoaXMuX3JlcXVlc3QucmVzcG9uc2VUZXh0fWNhdGNoKGEpe310cnl7aWYobnVsbCE9dGhpcy5fcmVxdWVzdC5yZXNwb25zZVhNTClyZXR1cm4gdGhpcy5fcmVxdWVzdC5yZXNwb25zZVhNTH1jYXRjaChhKXt9cmV0dXJuIG51bGx9LGIuX2NyZWF0ZVhIUj1mdW5jdGlvbihhKXt2YXIgYj1jcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNDcm9zc0RvbWFpbihhKSxjPXt9LGQ9bnVsbDtpZih3aW5kb3cuWE1MSHR0cFJlcXVlc3QpZD1uZXcgWE1MSHR0cFJlcXVlc3QsYiYmdm9pZCAwPT09ZC53aXRoQ3JlZGVudGlhbHMmJndpbmRvdy5YRG9tYWluUmVxdWVzdCYmKGQ9bmV3IFhEb21haW5SZXF1ZXN0KTtlbHNle2Zvcih2YXIgZT0wLGY9cy5BQ1RJVkVYX1ZFUlNJT05TLmxlbmd0aDtmPmU7ZSsrKXt2YXIgZz1zLkFDVElWRVhfVkVSU0lPTlNbZV07dHJ5e2Q9bmV3IEFjdGl2ZVhPYmplY3QoZyk7YnJlYWt9Y2F0Y2goaCl7fX1pZihudWxsPT1kKXJldHVybiExfW51bGw9PWEubWltZVR5cGUmJmNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc1RleHQoYS50eXBlKSYmKGEubWltZVR5cGU9XCJ0ZXh0L3BsYWluOyBjaGFyc2V0PXV0Zi04XCIpLGEubWltZVR5cGUmJmQub3ZlcnJpZGVNaW1lVHlwZSYmZC5vdmVycmlkZU1pbWVUeXBlKGEubWltZVR5cGUpLHRoaXMuX3hockxldmVsPVwic3RyaW5nXCI9PXR5cGVvZiBkLnJlc3BvbnNlVHlwZT8yOjE7dmFyIGk9bnVsbDtpZihpPWEubWV0aG9kPT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5HRVQ/Y3JlYXRlanMuUmVxdWVzdFV0aWxzLmJ1aWxkUGF0aChhLnNyYyxhLnZhbHVlcyk6YS5zcmMsZC5vcGVuKGEubWV0aG9kfHxjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5HRVQsaSwhMCksYiYmZCBpbnN0YW5jZW9mIFhNTEh0dHBSZXF1ZXN0JiYxPT10aGlzLl94aHJMZXZlbCYmKGMuT3JpZ2luPWxvY2F0aW9uLm9yaWdpbiksYS52YWx1ZXMmJmEubWV0aG9kPT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5QT1NUJiYoY1tcIkNvbnRlbnQtVHlwZVwiXT1cImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiKSxifHxjW1wiWC1SZXF1ZXN0ZWQtV2l0aFwiXXx8KGNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdPVwiWE1MSHR0cFJlcXVlc3RcIiksYS5oZWFkZXJzKWZvcih2YXIgaiBpbiBhLmhlYWRlcnMpY1tqXT1hLmhlYWRlcnNbal07Zm9yKGogaW4gYylkLnNldFJlcXVlc3RIZWFkZXIoaixjW2pdKTtyZXR1cm4gZCBpbnN0YW5jZW9mIFhNTEh0dHBSZXF1ZXN0JiZ2b2lkIDAhPT1hLndpdGhDcmVkZW50aWFscyYmKGQud2l0aENyZWRlbnRpYWxzPWEud2l0aENyZWRlbnRpYWxzKSx0aGlzLl9yZXF1ZXN0PWQsITB9LGIuX2NsZWFuPWZ1bmN0aW9uKCl7Y2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KSxudWxsIT10aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXI/KHRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImxvYWRzdGFydFwiLHRoaXMuX2hhbmRsZUxvYWRTdGFydFByb3h5KSx0aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiLHRoaXMuX2hhbmRsZVByb2dyZXNzUHJveHkpLHRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFib3J0XCIsdGhpcy5faGFuZGxlQWJvcnRQcm94eSksdGhpcy5fcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKFwiZXJyb3JcIix0aGlzLl9oYW5kbGVFcnJvclByb3h5KSx0aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0aW1lb3V0XCIsdGhpcy5faGFuZGxlVGltZW91dFByb3h5KSx0aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsdGhpcy5faGFuZGxlTG9hZFByb3h5KSx0aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJyZWFkeXN0YXRlY2hhbmdlXCIsdGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZVByb3h5KSk6KHRoaXMuX3JlcXVlc3Qub25sb2Fkc3RhcnQ9bnVsbCx0aGlzLl9yZXF1ZXN0Lm9ucHJvZ3Jlc3M9bnVsbCx0aGlzLl9yZXF1ZXN0Lm9uYWJvcnQ9bnVsbCx0aGlzLl9yZXF1ZXN0Lm9uZXJyb3I9bnVsbCx0aGlzLl9yZXF1ZXN0Lm9udGltZW91dD1udWxsLHRoaXMuX3JlcXVlc3Qub25sb2FkPW51bGwsdGhpcy5fcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCl9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltQcmVsb2FkSlMgWEhSUmVxdWVzdF1cIn0sY3JlYXRlanMuWEhSUmVxdWVzdD1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdFJlcXVlc3RcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiLGMpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoKSx0aGlzLl9wbHVnaW5zPVtdLHRoaXMuX3R5cGVDYWxsYmFja3M9e30sdGhpcy5fZXh0ZW5zaW9uQ2FsbGJhY2tzPXt9LHRoaXMubmV4dD1udWxsLHRoaXMubWFpbnRhaW5TY3JpcHRPcmRlcj0hMCx0aGlzLnN0b3BPbkVycm9yPSExLHRoaXMuX21heENvbm5lY3Rpb25zPTEsdGhpcy5fYXZhaWxhYmxlTG9hZGVycz1bY3JlYXRlanMuSW1hZ2VMb2FkZXIsY3JlYXRlanMuSmF2YVNjcmlwdExvYWRlcixjcmVhdGVqcy5DU1NMb2FkZXIsY3JlYXRlanMuSlNPTkxvYWRlcixjcmVhdGVqcy5KU09OUExvYWRlcixjcmVhdGVqcy5Tb3VuZExvYWRlcixjcmVhdGVqcy5NYW5pZmVzdExvYWRlcixjcmVhdGVqcy5TcHJpdGVTaGVldExvYWRlcixjcmVhdGVqcy5YTUxMb2FkZXIsY3JlYXRlanMuU1ZHTG9hZGVyLGNyZWF0ZWpzLkJpbmFyeUxvYWRlcixjcmVhdGVqcy5WaWRlb0xvYWRlcixjcmVhdGVqcy5UZXh0TG9hZGVyXSx0aGlzLl9kZWZhdWx0TG9hZGVyTGVuZ3RoPXRoaXMuX2F2YWlsYWJsZUxvYWRlcnMubGVuZ3RoLHRoaXMuaW5pdChhLGIsYyl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtiLmluaXQ9ZnVuY3Rpb24oYSxiLGMpe3RoaXMudXNlWEhSPSEwLHRoaXMucHJlZmVyWEhSPSEwLHRoaXMuX3ByZWZlclhIUj0hMCx0aGlzLnNldFByZWZlclhIUihhKSx0aGlzLl9wYXVzZWQ9ITEsdGhpcy5fYmFzZVBhdGg9Yix0aGlzLl9jcm9zc09yaWdpbj1jLHRoaXMuX2xvYWRTdGFydFdhc0Rpc3BhdGNoZWQ9ITEsdGhpcy5fY3VycmVudGx5TG9hZGluZ1NjcmlwdD1udWxsLHRoaXMuX2N1cnJlbnRMb2Fkcz1bXSx0aGlzLl9sb2FkUXVldWU9W10sdGhpcy5fbG9hZFF1ZXVlQmFja3VwPVtdLHRoaXMuX2xvYWRJdGVtc0J5SWQ9e30sdGhpcy5fbG9hZEl0ZW1zQnlTcmM9e30sdGhpcy5fbG9hZGVkUmVzdWx0cz17fSx0aGlzLl9sb2FkZWRSYXdSZXN1bHRzPXt9LHRoaXMuX251bUl0ZW1zPTAsdGhpcy5fbnVtSXRlbXNMb2FkZWQ9MCx0aGlzLl9zY3JpcHRPcmRlcj1bXSx0aGlzLl9sb2FkZWRTY3JpcHRzPVtdLHRoaXMuX2xhc3RQcm9ncmVzcz1OYU59LGMubG9hZFRpbWVvdXQ9OGUzLGMuTE9BRF9USU1FT1VUPTAsYy5CSU5BUlk9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQklOQVJZLGMuQ1NTPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkNTUyxjLklNQUdFPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLklNQUdFLGMuSkFWQVNDUklQVD1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KQVZBU0NSSVBULGMuSlNPTj1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KU09OLGMuSlNPTlA9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSlNPTlAsYy5NQU5JRkVTVD1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5NQU5JRkVTVCxjLlNPVU5EPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNPVU5ELGMuVklERU89Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVklERU8sYy5TVkc9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1ZHLGMuVEVYVD1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5URVhULGMuWE1MPWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlhNTCxjLlBPU1Q9Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuUE9TVCxjLkdFVD1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5HRVQsYi5yZWdpc3RlckxvYWRlcj1mdW5jdGlvbihhKXtpZighYXx8IWEuY2FuTG9hZEl0ZW0pdGhyb3cgbmV3IEVycm9yKFwibG9hZGVyIGlzIG9mIGFuIGluY29ycmVjdCB0eXBlLlwiKTtpZigtMSE9dGhpcy5fYXZhaWxhYmxlTG9hZGVycy5pbmRleE9mKGEpKXRocm93IG5ldyBFcnJvcihcImxvYWRlciBhbHJlYWR5IGV4aXN0cy5cIik7dGhpcy5fYXZhaWxhYmxlTG9hZGVycy51bnNoaWZ0KGEpfSxiLnVucmVnaXN0ZXJMb2FkZXI9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fYXZhaWxhYmxlTG9hZGVycy5pbmRleE9mKGEpOy0xIT1iJiZiPHRoaXMuX2RlZmF1bHRMb2FkZXJMZW5ndGgtMSYmdGhpcy5fYXZhaWxhYmxlTG9hZGVycy5zcGxpY2UoYiwxKX0sYi5zZXRVc2VYSFI9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuc2V0UHJlZmVyWEhSKGEpfSxiLnNldFByZWZlclhIUj1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wcmVmZXJYSFI9MCE9YSYmbnVsbCE9d2luZG93LlhNTEh0dHBSZXF1ZXN0LHRoaXMucHJlZmVyWEhSfSxiLnJlbW92ZUFsbD1mdW5jdGlvbigpe3RoaXMucmVtb3ZlKCl9LGIucmVtb3ZlPWZ1bmN0aW9uKGEpe3ZhciBiPW51bGw7aWYoYSYmIUFycmF5LmlzQXJyYXkoYSkpYj1bYV07ZWxzZSBpZihhKWI9YTtlbHNlIGlmKGFyZ3VtZW50cy5sZW5ndGg+MClyZXR1cm47dmFyIGM9ITE7aWYoYil7Zm9yKDtiLmxlbmd0aDspe3ZhciBkPWIucG9wKCksZT10aGlzLmdldFJlc3VsdChkKTtmb3IoZj10aGlzLl9sb2FkUXVldWUubGVuZ3RoLTE7Zj49MDtmLS0paWYoZz10aGlzLl9sb2FkUXVldWVbZl0uZ2V0SXRlbSgpLGcuaWQ9PWR8fGcuc3JjPT1kKXt0aGlzLl9sb2FkUXVldWUuc3BsaWNlKGYsMSlbMF0uY2FuY2VsKCk7YnJlYWt9Zm9yKGY9dGhpcy5fbG9hZFF1ZXVlQmFja3VwLmxlbmd0aC0xO2Y+PTA7Zi0tKWlmKGc9dGhpcy5fbG9hZFF1ZXVlQmFja3VwW2ZdLmdldEl0ZW0oKSxnLmlkPT1kfHxnLnNyYz09ZCl7dGhpcy5fbG9hZFF1ZXVlQmFja3VwLnNwbGljZShmLDEpWzBdLmNhbmNlbCgpO2JyZWFrfWlmKGUpdGhpcy5fZGlzcG9zZUl0ZW0odGhpcy5nZXRJdGVtKGQpKTtlbHNlIGZvcih2YXIgZj10aGlzLl9jdXJyZW50TG9hZHMubGVuZ3RoLTE7Zj49MDtmLS0pe3ZhciBnPXRoaXMuX2N1cnJlbnRMb2Fkc1tmXS5nZXRJdGVtKCk7aWYoZy5pZD09ZHx8Zy5zcmM9PWQpe3RoaXMuX2N1cnJlbnRMb2Fkcy5zcGxpY2UoZiwxKVswXS5jYW5jZWwoKSxjPSEwO2JyZWFrfX19YyYmdGhpcy5fbG9hZE5leHQoKX1lbHNle3RoaXMuY2xvc2UoKTtmb3IodmFyIGggaW4gdGhpcy5fbG9hZEl0ZW1zQnlJZCl0aGlzLl9kaXNwb3NlSXRlbSh0aGlzLl9sb2FkSXRlbXNCeUlkW2hdKTt0aGlzLmluaXQodGhpcy5wcmVmZXJYSFIsdGhpcy5fYmFzZVBhdGgpfX0sYi5yZXNldD1mdW5jdGlvbigpe3RoaXMuY2xvc2UoKTtmb3IodmFyIGEgaW4gdGhpcy5fbG9hZEl0ZW1zQnlJZCl0aGlzLl9kaXNwb3NlSXRlbSh0aGlzLl9sb2FkSXRlbXNCeUlkW2FdKTtmb3IodmFyIGI9W10sYz0wLGQ9dGhpcy5fbG9hZFF1ZXVlQmFja3VwLmxlbmd0aDtkPmM7YysrKWIucHVzaCh0aGlzLl9sb2FkUXVldWVCYWNrdXBbY10uZ2V0SXRlbSgpKTt0aGlzLmxvYWRNYW5pZmVzdChiLCExKX0sYi5pbnN0YWxsUGx1Z2luPWZ1bmN0aW9uKGEpe2lmKG51bGwhPWEmJm51bGwhPWEuZ2V0UHJlbG9hZEhhbmRsZXJzKXt0aGlzLl9wbHVnaW5zLnB1c2goYSk7dmFyIGI9YS5nZXRQcmVsb2FkSGFuZGxlcnMoKTtpZihiLnNjb3BlPWEsbnVsbCE9Yi50eXBlcylmb3IodmFyIGM9MCxkPWIudHlwZXMubGVuZ3RoO2Q+YztjKyspdGhpcy5fdHlwZUNhbGxiYWNrc1tiLnR5cGVzW2NdXT1iO2lmKG51bGwhPWIuZXh0ZW5zaW9ucylmb3IoYz0wLGQ9Yi5leHRlbnNpb25zLmxlbmd0aDtkPmM7YysrKXRoaXMuX2V4dGVuc2lvbkNhbGxiYWNrc1tiLmV4dGVuc2lvbnNbY11dPWJ9fSxiLnNldE1heENvbm5lY3Rpb25zPWZ1bmN0aW9uKGEpe3RoaXMuX21heENvbm5lY3Rpb25zPWEsIXRoaXMuX3BhdXNlZCYmdGhpcy5fbG9hZFF1ZXVlLmxlbmd0aD4wJiZ0aGlzLl9sb2FkTmV4dCgpfSxiLmxvYWRGaWxlPWZ1bmN0aW9uKGEsYixjKXtpZihudWxsPT1hKXt2YXIgZD1uZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIlBSRUxPQURfTk9fRklMRVwiKTtyZXR1cm4gdm9pZCB0aGlzLl9zZW5kRXJyb3IoZCl9dGhpcy5fYWRkSXRlbShhLG51bGwsYyksYiE9PSExP3RoaXMuc2V0UGF1c2VkKCExKTp0aGlzLnNldFBhdXNlZCghMCl9LGIubG9hZE1hbmlmZXN0PWZ1bmN0aW9uKGEsYixkKXt2YXIgZT1udWxsLGY9bnVsbDtpZihBcnJheS5pc0FycmF5KGEpKXtpZigwPT1hLmxlbmd0aCl7dmFyIGc9bmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJQUkVMT0FEX01BTklGRVNUX0VNUFRZXCIpO3JldHVybiB2b2lkIHRoaXMuX3NlbmRFcnJvcihnKX1lPWF9ZWxzZSBpZihcInN0cmluZ1wiPT10eXBlb2YgYSllPVt7c3JjOmEsdHlwZTpjLk1BTklGRVNUfV07ZWxzZXtpZihcIm9iamVjdFwiIT10eXBlb2YgYSl7dmFyIGc9bmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJQUkVMT0FEX01BTklGRVNUX05VTExcIik7cmV0dXJuIHZvaWQgdGhpcy5fc2VuZEVycm9yKGcpfWlmKHZvaWQgMCE9PWEuc3JjKXtpZihudWxsPT1hLnR5cGUpYS50eXBlPWMuTUFOSUZFU1Q7ZWxzZSBpZihhLnR5cGUhPWMuTUFOSUZFU1Qpe3ZhciBnPW5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiUFJFTE9BRF9NQU5JRkVTVF9UWVBFXCIpO3RoaXMuX3NlbmRFcnJvcihnKX1lPVthXX1lbHNlIHZvaWQgMCE9PWEubWFuaWZlc3QmJihlPWEubWFuaWZlc3QsZj1hLnBhdGgpfWZvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aT5oO2grKyl0aGlzLl9hZGRJdGVtKGVbaF0sZixkKTtiIT09ITE/dGhpcy5zZXRQYXVzZWQoITEpOnRoaXMuc2V0UGF1c2VkKCEwKX0sYi5sb2FkPWZ1bmN0aW9uKCl7dGhpcy5zZXRQYXVzZWQoITEpfSxiLmdldEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX2xvYWRJdGVtc0J5SWRbYV18fHRoaXMuX2xvYWRJdGVtc0J5U3JjW2FdfSxiLmdldFJlc3VsdD1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX2xvYWRJdGVtc0J5SWRbYV18fHRoaXMuX2xvYWRJdGVtc0J5U3JjW2FdO2lmKG51bGw9PWMpcmV0dXJuIG51bGw7dmFyIGQ9Yy5pZDtyZXR1cm4gYiYmdGhpcy5fbG9hZGVkUmF3UmVzdWx0c1tkXT90aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2RdOnRoaXMuX2xvYWRlZFJlc3VsdHNbZF19LGIuZ2V0SXRlbXM9ZnVuY3Rpb24oYSl7dmFyIGI9W107Zm9yKHZhciBjIGluIHRoaXMuX2xvYWRJdGVtc0J5SWQpe3ZhciBkPXRoaXMuX2xvYWRJdGVtc0J5SWRbY10sZT10aGlzLmdldFJlc3VsdChjKTsoYSE9PSEwfHxudWxsIT1lKSYmYi5wdXNoKHtpdGVtOmQscmVzdWx0OmUscmF3UmVzdWx0OnRoaXMuZ2V0UmVzdWx0KGMsITApfSl9cmV0dXJuIGJ9LGIuc2V0UGF1c2VkPWZ1bmN0aW9uKGEpe3RoaXMuX3BhdXNlZD1hLHRoaXMuX3BhdXNlZHx8dGhpcy5fbG9hZE5leHQoKX0sYi5jbG9zZT1mdW5jdGlvbigpe2Zvcig7dGhpcy5fY3VycmVudExvYWRzLmxlbmd0aDspdGhpcy5fY3VycmVudExvYWRzLnBvcCgpLmNhbmNlbCgpO3RoaXMuX3NjcmlwdE9yZGVyLmxlbmd0aD0wLHRoaXMuX2xvYWRlZFNjcmlwdHMubGVuZ3RoPTAsdGhpcy5sb2FkU3RhcnRXYXNEaXNwYXRjaGVkPSExLHRoaXMuX2l0ZW1Db3VudD0wLHRoaXMuX2xhc3RQcm9ncmVzcz1OYU59LGIuX2FkZEl0ZW09ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMuX2NyZWF0ZUxvYWRJdGVtKGEsYixjKTtpZihudWxsIT1kKXt2YXIgZT10aGlzLl9jcmVhdGVMb2FkZXIoZCk7bnVsbCE9ZSYmKFwicGx1Z2luc1wiaW4gZSYmKGUucGx1Z2lucz10aGlzLl9wbHVnaW5zKSxkLl9sb2FkZXI9ZSx0aGlzLl9sb2FkUXVldWUucHVzaChlKSx0aGlzLl9sb2FkUXVldWVCYWNrdXAucHVzaChlKSx0aGlzLl9udW1JdGVtcysrLHRoaXMuX3VwZGF0ZVByb2dyZXNzKCksKHRoaXMubWFpbnRhaW5TY3JpcHRPcmRlciYmZC50eXBlPT1jcmVhdGVqcy5Mb2FkUXVldWUuSkFWQVNDUklQVHx8ZC5tYWludGFpbk9yZGVyPT09ITApJiYodGhpcy5fc2NyaXB0T3JkZXIucHVzaChkKSx0aGlzLl9sb2FkZWRTY3JpcHRzLnB1c2gobnVsbCkpKX19LGIuX2NyZWF0ZUxvYWRJdGVtPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1jcmVhdGVqcy5Mb2FkSXRlbS5jcmVhdGUoYSk7aWYobnVsbD09ZClyZXR1cm4gbnVsbDt2YXIgZT1cIlwiLGY9Y3x8dGhpcy5fYmFzZVBhdGg7aWYoZC5zcmMgaW5zdGFuY2VvZiBPYmplY3Qpe2lmKCFkLnR5cGUpcmV0dXJuIG51bGw7aWYoYil7ZT1iO3ZhciBnPWNyZWF0ZWpzLlJlcXVlc3RVdGlscy5wYXJzZVVSSShiKTtudWxsPT1mfHxnLmFic29sdXRlfHxnLnJlbGF0aXZlfHwoZT1mK2UpfWVsc2UgbnVsbCE9ZiYmKGU9Zil9ZWxzZXt2YXIgaD1jcmVhdGVqcy5SZXF1ZXN0VXRpbHMucGFyc2VVUkkoZC5zcmMpO2guZXh0ZW5zaW9uJiYoZC5leHQ9aC5leHRlbnNpb24pLG51bGw9PWQudHlwZSYmKGQudHlwZT1jcmVhdGVqcy5SZXF1ZXN0VXRpbHMuZ2V0VHlwZUJ5RXh0ZW5zaW9uKGQuZXh0KSk7dmFyIGk9ZC5zcmM7aWYoIWguYWJzb2x1dGUmJiFoLnJlbGF0aXZlKWlmKGIpe2U9Yjt2YXIgZz1jcmVhdGVqcy5SZXF1ZXN0VXRpbHMucGFyc2VVUkkoYik7aT1iK2ksbnVsbD09Znx8Zy5hYnNvbHV0ZXx8Zy5yZWxhdGl2ZXx8KGU9ZitlKX1lbHNlIG51bGwhPWYmJihlPWYpO2Quc3JjPWUrZC5zcmN9ZC5wYXRoPWUsKHZvaWQgMD09PWQuaWR8fG51bGw9PT1kLmlkfHxcIlwiPT09ZC5pZCkmJihkLmlkPWkpO3ZhciBqPXRoaXMuX3R5cGVDYWxsYmFja3NbZC50eXBlXXx8dGhpcy5fZXh0ZW5zaW9uQ2FsbGJhY2tzW2QuZXh0XTtpZihqKXt2YXIgaz1qLmNhbGxiYWNrLmNhbGwoai5zY29wZSxkLHRoaXMpO2lmKGs9PT0hMSlyZXR1cm4gbnVsbDtrPT09ITB8fG51bGwhPWsmJihkLl9sb2FkZXI9ayksaD1jcmVhdGVqcy5SZXF1ZXN0VXRpbHMucGFyc2VVUkkoZC5zcmMpLG51bGwhPWguZXh0ZW5zaW9uJiYoZC5leHQ9aC5leHRlbnNpb24pfXJldHVybiB0aGlzLl9sb2FkSXRlbXNCeUlkW2QuaWRdPWQsdGhpcy5fbG9hZEl0ZW1zQnlTcmNbZC5zcmNdPWQsbnVsbD09ZC5jcm9zc09yaWdpbiYmKGQuY3Jvc3NPcmlnaW49dGhpcy5fY3Jvc3NPcmlnaW4pLGR9LGIuX2NyZWF0ZUxvYWRlcj1mdW5jdGlvbihhKXtpZihudWxsIT1hLl9sb2FkZXIpcmV0dXJuIGEuX2xvYWRlcjtmb3IodmFyIGI9dGhpcy5wcmVmZXJYSFIsYz0wO2M8dGhpcy5fYXZhaWxhYmxlTG9hZGVycy5sZW5ndGg7YysrKXt2YXIgZD10aGlzLl9hdmFpbGFibGVMb2FkZXJzW2NdO2lmKGQmJmQuY2FuTG9hZEl0ZW0oYSkpcmV0dXJuIG5ldyBkKGEsYil9cmV0dXJuIG51bGx9LGIuX2xvYWROZXh0PWZ1bmN0aW9uKCl7aWYoIXRoaXMuX3BhdXNlZCl7dGhpcy5fbG9hZFN0YXJ0V2FzRGlzcGF0Y2hlZHx8KHRoaXMuX3NlbmRMb2FkU3RhcnQoKSx0aGlzLl9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkPSEwKSx0aGlzLl9udW1JdGVtcz09dGhpcy5fbnVtSXRlbXNMb2FkZWQ/KHRoaXMubG9hZGVkPSEwLHRoaXMuX3NlbmRDb21wbGV0ZSgpLHRoaXMubmV4dCYmdGhpcy5uZXh0LmxvYWQmJnRoaXMubmV4dC5sb2FkKCkpOnRoaXMubG9hZGVkPSExO2Zvcih2YXIgYT0wO2E8dGhpcy5fbG9hZFF1ZXVlLmxlbmd0aCYmISh0aGlzLl9jdXJyZW50TG9hZHMubGVuZ3RoPj10aGlzLl9tYXhDb25uZWN0aW9ucyk7YSsrKXt2YXIgYj10aGlzLl9sb2FkUXVldWVbYV07dGhpcy5fY2FuU3RhcnRMb2FkKGIpJiYodGhpcy5fbG9hZFF1ZXVlLnNwbGljZShhLDEpLGEtLSx0aGlzLl9sb2FkSXRlbShiKSl9fX0sYi5fbG9hZEl0ZW09ZnVuY3Rpb24oYSl7YS5vbihcImZpbGVsb2FkXCIsdGhpcy5faGFuZGxlRmlsZUxvYWQsdGhpcyksYS5vbihcInByb2dyZXNzXCIsdGhpcy5faGFuZGxlUHJvZ3Jlc3MsdGhpcyksYS5vbihcImNvbXBsZXRlXCIsdGhpcy5faGFuZGxlRmlsZUNvbXBsZXRlLHRoaXMpLGEub24oXCJlcnJvclwiLHRoaXMuX2hhbmRsZUVycm9yLHRoaXMpLGEub24oXCJmaWxlZXJyb3JcIix0aGlzLl9oYW5kbGVGaWxlRXJyb3IsdGhpcyksdGhpcy5fY3VycmVudExvYWRzLnB1c2goYSksdGhpcy5fc2VuZEZpbGVTdGFydChhLmdldEl0ZW0oKSksYS5sb2FkKCl9LGIuX2hhbmRsZUZpbGVMb2FkPWZ1bmN0aW9uKGEpe2EudGFyZ2V0PW51bGwsdGhpcy5kaXNwYXRjaEV2ZW50KGEpfSxiLl9oYW5kbGVGaWxlRXJyb3I9ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJGSUxFX0xPQURfRVJST1JcIixudWxsLGEuaXRlbSk7dGhpcy5fc2VuZEVycm9yKGIpfSxiLl9oYW5kbGVFcnJvcj1mdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldDt0aGlzLl9udW1JdGVtc0xvYWRlZCsrLHRoaXMuX2ZpbmlzaE9yZGVyZWRJdGVtKGIsITApLHRoaXMuX3VwZGF0ZVByb2dyZXNzKCk7dmFyIGM9bmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJGSUxFX0xPQURfRVJST1JcIixudWxsLGIuZ2V0SXRlbSgpKTt0aGlzLl9zZW5kRXJyb3IoYyksdGhpcy5zdG9wT25FcnJvcj90aGlzLnNldFBhdXNlZCghMCk6KHRoaXMuX3JlbW92ZUxvYWRJdGVtKGIpLHRoaXMuX2NsZWFuTG9hZEl0ZW0oYiksdGhpcy5fbG9hZE5leHQoKSl9LGIuX2hhbmRsZUZpbGVDb21wbGV0ZT1mdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldCxjPWIuZ2V0SXRlbSgpLGQ9Yi5nZXRSZXN1bHQoKTt0aGlzLl9sb2FkZWRSZXN1bHRzW2MuaWRdPWQ7dmFyIGU9Yi5nZXRSZXN1bHQoITApO251bGwhPWUmJmUhPT1kJiYodGhpcy5fbG9hZGVkUmF3UmVzdWx0c1tjLmlkXT1lKSx0aGlzLl9zYXZlTG9hZGVkSXRlbXMoYiksdGhpcy5fcmVtb3ZlTG9hZEl0ZW0oYiksdGhpcy5fZmluaXNoT3JkZXJlZEl0ZW0oYil8fHRoaXMuX3Byb2Nlc3NGaW5pc2hlZExvYWQoYyxiKSx0aGlzLl9jbGVhbkxvYWRJdGVtKGIpfSxiLl9zYXZlTG9hZGVkSXRlbXM9ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRMb2FkZWRJdGVtcygpO2lmKG51bGwhPT1iKWZvcih2YXIgYz0wO2M8Yi5sZW5ndGg7YysrKXt2YXIgZD1iW2NdLml0ZW07dGhpcy5fbG9hZEl0ZW1zQnlTcmNbZC5zcmNdPWQsdGhpcy5fbG9hZEl0ZW1zQnlJZFtkLmlkXT1kLHRoaXMuX2xvYWRlZFJlc3VsdHNbZC5pZF09YltjXS5yZXN1bHQsdGhpcy5fbG9hZGVkUmF3UmVzdWx0c1tkLmlkXT1iW2NdLnJhd1Jlc3VsdH19LGIuX2ZpbmlzaE9yZGVyZWRJdGVtPWZ1bmN0aW9uKGEsYil7dmFyIGM9YS5nZXRJdGVtKCk7aWYodGhpcy5tYWludGFpblNjcmlwdE9yZGVyJiZjLnR5cGU9PWNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUfHxjLm1haW50YWluT3JkZXIpe2EgaW5zdGFuY2VvZiBjcmVhdGVqcy5KYXZhU2NyaXB0TG9hZGVyJiYodGhpcy5fY3VycmVudGx5TG9hZGluZ1NjcmlwdD0hMSk7dmFyIGQ9Y3JlYXRlanMuaW5kZXhPZih0aGlzLl9zY3JpcHRPcmRlcixjKTtyZXR1cm4tMT09ZD8hMToodGhpcy5fbG9hZGVkU2NyaXB0c1tkXT1iPT09ITA/ITA6Yyx0aGlzLl9jaGVja1NjcmlwdExvYWRPcmRlcigpLCEwKX1yZXR1cm4hMX0sYi5fY2hlY2tTY3JpcHRMb2FkT3JkZXI9ZnVuY3Rpb24oKXtmb3IodmFyIGE9dGhpcy5fbG9hZGVkU2NyaXB0cy5sZW5ndGgsYj0wO2E+YjtiKyspe3ZhciBjPXRoaXMuX2xvYWRlZFNjcmlwdHNbYl07aWYobnVsbD09PWMpYnJlYWs7aWYoYyE9PSEwKXt2YXIgZD10aGlzLl9sb2FkZWRSZXN1bHRzW2MuaWRdO2MudHlwZT09Y3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQmJmNyZWF0ZWpzLkRvbVV0aWxzLmFwcGVuZFRvSGVhZChkKTt2YXIgZT1jLl9sb2FkZXI7dGhpcy5fcHJvY2Vzc0ZpbmlzaGVkTG9hZChjLGUpLHRoaXMuX2xvYWRlZFNjcmlwdHNbYl09ITB9fX0sYi5fcHJvY2Vzc0ZpbmlzaGVkTG9hZD1mdW5jdGlvbihhLGIpe2lmKHRoaXMuX251bUl0ZW1zTG9hZGVkKyssIXRoaXMubWFpbnRhaW5TY3JpcHRPcmRlciYmYS50eXBlPT1jcmVhdGVqcy5Mb2FkUXVldWUuSkFWQVNDUklQVCl7dmFyIGM9Yi5nZXRUYWcoKTtjcmVhdGVqcy5Eb21VdGlscy5hcHBlbmRUb0hlYWQoYyl9dGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKSx0aGlzLl9zZW5kRmlsZUNvbXBsZXRlKGEsYiksdGhpcy5fbG9hZE5leHQoKX0sYi5fY2FuU3RhcnRMb2FkPWZ1bmN0aW9uKGEpe2lmKCF0aGlzLm1haW50YWluU2NyaXB0T3JkZXJ8fGEucHJlZmVyWEhSKXJldHVybiEwO3ZhciBiPWEuZ2V0SXRlbSgpO2lmKGIudHlwZSE9Y3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQpcmV0dXJuITA7aWYodGhpcy5fY3VycmVudGx5TG9hZGluZ1NjcmlwdClyZXR1cm4hMTtmb3IodmFyIGM9dGhpcy5fc2NyaXB0T3JkZXIuaW5kZXhPZihiKSxkPTA7Yz5kOyl7dmFyIGU9dGhpcy5fbG9hZGVkU2NyaXB0c1tkXTtpZihudWxsPT1lKXJldHVybiExO2QrK31yZXR1cm4gdGhpcy5fY3VycmVudGx5TG9hZGluZ1NjcmlwdD0hMCwhMH0sYi5fcmVtb3ZlTG9hZEl0ZW09ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPXRoaXMuX2N1cnJlbnRMb2Fkcy5sZW5ndGgsYz0wO2I+YztjKyspaWYodGhpcy5fY3VycmVudExvYWRzW2NdPT1hKXt0aGlzLl9jdXJyZW50TG9hZHMuc3BsaWNlKGMsMSk7YnJlYWt9fSxiLl9jbGVhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3ZhciBiPWEuZ2V0SXRlbSgpO2ImJmRlbGV0ZSBiLl9sb2FkZXJ9LGIuX2hhbmRsZVByb2dyZXNzPWZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O3RoaXMuX3NlbmRGaWxlUHJvZ3Jlc3MoYi5nZXRJdGVtKCksYi5wcm9ncmVzcyksdGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKX0sYi5fdXBkYXRlUHJvZ3Jlc3M9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLl9udW1JdGVtc0xvYWRlZC90aGlzLl9udW1JdGVtcyxiPXRoaXMuX251bUl0ZW1zLXRoaXMuX251bUl0ZW1zTG9hZGVkO2lmKGI+MCl7Zm9yKHZhciBjPTAsZD0wLGU9dGhpcy5fY3VycmVudExvYWRzLmxlbmd0aDtlPmQ7ZCsrKWMrPXRoaXMuX2N1cnJlbnRMb2Fkc1tkXS5wcm9ncmVzczthKz1jL2IqKGIvdGhpcy5fbnVtSXRlbXMpfXRoaXMuX2xhc3RQcm9ncmVzcyE9YSYmKHRoaXMuX3NlbmRQcm9ncmVzcyhhKSx0aGlzLl9sYXN0UHJvZ3Jlc3M9YSl9LGIuX2Rpc3Bvc2VJdGVtPWZ1bmN0aW9uKGEpe2RlbGV0ZSB0aGlzLl9sb2FkZWRSZXN1bHRzW2EuaWRdLGRlbGV0ZSB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2EuaWRdLGRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeUlkW2EuaWRdLGRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeVNyY1thLnNyY119LGIuX3NlbmRGaWxlUHJvZ3Jlc3M9ZnVuY3Rpb24oYSxiKXtpZighdGhpcy5faXNDYW5jZWxlZCgpJiYhdGhpcy5fcGF1c2VkJiZ0aGlzLmhhc0V2ZW50TGlzdGVuZXIoXCJmaWxlcHJvZ3Jlc3NcIikpe3ZhciBjPW5ldyBjcmVhdGVqcy5FdmVudChcImZpbGVwcm9ncmVzc1wiKTtjLnByb2dyZXNzPWIsYy5sb2FkZWQ9YixjLnRvdGFsPTEsYy5pdGVtPWEsdGhpcy5kaXNwYXRjaEV2ZW50KGMpfX0sYi5fc2VuZEZpbGVDb21wbGV0ZT1mdW5jdGlvbihhLGIpe1xuaWYoIXRoaXMuX2lzQ2FuY2VsZWQoKSYmIXRoaXMuX3BhdXNlZCl7dmFyIGM9bmV3IGNyZWF0ZWpzLkV2ZW50KFwiZmlsZWxvYWRcIik7Yy5sb2FkZXI9YixjLml0ZW09YSxjLnJlc3VsdD10aGlzLl9sb2FkZWRSZXN1bHRzW2EuaWRdLGMucmF3UmVzdWx0PXRoaXMuX2xvYWRlZFJhd1Jlc3VsdHNbYS5pZF0sYS5jb21wbGV0ZUhhbmRsZXImJmEuY29tcGxldGVIYW5kbGVyKGMpLHRoaXMuaGFzRXZlbnRMaXN0ZW5lcihcImZpbGVsb2FkXCIpJiZ0aGlzLmRpc3BhdGNoRXZlbnQoYyl9fSxiLl9zZW5kRmlsZVN0YXJ0PWZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBjcmVhdGVqcy5FdmVudChcImZpbGVzdGFydFwiKTtiLml0ZW09YSx0aGlzLmhhc0V2ZW50TGlzdGVuZXIoXCJmaWxlc3RhcnRcIikmJnRoaXMuZGlzcGF0Y2hFdmVudChiKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1ByZWxvYWRKUyBMb2FkUXVldWVdXCJ9LGNyZWF0ZWpzLkxvYWRRdWV1ZT1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsITAsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVEVYVCl9dmFyIGI9KGNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSxhKTtiLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlRFWFR9LGNyZWF0ZWpzLlRleHRMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSl7dGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLCEwLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkJJTkFSWSksdGhpcy5vbihcImluaXRpYWxpemVcIix0aGlzLl91cGRhdGVYSFIsdGhpcyl9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkJJTkFSWX0sYi5fdXBkYXRlWEhSPWZ1bmN0aW9uKGEpe2EubG9hZGVyLnNldFJlc3BvbnNlVHlwZShcImFycmF5YnVmZmVyXCIpfSxjcmVhdGVqcy5CaW5hcnlMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsYixjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5DU1MpLHRoaXMucmVzdWx0Rm9ybWF0dGVyPXRoaXMuX2Zvcm1hdFJlc3VsdCx0aGlzLl90YWdTcmNBdHRyaWJ1dGU9XCJocmVmXCIsYj90aGlzLl90YWc9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpOnRoaXMuX3RhZz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlua1wiKSx0aGlzLl90YWcucmVsPVwic3R5bGVzaGVldFwiLHRoaXMuX3RhZy50eXBlPVwidGV4dC9jc3NcIn12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksYz1hO2MuY2FuTG9hZEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIGEudHlwZT09Y3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQ1NTfSxiLl9mb3JtYXRSZXN1bHQ9ZnVuY3Rpb24oYSl7aWYodGhpcy5fcHJlZmVyWEhSKXt2YXIgYj1hLmdldFRhZygpO2lmKGIuc3R5bGVTaGVldCliLnN0eWxlU2hlZXQuY3NzVGV4dD1hLmdldFJlc3VsdCghMCk7ZWxzZXt2YXIgYz1kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShhLmdldFJlc3VsdCghMCkpO2IuYXBwZW5kQ2hpbGQoYyl9fWVsc2UgYj10aGlzLl90YWc7cmV0dXJuIGNyZWF0ZWpzLkRvbVV0aWxzLmFwcGVuZFRvSGVhZChiKSxifSxjcmVhdGVqcy5DU1NMb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsYixjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5JTUFHRSksdGhpcy5yZXN1bHRGb3JtYXR0ZXI9dGhpcy5fZm9ybWF0UmVzdWx0LHRoaXMuX3RhZ1NyY0F0dHJpYnV0ZT1cInNyY1wiLGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc0ltYWdlVGFnKGEpP3RoaXMuX3RhZz1hOmNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc0ltYWdlVGFnKGEuc3JjKT90aGlzLl90YWc9YS5zcmM6Y3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzSW1hZ2VUYWcoYS50YWcpJiYodGhpcy5fdGFnPWEudGFnKSxudWxsIT10aGlzLl90YWc/dGhpcy5fcHJlZmVyWEhSPSExOnRoaXMuX3RhZz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpLHRoaXMub24oXCJpbml0aWFsaXplXCIsdGhpcy5fdXBkYXRlWEhSLHRoaXMpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSxjPWE7Yy5jYW5Mb2FkSXRlbT1mdW5jdGlvbihhKXtyZXR1cm4gYS50eXBlPT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5JTUFHRX0sYi5sb2FkPWZ1bmN0aW9uKCl7aWYoXCJcIiE9dGhpcy5fdGFnLnNyYyYmdGhpcy5fdGFnLmNvbXBsZXRlKXJldHVybiB2b2lkIHRoaXMuX3NlbmRDb21wbGV0ZSgpO3ZhciBhPXRoaXMuX2l0ZW0uY3Jvc3NPcmlnaW47MT09YSYmKGE9XCJBbm9ueW1vdXNcIiksbnVsbD09YXx8Y3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzTG9jYWwodGhpcy5faXRlbS5zcmMpfHwodGhpcy5fdGFnLmNyb3NzT3JpZ2luPWEpLHRoaXMuQWJzdHJhY3RMb2FkZXJfbG9hZCgpfSxiLl91cGRhdGVYSFI9ZnVuY3Rpb24oYSl7YS5sb2FkZXIubWltZVR5cGU9XCJ0ZXh0L3BsYWluOyBjaGFyc2V0PXgtdXNlci1kZWZpbmVkLWJpbmFyeVwiLGEubG9hZGVyLnNldFJlc3BvbnNlVHlwZSYmYS5sb2FkZXIuc2V0UmVzcG9uc2VUeXBlKFwiYmxvYlwiKX0sYi5fZm9ybWF0UmVzdWx0PWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9mb3JtYXRJbWFnZX0sYi5fZm9ybWF0SW1hZ2U9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLl90YWcsZD13aW5kb3cuVVJMfHx3aW5kb3cud2Via2l0VVJMO2lmKHRoaXMuX3ByZWZlclhIUilpZihkKXt2YXIgZT1kLmNyZWF0ZU9iamVjdFVSTCh0aGlzLmdldFJlc3VsdCghMCkpO2Muc3JjPWUsYy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLHRoaXMuX2NsZWFuVXBVUkwsITEpLGMuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsdGhpcy5fY2xlYW5VcFVSTCwhMSl9ZWxzZSBjLnNyYz10aGlzLl9pdGVtLnNyYztlbHNlO2MuY29tcGxldGU/YShjKTooYy5vbmxvYWQ9Y3JlYXRlanMucHJveHkoZnVuY3Rpb24oKXthKHRoaXMuX3RhZyl9LHRoaXMpLGMub25lcnJvcj1jcmVhdGVqcy5wcm94eShmdW5jdGlvbigpe2IoX3RoaXMuX3RhZyl9LHRoaXMpKX0sYi5fY2xlYW5VcFVSTD1mdW5jdGlvbihhKXt2YXIgYj13aW5kb3cuVVJMfHx3aW5kb3cud2Via2l0VVJMO2IucmV2b2tlT2JqZWN0VVJMKGEudGFyZ2V0LnNyYyl9LGNyZWF0ZWpzLkltYWdlTG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYil7dGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLGIsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSkFWQVNDUklQVCksdGhpcy5yZXN1bHRGb3JtYXR0ZXI9dGhpcy5fZm9ybWF0UmVzdWx0LHRoaXMuX3RhZ1NyY0F0dHJpYnV0ZT1cInNyY1wiLHRoaXMuc2V0VGFnKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIikpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSxjPWE7Yy5jYW5Mb2FkSXRlbT1mdW5jdGlvbihhKXtyZXR1cm4gYS50eXBlPT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KQVZBU0NSSVBUfSxiLl9mb3JtYXRSZXN1bHQ9ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRUYWcoKTtyZXR1cm4gdGhpcy5fcHJlZmVyWEhSJiYoYi50ZXh0PWEuZ2V0UmVzdWx0KCEwKSksYn0sY3JlYXRlanMuSmF2YVNjcmlwdExvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsITAsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSlNPTiksdGhpcy5yZXN1bHRGb3JtYXR0ZXI9dGhpcy5fZm9ybWF0UmVzdWx0fXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSxjPWE7Yy5jYW5Mb2FkSXRlbT1mdW5jdGlvbihhKXtyZXR1cm4gYS50eXBlPT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KU09OfSxiLl9mb3JtYXRSZXN1bHQ9ZnVuY3Rpb24oYSl7dmFyIGI9bnVsbDt0cnl7Yj1jcmVhdGVqcy5EYXRhVXRpbHMucGFyc2VKU09OKGEuZ2V0UmVzdWx0KCEwKSl9Y2F0Y2goYyl7dmFyIGQ9bmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJKU09OX0ZPUk1BVFwiLG51bGwsYyk7cmV0dXJuIHRoaXMuX3NlbmRFcnJvcihkKSxjfXJldHVybiBifSxjcmVhdGVqcy5KU09OTG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSwhMSxjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KU09OUCksdGhpcy5zZXRUYWcoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKSksdGhpcy5nZXRUYWcoKS50eXBlPVwidGV4dC9qYXZhc2NyaXB0XCJ9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT05QfSxiLmNhbmNlbD1mdW5jdGlvbigpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY2FuY2VsKCksdGhpcy5fZGlzcG9zZSgpfSxiLmxvYWQ9ZnVuY3Rpb24oKXtpZihudWxsPT10aGlzLl9pdGVtLmNhbGxiYWNrKXRocm93IG5ldyBFcnJvcihcImNhbGxiYWNrIGlzIHJlcXVpcmVkIGZvciBsb2FkaW5nIEpTT05QIHJlcXVlc3RzLlwiKTtpZihudWxsIT13aW5kb3dbdGhpcy5faXRlbS5jYWxsYmFja10pdGhyb3cgbmV3IEVycm9yKFwiSlNPTlAgY2FsbGJhY2sgJ1wiK3RoaXMuX2l0ZW0uY2FsbGJhY2srXCInIGFscmVhZHkgZXhpc3RzIG9uIHdpbmRvdy4gWW91IG5lZWQgdG8gc3BlY2lmeSBhIGRpZmZlcmVudCBjYWxsYmFjayBvciByZS1uYW1lIHRoZSBjdXJyZW50IG9uZS5cIik7d2luZG93W3RoaXMuX2l0ZW0uY2FsbGJhY2tdPWNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUxvYWQsdGhpcyksd2luZG93LmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5fdGFnKSx0aGlzLl9sb2FkVGltZW91dD1zZXRUaW1lb3V0KGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRpbWVvdXQsdGhpcyksdGhpcy5faXRlbS5sb2FkVGltZW91dCksdGhpcy5fdGFnLnNyYz10aGlzLl9pdGVtLnNyY30sYi5faGFuZGxlTG9hZD1mdW5jdGlvbihhKXt0aGlzLl9yZXN1bHQ9dGhpcy5fcmF3UmVzdWx0PWEsdGhpcy5fc2VuZENvbXBsZXRlKCksdGhpcy5fZGlzcG9zZSgpfSxiLl9oYW5kbGVUaW1lb3V0PWZ1bmN0aW9uKCl7dGhpcy5fZGlzcG9zZSgpLHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXJyb3JFdmVudChcInRpbWVvdXRcIikpfSxiLl9kaXNwb3NlPWZ1bmN0aW9uKCl7d2luZG93LmRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5fdGFnKSxkZWxldGUgd2luZG93W3RoaXMuX2l0ZW0uY2FsbGJhY2tdLGNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCl9LGNyZWF0ZWpzLkpTT05QTG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSxudWxsLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLk1BTklGRVNUKSx0aGlzLnBsdWdpbnM9bnVsbCx0aGlzLl9tYW5pZmVzdFF1ZXVlPW51bGx9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLk1BTklGRVNUX1BST0dSRVNTPS4yNSxjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLk1BTklGRVNUfSxiLmxvYWQ9ZnVuY3Rpb24oKXt0aGlzLkFic3RyYWN0TG9hZGVyX2xvYWQoKX0sYi5fY3JlYXRlUmVxdWVzdD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuX2l0ZW0uY2FsbGJhY2s7bnVsbCE9YT90aGlzLl9yZXF1ZXN0PW5ldyBjcmVhdGVqcy5KU09OUExvYWRlcih0aGlzLl9pdGVtKTp0aGlzLl9yZXF1ZXN0PW5ldyBjcmVhdGVqcy5KU09OTG9hZGVyKHRoaXMuX2l0ZW0pfSxiLmhhbmRsZUV2ZW50PWZ1bmN0aW9uKGEpe3N3aXRjaChhLnR5cGUpe2Nhc2VcImNvbXBsZXRlXCI6cmV0dXJuIHRoaXMuX3Jhd1Jlc3VsdD1hLnRhcmdldC5nZXRSZXN1bHQoITApLHRoaXMuX3Jlc3VsdD1hLnRhcmdldC5nZXRSZXN1bHQoKSx0aGlzLl9zZW5kUHJvZ3Jlc3MoYy5NQU5JRkVTVF9QUk9HUkVTUyksdm9pZCB0aGlzLl9sb2FkTWFuaWZlc3QodGhpcy5fcmVzdWx0KTtjYXNlXCJwcm9ncmVzc1wiOnJldHVybiBhLmxvYWRlZCo9Yy5NQU5JRkVTVF9QUk9HUkVTUyx0aGlzLnByb2dyZXNzPWEubG9hZGVkL2EudG90YWwsKGlzTmFOKHRoaXMucHJvZ3Jlc3MpfHx0aGlzLnByb2dyZXNzPT0xLzApJiYodGhpcy5wcm9ncmVzcz0wKSx2b2lkIHRoaXMuX3NlbmRQcm9ncmVzcyhhKX10aGlzLkFic3RyYWN0TG9hZGVyX2hhbmRsZUV2ZW50KGEpfSxiLmRlc3Ryb3k9ZnVuY3Rpb24oKXt0aGlzLkFic3RyYWN0TG9hZGVyX2Rlc3Ryb3koKSx0aGlzLl9tYW5pZmVzdFF1ZXVlLmNsb3NlKCl9LGIuX2xvYWRNYW5pZmVzdD1mdW5jdGlvbihhKXtpZihhJiZhLm1hbmlmZXN0KXt2YXIgYj10aGlzLl9tYW5pZmVzdFF1ZXVlPW5ldyBjcmVhdGVqcy5Mb2FkUXVldWU7Yi5vbihcImZpbGVsb2FkXCIsdGhpcy5faGFuZGxlTWFuaWZlc3RGaWxlTG9hZCx0aGlzKSxiLm9uKFwicHJvZ3Jlc3NcIix0aGlzLl9oYW5kbGVNYW5pZmVzdFByb2dyZXNzLHRoaXMpLGIub24oXCJjb21wbGV0ZVwiLHRoaXMuX2hhbmRsZU1hbmlmZXN0Q29tcGxldGUsdGhpcywhMCksYi5vbihcImVycm9yXCIsdGhpcy5faGFuZGxlTWFuaWZlc3RFcnJvcix0aGlzLCEwKTtmb3IodmFyIGM9MCxkPXRoaXMucGx1Z2lucy5sZW5ndGg7ZD5jO2MrKyliLmluc3RhbGxQbHVnaW4odGhpcy5wbHVnaW5zW2NdKTtiLmxvYWRNYW5pZmVzdChhKX1lbHNlIHRoaXMuX3NlbmRDb21wbGV0ZSgpfSxiLl9oYW5kbGVNYW5pZmVzdEZpbGVMb2FkPWZ1bmN0aW9uKGEpe2EudGFyZ2V0PW51bGwsdGhpcy5kaXNwYXRjaEV2ZW50KGEpfSxiLl9oYW5kbGVNYW5pZmVzdENvbXBsZXRlPWZ1bmN0aW9uKGEpe3RoaXMuX2xvYWRlZEl0ZW1zPXRoaXMuX21hbmlmZXN0UXVldWUuZ2V0SXRlbXMoITApLHRoaXMuX3NlbmRDb21wbGV0ZSgpfSxiLl9oYW5kbGVNYW5pZmVzdFByb2dyZXNzPWZ1bmN0aW9uKGEpe3RoaXMucHJvZ3Jlc3M9YS5wcm9ncmVzcyooMS1jLk1BTklGRVNUX1BST0dSRVNTKStjLk1BTklGRVNUX1BST0dSRVNTLHRoaXMuX3NlbmRQcm9ncmVzcyh0aGlzLnByb2dyZXNzKX0sYi5faGFuZGxlTWFuaWZlc3RFcnJvcj1mdW5jdGlvbihhKXt2YXIgYj1uZXcgY3JlYXRlanMuRXZlbnQoXCJmaWxlZXJyb3JcIik7Yi5pdGVtPWEuZGF0YSx0aGlzLmRpc3BhdGNoRXZlbnQoYil9LGNyZWF0ZWpzLk1hbmlmZXN0TG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYil7dGhpcy5BYnN0cmFjdE1lZGlhTG9hZGVyX2NvbnN0cnVjdG9yKGEsYixjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5TT1VORCksY3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzQXVkaW9UYWcoYSk/dGhpcy5fdGFnPWE6Y3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzQXVkaW9UYWcoYS5zcmMpP3RoaXMuX3RhZz1hOmNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc0F1ZGlvVGFnKGEudGFnKSYmKHRoaXMuX3RhZz1jcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNBdWRpb1RhZyhhKT9hOmEuc3JjKSxudWxsIT10aGlzLl90YWcmJih0aGlzLl9wcmVmZXJYSFI9ITEpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0TWVkaWFMb2FkZXIpLGM9YTtjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNPVU5EfSxiLl9jcmVhdGVUYWc9ZnVuY3Rpb24oYSl7dmFyIGI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImF1ZGlvXCIpO3JldHVybiBiLmF1dG9wbGF5PSExLGIucHJlbG9hZD1cIm5vbmVcIixiLnNyYz1hLGJ9LGNyZWF0ZWpzLlNvdW5kTG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TWVkaWFMb2FkZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYSxiKXt0aGlzLkFic3RyYWN0TWVkaWFMb2FkZXJfY29uc3RydWN0b3IoYSxiLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlZJREVPKSxjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNWaWRlb1RhZyhhKXx8Y3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzVmlkZW9UYWcoYS5zcmMpPyh0aGlzLnNldFRhZyhjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNWaWRlb1RhZyhhKT9hOmEuc3JjKSx0aGlzLl9wcmVmZXJYSFI9ITEpOnRoaXMuc2V0VGFnKHRoaXMuX2NyZWF0ZVRhZygpKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdE1lZGlhTG9hZGVyKSxjPWE7Yi5fY3JlYXRlVGFnPWZ1bmN0aW9uKCl7cmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ2aWRlb1wiKX0sYy5jYW5Mb2FkSXRlbT1mdW5jdGlvbihhKXtyZXR1cm4gYS50eXBlPT1jcmVhdGVqcy5BYnN0cmFjdExvYWRlci5WSURFT30sY3JlYXRlanMuVmlkZW9Mb2FkZXI9Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RNZWRpYUxvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIpe3RoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSxiLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNQUklURVNIRUVUKSx0aGlzLl9tYW5pZmVzdFF1ZXVlPW51bGx9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLlNQUklURVNIRUVUX1BST0dSRVNTPS4yNSxjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNQUklURVNIRUVUfSxiLmRlc3Ryb3k9ZnVuY3Rpb24oKXt0aGlzLkFic3RyYWN0TG9hZGVyX2Rlc3Ryb3ksdGhpcy5fbWFuaWZlc3RRdWV1ZS5jbG9zZSgpfSxiLl9jcmVhdGVSZXF1ZXN0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5faXRlbS5jYWxsYmFjaztudWxsIT1hP3RoaXMuX3JlcXVlc3Q9bmV3IGNyZWF0ZWpzLkpTT05QTG9hZGVyKHRoaXMuX2l0ZW0pOnRoaXMuX3JlcXVlc3Q9bmV3IGNyZWF0ZWpzLkpTT05Mb2FkZXIodGhpcy5faXRlbSl9LGIuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oYSl7c3dpdGNoKGEudHlwZSl7Y2FzZVwiY29tcGxldGVcIjpyZXR1cm4gdGhpcy5fcmF3UmVzdWx0PWEudGFyZ2V0LmdldFJlc3VsdCghMCksdGhpcy5fcmVzdWx0PWEudGFyZ2V0LmdldFJlc3VsdCgpLHRoaXMuX3NlbmRQcm9ncmVzcyhjLlNQUklURVNIRUVUX1BST0dSRVNTKSx2b2lkIHRoaXMuX2xvYWRNYW5pZmVzdCh0aGlzLl9yZXN1bHQpO2Nhc2VcInByb2dyZXNzXCI6cmV0dXJuIGEubG9hZGVkKj1jLlNQUklURVNIRUVUX1BST0dSRVNTLHRoaXMucHJvZ3Jlc3M9YS5sb2FkZWQvYS50b3RhbCwoaXNOYU4odGhpcy5wcm9ncmVzcyl8fHRoaXMucHJvZ3Jlc3M9PTEvMCkmJih0aGlzLnByb2dyZXNzPTApLHZvaWQgdGhpcy5fc2VuZFByb2dyZXNzKGEpfXRoaXMuQWJzdHJhY3RMb2FkZXJfaGFuZGxlRXZlbnQoYSl9LGIuX2xvYWRNYW5pZmVzdD1mdW5jdGlvbihhKXtpZihhJiZhLmltYWdlcyl7dmFyIGI9dGhpcy5fbWFuaWZlc3RRdWV1ZT1uZXcgY3JlYXRlanMuTG9hZFF1ZXVlKHRoaXMuX3ByZWZlclhIUix0aGlzLl9pdGVtLnBhdGgsdGhpcy5faXRlbS5jcm9zc09yaWdpbik7Yi5vbihcImNvbXBsZXRlXCIsdGhpcy5faGFuZGxlTWFuaWZlc3RDb21wbGV0ZSx0aGlzLCEwKSxiLm9uKFwiZmlsZWxvYWRcIix0aGlzLl9oYW5kbGVNYW5pZmVzdEZpbGVMb2FkLHRoaXMpLGIub24oXCJwcm9ncmVzc1wiLHRoaXMuX2hhbmRsZU1hbmlmZXN0UHJvZ3Jlc3MsdGhpcyksYi5vbihcImVycm9yXCIsdGhpcy5faGFuZGxlTWFuaWZlc3RFcnJvcix0aGlzLCEwKSxiLmxvYWRNYW5pZmVzdChhLmltYWdlcyl9fSxiLl9oYW5kbGVNYW5pZmVzdEZpbGVMb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPWEucmVzdWx0O2lmKG51bGwhPWIpe3ZhciBjPXRoaXMuZ2V0UmVzdWx0KCkuaW1hZ2VzLGQ9Yy5pbmRleE9mKGEuaXRlbS5zcmMpO2NbZF09Yn19LGIuX2hhbmRsZU1hbmlmZXN0Q29tcGxldGU9ZnVuY3Rpb24oYSl7dGhpcy5fcmVzdWx0PW5ldyBjcmVhdGVqcy5TcHJpdGVTaGVldCh0aGlzLl9yZXN1bHQpLHRoaXMuX2xvYWRlZEl0ZW1zPXRoaXMuX21hbmlmZXN0UXVldWUuZ2V0SXRlbXMoITApLHRoaXMuX3NlbmRDb21wbGV0ZSgpfSxiLl9oYW5kbGVNYW5pZmVzdFByb2dyZXNzPWZ1bmN0aW9uKGEpe3RoaXMucHJvZ3Jlc3M9YS5wcm9ncmVzcyooMS1jLlNQUklURVNIRUVUX1BST0dSRVNTKStjLlNQUklURVNIRUVUX1BST0dSRVNTLHRoaXMuX3NlbmRQcm9ncmVzcyh0aGlzLnByb2dyZXNzKX0sYi5faGFuZGxlTWFuaWZlc3RFcnJvcj1mdW5jdGlvbihhKXt2YXIgYj1uZXcgY3JlYXRlanMuRXZlbnQoXCJmaWxlZXJyb3JcIik7Yi5pdGVtPWEuZGF0YSx0aGlzLmRpc3BhdGNoRXZlbnQoYil9LGNyZWF0ZWpzLlNwcml0ZVNoZWV0TG9hZGVyPWNyZWF0ZWpzLnByb21vdGUoYSxcIkFic3RyYWN0TG9hZGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYil7dGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLGIsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1ZHKSx0aGlzLnJlc3VsdEZvcm1hdHRlcj10aGlzLl9mb3JtYXRSZXN1bHQsdGhpcy5fdGFnU3JjQXR0cmlidXRlPVwiZGF0YVwiLGI/dGhpcy5zZXRUYWcoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN2Z1wiKSk6KHRoaXMuc2V0VGFnKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvYmplY3RcIikpLHRoaXMuZ2V0VGFnKCkudHlwZT1cImltYWdlL3N2Zyt4bWxcIil9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNWR30sYi5fZm9ybWF0UmVzdWx0PWZ1bmN0aW9uKGEpe3ZhciBiPWNyZWF0ZWpzLkRhdGFVdGlscy5wYXJzZVhNTChhLmdldFJlc3VsdCghMCksXCJ0ZXh0L3htbFwiKSxjPWEuZ2V0VGFnKCk7cmV0dXJuIXRoaXMuX3ByZWZlclhIUiYmZG9jdW1lbnQuYm9keS5jb250YWlucyhjKSYmZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChjKSxudWxsIT1iLmRvY3VtZW50RWxlbWVudD8oYy5hcHBlbmRDaGlsZChiLmRvY3VtZW50RWxlbWVudCksYy5zdHlsZS52aXNpYmlsaXR5PVwidmlzaWJsZVwiLGMpOmJ9LGNyZWF0ZWpzLlNWR0xvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsITAsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuWE1MKSx0aGlzLnJlc3VsdEZvcm1hdHRlcj10aGlzLl9mb3JtYXRSZXN1bHR9dmFyIGI9Y3JlYXRlanMuZXh0ZW5kKGEsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLGM9YTtjLmNhbkxvYWRJdGVtPWZ1bmN0aW9uKGEpe3JldHVybiBhLnR5cGU9PWNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlhNTH0sYi5fZm9ybWF0UmVzdWx0PWZ1bmN0aW9uKGEpe3JldHVybiBjcmVhdGVqcy5EYXRhVXRpbHMucGFyc2VYTUwoYS5nZXRSZXN1bHQoITApLFwidGV4dC94bWxcIil9LGNyZWF0ZWpzLlhNTExvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7dmFyIGE9Y3JlYXRlanMuU291bmRKUz1jcmVhdGVqcy5Tb3VuZEpTfHx7fTthLnZlcnNpb249XCIwLjYuMlwiLGEuYnVpbGREYXRlPVwiVGh1LCAyNiBOb3YgMjAxNSAyMDo0NDozMSBHTVRcIn0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGNyZWF0ZWpzLmluZGV4T2Y9ZnVuY3Rpb24oYSxiKXtcInVzZSBzdHJpY3RcIjtmb3IodmFyIGM9MCxkPWEubGVuZ3RoO2Q+YztjKyspaWYoYj09PWFbY10pcmV0dXJuIGM7cmV0dXJuLTF9LHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtjcmVhdGVqcy5wcm94eT1mdW5jdGlvbihhLGIpe3ZhciBjPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywyKTtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShiLEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywwKS5jb25jYXQoYykpfX19KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aHJvd1wiQnJvd3NlckRldGVjdCBjYW5ub3QgYmUgaW5zdGFudGlhdGVkXCJ9dmFyIGI9YS5hZ2VudD13aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDthLmlzV2luZG93UGhvbmU9Yi5pbmRleE9mKFwiSUVNb2JpbGVcIik+LTF8fGIuaW5kZXhPZihcIldpbmRvd3MgUGhvbmVcIik+LTEsYS5pc0ZpcmVmb3g9Yi5pbmRleE9mKFwiRmlyZWZveFwiKT4tMSxhLmlzT3BlcmE9bnVsbCE9d2luZG93Lm9wZXJhLGEuaXNDaHJvbWU9Yi5pbmRleE9mKFwiQ2hyb21lXCIpPi0xLGEuaXNJT1M9KGIuaW5kZXhPZihcImlQb2RcIik+LTF8fGIuaW5kZXhPZihcImlQaG9uZVwiKT4tMXx8Yi5pbmRleE9mKFwiaVBhZFwiKT4tMSkmJiFhLmlzV2luZG93UGhvbmUsYS5pc0FuZHJvaWQ9Yi5pbmRleE9mKFwiQW5kcm9pZFwiKT4tMSYmIWEuaXNXaW5kb3dQaG9uZSxhLmlzQmxhY2tiZXJyeT1iLmluZGV4T2YoXCJCbGFja2JlcnJ5XCIpPi0xLGNyZWF0ZWpzLkJyb3dzZXJEZXRlY3Q9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7dmFyIGE9ZnVuY3Rpb24oKXt0aGlzLmludGVycnVwdD1udWxsLHRoaXMuZGVsYXk9bnVsbCx0aGlzLm9mZnNldD1udWxsLHRoaXMubG9vcD1udWxsLHRoaXMudm9sdW1lPW51bGwsdGhpcy5wYW49bnVsbCx0aGlzLnN0YXJ0VGltZT1udWxsLHRoaXMuZHVyYXRpb249bnVsbH0sYj1hLnByb3RvdHlwZT17fSxjPWE7Yy5jcmVhdGU9ZnVuY3Rpb24oYSl7aWYoYSBpbnN0YW5jZW9mIGN8fGEgaW5zdGFuY2VvZiBPYmplY3Qpe3ZhciBiPW5ldyBjcmVhdGVqcy5QbGF5UHJvcHNDb25maWc7cmV0dXJuIGIuc2V0KGEpLGJ9dGhyb3cgbmV3IEVycm9yKFwiVHlwZSBub3QgcmVjb2duaXplZC5cIil9LGIuc2V0PWZ1bmN0aW9uKGEpe2Zvcih2YXIgYiBpbiBhKXRoaXNbYl09YVtiXTtyZXR1cm4gdGhpc30sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1BsYXlQcm9wc0NvbmZpZ11cIn0sY3JlYXRlanMuUGxheVByb3BzQ29uZmlnPWN9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aHJvd1wiU291bmQgY2Fubm90IGJlIGluc3RhbnRpYXRlZFwifWZ1bmN0aW9uIGIoYSxiKXt0aGlzLmluaXQoYSxiKX12YXIgYz1hO2MuSU5URVJSVVBUX0FOWT1cImFueVwiLGMuSU5URVJSVVBUX0VBUkxZPVwiZWFybHlcIixjLklOVEVSUlVQVF9MQVRFPVwibGF0ZVwiLGMuSU5URVJSVVBUX05PTkU9XCJub25lXCIsYy5QTEFZX0lOSVRFRD1cInBsYXlJbml0ZWRcIixjLlBMQVlfU1VDQ0VFREVEPVwicGxheVN1Y2NlZWRlZFwiLGMuUExBWV9JTlRFUlJVUFRFRD1cInBsYXlJbnRlcnJ1cHRlZFwiLGMuUExBWV9GSU5JU0hFRD1cInBsYXlGaW5pc2hlZFwiLGMuUExBWV9GQUlMRUQ9XCJwbGF5RmFpbGVkXCIsYy5TVVBQT1JURURfRVhURU5TSU9OUz1bXCJtcDNcIixcIm9nZ1wiLFwib3B1c1wiLFwibXBlZ1wiLFwid2F2XCIsXCJtNGFcIixcIm1wNFwiLFwiYWlmZlwiLFwid21hXCIsXCJtaWRcIl0sYy5FWFRFTlNJT05fTUFQPXttNGE6XCJtcDRcIn0sYy5GSUxFX1BBVFRFUk49L14oPzooXFx3KzopXFwvezJ9KFxcdysoPzpcXC5cXHcrKSpcXC8/KSk/KFtcXC8uXSo/KD86W14/XSspP1xcLyk/KCg/OlteXFwvP10rKVxcLihcXHcrKSkoPzpcXD8oXFxTKyk/KT8kLyxjLmRlZmF1bHRJbnRlcnJ1cHRCZWhhdmlvcj1jLklOVEVSUlVQVF9OT05FLGMuYWx0ZXJuYXRlRXh0ZW5zaW9ucz1bXSxjLmFjdGl2ZVBsdWdpbj1udWxsLGMuX21hc3RlclZvbHVtZT0xLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLFwidm9sdW1lXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXN0ZXJWb2x1bWV9LHNldDpmdW5jdGlvbihhKXtpZihudWxsPT1OdW1iZXIoYSkpcmV0dXJuITE7aWYoYT1NYXRoLm1heCgwLE1hdGgubWluKDEsYSkpLGMuX21hc3RlclZvbHVtZT1hLCF0aGlzLmFjdGl2ZVBsdWdpbnx8IXRoaXMuYWN0aXZlUGx1Z2luLnNldFZvbHVtZXx8IXRoaXMuYWN0aXZlUGx1Z2luLnNldFZvbHVtZShhKSlmb3IodmFyIGI9dGhpcy5faW5zdGFuY2VzLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspYltkXS5zZXRNYXN0ZXJWb2x1bWUoYSl9fSksYy5fbWFzdGVyTXV0ZT0hMSxPYmplY3QuZGVmaW5lUHJvcGVydHkoYyxcIm11dGVkXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXN0ZXJNdXRlfSxzZXQ6ZnVuY3Rpb24oYSl7aWYobnVsbD09YSlyZXR1cm4hMTtpZih0aGlzLl9tYXN0ZXJNdXRlPWEsIXRoaXMuYWN0aXZlUGx1Z2lufHwhdGhpcy5hY3RpdmVQbHVnaW4uc2V0TXV0ZXx8IXRoaXMuYWN0aXZlUGx1Z2luLnNldE11dGUoYSkpZm9yKHZhciBiPXRoaXMuX2luc3RhbmNlcyxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKWJbY10uc2V0TWFzdGVyTXV0ZShhKTtyZXR1cm4hMH19KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoYyxcImNhcGFiaWxpdGllc1wiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbD09Yy5hY3RpdmVQbHVnaW4/bnVsbDpjLmFjdGl2ZVBsdWdpbi5fY2FwYWJpbGl0aWVzfSxzZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuITF9fSksYy5fcGx1Z2luc1JlZ2lzdGVyZWQ9ITEsYy5fbGFzdElEPTAsYy5faW5zdGFuY2VzPVtdLGMuX2lkSGFzaD17fSxjLl9wcmVsb2FkSGFzaD17fSxjLl9kZWZhdWx0UGxheVByb3BzSGFzaD17fSxjLmFkZEV2ZW50TGlzdGVuZXI9bnVsbCxjLnJlbW92ZUV2ZW50TGlzdGVuZXI9bnVsbCxjLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzPW51bGwsYy5kaXNwYXRjaEV2ZW50PW51bGwsYy5oYXNFdmVudExpc3RlbmVyPW51bGwsYy5fbGlzdGVuZXJzPW51bGwsY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyLmluaXRpYWxpemUoYyksYy5nZXRQcmVsb2FkSGFuZGxlcnM9ZnVuY3Rpb24oKXtyZXR1cm57Y2FsbGJhY2s6Y3JlYXRlanMucHJveHkoYy5pbml0TG9hZCxjKSx0eXBlczpbXCJzb3VuZFwiXSxleHRlbnNpb25zOmMuU1VQUE9SVEVEX0VYVEVOU0lPTlN9fSxjLl9oYW5kbGVMb2FkQ29tcGxldGU9ZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQuZ2V0SXRlbSgpLnNyYztpZihjLl9wcmVsb2FkSGFzaFtiXSlmb3IodmFyIGQ9MCxlPWMuX3ByZWxvYWRIYXNoW2JdLmxlbmd0aDtlPmQ7ZCsrKXt2YXIgZj1jLl9wcmVsb2FkSGFzaFtiXVtkXTtpZihjLl9wcmVsb2FkSGFzaFtiXVtkXT0hMCxjLmhhc0V2ZW50TGlzdGVuZXIoXCJmaWxlbG9hZFwiKSl7dmFyIGE9bmV3IGNyZWF0ZWpzLkV2ZW50KFwiZmlsZWxvYWRcIik7YS5zcmM9Zi5zcmMsYS5pZD1mLmlkLGEuZGF0YT1mLmRhdGEsYS5zcHJpdGU9Zi5zcHJpdGUsYy5kaXNwYXRjaEV2ZW50KGEpfX19LGMuX2hhbmRsZUxvYWRFcnJvcj1mdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldC5nZXRJdGVtKCkuc3JjO2lmKGMuX3ByZWxvYWRIYXNoW2JdKWZvcih2YXIgZD0wLGU9Yy5fcHJlbG9hZEhhc2hbYl0ubGVuZ3RoO2U+ZDtkKyspe3ZhciBmPWMuX3ByZWxvYWRIYXNoW2JdW2RdO2lmKGMuX3ByZWxvYWRIYXNoW2JdW2RdPSExLGMuaGFzRXZlbnRMaXN0ZW5lcihcImZpbGVlcnJvclwiKSl7dmFyIGE9bmV3IGNyZWF0ZWpzLkV2ZW50KFwiZmlsZWVycm9yXCIpO2Euc3JjPWYuc3JjLGEuaWQ9Zi5pZCxhLmRhdGE9Zi5kYXRhLGEuc3ByaXRlPWYuc3ByaXRlLGMuZGlzcGF0Y2hFdmVudChhKX19fSxjLl9yZWdpc3RlclBsdWdpbj1mdW5jdGlvbihhKXtyZXR1cm4gYS5pc1N1cHBvcnRlZCgpPyhjLmFjdGl2ZVBsdWdpbj1uZXcgYSwhMCk6ITF9LGMucmVnaXN0ZXJQbHVnaW5zPWZ1bmN0aW9uKGEpe2MuX3BsdWdpbnNSZWdpc3RlcmVkPSEwO2Zvcih2YXIgYj0wLGQ9YS5sZW5ndGg7ZD5iO2IrKylpZihjLl9yZWdpc3RlclBsdWdpbihhW2JdKSlyZXR1cm4hMDtyZXR1cm4hMX0sYy5pbml0aWFsaXplRGVmYXVsdFBsdWdpbnM9ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbCE9Yy5hY3RpdmVQbHVnaW4/ITA6Yy5fcGx1Z2luc1JlZ2lzdGVyZWQ/ITE6Yy5yZWdpc3RlclBsdWdpbnMoW2NyZWF0ZWpzLldlYkF1ZGlvUGx1Z2luLGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbl0pPyEwOiExfSxjLmlzUmVhZHk9ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbCE9Yy5hY3RpdmVQbHVnaW59LGMuZ2V0Q2FwYWJpbGl0aWVzPWZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PWMuYWN0aXZlUGx1Z2luP251bGw6Yy5hY3RpdmVQbHVnaW4uX2NhcGFiaWxpdGllc30sYy5nZXRDYXBhYmlsaXR5PWZ1bmN0aW9uKGEpe3JldHVybiBudWxsPT1jLmFjdGl2ZVBsdWdpbj9udWxsOmMuYWN0aXZlUGx1Z2luLl9jYXBhYmlsaXRpZXNbYV19LGMuaW5pdExvYWQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGMuX3JlZ2lzdGVyU291bmQoYSl9LGMuX3JlZ2lzdGVyU291bmQ9ZnVuY3Rpb24oYSl7aWYoIWMuaW5pdGlhbGl6ZURlZmF1bHRQbHVnaW5zKCkpcmV0dXJuITE7dmFyIGQ7aWYoYS5zcmMgaW5zdGFuY2VvZiBPYmplY3Q/KGQ9Yy5fcGFyc2VTcmMoYS5zcmMpLGQuc3JjPWEucGF0aCtkLnNyYyk6ZD1jLl9wYXJzZVBhdGgoYS5zcmMpLG51bGw9PWQpcmV0dXJuITE7YS5zcmM9ZC5zcmMsYS50eXBlPVwic291bmRcIjt2YXIgZT1hLmRhdGEsZj1udWxsO2lmKG51bGwhPWUmJihpc05hTihlLmNoYW5uZWxzKT9pc05hTihlKXx8KGY9cGFyc2VJbnQoZSkpOmY9cGFyc2VJbnQoZS5jaGFubmVscyksZS5hdWRpb1Nwcml0ZSkpZm9yKHZhciBnLGg9ZS5hdWRpb1Nwcml0ZS5sZW5ndGg7aC0tOylnPWUuYXVkaW9TcHJpdGVbaF0sYy5faWRIYXNoW2cuaWRdPXtzcmM6YS5zcmMsc3RhcnRUaW1lOnBhcnNlSW50KGcuc3RhcnRUaW1lKSxkdXJhdGlvbjpwYXJzZUludChnLmR1cmF0aW9uKX0sZy5kZWZhdWx0UGxheVByb3BzJiYoYy5fZGVmYXVsdFBsYXlQcm9wc0hhc2hbZy5pZF09Y3JlYXRlanMuUGxheVByb3BzQ29uZmlnLmNyZWF0ZShnLmRlZmF1bHRQbGF5UHJvcHMpKTtudWxsIT1hLmlkJiYoYy5faWRIYXNoW2EuaWRdPXtzcmM6YS5zcmN9KTt2YXIgaT1jLmFjdGl2ZVBsdWdpbi5yZWdpc3RlcihhKTtyZXR1cm4gYi5jcmVhdGUoYS5zcmMsZiksbnVsbCE9ZSYmaXNOYU4oZSk/YS5kYXRhLmNoYW5uZWxzPWZ8fGIubWF4UGVyQ2hhbm5lbCgpOmEuZGF0YT1mfHxiLm1heFBlckNoYW5uZWwoKSxpLnR5cGUmJihhLnR5cGU9aS50eXBlKSxhLmRlZmF1bHRQbGF5UHJvcHMmJihjLl9kZWZhdWx0UGxheVByb3BzSGFzaFthLnNyY109Y3JlYXRlanMuUGxheVByb3BzQ29uZmlnLmNyZWF0ZShhLmRlZmF1bHRQbGF5UHJvcHMpKSxpfSxjLnJlZ2lzdGVyU291bmQ9ZnVuY3Rpb24oYSxiLGQsZSxmKXt2YXIgZz17c3JjOmEsaWQ6YixkYXRhOmQsZGVmYXVsdFBsYXlQcm9wczpmfTthIGluc3RhbmNlb2YgT2JqZWN0JiZhLnNyYyYmKGU9YixnPWEpLGc9Y3JlYXRlanMuTG9hZEl0ZW0uY3JlYXRlKGcpLGcucGF0aD1lLG51bGw9PWV8fGcuc3JjIGluc3RhbmNlb2YgT2JqZWN0fHwoZy5zcmM9ZSthKTt2YXIgaD1jLl9yZWdpc3RlclNvdW5kKGcpO2lmKCFoKXJldHVybiExO2lmKGMuX3ByZWxvYWRIYXNoW2cuc3JjXXx8KGMuX3ByZWxvYWRIYXNoW2cuc3JjXT1bXSksYy5fcHJlbG9hZEhhc2hbZy5zcmNdLnB1c2goZyksMT09Yy5fcHJlbG9hZEhhc2hbZy5zcmNdLmxlbmd0aCloLm9uKFwiY29tcGxldGVcIixjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVMb2FkQ29tcGxldGUsdGhpcykpLGgub24oXCJlcnJvclwiLGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUxvYWRFcnJvcix0aGlzKSksYy5hY3RpdmVQbHVnaW4ucHJlbG9hZChoKTtlbHNlIGlmKDE9PWMuX3ByZWxvYWRIYXNoW2cuc3JjXVswXSlyZXR1cm4hMDtyZXR1cm4gZ30sYy5yZWdpc3RlclNvdW5kcz1mdW5jdGlvbihhLGIpe3ZhciBjPVtdO2EucGF0aCYmKGI/Yis9YS5wYXRoOmI9YS5wYXRoLGE9YS5tYW5pZmVzdCk7Zm9yKHZhciBkPTAsZT1hLmxlbmd0aDtlPmQ7ZCsrKWNbZF09Y3JlYXRlanMuU291bmQucmVnaXN0ZXJTb3VuZChhW2RdLnNyYyxhW2RdLmlkLGFbZF0uZGF0YSxiLGFbZF0uZGVmYXVsdFBsYXlQcm9wcyk7cmV0dXJuIGN9LGMucmVtb3ZlU291bmQ9ZnVuY3Rpb24oYSxkKXtpZihudWxsPT1jLmFjdGl2ZVBsdWdpbilyZXR1cm4hMTthIGluc3RhbmNlb2YgT2JqZWN0JiZhLnNyYyYmKGE9YS5zcmMpO3ZhciBlO2lmKGEgaW5zdGFuY2VvZiBPYmplY3Q/ZT1jLl9wYXJzZVNyYyhhKTooYT1jLl9nZXRTcmNCeUlkKGEpLnNyYyxlPWMuX3BhcnNlUGF0aChhKSksbnVsbD09ZSlyZXR1cm4hMTthPWUuc3JjLG51bGwhPWQmJihhPWQrYSk7Zm9yKHZhciBmIGluIGMuX2lkSGFzaCljLl9pZEhhc2hbZl0uc3JjPT1hJiZkZWxldGUgYy5faWRIYXNoW2ZdO3JldHVybiBiLnJlbW92ZVNyYyhhKSxkZWxldGUgYy5fcHJlbG9hZEhhc2hbYV0sYy5hY3RpdmVQbHVnaW4ucmVtb3ZlU291bmQoYSksITB9LGMucmVtb3ZlU291bmRzPWZ1bmN0aW9uKGEsYil7dmFyIGM9W107YS5wYXRoJiYoYj9iKz1hLnBhdGg6Yj1hLnBhdGgsYT1hLm1hbmlmZXN0KTtmb3IodmFyIGQ9MCxlPWEubGVuZ3RoO2U+ZDtkKyspY1tkXT1jcmVhdGVqcy5Tb3VuZC5yZW1vdmVTb3VuZChhW2RdLnNyYyxiKTtyZXR1cm4gY30sYy5yZW1vdmVBbGxTb3VuZHM9ZnVuY3Rpb24oKXtjLl9pZEhhc2g9e30sYy5fcHJlbG9hZEhhc2g9e30sYi5yZW1vdmVBbGwoKSxjLmFjdGl2ZVBsdWdpbiYmYy5hY3RpdmVQbHVnaW4ucmVtb3ZlQWxsU291bmRzKCl9LGMubG9hZENvbXBsZXRlPWZ1bmN0aW9uKGEpe2lmKCFjLmlzUmVhZHkoKSlyZXR1cm4hMTt2YXIgYj1jLl9wYXJzZVBhdGgoYSk7cmV0dXJuIGE9Yj9jLl9nZXRTcmNCeUlkKGIuc3JjKS5zcmM6Yy5fZ2V0U3JjQnlJZChhKS5zcmMsdm9pZCAwPT1jLl9wcmVsb2FkSGFzaFthXT8hMToxPT1jLl9wcmVsb2FkSGFzaFthXVswXX0sYy5fcGFyc2VQYXRoPWZ1bmN0aW9uKGEpe1wic3RyaW5nXCIhPXR5cGVvZiBhJiYoYT1hLnRvU3RyaW5nKCkpO3ZhciBiPWEubWF0Y2goYy5GSUxFX1BBVFRFUk4pO2lmKG51bGw9PWIpcmV0dXJuITE7Zm9yKHZhciBkPWJbNF0sZT1iWzVdLGY9Yy5jYXBhYmlsaXRpZXMsZz0wOyFmW2VdOylpZihlPWMuYWx0ZXJuYXRlRXh0ZW5zaW9uc1tnKytdLGc+Yy5hbHRlcm5hdGVFeHRlbnNpb25zLmxlbmd0aClyZXR1cm4gbnVsbDthPWEucmVwbGFjZShcIi5cIitiWzVdLFwiLlwiK2UpO3ZhciBoPXtuYW1lOmQsc3JjOmEsZXh0ZW5zaW9uOmV9O3JldHVybiBofSxjLl9wYXJzZVNyYz1mdW5jdGlvbihhKXt2YXIgYj17bmFtZTp2b2lkIDAsc3JjOnZvaWQgMCxleHRlbnNpb246dm9pZCAwfSxkPWMuY2FwYWJpbGl0aWVzO2Zvcih2YXIgZSBpbiBhKWlmKGEuaGFzT3duUHJvcGVydHkoZSkmJmRbZV0pe2Iuc3JjPWFbZV0sYi5leHRlbnNpb249ZTticmVha31pZighYi5zcmMpcmV0dXJuITE7dmFyIGY9Yi5zcmMubGFzdEluZGV4T2YoXCIvXCIpO3JldHVybi0xIT1mP2IubmFtZT1iLnNyYy5zbGljZShmKzEpOmIubmFtZT1iLnNyYyxifSxjLnBsYXk9ZnVuY3Rpb24oYSxiLGQsZSxmLGcsaCxpLGope3ZhciBrO2s9YiBpbnN0YW5jZW9mIE9iamVjdHx8YiBpbnN0YW5jZW9mIGNyZWF0ZWpzLlBsYXlQcm9wc0NvbmZpZz9jcmVhdGVqcy5QbGF5UHJvcHNDb25maWcuY3JlYXRlKGIpOmNyZWF0ZWpzLlBsYXlQcm9wc0NvbmZpZy5jcmVhdGUoe2ludGVycnVwdDpiLGRlbGF5OmQsb2Zmc2V0OmUsbG9vcDpmLHZvbHVtZTpnLHBhbjpoLHN0YXJ0VGltZTppLGR1cmF0aW9uOmp9KTt2YXIgbD1jLmNyZWF0ZUluc3RhbmNlKGEsay5zdGFydFRpbWUsay5kdXJhdGlvbiksbT1jLl9wbGF5SW5zdGFuY2UobCxrKTtyZXR1cm4gbXx8bC5fcGxheUZhaWxlZCgpLGx9LGMuY3JlYXRlSW5zdGFuY2U9ZnVuY3Rpb24oYSxkLGUpe2lmKCFjLmluaXRpYWxpemVEZWZhdWx0UGx1Z2lucygpKXJldHVybiBuZXcgY3JlYXRlanMuRGVmYXVsdFNvdW5kSW5zdGFuY2UoYSxkLGUpO3ZhciBmPWMuX2RlZmF1bHRQbGF5UHJvcHNIYXNoW2FdO2E9Yy5fZ2V0U3JjQnlJZChhKTt2YXIgZz1jLl9wYXJzZVBhdGgoYS5zcmMpLGg9bnVsbDtyZXR1cm4gbnVsbCE9ZyYmbnVsbCE9Zy5zcmM/KGIuY3JlYXRlKGcuc3JjKSxudWxsPT1kJiYoZD1hLnN0YXJ0VGltZSksaD1jLmFjdGl2ZVBsdWdpbi5jcmVhdGUoZy5zcmMsZCxlfHxhLmR1cmF0aW9uKSxmPWZ8fGMuX2RlZmF1bHRQbGF5UHJvcHNIYXNoW2cuc3JjXSxmJiZoLmFwcGx5UGxheVByb3BzKGYpKTpoPW5ldyBjcmVhdGVqcy5EZWZhdWx0U291bmRJbnN0YW5jZShhLGQsZSksaC51bmlxdWVJZD1jLl9sYXN0SUQrKyxofSxjLnN0b3A9ZnVuY3Rpb24oKXtmb3IodmFyIGE9dGhpcy5faW5zdGFuY2VzLGI9YS5sZW5ndGg7Yi0tOylhW2JdLnN0b3AoKX0sYy5zZXRWb2x1bWU9ZnVuY3Rpb24oYSl7aWYobnVsbD09TnVtYmVyKGEpKXJldHVybiExO2lmKGE9TWF0aC5tYXgoMCxNYXRoLm1pbigxLGEpKSxjLl9tYXN0ZXJWb2x1bWU9YSwhdGhpcy5hY3RpdmVQbHVnaW58fCF0aGlzLmFjdGl2ZVBsdWdpbi5zZXRWb2x1bWV8fCF0aGlzLmFjdGl2ZVBsdWdpbi5zZXRWb2x1bWUoYSkpZm9yKHZhciBiPXRoaXMuX2luc3RhbmNlcyxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKWJbZF0uc2V0TWFzdGVyVm9sdW1lKGEpfSxjLmdldFZvbHVtZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXN0ZXJWb2x1bWV9LGMuc2V0TXV0ZT1mdW5jdGlvbihhKXtpZihudWxsPT1hKXJldHVybiExO2lmKHRoaXMuX21hc3Rlck11dGU9YSwhdGhpcy5hY3RpdmVQbHVnaW58fCF0aGlzLmFjdGl2ZVBsdWdpbi5zZXRNdXRlfHwhdGhpcy5hY3RpdmVQbHVnaW4uc2V0TXV0ZShhKSlmb3IodmFyIGI9dGhpcy5faW5zdGFuY2VzLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspYltjXS5zZXRNYXN0ZXJNdXRlKGEpO3JldHVybiEwfSxjLmdldE11dGU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbWFzdGVyTXV0ZX0sYy5zZXREZWZhdWx0UGxheVByb3BzPWZ1bmN0aW9uKGEsYil7YT1jLl9nZXRTcmNCeUlkKGEpLGMuX2RlZmF1bHRQbGF5UHJvcHNIYXNoW2MuX3BhcnNlUGF0aChhLnNyYykuc3JjXT1jcmVhdGVqcy5QbGF5UHJvcHNDb25maWcuY3JlYXRlKGIpfSxjLmdldERlZmF1bHRQbGF5UHJvcHM9ZnVuY3Rpb24oYSl7cmV0dXJuIGE9Yy5fZ2V0U3JjQnlJZChhKSxjLl9kZWZhdWx0UGxheVByb3BzSGFzaFtjLl9wYXJzZVBhdGgoYS5zcmMpLnNyY119LGMuX3BsYXlJbnN0YW5jZT1mdW5jdGlvbihhLGIpe3ZhciBkPWMuX2RlZmF1bHRQbGF5UHJvcHNIYXNoW2Euc3JjXXx8e307aWYobnVsbD09Yi5pbnRlcnJ1cHQmJihiLmludGVycnVwdD1kLmludGVycnVwdHx8Yy5kZWZhdWx0SW50ZXJydXB0QmVoYXZpb3IpLG51bGw9PWIuZGVsYXkmJihiLmRlbGF5PWQuZGVsYXl8fDApLG51bGw9PWIub2Zmc2V0JiYoYi5vZmZzZXQ9YS5nZXRQb3NpdGlvbigpKSxudWxsPT1iLmxvb3AmJihiLmxvb3A9YS5sb29wKSxudWxsPT1iLnZvbHVtZSYmKGIudm9sdW1lPWEudm9sdW1lKSxudWxsPT1iLnBhbiYmKGIucGFuPWEucGFuKSwwPT1iLmRlbGF5KXt2YXIgZT1jLl9iZWdpblBsYXlpbmcoYSxiKTtpZighZSlyZXR1cm4hMX1lbHNle3ZhciBmPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtjLl9iZWdpblBsYXlpbmcoYSxiKX0sYi5kZWxheSk7YS5kZWxheVRpbWVvdXRJZD1mfXJldHVybiB0aGlzLl9pbnN0YW5jZXMucHVzaChhKSwhMH0sYy5fYmVnaW5QbGF5aW5nPWZ1bmN0aW9uKGEsYyl7aWYoIWIuYWRkKGEsYy5pbnRlcnJ1cHQpKXJldHVybiExO3ZhciBkPWEuX2JlZ2luUGxheWluZyhjKTtpZighZCl7dmFyIGU9Y3JlYXRlanMuaW5kZXhPZih0aGlzLl9pbnN0YW5jZXMsYSk7cmV0dXJuIGU+LTEmJnRoaXMuX2luc3RhbmNlcy5zcGxpY2UoZSwxKSwhMX1yZXR1cm4hMH0sYy5fZ2V0U3JjQnlJZD1mdW5jdGlvbihhKXtyZXR1cm4gYy5faWRIYXNoW2FdfHx7c3JjOmF9fSxjLl9wbGF5RmluaXNoZWQ9ZnVuY3Rpb24oYSl7Yi5yZW1vdmUoYSk7dmFyIGM9Y3JlYXRlanMuaW5kZXhPZih0aGlzLl9pbnN0YW5jZXMsYSk7Yz4tMSYmdGhpcy5faW5zdGFuY2VzLnNwbGljZShjLDEpfSxjcmVhdGVqcy5Tb3VuZD1hLGIuY2hhbm5lbHM9e30sYi5jcmVhdGU9ZnVuY3Rpb24oYSxjKXt2YXIgZD1iLmdldChhKTtyZXR1cm4gbnVsbD09ZD8oYi5jaGFubmVsc1thXT1uZXcgYihhLGMpLCEwKTohMX0sYi5yZW1vdmVTcmM9ZnVuY3Rpb24oYSl7dmFyIGM9Yi5nZXQoYSk7cmV0dXJuIG51bGw9PWM/ITE6KGMuX3JlbW92ZUFsbCgpLGRlbGV0ZSBiLmNoYW5uZWxzW2FdLCEwKX0sYi5yZW1vdmVBbGw9ZnVuY3Rpb24oKXtmb3IodmFyIGEgaW4gYi5jaGFubmVscyliLmNoYW5uZWxzW2FdLl9yZW1vdmVBbGwoKTtiLmNoYW5uZWxzPXt9fSxiLmFkZD1mdW5jdGlvbihhLGMpe3ZhciBkPWIuZ2V0KGEuc3JjKTtyZXR1cm4gbnVsbD09ZD8hMTpkLl9hZGQoYSxjKX0sYi5yZW1vdmU9ZnVuY3Rpb24oYSl7dmFyIGM9Yi5nZXQoYS5zcmMpO3JldHVybiBudWxsPT1jPyExOihjLl9yZW1vdmUoYSksITApfSxiLm1heFBlckNoYW5uZWw9ZnVuY3Rpb24oKXtyZXR1cm4gZC5tYXhEZWZhdWx0fSxiLmdldD1mdW5jdGlvbihhKXtyZXR1cm4gYi5jaGFubmVsc1thXX07dmFyIGQ9Yi5wcm90b3R5cGU7ZC5jb25zdHJ1Y3Rvcj1iLGQuc3JjPW51bGwsZC5tYXg9bnVsbCxkLm1heERlZmF1bHQ9MTAwLGQubGVuZ3RoPTAsZC5pbml0PWZ1bmN0aW9uKGEsYil7dGhpcy5zcmM9YSx0aGlzLm1heD1ifHx0aGlzLm1heERlZmF1bHQsLTE9PXRoaXMubWF4JiYodGhpcy5tYXg9dGhpcy5tYXhEZWZhdWx0KSx0aGlzLl9pbnN0YW5jZXM9W119LGQuX2dldD1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5faW5zdGFuY2VzW2FdfSxkLl9hZGQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5fZ2V0U2xvdChiLGEpPyh0aGlzLl9pbnN0YW5jZXMucHVzaChhKSx0aGlzLmxlbmd0aCsrLCEwKTohMX0sZC5fcmVtb3ZlPWZ1bmN0aW9uKGEpe3ZhciBiPWNyZWF0ZWpzLmluZGV4T2YodGhpcy5faW5zdGFuY2VzLGEpO3JldHVybi0xPT1iPyExOih0aGlzLl9pbnN0YW5jZXMuc3BsaWNlKGIsMSksdGhpcy5sZW5ndGgtLSwhMCl9LGQuX3JlbW92ZUFsbD1mdW5jdGlvbigpe2Zvcih2YXIgYT10aGlzLmxlbmd0aC0xO2E+PTA7YS0tKXRoaXMuX2luc3RhbmNlc1thXS5zdG9wKCl9LGQuX2dldFNsb3Q9ZnVuY3Rpb24oYixjKXt2YXIgZCxlO2lmKGIhPWEuSU5URVJSVVBUX05PTkUmJihlPXRoaXMuX2dldCgwKSxudWxsPT1lKSlyZXR1cm4hMDtmb3IodmFyIGY9MCxnPXRoaXMubWF4O2c+ZjtmKyspe2lmKGQ9dGhpcy5fZ2V0KGYpLG51bGw9PWQpcmV0dXJuITA7aWYoZC5wbGF5U3RhdGU9PWEuUExBWV9GSU5JU0hFRHx8ZC5wbGF5U3RhdGU9PWEuUExBWV9JTlRFUlJVUFRFRHx8ZC5wbGF5U3RhdGU9PWEuUExBWV9GQUlMRUQpe2U9ZDticmVha31iIT1hLklOVEVSUlVQVF9OT05FJiYoYj09YS5JTlRFUlJVUFRfRUFSTFkmJmQuZ2V0UG9zaXRpb24oKTxlLmdldFBvc2l0aW9uKCl8fGI9PWEuSU5URVJSVVBUX0xBVEUmJmQuZ2V0UG9zaXRpb24oKT5lLmdldFBvc2l0aW9uKCkpJiYoZT1kKX1yZXR1cm4gbnVsbCE9ZT8oZS5faW50ZXJydXB0KCksdGhpcy5fcmVtb3ZlKGUpLCEwKTohMX0sZC50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1NvdW5kIFNvdW5kQ2hhbm5lbF1cIn19KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO3ZhciBhPWZ1bmN0aW9uKGEsYixjLGQpe3RoaXMuRXZlbnREaXNwYXRjaGVyX2NvbnN0cnVjdG9yKCksdGhpcy5zcmM9YSx0aGlzLnVuaXF1ZUlkPS0xLHRoaXMucGxheVN0YXRlPW51bGwsdGhpcy5kZWxheVRpbWVvdXRJZD1udWxsLHRoaXMuX3ZvbHVtZT0xLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLFwidm9sdW1lXCIse2dldDp0aGlzLmdldFZvbHVtZSxzZXQ6dGhpcy5zZXRWb2x1bWV9KSx0aGlzLl9wYW49MCxPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcyxcInBhblwiLHtnZXQ6dGhpcy5nZXRQYW4sc2V0OnRoaXMuc2V0UGFufSksdGhpcy5fc3RhcnRUaW1lPU1hdGgubWF4KDAsYnx8MCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsXCJzdGFydFRpbWVcIix7Z2V0OnRoaXMuZ2V0U3RhcnRUaW1lLHNldDp0aGlzLnNldFN0YXJ0VGltZX0pLHRoaXMuX2R1cmF0aW9uPU1hdGgubWF4KDAsY3x8MCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsXCJkdXJhdGlvblwiLHtnZXQ6dGhpcy5nZXREdXJhdGlvbixzZXQ6dGhpcy5zZXREdXJhdGlvbn0pLHRoaXMuX3BsYXliYWNrUmVzb3VyY2U9bnVsbCxPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcyxcInBsYXliYWNrUmVzb3VyY2VcIix7Z2V0OnRoaXMuZ2V0UGxheWJhY2tSZXNvdXJjZSxzZXQ6dGhpcy5zZXRQbGF5YmFja1Jlc291cmNlfSksZCE9PSExJiZkIT09ITAmJnRoaXMuc2V0UGxheWJhY2tSZXNvdXJjZShkKSx0aGlzLl9wb3NpdGlvbj0wLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLFwicG9zaXRpb25cIix7Z2V0OnRoaXMuZ2V0UG9zaXRpb24sc2V0OnRoaXMuc2V0UG9zaXRpb259KSx0aGlzLl9sb29wPTAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsXCJsb29wXCIse2dldDp0aGlzLmdldExvb3Asc2V0OnRoaXMuc2V0TG9vcH0pLHRoaXMuX211dGVkPSExLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLFwibXV0ZWRcIix7Z2V0OnRoaXMuZ2V0TXV0ZWQsc2V0OnRoaXMuc2V0TXV0ZWR9KSx0aGlzLl9wYXVzZWQ9ITEsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsXCJwYXVzZWRcIix7Z2V0OnRoaXMuZ2V0UGF1c2VkLHNldDp0aGlzLnNldFBhdXNlZH0pfSxiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlcik7Yi5wbGF5PWZ1bmN0aW9uKGEsYixjLGQsZSxmKXt2YXIgZztyZXR1cm4gZz1hIGluc3RhbmNlb2YgT2JqZWN0fHxhIGluc3RhbmNlb2YgY3JlYXRlanMuUGxheVByb3BzQ29uZmlnP2NyZWF0ZWpzLlBsYXlQcm9wc0NvbmZpZy5jcmVhdGUoYSk6Y3JlYXRlanMuUGxheVByb3BzQ29uZmlnLmNyZWF0ZSh7aW50ZXJydXB0OmEsZGVsYXk6YixvZmZzZXQ6Yyxsb29wOmQsdm9sdW1lOmUscGFuOmZ9KSx0aGlzLnBsYXlTdGF0ZT09Y3JlYXRlanMuU291bmQuUExBWV9TVUNDRUVERUQ/KHRoaXMuYXBwbHlQbGF5UHJvcHMoZyksdm9pZCh0aGlzLl9wYXVzZWQmJnRoaXMuc2V0UGF1c2VkKCExKSkpOih0aGlzLl9jbGVhblVwKCksY3JlYXRlanMuU291bmQuX3BsYXlJbnN0YW5jZSh0aGlzLGcpLHRoaXMpfSxiLnN0b3A9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcG9zaXRpb249MCx0aGlzLl9wYXVzZWQ9ITEsdGhpcy5faGFuZGxlU3RvcCgpLHRoaXMuX2NsZWFuVXAoKSx0aGlzLnBsYXlTdGF0ZT1jcmVhdGVqcy5Tb3VuZC5QTEFZX0ZJTklTSEVELHRoaXN9LGIuZGVzdHJveT1mdW5jdGlvbigpe3RoaXMuX2NsZWFuVXAoKSx0aGlzLnNyYz1udWxsLHRoaXMucGxheWJhY2tSZXNvdXJjZT1udWxsLHRoaXMucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnMoKX0sYi5hcHBseVBsYXlQcm9wcz1mdW5jdGlvbihhKXtyZXR1cm4gbnVsbCE9YS5vZmZzZXQmJnRoaXMuc2V0UG9zaXRpb24oYS5vZmZzZXQpLG51bGwhPWEubG9vcCYmdGhpcy5zZXRMb29wKGEubG9vcCksbnVsbCE9YS52b2x1bWUmJnRoaXMuc2V0Vm9sdW1lKGEudm9sdW1lKSxudWxsIT1hLnBhbiYmdGhpcy5zZXRQYW4oYS5wYW4pLG51bGwhPWEuc3RhcnRUaW1lJiYodGhpcy5zZXRTdGFydFRpbWUoYS5zdGFydFRpbWUpLHRoaXMuc2V0RHVyYXRpb24oYS5kdXJhdGlvbikpLHRoaXN9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltBYnN0cmFjdFNvdW5kSW5zdGFuY2VdXCJ9LGIuZ2V0UGF1c2VkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3BhdXNlZH0sYi5zZXRQYXVzZWQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGEhPT0hMCYmYSE9PSExfHx0aGlzLl9wYXVzZWQ9PWF8fDE9PWEmJnRoaXMucGxheVN0YXRlIT1jcmVhdGVqcy5Tb3VuZC5QTEFZX1NVQ0NFRURFRD92b2lkIDA6KHRoaXMuX3BhdXNlZD1hLGE/dGhpcy5fcGF1c2UoKTp0aGlzLl9yZXN1bWUoKSxjbGVhclRpbWVvdXQodGhpcy5kZWxheVRpbWVvdXRJZCksdGhpcyl9LGIuc2V0Vm9sdW1lPWZ1bmN0aW9uKGEpe3JldHVybiBhPT10aGlzLl92b2x1bWU/dGhpczoodGhpcy5fdm9sdW1lPU1hdGgubWF4KDAsTWF0aC5taW4oMSxhKSksdGhpcy5fbXV0ZWR8fHRoaXMuX3VwZGF0ZVZvbHVtZSgpLHRoaXMpfSxiLmdldFZvbHVtZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLl92b2x1bWV9LGIuc2V0TXV0ZWQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT0hMHx8YT09PSExPyh0aGlzLl9tdXRlZD1hLHRoaXMuX3VwZGF0ZVZvbHVtZSgpLHRoaXMpOnZvaWQgMH0sYi5nZXRNdXRlZD1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9tdXRlZH0sYi5zZXRQYW49ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PXRoaXMuX3Bhbj90aGlzOih0aGlzLl9wYW49TWF0aC5tYXgoLTEsTWF0aC5taW4oMSxhKSksdGhpcy5fdXBkYXRlUGFuKCksdGhpcyl9LGIuZ2V0UGFuPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3Bhbn0sYi5nZXRQb3NpdGlvbj1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9wYXVzZWR8fHRoaXMucGxheVN0YXRlIT1jcmVhdGVqcy5Tb3VuZC5QTEFZX1NVQ0NFRURFRHx8KHRoaXMuX3Bvc2l0aW9uPXRoaXMuX2NhbGN1bGF0ZUN1cnJlbnRQb3NpdGlvbigpKSx0aGlzLl9wb3NpdGlvbn0sYi5zZXRQb3NpdGlvbj1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fcG9zaXRpb249TWF0aC5tYXgoMCxhKSx0aGlzLnBsYXlTdGF0ZT09Y3JlYXRlanMuU291bmQuUExBWV9TVUNDRUVERUQmJnRoaXMuX3VwZGF0ZVBvc2l0aW9uKCksdGhpc30sYi5nZXRTdGFydFRpbWU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc3RhcnRUaW1lfSxiLnNldFN0YXJ0VGltZT1mdW5jdGlvbihhKXtyZXR1cm4gYT09dGhpcy5fc3RhcnRUaW1lP3RoaXM6KHRoaXMuX3N0YXJ0VGltZT1NYXRoLm1heCgwLGF8fDApLHRoaXMuX3VwZGF0ZVN0YXJ0VGltZSgpLHRoaXMpfSxiLmdldER1cmF0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2R1cmF0aW9ufSxiLnNldER1cmF0aW9uPWZ1bmN0aW9uKGEpe3JldHVybiBhPT10aGlzLl9kdXJhdGlvbj90aGlzOih0aGlzLl9kdXJhdGlvbj1NYXRoLm1heCgwLGF8fDApLHRoaXMuX3VwZGF0ZUR1cmF0aW9uKCksdGhpcyl9LGIuc2V0UGxheWJhY2tSZXNvdXJjZT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fcGxheWJhY2tSZXNvdXJjZT1hLDA9PXRoaXMuX2R1cmF0aW9uJiZ0aGlzLl9zZXREdXJhdGlvbkZyb21Tb3VyY2UoKSx0aGlzfSxiLmdldFBsYXliYWNrUmVzb3VyY2U9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcGxheWJhY2tSZXNvdXJjZX0sYi5nZXRMb29wPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2xvb3B9LGIuc2V0TG9vcD1mdW5jdGlvbihhKXtudWxsIT10aGlzLl9wbGF5YmFja1Jlc291cmNlJiYoMCE9dGhpcy5fbG9vcCYmMD09YT90aGlzLl9yZW1vdmVMb29waW5nKGEpOjA9PXRoaXMuX2xvb3AmJjAhPWEmJnRoaXMuX2FkZExvb3BpbmcoYSkpLHRoaXMuX2xvb3A9YX0sYi5fc2VuZEV2ZW50PWZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBjcmVhdGVqcy5FdmVudChhKTt0aGlzLmRpc3BhdGNoRXZlbnQoYil9LGIuX2NsZWFuVXA9ZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQodGhpcy5kZWxheVRpbWVvdXRJZCksdGhpcy5faGFuZGxlQ2xlYW5VcCgpLHRoaXMuX3BhdXNlZD0hMSxjcmVhdGVqcy5Tb3VuZC5fcGxheUZpbmlzaGVkKHRoaXMpfSxiLl9pbnRlcnJ1cHQ9ZnVuY3Rpb24oKXt0aGlzLl9jbGVhblVwKCksdGhpcy5wbGF5U3RhdGU9Y3JlYXRlanMuU291bmQuUExBWV9JTlRFUlJVUFRFRCx0aGlzLl9zZW5kRXZlbnQoXCJpbnRlcnJ1cHRlZFwiKX0sYi5fYmVnaW5QbGF5aW5nPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnNldFBvc2l0aW9uKGEub2Zmc2V0KSx0aGlzLnNldExvb3AoYS5sb29wKSx0aGlzLnNldFZvbHVtZShhLnZvbHVtZSksdGhpcy5zZXRQYW4oYS5wYW4pLG51bGwhPWEuc3RhcnRUaW1lJiYodGhpcy5zZXRTdGFydFRpbWUoYS5zdGFydFRpbWUpLHRoaXMuc2V0RHVyYXRpb24oYS5kdXJhdGlvbikpLG51bGwhPXRoaXMuX3BsYXliYWNrUmVzb3VyY2UmJnRoaXMuX3Bvc2l0aW9uPHRoaXMuX2R1cmF0aW9uPyh0aGlzLl9wYXVzZWQ9ITEsdGhpcy5faGFuZGxlU291bmRSZWFkeSgpLHRoaXMucGxheVN0YXRlPWNyZWF0ZWpzLlNvdW5kLlBMQVlfU1VDQ0VFREVELHRoaXMuX3NlbmRFdmVudChcInN1Y2NlZWRlZFwiKSwhMCk6KHRoaXMuX3BsYXlGYWlsZWQoKSwhMSl9LGIuX3BsYXlGYWlsZWQ9ZnVuY3Rpb24oKXt0aGlzLl9jbGVhblVwKCksdGhpcy5wbGF5U3RhdGU9Y3JlYXRlanMuU291bmQuUExBWV9GQUlMRUQsdGhpcy5fc2VuZEV2ZW50KFwiZmFpbGVkXCIpfSxiLl9oYW5kbGVTb3VuZENvbXBsZXRlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9wb3NpdGlvbj0wLDAhPXRoaXMuX2xvb3A/KHRoaXMuX2xvb3AtLSx0aGlzLl9oYW5kbGVMb29wKCksdm9pZCB0aGlzLl9zZW5kRXZlbnQoXCJsb29wXCIpKToodGhpcy5fY2xlYW5VcCgpLHRoaXMucGxheVN0YXRlPWNyZWF0ZWpzLlNvdW5kLlBMQVlfRklOSVNIRUQsdm9pZCB0aGlzLl9zZW5kRXZlbnQoXCJjb21wbGV0ZVwiKSl9LGIuX2hhbmRsZVNvdW5kUmVhZHk9ZnVuY3Rpb24oKXt9LGIuX3VwZGF0ZVZvbHVtZT1mdW5jdGlvbigpe30sYi5fdXBkYXRlUGFuPWZ1bmN0aW9uKCl7fSxiLl91cGRhdGVTdGFydFRpbWU9ZnVuY3Rpb24oKXt9LGIuX3VwZGF0ZUR1cmF0aW9uPWZ1bmN0aW9uKCl7fSxiLl9zZXREdXJhdGlvbkZyb21Tb3VyY2U9ZnVuY3Rpb24oKXt9LGIuX2NhbGN1bGF0ZUN1cnJlbnRQb3NpdGlvbj1mdW5jdGlvbigpe30sYi5fdXBkYXRlUG9zaXRpb249ZnVuY3Rpb24oKXt9LGIuX3JlbW92ZUxvb3Bpbmc9ZnVuY3Rpb24oYSl7fSxiLl9hZGRMb29waW5nPWZ1bmN0aW9uKGEpe30sYi5fcGF1c2U9ZnVuY3Rpb24oKXt9LGIuX3Jlc3VtZT1mdW5jdGlvbigpe30sYi5faGFuZGxlU3RvcD1mdW5jdGlvbigpe30sYi5faGFuZGxlQ2xlYW5VcD1mdW5jdGlvbigpe30sYi5faGFuZGxlTG9vcD1mdW5jdGlvbigpe30sY3JlYXRlanMuQWJzdHJhY3RTb3VuZEluc3RhbmNlPWNyZWF0ZWpzLnByb21vdGUoYSxcIkV2ZW50RGlzcGF0Y2hlclwiKSxjcmVhdGVqcy5EZWZhdWx0U291bmRJbnN0YW5jZT1jcmVhdGVqcy5BYnN0cmFjdFNvdW5kSW5zdGFuY2V9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO3ZhciBhPWZ1bmN0aW9uKCl7dGhpcy5fY2FwYWJpbGl0aWVzPW51bGwsdGhpcy5fbG9hZGVycz17fSx0aGlzLl9hdWRpb1NvdXJjZXM9e30sdGhpcy5fc291bmRJbnN0YW5jZXM9e30sdGhpcy5fdm9sdW1lPTEsdGhpcy5fbG9hZGVyQ2xhc3MsdGhpcy5fc291bmRJbnN0YW5jZUNsYXNzfSxiPWEucHJvdG90eXBlO2EuX2NhcGFiaWxpdGllcz1udWxsLGEuaXNTdXBwb3J0ZWQ9ZnVuY3Rpb24oKXtyZXR1cm4hMH0sYi5yZWdpc3Rlcj1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9sb2FkZXJzW2Euc3JjXTtyZXR1cm4gYiYmIWIuY2FuY2VsZWQ/dGhpcy5fbG9hZGVyc1thLnNyY106KHRoaXMuX2F1ZGlvU291cmNlc1thLnNyY109ITAsdGhpcy5fc291bmRJbnN0YW5jZXNbYS5zcmNdPVtdLGI9bmV3IHRoaXMuX2xvYWRlckNsYXNzKGEpLGIub24oXCJjb21wbGV0ZVwiLHRoaXMuX2hhbmRsZVByZWxvYWRDb21wbGV0ZSx0aGlzKSx0aGlzLl9sb2FkZXJzW2Euc3JjXT1iLGIpfSxiLnByZWxvYWQ9ZnVuY3Rpb24oYSl7YS5vbihcImVycm9yXCIsdGhpcy5faGFuZGxlUHJlbG9hZEVycm9yLHRoaXMpLGEubG9hZCgpfSxiLmlzUHJlbG9hZFN0YXJ0ZWQ9ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGwhPXRoaXMuX2F1ZGlvU291cmNlc1thXX0sYi5pc1ByZWxvYWRDb21wbGV0ZT1mdW5jdGlvbihhKXtyZXR1cm4hKG51bGw9PXRoaXMuX2F1ZGlvU291cmNlc1thXXx8MT09dGhpcy5fYXVkaW9Tb3VyY2VzW2FdKX0sYi5yZW1vdmVTb3VuZD1mdW5jdGlvbihhKXtpZih0aGlzLl9zb3VuZEluc3RhbmNlc1thXSl7Zm9yKHZhciBiPXRoaXMuX3NvdW5kSW5zdGFuY2VzW2FdLmxlbmd0aDtiLS07KXt2YXIgYz10aGlzLl9zb3VuZEluc3RhbmNlc1thXVtiXTtjLmRlc3Ryb3koKX1kZWxldGUgdGhpcy5fc291bmRJbnN0YW5jZXNbYV0sZGVsZXRlIHRoaXMuX2F1ZGlvU291cmNlc1thXSx0aGlzLl9sb2FkZXJzW2FdJiZ0aGlzLl9sb2FkZXJzW2FdLmRlc3Ryb3koKSxkZWxldGUgdGhpcy5fbG9hZGVyc1thXX19LGIucmVtb3ZlQWxsU291bmRzPWZ1bmN0aW9uKCl7Zm9yKHZhciBhIGluIHRoaXMuX2F1ZGlvU291cmNlcyl0aGlzLnJlbW92ZVNvdW5kKGEpfSxiLmNyZWF0ZT1mdW5jdGlvbihhLGIsYyl7dGhpcy5pc1ByZWxvYWRTdGFydGVkKGEpfHx0aGlzLnByZWxvYWQodGhpcy5yZWdpc3RlcihhKSk7dmFyIGQ9bmV3IHRoaXMuX3NvdW5kSW5zdGFuY2VDbGFzcyhhLGIsYyx0aGlzLl9hdWRpb1NvdXJjZXNbYV0pO3JldHVybiB0aGlzLl9zb3VuZEluc3RhbmNlc1thXS5wdXNoKGQpLGR9LGIuc2V0Vm9sdW1lPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl92b2x1bWU9YSx0aGlzLl91cGRhdGVWb2x1bWUoKSwhMH0sYi5nZXRWb2x1bWU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fdm9sdW1lfSxiLnNldE11dGU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3VwZGF0ZVZvbHVtZSgpLCEwfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbQWJzdHJhY3RQbHVnaW5dXCJ9LGIuX2hhbmRsZVByZWxvYWRDb21wbGV0ZT1mdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldC5nZXRJdGVtKCkuc3JjO3RoaXMuX2F1ZGlvU291cmNlc1tiXT1hLnJlc3VsdDtmb3IodmFyIGM9MCxkPXRoaXMuX3NvdW5kSW5zdGFuY2VzW2JdLmxlbmd0aDtkPmM7YysrKXt2YXIgZT10aGlzLl9zb3VuZEluc3RhbmNlc1tiXVtjXTtlLnNldFBsYXliYWNrUmVzb3VyY2UodGhpcy5fYXVkaW9Tb3VyY2VzW2JdKTtcbn19LGIuX2hhbmRsZVByZWxvYWRFcnJvcj1mdW5jdGlvbihhKXt9LGIuX3VwZGF0ZVZvbHVtZT1mdW5jdGlvbigpe30sY3JlYXRlanMuQWJzdHJhY3RQbHVnaW49YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhKXt0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsITAsY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU09VTkQpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKTthLmNvbnRleHQ9bnVsbCxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbV2ViQXVkaW9Mb2FkZXJdXCJ9LGIuX2NyZWF0ZVJlcXVlc3Q9ZnVuY3Rpb24oKXt0aGlzLl9yZXF1ZXN0PW5ldyBjcmVhdGVqcy5YSFJSZXF1ZXN0KHRoaXMuX2l0ZW0sITEpLHRoaXMuX3JlcXVlc3Quc2V0UmVzcG9uc2VUeXBlKFwiYXJyYXlidWZmZXJcIil9LGIuX3NlbmRDb21wbGV0ZT1mdW5jdGlvbihiKXthLmNvbnRleHQuZGVjb2RlQXVkaW9EYXRhKHRoaXMuX3Jhd1Jlc3VsdCxjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVBdWRpb0RlY29kZWQsdGhpcyksY3JlYXRlanMucHJveHkodGhpcy5fc2VuZEVycm9yLHRoaXMpKX0sYi5faGFuZGxlQXVkaW9EZWNvZGVkPWZ1bmN0aW9uKGEpe3RoaXMuX3Jlc3VsdD1hLHRoaXMuQWJzdHJhY3RMb2FkZXJfX3NlbmRDb21wbGV0ZSgpfSxjcmVhdGVqcy5XZWJBdWRpb0xvYWRlcj1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdExvYWRlclwiKX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYShhLGIsZCxlKXt0aGlzLkFic3RyYWN0U291bmRJbnN0YW5jZV9jb25zdHJ1Y3RvcihhLGIsZCxlKSx0aGlzLmdhaW5Ob2RlPWMuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5wYW5Ob2RlPWMuY29udGV4dC5jcmVhdGVQYW5uZXIoKSx0aGlzLnBhbk5vZGUucGFubmluZ01vZGVsPWMuX3Bhbm5pbmdNb2RlbCx0aGlzLnBhbk5vZGUuY29ubmVjdCh0aGlzLmdhaW5Ob2RlKSx0aGlzLl91cGRhdGVQYW4oKSx0aGlzLnNvdXJjZU5vZGU9bnVsbCx0aGlzLl9zb3VuZENvbXBsZXRlVGltZW91dD1udWxsLHRoaXMuX3NvdXJjZU5vZGVOZXh0PW51bGwsdGhpcy5fcGxheWJhY2tTdGFydFRpbWU9MCx0aGlzLl9lbmRlZEhhbmRsZXI9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlU291bmRDb21wbGV0ZSx0aGlzKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdFNvdW5kSW5zdGFuY2UpLGM9YTtjLmNvbnRleHQ9bnVsbCxjLl9zY3JhdGNoQnVmZmVyPW51bGwsYy5kZXN0aW5hdGlvbk5vZGU9bnVsbCxjLl9wYW5uaW5nTW9kZWw9XCJlcXVhbHBvd2VyXCIsYi5kZXN0cm95PWZ1bmN0aW9uKCl7dGhpcy5BYnN0cmFjdFNvdW5kSW5zdGFuY2VfZGVzdHJveSgpLHRoaXMucGFuTm9kZS5kaXNjb25uZWN0KDApLHRoaXMucGFuTm9kZT1udWxsLHRoaXMuZ2Fpbk5vZGUuZGlzY29ubmVjdCgwKSx0aGlzLmdhaW5Ob2RlPW51bGx9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltXZWJBdWRpb1NvdW5kSW5zdGFuY2VdXCJ9LGIuX3VwZGF0ZVBhbj1mdW5jdGlvbigpe3RoaXMucGFuTm9kZS5zZXRQb3NpdGlvbih0aGlzLl9wYW4sMCwtLjUpfSxiLl9yZW1vdmVMb29waW5nPWZ1bmN0aW9uKGEpe3RoaXMuX3NvdXJjZU5vZGVOZXh0PXRoaXMuX2NsZWFuVXBBdWRpb05vZGUodGhpcy5fc291cmNlTm9kZU5leHQpfSxiLl9hZGRMb29waW5nPWZ1bmN0aW9uKGEpe3RoaXMucGxheVN0YXRlPT1jcmVhdGVqcy5Tb3VuZC5QTEFZX1NVQ0NFRURFRCYmKHRoaXMuX3NvdXJjZU5vZGVOZXh0PXRoaXMuX2NyZWF0ZUFuZFBsYXlBdWRpb05vZGUodGhpcy5fcGxheWJhY2tTdGFydFRpbWUsMCkpfSxiLl9zZXREdXJhdGlvbkZyb21Tb3VyY2U9ZnVuY3Rpb24oKXt0aGlzLl9kdXJhdGlvbj0xZTMqdGhpcy5wbGF5YmFja1Jlc291cmNlLmR1cmF0aW9ufSxiLl9oYW5kbGVDbGVhblVwPWZ1bmN0aW9uKCl7dGhpcy5zb3VyY2VOb2RlJiZ0aGlzLnBsYXlTdGF0ZT09Y3JlYXRlanMuU291bmQuUExBWV9TVUNDRUVERUQmJih0aGlzLnNvdXJjZU5vZGU9dGhpcy5fY2xlYW5VcEF1ZGlvTm9kZSh0aGlzLnNvdXJjZU5vZGUpLHRoaXMuX3NvdXJjZU5vZGVOZXh0PXRoaXMuX2NsZWFuVXBBdWRpb05vZGUodGhpcy5fc291cmNlTm9kZU5leHQpKSwwIT10aGlzLmdhaW5Ob2RlLm51bWJlck9mT3V0cHV0cyYmdGhpcy5nYWluTm9kZS5kaXNjb25uZWN0KDApLGNsZWFyVGltZW91dCh0aGlzLl9zb3VuZENvbXBsZXRlVGltZW91dCksdGhpcy5fcGxheWJhY2tTdGFydFRpbWU9MH0sYi5fY2xlYW5VcEF1ZGlvTm9kZT1mdW5jdGlvbihhKXtpZihhKXthLnN0b3AoMCksYS5kaXNjb25uZWN0KDApO3RyeXthLmJ1ZmZlcj1jLl9zY3JhdGNoQnVmZmVyfWNhdGNoKGIpe31hPW51bGx9cmV0dXJuIGF9LGIuX2hhbmRsZVNvdW5kUmVhZHk9ZnVuY3Rpb24oYSl7dGhpcy5nYWluTm9kZS5jb25uZWN0KGMuZGVzdGluYXRpb25Ob2RlKTt2YXIgYj0uMDAxKnRoaXMuX2R1cmF0aW9uLGQ9LjAwMSp0aGlzLl9wb3NpdGlvbjtkPmImJihkPWIpLHRoaXMuc291cmNlTm9kZT10aGlzLl9jcmVhdGVBbmRQbGF5QXVkaW9Ob2RlKGMuY29udGV4dC5jdXJyZW50VGltZS1iLGQpLHRoaXMuX3BsYXliYWNrU3RhcnRUaW1lPXRoaXMuc291cmNlTm9kZS5zdGFydFRpbWUtZCx0aGlzLl9zb3VuZENvbXBsZXRlVGltZW91dD1zZXRUaW1lb3V0KHRoaXMuX2VuZGVkSGFuZGxlciwxZTMqKGItZCkpLDAhPXRoaXMuX2xvb3AmJih0aGlzLl9zb3VyY2VOb2RlTmV4dD10aGlzLl9jcmVhdGVBbmRQbGF5QXVkaW9Ob2RlKHRoaXMuX3BsYXliYWNrU3RhcnRUaW1lLDApKX0sYi5fY3JlYXRlQW5kUGxheUF1ZGlvTm9kZT1mdW5jdGlvbihhLGIpe3ZhciBkPWMuY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtkLmJ1ZmZlcj10aGlzLnBsYXliYWNrUmVzb3VyY2UsZC5jb25uZWN0KHRoaXMucGFuTm9kZSk7dmFyIGU9LjAwMSp0aGlzLl9kdXJhdGlvbjtyZXR1cm4gZC5zdGFydFRpbWU9YStlLGQuc3RhcnQoZC5zdGFydFRpbWUsYisuMDAxKnRoaXMuX3N0YXJ0VGltZSxlLWIpLGR9LGIuX3BhdXNlPWZ1bmN0aW9uKCl7dGhpcy5fcG9zaXRpb249MWUzKihjLmNvbnRleHQuY3VycmVudFRpbWUtdGhpcy5fcGxheWJhY2tTdGFydFRpbWUpLHRoaXMuc291cmNlTm9kZT10aGlzLl9jbGVhblVwQXVkaW9Ob2RlKHRoaXMuc291cmNlTm9kZSksdGhpcy5fc291cmNlTm9kZU5leHQ9dGhpcy5fY2xlYW5VcEF1ZGlvTm9kZSh0aGlzLl9zb3VyY2VOb2RlTmV4dCksMCE9dGhpcy5nYWluTm9kZS5udW1iZXJPZk91dHB1dHMmJnRoaXMuZ2Fpbk5vZGUuZGlzY29ubmVjdCgwKSxjbGVhclRpbWVvdXQodGhpcy5fc291bmRDb21wbGV0ZVRpbWVvdXQpfSxiLl9yZXN1bWU9ZnVuY3Rpb24oKXt0aGlzLl9oYW5kbGVTb3VuZFJlYWR5KCl9LGIuX3VwZGF0ZVZvbHVtZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMuX211dGVkPzA6dGhpcy5fdm9sdW1lO2EhPXRoaXMuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSYmKHRoaXMuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZT1hKX0sYi5fY2FsY3VsYXRlQ3VycmVudFBvc2l0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIDFlMyooYy5jb250ZXh0LmN1cnJlbnRUaW1lLXRoaXMuX3BsYXliYWNrU3RhcnRUaW1lKX0sYi5fdXBkYXRlUG9zaXRpb249ZnVuY3Rpb24oKXt0aGlzLnNvdXJjZU5vZGU9dGhpcy5fY2xlYW5VcEF1ZGlvTm9kZSh0aGlzLnNvdXJjZU5vZGUpLHRoaXMuX3NvdXJjZU5vZGVOZXh0PXRoaXMuX2NsZWFuVXBBdWRpb05vZGUodGhpcy5fc291cmNlTm9kZU5leHQpLGNsZWFyVGltZW91dCh0aGlzLl9zb3VuZENvbXBsZXRlVGltZW91dCksdGhpcy5fcGF1c2VkfHx0aGlzLl9oYW5kbGVTb3VuZFJlYWR5KCl9LGIuX2hhbmRsZUxvb3A9ZnVuY3Rpb24oKXt0aGlzLl9jbGVhblVwQXVkaW9Ob2RlKHRoaXMuc291cmNlTm9kZSksdGhpcy5zb3VyY2VOb2RlPXRoaXMuX3NvdXJjZU5vZGVOZXh0LHRoaXMuX3BsYXliYWNrU3RhcnRUaW1lPXRoaXMuc291cmNlTm9kZS5zdGFydFRpbWUsdGhpcy5fc291cmNlTm9kZU5leHQ9dGhpcy5fY3JlYXRlQW5kUGxheUF1ZGlvTm9kZSh0aGlzLl9wbGF5YmFja1N0YXJ0VGltZSwwKSx0aGlzLl9zb3VuZENvbXBsZXRlVGltZW91dD1zZXRUaW1lb3V0KHRoaXMuX2VuZGVkSGFuZGxlcix0aGlzLl9kdXJhdGlvbil9LGIuX3VwZGF0ZUR1cmF0aW9uPWZ1bmN0aW9uKCl7dGhpcy5wbGF5U3RhdGU9PWNyZWF0ZWpzLlNvdW5kLlBMQVlfU1VDQ0VFREVEJiYodGhpcy5fcGF1c2UoKSx0aGlzLl9yZXN1bWUoKSl9LGNyZWF0ZWpzLldlYkF1ZGlvU291bmRJbnN0YW5jZT1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdFNvdW5kSW5zdGFuY2VcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aGlzLkFic3RyYWN0UGx1Z2luX2NvbnN0cnVjdG9yKCksdGhpcy5fcGFubmluZ01vZGVsPWMuX3Bhbm5pbmdNb2RlbCx0aGlzLmNvbnRleHQ9Yy5jb250ZXh0LHRoaXMuZHluYW1pY3NDb21wcmVzc29yTm9kZT10aGlzLmNvbnRleHQuY3JlYXRlRHluYW1pY3NDb21wcmVzc29yKCksdGhpcy5keW5hbWljc0NvbXByZXNzb3JOb2RlLmNvbm5lY3QodGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uKSx0aGlzLmdhaW5Ob2RlPXRoaXMuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5nYWluTm9kZS5jb25uZWN0KHRoaXMuZHluYW1pY3NDb21wcmVzc29yTm9kZSksY3JlYXRlanMuV2ViQXVkaW9Tb3VuZEluc3RhbmNlLmRlc3RpbmF0aW9uTm9kZT10aGlzLmdhaW5Ob2RlLHRoaXMuX2NhcGFiaWxpdGllcz1jLl9jYXBhYmlsaXRpZXMsdGhpcy5fbG9hZGVyQ2xhc3M9Y3JlYXRlanMuV2ViQXVkaW9Mb2FkZXIsdGhpcy5fc291bmRJbnN0YW5jZUNsYXNzPWNyZWF0ZWpzLldlYkF1ZGlvU291bmRJbnN0YW5jZSx0aGlzLl9hZGRQcm9wc1RvQ2xhc3NlcygpfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0UGx1Z2luKSxjPWE7Yy5fY2FwYWJpbGl0aWVzPW51bGwsYy5fcGFubmluZ01vZGVsPVwiZXF1YWxwb3dlclwiLGMuY29udGV4dD1udWxsLGMuX3NjcmF0Y2hCdWZmZXI9bnVsbCxjLl91bmxvY2tlZD0hMSxjLmlzU3VwcG9ydGVkPWZ1bmN0aW9uKCl7dmFyIGE9Y3JlYXRlanMuQnJvd3NlckRldGVjdC5pc0lPU3x8Y3JlYXRlanMuQnJvd3NlckRldGVjdC5pc0FuZHJvaWR8fGNyZWF0ZWpzLkJyb3dzZXJEZXRlY3QuaXNCbGFja2JlcnJ5O3JldHVyblwiZmlsZTpcIiE9bG9jYXRpb24ucHJvdG9jb2x8fGF8fHRoaXMuX2lzRmlsZVhIUlN1cHBvcnRlZCgpPyhjLl9nZW5lcmF0ZUNhcGFiaWxpdGllcygpLG51bGw9PWMuY29udGV4dD8hMTohMCk6ITF9LGMucGxheUVtcHR5U291bmQ9ZnVuY3Rpb24oKXtpZihudWxsIT1jLmNvbnRleHQpe3ZhciBhPWMuY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTthLmJ1ZmZlcj1jLl9zY3JhdGNoQnVmZmVyLGEuY29ubmVjdChjLmNvbnRleHQuZGVzdGluYXRpb24pLGEuc3RhcnQoMCwwLDApfX0sYy5faXNGaWxlWEhSU3VwcG9ydGVkPWZ1bmN0aW9uKCl7dmFyIGE9ITAsYj1uZXcgWE1MSHR0cFJlcXVlc3Q7dHJ5e2Iub3BlbihcIkdFVFwiLFwiV2ViQXVkaW9QbHVnaW5UZXN0LmZhaWxcIiwhMSl9Y2F0Y2goYyl7cmV0dXJuIGE9ITF9Yi5vbmVycm9yPWZ1bmN0aW9uKCl7YT0hMX0sYi5vbmxvYWQ9ZnVuY3Rpb24oKXthPTQwND09dGhpcy5zdGF0dXN8fDIwMD09dGhpcy5zdGF0dXN8fDA9PXRoaXMuc3RhdHVzJiZcIlwiIT10aGlzLnJlc3BvbnNlfTt0cnl7Yi5zZW5kKCl9Y2F0Y2goYyl7YT0hMX1yZXR1cm4gYX0sYy5fZ2VuZXJhdGVDYXBhYmlsaXRpZXM9ZnVuY3Rpb24oKXtpZihudWxsPT1jLl9jYXBhYmlsaXRpZXMpe3ZhciBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhdWRpb1wiKTtpZihudWxsPT1hLmNhblBsYXlUeXBlKXJldHVybiBudWxsO2lmKG51bGw9PWMuY29udGV4dClpZih3aW5kb3cuQXVkaW9Db250ZXh0KWMuY29udGV4dD1uZXcgQXVkaW9Db250ZXh0O2Vsc2V7aWYoIXdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQpcmV0dXJuIG51bGw7Yy5jb250ZXh0PW5ldyB3ZWJraXRBdWRpb0NvbnRleHR9bnVsbD09Yy5fc2NyYXRjaEJ1ZmZlciYmKGMuX3NjcmF0Y2hCdWZmZXI9Yy5jb250ZXh0LmNyZWF0ZUJ1ZmZlcigxLDEsMjIwNTApKSxjLl9jb21wYXRpYmlsaXR5U2V0VXAoKSxcIm9udG91Y2hzdGFydFwiaW4gd2luZG93JiZcInJ1bm5pbmdcIiE9Yy5jb250ZXh0LnN0YXRlJiYoYy5fdW5sb2NrKCksZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLGMuX3VubG9jaywhMCksZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsYy5fdW5sb2NrLCEwKSksYy5fY2FwYWJpbGl0aWVzPXtwYW5uaW5nOiEwLHZvbHVtZTohMCx0cmFja3M6LTF9O2Zvcih2YXIgYj1jcmVhdGVqcy5Tb3VuZC5TVVBQT1JURURfRVhURU5TSU9OUyxkPWNyZWF0ZWpzLlNvdW5kLkVYVEVOU0lPTl9NQVAsZT0wLGY9Yi5sZW5ndGg7Zj5lO2UrKyl7dmFyIGc9YltlXSxoPWRbZ118fGc7Yy5fY2FwYWJpbGl0aWVzW2ddPVwibm9cIiE9YS5jYW5QbGF5VHlwZShcImF1ZGlvL1wiK2cpJiZcIlwiIT1hLmNhblBsYXlUeXBlKFwiYXVkaW8vXCIrZyl8fFwibm9cIiE9YS5jYW5QbGF5VHlwZShcImF1ZGlvL1wiK2gpJiZcIlwiIT1hLmNhblBsYXlUeXBlKFwiYXVkaW8vXCIraCl9Yy5jb250ZXh0LmRlc3RpbmF0aW9uLm51bWJlck9mQ2hhbm5lbHM8MiYmKGMuX2NhcGFiaWxpdGllcy5wYW5uaW5nPSExKX19LGMuX2NvbXBhdGliaWxpdHlTZXRVcD1mdW5jdGlvbigpe2lmKGMuX3Bhbm5pbmdNb2RlbD1cImVxdWFscG93ZXJcIiwhYy5jb250ZXh0LmNyZWF0ZUdhaW4pe2MuY29udGV4dC5jcmVhdGVHYWluPWMuY29udGV4dC5jcmVhdGVHYWluTm9kZTt2YXIgYT1jLmNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7YS5fX3Byb3RvX18uc3RhcnQ9YS5fX3Byb3RvX18ubm90ZUdyYWluT24sYS5fX3Byb3RvX18uc3RvcD1hLl9fcHJvdG9fXy5ub3RlT2ZmLGMuX3Bhbm5pbmdNb2RlbD0wfX0sYy5fdW5sb2NrPWZ1bmN0aW9uKCl7Yy5fdW5sb2NrZWR8fChjLnBsYXlFbXB0eVNvdW5kKCksXCJydW5uaW5nXCI9PWMuY29udGV4dC5zdGF0ZSYmKGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIixjLl91bmxvY2ssITApLGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLGMuX3VubG9jaywhMCksYy5fdW5sb2NrZWQ9ITApKX0sYi50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblwiW1dlYkF1ZGlvUGx1Z2luXVwifSxiLl9hZGRQcm9wc1RvQ2xhc3Nlcz1mdW5jdGlvbigpe3ZhciBhPXRoaXMuX3NvdW5kSW5zdGFuY2VDbGFzczthLmNvbnRleHQ9dGhpcy5jb250ZXh0LGEuX3NjcmF0Y2hCdWZmZXI9Yy5fc2NyYXRjaEJ1ZmZlcixhLmRlc3RpbmF0aW9uTm9kZT10aGlzLmdhaW5Ob2RlLGEuX3Bhbm5pbmdNb2RlbD10aGlzLl9wYW5uaW5nTW9kZWwsdGhpcy5fbG9hZGVyQ2xhc3MuY29udGV4dD10aGlzLmNvbnRleHR9LGIuX3VwZGF0ZVZvbHVtZT1mdW5jdGlvbigpe3ZhciBhPWNyZWF0ZWpzLlNvdW5kLl9tYXN0ZXJNdXRlPzA6dGhpcy5fdm9sdW1lO2EhPXRoaXMuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSYmKHRoaXMuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZT1hKX0sY3JlYXRlanMuV2ViQXVkaW9QbHVnaW49Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RQbHVnaW5cIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aHJvd1wiSFRNTEF1ZGlvVGFnUG9vbCBjYW5ub3QgYmUgaW5zdGFudGlhdGVkXCJ9ZnVuY3Rpb24gYihhKXt0aGlzLl90YWdzPVtdfXZhciBjPWE7Yy5fdGFncz17fSxjLl90YWdQb29sPW5ldyBiLGMuX3RhZ1VzZWQ9e30sYy5nZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9Yy5fdGFnc1thXTtyZXR1cm4gbnVsbD09Yj8oYj1jLl90YWdzW2FdPWMuX3RhZ1Bvb2wuZ2V0KCksYi5zcmM9YSk6Yy5fdGFnVXNlZFthXT8oYj1jLl90YWdQb29sLmdldCgpLGIuc3JjPWEpOmMuX3RhZ1VzZWRbYV09ITAsYn0sYy5zZXQ9ZnVuY3Rpb24oYSxiKXtiPT1jLl90YWdzW2FdP2MuX3RhZ1VzZWRbYV09ITE6Yy5fdGFnUG9vbC5zZXQoYil9LGMucmVtb3ZlPWZ1bmN0aW9uKGEpe3ZhciBiPWMuX3RhZ3NbYV07cmV0dXJuIG51bGw9PWI/ITE6KGMuX3RhZ1Bvb2wuc2V0KGIpLGRlbGV0ZSBjLl90YWdzW2FdLGRlbGV0ZSBjLl90YWdVc2VkW2FdLCEwKX0sYy5nZXREdXJhdGlvbj1mdW5jdGlvbihhKXt2YXIgYj1jLl90YWdzW2FdO3JldHVybiBudWxsIT1iJiZiLmR1cmF0aW9uPzFlMypiLmR1cmF0aW9uOjB9LGNyZWF0ZWpzLkhUTUxBdWRpb1RhZ1Bvb2w9YTt2YXIgZD1iLnByb3RvdHlwZTtkLmNvbnN0cnVjdG9yPWIsZC5nZXQ9ZnVuY3Rpb24oKXt2YXIgYTtyZXR1cm4gYT0wPT10aGlzLl90YWdzLmxlbmd0aD90aGlzLl9jcmVhdGVUYWcoKTp0aGlzLl90YWdzLnBvcCgpLG51bGw9PWEucGFyZW50Tm9kZSYmZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKSxhfSxkLnNldD1mdW5jdGlvbihhKXt2YXIgYj1jcmVhdGVqcy5pbmRleE9mKHRoaXMuX3RhZ3MsYSk7LTE9PWImJih0aGlzLl90YWdzLnNyYz1udWxsLHRoaXMuX3RhZ3MucHVzaChhKSl9LGQudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltUYWdQb29sXVwifSxkLl9jcmVhdGVUYWc9ZnVuY3Rpb24oKXt2YXIgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYXVkaW9cIik7cmV0dXJuIGEuYXV0b3BsYXk9ITEsYS5wcmVsb2FkPVwibm9uZVwiLGF9fSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjLGQpe3RoaXMuQWJzdHJhY3RTb3VuZEluc3RhbmNlX2NvbnN0cnVjdG9yKGEsYixjLGQpLHRoaXMuX2F1ZGlvU3ByaXRlU3RvcFRpbWU9bnVsbCx0aGlzLl9kZWxheVRpbWVvdXRJZD1udWxsLHRoaXMuX2VuZGVkSGFuZGxlcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVTb3VuZENvbXBsZXRlLHRoaXMpLHRoaXMuX3JlYWR5SGFuZGxlcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUYWdSZWFkeSx0aGlzKSx0aGlzLl9zdGFsbGVkSGFuZGxlcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9wbGF5RmFpbGVkLHRoaXMpLHRoaXMuX2F1ZGlvU3ByaXRlRW5kSGFuZGxlcj1jcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVBdWRpb1Nwcml0ZUxvb3AsdGhpcyksdGhpcy5fbG9vcEhhbmRsZXI9Y3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlU291bmRDb21wbGV0ZSx0aGlzKSxjP3RoaXMuX2F1ZGlvU3ByaXRlU3RvcFRpbWU9LjAwMSooYitjKTp0aGlzLl9kdXJhdGlvbj1jcmVhdGVqcy5IVE1MQXVkaW9UYWdQb29sLmdldER1cmF0aW9uKHRoaXMuc3JjKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5BYnN0cmFjdFNvdW5kSW5zdGFuY2UpO2Iuc2V0TWFzdGVyVm9sdW1lPWZ1bmN0aW9uKGEpe3RoaXMuX3VwZGF0ZVZvbHVtZSgpfSxiLnNldE1hc3Rlck11dGU9ZnVuY3Rpb24oYSl7dGhpcy5fdXBkYXRlVm9sdW1lKCl9LGIudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm5cIltIVE1MQXVkaW9Tb3VuZEluc3RhbmNlXVwifSxiLl9yZW1vdmVMb29waW5nPWZ1bmN0aW9uKCl7bnVsbCE9dGhpcy5fcGxheWJhY2tSZXNvdXJjZSYmKHRoaXMuX3BsYXliYWNrUmVzb3VyY2UubG9vcD0hMSx0aGlzLl9wbGF5YmFja1Jlc291cmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9BVURJT19TRUVLRUQsdGhpcy5fbG9vcEhhbmRsZXIsITEpKX0sYi5fYWRkTG9vcGluZz1mdW5jdGlvbigpe251bGw9PXRoaXMuX3BsYXliYWNrUmVzb3VyY2V8fHRoaXMuX2F1ZGlvU3ByaXRlU3RvcFRpbWV8fCh0aGlzLl9wbGF5YmFja1Jlc291cmNlLmFkZEV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9BVURJT19TRUVLRUQsdGhpcy5fbG9vcEhhbmRsZXIsITEpLHRoaXMuX3BsYXliYWNrUmVzb3VyY2UubG9vcD0hMCl9LGIuX2hhbmRsZUNsZWFuVXA9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLl9wbGF5YmFja1Jlc291cmNlO2lmKG51bGwhPWEpe2EucGF1c2UoKSxhLmxvb3A9ITEsYS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fRU5ERUQsdGhpcy5fZW5kZWRIYW5kbGVyLCExKSxhLnJlbW92ZUV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9BVURJT19SRUFEWSx0aGlzLl9yZWFkeUhhbmRsZXIsITEpLGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NUQUxMRUQsdGhpcy5fc3RhbGxlZEhhbmRsZXIsITEpLGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NFRUtFRCx0aGlzLl9sb29wSGFuZGxlciwhMSksYS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fVElNRV9VUERBVEUsdGhpcy5fYXVkaW9TcHJpdGVFbmRIYW5kbGVyLCExKTt0cnl7YS5jdXJyZW50VGltZT10aGlzLl9zdGFydFRpbWV9Y2F0Y2goYil7fWNyZWF0ZWpzLkhUTUxBdWRpb1RhZ1Bvb2wuc2V0KHRoaXMuc3JjLGEpLHRoaXMuX3BsYXliYWNrUmVzb3VyY2U9bnVsbH19LGIuX2JlZ2luUGxheWluZz1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5fcGxheWJhY2tSZXNvdXJjZT1jcmVhdGVqcy5IVE1MQXVkaW9UYWdQb29sLmdldCh0aGlzLnNyYyksdGhpcy5BYnN0cmFjdFNvdW5kSW5zdGFuY2VfX2JlZ2luUGxheWluZyhhKX0sYi5faGFuZGxlU291bmRSZWFkeT1mdW5jdGlvbihhKXtpZig0IT09dGhpcy5fcGxheWJhY2tSZXNvdXJjZS5yZWFkeVN0YXRlKXt2YXIgYj10aGlzLl9wbGF5YmFja1Jlc291cmNlO3JldHVybiBiLmFkZEV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9BVURJT19SRUFEWSx0aGlzLl9yZWFkeUhhbmRsZXIsITEpLGIuYWRkRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NUQUxMRUQsdGhpcy5fc3RhbGxlZEhhbmRsZXIsITEpLGIucHJlbG9hZD1cImF1dG9cIix2b2lkIGIubG9hZCgpfXRoaXMuX3VwZGF0ZVZvbHVtZSgpLHRoaXMuX3BsYXliYWNrUmVzb3VyY2UuY3VycmVudFRpbWU9LjAwMSoodGhpcy5fc3RhcnRUaW1lK3RoaXMuX3Bvc2l0aW9uKSx0aGlzLl9hdWRpb1Nwcml0ZVN0b3BUaW1lP3RoaXMuX3BsYXliYWNrUmVzb3VyY2UuYWRkRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX1RJTUVfVVBEQVRFLHRoaXMuX2F1ZGlvU3ByaXRlRW5kSGFuZGxlciwhMSk6KHRoaXMuX3BsYXliYWNrUmVzb3VyY2UuYWRkRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX0VOREVELHRoaXMuX2VuZGVkSGFuZGxlciwhMSksMCE9dGhpcy5fbG9vcCYmKHRoaXMuX3BsYXliYWNrUmVzb3VyY2UuYWRkRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NFRUtFRCx0aGlzLl9sb29wSGFuZGxlciwhMSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5sb29wPSEwKSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5wbGF5KCl9LGIuX2hhbmRsZVRhZ1JlYWR5PWZ1bmN0aW9uKGEpe3RoaXMuX3BsYXliYWNrUmVzb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1JFQURZLHRoaXMuX3JlYWR5SGFuZGxlciwhMSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5yZW1vdmVFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU1RBTExFRCx0aGlzLl9zdGFsbGVkSGFuZGxlciwhMSksdGhpcy5faGFuZGxlU291bmRSZWFkeSgpfSxiLl9wYXVzZT1mdW5jdGlvbigpe3RoaXMuX3BsYXliYWNrUmVzb3VyY2UucGF1c2UoKX0sYi5fcmVzdW1lPWZ1bmN0aW9uKCl7dGhpcy5fcGxheWJhY2tSZXNvdXJjZS5wbGF5KCl9LGIuX3VwZGF0ZVZvbHVtZT1mdW5jdGlvbigpe2lmKG51bGwhPXRoaXMuX3BsYXliYWNrUmVzb3VyY2Upe3ZhciBhPXRoaXMuX211dGVkfHxjcmVhdGVqcy5Tb3VuZC5fbWFzdGVyTXV0ZT8wOnRoaXMuX3ZvbHVtZSpjcmVhdGVqcy5Tb3VuZC5fbWFzdGVyVm9sdW1lO2EhPXRoaXMuX3BsYXliYWNrUmVzb3VyY2Uudm9sdW1lJiYodGhpcy5fcGxheWJhY2tSZXNvdXJjZS52b2x1bWU9YSl9fSxiLl9jYWxjdWxhdGVDdXJyZW50UG9zaXRpb249ZnVuY3Rpb24oKXtyZXR1cm4gMWUzKnRoaXMuX3BsYXliYWNrUmVzb3VyY2UuY3VycmVudFRpbWUtdGhpcy5fc3RhcnRUaW1lfSxiLl91cGRhdGVQb3NpdGlvbj1mdW5jdGlvbigpe3RoaXMuX3BsYXliYWNrUmVzb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NFRUtFRCx0aGlzLl9sb29wSGFuZGxlciwhMSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5hZGRFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fQVVESU9fU0VFS0VELHRoaXMuX2hhbmRsZVNldFBvc2l0aW9uU2VlaywhMSk7dHJ5e3RoaXMuX3BsYXliYWNrUmVzb3VyY2UuY3VycmVudFRpbWU9LjAwMSoodGhpcy5fcG9zaXRpb24rdGhpcy5fc3RhcnRUaW1lKX1jYXRjaChhKXt0aGlzLl9oYW5kbGVTZXRQb3NpdGlvblNlZWsobnVsbCl9fSxiLl9oYW5kbGVTZXRQb3NpdGlvblNlZWs9ZnVuY3Rpb24oYSl7bnVsbCE9dGhpcy5fcGxheWJhY2tSZXNvdXJjZSYmKHRoaXMuX3BsYXliYWNrUmVzb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NFRUtFRCx0aGlzLl9oYW5kbGVTZXRQb3NpdGlvblNlZWssITEpLHRoaXMuX3BsYXliYWNrUmVzb3VyY2UuYWRkRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX1NFRUtFRCx0aGlzLl9sb29wSGFuZGxlciwhMSkpfSxiLl9oYW5kbGVBdWRpb1Nwcml0ZUxvb3A9ZnVuY3Rpb24oYSl7dGhpcy5fcGxheWJhY2tSZXNvdXJjZS5jdXJyZW50VGltZTw9dGhpcy5fYXVkaW9TcHJpdGVTdG9wVGltZXx8KHRoaXMuX3BsYXliYWNrUmVzb3VyY2UucGF1c2UoKSwwPT10aGlzLl9sb29wP3RoaXMuX2hhbmRsZVNvdW5kQ29tcGxldGUobnVsbCk6KHRoaXMuX3Bvc2l0aW9uPTAsdGhpcy5fbG9vcC0tLHRoaXMuX3BsYXliYWNrUmVzb3VyY2UuY3VycmVudFRpbWU9LjAwMSp0aGlzLl9zdGFydFRpbWUsdGhpcy5fcGF1c2VkfHx0aGlzLl9wbGF5YmFja1Jlc291cmNlLnBsYXkoKSx0aGlzLl9zZW5kRXZlbnQoXCJsb29wXCIpKSl9LGIuX2hhbmRsZUxvb3A9ZnVuY3Rpb24oYSl7MD09dGhpcy5fbG9vcCYmKHRoaXMuX3BsYXliYWNrUmVzb3VyY2UubG9vcD0hMSx0aGlzLl9wbGF5YmFja1Jlc291cmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoY3JlYXRlanMuSFRNTEF1ZGlvUGx1Z2luLl9BVURJT19TRUVLRUQsdGhpcy5fbG9vcEhhbmRsZXIsITEpKX0sYi5fdXBkYXRlU3RhcnRUaW1lPWZ1bmN0aW9uKCl7dGhpcy5fYXVkaW9TcHJpdGVTdG9wVGltZT0uMDAxKih0aGlzLl9zdGFydFRpbWUrdGhpcy5fZHVyYXRpb24pLHRoaXMucGxheVN0YXRlPT1jcmVhdGVqcy5Tb3VuZC5QTEFZX1NVQ0NFRURFRCYmKHRoaXMuX3BsYXliYWNrUmVzb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX0VOREVELHRoaXMuX2VuZGVkSGFuZGxlciwhMSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5hZGRFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fVElNRV9VUERBVEUsdGhpcy5fYXVkaW9TcHJpdGVFbmRIYW5kbGVyLCExKSl9LGIuX3VwZGF0ZUR1cmF0aW9uPWZ1bmN0aW9uKCl7dGhpcy5fYXVkaW9TcHJpdGVTdG9wVGltZT0uMDAxKih0aGlzLl9zdGFydFRpbWUrdGhpcy5fZHVyYXRpb24pLHRoaXMucGxheVN0YXRlPT1jcmVhdGVqcy5Tb3VuZC5QTEFZX1NVQ0NFRURFRCYmKHRoaXMuX3BsYXliYWNrUmVzb3VyY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW4uX0FVRElPX0VOREVELHRoaXMuX2VuZGVkSGFuZGxlciwhMSksdGhpcy5fcGxheWJhY2tSZXNvdXJjZS5hZGRFdmVudExpc3RlbmVyKGNyZWF0ZWpzLkhUTUxBdWRpb1BsdWdpbi5fVElNRV9VUERBVEUsdGhpcy5fYXVkaW9TcHJpdGVFbmRIYW5kbGVyLCExKSl9LGIuX3NldER1cmF0aW9uRnJvbVNvdXJjZT1mdW5jdGlvbigpe3RoaXMuX2R1cmF0aW9uPWNyZWF0ZWpzLkhUTUxBdWRpb1RhZ1Bvb2wuZ2V0RHVyYXRpb24odGhpcy5zcmMpLHRoaXMuX3BsYXliYWNrUmVzb3VyY2U9bnVsbH0sY3JlYXRlanMuSFRNTEF1ZGlvU291bmRJbnN0YW5jZT1jcmVhdGVqcy5wcm9tb3RlKGEsXCJBYnN0cmFjdFNvdW5kSW5zdGFuY2VcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aGlzLkFic3RyYWN0UGx1Z2luX2NvbnN0cnVjdG9yKCksdGhpcy5kZWZhdWx0TnVtQ2hhbm5lbHM9Mix0aGlzLl9jYXBhYmlsaXRpZXM9Yy5fY2FwYWJpbGl0aWVzLHRoaXMuX2xvYWRlckNsYXNzPWNyZWF0ZWpzLlNvdW5kTG9hZGVyLHRoaXMuX3NvdW5kSW5zdGFuY2VDbGFzcz1jcmVhdGVqcy5IVE1MQXVkaW9Tb3VuZEluc3RhbmNlfXZhciBiPWNyZWF0ZWpzLmV4dGVuZChhLGNyZWF0ZWpzLkFic3RyYWN0UGx1Z2luKSxjPWE7Yy5NQVhfSU5TVEFOQ0VTPTMwLGMuX0FVRElPX1JFQURZPVwiY2FucGxheXRocm91Z2hcIixjLl9BVURJT19FTkRFRD1cImVuZGVkXCIsYy5fQVVESU9fU0VFS0VEPVwic2Vla2VkXCIsYy5fQVVESU9fU1RBTExFRD1cInN0YWxsZWRcIixjLl9USU1FX1VQREFURT1cInRpbWV1cGRhdGVcIixjLl9jYXBhYmlsaXRpZXM9bnVsbCxjLmlzU3VwcG9ydGVkPWZ1bmN0aW9uKCl7cmV0dXJuIGMuX2dlbmVyYXRlQ2FwYWJpbGl0aWVzKCksbnVsbCE9Yy5fY2FwYWJpbGl0aWVzfSxjLl9nZW5lcmF0ZUNhcGFiaWxpdGllcz1mdW5jdGlvbigpe2lmKG51bGw9PWMuX2NhcGFiaWxpdGllcyl7dmFyIGE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImF1ZGlvXCIpO2lmKG51bGw9PWEuY2FuUGxheVR5cGUpcmV0dXJuIG51bGw7Yy5fY2FwYWJpbGl0aWVzPXtwYW5uaW5nOiExLHZvbHVtZTohMCx0cmFja3M6LTF9O2Zvcih2YXIgYj1jcmVhdGVqcy5Tb3VuZC5TVVBQT1JURURfRVhURU5TSU9OUyxkPWNyZWF0ZWpzLlNvdW5kLkVYVEVOU0lPTl9NQVAsZT0wLGY9Yi5sZW5ndGg7Zj5lO2UrKyl7dmFyIGc9YltlXSxoPWRbZ118fGc7Yy5fY2FwYWJpbGl0aWVzW2ddPVwibm9cIiE9YS5jYW5QbGF5VHlwZShcImF1ZGlvL1wiK2cpJiZcIlwiIT1hLmNhblBsYXlUeXBlKFwiYXVkaW8vXCIrZyl8fFwibm9cIiE9YS5jYW5QbGF5VHlwZShcImF1ZGlvL1wiK2gpJiZcIlwiIT1hLmNhblBsYXlUeXBlKFwiYXVkaW8vXCIraCl9fX0sYi5yZWdpc3Rlcj1mdW5jdGlvbihhKXt2YXIgYj1jcmVhdGVqcy5IVE1MQXVkaW9UYWdQb29sLmdldChhLnNyYyksYz10aGlzLkFic3RyYWN0UGx1Z2luX3JlZ2lzdGVyKGEpO3JldHVybiBjLnNldFRhZyhiKSxjfSxiLnJlbW92ZVNvdW5kPWZ1bmN0aW9uKGEpe3RoaXMuQWJzdHJhY3RQbHVnaW5fcmVtb3ZlU291bmQoYSksY3JlYXRlanMuSFRNTEF1ZGlvVGFnUG9vbC5yZW1vdmUoYSl9LGIuY3JlYXRlPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLkFic3RyYWN0UGx1Z2luX2NyZWF0ZShhLGIsYyk7cmV0dXJuIGQuc2V0UGxheWJhY2tSZXNvdXJjZShudWxsKSxkfSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbSFRNTEF1ZGlvUGx1Z2luXVwifSxiLnNldFZvbHVtZT1iLmdldFZvbHVtZT1iLnNldE11dGU9bnVsbCxjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW49Y3JlYXRlanMucHJvbW90ZShhLFwiQWJzdHJhY3RQbHVnaW5cIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoYixjLGQpe3RoaXMuaWdub3JlR2xvYmFsUGF1c2U9ITEsdGhpcy5sb29wPSExLHRoaXMuZHVyYXRpb249MCx0aGlzLnBsdWdpbkRhdGE9ZHx8e30sdGhpcy50YXJnZXQ9Yix0aGlzLnBvc2l0aW9uPW51bGwsdGhpcy5wYXNzaXZlPSExLHRoaXMuX3BhdXNlZD0hMSx0aGlzLl9jdXJRdWV1ZVByb3BzPXt9LHRoaXMuX2luaXRRdWV1ZVByb3BzPXt9LHRoaXMuX3N0ZXBzPVtdLHRoaXMuX2FjdGlvbnM9W10sdGhpcy5fcHJldlBvc2l0aW9uPTAsdGhpcy5fc3RlcFBvc2l0aW9uPTAsdGhpcy5fcHJldlBvcz0tMSx0aGlzLl90YXJnZXQ9Yix0aGlzLl91c2VUaWNrcz0hMSx0aGlzLl9pbml0ZWQ9ITEsdGhpcy5fcmVnaXN0ZXJlZD0hMSxjJiYodGhpcy5fdXNlVGlja3M9Yy51c2VUaWNrcyx0aGlzLmlnbm9yZUdsb2JhbFBhdXNlPWMuaWdub3JlR2xvYmFsUGF1c2UsdGhpcy5sb29wPWMubG9vcCxjLm9uQ2hhbmdlJiZ0aGlzLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIixjLm9uQ2hhbmdlKSxjLm92ZXJyaWRlJiZhLnJlbW92ZVR3ZWVucyhiKSksYyYmYy5wYXVzZWQ/dGhpcy5fcGF1c2VkPSEwOmNyZWF0ZWpzLlR3ZWVuLl9yZWdpc3Rlcih0aGlzLCEwKSxjJiZudWxsIT1jLnBvc2l0aW9uJiZ0aGlzLnNldFBvc2l0aW9uKGMucG9zaXRpb24sYS5OT05FKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIpO2EuTk9ORT0wLGEuTE9PUD0xLGEuUkVWRVJTRT0yLGEuSUdOT1JFPXt9LGEuX3R3ZWVucz1bXSxhLl9wbHVnaW5zPXt9LGEuZ2V0PWZ1bmN0aW9uKGIsYyxkLGUpe3JldHVybiBlJiZhLnJlbW92ZVR3ZWVucyhiKSxuZXcgYShiLGMsZCl9LGEudGljaz1mdW5jdGlvbihiLGMpe2Zvcih2YXIgZD1hLl90d2VlbnMuc2xpY2UoKSxlPWQubGVuZ3RoLTE7ZT49MDtlLS0pe3ZhciBmPWRbZV07YyYmIWYuaWdub3JlR2xvYmFsUGF1c2V8fGYuX3BhdXNlZHx8Zi50aWNrKGYuX3VzZVRpY2tzPzE6Yil9fSxhLmhhbmRsZUV2ZW50PWZ1bmN0aW9uKGEpe1widGlja1wiPT1hLnR5cGUmJnRoaXMudGljayhhLmRlbHRhLGEucGF1c2VkKX0sYS5yZW1vdmVUd2VlbnM9ZnVuY3Rpb24oYil7aWYoYi50d2VlbmpzX2NvdW50KXtmb3IodmFyIGM9YS5fdHdlZW5zLGQ9Yy5sZW5ndGgtMTtkPj0wO2QtLSl7dmFyIGU9Y1tkXTtlLl90YXJnZXQ9PWImJihlLl9wYXVzZWQ9ITAsYy5zcGxpY2UoZCwxKSl9Yi50d2VlbmpzX2NvdW50PTB9fSxhLnJlbW92ZUFsbFR3ZWVucz1mdW5jdGlvbigpe2Zvcih2YXIgYj1hLl90d2VlbnMsYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl7dmFyIGU9YltjXTtlLl9wYXVzZWQ9ITAsZS50YXJnZXQmJihlLnRhcmdldC50d2VlbmpzX2NvdW50PTApfWIubGVuZ3RoPTB9LGEuaGFzQWN0aXZlVHdlZW5zPWZ1bmN0aW9uKGIpe3JldHVybiBiP251bGwhPWIudHdlZW5qc19jb3VudCYmISFiLnR3ZWVuanNfY291bnQ6YS5fdHdlZW5zJiYhIWEuX3R3ZWVucy5sZW5ndGh9LGEuaW5zdGFsbFBsdWdpbj1mdW5jdGlvbihiLGMpe3ZhciBkPWIucHJpb3JpdHk7bnVsbD09ZCYmKGIucHJpb3JpdHk9ZD0wKTtmb3IodmFyIGU9MCxmPWMubGVuZ3RoLGc9YS5fcGx1Z2lucztmPmU7ZSsrKXt2YXIgaD1jW2VdO2lmKGdbaF0pe2Zvcih2YXIgaT1nW2hdLGo9MCxrPWkubGVuZ3RoO2s+aiYmIShkPGlbal0ucHJpb3JpdHkpO2orKyk7Z1toXS5zcGxpY2UoaiwwLGIpfWVsc2UgZ1toXT1bYl19fSxhLl9yZWdpc3Rlcj1mdW5jdGlvbihiLGMpe3ZhciBkPWIuX3RhcmdldCxlPWEuX3R3ZWVucztpZihjJiYhYi5fcmVnaXN0ZXJlZClkJiYoZC50d2VlbmpzX2NvdW50PWQudHdlZW5qc19jb3VudD9kLnR3ZWVuanNfY291bnQrMToxKSxlLnB1c2goYiksIWEuX2luaXRlZCYmY3JlYXRlanMuVGlja2VyJiYoY3JlYXRlanMuVGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0aWNrXCIsYSksYS5faW5pdGVkPSEwKTtlbHNlIGlmKCFjJiZiLl9yZWdpc3RlcmVkKXtkJiZkLnR3ZWVuanNfY291bnQtLTtmb3IodmFyIGY9ZS5sZW5ndGg7Zi0tOylpZihlW2ZdPT1iKXtlLnNwbGljZShmLDEpO2JyZWFrfX1iLl9yZWdpc3RlcmVkPWN9LGIud2FpdD1mdW5jdGlvbihhLGIpe2lmKG51bGw9PWF8fDA+PWEpcmV0dXJuIHRoaXM7dmFyIGM9dGhpcy5fY2xvbmVQcm9wcyh0aGlzLl9jdXJRdWV1ZVByb3BzKTtyZXR1cm4gdGhpcy5fYWRkU3RlcCh7ZDphLHAwOmMsZTp0aGlzLl9saW5lYXJFYXNlLHAxOmMsdjpifSl9LGIudG89ZnVuY3Rpb24oYSxiLGMpe3JldHVybihpc05hTihiKXx8MD5iKSYmKGI9MCksdGhpcy5fYWRkU3RlcCh7ZDpifHwwLHAwOnRoaXMuX2Nsb25lUHJvcHModGhpcy5fY3VyUXVldWVQcm9wcyksZTpjLHAxOnRoaXMuX2Nsb25lUHJvcHModGhpcy5fYXBwZW5kUXVldWVQcm9wcyhhKSl9KX0sYi5jYWxsPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5fYWRkQWN0aW9uKHtmOmEscDpiP2I6W3RoaXNdLG86Yz9jOnRoaXMuX3RhcmdldH0pfSxiLnNldD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLl9hZGRBY3Rpb24oe2Y6dGhpcy5fc2V0LG86dGhpcyxwOlthLGI/Yjp0aGlzLl90YXJnZXRdfSl9LGIucGxheT1mdW5jdGlvbihhKXtyZXR1cm4gYXx8KGE9dGhpcyksdGhpcy5jYWxsKGEuc2V0UGF1c2VkLFshMV0sYSl9LGIucGF1c2U9ZnVuY3Rpb24oYSl7cmV0dXJuIGF8fChhPXRoaXMpLHRoaXMuY2FsbChhLnNldFBhdXNlZCxbITBdLGEpfSxiLnNldFBvc2l0aW9uPWZ1bmN0aW9uKGEsYil7MD5hJiYoYT0wKSxudWxsPT1iJiYoYj0xKTt2YXIgYz1hLGQ9ITE7aWYoYz49dGhpcy5kdXJhdGlvbiYmKHRoaXMubG9vcD9jJT10aGlzLmR1cmF0aW9uOihjPXRoaXMuZHVyYXRpb24sZD0hMCkpLGM9PXRoaXMuX3ByZXZQb3MpcmV0dXJuIGQ7dmFyIGU9dGhpcy5fcHJldlBvcztpZih0aGlzLnBvc2l0aW9uPXRoaXMuX3ByZXZQb3M9Yyx0aGlzLl9wcmV2UG9zaXRpb249YSx0aGlzLl90YXJnZXQpaWYoZCl0aGlzLl91cGRhdGVUYXJnZXRQcm9wcyhudWxsLDEpO2Vsc2UgaWYodGhpcy5fc3RlcHMubGVuZ3RoPjApe2Zvcih2YXIgZj0wLGc9dGhpcy5fc3RlcHMubGVuZ3RoO2c+ZiYmISh0aGlzLl9zdGVwc1tmXS50PmMpO2YrKyk7dmFyIGg9dGhpcy5fc3RlcHNbZi0xXTt0aGlzLl91cGRhdGVUYXJnZXRQcm9wcyhoLCh0aGlzLl9zdGVwUG9zaXRpb249Yy1oLnQpL2guZCl9cmV0dXJuIDAhPWImJnRoaXMuX2FjdGlvbnMubGVuZ3RoPjAmJih0aGlzLl91c2VUaWNrcz90aGlzLl9ydW5BY3Rpb25zKGMsYyk6MT09YiYmZT5jPyhlIT10aGlzLmR1cmF0aW9uJiZ0aGlzLl9ydW5BY3Rpb25zKGUsdGhpcy5kdXJhdGlvbiksdGhpcy5fcnVuQWN0aW9ucygwLGMsITApKTp0aGlzLl9ydW5BY3Rpb25zKGUsYykpLGQmJnRoaXMuc2V0UGF1c2VkKCEwKSx0aGlzLmRpc3BhdGNoRXZlbnQoXCJjaGFuZ2VcIiksZH0sYi50aWNrPWZ1bmN0aW9uKGEpe3RoaXMuX3BhdXNlZHx8dGhpcy5zZXRQb3NpdGlvbih0aGlzLl9wcmV2UG9zaXRpb24rYSl9LGIuc2V0UGF1c2VkPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLl9wYXVzZWQ9PT0hIWI/dGhpczoodGhpcy5fcGF1c2VkPSEhYixhLl9yZWdpc3Rlcih0aGlzLCFiKSx0aGlzKX0sYi53PWIud2FpdCxiLnQ9Yi50byxiLmM9Yi5jYWxsLGIucz1iLnNldCxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbVHdlZW5dXCJ9LGIuY2xvbmU9ZnVuY3Rpb24oKXt0aHJvd1wiVHdlZW4gY2FuIG5vdCBiZSBjbG9uZWQuXCJ9LGIuX3VwZGF0ZVRhcmdldFByb3BzPWZ1bmN0aW9uKGIsYyl7dmFyIGQsZSxmLGcsaCxpO2lmKGJ8fDEhPWMpe2lmKHRoaXMucGFzc2l2ZT0hIWIudix0aGlzLnBhc3NpdmUpcmV0dXJuO2IuZSYmKGM9Yi5lKGMsMCwxLDEpKSxkPWIucDAsZT1iLnAxfWVsc2UgdGhpcy5wYXNzaXZlPSExLGQ9ZT10aGlzLl9jdXJRdWV1ZVByb3BzO2Zvcih2YXIgaiBpbiB0aGlzLl9pbml0UXVldWVQcm9wcyl7bnVsbD09KGc9ZFtqXSkmJihkW2pdPWc9dGhpcy5faW5pdFF1ZXVlUHJvcHNbal0pLG51bGw9PShoPWVbal0pJiYoZVtqXT1oPWcpLGY9Zz09aHx8MD09Y3x8MT09Y3x8XCJudW1iZXJcIiE9dHlwZW9mIGc/MT09Yz9oOmc6ZysoaC1nKSpjO3ZhciBrPSExO2lmKGk9YS5fcGx1Z2luc1tqXSlmb3IodmFyIGw9MCxtPWkubGVuZ3RoO20+bDtsKyspe3ZhciBuPWlbbF0udHdlZW4odGhpcyxqLGYsZCxlLGMsISFiJiZkPT1lLCFiKTtuPT1hLklHTk9SRT9rPSEwOmY9bn1rfHwodGhpcy5fdGFyZ2V0W2pdPWYpfX0sYi5fcnVuQWN0aW9ucz1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9YSxlPWIsZj0tMSxnPXRoaXMuX2FjdGlvbnMubGVuZ3RoLGg9MTtmb3IoYT5iJiYoZD1iLGU9YSxmPWcsZz1oPS0xKTsoZis9aCkhPWc7KXt2YXIgaT10aGlzLl9hY3Rpb25zW2ZdLGo9aS50OyhqPT1lfHxqPmQmJmU+anx8YyYmaj09YSkmJmkuZi5hcHBseShpLm8saS5wKX19LGIuX2FwcGVuZFF1ZXVlUHJvcHM9ZnVuY3Rpb24oYil7dmFyIGMsZCxlLGYsZztmb3IodmFyIGggaW4gYilpZih2b2lkIDA9PT10aGlzLl9pbml0UXVldWVQcm9wc1toXSl7aWYoZD10aGlzLl90YXJnZXRbaF0sYz1hLl9wbHVnaW5zW2hdKWZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWQ9Y1tlXS5pbml0KHRoaXMsaCxkKTt0aGlzLl9pbml0UXVldWVQcm9wc1toXT10aGlzLl9jdXJRdWV1ZVByb3BzW2hdPXZvaWQgMD09PWQ/bnVsbDpkfWVsc2UgZD10aGlzLl9jdXJRdWV1ZVByb3BzW2hdO2Zvcih2YXIgaCBpbiBiKXtpZihkPXRoaXMuX2N1clF1ZXVlUHJvcHNbaF0sYz1hLl9wbHVnaW5zW2hdKWZvcihnPWd8fHt9LGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspY1tlXS5zdGVwJiZjW2VdLnN0ZXAodGhpcyxoLGQsYltoXSxnKTt0aGlzLl9jdXJRdWV1ZVByb3BzW2hdPWJbaF19cmV0dXJuIGcmJnRoaXMuX2FwcGVuZFF1ZXVlUHJvcHMoZyksdGhpcy5fY3VyUXVldWVQcm9wc30sYi5fY2xvbmVQcm9wcz1mdW5jdGlvbihhKXt2YXIgYj17fTtmb3IodmFyIGMgaW4gYSliW2NdPWFbY107cmV0dXJuIGJ9LGIuX2FkZFN0ZXA9ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZD4wJiYodGhpcy5fc3RlcHMucHVzaChhKSxhLnQ9dGhpcy5kdXJhdGlvbix0aGlzLmR1cmF0aW9uKz1hLmQpLHRoaXN9LGIuX2FkZEFjdGlvbj1mdW5jdGlvbihhKXtyZXR1cm4gYS50PXRoaXMuZHVyYXRpb24sdGhpcy5fYWN0aW9ucy5wdXNoKGEpLHRoaXN9LGIuX3NldD1mdW5jdGlvbihhLGIpe2Zvcih2YXIgYyBpbiBhKWJbY109YVtjXX0sY3JlYXRlanMuVHdlZW49Y3JlYXRlanMucHJvbW90ZShhLFwiRXZlbnREaXNwYXRjaGVyXCIpfSgpLHRoaXMuY3JlYXRlanM9dGhpcy5jcmVhdGVqc3x8e30sZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBhKGEsYixjKXt0aGlzLkV2ZW50RGlzcGF0Y2hlcl9jb25zdHJ1Y3RvcigpLHRoaXMuaWdub3JlR2xvYmFsUGF1c2U9ITEsdGhpcy5kdXJhdGlvbj0wLHRoaXMubG9vcD0hMSx0aGlzLnBvc2l0aW9uPW51bGwsdGhpcy5fcGF1c2VkPSExLHRoaXMuX3R3ZWVucz1bXSx0aGlzLl9sYWJlbHM9bnVsbCx0aGlzLl9sYWJlbExpc3Q9bnVsbCx0aGlzLl9wcmV2UG9zaXRpb249MCx0aGlzLl9wcmV2UG9zPS0xLHRoaXMuX3VzZVRpY2tzPSExLHRoaXMuX3JlZ2lzdGVyZWQ9ITEsYyYmKHRoaXMuX3VzZVRpY2tzPWMudXNlVGlja3MsdGhpcy5sb29wPWMubG9vcCx0aGlzLmlnbm9yZUdsb2JhbFBhdXNlPWMuaWdub3JlR2xvYmFsUGF1c2UsYy5vbkNoYW5nZSYmdGhpcy5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsYy5vbkNoYW5nZSkpLGEmJnRoaXMuYWRkVHdlZW4uYXBwbHkodGhpcyxhKSx0aGlzLnNldExhYmVscyhiKSxjJiZjLnBhdXNlZD90aGlzLl9wYXVzZWQ9ITA6Y3JlYXRlanMuVHdlZW4uX3JlZ2lzdGVyKHRoaXMsITApLGMmJm51bGwhPWMucG9zaXRpb24mJnRoaXMuc2V0UG9zaXRpb24oYy5wb3NpdGlvbixjcmVhdGVqcy5Ud2Vlbi5OT05FKX12YXIgYj1jcmVhdGVqcy5leHRlbmQoYSxjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIpO2IuYWRkVHdlZW49ZnVuY3Rpb24oYSl7dmFyIGI9YXJndW1lbnRzLmxlbmd0aDtpZihiPjEpe2Zvcih2YXIgYz0wO2I+YztjKyspdGhpcy5hZGRUd2Vlbihhcmd1bWVudHNbY10pO3JldHVybiBhcmd1bWVudHNbMF19cmV0dXJuIDA9PWI/bnVsbDoodGhpcy5yZW1vdmVUd2VlbihhKSx0aGlzLl90d2VlbnMucHVzaChhKSxhLnNldFBhdXNlZCghMCksYS5fcGF1c2VkPSExLGEuX3VzZVRpY2tzPXRoaXMuX3VzZVRpY2tzLGEuZHVyYXRpb24+dGhpcy5kdXJhdGlvbiYmKHRoaXMuZHVyYXRpb249YS5kdXJhdGlvbiksdGhpcy5fcHJldlBvcz49MCYmYS5zZXRQb3NpdGlvbih0aGlzLl9wcmV2UG9zLGNyZWF0ZWpzLlR3ZWVuLk5PTkUpLGEpfSxiLnJlbW92ZVR3ZWVuPWZ1bmN0aW9uKGEpe3ZhciBiPWFyZ3VtZW50cy5sZW5ndGg7aWYoYj4xKXtmb3IodmFyIGM9ITAsZD0wO2I+ZDtkKyspYz1jJiZ0aGlzLnJlbW92ZVR3ZWVuKGFyZ3VtZW50c1tkXSk7cmV0dXJuIGN9aWYoMD09YilyZXR1cm4hMTtmb3IodmFyIGU9dGhpcy5fdHdlZW5zLGQ9ZS5sZW5ndGg7ZC0tOylpZihlW2RdPT1hKXJldHVybiBlLnNwbGljZShkLDEpLGEuZHVyYXRpb24+PXRoaXMuZHVyYXRpb24mJnRoaXMudXBkYXRlRHVyYXRpb24oKSwhMDtyZXR1cm4hMX0sYi5hZGRMYWJlbD1mdW5jdGlvbihhLGIpe3RoaXMuX2xhYmVsc1thXT1iO3ZhciBjPXRoaXMuX2xhYmVsTGlzdDtpZihjKXtmb3IodmFyIGQ9MCxlPWMubGVuZ3RoO2U+ZCYmIShiPGNbZF0ucG9zaXRpb24pO2QrKyk7Yy5zcGxpY2UoZCwwLHtsYWJlbDphLHBvc2l0aW9uOmJ9KX19LGIuc2V0TGFiZWxzPWZ1bmN0aW9uKGEpe3RoaXMuX2xhYmVscz1hP2E6e319LGIuZ2V0TGFiZWxzPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5fbGFiZWxMaXN0O2lmKCFhKXthPXRoaXMuX2xhYmVsTGlzdD1bXTt2YXIgYj10aGlzLl9sYWJlbHM7Zm9yKHZhciBjIGluIGIpYS5wdXNoKHtsYWJlbDpjLHBvc2l0aW9uOmJbY119KTthLnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5wb3NpdGlvbi1iLnBvc2l0aW9ufSl9cmV0dXJuIGF9LGIuZ2V0Q3VycmVudExhYmVsPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5nZXRMYWJlbHMoKSxiPXRoaXMucG9zaXRpb24sYz1hLmxlbmd0aDtpZihjKXtmb3IodmFyIGQ9MDtjPmQmJiEoYjxhW2RdLnBvc2l0aW9uKTtkKyspO3JldHVybiAwPT1kP251bGw6YVtkLTFdLmxhYmVsfXJldHVybiBudWxsfSxiLmdvdG9BbmRQbGF5PWZ1bmN0aW9uKGEpe3RoaXMuc2V0UGF1c2VkKCExKSx0aGlzLl9nb3RvKGEpfSxiLmdvdG9BbmRTdG9wPWZ1bmN0aW9uKGEpe3RoaXMuc2V0UGF1c2VkKCEwKSx0aGlzLl9nb3RvKGEpfSxiLnNldFBvc2l0aW9uPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5fY2FsY1Bvc2l0aW9uKGEpLGQ9IXRoaXMubG9vcCYmYT49dGhpcy5kdXJhdGlvbjtpZihjPT10aGlzLl9wcmV2UG9zKXJldHVybiBkO3RoaXMuX3ByZXZQb3NpdGlvbj1hLHRoaXMucG9zaXRpb249dGhpcy5fcHJldlBvcz1jO2Zvcih2YXIgZT0wLGY9dGhpcy5fdHdlZW5zLmxlbmd0aDtmPmU7ZSsrKWlmKHRoaXMuX3R3ZWVuc1tlXS5zZXRQb3NpdGlvbihjLGIpLGMhPXRoaXMuX3ByZXZQb3MpcmV0dXJuITE7cmV0dXJuIGQmJnRoaXMuc2V0UGF1c2VkKCEwKSx0aGlzLmRpc3BhdGNoRXZlbnQoXCJjaGFuZ2VcIiksZH0sYi5zZXRQYXVzZWQ9ZnVuY3Rpb24oYSl7dGhpcy5fcGF1c2VkPSEhYSxjcmVhdGVqcy5Ud2Vlbi5fcmVnaXN0ZXIodGhpcywhYSl9LGIudXBkYXRlRHVyYXRpb249ZnVuY3Rpb24oKXt0aGlzLmR1cmF0aW9uPTA7Zm9yKHZhciBhPTAsYj10aGlzLl90d2VlbnMubGVuZ3RoO2I+YTthKyspe3ZhciBjPXRoaXMuX3R3ZWVuc1thXTtjLmR1cmF0aW9uPnRoaXMuZHVyYXRpb24mJih0aGlzLmR1cmF0aW9uPWMuZHVyYXRpb24pfX0sYi50aWNrPWZ1bmN0aW9uKGEpe3RoaXMuc2V0UG9zaXRpb24odGhpcy5fcHJldlBvc2l0aW9uK2EpfSxiLnJlc29sdmU9ZnVuY3Rpb24oYSl7dmFyIGI9TnVtYmVyKGEpO3JldHVybiBpc05hTihiKSYmKGI9dGhpcy5fbGFiZWxzW2FdKSxifSxiLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuXCJbVGltZWxpbmVdXCJ9LGIuY2xvbmU9ZnVuY3Rpb24oKXt0aHJvd1wiVGltZWxpbmUgY2FuIG5vdCBiZSBjbG9uZWQuXCJ9LGIuX2dvdG89ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5yZXNvbHZlKGEpO251bGwhPWImJnRoaXMuc2V0UG9zaXRpb24oYil9LGIuX2NhbGNQb3NpdGlvbj1mdW5jdGlvbihhKXtyZXR1cm4gMD5hPzA6YTx0aGlzLmR1cmF0aW9uP2E6dGhpcy5sb29wP2EldGhpcy5kdXJhdGlvbjp0aGlzLmR1cmF0aW9ufSxjcmVhdGVqcy5UaW1lbGluZT1jcmVhdGVqcy5wcm9tb3RlKGEsXCJFdmVudERpc3BhdGNoZXJcIil9KCksdGhpcy5jcmVhdGVqcz10aGlzLmNyZWF0ZWpzfHx7fSxmdW5jdGlvbigpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIGEoKXt0aHJvd1wiRWFzZSBjYW5ub3QgYmUgaW5zdGFudGlhdGVkLlwifWEubGluZWFyPWZ1bmN0aW9uKGEpe3JldHVybiBhfSxhLm5vbmU9YS5saW5lYXIsYS5nZXQ9ZnVuY3Rpb24oYSl7cmV0dXJuLTE+YSYmKGE9LTEpLGE+MSYmKGE9MSksZnVuY3Rpb24oYil7cmV0dXJuIDA9PWE/YjowPmE/YiooYiotYSsxK2EpOmIqKCgyLWIpKmErKDEtYSkpfX0sYS5nZXRQb3dJbj1mdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuIE1hdGgucG93KGIsYSl9fSxhLmdldFBvd091dD1mdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuIDEtTWF0aC5wb3coMS1iLGEpfX0sYS5nZXRQb3dJbk91dD1mdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuKGIqPTIpPDE/LjUqTWF0aC5wb3coYixhKToxLS41Kk1hdGguYWJzKE1hdGgucG93KDItYixhKSl9fSxhLnF1YWRJbj1hLmdldFBvd0luKDIpLGEucXVhZE91dD1hLmdldFBvd091dCgyKSxhLnF1YWRJbk91dD1hLmdldFBvd0luT3V0KDIpLGEuY3ViaWNJbj1hLmdldFBvd0luKDMpLGEuY3ViaWNPdXQ9YS5nZXRQb3dPdXQoMyksYS5jdWJpY0luT3V0PWEuZ2V0UG93SW5PdXQoMyksYS5xdWFydEluPWEuZ2V0UG93SW4oNCksYS5xdWFydE91dD1hLmdldFBvd091dCg0KSxhLnF1YXJ0SW5PdXQ9YS5nZXRQb3dJbk91dCg0KSxhLnF1aW50SW49YS5nZXRQb3dJbig1KSxhLnF1aW50T3V0PWEuZ2V0UG93T3V0KDUpLGEucXVpbnRJbk91dD1hLmdldFBvd0luT3V0KDUpLGEuc2luZUluPWZ1bmN0aW9uKGEpe3JldHVybiAxLU1hdGguY29zKGEqTWF0aC5QSS8yKX0sYS5zaW5lT3V0PWZ1bmN0aW9uKGEpe3JldHVybiBNYXRoLnNpbihhKk1hdGguUEkvMil9LGEuc2luZUluT3V0PWZ1bmN0aW9uKGEpe3JldHVybi0uNSooTWF0aC5jb3MoTWF0aC5QSSphKS0xKX0sYS5nZXRCYWNrSW49ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe3JldHVybiBiKmIqKChhKzEpKmItYSl9fSxhLmJhY2tJbj1hLmdldEJhY2tJbigxLjcpLGEuZ2V0QmFja091dD1mdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuLS1iKmIqKChhKzEpKmIrYSkrMX19LGEuYmFja091dD1hLmdldEJhY2tPdXQoMS43KSxhLmdldEJhY2tJbk91dD1mdW5jdGlvbihhKXtyZXR1cm4gYSo9MS41MjUsZnVuY3Rpb24oYil7cmV0dXJuKGIqPTIpPDE/LjUqKGIqYiooKGErMSkqYi1hKSk6LjUqKChiLT0yKSpiKigoYSsxKSpiK2EpKzIpfX0sYS5iYWNrSW5PdXQ9YS5nZXRCYWNrSW5PdXQoMS43KSxhLmNpcmNJbj1mdW5jdGlvbihhKXtyZXR1cm4tKE1hdGguc3FydCgxLWEqYSktMSl9LGEuY2lyY091dD1mdW5jdGlvbihhKXtyZXR1cm4gTWF0aC5zcXJ0KDEtIC0tYSphKX0sYS5jaXJjSW5PdXQ9ZnVuY3Rpb24oYSl7cmV0dXJuKGEqPTIpPDE/LS41KihNYXRoLnNxcnQoMS1hKmEpLTEpOi41KihNYXRoLnNxcnQoMS0oYS09MikqYSkrMSl9LGEuYm91bmNlSW49ZnVuY3Rpb24oYil7cmV0dXJuIDEtYS5ib3VuY2VPdXQoMS1iKX0sYS5ib3VuY2VPdXQ9ZnVuY3Rpb24oYSl7cmV0dXJuIDEvMi43NT5hPzcuNTYyNSphKmE6Mi8yLjc1PmE/Ny41NjI1KihhLT0xLjUvMi43NSkqYSsuNzU6Mi41LzIuNzU+YT83LjU2MjUqKGEtPTIuMjUvMi43NSkqYSsuOTM3NTo3LjU2MjUqKGEtPTIuNjI1LzIuNzUpKmErLjk4NDM3NX0sYS5ib3VuY2VJbk91dD1mdW5jdGlvbihiKXtyZXR1cm4uNT5iPy41KmEuYm91bmNlSW4oMipiKTouNSphLmJvdW5jZU91dCgyKmItMSkrLjV9LGEuZ2V0RWxhc3RpY0luPWZ1bmN0aW9uKGEsYil7dmFyIGM9MipNYXRoLlBJO3JldHVybiBmdW5jdGlvbihkKXtpZigwPT1kfHwxPT1kKXJldHVybiBkO3ZhciBlPWIvYypNYXRoLmFzaW4oMS9hKTtyZXR1cm4tKGEqTWF0aC5wb3coMiwxMCooZC09MSkpKk1hdGguc2luKChkLWUpKmMvYikpfX0sYS5lbGFzdGljSW49YS5nZXRFbGFzdGljSW4oMSwuMyksYS5nZXRFbGFzdGljT3V0PWZ1bmN0aW9uKGEsYil7dmFyIGM9MipNYXRoLlBJO3JldHVybiBmdW5jdGlvbihkKXtpZigwPT1kfHwxPT1kKXJldHVybiBkO3ZhciBlPWIvYypNYXRoLmFzaW4oMS9hKTtyZXR1cm4gYSpNYXRoLnBvdygyLC0xMCpkKSpNYXRoLnNpbigoZC1lKSpjL2IpKzF9fSxhLmVsYXN0aWNPdXQ9YS5nZXRFbGFzdGljT3V0KDEsLjMpLGEuZ2V0RWxhc3RpY0luT3V0PWZ1bmN0aW9uKGEsYil7dmFyIGM9MipNYXRoLlBJO3JldHVybiBmdW5jdGlvbihkKXt2YXIgZT1iL2MqTWF0aC5hc2luKDEvYSk7cmV0dXJuKGQqPTIpPDE/LS41KihhKk1hdGgucG93KDIsMTAqKGQtPTEpKSpNYXRoLnNpbigoZC1lKSpjL2IpKTphKk1hdGgucG93KDIsLTEwKihkLT0xKSkqTWF0aC5zaW4oKGQtZSkqYy9iKSouNSsxfX0sYS5lbGFzdGljSW5PdXQ9YS5nZXRFbGFzdGljSW5PdXQoMSwuMyoxLjUpLGNyZWF0ZWpzLkVhc2U9YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gYSgpe3Rocm93XCJNb3Rpb25HdWlkZVBsdWdpbiBjYW5ub3QgYmUgaW5zdGFudGlhdGVkLlwifWEucHJpb3JpdHk9MCxhLl9yb3RPZmZTLGEuX3JvdE9mZkUsYS5fcm90Tm9ybVMsYS5fcm90Tm9ybUUsYS5pbnN0YWxsPWZ1bmN0aW9uKCl7cmV0dXJuIGNyZWF0ZWpzLlR3ZWVuLmluc3RhbGxQbHVnaW4oYSxbXCJndWlkZVwiLFwieFwiLFwieVwiLFwicm90YXRpb25cIl0pLGNyZWF0ZWpzLlR3ZWVuLklHTk9SRX0sYS5pbml0PWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1hLnRhcmdldDtyZXR1cm4gZC5oYXNPd25Qcm9wZXJ0eShcInhcIil8fChkLng9MCksZC5oYXNPd25Qcm9wZXJ0eShcInlcIil8fChkLnk9MCksZC5oYXNPd25Qcm9wZXJ0eShcInJvdGF0aW9uXCIpfHwoZC5yb3RhdGlvbj0wKSxcInJvdGF0aW9uXCI9PWImJihhLl9fbmVlZHNSb3Q9ITApLFwiZ3VpZGVcIj09Yj9udWxsOmN9LGEuc3RlcD1mdW5jdGlvbihiLGMsZCxlLGYpe2lmKFwicm90YXRpb25cIj09YyYmKGIuX19yb3RHbG9iYWxTPWQsYi5fX3JvdEdsb2JhbEU9ZSxhLnRlc3RSb3REYXRhKGIsZikpLFwiZ3VpZGVcIiE9YylyZXR1cm4gZTt2YXIgZyxoPWU7aC5oYXNPd25Qcm9wZXJ0eShcInBhdGhcIil8fChoLnBhdGg9W10pO3ZhciBpPWgucGF0aDtpZihoLmhhc093blByb3BlcnR5KFwiZW5kXCIpfHwoaC5lbmQ9MSksaC5oYXNPd25Qcm9wZXJ0eShcInN0YXJ0XCIpfHwoaC5zdGFydD1kJiZkLmhhc093blByb3BlcnR5KFwiZW5kXCIpJiZkLnBhdGg9PT1pP2QuZW5kOjApLGguaGFzT3duUHJvcGVydHkoXCJfc2VnbWVudHNcIikmJmguX2xlbmd0aClyZXR1cm4gZTt2YXIgaj1pLmxlbmd0aCxrPTEwO2lmKCEoaj49NiYmKGotMiklND09MCkpdGhyb3dcImludmFsaWQgJ3BhdGgnIGRhdGEsIHBsZWFzZSBzZWUgZG9jdW1lbnRhdGlvbiBmb3IgdmFsaWQgcGF0aHNcIjtoLl9zZWdtZW50cz1bXSxoLl9sZW5ndGg9MDtmb3IodmFyIGw9MjtqPmw7bCs9NCl7Zm9yKHZhciBtLG4sbz1pW2wtMl0scD1pW2wtMV0scT1pW2wrMF0scj1pW2wrMV0scz1pW2wrMl0sdD1pW2wrM10sdT1vLHY9cCx3PTAseD1bXSx5PTE7az49eTt5Kyspe3ZhciB6PXkvayxBPTEtejttPUEqQSpvKzIqQSp6KnEreip6KnMsbj1BKkEqcCsyKkEqeipyK3oqeip0LHcrPXhbeC5wdXNoKE1hdGguc3FydCgoZz1tLXUpKmcrKGc9bi12KSpnKSktMV0sdT1tLHY9bn1oLl9zZWdtZW50cy5wdXNoKHcpLGguX3NlZ21lbnRzLnB1c2goeCksaC5fbGVuZ3RoKz13fWc9aC5vcmllbnQsaC5vcmllbnQ9ITA7dmFyIEI9e307cmV0dXJuIGEuY2FsYyhoLGguc3RhcnQsQiksYi5fX3JvdFBhdGhTPU51bWJlcihCLnJvdGF0aW9uLnRvRml4ZWQoNSkpLGEuY2FsYyhoLGguZW5kLEIpLGIuX19yb3RQYXRoRT1OdW1iZXIoQi5yb3RhdGlvbi50b0ZpeGVkKDUpKSxoLm9yaWVudD0hMSxhLmNhbGMoaCxoLmVuZCxmKSxoLm9yaWVudD1nLGgub3JpZW50PyhiLl9fZ3VpZGVEYXRhPWgsYS50ZXN0Um90RGF0YShiLGYpLGUpOmV9LGEudGVzdFJvdERhdGE9ZnVuY3Rpb24oYSxiKXtpZih2b2lkIDA9PT1hLl9fcm90R2xvYmFsU3x8dm9pZCAwPT09YS5fX3JvdEdsb2JhbEUpe2lmKGEuX19uZWVkc1JvdClyZXR1cm47dm9pZCAwIT09YS5fY3VyUXVldWVQcm9wcy5yb3RhdGlvbj9hLl9fcm90R2xvYmFsUz1hLl9fcm90R2xvYmFsRT1hLl9jdXJRdWV1ZVByb3BzLnJvdGF0aW9uOmEuX19yb3RHbG9iYWxTPWEuX19yb3RHbG9iYWxFPWIucm90YXRpb249YS50YXJnZXQucm90YXRpb258fDB9aWYodm9pZCAwIT09YS5fX2d1aWRlRGF0YSl7dmFyIGM9YS5fX2d1aWRlRGF0YSxkPWEuX19yb3RHbG9iYWxFLWEuX19yb3RHbG9iYWxTLGU9YS5fX3JvdFBhdGhFLWEuX19yb3RQYXRoUyxmPWQtZTtpZihcImF1dG9cIj09Yy5vcmllbnQpZj4xODA/Zi09MzYwOi0xODA+ZiYmKGYrPTM2MCk7ZWxzZSBpZihcImN3XCI9PWMub3JpZW50KXtmb3IoOzA+ZjspZis9MzYwOzA9PWYmJmQ+MCYmMTgwIT1kJiYoZis9MzYwKX1lbHNlIGlmKFwiY2N3XCI9PWMub3JpZW50KXtmb3IoZj1kLShlPjE4MD8zNjAtZTplKTtmPjA7KWYtPTM2MDswPT1mJiYwPmQmJi0xODAhPWQmJihmLT0zNjApfWMucm90RGVsdGE9ZixjLnJvdE9mZlM9YS5fX3JvdEdsb2JhbFMtYS5fX3JvdFBhdGhTLGEuX19yb3RHbG9iYWxTPWEuX19yb3RHbG9iYWxFPWEuX19ndWlkZURhdGE9YS5fX25lZWRzUm90PXZvaWQgMH19LGEudHdlZW49ZnVuY3Rpb24oYixjLGQsZSxmLGcsaCxpKXt2YXIgaj1mLmd1aWRlO2lmKHZvaWQgMD09anx8aj09PWUuZ3VpZGUpcmV0dXJuIGQ7aWYoai5sYXN0UmF0aW8hPWcpe3ZhciBrPShqLmVuZC1qLnN0YXJ0KSooaD9qLmVuZDpnKStqLnN0YXJ0O3N3aXRjaChhLmNhbGMoaixrLGIudGFyZ2V0KSxqLm9yaWVudCl7Y2FzZVwiY3dcIjpjYXNlXCJjY3dcIjpjYXNlXCJhdXRvXCI6Yi50YXJnZXQucm90YXRpb24rPWoucm90T2ZmUytqLnJvdERlbHRhKmc7YnJlYWs7Y2FzZVwiZml4ZWRcIjpkZWZhdWx0OmIudGFyZ2V0LnJvdGF0aW9uKz1qLnJvdE9mZlN9ai5sYXN0UmF0aW89Z31yZXR1cm5cInJvdGF0aW9uXCIhPWN8fGoub3JpZW50JiZcImZhbHNlXCIhPWoub3JpZW50P2IudGFyZ2V0W2NdOmR9LGEuY2FsYz1mdW5jdGlvbihhLGIsYyl7aWYodm9pZCAwPT1hLl9zZWdtZW50cyl0aHJvd1wiTWlzc2luZyBjcml0aWNhbCBwcmUtY2FsY3VsYXRlZCBpbmZvcm1hdGlvbiwgcGxlYXNlIGZpbGUgYSBidWdcIjt2b2lkIDA9PWMmJihjPXt4OjAseTowLHJvdGF0aW9uOjB9KTtmb3IodmFyIGQ9YS5fc2VnbWVudHMsZT1hLnBhdGgsZj1hLl9sZW5ndGgqYixnPWQubGVuZ3RoLTIsaD0wO2Y+ZFtoXSYmZz5oOylmLT1kW2hdLGgrPTI7dmFyIGk9ZFtoKzFdLGo9MDtmb3IoZz1pLmxlbmd0aC0xO2Y+aVtqXSYmZz5qOylmLT1pW2pdLGorKzt2YXIgaz1qLysrZytmLyhnKmlbal0pO2g9MipoKzI7dmFyIGw9MS1rO3JldHVybiBjLng9bCpsKmVbaC0yXSsyKmwqayplW2grMF0rayprKmVbaCsyXSxjLnk9bCpsKmVbaC0xXSsyKmwqayplW2grMV0rayprKmVbaCszXSxhLm9yaWVudCYmKGMucm90YXRpb249NTcuMjk1Nzc5NSpNYXRoLmF0YW4yKChlW2grMV0tZVtoLTFdKSpsKyhlW2grM10tZVtoKzFdKSprLChlW2grMF0tZVtoLTJdKSpsKyhlW2grMl0tZVtoKzBdKSprKSksY30sY3JlYXRlanMuTW90aW9uR3VpZGVQbHVnaW49YX0oKSx0aGlzLmNyZWF0ZWpzPXRoaXMuY3JlYXRlanN8fHt9LGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7dmFyIGE9Y3JlYXRlanMuVHdlZW5KUz1jcmVhdGVqcy5Ud2VlbkpTfHx7fTthLnZlcnNpb249XCIwLjYuMlwiLGEuYnVpbGREYXRlPVwiVGh1LCAyNiBOb3YgMjAxNSAyMDo0NDozMSBHTVRcIn0oKTsiLCIvLyBGaWxiZXJ0IGlzIGEgUHl0aG9uIHBhcnNlciB3cml0dGVuIGluIEphdmFTY3JpcHQuXG4vL1xuLy8gRmlsYmVydCB3YXMgd3JpdHRlbiBieSBNYXR0IExvdHQgYW5kIHJlbGVhc2VkIHVuZGVyIGFuIE1JVFxuLy8gbGljZW5zZS4gSXQgd2FzIGFkYXRwZWQgZnJvbSBbQWNvcm5dKGh0dHBzOi8vZ2l0aHViLmNvbS9tYXJpam5oL2Fjb3JuLmdpdClcbi8vIGJ5IE1hcmlqbiBIYXZlcmJla2UuXG4vL1xuLy8gR2l0IHJlcG9zaXRvcnkgZm9yIEZpbGJlcnQgYXJlIGF2YWlsYWJsZSBhdFxuLy9cbi8vICAgICBodHRwczovL2dpdGh1Yi5jb20vZGlmZmVyZW50bWF0dC9maWxiZXJ0LmdpdFxuLy9cbi8vIFBsZWFzZSB1c2UgdGhlIFtnaXRodWIgYnVnIHRyYWNrZXJdW2doYnRdIHRvIHJlcG9ydCBpc3N1ZXMuXG4vL1xuLy8gW2doYnRdOiBodHRwczovL2dpdGh1Yi5jb20vZGlmZmVyZW50bWF0dC9maWxiZXJ0L2lzc3Vlc1xuXG4oZnVuY3Rpb24ocm9vdCwgbW9kKSB7XG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBtb2R1bGUgPT0gXCJvYmplY3RcIikgcmV0dXJuIG1vZChleHBvcnRzKTsgLy8gQ29tbW9uSlNcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHJldHVybiBkZWZpbmUoW1wiZXhwb3J0c1wiXSwgbW9kKTsgLy8gQU1EXG4gIG1vZChyb290LmZpbGJlcnQgfHwgKHJvb3QuZmlsYmVydCA9IHt9KSk7IC8vIFBsYWluIGJyb3dzZXIgZW52XG59KSh0aGlzLCBmdW5jdGlvbihleHBvcnRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGV4cG9ydHMudmVyc2lvbiA9IFwiMC41LjFcIjtcblxuICAvLyBUaGUgbWFpbiBleHBvcnRlZCBpbnRlcmZhY2UgKHVuZGVyIGBzZWxmLmZpbGJlcnRgIHdoZW4gaW4gdGhlXG4gIC8vIGJyb3dzZXIpIGlzIGEgYHBhcnNlYCBmdW5jdGlvbiB0aGF0IHRha2VzIGEgY29kZSBzdHJpbmcgYW5kXG4gIC8vIHJldHVybnMgYW4gYWJzdHJhY3Qgc3ludGF4IHRyZWUgYXMgc3BlY2lmaWVkIGJ5IFtNb3ppbGxhIHBhcnNlclxuICAvLyBBUEldW2FwaV0uXG4gIC8vXG4gIC8vIFthcGldOiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1NwaWRlck1vbmtleS9QYXJzZXJfQVBJXG5cbiAgdmFyIG9wdGlvbnMsIGlucHV0LCBpbnB1dExlbiwgc291cmNlRmlsZSwgbmM7XG5cbiAgZXhwb3J0cy5wYXJzZSA9IGZ1bmN0aW9uKGlucHQsIG9wdHMpIHtcbiAgICBpbnB1dCA9IFN0cmluZyhpbnB0KTsgaW5wdXRMZW4gPSBpbnB1dC5sZW5ndGg7XG4gICAgc2V0T3B0aW9ucyhvcHRzKTtcbiAgICBpbml0VG9rZW5TdGF0ZSgpO1xuICAgIG5jID0gZ2V0Tm9kZUNyZWF0b3Ioc3RhcnROb2RlLCBzdGFydE5vZGVGcm9tLCBmaW5pc2hOb2RlLCB1bnBhY2tUdXBsZSk7XG4gICAgcmV0dXJuIHBhcnNlVG9wTGV2ZWwob3B0aW9ucy5wcm9ncmFtKTtcbiAgfTtcblxuICAvLyBBIHNlY29uZCBvcHRpb25hbCBhcmd1bWVudCBjYW4gYmUgZ2l2ZW4gdG8gZnVydGhlciBjb25maWd1cmVcbiAgLy8gdGhlIHBhcnNlciBwcm9jZXNzLiBUaGVzZSBvcHRpb25zIGFyZSByZWNvZ25pemVkOlxuXG4gIHZhciBkZWZhdWx0T3B0aW9ucyA9IGV4cG9ydHMuZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgLy8gYGxhbmd1YWdlVmVyc2lvbmAgaW5kaWNhdGVzIHRoZSBQeXRob24gdmVyc2lvbiB0byBwYXJzZS4gSXRcbiAgICAvLyBpcyBub3QgY3VycmVudGx5IGluIHVzZSwgYnV0IHdpbGwgc3VwcG9ydCAyIG9yIDMgZXZlbnR1YWxseS5cbiAgICBsYW5ndWFnZVZlcnNpb246IDMsXG4gICAgLy8gV2hlbiBgYWxsb3dUcmFpbGluZ0NvbW1hc2AgaXMgZmFsc2UsIHRoZSBwYXJzZXIgd2lsbCBub3QgYWxsb3dcbiAgICAvLyB0cmFpbGluZyBjb21tYXMgaW4gYXJyYXkgYW5kIG9iamVjdCBsaXRlcmFscy5cbiAgICBhbGxvd1RyYWlsaW5nQ29tbWFzOiB0cnVlLFxuICAgIC8vIFdoZW4gZW5hYmxlZCwgYSByZXR1cm4gYXQgdGhlIHRvcCBsZXZlbCBpcyBub3QgY29uc2lkZXJlZCBhblxuICAgIC8vIGVycm9yLlxuICAgIGFsbG93UmV0dXJuT3V0c2lkZUZ1bmN0aW9uOiBmYWxzZSxcbiAgICAvLyBXaGVuIGBsb2NhdGlvbnNgIGlzIG9uLCBgbG9jYCBwcm9wZXJ0aWVzIGhvbGRpbmcgb2JqZWN0cyB3aXRoXG4gICAgLy8gYHN0YXJ0YCBhbmQgYGVuZGAgcHJvcGVydGllcyBpbiBge2xpbmUsIGNvbHVtbn1gIGZvcm0gKHdpdGhcbiAgICAvLyBsaW5lIGJlaW5nIDEtYmFzZWQgYW5kIGNvbHVtbiAwLWJhc2VkKSB3aWxsIGJlIGF0dGFjaGVkIHRvIHRoZVxuICAgIC8vIG5vZGVzLlxuICAgIGxvY2F0aW9uczogZmFsc2UsXG4gICAgLy8gQSBmdW5jdGlvbiBjYW4gYmUgcGFzc2VkIGFzIGBvbkNvbW1lbnRgIG9wdGlvbiwgd2hpY2ggd2lsbFxuICAgIC8vIGNhdXNlIEZpbGJlcnQgdG8gY2FsbCB0aGF0IGZ1bmN0aW9uIHdpdGggYCh0ZXh0LCBzdGFydCxcbiAgICAvLyBlbmQpYCBwYXJhbWV0ZXJzIHdoZW5ldmVyIGEgY29tbWVudCBpcyBza2lwcGVkLlxuICAgIC8vIGB0ZXh0YCBpcyB0aGUgY29udGVudCBvZiB0aGUgY29tbWVudCwgYW5kIGBzdGFydGAgYW5kIGBlbmRgIGFyZVxuICAgIC8vIGNoYXJhY3RlciBvZmZzZXRzIHRoYXQgZGVub3RlIHRoZSBzdGFydCBhbmQgZW5kIG9mIHRoZSBjb21tZW50LlxuICAgIC8vIFdoZW4gdGhlIGBsb2NhdGlvbnNgIG9wdGlvbiBpcyBvbiwgdHdvIG1vcmUgcGFyYW1ldGVycyBhcmVcbiAgICAvLyBwYXNzZWQsIHRoZSBmdWxsIGB7bGluZSwgY29sdW1ufWAgbG9jYXRpb25zIG9mIHRoZSBzdGFydCBhbmRcbiAgICAvLyBlbmQgb2YgdGhlIGNvbW1lbnRzLiBOb3RlIHRoYXQgeW91IGFyZSBub3QgYWxsb3dlZCB0byBjYWxsIHRoZVxuICAgIC8vIHBhcnNlciBmcm9tIHRoZSBjYWxsYmFjay10aGF0IHdpbGwgY29ycnVwdCBpdHMgaW50ZXJuYWwgc3RhdGUuXG4gICAgb25Db21tZW50OiBudWxsLFxuICAgIC8vIFtzZW1pLXN0YW5kYXJkaXplZF1bcmFuZ2VdIGByYW5nZWAgcHJvcGVydHkgaG9sZGluZyBhIGBbc3RhcnQsXG4gICAgLy8gZW5kXWAgYXJyYXkgd2l0aCB0aGUgc2FtZSBudW1iZXJzLCBzZXQgdGhlIGByYW5nZXNgIG9wdGlvbiB0b1xuICAgIC8vIGB0cnVlYC5cbiAgICAvL1xuICAgIC8vIFtyYW5nZV06IGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTc0NTY3OFxuICAgIHJhbmdlczogZmFsc2UsXG4gICAgLy8gSXQgaXMgcG9zc2libGUgdG8gcGFyc2UgbXVsdGlwbGUgZmlsZXMgaW50byBhIHNpbmdsZSBBU1QgYnlcbiAgICAvLyBwYXNzaW5nIHRoZSB0cmVlIHByb2R1Y2VkIGJ5IHBhcnNpbmcgdGhlIGZpcnN0IGZpbGUgYXNcbiAgICAvLyBgcHJvZ3JhbWAgb3B0aW9uIGluIHN1YnNlcXVlbnQgcGFyc2VzLiBUaGlzIHdpbGwgYWRkIHRoZVxuICAgIC8vIHRvcGxldmVsIGZvcm1zIG9mIHRoZSBwYXJzZWQgZmlsZSB0byB0aGUgYFByb2dyYW1gICh0b3ApIG5vZGVcbiAgICAvLyBvZiBhbiBleGlzdGluZyBwYXJzZSB0cmVlLlxuICAgIHByb2dyYW06IG51bGwsXG4gICAgLy8gV2hlbiBgbG9jYXRpb25zYCBpcyBvbiwgeW91IGNhbiBwYXNzIHRoaXMgdG8gcmVjb3JkIHRoZSBzb3VyY2VcbiAgICAvLyBmaWxlIGluIGV2ZXJ5IG5vZGUncyBgbG9jYCBvYmplY3QuXG4gICAgc291cmNlRmlsZTogbnVsbCxcbiAgICAvLyBUaGlzIHZhbHVlLCBpZiBnaXZlbiwgaXMgc3RvcmVkIGluIGV2ZXJ5IG5vZGUsIHdoZXRoZXJcbiAgICAvLyBgbG9jYXRpb25zYCBpcyBvbiBvciBvZmYuXG4gICAgZGlyZWN0U291cmNlRmlsZTogbnVsbCxcbiAgICAvLyBQeXRob24gcnVudGltZSBsaWJyYXJ5IG9iamVjdCBuYW1lXG4gICAgcnVudGltZVBhcmFtTmFtZTogXCJfX3B5dGhvblJ1bnRpbWVcIlxuICB9O1xuXG4gIGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0cykge1xuICAgIG9wdGlvbnMgPSBvcHRzIHx8IHt9O1xuICAgIGZvciAodmFyIG9wdCBpbiBkZWZhdWx0T3B0aW9ucykgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob3B0aW9ucywgb3B0KSlcbiAgICAgIG9wdGlvbnNbb3B0XSA9IGRlZmF1bHRPcHRpb25zW29wdF07XG4gICAgc291cmNlRmlsZSA9IG9wdGlvbnMuc291cmNlRmlsZSB8fCBudWxsO1xuICB9XG5cbiAgLy8gVGhlIGBnZXRMaW5lSW5mb2AgZnVuY3Rpb24gaXMgbW9zdGx5IHVzZWZ1bCB3aGVuIHRoZVxuICAvLyBgbG9jYXRpb25zYCBvcHRpb24gaXMgb2ZmIChmb3IgcGVyZm9ybWFuY2UgcmVhc29ucykgYW5kIHlvdVxuICAvLyB3YW50IHRvIGZpbmQgdGhlIGxpbmUvY29sdW1uIHBvc2l0aW9uIGZvciBhIGdpdmVuIGNoYXJhY3RlclxuICAvLyBvZmZzZXQuIGBpbnB1dGAgc2hvdWxkIGJlIHRoZSBjb2RlIHN0cmluZyB0aGF0IHRoZSBvZmZzZXQgcmVmZXJzXG4gIC8vIGludG8uXG5cbiAgdmFyIGdldExpbmVJbmZvID0gZXhwb3J0cy5nZXRMaW5lSW5mbyA9IGZ1bmN0aW9uKGlucHV0LCBvZmZzZXQpIHtcbiAgICBmb3IgKHZhciBsaW5lID0gMSwgY3VyID0gMDs7KSB7XG4gICAgICBsaW5lQnJlYWsubGFzdEluZGV4ID0gY3VyO1xuICAgICAgdmFyIG1hdGNoID0gbGluZUJyZWFrLmV4ZWMoaW5wdXQpO1xuICAgICAgaWYgKG1hdGNoICYmIG1hdGNoLmluZGV4IDwgb2Zmc2V0KSB7XG4gICAgICAgICsrbGluZTtcbiAgICAgICAgY3VyID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7XG4gICAgICB9IGVsc2UgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiB7bGluZTogbGluZSwgY29sdW1uOiBvZmZzZXQgLSBjdXJ9O1xuICB9O1xuXG4gIC8vIEZpbGJlcnQgaXMgb3JnYW5pemVkIGFzIGEgdG9rZW5pemVyIGFuZCBhIHJlY3Vyc2l2ZS1kZXNjZW50IHBhcnNlci5cbiAgLy8gVGhlIGB0b2tlbml6ZWAgZXhwb3J0IHByb3ZpZGVzIGFuIGludGVyZmFjZSB0byB0aGUgdG9rZW5pemVyLlxuICAvLyBCZWNhdXNlIHRoZSB0b2tlbml6ZXIgaXMgb3B0aW1pemVkIGZvciBiZWluZyBlZmZpY2llbnRseSB1c2VkIGJ5XG4gIC8vIHRoZSBGaWxiZXJ0IHBhcnNlciBpdHNlbGYsIHRoaXMgaW50ZXJmYWNlIGlzIHNvbWV3aGF0IGNydWRlIGFuZCBub3RcbiAgLy8gdmVyeSBtb2R1bGFyLiBQZXJmb3JtaW5nIGFub3RoZXIgcGFyc2Ugb3IgY2FsbCB0byBgdG9rZW5pemVgIHdpbGxcbiAgLy8gcmVzZXQgdGhlIGludGVybmFsIHN0YXRlLCBhbmQgaW52YWxpZGF0ZSBleGlzdGluZyB0b2tlbml6ZXJzLlxuXG4gIGV4cG9ydHMudG9rZW5pemUgPSBmdW5jdGlvbihpbnB0LCBvcHRzKSB7XG4gICAgaW5wdXQgPSBTdHJpbmcoaW5wdCk7IGlucHV0TGVuID0gaW5wdXQubGVuZ3RoO1xuICAgIHNldE9wdGlvbnMob3B0cyk7XG4gICAgaW5pdFRva2VuU3RhdGUoKTtcblxuICAgIHZhciB0ID0ge307XG4gICAgZnVuY3Rpb24gZ2V0VG9rZW4oZm9yY2VSZWdleHApIHtcbiAgICAgIGxhc3RFbmQgPSB0b2tFbmQ7XG4gICAgICByZWFkVG9rZW4oZm9yY2VSZWdleHApO1xuICAgICAgdC5zdGFydCA9IHRva1N0YXJ0OyB0LmVuZCA9IHRva0VuZDtcbiAgICAgIHQuc3RhcnRMb2MgPSB0b2tTdGFydExvYzsgdC5lbmRMb2MgPSB0b2tFbmRMb2M7XG4gICAgICB0LnR5cGUgPSB0b2tUeXBlOyB0LnZhbHVlID0gdG9rVmFsO1xuICAgICAgcmV0dXJuIHQ7XG4gICAgfVxuICAgIGdldFRva2VuLmp1bXBUbyA9IGZ1bmN0aW9uKHBvcywgcmVBbGxvd2VkKSB7XG4gICAgICB0b2tQb3MgPSBwb3M7XG4gICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHtcbiAgICAgICAgdG9rQ3VyTGluZSA9IDE7XG4gICAgICAgIHRva0xpbmVTdGFydCA9IGxpbmVCcmVhay5sYXN0SW5kZXggPSAwO1xuICAgICAgICB2YXIgbWF0Y2g7XG4gICAgICAgIHdoaWxlICgobWF0Y2ggPSBsaW5lQnJlYWsuZXhlYyhpbnB1dCkpICYmIG1hdGNoLmluZGV4IDwgcG9zKSB7XG4gICAgICAgICAgKyt0b2tDdXJMaW5lO1xuICAgICAgICAgIHRva0xpbmVTdGFydCA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0b2tSZWdleHBBbGxvd2VkID0gcmVBbGxvd2VkO1xuICAgICAgc2tpcFNwYWNlKCk7XG4gICAgfTtcbiAgICByZXR1cm4gZ2V0VG9rZW47XG4gIH07XG5cbiAgLy8gU3RhdGUgaXMga2VwdCBpbiAoY2xvc3VyZS0pZ2xvYmFsIHZhcmlhYmxlcy4gV2UgYWxyZWFkeSBzYXcgdGhlXG4gIC8vIGBvcHRpb25zYCwgYGlucHV0YCwgYW5kIGBpbnB1dExlbmAgdmFyaWFibGVzIGFib3ZlLlxuXG4gIC8vIFRoZSBjdXJyZW50IHBvc2l0aW9uIG9mIHRoZSB0b2tlbml6ZXIgaW4gdGhlIGlucHV0LlxuXG4gIHZhciB0b2tQb3M7XG5cbiAgLy8gVGhlIHN0YXJ0IGFuZCBlbmQgb2Zmc2V0cyBvZiB0aGUgY3VycmVudCB0b2tlbi5cblxuICB2YXIgdG9rU3RhcnQsIHRva0VuZDtcblxuICAvLyBXaGVuIGBvcHRpb25zLmxvY2F0aW9uc2AgaXMgdHJ1ZSwgdGhlc2UgaG9sZCBvYmplY3RzXG4gIC8vIGNvbnRhaW5pbmcgdGhlIHRva2VucyBzdGFydCBhbmQgZW5kIGxpbmUvY29sdW1uIHBhaXJzLlxuXG4gIHZhciB0b2tTdGFydExvYywgdG9rRW5kTG9jO1xuXG4gIC8vIFRoZSB0eXBlIGFuZCB2YWx1ZSBvZiB0aGUgY3VycmVudCB0b2tlbi4gVG9rZW4gdHlwZXMgYXJlIG9iamVjdHMsXG4gIC8vIG5hbWVkIGJ5IHZhcmlhYmxlcyBhZ2FpbnN0IHdoaWNoIHRoZXkgY2FuIGJlIGNvbXBhcmVkLCBhbmRcbiAgLy8gaG9sZGluZyBwcm9wZXJ0aWVzIHRoYXQgZGVzY3JpYmUgdGhlbSAoaW5kaWNhdGluZywgZm9yIGV4YW1wbGUsXG4gIC8vIHRoZSBwcmVjZWRlbmNlIG9mIGFuIGluZml4IG9wZXJhdG9yLCBhbmQgdGhlIG9yaWdpbmFsIG5hbWUgb2YgYVxuICAvLyBrZXl3b3JkIHRva2VuKS4gVGhlIGtpbmQgb2YgdmFsdWUgdGhhdCdzIGhlbGQgaW4gYHRva1ZhbGAgZGVwZW5kc1xuICAvLyBvbiB0aGUgdHlwZSBvZiB0aGUgdG9rZW4uIEZvciBsaXRlcmFscywgaXQgaXMgdGhlIGxpdGVyYWwgdmFsdWUsXG4gIC8vIGZvciBvcGVyYXRvcnMsIHRoZSBvcGVyYXRvciBuYW1lLCBhbmQgc28gb24uXG5cbiAgdmFyIHRva1R5cGUsIHRva1ZhbDtcblxuICAvLyBJbnRlcmFsIHN0YXRlIGZvciB0aGUgdG9rZW5pemVyLiBUbyBkaXN0aW5ndWlzaCBiZXR3ZWVuIGRpdmlzaW9uXG4gIC8vIG9wZXJhdG9ycyBhbmQgcmVndWxhciBleHByZXNzaW9ucywgaXQgcmVtZW1iZXJzIHdoZXRoZXIgdGhlIGxhc3RcbiAgLy8gdG9rZW4gd2FzIG9uZSB0aGF0IGlzIGFsbG93ZWQgdG8gYmUgZm9sbG93ZWQgYnkgYW4gZXhwcmVzc2lvbi5cbiAgLy8gKElmIGl0IGlzLCBhIHNsYXNoIGlzIHByb2JhYmx5IGEgcmVnZXhwLCBpZiBpdCBpc24ndCBpdCdzIGFcbiAgLy8gZGl2aXNpb24gb3BlcmF0b3IuIFNlZSB0aGUgYHBhcnNlU3RhdGVtZW50YCBmdW5jdGlvbiBmb3IgYVxuICAvLyBjYXZlYXQuKVxuXG4gIHZhciB0b2tSZWdleHBBbGxvd2VkO1xuXG4gIC8vIFdoZW4gYG9wdGlvbnMubG9jYXRpb25zYCBpcyB0cnVlLCB0aGVzZSBhcmUgdXNlZCB0byBrZWVwXG4gIC8vIHRyYWNrIG9mIHRoZSBjdXJyZW50IGxpbmUsIGFuZCBrbm93IHdoZW4gYSBuZXcgbGluZSBoYXMgYmVlblxuICAvLyBlbnRlcmVkLlxuXG4gIHZhciB0b2tDdXJMaW5lLCB0b2tMaW5lU3RhcnQ7XG5cbiAgLy8gVGhlc2Ugc3RvcmUgdGhlIHBvc2l0aW9uIG9mIHRoZSBwcmV2aW91cyB0b2tlbiwgd2hpY2ggaXMgdXNlZnVsXG4gIC8vIHdoZW4gZmluaXNoaW5nIGEgbm9kZSBhbmQgYXNzaWduaW5nIGl0cyBgZW5kYCBwb3NpdGlvbi5cblxuICB2YXIgbGFzdFN0YXJ0LCBsYXN0RW5kLCBsYXN0RW5kTG9jO1xuXG4gIC8vIFRoaXMgaXMgdGhlIHBhcnNlcidzIHN0YXRlLiBgaW5GdW5jdGlvbmAgaXMgdXNlZCB0byByZWplY3RcbiAgLy8gYHJldHVybmAgc3RhdGVtZW50cyBvdXRzaWRlIG9mIGZ1bmN0aW9ucywgYHN0cmljdGAgaW5kaWNhdGVzXG4gIC8vIHdoZXRoZXIgc3RyaWN0IG1vZGUgaXMgb24sIGFuZCBgYnJhY2tldE5lc3RpbmdgIHRyYWNrcyB0aGUgbGV2ZWxcbiAgLy8gb2YgbmVzdGluZyB3aXRoaW4gYnJhY2tldHMgZm9yIGltcGxpY2l0IGxpbnQgY29udGludWF0aW9uLlxuXG4gIHZhciBpbkZ1bmN0aW9uLCBzdHJpY3QsIGJyYWNrZXROZXN0aW5nO1xuXG4gIC8vIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByYWlzZSBleGNlcHRpb25zIG9uIHBhcnNlIGVycm9ycy4gSXRcbiAgLy8gdGFrZXMgYW4gb2Zmc2V0IGludGVnZXIgKGludG8gdGhlIGN1cnJlbnQgYGlucHV0YCkgdG8gaW5kaWNhdGVcbiAgLy8gdGhlIGxvY2F0aW9uIG9mIHRoZSBlcnJvciwgYXR0YWNoZXMgdGhlIHBvc2l0aW9uIHRvIHRoZSBlbmRcbiAgLy8gb2YgdGhlIGVycm9yIG1lc3NhZ2UsIGFuZCB0aGVuIHJhaXNlcyBhIGBTeW50YXhFcnJvcmAgd2l0aCB0aGF0XG4gIC8vIG1lc3NhZ2UuXG5cbiAgZnVuY3Rpb24gcmFpc2UocG9zLCBtZXNzYWdlKSB7XG4gICAgdmFyIGxvYyA9IGdldExpbmVJbmZvKGlucHV0LCBwb3MpO1xuICAgIHZhciBlcnIgPSBuZXcgU3ludGF4RXJyb3IobWVzc2FnZSk7XG4gICAgZXJyLnBvcyA9IHBvczsgZXJyLmxvYyA9IGxvYzsgZXJyLnJhaXNlZEF0ID0gdG9rUG9zO1xuICAgIHRocm93IGVycjtcbiAgfVxuXG4gIC8vIFJldXNlZCBlbXB0eSBhcnJheSBhZGRlZCBmb3Igbm9kZSBmaWVsZHMgdGhhdCBhcmUgYWx3YXlzIGVtcHR5LlxuXG4gIHZhciBlbXB0eSA9IFtdO1xuXG4gIC8vIFVzZWQgZm9yIG5hbWUgY29sbGlzaW9uIGF2b2lkYW5jZSB3aGVuZCBhZGRpbmcgZXh0cmEgQVNUIGlkZW50aWZpZXJzXG5cbiAgdmFyIG5ld0FzdElkQ291bnQgPSAwO1xuXG4gIHZhciBpbmRlbnRIaXN0ID0gZXhwb3J0cy5pbmRlbnRIaXN0ID0ge1xuICAgIC8vIEN1cnJlbnQgaW5kZW50YXRpb24gc3RhY2tcbiAgICBpbmRlbnQ6IFtdLFxuXG4gICAgLy8gTnVtYmVyIG9mIGRlZGVudCB0b2tlbnMgbGVmdCAoaS5lLiBpZiB0b2tUeXBlID09IF9kZWRlbnQsIGRlZGVudENvdW50ID4gMClcbiAgICAvLyBNdWx0aXBsZSBkZWRlbnQgdG9rZW5zIGFyZSByZWFkIGluIGF0IG9uY2UsIGJ1dCBwcm9jZXNzZWQgaW5kaXZpZHVhbGx5IGluIHJlYWRUb2tlbigpXG4gICAgZGVkZW50Q291bnQ6IDAsXG5cbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7IHRoaXMuaW5kZW50ID0gW107IHRoaXMuZGVkZW50Q291bnQgPSAwOyB9LFxuICAgIGNvdW50OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmluZGVudC5sZW5ndGg7IH0sXG4gICAgbGVuOiBmdW5jdGlvbiAoaSkgeyBcbiAgICAgIGlmICh0eXBlb2YgaSA9PT0gJ3VuZGVmaW5lZCcgfHwgaSA+PSB0aGlzLmluZGVudC5sZW5ndGgpIGkgPSB0aGlzLmluZGVudC5sZW5ndGggLSAxO1xuICAgICAgcmV0dXJuIHRoaXMuaW5kZW50W2ldLmxlbmd0aDsgXG4gICAgfSxcbiAgICBpc0luZGVudDogZnVuY3Rpb24ocykge1xuICAgICAgcmV0dXJuIHRoaXMuaW5kZW50Lmxlbmd0aCA9PT0gMCB8fCBzLmxlbmd0aCA+IHRoaXMubGVuKCk7XG4gICAgfSxcbiAgICBpc0RlZGVudDogZnVuY3Rpb24ocykge1xuICAgICAgcmV0dXJuIHRoaXMuaW5kZW50Lmxlbmd0aCA+IDAgJiYgcy5sZW5ndGggPCB0aGlzLmxlbigpO1xuICAgIH0sXG4gICAgYWRkSW5kZW50OiBmdW5jdGlvbiAocykgeyB0aGlzLmluZGVudC5wdXNoKHMpOyB9LFxuICAgIGFkZERlZGVudDogZnVuY3Rpb24gKHMpIHtcbiAgICAgIHRoaXMuZGVkZW50Q291bnQgPSAwO1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMuaW5kZW50Lmxlbmd0aCAtIDE7IGkgPj0gMCAmJiBzLmxlbmd0aCA8IHRoaXMuaW5kZW50W2ldLmxlbmd0aDsgLS1pKVxuICAgICAgICArK3RoaXMuZGVkZW50Q291bnQ7XG4gICAgfSxcbiAgICB1cGRhdGVEZWRlbnQ6IGZ1bmN0aW9uICgpIHsgdGhpcy5kZWRlbnRDb3VudCA9IHRoaXMuY291bnQoKTsgfSxcbiAgICBwb3A6IGZ1bmN0aW9uICgpIHtcbiAgICAgIC0tdGhpcy5kZWRlbnRDb3VudDtcbiAgICAgIHRoaXMuaW5kZW50LnBvcCgpO1xuICAgIH0sXG4gICAgdW5kb0luZGVudDogZnVuY3Rpb24gKCkgeyB0aGlzLnBvcCgpOyB9XG4gIH07XG5cbiAgLy8gIyMgU2NvcGVcblxuICAvLyBDb2xsZWN0aW9uIG9mIG5hbWVzcGFjZXMgc2F2ZWQgYXMgYSBzdGFja1xuICAvLyBBIG5hbWVzcGFjZSBpcyBhIG1hcHBpbmcgb2YgaWRlbnRpZmllcnMgdG8gMyB0eXBlczogdmFyaWFibGVzLCBmdW5jdGlvbnMsIGNsYXNzZXNcbiAgLy8gQSBuYW1lc3BhY2UgYWxzbyBrbm93cyB3aGV0aGVyIGl0IGlzIGZvciBnbG9iYWwsIGNsYXNzLCBvciBmdW5jdGlvblxuICAvLyBBIG5ldyBuYW1lc3BhY2UgaXMgcHVzaGVkIGF0IGZ1bmN0aW9uIGFuZCBjbGFzcyBzdGFydCwgYW5kIHBvcHBlZCBhdCB0aGVpciBlbmRcbiAgLy8gU3RhcnRzIHdpdGggYSBnbG9iYWwgbmFtZXNwYWNlIG9uIHRoZSBzdGFja1xuICAvLyBFLmcuIHNjb3BlLm5hbWVzcGFjZXMgfiBbe3R5cGU6ICdnJywgbWFwOnt4OiAndicsIE15Q2xhc3M6ICdjJ30gfSwgLi4uXVxuXG4gIC8vIFRPRE86IE5vdCB0cmFja2luZyBidWlsdC1pbiBuYW1lc3BhY2VcbiAgXG4gIHZhciBzY29wZSA9IGV4cG9ydHMuc2NvcGUgPSB7XG4gICAgbmFtZXNwYWNlczogW10sXG4gICAgaW5pdDogZnVuY3Rpb24gKCkgeyB0aGlzLm5hbWVzcGFjZXMgPSBbeyB0eXBlOiAnZycsIG1hcDoge30gfV07IH0sXG4gICAgY3VycmVudDogZnVuY3Rpb24ob2Zmc2V0KSB7IFxuICAgICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7XG4gICAgICByZXR1cm4gdGhpcy5uYW1lc3BhY2VzW3RoaXMubmFtZXNwYWNlcy5sZW5ndGggLSBvZmZzZXQgLSAxXTtcbiAgICB9LFxuICAgIHN0YXJ0Q2xhc3M6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgdGhpcy5jdXJyZW50KCkubWFwW2lkXSA9ICdjJztcbiAgICAgIHRoaXMubmFtZXNwYWNlcy5wdXNoKHsgdHlwZTogJ2MnLCBtYXA6IHt9LCBjbGFzc05hbWU6IGlkIH0pO1xuICAgIH0sXG4gICAgc3RhcnRGbjogZnVuY3Rpb24gKGlkKSB7XG4gICAgICB0aGlzLmN1cnJlbnQoKS5tYXBbaWRdID0gJ2YnO1xuICAgICAgdGhpcy5uYW1lc3BhY2VzLnB1c2goeyB0eXBlOiAnZicsIG1hcDoge30sIGZuTmFtZTogaWQgfSk7XG4gICAgfSxcbiAgICBlbmQ6IGZ1bmN0aW9uICgpIHsgdGhpcy5uYW1lc3BhY2VzLnBvcCgpOyB9LFxuICAgIGFkZFZhcjogZnVuY3Rpb24gKGlkKSB7IHRoaXMuY3VycmVudCgpLm1hcFtpZF0gPSAndic7IH0sXG4gICAgZXhpc3RzOiBmdW5jdGlvbiAoaWQpIHsgcmV0dXJuIHRoaXMuY3VycmVudCgpLm1hcC5oYXNPd25Qcm9wZXJ0eShpZCk7IH0sXG4gICAgaXNDbGFzczogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5jdXJyZW50KCkudHlwZSA9PT0gJ2MnOyB9LFxuICAgIGlzVXNlckZ1bmN0aW9uOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAvLyBMb29zZSBtYXRjaCAoaS5lLiBvcmRlciBpZ25vcmVkKVxuICAgICAgLy8gVE9ETzogZG9lcyBub3QgaWRlbnRpZnkgdXNlci1kZWZpbmVkIGNsYXNzIG1ldGhvZHNcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLm5hbWVzcGFjZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pXG4gICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLm5hbWVzcGFjZXNbaV0ubWFwKVxuICAgICAgICAgIGlmIChrZXkgPT09IG5hbWUgJiYgdGhpcy5uYW1lc3BhY2VzW2ldLm1hcFtrZXldID09PSAnZicpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuICAgIGlzUGFyZW50Q2xhc3M6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5jdXJyZW50KDEpLnR5cGUgPT09ICdjJzsgfSxcbiAgICBpc05ld09iajogZnVuY3Rpb24gKGlkKSB7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy5uYW1lc3BhY2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKVxuICAgICAgICBpZiAodGhpcy5uYW1lc3BhY2VzW2ldLm1hcFtpZF0gPT09ICdjJykgcmV0dXJuIHRydWU7XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubmFtZXNwYWNlc1tpXS5tYXBbaWRdID09PSAnZicpIGJyZWFrO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgZ2V0UGFyZW50Q2xhc3NOYW1lOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmN1cnJlbnQoMSkuY2xhc3NOYW1lOyB9LFxuICAgIGdldFRoaXNSZXBsYWNlOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmN1cnJlbnQoKS50aGlzUmVwbGFjZTsgfSxcbiAgICBzZXRUaGlzUmVwbGFjZTogZnVuY3Rpb24gKHMpIHsgdGhpcy5jdXJyZW50KCkudGhpc1JlcGxhY2UgPSBzOyB9XG4gIH07XG4gIFxuXG4gIC8vICMjIFRva2VuIHR5cGVzXG5cbiAgLy8gVGhlIGFzc2lnbm1lbnQgb2YgZmluZS1ncmFpbmVkLCBpbmZvcm1hdGlvbi1jYXJyeWluZyB0eXBlIG9iamVjdHNcbiAgLy8gYWxsb3dzIHRoZSB0b2tlbml6ZXIgdG8gc3RvcmUgdGhlIGluZm9ybWF0aW9uIGl0IGhhcyBhYm91dCBhXG4gIC8vIHRva2VuIGluIGEgd2F5IHRoYXQgaXMgdmVyeSBjaGVhcCBmb3IgdGhlIHBhcnNlciB0byBsb29rIHVwLlxuXG4gIC8vIEFsbCB0b2tlbiB0eXBlIHZhcmlhYmxlcyBzdGFydCB3aXRoIGFuIHVuZGVyc2NvcmUsIHRvIG1ha2UgdGhlbVxuICAvLyBlYXN5IHRvIHJlY29nbml6ZS5cblxuICAvLyBUaGVzZSBhcmUgdGhlIGdlbmVyYWwgdHlwZXMuIFRoZSBgdHlwZWAgcHJvcGVydHkgaXMgb25seSB1c2VkIHRvXG4gIC8vIG1ha2UgdGhlbSByZWNvZ25pemVhYmxlIHdoZW4gZGVidWdnaW5nLlxuXG4gIHZhciBfbnVtID0ge3R5cGU6IFwibnVtXCJ9LCBfcmVnZXhwID0ge3R5cGU6IFwicmVnZXhwXCJ9LCBfc3RyaW5nID0ge3R5cGU6IFwic3RyaW5nXCJ9O1xuICB2YXIgX25hbWUgPSB7dHlwZTogXCJuYW1lXCJ9LCBfZW9mID0ge3R5cGU6IFwiZW9mXCJ9O1xuICB2YXIgX25ld2xpbmUgPSB7dHlwZTogXCJuZXdsaW5lXCJ9LCBfaW5kZW50ID0ge3R5cGU6IFwiaW5kZW50XCJ9LCBfZGVkZW50ID0ge3R5cGU6IFwiZGVkZW50XCJ9O1xuXG4gIC8vIEtleXdvcmQgdG9rZW5zLiBUaGUgYGtleXdvcmRgIHByb3BlcnR5IChhbHNvIHVzZWQgaW4ga2V5d29yZC1saWtlXG4gIC8vIG9wZXJhdG9ycykgaW5kaWNhdGVzIHRoYXQgdGhlIHRva2VuIG9yaWdpbmF0ZWQgZnJvbSBhblxuICAvLyBpZGVudGlmaWVyLWxpa2Ugd29yZCwgd2hpY2ggaXMgdXNlZCB3aGVuIHBhcnNpbmcgcHJvcGVydHkgbmFtZXMuXG4gIC8vXG4gIC8vIFRoZSBgYmVmb3JlRXhwcmAgcHJvcGVydHkgaXMgdXNlZCB0byBkaXNhbWJpZ3VhdGUgYmV0d2VlbiByZWd1bGFyXG4gIC8vIGV4cHJlc3Npb25zIGFuZCBkaXZpc2lvbnMuIEl0IGlzIHNldCBvbiBhbGwgdG9rZW4gdHlwZXMgdGhhdCBjYW5cbiAgLy8gYmUgZm9sbG93ZWQgYnkgYW4gZXhwcmVzc2lvbiAodGh1cywgYSBzbGFzaCBhZnRlciB0aGVtIHdvdWxkIGJlIGFcbiAgLy8gcmVndWxhciBleHByZXNzaW9uKS5cbiAgXG4gIHZhciBfZGljdCA9IHsga2V5d29yZDogXCJkaWN0XCIgfTsgIC8vIFRPRE86IG5vdCBhIGtleXdvcmRcbiAgdmFyIF9hcyA9IHsga2V5d29yZDogXCJhc1wiIH0sIF9hc3NlcnQgPSB7IGtleXdvcmQ6IFwiYXNzZXJ0XCIgfSwgX2JyZWFrID0geyBrZXl3b3JkOiBcImJyZWFrXCIgfTtcbiAgdmFyIF9jbGFzcyA9IHsga2V5d29yZDogXCJjbGFzc1wiIH0sIF9jb250aW51ZSA9IHsga2V5d29yZDogXCJjb250aW51ZVwiIH07XG4gIHZhciBfZGVmID0geyBrZXl3b3JkOiBcImRlZlwiIH0sIF9kZWwgPSB7IGtleXdvcmQ6IFwiZGVsXCIgfTtcbiAgdmFyIF9lbGlmID0geyBrZXl3b3JkOiBcImVsaWZcIiwgYmVmb3JlRXhwcjogdHJ1ZSB9LCBfZWxzZSA9IHsga2V5d29yZDogXCJlbHNlXCIsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9leGNlcHQgPSB7IGtleXdvcmQ6IFwiZXhjZXB0XCIsIGJlZm9yZUV4cHI6IHRydWUgfSwgX2ZpbmFsbHkgPSB7a2V5d29yZDogXCJmaW5hbGx5XCJ9O1xuICB2YXIgX2ZvciA9IHsga2V5d29yZDogXCJmb3JcIiB9LCBfZnJvbSA9IHsga2V5d29yZDogXCJmcm9tXCIgfSwgX2dsb2JhbCA9IHsga2V5d29yZDogXCJnbG9iYWxcIiB9O1xuICB2YXIgX2lmID0geyBrZXl3b3JkOiBcImlmXCIgfSwgX2ltcG9ydCA9IHsga2V5d29yZDogXCJpbXBvcnRcIiB9O1xuICB2YXIgX2xhbWJkYSA9IHtrZXl3b3JkOiBcImxhbWJkYVwifSwgX25vbmxvY2FsID0ge2tleXdvcmQ6IFwibm9ubG9jYWxcIn07XG4gIHZhciBfcGFzcyA9IHsga2V5d29yZDogXCJwYXNzXCIgfSwgX3JhaXNlID0ge2tleXdvcmQ6IFwicmFpc2VcIn07XG4gIHZhciBfcmV0dXJuID0geyBrZXl3b3JkOiBcInJldHVyblwiLCBiZWZvcmVFeHByOiB0cnVlIH0sIF90cnkgPSB7IGtleXdvcmQ6IFwidHJ5XCIgfTtcbiAgdmFyIF93aGlsZSA9IHtrZXl3b3JkOiBcIndoaWxlXCJ9LCBfd2l0aCA9IHtrZXl3b3JkOiBcIndpdGhcIn0sIF95aWVsZCA9IHtrZXl3b3JkOiBcInlpZWxkXCJ9O1xuXG4gIC8vIFRoZSBrZXl3b3JkcyB0aGF0IGRlbm90ZSB2YWx1ZXMuXG5cbiAgdmFyIF9ub25lID0ge2tleXdvcmQ6IFwiTm9uZVwiLCBhdG9tVmFsdWU6IG51bGx9LCBfdHJ1ZSA9IHtrZXl3b3JkOiBcIlRydWVcIiwgYXRvbVZhbHVlOiB0cnVlfTtcbiAgdmFyIF9mYWxzZSA9IHtrZXl3b3JkOiBcIkZhbHNlXCIsIGF0b21WYWx1ZTogZmFsc2V9O1xuXG4gIC8vIFNvbWUga2V5d29yZHMgYXJlIHRyZWF0ZWQgYXMgcmVndWxhciBvcGVyYXRvcnMuIGBpbmAgc29tZXRpbWVzXG4gIC8vICh3aGVuIHBhcnNpbmcgYGZvcmApIG5lZWRzIHRvIGJlIHRlc3RlZCBhZ2FpbnN0IHNwZWNpZmljYWxseSwgc29cbiAgLy8gd2UgYXNzaWduIGEgdmFyaWFibGUgbmFtZSB0byBpdCBmb3IgcXVpY2sgY29tcGFyaW5nLlxuICAvLyAncHJlYycgaXMgdGhlIG9wZXJhdG9yIHByZWNlZGVuY2UnXG5cbiAgdmFyIF9vciA9IHsga2V5d29yZDogXCJvclwiLCBwcmVjOiAxLCBiZWZvcmVFeHByOiB0cnVlLCByZXA6IFwifHxcIiB9O1xuICB2YXIgX2FuZCA9IHsga2V5d29yZDogXCJhbmRcIiwgcHJlYzogMiwgYmVmb3JlRXhwcjogdHJ1ZSwgcmVwOiBcIiYmXCIgfTtcbiAgdmFyIF9ub3QgPSB7IGtleXdvcmQ6IFwibm90XCIsIHByZWM6IDMsIHByZWZpeDogdHJ1ZSwgYmVmb3JlRXhwcjogdHJ1ZSwgcmVwOiBcIiFcIiB9O1xuICB2YXIgX2luID0geyBrZXl3b3JkOiBcImluXCIsIHByZWM6IDQsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9pcyA9IHsga2V5d29yZDogXCJpc1wiLCBwcmVjOiA0LCBiZWZvcmVFeHByOiB0cnVlIH07XG5cbiAgLy8gTWFwIGtleXdvcmQgbmFtZXMgdG8gdG9rZW4gdHlwZXMuXG5cbiAgdmFyIGtleXdvcmRUeXBlcyA9IHtcbiAgICBcImRpY3RcIjogX2RpY3QsXG4gICAgXCJGYWxzZVwiOiBfZmFsc2UsIFwiTm9uZVwiOiBfbm9uZSwgXCJUcnVlXCI6IF90cnVlLCBcImFuZFwiOiBfYW5kLCBcImFzXCI6IF9hcywgXG4gICAgXCJicmVha1wiOiBfYnJlYWssIFwiY2xhc3NcIjogX2NsYXNzLCBcImNvbnRpbnVlXCI6IF9jb250aW51ZSwgXCJkZWZcIjogX2RlZiwgXCJkZWxcIjogX2RlbCxcbiAgICBcImVsaWZcIjogX2VsaWYsIFwiZWxzZVwiOiBfZWxzZSwgXCJleGNlcHRcIjogX2V4Y2VwdCwgXCJmaW5hbGx5XCI6IF9maW5hbGx5LCBcImZvclwiOiBfZm9yLFxuICAgIFwiZnJvbVwiOiBfZnJvbSwgXCJnbG9iYWxcIjogX2dsb2JhbCwgXCJpZlwiOiBfaWYsIFwiaW1wb3J0XCI6IF9pbXBvcnQsIFwiaW5cIjogX2luLCBcImlzXCI6IF9pcywgXG4gICAgXCJsYW1iZGFcIjogX2xhbWJkYSwgXCJub25sb2NhbFwiOiBfbm9ubG9jYWwsIFwibm90XCI6IF9ub3QsIFwib3JcIjogX29yLCBcbiAgICBcInBhc3NcIjogX3Bhc3MsIFwicmFpc2VcIjogX3JhaXNlLCBcInJldHVyblwiOiBfcmV0dXJuLCBcInRyeVwiOiBfdHJ5LCBcIndoaWxlXCI6IF93aGlsZSwgXG4gICAgXCJ3aXRoXCI6IF93aXRoLCBcInlpZWxkXCI6IF95aWVsZFxuICB9O1xuXG4gIC8vIFB1bmN0dWF0aW9uIHRva2VuIHR5cGVzLiBBZ2FpbiwgdGhlIGB0eXBlYCBwcm9wZXJ0eSBpcyBwdXJlbHkgZm9yIGRlYnVnZ2luZy5cblxuICB2YXIgX2JyYWNrZXRMID0ge3R5cGU6IFwiW1wiLCBiZWZvcmVFeHByOiB0cnVlfSwgX2JyYWNrZXRSID0ge3R5cGU6IFwiXVwifSwgX2JyYWNlTCA9IHt0eXBlOiBcIntcIiwgYmVmb3JlRXhwcjogdHJ1ZX07XG4gIHZhciBfYnJhY2VSID0ge3R5cGU6IFwifVwifSwgX3BhcmVuTCA9IHt0eXBlOiBcIihcIiwgYmVmb3JlRXhwcjogdHJ1ZX0sIF9wYXJlblIgPSB7dHlwZTogXCIpXCJ9O1xuICB2YXIgX2NvbW1hID0ge3R5cGU6IFwiLFwiLCBiZWZvcmVFeHByOiB0cnVlfSwgX3NlbWkgPSB7dHlwZTogXCI7XCIsIGJlZm9yZUV4cHI6IHRydWV9O1xuICB2YXIgX2NvbG9uID0geyB0eXBlOiBcIjpcIiwgYmVmb3JlRXhwcjogdHJ1ZSB9LCBfZG90ID0geyB0eXBlOiBcIi5cIiB9LCBfcXVlc3Rpb24gPSB7IHR5cGU6IFwiP1wiLCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIFxuICAvLyBPcGVyYXRvcnMuIFRoZXNlIGNhcnJ5IHNldmVyYWwga2luZHMgb2YgcHJvcGVydGllcyB0byBoZWxwIHRoZVxuICAvLyBwYXJzZXIgdXNlIHRoZW0gcHJvcGVybHkgKHRoZSBwcmVzZW5jZSBvZiB0aGVzZSBwcm9wZXJ0aWVzIGlzXG4gIC8vIHdoYXQgY2F0ZWdvcml6ZXMgdGhlbSBhcyBvcGVyYXRvcnMpLlxuICAvL1xuICAvLyBgcHJlY2Agc3BlY2lmaWVzIHRoZSBwcmVjZWRlbmNlIG9mIHRoaXMgb3BlcmF0b3IuXG4gIC8vXG4gIC8vIGBwcmVmaXhgIG1hcmtzIHRoZSBvcGVyYXRvciBhcyBhIHByZWZpeCB1bmFyeSBvcGVyYXRvci4gXG4gIC8vXG4gIC8vIGBpc0Fzc2lnbmAgbWFya3MgYWxsIG9mIGA9YCwgYCs9YCwgYC09YCBldGNldGVyYSwgd2hpY2ggYWN0IGFzXG4gIC8vIGJpbmFyeSBvcGVyYXRvcnMgd2l0aCBhIHZlcnkgbG93IHByZWNlZGVuY2UsIHRoYXQgc2hvdWxkIHJlc3VsdFxuICAvLyBpbiBBc3NpZ25tZW50RXhwcmVzc2lvbiBub2Rlcy5cblxuICB2YXIgX3NsYXNoID0geyBwcmVjOiAxMCwgYmVmb3JlRXhwcjogdHJ1ZSB9LCBfZXEgPSB7IGlzQXNzaWduOiB0cnVlLCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfYXNzaWduID0ge2lzQXNzaWduOiB0cnVlLCBiZWZvcmVFeHByOiB0cnVlfTtcbiAgdmFyIF9lcXVhbGl0eSA9IHsgcHJlYzogNCwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuICB2YXIgX3JlbGF0aW9uYWwgPSB7cHJlYzogNCwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuICB2YXIgX2JpdHdpc2VPUiA9IHsgcHJlYzogNSwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuICB2YXIgX2JpdHdpc2VYT1IgPSB7IHByZWM6IDYsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9iaXR3aXNlQU5EID0geyBwcmVjOiA3LCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfYml0U2hpZnQgPSB7IHByZWM6IDgsIGJlZm9yZUV4cHI6IHRydWUgfTtcbiAgdmFyIF9wbHVzTWluID0geyBwcmVjOiA5LCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfbXVsdGlwbHlNb2R1bG8gPSB7IHByZWM6IDEwLCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfZmxvb3JEaXYgPSB7IHByZWM6IDEwLCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfcG9zTmVnTm90ID0geyBwcmVjOiAxMSwgcHJlZml4OiB0cnVlLCBiZWZvcmVFeHByOiB0cnVlIH07XG4gIHZhciBfYml0d2lzZU5PVCA9IHsgcHJlYzogMTEsIHByZWZpeDogdHJ1ZSwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuICB2YXIgX2V4cG9uZW50aWF0aW9uID0geyBwcmVjOiAxMiwgYmVmb3JlRXhwcjogdHJ1ZSB9O1xuXG4gIC8vIFByb3ZpZGUgYWNjZXNzIHRvIHRoZSB0b2tlbiB0eXBlcyBmb3IgZXh0ZXJuYWwgdXNlcnMgb2YgdGhlXG4gIC8vIHRva2VuaXplci5cblxuICBleHBvcnRzLnRva1R5cGVzID0ge2JyYWNrZXRMOiBfYnJhY2tldEwsIGJyYWNrZXRSOiBfYnJhY2tldFIsIGJyYWNlTDogX2JyYWNlTCwgYnJhY2VSOiBfYnJhY2VSLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcmVuTDogX3BhcmVuTCwgcGFyZW5SOiBfcGFyZW5SLCBjb21tYTogX2NvbW1hLCBzZW1pOiBfc2VtaSwgY29sb246IF9jb2xvbixcbiAgICAgICAgICAgICAgICAgICAgICBkb3Q6IF9kb3QsIHF1ZXN0aW9uOiBfcXVlc3Rpb24sIHNsYXNoOiBfc2xhc2gsIGVxOiBfZXEsIG5hbWU6IF9uYW1lLCBlb2Y6IF9lb2YsXG4gICAgICAgICAgICAgICAgICAgICAgbnVtOiBfbnVtLCByZWdleHA6IF9yZWdleHAsIHN0cmluZzogX3N0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICBuZXdsaW5lOiBfbmV3bGluZSwgaW5kZW50OiBfaW5kZW50LCBkZWRlbnQ6IF9kZWRlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgZXhwb25lbnRpYXRpb246IF9leHBvbmVudGlhdGlvbiwgZmxvb3JEaXY6IF9mbG9vckRpdiwgcGx1c01pbjogX3BsdXNNaW4sXG4gICAgICAgICAgICAgICAgICAgICAgcG9zTmVnTm90OiBfcG9zTmVnTm90LCBtdWx0aXBseU1vZHVsbzogX211bHRpcGx5TW9kdWxvXG4gIH07XG4gIGZvciAodmFyIGt3IGluIGtleXdvcmRUeXBlcykgZXhwb3J0cy50b2tUeXBlc1tcIl9cIiArIGt3XSA9IGtleXdvcmRUeXBlc1trd107XG5cbiAgLy8gVGhpcyBpcyBhIHRyaWNrIHRha2VuIGZyb20gRXNwcmltYS4gSXQgdHVybnMgb3V0IHRoYXQsIG9uXG4gIC8vIG5vbi1DaHJvbWUgYnJvd3NlcnMsIHRvIGNoZWNrIHdoZXRoZXIgYSBzdHJpbmcgaXMgaW4gYSBzZXQsIGFcbiAgLy8gcHJlZGljYXRlIGNvbnRhaW5pbmcgYSBiaWcgdWdseSBgc3dpdGNoYCBzdGF0ZW1lbnQgaXMgZmFzdGVyIHRoYW5cbiAgLy8gYSByZWd1bGFyIGV4cHJlc3Npb24sIGFuZCBvbiBDaHJvbWUgdGhlIHR3byBhcmUgYWJvdXQgb24gcGFyLlxuICAvLyBUaGlzIGZ1bmN0aW9uIHVzZXMgYGV2YWxgIChub24tbGV4aWNhbCkgdG8gcHJvZHVjZSBzdWNoIGFcbiAgLy8gcHJlZGljYXRlIGZyb20gYSBzcGFjZS1zZXBhcmF0ZWQgc3RyaW5nIG9mIHdvcmRzLlxuICAvL1xuICAvLyBJdCBzdGFydHMgYnkgc29ydGluZyB0aGUgd29yZHMgYnkgbGVuZ3RoLlxuXG4gIGZ1bmN0aW9uIG1ha2VQcmVkaWNhdGUod29yZHMpIHtcbiAgICB3b3JkcyA9IHdvcmRzLnNwbGl0KFwiIFwiKTtcbiAgICB2YXIgZiA9IFwiXCIsIGNhdHMgPSBbXTtcbiAgICBvdXQ6IGZvciAodmFyIGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoOyArK2kpIHtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY2F0cy5sZW5ndGg7ICsrailcbiAgICAgICAgaWYgKGNhdHNbal1bMF0ubGVuZ3RoID09IHdvcmRzW2ldLmxlbmd0aCkge1xuICAgICAgICAgIGNhdHNbal0ucHVzaCh3b3Jkc1tpXSk7XG4gICAgICAgICAgY29udGludWUgb3V0O1xuICAgICAgICB9XG4gICAgICBjYXRzLnB1c2goW3dvcmRzW2ldXSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNvbXBhcmVUbyhhcnIpIHtcbiAgICAgIGlmIChhcnIubGVuZ3RoID09IDEpIHJldHVybiBmICs9IFwicmV0dXJuIHN0ciA9PT0gXCIgKyBKU09OLnN0cmluZ2lmeShhcnJbMF0pICsgXCI7XCI7XG4gICAgICBmICs9IFwic3dpdGNoKHN0cil7XCI7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkgZiArPSBcImNhc2UgXCIgKyBKU09OLnN0cmluZ2lmeShhcnJbaV0pICsgXCI6XCI7XG4gICAgICBmICs9IFwicmV0dXJuIHRydWV9cmV0dXJuIGZhbHNlO1wiO1xuICAgIH1cblxuICAgIC8vIFdoZW4gdGhlcmUgYXJlIG1vcmUgdGhhbiB0aHJlZSBsZW5ndGggY2F0ZWdvcmllcywgYW4gb3V0ZXJcbiAgICAvLyBzd2l0Y2ggZmlyc3QgZGlzcGF0Y2hlcyBvbiB0aGUgbGVuZ3RocywgdG8gc2F2ZSBvbiBjb21wYXJpc29ucy5cblxuICAgIGlmIChjYXRzLmxlbmd0aCA+IDMpIHtcbiAgICAgIGNhdHMuc29ydChmdW5jdGlvbihhLCBiKSB7cmV0dXJuIGIubGVuZ3RoIC0gYS5sZW5ndGg7fSk7XG4gICAgICBmICs9IFwic3dpdGNoKHN0ci5sZW5ndGgpe1wiO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYXRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBjYXQgPSBjYXRzW2ldO1xuICAgICAgICBmICs9IFwiY2FzZSBcIiArIGNhdFswXS5sZW5ndGggKyBcIjpcIjtcbiAgICAgICAgY29tcGFyZVRvKGNhdCk7XG4gICAgICB9XG4gICAgICBmICs9IFwifVwiO1xuXG4gICAgICAvLyBPdGhlcndpc2UsIHNpbXBseSBnZW5lcmF0ZSBhIGZsYXQgYHN3aXRjaGAgc3RhdGVtZW50LlxuXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbXBhcmVUbyh3b3Jkcyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgRnVuY3Rpb24oXCJzdHJcIiwgZik7XG4gIH1cblxuICAvLyBUaGUgZm9yYmlkZGVuIHZhcmlhYmxlIG5hbWVzXG5cbiAgdmFyIGlzU3RyaWN0QmFkSWRXb3JkID0gbWFrZVByZWRpY2F0ZShcImV2YWwgYXJndW1lbnRzXCIpO1xuXG4gIC8vIEtleXdvcmRzXG4gIC8vIFRPRE86IGRpY3QgaXNuJ3QgYSBrZXl3b3JkLCBpdCdzIGEgYnVpbHRpblxuXG4gIHZhciBpc0tleXdvcmQgPSBtYWtlUHJlZGljYXRlKFwiZGljdCBGYWxzZSBOb25lIFRydWUgYW5kIGFzIGFzc2VydCBicmVhayBjbGFzcyBjb250aW51ZSBkZWYgZGVsIGVsaWYgZWxzZSBleGNlcHQgZmluYWxseSBmb3IgZnJvbSBnbG9iYWwgaWYgaW1wb3J0IGluIGlzIGxhbWJkYSBub25sb2NhbCBub3Qgb3IgcGFzcyByYWlzZSByZXR1cm4gdHJ5IHdoaWxlIHdpdGggeWllbGRcIik7XG5cbiAgLy8gIyMgQ2hhcmFjdGVyIGNhdGVnb3JpZXNcblxuICAvLyBCaWcgdWdseSByZWd1bGFyIGV4cHJlc3Npb25zIHRoYXQgbWF0Y2ggY2hhcmFjdGVycyBpbiB0aGVcbiAgLy8gd2hpdGVzcGFjZSwgaWRlbnRpZmllciwgYW5kIGlkZW50aWZpZXItc3RhcnQgY2F0ZWdvcmllcy4gVGhlc2VcbiAgLy8gYXJlIG9ubHkgYXBwbGllZCB3aGVuIGEgY2hhcmFjdGVyIGlzIGZvdW5kIHRvIGFjdHVhbGx5IGhhdmUgYVxuICAvLyBjb2RlIHBvaW50IGFib3ZlIDEyOC5cblxuICB2YXIgbm9uQVNDSUl3aGl0ZXNwYWNlID0gL1tcXHUxNjgwXFx1MTgwZVxcdTIwMDAtXFx1MjAwYVxcdTIwMmZcXHUyMDVmXFx1MzAwMFxcdWZlZmZdLztcbiAgdmFyIG5vbkFTQ0lJaWRlbnRpZmllclN0YXJ0Q2hhcnMgPSBcIlxceGFhXFx4YjVcXHhiYVxceGMwLVxceGQ2XFx4ZDgtXFx4ZjZcXHhmOC1cXHUwMmMxXFx1MDJjNi1cXHUwMmQxXFx1MDJlMC1cXHUwMmU0XFx1MDJlY1xcdTAyZWVcXHUwMzcwLVxcdTAzNzRcXHUwMzc2XFx1MDM3N1xcdTAzN2EtXFx1MDM3ZFxcdTAzODZcXHUwMzg4LVxcdTAzOGFcXHUwMzhjXFx1MDM4ZS1cXHUwM2ExXFx1MDNhMy1cXHUwM2Y1XFx1MDNmNy1cXHUwNDgxXFx1MDQ4YS1cXHUwNTI3XFx1MDUzMS1cXHUwNTU2XFx1MDU1OVxcdTA1NjEtXFx1MDU4N1xcdTA1ZDAtXFx1MDVlYVxcdTA1ZjAtXFx1MDVmMlxcdTA2MjAtXFx1MDY0YVxcdTA2NmVcXHUwNjZmXFx1MDY3MS1cXHUwNmQzXFx1MDZkNVxcdTA2ZTVcXHUwNmU2XFx1MDZlZVxcdTA2ZWZcXHUwNmZhLVxcdTA2ZmNcXHUwNmZmXFx1MDcxMFxcdTA3MTItXFx1MDcyZlxcdTA3NGQtXFx1MDdhNVxcdTA3YjFcXHUwN2NhLVxcdTA3ZWFcXHUwN2Y0XFx1MDdmNVxcdTA3ZmFcXHUwODAwLVxcdTA4MTVcXHUwODFhXFx1MDgyNFxcdTA4MjhcXHUwODQwLVxcdTA4NThcXHUwOGEwXFx1MDhhMi1cXHUwOGFjXFx1MDkwNC1cXHUwOTM5XFx1MDkzZFxcdTA5NTBcXHUwOTU4LVxcdTA5NjFcXHUwOTcxLVxcdTA5NzdcXHUwOTc5LVxcdTA5N2ZcXHUwOTg1LVxcdTA5OGNcXHUwOThmXFx1MDk5MFxcdTA5OTMtXFx1MDlhOFxcdTA5YWEtXFx1MDliMFxcdTA5YjJcXHUwOWI2LVxcdTA5YjlcXHUwOWJkXFx1MDljZVxcdTA5ZGNcXHUwOWRkXFx1MDlkZi1cXHUwOWUxXFx1MDlmMFxcdTA5ZjFcXHUwYTA1LVxcdTBhMGFcXHUwYTBmXFx1MGExMFxcdTBhMTMtXFx1MGEyOFxcdTBhMmEtXFx1MGEzMFxcdTBhMzJcXHUwYTMzXFx1MGEzNVxcdTBhMzZcXHUwYTM4XFx1MGEzOVxcdTBhNTktXFx1MGE1Y1xcdTBhNWVcXHUwYTcyLVxcdTBhNzRcXHUwYTg1LVxcdTBhOGRcXHUwYThmLVxcdTBhOTFcXHUwYTkzLVxcdTBhYThcXHUwYWFhLVxcdTBhYjBcXHUwYWIyXFx1MGFiM1xcdTBhYjUtXFx1MGFiOVxcdTBhYmRcXHUwYWQwXFx1MGFlMFxcdTBhZTFcXHUwYjA1LVxcdTBiMGNcXHUwYjBmXFx1MGIxMFxcdTBiMTMtXFx1MGIyOFxcdTBiMmEtXFx1MGIzMFxcdTBiMzJcXHUwYjMzXFx1MGIzNS1cXHUwYjM5XFx1MGIzZFxcdTBiNWNcXHUwYjVkXFx1MGI1Zi1cXHUwYjYxXFx1MGI3MVxcdTBiODNcXHUwYjg1LVxcdTBiOGFcXHUwYjhlLVxcdTBiOTBcXHUwYjkyLVxcdTBiOTVcXHUwYjk5XFx1MGI5YVxcdTBiOWNcXHUwYjllXFx1MGI5ZlxcdTBiYTNcXHUwYmE0XFx1MGJhOC1cXHUwYmFhXFx1MGJhZS1cXHUwYmI5XFx1MGJkMFxcdTBjMDUtXFx1MGMwY1xcdTBjMGUtXFx1MGMxMFxcdTBjMTItXFx1MGMyOFxcdTBjMmEtXFx1MGMzM1xcdTBjMzUtXFx1MGMzOVxcdTBjM2RcXHUwYzU4XFx1MGM1OVxcdTBjNjBcXHUwYzYxXFx1MGM4NS1cXHUwYzhjXFx1MGM4ZS1cXHUwYzkwXFx1MGM5Mi1cXHUwY2E4XFx1MGNhYS1cXHUwY2IzXFx1MGNiNS1cXHUwY2I5XFx1MGNiZFxcdTBjZGVcXHUwY2UwXFx1MGNlMVxcdTBjZjFcXHUwY2YyXFx1MGQwNS1cXHUwZDBjXFx1MGQwZS1cXHUwZDEwXFx1MGQxMi1cXHUwZDNhXFx1MGQzZFxcdTBkNGVcXHUwZDYwXFx1MGQ2MVxcdTBkN2EtXFx1MGQ3ZlxcdTBkODUtXFx1MGQ5NlxcdTBkOWEtXFx1MGRiMVxcdTBkYjMtXFx1MGRiYlxcdTBkYmRcXHUwZGMwLVxcdTBkYzZcXHUwZTAxLVxcdTBlMzBcXHUwZTMyXFx1MGUzM1xcdTBlNDAtXFx1MGU0NlxcdTBlODFcXHUwZTgyXFx1MGU4NFxcdTBlODdcXHUwZTg4XFx1MGU4YVxcdTBlOGRcXHUwZTk0LVxcdTBlOTdcXHUwZTk5LVxcdTBlOWZcXHUwZWExLVxcdTBlYTNcXHUwZWE1XFx1MGVhN1xcdTBlYWFcXHUwZWFiXFx1MGVhZC1cXHUwZWIwXFx1MGViMlxcdTBlYjNcXHUwZWJkXFx1MGVjMC1cXHUwZWM0XFx1MGVjNlxcdTBlZGMtXFx1MGVkZlxcdTBmMDBcXHUwZjQwLVxcdTBmNDdcXHUwZjQ5LVxcdTBmNmNcXHUwZjg4LVxcdTBmOGNcXHUxMDAwLVxcdTEwMmFcXHUxMDNmXFx1MTA1MC1cXHUxMDU1XFx1MTA1YS1cXHUxMDVkXFx1MTA2MVxcdTEwNjVcXHUxMDY2XFx1MTA2ZS1cXHUxMDcwXFx1MTA3NS1cXHUxMDgxXFx1MTA4ZVxcdTEwYTAtXFx1MTBjNVxcdTEwYzdcXHUxMGNkXFx1MTBkMC1cXHUxMGZhXFx1MTBmYy1cXHUxMjQ4XFx1MTI0YS1cXHUxMjRkXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNWEtXFx1MTI1ZFxcdTEyNjAtXFx1MTI4OFxcdTEyOGEtXFx1MTI4ZFxcdTEyOTAtXFx1MTJiMFxcdTEyYjItXFx1MTJiNVxcdTEyYjgtXFx1MTJiZVxcdTEyYzBcXHUxMmMyLVxcdTEyYzVcXHUxMmM4LVxcdTEyZDZcXHUxMmQ4LVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzNWFcXHUxMzgwLVxcdTEzOGZcXHUxM2EwLVxcdTEzZjRcXHUxNDAxLVxcdTE2NmNcXHUxNjZmLVxcdTE2N2ZcXHUxNjgxLVxcdTE2OWFcXHUxNmEwLVxcdTE2ZWFcXHUxNmVlLVxcdTE2ZjBcXHUxNzAwLVxcdTE3MGNcXHUxNzBlLVxcdTE3MTFcXHUxNzIwLVxcdTE3MzFcXHUxNzQwLVxcdTE3NTFcXHUxNzYwLVxcdTE3NmNcXHUxNzZlLVxcdTE3NzBcXHUxNzgwLVxcdTE3YjNcXHUxN2Q3XFx1MTdkY1xcdTE4MjAtXFx1MTg3N1xcdTE4ODAtXFx1MThhOFxcdTE4YWFcXHUxOGIwLVxcdTE4ZjVcXHUxOTAwLVxcdTE5MWNcXHUxOTUwLVxcdTE5NmRcXHUxOTcwLVxcdTE5NzRcXHUxOTgwLVxcdTE5YWJcXHUxOWMxLVxcdTE5YzdcXHUxYTAwLVxcdTFhMTZcXHUxYTIwLVxcdTFhNTRcXHUxYWE3XFx1MWIwNS1cXHUxYjMzXFx1MWI0NS1cXHUxYjRiXFx1MWI4My1cXHUxYmEwXFx1MWJhZVxcdTFiYWZcXHUxYmJhLVxcdTFiZTVcXHUxYzAwLVxcdTFjMjNcXHUxYzRkLVxcdTFjNGZcXHUxYzVhLVxcdTFjN2RcXHUxY2U5LVxcdTFjZWNcXHUxY2VlLVxcdTFjZjFcXHUxY2Y1XFx1MWNmNlxcdTFkMDAtXFx1MWRiZlxcdTFlMDAtXFx1MWYxNVxcdTFmMTgtXFx1MWYxZFxcdTFmMjAtXFx1MWY0NVxcdTFmNDgtXFx1MWY0ZFxcdTFmNTAtXFx1MWY1N1xcdTFmNTlcXHUxZjViXFx1MWY1ZFxcdTFmNWYtXFx1MWY3ZFxcdTFmODAtXFx1MWZiNFxcdTFmYjYtXFx1MWZiY1xcdTFmYmVcXHUxZmMyLVxcdTFmYzRcXHUxZmM2LVxcdTFmY2NcXHUxZmQwLVxcdTFmZDNcXHUxZmQ2LVxcdTFmZGJcXHUxZmUwLVxcdTFmZWNcXHUxZmYyLVxcdTFmZjRcXHUxZmY2LVxcdTFmZmNcXHUyMDcxXFx1MjA3ZlxcdTIwOTAtXFx1MjA5Y1xcdTIxMDJcXHUyMTA3XFx1MjEwYS1cXHUyMTEzXFx1MjExNVxcdTIxMTktXFx1MjExZFxcdTIxMjRcXHUyMTI2XFx1MjEyOFxcdTIxMmEtXFx1MjEyZFxcdTIxMmYtXFx1MjEzOVxcdTIxM2MtXFx1MjEzZlxcdTIxNDUtXFx1MjE0OVxcdTIxNGVcXHUyMTYwLVxcdTIxODhcXHUyYzAwLVxcdTJjMmVcXHUyYzMwLVxcdTJjNWVcXHUyYzYwLVxcdTJjZTRcXHUyY2ViLVxcdTJjZWVcXHUyY2YyXFx1MmNmM1xcdTJkMDAtXFx1MmQyNVxcdTJkMjdcXHUyZDJkXFx1MmQzMC1cXHUyZDY3XFx1MmQ2ZlxcdTJkODAtXFx1MmQ5NlxcdTJkYTAtXFx1MmRhNlxcdTJkYTgtXFx1MmRhZVxcdTJkYjAtXFx1MmRiNlxcdTJkYjgtXFx1MmRiZVxcdTJkYzAtXFx1MmRjNlxcdTJkYzgtXFx1MmRjZVxcdTJkZDAtXFx1MmRkNlxcdTJkZDgtXFx1MmRkZVxcdTJlMmZcXHUzMDA1LVxcdTMwMDdcXHUzMDIxLVxcdTMwMjlcXHUzMDMxLVxcdTMwMzVcXHUzMDM4LVxcdTMwM2NcXHUzMDQxLVxcdTMwOTZcXHUzMDlkLVxcdTMwOWZcXHUzMGExLVxcdTMwZmFcXHUzMGZjLVxcdTMwZmZcXHUzMTA1LVxcdTMxMmRcXHUzMTMxLVxcdTMxOGVcXHUzMWEwLVxcdTMxYmFcXHUzMWYwLVxcdTMxZmZcXHUzNDAwLVxcdTRkYjVcXHU0ZTAwLVxcdTlmY2NcXHVhMDAwLVxcdWE0OGNcXHVhNGQwLVxcdWE0ZmRcXHVhNTAwLVxcdWE2MGNcXHVhNjEwLVxcdWE2MWZcXHVhNjJhXFx1YTYyYlxcdWE2NDAtXFx1YTY2ZVxcdWE2N2YtXFx1YTY5N1xcdWE2YTAtXFx1YTZlZlxcdWE3MTctXFx1YTcxZlxcdWE3MjItXFx1YTc4OFxcdWE3OGItXFx1YTc4ZVxcdWE3OTAtXFx1YTc5M1xcdWE3YTAtXFx1YTdhYVxcdWE3ZjgtXFx1YTgwMVxcdWE4MDMtXFx1YTgwNVxcdWE4MDctXFx1YTgwYVxcdWE4MGMtXFx1YTgyMlxcdWE4NDAtXFx1YTg3M1xcdWE4ODItXFx1YThiM1xcdWE4ZjItXFx1YThmN1xcdWE4ZmJcXHVhOTBhLVxcdWE5MjVcXHVhOTMwLVxcdWE5NDZcXHVhOTYwLVxcdWE5N2NcXHVhOTg0LVxcdWE5YjJcXHVhOWNmXFx1YWEwMC1cXHVhYTI4XFx1YWE0MC1cXHVhYTQyXFx1YWE0NC1cXHVhYTRiXFx1YWE2MC1cXHVhYTc2XFx1YWE3YVxcdWFhODAtXFx1YWFhZlxcdWFhYjFcXHVhYWI1XFx1YWFiNlxcdWFhYjktXFx1YWFiZFxcdWFhYzBcXHVhYWMyXFx1YWFkYi1cXHVhYWRkXFx1YWFlMC1cXHVhYWVhXFx1YWFmMi1cXHVhYWY0XFx1YWIwMS1cXHVhYjA2XFx1YWIwOS1cXHVhYjBlXFx1YWIxMS1cXHVhYjE2XFx1YWIyMC1cXHVhYjI2XFx1YWIyOC1cXHVhYjJlXFx1YWJjMC1cXHVhYmUyXFx1YWMwMC1cXHVkN2EzXFx1ZDdiMC1cXHVkN2M2XFx1ZDdjYi1cXHVkN2ZiXFx1ZjkwMC1cXHVmYTZkXFx1ZmE3MC1cXHVmYWQ5XFx1ZmIwMC1cXHVmYjA2XFx1ZmIxMy1cXHVmYjE3XFx1ZmIxZFxcdWZiMWYtXFx1ZmIyOFxcdWZiMmEtXFx1ZmIzNlxcdWZiMzgtXFx1ZmIzY1xcdWZiM2VcXHVmYjQwXFx1ZmI0MVxcdWZiNDNcXHVmYjQ0XFx1ZmI0Ni1cXHVmYmIxXFx1ZmJkMy1cXHVmZDNkXFx1ZmQ1MC1cXHVmZDhmXFx1ZmQ5Mi1cXHVmZGM3XFx1ZmRmMC1cXHVmZGZiXFx1ZmU3MC1cXHVmZTc0XFx1ZmU3Ni1cXHVmZWZjXFx1ZmYyMS1cXHVmZjNhXFx1ZmY0MS1cXHVmZjVhXFx1ZmY2Ni1cXHVmZmJlXFx1ZmZjMi1cXHVmZmM3XFx1ZmZjYS1cXHVmZmNmXFx1ZmZkMi1cXHVmZmQ3XFx1ZmZkYS1cXHVmZmRjXCI7XG4gIHZhciBub25BU0NJSWlkZW50aWZpZXJDaGFycyA9IFwiXFx1MDMwMC1cXHUwMzZmXFx1MDQ4My1cXHUwNDg3XFx1MDU5MS1cXHUwNWJkXFx1MDViZlxcdTA1YzFcXHUwNWMyXFx1MDVjNFxcdTA1YzVcXHUwNWM3XFx1MDYxMC1cXHUwNjFhXFx1MDYyMC1cXHUwNjQ5XFx1MDY3Mi1cXHUwNmQzXFx1MDZlNy1cXHUwNmU4XFx1MDZmYi1cXHUwNmZjXFx1MDczMC1cXHUwNzRhXFx1MDgwMC1cXHUwODE0XFx1MDgxYi1cXHUwODIzXFx1MDgyNS1cXHUwODI3XFx1MDgyOS1cXHUwODJkXFx1MDg0MC1cXHUwODU3XFx1MDhlNC1cXHUwOGZlXFx1MDkwMC1cXHUwOTAzXFx1MDkzYS1cXHUwOTNjXFx1MDkzZS1cXHUwOTRmXFx1MDk1MS1cXHUwOTU3XFx1MDk2Mi1cXHUwOTYzXFx1MDk2Ni1cXHUwOTZmXFx1MDk4MS1cXHUwOTgzXFx1MDliY1xcdTA5YmUtXFx1MDljNFxcdTA5YzdcXHUwOWM4XFx1MDlkN1xcdTA5ZGYtXFx1MDllMFxcdTBhMDEtXFx1MGEwM1xcdTBhM2NcXHUwYTNlLVxcdTBhNDJcXHUwYTQ3XFx1MGE0OFxcdTBhNGItXFx1MGE0ZFxcdTBhNTFcXHUwYTY2LVxcdTBhNzFcXHUwYTc1XFx1MGE4MS1cXHUwYTgzXFx1MGFiY1xcdTBhYmUtXFx1MGFjNVxcdTBhYzctXFx1MGFjOVxcdTBhY2ItXFx1MGFjZFxcdTBhZTItXFx1MGFlM1xcdTBhZTYtXFx1MGFlZlxcdTBiMDEtXFx1MGIwM1xcdTBiM2NcXHUwYjNlLVxcdTBiNDRcXHUwYjQ3XFx1MGI0OFxcdTBiNGItXFx1MGI0ZFxcdTBiNTZcXHUwYjU3XFx1MGI1Zi1cXHUwYjYwXFx1MGI2Ni1cXHUwYjZmXFx1MGI4MlxcdTBiYmUtXFx1MGJjMlxcdTBiYzYtXFx1MGJjOFxcdTBiY2EtXFx1MGJjZFxcdTBiZDdcXHUwYmU2LVxcdTBiZWZcXHUwYzAxLVxcdTBjMDNcXHUwYzQ2LVxcdTBjNDhcXHUwYzRhLVxcdTBjNGRcXHUwYzU1XFx1MGM1NlxcdTBjNjItXFx1MGM2M1xcdTBjNjYtXFx1MGM2ZlxcdTBjODJcXHUwYzgzXFx1MGNiY1xcdTBjYmUtXFx1MGNjNFxcdTBjYzYtXFx1MGNjOFxcdTBjY2EtXFx1MGNjZFxcdTBjZDVcXHUwY2Q2XFx1MGNlMi1cXHUwY2UzXFx1MGNlNi1cXHUwY2VmXFx1MGQwMlxcdTBkMDNcXHUwZDQ2LVxcdTBkNDhcXHUwZDU3XFx1MGQ2Mi1cXHUwZDYzXFx1MGQ2Ni1cXHUwZDZmXFx1MGQ4MlxcdTBkODNcXHUwZGNhXFx1MGRjZi1cXHUwZGQ0XFx1MGRkNlxcdTBkZDgtXFx1MGRkZlxcdTBkZjJcXHUwZGYzXFx1MGUzNC1cXHUwZTNhXFx1MGU0MC1cXHUwZTQ1XFx1MGU1MC1cXHUwZTU5XFx1MGViNC1cXHUwZWI5XFx1MGVjOC1cXHUwZWNkXFx1MGVkMC1cXHUwZWQ5XFx1MGYxOFxcdTBmMTlcXHUwZjIwLVxcdTBmMjlcXHUwZjM1XFx1MGYzN1xcdTBmMzlcXHUwZjQxLVxcdTBmNDdcXHUwZjcxLVxcdTBmODRcXHUwZjg2LVxcdTBmODdcXHUwZjhkLVxcdTBmOTdcXHUwZjk5LVxcdTBmYmNcXHUwZmM2XFx1MTAwMC1cXHUxMDI5XFx1MTA0MC1cXHUxMDQ5XFx1MTA2Ny1cXHUxMDZkXFx1MTA3MS1cXHUxMDc0XFx1MTA4Mi1cXHUxMDhkXFx1MTA4Zi1cXHUxMDlkXFx1MTM1ZC1cXHUxMzVmXFx1MTcwZS1cXHUxNzEwXFx1MTcyMC1cXHUxNzMwXFx1MTc0MC1cXHUxNzUwXFx1MTc3MlxcdTE3NzNcXHUxNzgwLVxcdTE3YjJcXHUxN2RkXFx1MTdlMC1cXHUxN2U5XFx1MTgwYi1cXHUxODBkXFx1MTgxMC1cXHUxODE5XFx1MTkyMC1cXHUxOTJiXFx1MTkzMC1cXHUxOTNiXFx1MTk1MS1cXHUxOTZkXFx1MTliMC1cXHUxOWMwXFx1MTljOC1cXHUxOWM5XFx1MTlkMC1cXHUxOWQ5XFx1MWEwMC1cXHUxYTE1XFx1MWEyMC1cXHUxYTUzXFx1MWE2MC1cXHUxYTdjXFx1MWE3Zi1cXHUxYTg5XFx1MWE5MC1cXHUxYTk5XFx1MWI0Ni1cXHUxYjRiXFx1MWI1MC1cXHUxYjU5XFx1MWI2Yi1cXHUxYjczXFx1MWJiMC1cXHUxYmI5XFx1MWJlNi1cXHUxYmYzXFx1MWMwMC1cXHUxYzIyXFx1MWM0MC1cXHUxYzQ5XFx1MWM1Yi1cXHUxYzdkXFx1MWNkMC1cXHUxY2QyXFx1MWQwMC1cXHUxZGJlXFx1MWUwMS1cXHUxZjE1XFx1MjAwY1xcdTIwMGRcXHUyMDNmXFx1MjA0MFxcdTIwNTRcXHUyMGQwLVxcdTIwZGNcXHUyMGUxXFx1MjBlNS1cXHUyMGYwXFx1MmQ4MS1cXHUyZDk2XFx1MmRlMC1cXHUyZGZmXFx1MzAyMS1cXHUzMDI4XFx1MzA5OVxcdTMwOWFcXHVhNjQwLVxcdWE2NmRcXHVhNjc0LVxcdWE2N2RcXHVhNjlmXFx1YTZmMC1cXHVhNmYxXFx1YTdmOC1cXHVhODAwXFx1YTgwNlxcdWE4MGJcXHVhODIzLVxcdWE4MjdcXHVhODgwLVxcdWE4ODFcXHVhOGI0LVxcdWE4YzRcXHVhOGQwLVxcdWE4ZDlcXHVhOGYzLVxcdWE4ZjdcXHVhOTAwLVxcdWE5MDlcXHVhOTI2LVxcdWE5MmRcXHVhOTMwLVxcdWE5NDVcXHVhOTgwLVxcdWE5ODNcXHVhOWIzLVxcdWE5YzBcXHVhYTAwLVxcdWFhMjdcXHVhYTQwLVxcdWFhNDFcXHVhYTRjLVxcdWFhNGRcXHVhYTUwLVxcdWFhNTlcXHVhYTdiXFx1YWFlMC1cXHVhYWU5XFx1YWFmMi1cXHVhYWYzXFx1YWJjMC1cXHVhYmUxXFx1YWJlY1xcdWFiZWRcXHVhYmYwLVxcdWFiZjlcXHVmYjIwLVxcdWZiMjhcXHVmZTAwLVxcdWZlMGZcXHVmZTIwLVxcdWZlMjZcXHVmZTMzXFx1ZmUzNFxcdWZlNGQtXFx1ZmU0ZlxcdWZmMTAtXFx1ZmYxOVxcdWZmM2ZcIjtcbiAgdmFyIG5vbkFTQ0lJaWRlbnRpZmllclN0YXJ0ID0gbmV3IFJlZ0V4cChcIltcIiArIG5vbkFTQ0lJaWRlbnRpZmllclN0YXJ0Q2hhcnMgKyBcIl1cIik7XG4gIHZhciBub25BU0NJSWlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKFwiW1wiICsgbm9uQVNDSUlpZGVudGlmaWVyU3RhcnRDaGFycyArIG5vbkFTQ0lJaWRlbnRpZmllckNoYXJzICsgXCJdXCIpO1xuXG4gIC8vIFdoZXRoZXIgYSBzaW5nbGUgY2hhcmFjdGVyIGRlbm90ZXMgYSBuZXdsaW5lLlxuXG4gIHZhciBuZXdsaW5lID0gL1tcXG5cXHJcXHUyMDI4XFx1MjAyOV0vO1xuXG4gIC8vIE1hdGNoZXMgYSB3aG9sZSBsaW5lIGJyZWFrICh3aGVyZSBDUkxGIGlzIGNvbnNpZGVyZWQgYSBzaW5nbGVcbiAgLy8gbGluZSBicmVhaykuIFVzZWQgdG8gY291bnQgbGluZXMuXG5cbiAgdmFyIGxpbmVCcmVhayA9IC9cXHJcXG58W1xcblxcclxcdTIwMjhcXHUyMDI5XS9nO1xuXG4gIC8vIFRlc3Qgd2hldGhlciBhIGdpdmVuIGNoYXJhY3RlciBjb2RlIHN0YXJ0cyBhbiBpZGVudGlmaWVyLlxuXG4gIHZhciBpc0lkZW50aWZpZXJTdGFydCA9IGV4cG9ydHMuaXNJZGVudGlmaWVyU3RhcnQgPSBmdW5jdGlvbihjb2RlKSB7XG4gICAgaWYgKGNvZGUgPCA2NSkgcmV0dXJuIGNvZGUgPT09IDM2O1xuICAgIGlmIChjb2RlIDwgOTEpIHJldHVybiB0cnVlO1xuICAgIGlmIChjb2RlIDwgOTcpIHJldHVybiBjb2RlID09PSA5NTtcbiAgICBpZiAoY29kZSA8IDEyMylyZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gY29kZSA+PSAweGFhICYmIG5vbkFTQ0lJaWRlbnRpZmllclN0YXJ0LnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSk7XG4gIH07XG5cbiAgLy8gVGVzdCB3aGV0aGVyIGEgZ2l2ZW4gY2hhcmFjdGVyIGlzIHBhcnQgb2YgYW4gaWRlbnRpZmllci5cblxuICB2YXIgaXNJZGVudGlmaWVyQ2hhciA9IGV4cG9ydHMuaXNJZGVudGlmaWVyQ2hhciA9IGZ1bmN0aW9uKGNvZGUpIHtcbiAgICBpZiAoY29kZSA8IDQ4KSByZXR1cm4gY29kZSA9PT0gMzY7XG4gICAgaWYgKGNvZGUgPCA1OCkgcmV0dXJuIHRydWU7XG4gICAgaWYgKGNvZGUgPCA2NSkgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChjb2RlIDwgOTEpIHJldHVybiB0cnVlO1xuICAgIGlmIChjb2RlIDwgOTcpIHJldHVybiBjb2RlID09PSA5NTtcbiAgICBpZiAoY29kZSA8IDEyMylyZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gY29kZSA+PSAweGFhICYmIG5vbkFTQ0lJaWRlbnRpZmllci50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSkpO1xuICB9O1xuXG4gIC8vICMjIFRva2VuaXplclxuXG4gIC8vIFRoZXNlIGFyZSB1c2VkIHdoZW4gYG9wdGlvbnMubG9jYXRpb25zYCBpcyBvbiwgZm9yIHRoZVxuICAvLyBgdG9rU3RhcnRMb2NgIGFuZCBgdG9rRW5kTG9jYCBwcm9wZXJ0aWVzLlxuXG4gIGZ1bmN0aW9uIFBvc2l0aW9uKCkge1xuICAgIHRoaXMubGluZSA9IHRva0N1ckxpbmU7XG4gICAgdGhpcy5jb2x1bW4gPSB0b2tQb3MgLSB0b2tMaW5lU3RhcnQ7XG4gIH1cblxuICAvLyBSZXNldCB0aGUgdG9rZW4gc3RhdGUuIFVzZWQgYXQgdGhlIHN0YXJ0IG9mIGEgcGFyc2UuXG5cbiAgZnVuY3Rpb24gaW5pdFRva2VuU3RhdGUoKSB7XG4gICAgdG9rQ3VyTGluZSA9IDE7XG4gICAgdG9rUG9zID0gdG9rTGluZVN0YXJ0ID0gMDtcbiAgICB0b2tSZWdleHBBbGxvd2VkID0gdHJ1ZTtcbiAgICBpbmRlbnRIaXN0LmluaXQoKTtcbiAgICBuZXdBc3RJZENvdW50ID0gMDtcbiAgICBzY29wZS5pbml0KCk7XG4gIH1cblxuICAvLyBDYWxsZWQgYXQgdGhlIGVuZCBvZiBldmVyeSB0b2tlbi4gU2V0cyBgdG9rRW5kYCwgYHRva1ZhbGAsIGFuZFxuICAvLyBgdG9rUmVnZXhwQWxsb3dlZGAsIGFuZCBza2lwcyB0aGUgc3BhY2UgYWZ0ZXIgdGhlIHRva2VuLCBzbyB0aGF0XG4gIC8vIHRoZSBuZXh0IG9uZSdzIGB0b2tTdGFydGAgd2lsbCBwb2ludCBhdCB0aGUgcmlnaHQgcG9zaXRpb24uXG5cbiAgZnVuY3Rpb24gZmluaXNoVG9rZW4odHlwZSwgdmFsKSB7XG4gICAgdG9rRW5kID0gdG9rUG9zO1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykgdG9rRW5kTG9jID0gbmV3IFBvc2l0aW9uO1xuICAgIHRva1R5cGUgPSB0eXBlO1xuICAgIGlmICh0eXBlID09PSBfcGFyZW5MIHx8IHR5cGUgPT09IF9icmFjZUwgfHwgdHlwZSA9PT0gX2JyYWNrZXRMKSArK2JyYWNrZXROZXN0aW5nO1xuICAgIGlmICh0eXBlID09PSBfcGFyZW5SIHx8IHR5cGUgPT09IF9icmFjZVIgfHwgdHlwZSA9PT0gX2JyYWNrZXRSKSAtLWJyYWNrZXROZXN0aW5nO1xuICAgIGlmICh0eXBlICE9PSBfbmV3bGluZSkgc2tpcFNwYWNlKCk7XG4gICAgdG9rVmFsID0gdmFsO1xuICAgIHRva1JlZ2V4cEFsbG93ZWQgPSB0eXBlLmJlZm9yZUV4cHI7XG4gIH1cblxuICBmdW5jdGlvbiBza2lwTGluZSgpIHtcbiAgICB2YXIgY2ggPSBpbnB1dC5jaGFyQ29kZUF0KCsrdG9rUG9zKTtcbiAgICB3aGlsZSAodG9rUG9zIDwgaW5wdXRMZW4gJiYgIWlzTmV3bGluZShjaCkpIHtcbiAgICAgICsrdG9rUG9zO1xuICAgICAgY2ggPSBpbnB1dC5jaGFyQ29kZUF0KHRva1Bvcyk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2tpcExpbmVDb21tZW50KCkge1xuICAgIHZhciBzdGFydCA9IHRva1BvcztcbiAgICB2YXIgc3RhcnRMb2MgPSBvcHRpb25zLm9uQ29tbWVudCAmJiBvcHRpb25zLmxvY2F0aW9ucyAmJiBuZXcgUG9zaXRpb247XG4gICAgc2tpcExpbmUoKTtcbiAgICBpZiAob3B0aW9ucy5vbkNvbW1lbnQpXG4gICAgICBvcHRpb25zLm9uQ29tbWVudChpbnB1dC5zbGljZShzdGFydCArIDEsIHRva1BvcyksIHN0YXJ0LCB0b2tQb3MsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydExvYywgb3B0aW9ucy5sb2NhdGlvbnMgJiYgbmV3IFBvc2l0aW9uKTtcbiAgfVxuXG4gIC8vIENhbGxlZCBhdCB0aGUgc3RhcnQgb2YgdGhlIHBhcnNlIGFuZCBhZnRlciBldmVyeSB0b2tlbi4gU2tpcHNcbiAgLy8gd2hpdGVzcGFjZSBhbmQgY29tbWVudHMsIGFuZC5cblxuICBmdW5jdGlvbiBza2lwU3BhY2UoKSB7XG4gICAgd2hpbGUgKHRva1BvcyA8IGlucHV0TGVuKSB7XG4gICAgICB2YXIgY2ggPSBpbnB1dC5jaGFyQ29kZUF0KHRva1Bvcyk7XG4gICAgICBpZiAoY2ggPT09IDM1KSBza2lwTGluZUNvbW1lbnQoKTtcbiAgICAgIGVsc2UgaWYgKGNoID09PSA5Mikge1xuICAgICAgICArK3Rva1BvcztcbiAgICAgICAgaWYgKGlzTmV3bGluZShpbnB1dC5jaGFyQ29kZUF0KHRva1BvcykpKSB7XG4gICAgICAgICAgaWYgKGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKSA9PT0gMTMgJiYgaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MrMSkgPT09IDEwKSArK3Rva1BvcztcbiAgICAgICAgICArK3Rva1BvcztcbiAgICAgICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbikgeyB0b2tMaW5lU3RhcnQgPSB0b2tQb3M7ICsrdG9rQ3VyTGluZTsgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJhaXNlKHRva1BvcywgXCJVbmV4cGVjdGVkIGNoYXJhY3RlciBhZnRlciBsaW5lIGNvbnRpbnVhdGlvbiBjaGFyYWN0ZXJcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGlzU3BhY2UoY2gpKSArK3Rva1BvcztcbiAgICAgIGVsc2UgaWYgKGJyYWNrZXROZXN0aW5nID4gMCAmJiBpc05ld2xpbmUoY2gpKSB7XG4gICAgICAgIGlmIChjaCA9PT0gMTMgJiYgaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MrMSkgPT09IDEwKSArK3Rva1BvcztcbiAgICAgICAgKyt0b2tQb3M7XG4gICAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9uKSB7IHRva0xpbmVTdGFydCA9IHRva1BvczsgKyt0b2tDdXJMaW5lOyB9XG4gICAgICB9XG4gICAgICBlbHNlIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGlzU3BhY2UoY2gpIHtcbiAgICBpZiAoY2ggPT09IDMyIHx8IC8vICcgJ1xuICAgICAgY2ggPT09IDkgfHwgY2ggPT09IDExIHx8IGNoID09PSAxMiB8fFxuICAgICAgY2ggPT09IDE2MCB8fCAvLyAnXFx4YTAnXG4gICAgICBjaCA+PSA1NzYwICYmIG5vbkFTQ0lJd2hpdGVzcGFjZS50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzTmV3bGluZShjaCkge1xuICAgIGlmIChjaCA9PT0gMTAgfHwgY2ggPT09IDEzIHx8XG4gICAgICBjaCA9PT0gODIzMiB8fCBjaCA9PT0gODIzMykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vICMjIyBUb2tlbiByZWFkaW5nXG5cbiAgLy8gVGhpcyBpcyB0aGUgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgdG8gZmV0Y2ggdGhlIG5leHQgdG9rZW4uIEl0XG4gIC8vIGlzIHNvbWV3aGF0IG9ic2N1cmUsIGJlY2F1c2UgaXQgd29ya3MgaW4gY2hhcmFjdGVyIGNvZGVzIHJhdGhlclxuICAvLyB0aGFuIGNoYXJhY3RlcnMsIGFuZCBiZWNhdXNlIG9wZXJhdG9yIHBhcnNpbmcgaGFzIGJlZW4gaW5saW5lZFxuICAvLyBpbnRvIGl0LlxuICAvL1xuICAvLyBBbGwgaW4gdGhlIG5hbWUgb2Ygc3BlZWQuXG4gIC8vXG4gIC8vIFRoZSBgZm9yY2VSZWdleHBgIHBhcmFtZXRlciBpcyB1c2VkIGluIHRoZSBvbmUgY2FzZSB3aGVyZSB0aGVcbiAgLy8gYHRva1JlZ2V4cEFsbG93ZWRgIHRyaWNrIGRvZXMgbm90IHdvcmsuIFNlZSBgcGFyc2VTdGF0ZW1lbnRgLlxuXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbl9kb3QoKSB7XG4gICAgdmFyIG5leHQgPSBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcyArIDEpO1xuICAgIGlmIChuZXh0ID49IDQ4ICYmIG5leHQgPD0gNTcpIHJldHVybiByZWFkTnVtYmVyKHRydWUpO1xuICAgICsrdG9rUG9zO1xuICAgIHJldHVybiBmaW5pc2hUb2tlbihfZG90KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbl9zbGFzaCgpIHsgLy8gJy8nXG4gICAgaWYgKHRva1JlZ2V4cEFsbG93ZWQpIHsgKyt0b2tQb3M7IHJldHVybiByZWFkUmVnZXhwKCk7IH1cbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgaWYgKG5leHQgPT09IDQ3KSByZXR1cm4gZmluaXNoT3AoX2Zsb29yRGl2LCAyKTtcbiAgICBpZiAobmV4dCA9PT0gNjEpIHJldHVybiBmaW5pc2hPcChfYXNzaWduLCAyKTtcbiAgICByZXR1cm4gZmluaXNoT3AoX3NsYXNoLCAxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbl9tdWx0X21vZHVsbyhjb2RlKSB7IC8vICcqJSdcbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgaWYgKG5leHQgPT09IDQyICYmIG5leHQgPT09IGNvZGUpIHJldHVybiBmaW5pc2hPcChfZXhwb25lbnRpYXRpb24sIDIpO1xuICAgIGlmIChuZXh0ID09PSA2MSkgcmV0dXJuIGZpbmlzaE9wKF9hc3NpZ24sIDIpO1xuICAgIHJldHVybiBmaW5pc2hPcChfbXVsdGlwbHlNb2R1bG8sIDEpO1xuICB9XG4gIFxuICBmdW5jdGlvbiByZWFkVG9rZW5fcGlwZV9hbXAoY29kZSkgeyAvLyAnfCYnXG4gICAgdmFyIG5leHQgPSBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcyArIDEpO1xuICAgIGlmIChuZXh0ID09PSA2MSkgcmV0dXJuIGZpbmlzaE9wKF9hc3NpZ24sIDIpO1xuICAgIHJldHVybiBmaW5pc2hPcChjb2RlID09PSAxMjQgPyBfYml0d2lzZU9SIDogX2JpdHdpc2VBTkQsIDEpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuX2NhcmV0KCkgeyAvLyAnXidcbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgaWYgKG5leHQgPT09IDYxKSByZXR1cm4gZmluaXNoT3AoX2Fzc2lnbiwgMik7XG4gICAgcmV0dXJuIGZpbmlzaE9wKF9iaXR3aXNlWE9SLCAxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbl9wbHVzX21pbihjb2RlKSB7IC8vICcrLSdcbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgaWYgKG5leHQgPT09IDYxKSByZXR1cm4gZmluaXNoT3AoX2Fzc2lnbiwgMik7XG4gICAgcmV0dXJuIGZpbmlzaE9wKF9wbHVzTWluLCAxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbl9sdF9ndChjb2RlKSB7IC8vICc8PidcbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgdmFyIHNpemUgPSAxO1xuICAgIGlmIChuZXh0ID09PSBjb2RlKSB7XG4gICAgICBzaXplID0gMjtcbiAgICAgIGlmIChpbnB1dC5jaGFyQ29kZUF0KHRva1BvcyArIHNpemUpID09PSA2MSkgcmV0dXJuIGZpbmlzaE9wKF9hc3NpZ24sIHNpemUgKyAxKTtcbiAgICAgIHJldHVybiBmaW5pc2hPcChfYml0U2hpZnQsIHNpemUpO1xuICAgIH1cbiAgICBpZiAobmV4dCA9PT0gNjEpIHNpemUgPSAyO1xuICAgIHJldHVybiBmaW5pc2hPcChfcmVsYXRpb25hbCwgc2l6ZSk7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkVG9rZW5fZXFfZXhjbChjb2RlKSB7IC8vICc9ISdcbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zICsgMSk7XG4gICAgaWYgKG5leHQgPT09IDYxKSByZXR1cm4gZmluaXNoT3AoX2VxdWFsaXR5LCAyKTtcbiAgICByZXR1cm4gZmluaXNoT3AoX2VxLCAxKTtcbiAgfVxuXG4gIC8vIFBhcnNlIGluZGVudGF0aW9uXG4gIC8vIFBvc3NpYmxlIG91dHB1dDogX2luZGVudCwgX2RlZGVudCwgX2VvZiwgcmVhZFRva2VuKClcbiAgLy8gVE9ETzogZGlzYWxsb3cgdW5lcXVhbCBpbmRlbnRzIG9mIHNhbWUgbGVuZ3RoIChlLmcuIG5lc3RlZCBpZi9lbHNlIGJsb2NrKVxuXG4gIGZ1bmN0aW9uIHJlYWRUb2tlbl9pbmRlbnQoKSB7XG4gICAgLy8gUmVhZCBpbmRlbnQsIHNraXAgZW1wdHkgbGluZXMgYW5kIGNvbW1lbnRzXG4gICAgdmFyIGluZGVudCA9IFwiXCI7XG4gICAgdmFyIGluZGVudFBvcyA9IHRva1BvcztcbiAgICB2YXIgY2gsIG5leHQ7XG4gICAgd2hpbGUgKGluZGVudFBvcyA8IGlucHV0TGVuKSB7XG4gICAgICBjaCA9IGlucHV0LmNoYXJDb2RlQXQoaW5kZW50UG9zKTtcbiAgICAgIGlmIChpc1NwYWNlKGNoKSkge1xuICAgICAgICBpbmRlbnQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7XG4gICAgICAgICsraW5kZW50UG9zO1xuICAgICAgfSBlbHNlIGlmIChpc05ld2xpbmUoY2gpKSB7IC8vIG5ld2xpbmVcbiAgICAgICAgaW5kZW50ID0gXCJcIjtcbiAgICAgICAgaWYgKGNoID09PSAxMyAmJiBpbnB1dC5jaGFyQ29kZUF0KGluZGVudFBvcyArIDEpID09PSAxMCkgKytpbmRlbnRQb3M7XG4gICAgICAgICsraW5kZW50UG9zO1xuICAgICAgICB0b2tQb3MgPSBpbmRlbnRQb3M7XG4gICAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykge1xuICAgICAgICAgIHRva0xpbmVTdGFydCA9IGluZGVudFBvcztcbiAgICAgICAgICArK3Rva0N1ckxpbmU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDM1KSB7IC8vICcjJ1xuICAgICAgICBkbyB7XG4gICAgICAgICAgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQoKytpbmRlbnRQb3MpO1xuICAgICAgICB9IHdoaWxlIChpbmRlbnRQb3MgPCBpbnB1dExlbiAmJiBuZXh0ICE9PSAxMCk7XG4gICAgICAgIC8vIFRPRE86IGNhbGwgb25Db21tZW50XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEZXRlcm1pbmUgdG9rZW4gdHlwZSBiYXNlZCBvbiBpbmRlbnQgZm91bmQgdmVyc3VzIGluZGVudGF0aW9uIGhpc3RvcnlcbiAgICB2YXIgdHlwZTtcbiAgICBpZiAoaW5kZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgIGlmIChpbmRlbnRIaXN0LmlzSW5kZW50KGluZGVudCkpIHtcbiAgICAgICAgdHlwZSA9IF9pbmRlbnQ7XG4gICAgICAgIGlmIChpbmRlbnRIaXN0LmNvdW50KCkgPj0gMSkgdG9rU3RhcnQgKz0gaW5kZW50SGlzdC5sZW4oaW5kZW50SGlzdC5jb3VudCgpIC0gMSk7XG4gICAgICAgIGluZGVudEhpc3QuYWRkSW5kZW50KGluZGVudCk7XG4gICAgICB9IGVsc2UgaWYgKGluZGVudEhpc3QuaXNEZWRlbnQoaW5kZW50KSkge1xuICAgICAgICB0eXBlID0gX2RlZGVudDtcbiAgICAgICAgaW5kZW50SGlzdC5hZGREZWRlbnQoaW5kZW50KTtcbiAgICAgICAgdmFyIG5leHREZWRlbnQgPSBpbmRlbnRIaXN0LmNvdW50KCkgLSBpbmRlbnRIaXN0LmRlZGVudENvdW50O1xuICAgICAgICBpZiAobmV4dERlZGVudCA+PSAyKSB7XG4gICAgICAgICAgdG9rU3RhcnQgKz0gaW5kZW50SGlzdC5sZW4obmV4dERlZGVudCkgLSBpbmRlbnRIaXN0LmxlbihuZXh0RGVkZW50IC0gMSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRva1BvcyArPSBpbmRlbnQubGVuZ3RoO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaW5kZW50UG9zID49IGlucHV0TGVuKSB7XG4gICAgICB0eXBlID0gX2VvZjtcbiAgICB9IGVsc2UgaWYgKGluZGVudEhpc3QuY291bnQoKSA+IDApIHtcbiAgICAgIHR5cGUgPSBfZGVkZW50O1xuICAgICAgaW5kZW50SGlzdC51cGRhdGVEZWRlbnQoKTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgX2luZGVudDogY2FzZSBfZGVkZW50OiByZXR1cm4gZmluaXNoT3AodHlwZSwgaW5kZW50UG9zIC0gKyt0b2tQb3MpO1xuICAgICAgY2FzZSBfZW9mOlxuICAgICAgICB0b2tQb3MgPSBpbnB1dExlbjtcbiAgICAgICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB0b2tTdGFydExvYyA9IG5ldyBQb3NpdGlvbjtcbiAgICAgICAgcmV0dXJuIGZpbmlzaE9wKHR5cGUsIDApO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdG9rVHlwZSA9IG51bGw7XG4gICAgICAgIHJldHVybiByZWFkVG9rZW4oKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRUb2tlbkZyb21Db2RlKGNvZGUpIHtcbiAgICBzd2l0Y2goY29kZSkge1xuXG4gICAgY2FzZSAxMzogY2FzZSAxMDogY2FzZSA4MjMyOiBjYXNlIDgyMzM6XG4gICAgICArK3Rva1BvcztcbiAgICAgIGlmIChjb2RlID09PSAxMyAmJiBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcykgPT09IDEwKSArK3Rva1BvcztcbiAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykge1xuICAgICAgICArK3Rva0N1ckxpbmU7XG4gICAgICAgIHRva0xpbmVTdGFydCA9IHRva1BvcztcbiAgICAgIH1cbiAgICAgIHJldHVybiBmaW5pc2hUb2tlbihfbmV3bGluZSk7XG5cbiAgICBjYXNlIDM1OiAvLyAnIydcbiAgICAgIHNraXBMaW5lQ29tbWVudCgpO1xuICAgICAgcmV0dXJuIHJlYWRUb2tlbigpO1xuXG4gICAgICAvLyBUaGUgaW50ZXJwcmV0YXRpb24gb2YgYSBkb3QgZGVwZW5kcyBvbiB3aGV0aGVyIGl0IGlzIGZvbGxvd2VkXG4gICAgICAvLyBieSBhIGRpZ2l0LlxuICAgIGNhc2UgNDY6IC8vICcuJ1xuICAgICAgcmV0dXJuIHJlYWRUb2tlbl9kb3QoKTtcblxuICAgICAgLy8gUHVuY3R1YXRpb24gdG9rZW5zLlxuICAgIGNhc2UgNDA6ICsrdG9rUG9zOyByZXR1cm4gZmluaXNoVG9rZW4oX3BhcmVuTCk7XG4gICAgY2FzZSA0MTogKyt0b2tQb3M7IHJldHVybiBmaW5pc2hUb2tlbihfcGFyZW5SKTtcbiAgICBjYXNlIDU5OiArK3Rva1BvczsgcmV0dXJuIGZpbmlzaFRva2VuKF9zZW1pKTtcbiAgICBjYXNlIDQ0OiArK3Rva1BvczsgcmV0dXJuIGZpbmlzaFRva2VuKF9jb21tYSk7XG4gICAgY2FzZSA5MTogKyt0b2tQb3M7IHJldHVybiBmaW5pc2hUb2tlbihfYnJhY2tldEwpO1xuICAgIGNhc2UgOTM6ICsrdG9rUG9zOyByZXR1cm4gZmluaXNoVG9rZW4oX2JyYWNrZXRSKTtcbiAgICBjYXNlIDEyMzogKyt0b2tQb3M7IHJldHVybiBmaW5pc2hUb2tlbihfYnJhY2VMKTtcbiAgICBjYXNlIDEyNTogKyt0b2tQb3M7IHJldHVybiBmaW5pc2hUb2tlbihfYnJhY2VSKTtcbiAgICBjYXNlIDU4OiArK3Rva1BvczsgcmV0dXJuIGZpbmlzaFRva2VuKF9jb2xvbik7XG4gICAgY2FzZSA2MzogKyt0b2tQb3M7IHJldHVybiBmaW5pc2hUb2tlbihfcXVlc3Rpb24pO1xuXG4gICAgICAvLyAnMHgnIGlzIGEgaGV4YWRlY2ltYWwgbnVtYmVyLlxuICAgIGNhc2UgNDg6IC8vICcwJ1xuICAgICAgdmFyIG5leHQgPSBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcyArIDEpO1xuICAgICAgaWYgKG5leHQgPT09IDEyMCB8fCBuZXh0ID09PSA4OCkgcmV0dXJuIHJlYWRIZXhOdW1iZXIoKTtcbiAgICAgIC8vIEFueXRoaW5nIGVsc2UgYmVnaW5uaW5nIHdpdGggYSBkaWdpdCBpcyBhbiBpbnRlZ2VyLCBvY3RhbFxuICAgICAgLy8gbnVtYmVyLCBvciBmbG9hdC5cbiAgICBjYXNlIDQ5OiBjYXNlIDUwOiBjYXNlIDUxOiBjYXNlIDUyOiBjYXNlIDUzOiBjYXNlIDU0OiBjYXNlIDU1OiBjYXNlIDU2OiBjYXNlIDU3OiAvLyAxLTlcbiAgICAgIHJldHVybiByZWFkTnVtYmVyKGZhbHNlKTtcblxuICAgICAgLy8gUXVvdGVzIHByb2R1Y2Ugc3RyaW5ncy5cbiAgICBjYXNlIDM0OiBjYXNlIDM5OiAvLyAnXCInLCBcIidcIlxuICAgICAgcmV0dXJuIHJlYWRTdHJpbmcoY29kZSk7XG5cbiAgICAvLyBPcGVyYXRvcnMgYXJlIHBhcnNlZCBpbmxpbmUgaW4gdGlueSBzdGF0ZSBtYWNoaW5lcy4gJz0nICg2MSkgaXNcbiAgICAvLyBvZnRlbiByZWZlcnJlZCB0by4gYGZpbmlzaE9wYCBzaW1wbHkgc2tpcHMgdGhlIGFtb3VudCBvZlxuICAgIC8vIGNoYXJhY3RlcnMgaXQgaXMgZ2l2ZW4gYXMgc2Vjb25kIGFyZ3VtZW50LCBhbmQgcmV0dXJucyBhIHRva2VuXG4gICAgLy8gb2YgdGhlIHR5cGUgZ2l2ZW4gYnkgaXRzIGZpcnN0IGFyZ3VtZW50LlxuXG4gICAgY2FzZSA0NzogLy8gJy8nXG4gICAgICByZXR1cm4gcmVhZFRva2VuX3NsYXNoKGNvZGUpO1xuXG4gICAgY2FzZSA0MjogY2FzZSAzNzogLy8gJyolJ1xuICAgICAgcmV0dXJuIHJlYWRUb2tlbl9tdWx0X21vZHVsbyhjb2RlKTtcblxuICAgIGNhc2UgMTI0OiBjYXNlIDM4OiAvLyAnfCYnXG4gICAgICByZXR1cm4gcmVhZFRva2VuX3BpcGVfYW1wKGNvZGUpO1xuXG4gICAgY2FzZSA5NDogLy8gJ14nXG4gICAgICByZXR1cm4gcmVhZFRva2VuX2NhcmV0KCk7XG5cbiAgICBjYXNlIDQzOiBjYXNlIDQ1OiAvLyAnKy0nXG4gICAgICByZXR1cm4gcmVhZFRva2VuX3BsdXNfbWluKGNvZGUpO1xuXG4gICAgY2FzZSA2MDogY2FzZSA2MjogLy8gJzw+J1xuICAgICAgcmV0dXJuIHJlYWRUb2tlbl9sdF9ndChjb2RlKTtcblxuICAgIGNhc2UgNjE6IGNhc2UgMzM6IC8vICc9ISdcbiAgICAgIHJldHVybiByZWFkVG9rZW5fZXFfZXhjbChjb2RlKTtcblxuICAgIGNhc2UgMTI2OiAvLyAnfidcbiAgICAgIHJldHVybiBmaW5pc2hPcChfYml0d2lzZU5PVCwgMSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuKGZvcmNlUmVnZXhwKSB7XG4gICAgaWYgKHRva1R5cGUgPT09IF9kZWRlbnQpIHtcbiAgICAgIGluZGVudEhpc3QucG9wKCk7XG4gICAgICBpZiAoaW5kZW50SGlzdC5kZWRlbnRDb3VudCA+IDApIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIWZvcmNlUmVnZXhwKSB0b2tTdGFydCA9IHRva1BvcztcbiAgICBlbHNlIHRva1BvcyA9IHRva1N0YXJ0ICsgMTtcbiAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHRva1N0YXJ0TG9jID0gbmV3IFBvc2l0aW9uO1xuICAgIGlmIChmb3JjZVJlZ2V4cCkgcmV0dXJuIHJlYWRSZWdleHAoKTtcbiAgICBpZiAodG9rUG9zID49IGlucHV0TGVuKSByZXR1cm4gZmluaXNoVG9rZW4oX2VvZik7XG4gICAgaWYgKHRva1R5cGUgPT09IF9uZXdsaW5lKSByZXR1cm4gcmVhZFRva2VuX2luZGVudCgpO1xuXG4gICAgdmFyIGNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KHRva1Bvcyk7XG4gICAgLy8gSWRlbnRpZmllciBvciBrZXl3b3JkLiAnXFx1WFhYWCcgc2VxdWVuY2VzIGFyZSBhbGxvd2VkIGluXG4gICAgLy8gaWRlbnRpZmllcnMsIHNvICdcXCcgYWxzbyBkaXNwYXRjaGVzIHRvIHRoYXQuXG4gICAgaWYgKGlzSWRlbnRpZmllclN0YXJ0KGNvZGUpIHx8IGNvZGUgPT09IDkyIC8qICdcXCcgKi8pIHJldHVybiByZWFkV29yZCgpO1xuXG4gICAgdmFyIHRvayA9IGdldFRva2VuRnJvbUNvZGUoY29kZSk7XG5cbiAgICBpZiAodG9rID09PSBmYWxzZSkge1xuICAgICAgLy8gSWYgd2UgYXJlIGhlcmUsIHdlIGVpdGhlciBmb3VuZCBhIG5vbi1BU0NJSSBpZGVudGlmaWVyXG4gICAgICAvLyBjaGFyYWN0ZXIsIG9yIHNvbWV0aGluZyB0aGF0J3MgZW50aXJlbHkgZGlzYWxsb3dlZC5cbiAgICAgIHZhciBjaCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG4gICAgICBpZiAoY2ggPT09IFwiXFxcXFwiIHx8IG5vbkFTQ0lJaWRlbnRpZmllclN0YXJ0LnRlc3QoY2gpKSByZXR1cm4gcmVhZFdvcmQoKTtcbiAgICAgIHJhaXNlKHRva1BvcywgXCJVbmV4cGVjdGVkIGNoYXJhY3RlciAnXCIgKyBjaCArIFwiJ1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIHRvaztcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmlzaE9wKHR5cGUsIHNpemUpIHtcbiAgICB2YXIgc3RyID0gaW5wdXQuc2xpY2UodG9rUG9zLCB0b2tQb3MgKyBzaXplKTtcbiAgICB0b2tQb3MgKz0gc2l6ZTtcbiAgICBmaW5pc2hUb2tlbih0eXBlLCBzdHIpO1xuICB9XG5cbiAgLy8gUGFyc2UgYSByZWd1bGFyIGV4cHJlc3Npb24uIFNvbWUgY29udGV4dC1hd2FyZW5lc3MgaXMgbmVjZXNzYXJ5LFxuICAvLyBzaW5jZSBhICcvJyBpbnNpZGUgYSAnW10nIHNldCBkb2VzIG5vdCBlbmQgdGhlIGV4cHJlc3Npb24uXG5cbiAgZnVuY3Rpb24gcmVhZFJlZ2V4cCgpIHtcbiAgICB2YXIgY29udGVudCA9IFwiXCIsIGVzY2FwZWQsIGluQ2xhc3MsIHN0YXJ0ID0gdG9rUG9zLCB2YWx1ZTtcbiAgICBmb3IgKDs7KSB7XG4gICAgICBpZiAodG9rUG9zID49IGlucHV0TGVuKSByYWlzZShzdGFydCwgXCJVbnRlcm1pbmF0ZWQgcmVndWxhciBleHByZXNzaW9uXCIpO1xuICAgICAgdmFyIGNoID0gaW5wdXQuY2hhckF0KHRva1Bvcyk7XG4gICAgICBpZiAobmV3bGluZS50ZXN0KGNoKSkgcmFpc2Uoc3RhcnQsIFwiVW50ZXJtaW5hdGVkIHJlZ3VsYXIgZXhwcmVzc2lvblwiKTtcbiAgICAgIGlmICghZXNjYXBlZCkge1xuICAgICAgICBpZiAoY2ggPT09IFwiW1wiKSBpbkNsYXNzID0gdHJ1ZTtcbiAgICAgICAgZWxzZSBpZiAoY2ggPT09IFwiXVwiICYmIGluQ2xhc3MpIGluQ2xhc3MgPSBmYWxzZTtcbiAgICAgICAgZWxzZSBpZiAoY2ggPT09IFwiL1wiICYmICFpbkNsYXNzKSBicmVhaztcbiAgICAgICAgZXNjYXBlZCA9IGNoID09PSBcIlxcXFxcIjtcbiAgICAgIH0gZWxzZSBlc2NhcGVkID0gZmFsc2U7XG4gICAgICArK3Rva1BvcztcbiAgICB9XG4gICAgY29udGVudCA9IGlucHV0LnNsaWNlKHN0YXJ0LCB0b2tQb3MpO1xuICAgICsrdG9rUG9zO1xuICAgIC8vIE5lZWQgdG8gdXNlIGByZWFkV29yZDFgIGJlY2F1c2UgJ1xcdVhYWFgnIHNlcXVlbmNlcyBhcmUgYWxsb3dlZFxuICAgIC8vIGhlcmUgKGRvbid0IGFzaykuXG4gICAgdmFyIG1vZHMgPSByZWFkV29yZDEoKTtcbiAgICBpZiAobW9kcyAmJiAhL15bZ21zaXldKiQvLnRlc3QobW9kcykpIHJhaXNlKHN0YXJ0LCBcIkludmFsaWQgcmVndWxhciBleHByZXNzaW9uIGZsYWdcIik7XG4gICAgdHJ5IHtcbiAgICAgIHZhbHVlID0gbmV3IFJlZ0V4cChjb250ZW50LCBtb2RzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoZSBpbnN0YW5jZW9mIFN5bnRheEVycm9yKSByYWlzZShzdGFydCwgXCJFcnJvciBwYXJzaW5nIHJlZ3VsYXIgZXhwcmVzc2lvbjogXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgcmFpc2UoZSk7XG4gICAgfVxuICAgIHJldHVybiBmaW5pc2hUb2tlbihfcmVnZXhwLCB2YWx1ZSk7XG4gIH1cblxuICAvLyBSZWFkIGFuIGludGVnZXIgaW4gdGhlIGdpdmVuIHJhZGl4LiBSZXR1cm4gbnVsbCBpZiB6ZXJvIGRpZ2l0c1xuICAvLyB3ZXJlIHJlYWQsIHRoZSBpbnRlZ2VyIHZhbHVlIG90aGVyd2lzZS4gV2hlbiBgbGVuYCBpcyBnaXZlbiwgdGhpc1xuICAvLyB3aWxsIHJldHVybiBgbnVsbGAgdW5sZXNzIHRoZSBpbnRlZ2VyIGhhcyBleGFjdGx5IGBsZW5gIGRpZ2l0cy5cblxuICBmdW5jdGlvbiByZWFkSW50KHJhZGl4LCBsZW4pIHtcbiAgICB2YXIgc3RhcnQgPSB0b2tQb3MsIHRvdGFsID0gMDtcbiAgICBmb3IgKHZhciBpID0gMCwgZSA9IGxlbiA9PSBudWxsID8gSW5maW5pdHkgOiBsZW47IGkgPCBlOyArK2kpIHtcbiAgICAgIHZhciBjb2RlID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpLCB2YWw7XG4gICAgICBpZiAoY29kZSA+PSA5NykgdmFsID0gY29kZSAtIDk3ICsgMTA7IC8vIGFcbiAgICAgIGVsc2UgaWYgKGNvZGUgPj0gNjUpIHZhbCA9IGNvZGUgLSA2NSArIDEwOyAvLyBBXG4gICAgICBlbHNlIGlmIChjb2RlID49IDQ4ICYmIGNvZGUgPD0gNTcpIHZhbCA9IGNvZGUgLSA0ODsgLy8gMC05XG4gICAgICBlbHNlIHZhbCA9IEluZmluaXR5O1xuICAgICAgaWYgKHZhbCA+PSByYWRpeCkgYnJlYWs7XG4gICAgICArK3Rva1BvcztcbiAgICAgIHRvdGFsID0gdG90YWwgKiByYWRpeCArIHZhbDtcbiAgICB9XG4gICAgaWYgKHRva1BvcyA9PT0gc3RhcnQgfHwgbGVuICE9IG51bGwgJiYgdG9rUG9zIC0gc3RhcnQgIT09IGxlbikgcmV0dXJuIG51bGw7XG5cbiAgICByZXR1cm4gdG90YWw7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkSGV4TnVtYmVyKCkge1xuICAgIHRva1BvcyArPSAyOyAvLyAweFxuICAgIHZhciB2YWwgPSByZWFkSW50KDE2KTtcbiAgICBpZiAodmFsID09IG51bGwpIHJhaXNlKHRva1N0YXJ0ICsgMiwgXCJFeHBlY3RlZCBoZXhhZGVjaW1hbCBudW1iZXJcIik7XG4gICAgaWYgKGlzSWRlbnRpZmllclN0YXJ0KGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKSkpIHJhaXNlKHRva1BvcywgXCJJZGVudGlmaWVyIGRpcmVjdGx5IGFmdGVyIG51bWJlclwiKTtcbiAgICByZXR1cm4gZmluaXNoVG9rZW4oX251bSwgdmFsKTtcbiAgfVxuXG4gIC8vIFJlYWQgYW4gaW50ZWdlciwgb2N0YWwgaW50ZWdlciwgb3IgZmxvYXRpbmctcG9pbnQgbnVtYmVyLlxuXG4gIGZ1bmN0aW9uIHJlYWROdW1iZXIoc3RhcnRzV2l0aERvdCkge1xuICAgIHZhciBzdGFydCA9IHRva1BvcywgaXNGbG9hdCA9IGZhbHNlLCBvY3RhbCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKSA9PT0gNDg7XG4gICAgaWYgKCFzdGFydHNXaXRoRG90ICYmIHJlYWRJbnQoMTApID09PSBudWxsKSByYWlzZShzdGFydCwgXCJJbnZhbGlkIG51bWJlclwiKTtcbiAgICBpZiAoaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpID09PSA0Nikge1xuICAgICAgKyt0b2tQb3M7XG4gICAgICByZWFkSW50KDEwKTtcbiAgICAgIGlzRmxvYXQgPSB0cnVlO1xuICAgIH1cbiAgICB2YXIgbmV4dCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKTtcbiAgICBpZiAobmV4dCA9PT0gNjkgfHwgbmV4dCA9PT0gMTAxKSB7IC8vICdlRSdcbiAgICAgIG5leHQgPSBpbnB1dC5jaGFyQ29kZUF0KCsrdG9rUG9zKTtcbiAgICAgIGlmIChuZXh0ID09PSA0MyB8fCBuZXh0ID09PSA0NSkgKyt0b2tQb3M7IC8vICcrLSdcbiAgICAgIGlmIChyZWFkSW50KDEwKSA9PT0gbnVsbCkgcmFpc2Uoc3RhcnQsIFwiSW52YWxpZCBudW1iZXJcIik7XG4gICAgICBpc0Zsb2F0ID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGlzSWRlbnRpZmllclN0YXJ0KGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKSkpIHJhaXNlKHRva1BvcywgXCJJZGVudGlmaWVyIGRpcmVjdGx5IGFmdGVyIG51bWJlclwiKTtcblxuICAgIHZhciBzdHIgPSBpbnB1dC5zbGljZShzdGFydCwgdG9rUG9zKSwgdmFsO1xuICAgIGlmIChpc0Zsb2F0KSB2YWwgPSBwYXJzZUZsb2F0KHN0cik7XG4gICAgZWxzZSBpZiAoIW9jdGFsIHx8IHN0ci5sZW5ndGggPT09IDEpIHZhbCA9IHBhcnNlSW50KHN0ciwgMTApO1xuICAgIGVsc2UgaWYgKC9bODldLy50ZXN0KHN0cikgfHwgc3RyaWN0KSByYWlzZShzdGFydCwgXCJJbnZhbGlkIG51bWJlclwiKTtcbiAgICBlbHNlIHZhbCA9IHBhcnNlSW50KHN0ciwgOCk7XG4gICAgcmV0dXJuIGZpbmlzaFRva2VuKF9udW0sIHZhbCk7XG4gIH1cblxuICAvLyBSZWFkIGEgc3RyaW5nIHZhbHVlLCBpbnRlcnByZXRpbmcgYmFja3NsYXNoLWVzY2FwZXMuXG5cbiAgZnVuY3Rpb24gcmVhZFN0cmluZyhxdW90ZSkge1xuICAgIHRva1BvcysrO1xuICAgIHZhciBjaCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKTtcbiAgICB2YXIgdHJpcGxlUXVvdGVkID0gZmFsc2U7XG4gICAgaWYgKGNoID09PSBxdW90ZSAmJiBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcysxKSA9PT0gcXVvdGUpIHtcbiAgICAgIHRyaXBsZVF1b3RlZCA9IHRydWU7XG4gICAgICB0b2tQb3MgKz0gMjtcbiAgICB9XG4gICAgdmFyIG91dCA9IFwiXCI7XG4gICAgZm9yICg7Oykge1xuICAgICAgaWYgKHRva1BvcyA+PSBpbnB1dExlbikgcmFpc2UodG9rU3RhcnQsIFwiVW50ZXJtaW5hdGVkIHN0cmluZyBjb25zdGFudFwiKTtcbiAgICAgIHZhciBjaCA9IGlucHV0LmNoYXJDb2RlQXQodG9rUG9zKTtcbiAgICAgIGlmIChjaCA9PT0gcXVvdGUpIHtcbiAgICAgICAgaWYgKHRyaXBsZVF1b3RlZCkge1xuICAgICAgICAgIGlmIChpbnB1dC5jaGFyQ29kZUF0KHRva1BvcysxKSA9PT0gcXVvdGUgJiZcbiAgICAgICAgICAgICAgaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MrMikgPT09IHF1b3RlKSB7XG4gICAgICAgICAgICB0b2tQb3MgKz0gMztcbiAgICAgICAgICAgIHJldHVybiBmaW5pc2hUb2tlbihfc3RyaW5nLCBvdXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICArK3Rva1BvcztcbiAgICAgICAgICByZXR1cm4gZmluaXNoVG9rZW4oX3N0cmluZywgb3V0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGNoID09PSA5MikgeyAvLyAnXFwnXG4gICAgICAgIGNoID0gaW5wdXQuY2hhckNvZGVBdCgrK3Rva1Bvcyk7XG4gICAgICAgIHZhciBvY3RhbCA9IC9eWzAtN10rLy5leGVjKGlucHV0LnNsaWNlKHRva1BvcywgdG9rUG9zICsgMykpO1xuICAgICAgICBpZiAob2N0YWwpIG9jdGFsID0gb2N0YWxbMF07XG4gICAgICAgIHdoaWxlIChvY3RhbCAmJiBwYXJzZUludChvY3RhbCwgOCkgPiAyNTUpIG9jdGFsID0gb2N0YWwuc2xpY2UoMCwgLTEpO1xuICAgICAgICBpZiAob2N0YWwgPT09IFwiMFwiKSBvY3RhbCA9IG51bGw7XG4gICAgICAgICsrdG9rUG9zO1xuICAgICAgICBpZiAob2N0YWwpIHtcbiAgICAgICAgICBpZiAoc3RyaWN0KSByYWlzZSh0b2tQb3MgLSAyLCBcIk9jdGFsIGxpdGVyYWwgaW4gc3RyaWN0IG1vZGVcIik7XG4gICAgICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUocGFyc2VJbnQob2N0YWwsIDgpKTtcbiAgICAgICAgICB0b2tQb3MgKz0gb2N0YWwubGVuZ3RoIC0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzd2l0Y2ggKGNoKSB7XG4gICAgICAgICAgY2FzZSAxMTA6IG91dCArPSBcIlxcblwiOyBicmVhazsgLy8gJ24nIC0+ICdcXG4nXG4gICAgICAgICAgY2FzZSAxMTQ6IG91dCArPSBcIlxcclwiOyBicmVhazsgLy8gJ3InIC0+ICdcXHInXG4gICAgICAgICAgY2FzZSAxMjA6IG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHJlYWRIZXhDaGFyKDIpKTsgYnJlYWs7IC8vICd4J1xuICAgICAgICAgIGNhc2UgMTE3OiBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyZWFkSGV4Q2hhcig0KSk7IGJyZWFrOyAvLyAndSdcbiAgICAgICAgICBjYXNlIDg1OiAvLyAnVSdcbiAgICAgICAgICAgIGNoID0gcmVhZEhleENoYXIoOCk7XG4gICAgICAgICAgICBpZiAoY2ggPCAweEZGRkYgJiYgKGNoIDwgMHhEODAwIHx8IDB4REJGRiA8IGNoKSkgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOyAvLyBJZiBpdCdzIFVURi0xNlxuICAgICAgICAgICAgZWxzZSB7IC8vIElmIHdlIG5lZWQgVUNTLTJcbiAgICAgICAgICAgICAgY2ggLT0gMHgxMDAwMDtcbiAgICAgICAgICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGNoPj4xMCkrMHhkODAwKStTdHJpbmcuZnJvbUNoYXJDb2RlKChjaCUweDQwMCkrMHhkYzAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgMTE2OiBvdXQgKz0gXCJcXHRcIjsgYnJlYWs7IC8vICd0JyAtPiAnXFx0J1xuICAgICAgICAgIGNhc2UgOTg6IG91dCArPSBcIlxcYlwiOyBicmVhazsgLy8gJ2InIC0+ICdcXGInXG4gICAgICAgICAgY2FzZSAxMTg6IG91dCArPSBcIlxcdTAwMGJcIjsgYnJlYWs7IC8vICd2JyAtPiAnXFx1MDAwYidcbiAgICAgICAgICBjYXNlIDEwMjogb3V0ICs9IFwiXFxmXCI7IGJyZWFrOyAvLyAnZicgLT4gJ1xcZidcbiAgICAgICAgICBjYXNlIDQ4OiBvdXQgKz0gXCJcXDBcIjsgYnJlYWs7IC8vIDAgLT4gJ1xcMCdcbiAgICAgICAgICBjYXNlIDEzOiBpZiAoaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpID09PSAxMCkgKyt0b2tQb3M7IC8vICdcXHJcXG4nXG4gICAgICAgICAgY2FzZSAxMDogLy8gJyBcXG4nXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHsgdG9rTGluZVN0YXJ0ID0gdG9rUG9zOyArK3Rva0N1ckxpbmU7IH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6IG91dCArPSAnXFxcXCcgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsgYnJlYWs7IC8vIFB5dGhvbiBkb2Vzbid0IHJlbW92ZSBzbGFzaGVzIG9uIGZhaWxlZCBlc2NhcGVzXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNOZXdsaW5lKGNoKSkge1xuICAgICAgICAgIGlmICh0cmlwbGVRdW90ZWQpIHtcbiAgICAgICAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTtcbiAgICAgICAgICAgICsrdG9rUG9zO1xuICAgICAgICAgICAgaWYgKGNoID09PSAxMyAmJiBpbnB1dC5jaGFyQ29kZUF0KHRva1BvcykgPT09IDEwKSB7XG4gICAgICAgICAgICAgICsrdG9rUG9zO1xuICAgICAgICAgICAgICBvdXQgKz0gXCJcXG5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9uKSB7IHRva0xpbmVTdGFydCA9IHRva1BvczsgKyt0b2tDdXJMaW5lOyB9XG4gICAgICAgICAgfSBlbHNlIHJhaXNlKHRva1N0YXJ0LCBcIlVudGVybWluYXRlZCBzdHJpbmcgY29uc3RhbnRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOyAvLyAnXFwnXG4gICAgICAgICAgKyt0b2tQb3M7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBVc2VkIHRvIHJlYWQgY2hhcmFjdGVyIGVzY2FwZSBzZXF1ZW5jZXMgKCdcXHgnLCAnXFx1JywgJ1xcVScpLlxuXG4gIGZ1bmN0aW9uIHJlYWRIZXhDaGFyKGxlbikge1xuICAgIHZhciBuID0gcmVhZEludCgxNiwgbGVuKTtcbiAgICBpZiAobiA9PT0gbnVsbCkgcmFpc2UodG9rU3RhcnQsIFwiQmFkIGNoYXJhY3RlciBlc2NhcGUgc2VxdWVuY2VcIik7XG4gICAgcmV0dXJuIG47XG4gIH1cblxuICAvLyBVc2VkIHRvIHNpZ25hbCB0byBjYWxsZXJzIG9mIGByZWFkV29yZDFgIHdoZXRoZXIgdGhlIHdvcmRcbiAgLy8gY29udGFpbmVkIGFueSBlc2NhcGUgc2VxdWVuY2VzLiBUaGlzIGlzIG5lZWRlZCBiZWNhdXNlIHdvcmRzIHdpdGhcbiAgLy8gZXNjYXBlIHNlcXVlbmNlcyBtdXN0IG5vdCBiZSBpbnRlcnByZXRlZCBhcyBrZXl3b3Jkcy5cblxuICB2YXIgY29udGFpbnNFc2M7XG5cbiAgLy8gUmVhZCBhbiBpZGVudGlmaWVyLCBhbmQgcmV0dXJuIGl0IGFzIGEgc3RyaW5nLiBTZXRzIGBjb250YWluc0VzY2BcbiAgLy8gdG8gd2hldGhlciB0aGUgd29yZCBjb250YWluZWQgYSAnXFx1JyBlc2NhcGUuXG4gIC8vXG4gIC8vIE9ubHkgYnVpbGRzIHVwIHRoZSB3b3JkIGNoYXJhY3Rlci1ieS1jaGFyYWN0ZXIgd2hlbiBpdCBhY3R1YWxseVxuICAvLyBjb250YWluZWRzIGFuIGVzY2FwZSwgYXMgYSBtaWNyby1vcHRpbWl6YXRpb24uXG5cbiAgZnVuY3Rpb24gcmVhZFdvcmQxKCkge1xuICAgIGNvbnRhaW5zRXNjID0gZmFsc2U7XG4gICAgdmFyIHdvcmQsIGZpcnN0ID0gdHJ1ZSwgc3RhcnQgPSB0b2tQb3M7XG4gICAgZm9yICg7Oykge1xuICAgICAgdmFyIGNoID0gaW5wdXQuY2hhckNvZGVBdCh0b2tQb3MpO1xuICAgICAgaWYgKGlzSWRlbnRpZmllckNoYXIoY2gpKSB7XG4gICAgICAgIGlmIChjb250YWluc0VzYykgd29yZCArPSBpbnB1dC5jaGFyQXQodG9rUG9zKTtcbiAgICAgICAgKyt0b2tQb3M7XG4gICAgICB9IGVsc2UgaWYgKGNoID09PSA5MikgeyAvLyBcIlxcXCJcbiAgICAgICAgaWYgKCFjb250YWluc0VzYykgd29yZCA9IGlucHV0LnNsaWNlKHN0YXJ0LCB0b2tQb3MpO1xuICAgICAgICBjb250YWluc0VzYyA9IHRydWU7XG4gICAgICAgIGlmIChpbnB1dC5jaGFyQ29kZUF0KCsrdG9rUG9zKSAhPSAxMTcpIC8vIFwidVwiXG4gICAgICAgICAgcmFpc2UodG9rUG9zLCBcIkV4cGVjdGluZyBVbmljb2RlIGVzY2FwZSBzZXF1ZW5jZSBcXFxcdVhYWFhcIik7XG4gICAgICAgICsrdG9rUG9zO1xuICAgICAgICB2YXIgZXNjID0gcmVhZEhleENoYXIoNCk7XG4gICAgICAgIHZhciBlc2NTdHIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGVzYyk7XG4gICAgICAgIGlmICghZXNjU3RyKSByYWlzZSh0b2tQb3MgLSAxLCBcIkludmFsaWQgVW5pY29kZSBlc2NhcGVcIik7XG4gICAgICAgIGlmICghKGZpcnN0ID8gaXNJZGVudGlmaWVyU3RhcnQoZXNjKSA6IGlzSWRlbnRpZmllckNoYXIoZXNjKSkpXG4gICAgICAgICAgcmFpc2UodG9rUG9zIC0gNCwgXCJJbnZhbGlkIFVuaWNvZGUgZXNjYXBlXCIpO1xuICAgICAgICB3b3JkICs9IGVzY1N0cjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZmlyc3QgPSBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnRhaW5zRXNjID8gd29yZCA6IGlucHV0LnNsaWNlKHN0YXJ0LCB0b2tQb3MpO1xuICB9XG5cbiAgLy8gUmVhZCBhbiBpZGVudGlmaWVyIG9yIGtleXdvcmQgdG9rZW4uIFdpbGwgY2hlY2sgZm9yIHJlc2VydmVkXG4gIC8vIHdvcmRzIHdoZW4gbmVjZXNzYXJ5LlxuXG4gIGZ1bmN0aW9uIHJlYWRXb3JkKCkge1xuICAgIHZhciB3b3JkID0gcmVhZFdvcmQxKCk7XG4gICAgdmFyIHR5cGUgPSBfbmFtZTtcbiAgICBpZiAoIWNvbnRhaW5zRXNjICYmIGlzS2V5d29yZCh3b3JkKSlcbiAgICAgIHR5cGUgPSBrZXl3b3JkVHlwZXNbd29yZF07XG4gICAgcmV0dXJuIGZpbmlzaFRva2VuKHR5cGUsIHdvcmQpO1xuICB9XG5cbiAgLy8gIyMgUGFyc2VyXG5cbiAgLy8gQSByZWN1cnNpdmUgZGVzY2VudCBwYXJzZXIgb3BlcmF0ZXMgYnkgZGVmaW5pbmcgZnVuY3Rpb25zIGZvciBhbGxcbiAgLy8gc3ludGFjdGljIGVsZW1lbnRzLCBhbmQgcmVjdXJzaXZlbHkgY2FsbGluZyB0aG9zZSwgZWFjaCBmdW5jdGlvblxuICAvLyBhZHZhbmNpbmcgdGhlIGlucHV0IHN0cmVhbSBhbmQgcmV0dXJuaW5nIGFuIEFTVCBub2RlLiBQcmVjZWRlbmNlXG4gIC8vIG9mIGNvbnN0cnVjdHMgKGZvciBleGFtcGxlLCB0aGUgZmFjdCB0aGF0IGAheFsxXWAgbWVhbnMgYCEoeFsxXSlgXG4gIC8vIGluc3RlYWQgb2YgYCgheClbMV1gIGlzIGhhbmRsZWQgYnkgdGhlIGZhY3QgdGhhdCB0aGUgcGFyc2VyXG4gIC8vIGZ1bmN0aW9uIHRoYXQgcGFyc2VzIHVuYXJ5IHByZWZpeCBvcGVyYXRvcnMgaXMgY2FsbGVkIGZpcnN0LCBhbmRcbiAgLy8gaW4gdHVybiBjYWxscyB0aGUgZnVuY3Rpb24gdGhhdCBwYXJzZXMgYFtdYCBzdWJzY3JpcHRzIC0gdGhhdFxuICAvLyB3YXksIGl0J2xsIHJlY2VpdmUgdGhlIG5vZGUgZm9yIGB4WzFdYCBhbHJlYWR5IHBhcnNlZCwgYW5kIHdyYXBzXG4gIC8vICp0aGF0KiBpbiB0aGUgdW5hcnkgb3BlcmF0b3Igbm9kZS5cbiAgLy9cbiAgLy8gQWNvcm4gdXNlcyBhbiBbb3BlcmF0b3IgcHJlY2VkZW5jZSBwYXJzZXJdW29wcF0gdG8gaGFuZGxlIGJpbmFyeVxuICAvLyBvcGVyYXRvciBwcmVjZWRlbmNlLCBiZWNhdXNlIGl0IGlzIG11Y2ggbW9yZSBjb21wYWN0IHRoYW4gdXNpbmdcbiAgLy8gdGhlIHRlY2huaXF1ZSBvdXRsaW5lZCBhYm92ZSwgd2hpY2ggdXNlcyBkaWZmZXJlbnQsIG5lc3RpbmdcbiAgLy8gZnVuY3Rpb25zIHRvIHNwZWNpZnkgcHJlY2VkZW5jZSwgZm9yIGFsbCBvZiB0aGUgdGVuIGJpbmFyeVxuICAvLyBwcmVjZWRlbmNlIGxldmVscyB0aGF0IEphdmFTY3JpcHQgZGVmaW5lcy5cbiAgLy9cbiAgLy8gW29wcF06IGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvT3BlcmF0b3ItcHJlY2VkZW5jZV9wYXJzZXJcblxuICAvLyAjIyMgUGFyc2VyIHV0aWxpdGllc1xuXG4gIC8vIENvbnRpbnVlIHRvIHRoZSBuZXh0IHRva2VuLlxuXG4gIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgbGFzdFN0YXJ0ID0gdG9rU3RhcnQ7XG4gICAgbGFzdEVuZCA9IHRva0VuZDtcbiAgICBsYXN0RW5kTG9jID0gdG9rRW5kTG9jO1xuICAgIHJlYWRUb2tlbigpO1xuICB9XG5cbiAgLy8gRW50ZXIgc3RyaWN0IG1vZGUuIFJlLXJlYWRzIHRoZSBuZXh0IHRva2VuIHRvIHBsZWFzZSBwZWRhbnRpY1xuICAvLyB0ZXN0cyAoXCJ1c2Ugc3RyaWN0XCI7IDAxMDsgLS0gc2hvdWxkIGZhaWwpLlxuXG4gIGZ1bmN0aW9uIHNldFN0cmljdChzdHJjdCkge1xuICAgIHN0cmljdCA9IHN0cmN0O1xuICAgIHRva1BvcyA9IHRva1N0YXJ0O1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykge1xuICAgICAgd2hpbGUgKHRva1BvcyA8IHRva0xpbmVTdGFydCkge1xuICAgICAgICB0b2tMaW5lU3RhcnQgPSBpbnB1dC5sYXN0SW5kZXhPZihcIlxcblwiLCB0b2tMaW5lU3RhcnQgLSAyKSArIDE7XG4gICAgICAgIC0tdG9rQ3VyTGluZTtcbiAgICAgIH1cbiAgICB9XG4gICAgc2tpcFNwYWNlKCk7XG4gICAgcmVhZFRva2VuKCk7XG4gIH1cblxuICAvLyBTdGFydCBhbiBBU1Qgbm9kZSwgYXR0YWNoaW5nIGEgc3RhcnQgb2Zmc2V0LlxuXG4gIGZ1bmN0aW9uIE5vZGUoKSB7XG4gICAgdGhpcy50eXBlID0gbnVsbDtcbiAgfVxuXG4gIGV4cG9ydHMuTm9kZSA9IE5vZGU7XG5cbiAgZnVuY3Rpb24gU291cmNlTG9jYXRpb24oKSB7XG4gICAgdGhpcy5zdGFydCA9IHRva1N0YXJ0TG9jO1xuICAgIHRoaXMuZW5kID0gbnVsbDtcbiAgICBpZiAoc291cmNlRmlsZSAhPT0gbnVsbCkgdGhpcy5zb3VyY2UgPSBzb3VyY2VGaWxlO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RhcnROb2RlKCkge1xuICAgIHZhciBub2RlID0gbmV3IE5vZGUoKTtcbiAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpXG4gICAgICBub2RlLmxvYyA9IG5ldyBTb3VyY2VMb2NhdGlvbigpO1xuICAgIGlmIChvcHRpb25zLmRpcmVjdFNvdXJjZUZpbGUpXG4gICAgICBub2RlLnNvdXJjZUZpbGUgPSBvcHRpb25zLmRpcmVjdFNvdXJjZUZpbGU7XG4gICAgaWYgKG9wdGlvbnMucmFuZ2VzKVxuICAgICAgbm9kZS5yYW5nZSA9IFt0b2tTdGFydCwgMF07XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICAvLyBGaW5pc2ggYW4gQVNUIG5vZGUsIGFkZGluZyBgdHlwZWAgYW5kIGBlbmRgIHByb3BlcnRpZXMuXG5cbiAgZnVuY3Rpb24gZmluaXNoTm9kZShub2RlLCB0eXBlKSB7XG4gICAgbm9kZS50eXBlID0gdHlwZTtcbiAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpXG4gICAgICBub2RlLmxvYy5lbmQgPSBsYXN0RW5kTG9jO1xuICAgIGlmIChvcHRpb25zLnJhbmdlcylcbiAgICAgIG5vZGUucmFuZ2VbMV0gPSBsYXN0RW5kO1xuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgLy8gU3RhcnQgYSBub2RlIHdob3NlIHN0YXJ0IG9mZnNldCBpbmZvcm1hdGlvbiBzaG91bGQgYmUgYmFzZWQgb25cbiAgLy8gdGhlIHN0YXJ0IG9mIGFub3RoZXIgbm9kZS4gRm9yIGV4YW1wbGUsIGEgYmluYXJ5IG9wZXJhdG9yIG5vZGUgaXNcbiAgLy8gb25seSBzdGFydGVkIGFmdGVyIGl0cyBsZWZ0LWhhbmQgc2lkZSBoYXMgYWxyZWFkeSBiZWVuIHBhcnNlZC5cblxuICBmdW5jdGlvbiBzdGFydE5vZGVGcm9tKG90aGVyKSB7XG4gICAgdmFyIG5vZGUgPSBuZXcgTm9kZSgpO1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykge1xuICAgICAgbm9kZS5sb2MgPSBuZXcgU291cmNlTG9jYXRpb24oKTtcbiAgICAgIG5vZGUubG9jLnN0YXJ0ID0gb3RoZXIubG9jLnN0YXJ0O1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5yYW5nZXMpXG4gICAgICBub2RlLnJhbmdlID0gW290aGVyLnJhbmdlWzBdLCAwXTtcblxuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgLy8gIyMgTm9kZSBjcmVhdGlvbiB1dGlsaXRpZXNcblxuICB2YXIgZ2V0Tm9kZUNyZWF0b3IgPSBleHBvcnRzLmdldE5vZGVDcmVhdG9yID0gZnVuY3Rpb24oc3RhcnROb2RlLCBzdGFydE5vZGVGcm9tLCBmaW5pc2hOb2RlLCB1bnBhY2tUdXBsZSkge1xuXG4gICAgcmV0dXJuIHtcblxuICAgICAgLy8gRmluaXNoIGEgbm9kZSB3aG9zZSBlbmQgb2Zmc2V0IGluZm9ybWF0aW9uIHNob3VsZCBiZSBiYXNlZCBvblxuICAgICAgLy8gdGhlIGVuZCBvZiBhbm90aGVyIG5vZGUuICBGb3IgZXhhbXBsZSwgY3JlYXRlTm9kZSogZnVuY3Rpb25zXG4gICAgICAvLyBhcmUgdXNlZCB0byBjcmVhdGUgZXh0cmEgQVNUIG5vZGVzIHdoaWNoIG1heSBiZSBiYXNlZCBvbiBhIHNpbmdsZVxuICAgICAgLy8gcGFyc2VkIHVzZXIgY29kZSBub2RlLlxuXG4gICAgICBmaW5pc2hOb2RlRnJvbTogZnVuY3Rpb24gKGVuZE5vZGUsIG5vZGUsIHR5cGUpIHtcbiAgICAgICAgbm9kZS50eXBlID0gdHlwZTtcbiAgICAgICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSBub2RlLmxvYy5lbmQgPSBlbmROb2RlLmxvYy5lbmQ7XG4gICAgICAgIGlmIChvcHRpb25zLnJhbmdlcykgbm9kZS5yYW5nZVsxXSA9IGVuZE5vZGUucmFuZ2VbMV07XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgICAgfSxcblxuICAgICAgLy8gQ3JlYXRlIGFuIEFTVCBub2RlIHVzaW5nIHN0YXJ0IG9mZnNldHNcblxuICAgICAgY3JlYXRlTm9kZUZyb206IGZ1bmN0aW9uIChzdGFydE5vZGUsIHR5cGUsIHByb3BzKSB7XG4gICAgICAgIHZhciBub2RlID0gc3RhcnROb2RlRnJvbShzdGFydE5vZGUpO1xuICAgICAgICBmb3IgKHZhciBwcm9wIGluIHByb3BzKSBub2RlW3Byb3BdID0gcHJvcHNbcHJvcF07XG4gICAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIHR5cGUpO1xuICAgICAgfSxcblxuICAgICAgLy8gQ3JlYXRlIGFuIEFTVCBub2RlIHVzaW5nIHN0YXJ0IGFuZCBlbmQgb2Zmc2V0c1xuXG4gICAgICBjcmVhdGVOb2RlU3BhbjogZnVuY3Rpb24gKHN0YXJ0Tm9kZSwgZW5kTm9kZSwgdHlwZSwgcHJvcHMpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGVGcm9tKHN0YXJ0Tm9kZSk7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gcHJvcHMpIG5vZGVbcHJvcF0gPSBwcm9wc1twcm9wXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZUZyb20oZW5kTm9kZSwgbm9kZSwgdHlwZSk7XG4gICAgICB9LFxuXG4gICAgICBjcmVhdGVHZW5lcmF0ZWROb2RlU3BhbjogZnVuY3Rpb24gKHN0YXJ0Tm9kZSwgZW5kTm9kZSwgdHlwZSwgcHJvcHMpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGVGcm9tKHN0YXJ0Tm9kZSk7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gcHJvcHMpIG5vZGVbcHJvcF0gPSBwcm9wc1twcm9wXTtcbiAgICAgICAgbm9kZS51c2VyQ29kZSA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlRnJvbShlbmROb2RlLCBub2RlLCB0eXBlKTtcbiAgICAgIH0sXG5cbiAgICAgIC8vIHdoaWxlIChfX2Zvcm1hbHNJbmRleCA8IF9fcGFyYW1zLmZvcm1hbHMubGVuZ3RoKSB7XG4gICAgICAvLyAgIDxhcmdzSWQ+LnB1c2goX19wYXJhbXMuZm9ybWFsc1tfX2Zvcm1hbHNJbmRleCsrXSk7IH1cbiAgICAgIGNyZWF0ZU5vZGVBcmdzV2hpbGVDb25zZXF1ZW50OiBmdW5jdGlvbiAoYXJnc0lkLCBzKSB7XG4gICAgICAgIHZhciBfX3BhcmFtc0Zvcm1hbHMgPSB0aGlzLmNyZWF0ZU5vZGVNZW1iSWRzKGFyZ3NJZCwgJ19fcGFyYW1zJyArIHMsICdmb3JtYWxzJyk7XG4gICAgICAgIHZhciBfX2Zvcm1hbHNJbmRleElkID0gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fZm9ybWFsc0luZGV4JyArIHMgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIldoaWxlU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICB0ZXN0OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkJpbmFyeUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgb3BlcmF0b3I6ICc8JywgbGVmdDogX19mb3JtYWxzSW5kZXhJZCxcbiAgICAgICAgICAgIHJpZ2h0OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIk1lbWJlckV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsIG9iamVjdDogX19wYXJhbXNGb3JtYWxzLFxuICAgICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ2xlbmd0aCcgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSksXG4gICAgICAgICAgYm9keTogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJCbG9ja1N0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICBib2R5OiBbdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgZXhwcmVzc2lvbjogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJDYWxsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgY2FsbGVlOiB0aGlzLmNyZWF0ZU5vZGVNZW1iSWRzKGFyZ3NJZCwgYXJnc0lkLm5hbWUsICdwdXNoJyksXG4gICAgICAgICAgICAgICAgYXJndW1lbnRzOiBbdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgIGNvbXB1dGVkOiB0cnVlLCBvYmplY3Q6IF9fcGFyYW1zRm9ybWFscyxcbiAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIlVwZGF0ZUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJysrJywgcHJlZml4OiBmYWxzZSwgYXJndW1lbnQ6IF9fZm9ybWFsc0luZGV4SWRcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSldXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KV1cbiAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICAgIH0sXG5cbiAgICAgIC8vIHsgd2hpbGUgKF9fZm9ybWFsc0luZGV4IDwgX19hcmdzLmxlbmd0aCkge1xuICAgICAgLy8gICA8YXJnc0lkPi5wdXNoKF9fYXJnc1tfX2Zvcm1hbHNJbmRleCsrXSk7IH19XG4gICAgICBjcmVhdGVOb2RlQXJnc0FsdGVybmF0ZTogZnVuY3Rpb24gKGFyZ3NJZCwgcykge1xuICAgICAgICB2YXIgX19hcmdzID0gJ19fYXJncycgKyBzO1xuICAgICAgICB2YXIgX19mb3JtYWxzSW5kZXhJZCA9IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdfX2Zvcm1hbHNJbmRleCcgKyBzIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJCbG9ja1N0YXRlbWVudFwiLCB7XG4gICAgICAgICAgYm9keTogW3RoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiV2hpbGVTdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgdGVzdDogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJCaW5hcnlFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgb3BlcmF0b3I6ICc8JywgbGVmdDogX19mb3JtYWxzSW5kZXhJZCxcbiAgICAgICAgICAgICAgcmlnaHQ6IHRoaXMuY3JlYXRlTm9kZU1lbWJJZHMoYXJnc0lkLCBfX2FyZ3MsICdsZW5ndGgnKVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBib2R5OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkJsb2NrU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgYm9keTogW3RoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihhcmdzSWQsIGFyZ3NJZCwgXCJDYWxsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICBjYWxsZWU6IHRoaXMuY3JlYXRlTm9kZU1lbWJJZHMoYXJnc0lkLCBhcmdzSWQubmFtZSwgJ3B1c2gnKSxcbiAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogW3RoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXB1dGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBvYmplY3Q6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IF9fYXJncyB9KSxcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHk6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYXJnc0lkLCBhcmdzSWQsIFwiVXBkYXRlRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICcrKycsIHByZWZpeDogZmFsc2UsIGFyZ3VtZW50OiBfX2Zvcm1hbHNJbmRleElkXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSldXG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgLy8gcmV0dXJuIChmdW5jdGlvbigpIHs8Ym9keT59KS5jYWxsKHRoaXMpO1xuICAgICAgY3JlYXRlTm9kZUZuQm9keUlpZmU6IGZ1bmN0aW9uIChib2R5KSB7XG4gICAgICAgIHZhciBpaWZlQm9keSA9IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYm9keSwgYm9keSwgXCJGdW5jdGlvbkV4cHJlc3Npb25cIiwge1xuICAgICAgICAgIHBhcmFtczogW10sIGRlZmF1bHRzOiBbXSwgYm9keTogYm9keSwgZ2VuZXJhdG9yOiBmYWxzZSwgZXhwcmVzc2lvbjogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBpaWZlQ2FsbCA9IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4oYm9keSwgYm9keSwgXCJDYWxsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgY2FsbGVlOiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGJvZHksIGJvZHksIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsIG9iamVjdDogaWlmZUJvZHksXG4gICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3Bhbihib2R5LCBib2R5LCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnY2FsbCcgfSlcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBhcmd1bWVudHM6IFt0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKGJvZHksIGJvZHksIFwiVGhpc0V4cHJlc3Npb25cIildXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3Bhbihib2R5LCBib2R5LCBcIlJldHVyblN0YXRlbWVudFwiLCB7IGFyZ3VtZW50OiBpaWZlQ2FsbCB9KTtcbiAgICAgIH0sXG5cbiAgICAgIC8vIEUuZy4gTWF0aC5wb3coMiwgMylcblxuICAgICAgY3JlYXRlTm9kZU1lbWJlckNhbGw6IGZ1bmN0aW9uIChub2RlLCBvYmplY3QsIHByb3BlcnR5LCBhcmdzKSB7XG4gICAgICAgIHZhciBvYmpJZCA9IHRoaXMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogb2JqZWN0IH0pO1xuICAgICAgICB2YXIgcHJvcElkID0gdGhpcy5jcmVhdGVOb2RlRnJvbShub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBwcm9wZXJ0eSB9KTtcbiAgICAgICAgdmFyIG1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBvYmpJZCwgcHJvcGVydHk6IHByb3BJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICBub2RlLmNhbGxlZSA9IG1lbWJlcjtcbiAgICAgICAgbm9kZS5hcmd1bWVudHMgPSBhcmdzO1xuICAgICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkNhbGxFeHByZXNzaW9uXCIpO1xuICAgICAgfSxcblxuICAgICAgLy8gby5wXG4gICAgICBjcmVhdGVOb2RlTWVtYklkczogZnVuY3Rpb24ociwgbywgcCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIk1lbWJlckV4cHJlc3Npb25cIiwge1xuICAgICAgICAgIGNvbXB1dGVkOiBmYWxzZSxcbiAgICAgICAgICBvYmplY3Q6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogbyB9KSxcbiAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBwIH0pXG4gICAgICAgIH0pXG4gICAgICB9LFxuXG4gICAgICAvLyBvW3BdXG4gICAgICBjcmVhdGVOb2RlTWVtYklkTGl0OiBmdW5jdGlvbihyLCBvLCBwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgY29tcHV0ZWQ6IHRydWUsXG4gICAgICAgICAgb2JqZWN0OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG8gfSksXG4gICAgICAgICAgcHJvcGVydHk6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IHAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0sXG5cbiAgICAgIC8vIEUuZy4gcHlSdW50aW1lLm9wcy5hZGRcblxuICAgICAgY3JlYXRlTm9kZU9wc0NhbGxlZTogZnVuY3Rpb24gKG5vZGUsIGZuTmFtZSkge1xuICAgICAgICB2YXIgcnVudGltZUlkID0gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgfSk7XG4gICAgICAgIHZhciBvcHNJZCA9IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJvcHNcIiB9KTtcbiAgICAgICAgdmFyIGFkZElkID0gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBmbk5hbWUgfSk7XG4gICAgICAgIHZhciBvcHNNZW1iZXIgPSB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZUlkLCBwcm9wZXJ0eTogb3BzSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBvcHNNZW1iZXIsIHByb3BlcnR5OiBhZGRJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgfSxcblxuICAgICAgLy8gdmFyIF9fcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiBhcmd1bWVudHNbMF0uZm9ybWFscyAmJiBhcmd1bWVudHNbMF0ua2V5d29yZHMgPyBhcmd1bWVudHNbMF0gOiBudWxsO1xuICAgICAgY3JlYXRlTm9kZVBhcmFtc0NoZWNrOiBmdW5jdGlvbiAociwgcykge1xuICAgICAgICB2YXIgX19wYXJhbXNJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fcGFyYW1zJyArIHMgfSk7XG4gICAgICAgIHZhciBhcmd1bWVudHMwID0gdGhpcy5jcmVhdGVOb2RlTWVtYklkTGl0KHIsICdhcmd1bWVudHMnLCAwKTtcbiAgICAgICAgdmFyIGNoZWNrcyA9IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJDb25kaXRpb25hbEV4cHJlc3Npb25cIiwge1xuICAgICAgICAgIHRlc3Q6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJMb2dpY2FsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICBvcGVyYXRvcjogJyYmJyxcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJMb2dpY2FsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgIG9wZXJhdG9yOiAnJiYnLFxuICAgICAgICAgICAgICBsZWZ0OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiQmluYXJ5RXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgb3BlcmF0b3I6ICc9PT0nLFxuICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMuY3JlYXRlTm9kZU1lbWJJZHMociwgJ2FyZ3VtZW50cycsICdsZW5ndGgnKSxcbiAgICAgICAgICAgICAgICByaWdodDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogMSB9KVxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgcmlnaHQ6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsIG9iamVjdDogYXJndW1lbnRzMCxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnZm9ybWFscycgfSksXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJpZ2h0OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgIGNvbXB1dGVkOiBmYWxzZSwgb2JqZWN0OiBhcmd1bWVudHMwLFxuICAgICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAna2V5d29yZHMnIH0pLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBjb25zZXF1ZW50OiBhcmd1bWVudHMwLFxuICAgICAgICAgIGFsdGVybmF0ZTogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogbnVsbCB9KVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlR2VuZXJhdGVkVmFyRGVjbEZyb21JZChyLCBfX3BhcmFtc0lkLCBjaGVja3MpO1xuICAgICAgfSxcblxuICAgICAgLy8gZnVuY3Rpb24gX19nZXRQYXJhbSh2LCBkKSB7XG4gICAgICAvLyAgIHZhciByID0gZDtcbiAgICAgIC8vICAgaWYgKF9fcGFyYW1zKSB7XG4gICAgICAvLyAgICAgaWYgKF9fZm9ybWFsc0luZGV4IDwgX19wYXJhbXMuZm9ybWFscy5sZW5ndGgpIHtcbiAgICAgIC8vICAgICAgIHIgPSBfX3BhcmFtcy5mb3JtYWxzW19fZm9ybWFsc0luZGV4KytdO1xuICAgICAgLy8gICAgIH0gZWxzZSBpZiAodiBpbiBfX3BhcmFtcy5rZXl3b3Jkcykge1xuICAgICAgLy8gICAgICAgciA9IF9fcGFyYW1zLmtleXdvcmRzW3ZdO1xuICAgICAgLy8gICAgICAgZGVsZXRlIF9fcGFyYW1zLmtleXdvcmRzW3ZdO1xuICAgICAgLy8gICAgIH1cbiAgICAgIC8vICAgfSBlbHNlIGlmIChfX2Zvcm1hbHNJbmRleCA8IF9fYXJncy5sZW5ndGgpIHtcbiAgICAgIC8vICAgICByID0gX19hcmdzW19fZm9ybWFsc0luZGV4KytdO1xuICAgICAgLy8gICB9XG4gICAgICAvLyAgIHJldHVybiByO1xuICAgICAgLy8gfVxuICAgICAgY3JlYXRlTm9kZUdldFBhcmFtRm46IGZ1bmN0aW9uIChyLCBzKSB7XG4gICAgICAgIHZhciBkSWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdkJyB9KTtcbiAgICAgICAgdmFyIHZJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ3YnIH0pO1xuICAgICAgICB2YXIgcklkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAncicgfSk7XG4gICAgICAgIHZhciBfX2Zvcm1hbHNJbmRleElkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19mb3JtYWxzSW5kZXgnICsgcyB9KTtcbiAgICAgICAgdmFyIF9fcGFyYW1zID0gJ19fcGFyYW1zJyArIHM7XG4gICAgICAgIHZhciBfX2dldFBhcmFtID0gJ19fZ2V0UGFyYW0nICsgcztcbiAgICAgICAgdmFyIF9fYXJncyA9ICdfX2FyZ3MnICsgcztcbiAgICAgICAgdmFyIF9fcGFyYW1zRm9ybWFscyA9IHRoaXMuY3JlYXRlTm9kZU1lbWJJZHMociwgX19wYXJhbXMsICdmb3JtYWxzJyk7XG4gICAgICAgIHZhciBfX3BhcmFtc0tleXdvcmRzID0gdGhpcy5jcmVhdGVOb2RlTWVtYklkcyhyLCBfX3BhcmFtcywgJ2tleXdvcmRzJylcbiAgICAgICAgdmFyIF9fcGFyYW1zS2V5d29yZHNWID0gdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBjb21wdXRlZDogdHJ1ZSwgcHJvcGVydHk6IHZJZCwgb2JqZWN0OiBfX3BhcmFtc0tleXdvcmRzIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIkZ1bmN0aW9uRGVjbGFyYXRpb25cIiwge1xuICAgICAgICAgIGlkOiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IF9fZ2V0UGFyYW0gfSksXG4gICAgICAgICAgcGFyYW1zOiBbdklkLCBkSWRdLFxuICAgICAgICAgIGRlZmF1bHRzOiBbXSxcbiAgICAgICAgICBib2R5OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiQmxvY2tTdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgYm9keTogW3RoaXMuY3JlYXRlR2VuZXJhdGVkVmFyRGVjbEZyb21JZChyLCBySWQsIGRJZCksXG4gICAgICAgICAgICAgIHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJJZlN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgdGVzdDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBfX3BhcmFtcyB9KSxcbiAgICAgICAgICAgICAgICBjb25zZXF1ZW50OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiQmxvY2tTdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgICAgICAgYm9keTogW3RoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJJZlN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHRlc3Q6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJCaW5hcnlFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJzwnLCBsZWZ0OiBfX2Zvcm1hbHNJbmRleElkLFxuICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsIG9iamVjdDogX19wYXJhbXNGb3JtYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHk6IHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ2xlbmd0aCcgfSlcbiAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgY29uc2VxdWVudDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkJsb2NrU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICBib2R5OiBbdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICc9JywgbGVmdDogcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIk1lbWJlckV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXB1dGVkOiB0cnVlLCBvYmplY3Q6IF9fcGFyYW1zRm9ybWFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIlVwZGF0ZUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICcrKycsIGFyZ3VtZW50OiBfX2Zvcm1hbHNJbmRleElkLCBwcmVmaXg6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgfSldXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICBhbHRlcm5hdGU6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJJZlN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgdGVzdDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkJpbmFyeUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICdpbicsIGxlZnQ6IHZJZCwgcmlnaHQ6IF9fcGFyYW1zS2V5d29yZHMsXG4gICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgY29uc2VxdWVudDogdGhpcy5jcmVhdGVOb2RlU3BhbihyLCByLCBcIkJsb2NrU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IFt0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICc9JywgbGVmdDogcklkLCByaWdodDogX19wYXJhbXNLZXl3b3Jkc1ZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uOiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiVW5hcnlFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJ2RlbGV0ZScsIHByZWZpeDogdHJ1ZSwgYXJndW1lbnQ6IF9fcGFyYW1zS2V5d29yZHNWXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICBhbHRlcm5hdGU6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIH0pXVxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGFsdGVybmF0ZTogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIklmU3RhdGVtZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgIHRlc3Q6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJCaW5hcnlFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6ICc8JywgbGVmdDogX19mb3JtYWxzSW5kZXhJZCxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IHRoaXMuY3JlYXRlTm9kZU1lbWJJZHMociwgX19hcmdzLCAnbGVuZ3RoJyksXG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgIGNvbnNlcXVlbnQ6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJCbG9ja1N0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IFt0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbjogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiAnPScsIGxlZnQ6IHJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0OiB0aGlzLmNyZWF0ZUdlbmVyYXRlZE5vZGVTcGFuKHIsIHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXB1dGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3Q6IHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogX19hcmdzIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5jcmVhdGVHZW5lcmF0ZWROb2RlU3BhbihyLCByLCBcIlVwZGF0ZUV4cHJlc3Npb25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiAnKysnLCBhcmd1bWVudDogX19mb3JtYWxzSW5kZXhJZCwgcHJlZml4OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgYWx0ZXJuYXRlOiBudWxsXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIHRoaXMuY3JlYXRlR2VuZXJhdGVkTm9kZVNwYW4ociwgciwgXCJSZXR1cm5TdGF0ZW1lbnRcIiwgeyBhcmd1bWVudDogcklkIH0pXVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJlc3Q6IG51bGwsIGdlbmVyYXRvcjogZmFsc2UsIGV4cHJlc3Npb246IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgLy8gRS5nLiBweVJ1bnRpbWUudXRpbHMuYWRkXG5cbiAgICAgIGNyZWF0ZU5vZGVSdW50aW1lQ2FsbDogZnVuY3Rpb24gKHIsIG1vZCwgZm4sIGFyZ3MpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTm9kZVNwYW4ociwgciwgXCJDYWxsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgY2FsbGVlOiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsXG4gICAgICAgICAgICBvYmplY3Q6IHRoaXMuY3JlYXRlTm9kZU1lbWJJZHMociwgb3B0aW9ucy5ydW50aW1lUGFyYW1OYW1lLCAgbW9kKSxcbiAgICAgICAgICAgIHByb3BlcnR5OiB0aGlzLmNyZWF0ZU5vZGVTcGFuKHIsIHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IGZuIH0pXG4gICAgICAgICAgfSksXG4gICAgICAgICAgYXJndW1lbnRzOiBhcmdzXG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgLy8gVXNlZCB0byBjb252ZXJ0ICdpZCA9IGluaXQnIHRvICd2YXIgaWQgPSBpbml0J1xuXG4gICAgICBjcmVhdGVWYXJEZWNsRnJvbUlkOiBmdW5jdGlvbiAocmVmTm9kZSwgaWQsIGluaXQpIHtcbiAgICAgICAgdmFyIGRlY2wgPSBzdGFydE5vZGVGcm9tKHJlZk5vZGUpO1xuICAgICAgICBkZWNsLmlkID0gaWQ7XG4gICAgICAgIGRlY2wuaW5pdCA9IGluaXQ7XG4gICAgICAgIHRoaXMuZmluaXNoTm9kZUZyb20ocmVmTm9kZSwgZGVjbCwgXCJWYXJpYWJsZURlY2xhcmF0b3JcIik7XG4gICAgICAgIHZhciBkZWNsRGVjbCA9IHN0YXJ0Tm9kZUZyb20ocmVmTm9kZSk7XG4gICAgICAgIGRlY2xEZWNsLmtpbmQgPSBcInZhclwiO1xuICAgICAgICBkZWNsRGVjbC5kZWNsYXJhdGlvbnMgPSBbZGVjbF07XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGVGcm9tKHJlZk5vZGUsIGRlY2xEZWNsLCBcIlZhcmlhYmxlRGVjbGFyYXRpb25cIik7XG4gICAgICB9LFxuXG4gICAgICBjcmVhdGVHZW5lcmF0ZWRWYXJEZWNsRnJvbUlkOiBmdW5jdGlvbiAocmVmTm9kZSwgaWQsIGluaXQpIHtcbiAgICAgICAgdmFyIGRlY2wgPSBzdGFydE5vZGVGcm9tKHJlZk5vZGUpO1xuICAgICAgICBkZWNsLmlkID0gaWQ7XG4gICAgICAgIGRlY2wuaW5pdCA9IGluaXQ7XG4gICAgICAgIHRoaXMuZmluaXNoTm9kZUZyb20ocmVmTm9kZSwgZGVjbCwgXCJWYXJpYWJsZURlY2xhcmF0b3JcIik7XG4gICAgICAgIHZhciBkZWNsRGVjbCA9IHN0YXJ0Tm9kZUZyb20ocmVmTm9kZSk7XG4gICAgICAgIGRlY2xEZWNsLmtpbmQgPSBcInZhclwiO1xuICAgICAgICBkZWNsRGVjbC5kZWNsYXJhdGlvbnMgPSBbZGVjbF07XG4gICAgICAgIGRlY2xEZWNsLnVzZXJDb2RlID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGVGcm9tKHJlZk5vZGUsIGRlY2xEZWNsLCBcIlZhcmlhYmxlRGVjbGFyYXRpb25cIik7XG4gICAgICB9LFxuXG4gICAgICBjcmVhdGVDbGFzczogZnVuY3Rpb24oY29udGFpbmVyLCBjdG9yTm9kZSwgY2xhc3NQYXJhbXMsIGNsYXNzQm9keVJlZk5vZGUsIGNsYXNzQmxvY2spIHtcbiAgICAgICAgLy8gSGVscGVyIHRvIGlkZW50aWZ5IGNsYXNzIG1ldGhvZHMgd2hpY2ggd2VyZSBwYXJzZWQgb250byB0aGUgY2xhc3MgcHJvdG90eXBlXG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UHJvdG90eXBlKHN0bXQpIHtcbiAgICAgICAgICBpZiAoc3RtdC5leHByZXNzaW9uICYmIHN0bXQuZXhwcmVzc2lvbi5sZWZ0ICYmIHN0bXQuZXhwcmVzc2lvbi5sZWZ0Lm9iamVjdCAmJlxuICAgICAgICAgICAgc3RtdC5leHByZXNzaW9uLmxlZnQub2JqZWN0LnByb3BlcnR5ICYmIHN0bXQuZXhwcmVzc2lvbi5sZWZ0Lm9iamVjdC5wcm9wZXJ0eS5uYW1lID09PSBcInByb3RvdHlwZVwiKVxuICAgICAgICAgICAgcmV0dXJuIHN0bXQuZXhwcmVzc2lvbi5sZWZ0LnByb3BlcnR5Lm5hbWU7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdGFydCBidWlsZGluZyBjbGFzcyBjb25zdHJ1Y3RvclxuXG4gICAgICAgIHZhciBjdG9yQmxvY2sgPSBzdGFydE5vZGVGcm9tKGNsYXNzQmxvY2spO1xuICAgICAgICBjdG9yQmxvY2suYm9keSA9IFtdO1xuXG4gICAgICAgIC8vIEFkZCBwYXJlbnQgY2xhc3MgY29uc3RydWN0b3IgY2FsbFxuXG4gICAgICAgIGlmIChjbGFzc1BhcmFtcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICB2YXIgb2JqSWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGNsYXNzQm9keVJlZk5vZGUsIGNsYXNzQm9keVJlZk5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IGNsYXNzUGFyYW1zWzBdLm5hbWUgfSk7XG4gICAgICAgICAgdmFyIHByb3BlcnR5SWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGNsYXNzQm9keVJlZk5vZGUsIGNsYXNzQm9keVJlZk5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiY2FsbFwiIH0pO1xuICAgICAgICAgIHZhciBjYWxsZWVNZW1iZXIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGNsYXNzQm9keVJlZk5vZGUsIGNsYXNzQm9keVJlZk5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogb2JqSWQsIHByb3BlcnR5OiBwcm9wZXJ0eUlkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICAgICAgdmFyIHRoaXNFeHByID0gdGhpcy5jcmVhdGVOb2RlU3BhbihjbGFzc0JvZHlSZWZOb2RlLCBjbGFzc0JvZHlSZWZOb2RlLCBcIlRoaXNFeHByZXNzaW9uXCIpO1xuICAgICAgICAgIHZhciBjYWxsRXhwciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY2xhc3NCb2R5UmVmTm9kZSwgY2xhc3NCb2R5UmVmTm9kZSwgXCJDYWxsRXhwcmVzc2lvblwiLCB7IGNhbGxlZTogY2FsbGVlTWVtYmVyLCBhcmd1bWVudHM6IFt0aGlzRXhwcl0gfSk7XG4gICAgICAgICAgdmFyIHN1cGVyRXhwciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY2xhc3NCb2R5UmVmTm9kZSwgY2xhc3NCb2R5UmVmTm9kZSwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHsgZXhwcmVzc2lvbjogY2FsbEV4cHIgfSk7XG4gICAgICAgICAgY3RvckJsb2NrLmJvZHkucHVzaChzdXBlckV4cHIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIG5vbi1mdW5jdGlvbiBzdGF0ZW1lbnRzIGFuZCBjb250ZW50cyBvZiBzcGVjaWFsICdfX2luaXRfXycgbWV0aG9kXG5cbiAgICAgICAgZm9yICh2YXIgaSBpbiBjbGFzc0Jsb2NrLmJvZHkpIHtcbiAgICAgICAgICB2YXIgc3RtdCA9IGNsYXNzQmxvY2suYm9keVtpXTtcbiAgICAgICAgICB2YXIgcHJvdG90eXBlID0gZ2V0UHJvdG90eXBlKHN0bXQpO1xuICAgICAgICAgIGlmICghcHJvdG90eXBlKSB7XG4gICAgICAgICAgICBjdG9yQmxvY2suYm9keS5wdXNoKHN0bXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmIChwcm90b3R5cGUgPT09IFwiX19pbml0X19cIikge1xuICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBzdG10LmV4cHJlc3Npb24ucmlnaHQuYm9keS5ib2R5KVxuICAgICAgICAgICAgICBjdG9yQmxvY2suYm9keS5wdXNoKHN0bXQuZXhwcmVzc2lvbi5yaWdodC5ib2R5LmJvZHlbal0pO1xuICAgICAgICAgICAgY3Rvck5vZGUucGFyYW1zID0gc3RtdC5leHByZXNzaW9uLnJpZ2h0LnBhcmFtcztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaW5pc2ggY2xhc3MgY29uc3RydWN0b3JcblxuICAgICAgICBjdG9yTm9kZS5ib2R5ID0gZmluaXNoTm9kZShjdG9yQmxvY2ssIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gICAgICAgIGZpbmlzaE5vZGUoY3Rvck5vZGUsIFwiRnVuY3Rpb25EZWNsYXJhdGlvblwiKTtcbiAgICAgICAgY29udGFpbmVyLmJvZHkucHVzaChjdG9yTm9kZSk7XG5cbiAgICAgICAgLy8gQWRkIGluaGVyaXRhbmNlIHZpYSAnTXlDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBhcmVudENsYXNzLnByb3RvdHlwZSknXG5cbiAgICAgICAgaWYgKGNsYXNzUGFyYW1zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIHZhciBjaGlsZENsYXNzSWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGN0b3JOb2RlLCBjdG9yTm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogY3Rvck5vZGUuaWQubmFtZSB9KTtcbiAgICAgICAgICB2YXIgY2hpbGRQcm90b3R5cGVJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcInByb3RvdHlwZVwiIH0pO1xuICAgICAgICAgIHZhciBjaGlsZFByb3RvdHlwZU1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IGNoaWxkQ2xhc3NJZCwgcHJvcGVydHk6IGNoaWxkUHJvdG90eXBlSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgICB2YXIgcGFyZW50Q2xhc3NJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBjbGFzc1BhcmFtc1swXS5uYW1lIH0pO1xuICAgICAgICAgIHZhciBwYXJlbnRQcm90b3R5cGVJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcInByb3RvdHlwZVwiIH0pO1xuICAgICAgICAgIHZhciBwYXJlbnRQcm90b3R5cGVNZW1iZXIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGN0b3JOb2RlLCBjdG9yTm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBwYXJlbnRDbGFzc0lkLCBwcm9wZXJ0eTogcGFyZW50UHJvdG90eXBlSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgICB2YXIgb2JqQ2xhc3NJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIk9iamVjdFwiIH0pO1xuICAgICAgICAgIHZhciBvYmpDcmVhdGVJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcImNyZWF0ZVwiIH0pO1xuICAgICAgICAgIHZhciBvYmpQcm9wZXJ0eU1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IG9iakNsYXNzSWQsIHByb3BlcnR5OiBvYmpDcmVhdGVJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICAgIHZhciBjYWxsRXhwciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIkNhbGxFeHByZXNzaW9uXCIsIHsgY2FsbGVlOiBvYmpQcm9wZXJ0eU1lbWJlciwgYXJndW1lbnRzOiBbcGFyZW50UHJvdG90eXBlTWVtYmVyXSB9KTtcbiAgICAgICAgICB2YXIgYXNzaWduRXhwciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oY3Rvck5vZGUsIGN0b3JOb2RlLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHsgbGVmdDogY2hpbGRQcm90b3R5cGVNZW1iZXIsIG9wZXJhdG9yOiBcIj1cIiwgcmlnaHQ6IGNhbGxFeHByIH0pO1xuICAgICAgICAgIHZhciBpbmhlcml0YW5jZUV4cHIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGN0b3JOb2RlLCBjdG9yTm9kZSwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHsgZXhwcmVzc2lvbjogYXNzaWduRXhwciB9KTtcbiAgICAgICAgICBjb250YWluZXIuYm9keS5wdXNoKGluaGVyaXRhbmNlRXhwcik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgY2xhc3MgbWV0aG9kcywgd2hpY2ggYXJlIGFscmVhZHkgcHJvdG90eXBlIGFzc2lnbm1lbnRzXG5cbiAgICAgICAgZm9yICh2YXIgaSBpbiBjbGFzc0Jsb2NrLmJvZHkpIHtcbiAgICAgICAgICB2YXIgc3RtdCA9IGNsYXNzQmxvY2suYm9keVtpXTtcbiAgICAgICAgICB2YXIgcHJvdG90eXBlID0gZ2V0UHJvdG90eXBlKHN0bXQpO1xuICAgICAgICAgIGlmIChwcm90b3R5cGUgJiYgcHJvdG90eXBlICE9PSBcIl9faW5pdF9fXCIpXG4gICAgICAgICAgICBjb250YWluZXIuYm9keS5wdXNoKHN0bXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUoY29udGFpbmVyLCBcIkJsb2NrU3RhdGVtZW50XCIpO1xuICAgICAgfSxcblxuICAgICAgLy8gQ3JlYXRlIGZvciBsb29wXG4gICAgICAvLyBcbiAgICAgIC8vIFByb2JsZW06XG4gICAgICAvLyAxLiBKYXZhU2NyaXB0IGZvci9pbiBsb29wIGl0ZXJhdGVzIG9uIHByb3BlcnRpZXMsIHdoaWNoIGFyZSB0aGUgaW5kZXhlcyBmb3IgYW4gQXJyYXlcbiAgICAgIC8vICAgIFB5dGhvbiBpdGVyYXRlcyBvbiB0aGUgbGlzdCBpdGVtcyB0aGVtc2VsdmVzLCBub3QgaW5kZXhlc1xuICAgICAgLy8gMi4gSmF2YVNjcmlwdCBmb3IvaW4gZG9lcyBub3QgbmVjZXNzYXJpbHkgaXRlcmF0ZSBpbiBvcmRlclxuICAgICAgLy8gU29sdXRpb246XG4gICAgICAvLyBHZW5lcmF0ZSBleHRyYSBBU1QgdG8gZG8gdGhlIHJpZ2h0IHRoaW5nIGF0IHJ1bnRpbWVcbiAgICAgIC8vIEphdmFTY3JpcHQgZm9yL2luIGlzIHVzZWQgZm9yIGRpY3Rpb25hcmllc1xuICAgICAgLy8gSWYgaXRlcmF0aW5nIHRocm91Z2ggYW4gb3JkZXJlZCBzZXF1ZW5jZSwgcmV0dXJuIHNvbWV0aGluZyBsaWtlOiBcbiAgICAgIC8vIHsgdmFyIF9fcmlnaHQgPSByaWdodDsgXG4gICAgICAvLyAgICBpZiAoX19yaWdodCBpbnN0YW5jZW9mIEFycmF5KSB7IFxuICAgICAgLy8gICAgICBmb3IodmFyIF9faW5kZXg9MDsgX19pbmRleCA8IF9fcmlnaHQubGVuZ3RoOyBfX2luZGV4KyspIHtcbiAgICAgIC8vICAgICAgICBpID0gX19yaWdodFtfX2luZGV4XTsgXG4gICAgICAvLyAgICAgICAgLi4uXG4gICAgICAvLyAgICAgIH0gXG4gICAgICAvLyAgICB9IGVsc2UgeyBcbiAgICAgIC8vICAgICAgZm9yKGkgaW4gX19yaWdodCl7Li4ufSBcbiAgICAgIC8vICAgIH1cbiAgICAgIC8vIH1cbiAgICAgIC8vIFdoZW4gdGhlIGxvb3AgdGFyZ2V0IGlzIGEgVHVwbGUsIGl0IGlzIHVucGFja2VkIGludG8gZWFjaCBmb3IgYm9keSBpbiB0aGUgZXhhbXBsZSBhYm92ZS5cbiAgICAgIC8vIEUuZy4gJ2ZvciBrLCB2IGluIF9fcmlnaHQ6IHRvdGFsICs9IHYnIGJlY29tZXM6XG4gICAgICAvLyBmb3IgKHZhciBfX3RtcCBpbiBfX3JpZ2h0KSB7XG4gICAgICAvLyAgICBrID0gX190bXBbMF07XG4gICAgICAvLyAgICB2ID0gX190bXBbMV07XG4gICAgICAvLyAgICB0b3RhbCArPSB2O1xuICAgICAgLy8gfVxuXG4gICAgICAvLyBUT0RPOiBmb3IvaW4gb24gYSBzdHJpbmcgc2hvdWxkIGdvIHRocm91Z2ggaXRlbXMsIG5vdCBpbmRleGVzLiBTdHJpbmcgb2JqIGFuZCBzdHJpbmcgbGl0ZXJhbC5cblxuICAgICAgY3JlYXRlRm9yOiBmdW5jdGlvbiAobm9kZSwgaW5pdCwgdHVwbGVBcmdzLCByaWdodCwgYm9keSkge1xuICAgICAgICB2YXIgZm9yT3JkZXJlZEJvZHkgPSBib2R5O1xuICAgICAgICB2YXIgZm9ySW5Cb2R5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShmb3JPcmRlcmVkQm9keSkpO1xuXG4gICAgICAgIHZhciB0bXBWYXJTdWZmaXggPSBuZXdBc3RJZENvdW50Kys7XG5cbiAgICAgICAgdmFyIGFycmF5SWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiQXJyYXlcIiB9KTtcbiAgICAgICAgdmFyIGxlbmd0aElkID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcImxlbmd0aFwiIH0pO1xuICAgICAgICB2YXIgemVyb0xpdCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oaW5pdCwgaW5pdCwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IDAgfSk7XG5cbiAgICAgICAgLy8gdmFyIF9fcmlnaHROID0gcmlnaHRcblxuICAgICAgICB2YXIgcmlnaHRJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4ocmlnaHQsIHJpZ2h0LCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIl9fZmlsYmVydFJpZ2h0XCIgKyB0bXBWYXJTdWZmaXggfSk7XG4gICAgICAgIHZhciByaWdodEFzc2lnbiA9IHRoaXMuY3JlYXRlVmFyRGVjbEZyb21JZChyaWdodCwgcmlnaHRJZCwgcmlnaHQpO1xuXG4gICAgICAgIC8vIGZvcig7OykgYW5kIGZvcihpbikgbG9vcHNcblxuICAgICAgICB2YXIgZm9yUmlnaHRJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oaW5pdCwgaW5pdCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX2ZpbGJlcnRSaWdodFwiICsgdG1wVmFyU3VmZml4IH0pO1xuXG4gICAgICAgIC8vIGZvciAodmFyIF9faW5kZXhOOyBfX2luZGV4TiA8IF9fcmlnaHROLmxlbmd0aDsgKytfX2luZGV4TilcblxuICAgICAgICB2YXIgZm9yT3JkZXJlZEluZGV4SWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGluaXQsIGluaXQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiX19maWxiZXJ0SW5kZXhcIiArIHRtcFZhclN1ZmZpeCB9KTtcbiAgICAgICAgdmFyIGZvck9yZGVyZWRJbmRleERlY2xyID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIlZhcmlhYmxlRGVjbGFyYXRvclwiLCB7IGlkOiBmb3JPcmRlcmVkSW5kZXhJZCwgaW5pdDogemVyb0xpdCB9KTtcbiAgICAgICAgdmFyIGZvck9yZGVyZWRJbmRleERlY2xuID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIlZhcmlhYmxlRGVjbGFyYXRpb25cIiwgeyBkZWNsYXJhdGlvbnM6IFtmb3JPcmRlcmVkSW5kZXhEZWNscl0sIGtpbmQ6IFwidmFyXCIgfSk7XG4gICAgICAgIHZhciBmb3JPcmRlcmVkVGVzdE1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oaW5pdCwgaW5pdCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBmb3JSaWdodElkLCBwcm9wZXJ0eTogbGVuZ3RoSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgdmFyIGZvck9yZGVyZWRUZXN0Qmlub3AgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGluaXQsIGluaXQsIFwiQmluYXJ5RXhwcmVzc2lvblwiLCB7IGxlZnQ6IGZvck9yZGVyZWRJbmRleElkLCBvcGVyYXRvcjogXCI8XCIsIHJpZ2h0OiBmb3JPcmRlcmVkVGVzdE1lbWJlciB9KTtcbiAgICAgICAgdmFyIGZvck9yZGVyZWRVcGRhdGUgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGluaXQsIGluaXQsIFwiVXBkYXRlRXhwcmVzc2lvblwiLCB7IG9wZXJhdG9yOiBcIisrXCIsIHByZWZpeDogdHJ1ZSwgYXJndW1lbnQ6IGZvck9yZGVyZWRJbmRleElkIH0pO1xuICAgICAgICB2YXIgZm9yT3JkZXJlZE1lbWJlciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oaW5pdCwgaW5pdCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBmb3JSaWdodElkLCBwcm9wZXJ0eTogZm9yT3JkZXJlZEluZGV4SWQsIGNvbXB1dGVkOiB0cnVlIH0pO1xuXG4gICAgICAgIGlmICh0dXBsZUFyZ3MpIHtcbiAgICAgICAgICB2YXIgdmFyU3RtdHMgPSB1bnBhY2tUdXBsZSh0dXBsZUFyZ3MsIGZvck9yZGVyZWRNZW1iZXIpO1xuICAgICAgICAgIGZvciAodmFyIGkgPSB2YXJTdG10cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgZm9yT3JkZXJlZEJvZHkuYm9keS51bnNoaWZ0KHZhclN0bXRzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoaW5pdC50eXBlID09PSBcIklkZW50aWZpZXJcIiAmJiAhc2NvcGUuZXhpc3RzKGluaXQubmFtZSkpIHtcbiAgICAgICAgICAgIHNjb3BlLmFkZFZhcihpbml0Lm5hbWUpO1xuICAgICAgICAgICAgZm9yT3JkZXJlZEJvZHkuYm9keS51bnNoaWZ0KHRoaXMuY3JlYXRlVmFyRGVjbEZyb21JZChpbml0LCBpbml0LCBmb3JPcmRlcmVkTWVtYmVyKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBmb3JPcmRlcmVkSW5pdCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oaW5pdCwgaW5pdCwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiLCB7IG9wZXJhdG9yOiBcIj1cIiwgbGVmdDogaW5pdCwgcmlnaHQ6IGZvck9yZGVyZWRNZW1iZXIgfSk7XG4gICAgICAgICAgICB2YXIgZm9yT3JkZXJlZEluaXRTdG10ID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihpbml0LCBpbml0LCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwgeyBleHByZXNzaW9uOiBmb3JPcmRlcmVkSW5pdCB9KTtcbiAgICAgICAgICAgIGZvck9yZGVyZWRCb2R5LmJvZHkudW5zaGlmdChmb3JPcmRlcmVkSW5pdFN0bXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmb3JPcmRlcmVkID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkZvclN0YXRlbWVudFwiLCB7IGluaXQ6IGZvck9yZGVyZWRJbmRleERlY2xuLCB0ZXN0OiBmb3JPcmRlcmVkVGVzdEJpbm9wLCB1cGRhdGU6IGZvck9yZGVyZWRVcGRhdGUsIGJvZHk6IGZvck9yZGVyZWRCb2R5IH0pO1xuICAgICAgICB2YXIgZm9yT3JkZXJlZEJsb2NrID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkJsb2NrU3RhdGVtZW50XCIsIHsgYm9keTogW2Zvck9yZGVyZWRdIH0pO1xuXG4gICAgICAgIC8vIGZvciAoaW5pdCBpbiBfX3JpZ2h0TilcblxuICAgICAgICB2YXIgZm9ySW5MZWZ0ID0gaW5pdDtcbiAgICAgICAgaWYgKHR1cGxlQXJncykge1xuICAgICAgICAgIHZhciB2YXJTdG10cyA9IHVucGFja1R1cGxlKHR1cGxlQXJncywgcmlnaHQpO1xuICAgICAgICAgIGZvckluTGVmdCA9IHZhclN0bXRzWzBdO1xuICAgICAgICAgIGZvciAodmFyIGkgPSB2YXJTdG10cy5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSBmb3JJbkJvZHkuYm9keS51bnNoaWZ0KHZhclN0bXRzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpbml0LnR5cGUgPT09IFwiSWRlbnRpZmllclwiICYmICFzY29wZS5leGlzdHMoaW5pdC5uYW1lKSkge1xuICAgICAgICAgIHNjb3BlLmFkZFZhcihpbml0Lm5hbWUpO1xuICAgICAgICAgIGZvckluTGVmdCA9IHRoaXMuY3JlYXRlVmFyRGVjbEZyb21JZChpbml0LCBpbml0LCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZm9ySW4gPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiRm9ySW5TdGF0ZW1lbnRcIiwgeyBsZWZ0OiBmb3JJbkxlZnQsIHJpZ2h0OiBmb3JSaWdodElkLCBib2R5OiBmb3JJbkJvZHkgfSk7XG4gICAgICAgIHZhciBmb3JJbkJsb2NrID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkJsb2NrU3RhdGVtZW50XCIsIHsgYm9keTogW2ZvckluXSB9KTtcblxuICAgICAgICAvLyBpZiBvcmRlcmVkIHNlcXVlbmNlIHRoZW4gZm9yT3JkZXJlZCBlbHNlIGZvckluXG5cbiAgICAgICAgdmFyIGlmUmlnaHRJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX2ZpbGJlcnRSaWdodFwiICsgdG1wVmFyU3VmZml4IH0pO1xuICAgICAgICB2YXIgaWZUZXN0ID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkJpbmFyeUV4cHJlc3Npb25cIiwgeyBsZWZ0OiBpZlJpZ2h0SWQsIG9wZXJhdG9yOiBcImluc3RhbmNlb2ZcIiwgcmlnaHQ6IGFycmF5SWQgfSk7XG4gICAgICAgIHZhciBpZlN0bXQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWZTdGF0ZW1lbnRcIiwgeyB0ZXN0OiBpZlRlc3QsIGNvbnNlcXVlbnQ6IGZvck9yZGVyZWRCbG9jaywgYWx0ZXJuYXRlOiBmb3JJbkJsb2NrIH0pO1xuXG4gICAgICAgIG5vZGUuYm9keSA9IFtyaWdodEFzc2lnbiwgaWZTdG10XTtcblxuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICAgIH0sXG5cbiAgICAgIC8vIGV4cHIgPT4gX190bXBMaXN0LnB1c2goZXhwcik7XG5cbiAgICAgIGNyZWF0ZUxpc3RDb21wUHVzaDogZnVuY3Rpb24gKGV4cHIsIHRtcFZhclN1ZmZpeCkge1xuICAgICAgICB2YXIgZXhwclB1c2hUbXBMaXN0SWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIGV4cHIsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiX190bXBMaXN0XCIgKyB0bXBWYXJTdWZmaXggfSk7XG4gICAgICAgIHZhciBleHByUHVzaElkID0gdGhpcy5jcmVhdGVOb2RlU3BhbihleHByLCBleHByLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcInB1c2hcIiB9KTtcbiAgICAgICAgdmFyIGV4cHJNZW1iZXIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIGV4cHIsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogZXhwclB1c2hUbXBMaXN0SWQsIHByb3BlcnR5OiBleHByUHVzaElkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICAgIHZhciBleHByQ2FsbCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4oZXhwciwgZXhwciwgXCJDYWxsRXhwcmVzc2lvblwiLCB7IGNhbGxlZTogZXhwck1lbWJlciwgYXJndW1lbnRzOiBbZXhwcl0gfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIGV4cHIsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7IGV4cHJlc3Npb246IGV4cHJDYWxsIH0pO1xuICAgICAgfSxcblxuICAgICAgLy8gIChmdW5jdGlvbigpIHtcbiAgICAgIC8vICAgIHZhciBfbGlzdCA9IFtdO1xuICAgICAgLy8gICAgLi4uXG4gICAgICAvLyAgICBib2R5XG4gICAgICAvLyAgICByZXR1cm4gX2xpc3Q7XG4gICAgICAvLyAgfSgpKTtcblxuICAgICAgY3JlYXRlTGlzdENvbXBJaWZlOiBmdW5jdGlvbiAobm9kZSwgYm9keSwgdG1wVmFyU3VmZml4KSB7XG4gICAgICAgIHZhciBpaWZlUnVudGltZUlkID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgfSk7XG4gICAgICAgIHZhciBpaWZlT2JqZWN0c0lkID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcIm9iamVjdHNcIiB9KTtcbiAgICAgICAgdmFyIGlpZmVPYmpNZW1iZXIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogaWlmZVJ1bnRpbWVJZCwgcHJvcGVydHk6IGlpZmVPYmplY3RzSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgdmFyIGlpZmVMaXN0SWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwibGlzdFwiIH0pO1xuICAgICAgICB2YXIgaWlmZUxpc3RNZW1iZXIgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogaWlmZU9iak1lbWJlciwgcHJvcGVydHk6IGlpZmVMaXN0SWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgdmFyIGlpZmVOZXdFeHByID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk5ld0V4cHJlc3Npb25cIiwgeyBjYWxsZWU6IGlpZmVMaXN0TWVtYmVyLCBhcmd1bWVudHM6IFtdIH0pO1xuICAgICAgICB2YXIgaWlmZUxpc3RJZCA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX3RtcExpc3RcIiArIHRtcFZhclN1ZmZpeCB9KTtcbiAgICAgICAgdmFyIGlpZmVMaXN0RGVjbCA9IHRoaXMuY3JlYXRlVmFyRGVjbEZyb21JZChub2RlLCBpaWZlTGlzdElkLCBpaWZlTmV3RXhwcik7XG5cbiAgICAgICAgdmFyIGlpZmVSZXR1cm5MaXN0SWQgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiX190bXBMaXN0XCIgKyB0bXBWYXJTdWZmaXggfSk7XG4gICAgICAgIHZhciBpaWZlUmV0dXJuID0gdGhpcy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIlJldHVyblN0YXRlbWVudFwiLCB7IGFyZ3VtZW50OiBpaWZlUmV0dXJuTGlzdElkIH0pO1xuXG4gICAgICAgIHZhciBpaWZlQmxvY2sgPSB0aGlzLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIiwgeyBib2R5OiBbaWlmZUxpc3REZWNsLCBib2R5LCBpaWZlUmV0dXJuXSB9KTtcbiAgICAgICAgdmFyIGZuRXhwciA9IHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJGdW5jdGlvbkV4cHJlc3Npb25cIiwgeyBwYXJhbXM6IFtdLCBkZWZhdWx0czogW10sIGJvZHk6IGlpZmVCbG9jaywgZ2VuZXJhdG9yOiBmYWxzZSwgZXhwcmVzc2lvbjogZmFsc2UgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJDYWxsRXhwcmVzc2lvblwiLCB7IGNhbGxlZTogZm5FeHByLCBhcmd1bWVudHM6IFtdIH0pO1xuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgLy8gUHJlZGljYXRlIHRoYXQgdGVzdHMgd2hldGhlciB0aGUgbmV4dCB0b2tlbiBpcyBvZiB0aGUgZ2l2ZW5cbiAgLy8gdHlwZSwgYW5kIGlmIHllcywgY29uc3VtZXMgaXQgYXMgYSBzaWRlIGVmZmVjdC5cblxuICBmdW5jdGlvbiBlYXQodHlwZSkge1xuICAgIGlmICh0b2tUeXBlID09PSB0eXBlKSB7XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvLyBFeHBlY3QgYSB0b2tlbiBvZiBhIGdpdmVuIHR5cGUuIElmIGZvdW5kLCBjb25zdW1lIGl0LCBvdGhlcndpc2UsXG4gIC8vIHJhaXNlIGFuIHVuZXhwZWN0ZWQgdG9rZW4gZXJyb3IuXG5cbiAgZnVuY3Rpb24gZXhwZWN0KHR5cGUpIHtcbiAgICBpZiAodG9rVHlwZSA9PT0gdHlwZSkgbmV4dCgpO1xuICAgIGVsc2UgdW5leHBlY3RlZCgpO1xuICB9XG5cbiAgLy8gUmFpc2UgYW4gdW5leHBlY3RlZCB0b2tlbiBlcnJvci5cblxuICBmdW5jdGlvbiB1bmV4cGVjdGVkKCkge1xuICAgIHJhaXNlKHRva1N0YXJ0LCBcIlVuZXhwZWN0ZWQgdG9rZW5cIik7XG4gIH1cblxuICAvLyBWZXJpZnkgdGhhdCBhIG5vZGUgaXMgYW4gbHZhbCAtIHNvbWV0aGluZyB0aGF0IGNhbiBiZSBhc3NpZ25lZFxuICAvLyB0by5cblxuICBmdW5jdGlvbiBjaGVja0xWYWwoZXhwcikge1xuICAgIGlmIChleHByLnR5cGUgIT09IFwiSWRlbnRpZmllclwiICYmIGV4cHIudHlwZSAhPT0gXCJNZW1iZXJFeHByZXNzaW9uXCIpXG4gICAgICByYWlzZShleHByLnN0YXJ0LCBcIkFzc2lnbmluZyB0byBydmFsdWVcIik7XG4gICAgaWYgKHN0cmljdCAmJiBleHByLnR5cGUgPT09IFwiSWRlbnRpZmllclwiICYmIGlzU3RyaWN0QmFkSWRXb3JkKGV4cHIubmFtZSkpXG4gICAgICByYWlzZShleHByLnN0YXJ0LCBcIkFzc2lnbmluZyB0byBcIiArIGV4cHIubmFtZSArIFwiIGluIHN0cmljdCBtb2RlXCIpO1xuICB9XG5cbiAgLy8gR2V0IGFyZ3MgZm9yIGEgbmV3IHR1cGxlIGV4cHJlc3Npb25cblxuICBmdW5jdGlvbiBnZXRUdXBsZUFyZ3MoZXhwcikge1xuICAgIGlmIChleHByLmNhbGxlZSAmJiBleHByLmNhbGxlZS5vYmplY3QgJiYgZXhwci5jYWxsZWUub2JqZWN0Lm9iamVjdCAmJlxuICAgICAgZXhwci5jYWxsZWUub2JqZWN0Lm9iamVjdC5uYW1lID09PSBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgJiZcbiAgICAgIGV4cHIuY2FsbGVlLnByb3BlcnR5ICYmIGV4cHIuY2FsbGVlLnByb3BlcnR5Lm5hbWUgPT09IFwidHVwbGVcIilcbiAgICAgIHJldHVybiBleHByLmFyZ3VtZW50cztcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8vIFVucGFjayBhbiBsdmFsdWUgdHVwbGUgaW50byBpbmRpdnVhbCB2YXJpYWJsZSBhc3NpZ25tZW50c1xuICAvLyAnYXJnMCwgYXJnMSA9IHJpZ2h0JyBiZWNvbWVzOlxuICAvLyB2YXIgdG1wID0gcmlnaHRcbiAgLy8gYXJnMCA9IHRtcFswXVxuICAvLyBhcmcxID0gdG1wWzFdXG4gIC8vIC4uLlxuXG4gIGZ1bmN0aW9uIHVucGFja1R1cGxlKHR1cGxlQXJncywgcmlnaHQpIHtcbiAgICBpZiAoIXR1cGxlQXJncyB8fCB0dXBsZUFyZ3MubGVuZ3RoIDwgMSkgdW5leHBlY3RlZCgpO1xuXG4gICAgdmFyIHZhclN0bXRzID0gW107XG5cbiAgICAvLyB2YXIgdG1wID0gcmlnaHRcblxuICAgIHZhciB0bXBJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJpZ2h0LCByaWdodCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX2ZpbGJlcnRUbXBcIiArIG5ld0FzdElkQ291bnQrKyB9KTtcbiAgICB2YXIgdG1wRGVjbCA9IG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQocmlnaHQsIHRtcElkLCByaWdodCk7XG4gICAgdmFyU3RtdHMucHVzaCh0bXBEZWNsKTtcblxuICAgIC8vIGFyZ04gPSB0bXBbTl1cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHVwbGVBcmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgbHZhbCA9IHR1cGxlQXJnc1tpXTtcbiAgICAgIHZhciBzdWJUdXBsZUFyZ3MgPSBnZXRUdXBsZUFyZ3MobHZhbCk7XG4gICAgICBpZiAoc3ViVHVwbGVBcmdzKSB7XG4gICAgICAgIHZhciBzdWJMaXQgPSBuYy5jcmVhdGVOb2RlU3BhbihyaWdodCwgcmlnaHQsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBpIH0pO1xuICAgICAgICB2YXIgc3ViUmlnaHQgPSBuYy5jcmVhdGVOb2RlU3BhbihyaWdodCwgcmlnaHQsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogdG1wSWQsIHByb3BlcnR5OiBzdWJMaXQsIGNvbXB1dGVkOiB0cnVlIH0pO1xuICAgICAgICB2YXIgc3ViU3RtdHMgPSB1bnBhY2tUdXBsZShzdWJUdXBsZUFyZ3MsIHN1YlJpZ2h0KTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzdWJTdG10cy5sZW5ndGg7IGorKykgdmFyU3RtdHMucHVzaChzdWJTdG10c1tqXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjaGVja0xWYWwobHZhbCk7XG4gICAgICAgIHZhciBpbmRleElkID0gbmMuY3JlYXRlTm9kZVNwYW4ocmlnaHQsIHJpZ2h0LCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogaSB9KTtcbiAgICAgICAgdmFyIGluaXQgPSBuYy5jcmVhdGVOb2RlU3BhbihyaWdodCwgcmlnaHQsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogdG1wSWQsIHByb3BlcnR5OiBpbmRleElkLCBjb21wdXRlZDogdHJ1ZSB9KTtcbiAgICAgICAgaWYgKGx2YWwudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgJiYgIXNjb3BlLmV4aXN0cyhsdmFsLm5hbWUpKSB7XG4gICAgICAgICAgc2NvcGUuYWRkVmFyKGx2YWwubmFtZSk7XG4gICAgICAgICAgdmFyIHZhckRlY2wgPSBuYy5jcmVhdGVWYXJEZWNsRnJvbUlkKGx2YWwsIGx2YWwsIGluaXQpO1xuICAgICAgICAgIHZhclN0bXRzLnB1c2godmFyRGVjbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGVGcm9tKGx2YWwpO1xuICAgICAgICAgIG5vZGUubGVmdCA9IGx2YWw7XG4gICAgICAgICAgbm9kZS5vcGVyYXRvciA9IFwiPVwiO1xuICAgICAgICAgIG5vZGUucmlnaHQgPSBpbml0O1xuICAgICAgICAgIGZpbmlzaE5vZGUobm9kZSwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiKTtcbiAgICAgICAgICB2YXJTdG10cy5wdXNoKG5jLmNyZWF0ZU5vZGVGcm9tKG5vZGUsIFwiRXhwcmVzc2lvblN0YXRlbWVudFwiLCB7IGV4cHJlc3Npb246IG5vZGUgfSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhclN0bXRzO1xuICB9XG5cbiAgLy8gIyMjIFN0YXRlbWVudCBwYXJzaW5nXG5cbiAgLy8gUGFyc2UgYSBwcm9ncmFtLiBJbml0aWFsaXplcyB0aGUgcGFyc2VyLCByZWFkcyBhbnkgbnVtYmVyIG9mXG4gIC8vIHN0YXRlbWVudHMsIGFuZCB3cmFwcyB0aGVtIGluIGEgUHJvZ3JhbSBub2RlLiAgT3B0aW9uYWxseSB0YWtlcyBhXG4gIC8vIGBwcm9ncmFtYCBhcmd1bWVudC4gIElmIHByZXNlbnQsIHRoZSBzdGF0ZW1lbnRzIHdpbGwgYmUgYXBwZW5kZWRcbiAgLy8gdG8gaXRzIGJvZHkgaW5zdGVhZCBvZiBjcmVhdGluZyBhIG5ldyBub2RlLlxuXG4gIGZ1bmN0aW9uIHBhcnNlVG9wTGV2ZWwocHJvZ3JhbSkge1xuICAgIGxhc3RTdGFydCA9IGxhc3RFbmQgPSB0b2tQb3M7XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSBsYXN0RW5kTG9jID0gbmV3IFBvc2l0aW9uO1xuICAgIGluRnVuY3Rpb24gPSBzdHJpY3QgPSBudWxsO1xuICAgIGJyYWNrZXROZXN0aW5nID0gMDtcbiAgICByZWFkVG9rZW4oKTtcbiAgICB2YXIgbm9kZSA9IHByb2dyYW0gfHwgc3RhcnROb2RlKCk7XG4gICAgaWYgKCFwcm9ncmFtKSBub2RlLmJvZHkgPSBbXTtcbiAgICB3aGlsZSAodG9rVHlwZSAhPT0gX2VvZikge1xuICAgICAgdmFyIHN0bXQgPSBwYXJzZVN0YXRlbWVudCgpO1xuICAgICAgaWYgKHN0bXQpIG5vZGUuYm9keS5wdXNoKHN0bXQpO1xuICAgIH1cbiAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIlByb2dyYW1cIik7XG4gIH1cblxuICAvLyBQYXJzZSBhIHNpbmdsZSBzdGF0ZW1lbnQuXG4gIC8vXG4gIC8vIElmIGV4cGVjdGluZyBhIHN0YXRlbWVudCBhbmQgZmluZGluZyBhIHNsYXNoIG9wZXJhdG9yLCBwYXJzZSBhXG4gIC8vIHJlZ3VsYXIgZXhwcmVzc2lvbiBsaXRlcmFsLiBUaGlzIGlzIHRvIGhhbmRsZSBjYXNlcyBsaWtlXG4gIC8vIGBpZiAoZm9vKSAvYmxhaC8uZXhlYyhmb28pO2AsIHdoZXJlIGxvb2tpbmcgYXQgdGhlIHByZXZpb3VzIHRva2VuXG4gIC8vIGRvZXMgbm90IGhlbHAuXG5cbiAgZnVuY3Rpb24gcGFyc2VTdGF0ZW1lbnQoKSB7XG4gICAgaWYgKHRva1R5cGUgPT09IF9zbGFzaCB8fCB0b2tUeXBlID09PSBfYXNzaWduICYmIHRva1ZhbCA9PSBcIi89XCIpXG4gICAgICByZWFkVG9rZW4odHJ1ZSk7XG5cbiAgICB2YXIgc3RhcnR0eXBlID0gdG9rVHlwZSwgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuXG4gICAgLy8gTW9zdCB0eXBlcyBvZiBzdGF0ZW1lbnRzIGFyZSByZWNvZ25pemVkIGJ5IHRoZSBrZXl3b3JkIHRoZXlcbiAgICAvLyBzdGFydCB3aXRoLiBNYW55IGFyZSB0cml2aWFsIHRvIHBhcnNlLCBzb21lIHJlcXVpcmUgYSBiaXQgb2ZcbiAgICAvLyBjb21wbGV4aXR5LlxuXG4gICAgc3dpdGNoIChzdGFydHR5cGUpIHtcblxuICAgIGNhc2UgX2JyZWFrOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJCcmVha1N0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgX2NvbnRpbnVlOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJDb250aW51ZVN0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgX2NsYXNzOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlQ2xhc3Mobm9kZSk7XG5cbiAgICBjYXNlIF9kZWY6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gcGFyc2VGdW5jdGlvbihub2RlKTtcblxuICAgIGNhc2UgX2ZvcjpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZUZvcihub2RlKTtcblxuICAgIGNhc2UgX2Zyb206IC8vIFNraXBwaW5nIGZyb20gYW5kIGltcG9ydCBzdGF0ZW1lbnRzIGZvciBub3dcbiAgICAgIHNraXBMaW5lKCk7XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gcGFyc2VTdGF0ZW1lbnQoKTtcblxuICAgIGNhc2UgX2lmOiBjYXNlIF9lbGlmOlxuICAgICAgbmV4dCgpO1xuICAgICAgaWYgKHRva1R5cGUgPT09IF9wYXJlbkwpIG5vZGUudGVzdCA9IHBhcnNlUGFyZW5FeHByZXNzaW9uKCk7XG4gICAgICBlbHNlIG5vZGUudGVzdCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgZXhwZWN0KF9jb2xvbik7XG4gICAgICBub2RlLmNvbnNlcXVlbnQgPSBwYXJzZVN1aXRlKCk7XG4gICAgICBpZiAodG9rVHlwZSA9PT0gX2VsaWYpXG4gICAgICAgIG5vZGUuYWx0ZXJuYXRlID0gcGFyc2VTdGF0ZW1lbnQoKTtcbiAgICAgIGVsc2VcbiAgICAgICAgbm9kZS5hbHRlcm5hdGUgPSBlYXQoX2Vsc2UpICYmIGVhdChfY29sb24pID8gcGFyc2VTdWl0ZSgpIDogbnVsbDtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiSWZTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIF9pbXBvcnQ6IC8vIFNraXBwaW5nIGZyb20gYW5kIGltcG9ydCBzdGF0ZW1lbnRzIGZvciBub3dcbiAgICAgIHNraXBMaW5lKCk7XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gcGFyc2VTdGF0ZW1lbnQoKTtcblxuICAgIGNhc2UgX25ld2xpbmU6XG4gICAgICAvLyBUT0RPOiBwYXJzZVN0YXRlbWVudCgpIHNob3VsZCBwcm9iYWJseSBlYXQgaXQncyBvd24gbmV3bGluZVxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICBjYXNlIF9wYXNzOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJFbXB0eVN0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgX3JldHVybjpcbiAgICAgIGlmICghaW5GdW5jdGlvbiAmJiAhb3B0aW9ucy5hbGxvd1JldHVybk91dHNpZGVGdW5jdGlvbilcbiAgICAgICAgcmFpc2UodG9rU3RhcnQsIFwiJ3JldHVybicgb3V0c2lkZSBvZiBmdW5jdGlvblwiKTtcbiAgICAgIG5leHQoKTtcbiAgICAgIGlmICh0b2tUeXBlID09PV9uZXdsaW5lIHx8IHRva1R5cGUgPT09IF9lb2YpIG5vZGUuYXJndW1lbnQgPSBudWxsO1xuICAgICAgZWxzZSB7IG5vZGUuYXJndW1lbnQgPSBwYXJzZUV4cHJlc3Npb24oKTt9XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIlJldHVyblN0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgX3RyeTogLy8gVE9ETywgYW5kIHJlbW92ZSBwYXJzZUJsb2NrXG4gICAgICBuZXh0KCk7XG4gICAgICBub2RlLmJsb2NrID0gcGFyc2VCbG9jaygpO1xuICAgICAgbm9kZS5oYW5kbGVyID0gbnVsbDtcbiAgICAgIGlmICh0b2tUeXBlID09PSBfY2F0Y2gpIHtcbiAgICAgICAgdmFyIGNsYXVzZSA9IHN0YXJ0Tm9kZSgpO1xuICAgICAgICBuZXh0KCk7XG4gICAgICAgIGV4cGVjdChfcGFyZW5MKTtcbiAgICAgICAgY2xhdXNlLnBhcmFtID0gcGFyc2VJZGVudCgpO1xuICAgICAgICBpZiAoc3RyaWN0ICYmIGlzU3RyaWN0QmFkSWRXb3JkKGNsYXVzZS5wYXJhbS5uYW1lKSlcbiAgICAgICAgICByYWlzZShjbGF1c2UucGFyYW0uc3RhcnQsIFwiQmluZGluZyBcIiArIGNsYXVzZS5wYXJhbS5uYW1lICsgXCIgaW4gc3RyaWN0IG1vZGVcIik7XG4gICAgICAgIGV4cGVjdChfcGFyZW5SKTtcbiAgICAgICAgY2xhdXNlLmd1YXJkID0gbnVsbDtcbiAgICAgICAgY2xhdXNlLmJvZHkgPSBwYXJzZUJsb2NrKCk7XG4gICAgICAgIG5vZGUuaGFuZGxlciA9IGZpbmlzaE5vZGUoY2xhdXNlLCBcIkNhdGNoQ2xhdXNlXCIpO1xuICAgICAgfVxuICAgICAgbm9kZS5ndWFyZGVkSGFuZGxlcnMgPSBlbXB0eTtcbiAgICAgIG5vZGUuZmluYWxpemVyID0gZWF0KF9maW5hbGx5KSA/IHBhcnNlQmxvY2soKSA6IG51bGw7XG4gICAgICBpZiAoIW5vZGUuaGFuZGxlciAmJiAhbm9kZS5maW5hbGl6ZXIpXG4gICAgICAgIHJhaXNlKG5vZGUuc3RhcnQsIFwiTWlzc2luZyBjYXRjaCBvciBmaW5hbGx5IGNsYXVzZVwiKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiVHJ5U3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSBfd2hpbGU6XG4gICAgICBuZXh0KCk7XG4gICAgICBpZiAodG9rVHlwZSA9PT0gX3BhcmVuTCkgbm9kZS50ZXN0ID0gcGFyc2VQYXJlbkV4cHJlc3Npb24oKTtcbiAgICAgIGVsc2Ugbm9kZS50ZXN0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBleHBlY3QoX2NvbG9uKTtcbiAgICAgIG5vZGUuYm9keSA9IHBhcnNlU3VpdGUoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiV2hpbGVTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIF93aXRoOiAvLyBUT0RPXG4gICAgICBpZiAoc3RyaWN0KSByYWlzZSh0b2tTdGFydCwgXCInd2l0aCcgaW4gc3RyaWN0IG1vZGVcIik7XG4gICAgICBuZXh0KCk7XG4gICAgICBub2RlLm9iamVjdCA9IHBhcnNlUGFyZW5FeHByZXNzaW9uKCk7XG4gICAgICBub2RlLmJvZHkgPSBwYXJzZVN0YXRlbWVudCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJXaXRoU3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSBfc2VtaTpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiRW1wdHlTdGF0ZW1lbnRcIik7XG5cbiAgICAgIC8vIEFzc3VtZSBpdCdzIGFuIEV4cHJlc3Npb25TdGF0ZW1lbnQuIElmIGFuIGFzc2lnbiBoYXMgYmVlbiBcbiAgICAgIC8vIGNvbnZlcnRlZCB0byBhIHZhcmlhYmxlIGRlY2xhcmF0aW9uLCBwYXNzIGl0IHVwIGFzIGlzLlxuXG4gICAgZGVmYXVsdDpcbiAgICAgIHZhciBleHByID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBpZiAodG9rVHlwZSAhPT0gX3NlbWkgJiYgdG9rVHlwZSAhPT0gX25ld2xpbmUgJiYgdG9rVHlwZSAhPT0gX2VvZikgdW5leHBlY3RlZCgpO1xuICAgICAgaWYgKGV4cHIudHlwZSA9PT0gXCJWYXJpYWJsZURlY2xhcmF0aW9uXCIgfHwgZXhwci50eXBlID09PSBcIkJsb2NrU3RhdGVtZW50XCIpIHtcbiAgICAgICAgcmV0dXJuIGV4cHI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub2RlLmV4cHJlc3Npb24gPSBleHByO1xuICAgICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gUGFyc2UgaW5kZW50LWVuY2xvc2VkIGJsb2NrIG9mIHN0YXRlbWVudHNcblxuICBmdW5jdGlvbiBwYXJzZUJsb2NrKCkge1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgbm9kZS5ib2R5ID0gW107XG4gICAgd2hpbGUgKHRva1R5cGUgIT09IF9kZWRlbnQgJiYgdG9rVHlwZSAhPT0gX2VvZikge1xuICAgICAgdmFyIHN0bXQgPSBwYXJzZVN0YXRlbWVudCgpO1xuICAgICAgaWYgKHN0bXQpIG5vZGUuYm9keS5wdXNoKHN0bXQpO1xuICAgIH1cbiAgICBpZiAodG9rVHlwZSA9PT0gX2RlZGVudCkgbmV4dCgpO1xuICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gIH1cblxuICAvLyBQYXJzZSAnc3VpdGUnIGZyb20gUHl0aG9uIGdyYW1tYXIgc3BlY1xuICAvLyBXaWxsIHJlcGxhY2UgcGFyc2VCbG9jayBldmVudHVhbGx5XG5cbiAgZnVuY3Rpb24gcGFyc2VTdWl0ZSgpIHtcbiAgICAvLyBOT1RFOiBUaGlzIGlzIG5vdCBzdHJpY3RseSB2YWxpZCBQeXRob24gZm9yIHRoaXMgdG8gYmUgYW4gZW1wdHkgYmxvY2tcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgIG5vZGUuYm9keSA9IFtdO1xuICAgIGlmIChlYXQoX25ld2xpbmUpKSB7XG4gICAgICBpZiAodG9rVHlwZSA9PT0gX2luZGVudCkge1xuICAgICAgICBleHBlY3QoX2luZGVudCk7XG4gICAgICAgIHdoaWxlICghZWF0KF9kZWRlbnQpICYmICFlYXQoX2VvZikpIHtcbiAgICAgICAgICB2YXIgc3RtdCA9IHBhcnNlU3RhdGVtZW50KCk7XG4gICAgICAgICAgaWYgKHN0bXQpIG5vZGUuYm9keS5wdXNoKHN0bXQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0b2tUeXBlICE9PSBfZW9mKSB7XG4gICAgICBub2RlLmJvZHkucHVzaChwYXJzZVN0YXRlbWVudCgpKTtcbiAgICAgIG5leHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJCbG9ja1N0YXRlbWVudFwiKTtcbiAgfVxuXG4gIC8vIFBhcnNlIGZvci9pbiBsb29wXG5cbiAgZnVuY3Rpb24gcGFyc2VGb3Iobm9kZSkge1xuICAgIHZhciBpbml0ID0gcGFyc2VFeHByZXNzaW9uKGZhbHNlLCB0cnVlKTtcbiAgICB2YXIgdHVwbGVBcmdzID0gZ2V0VHVwbGVBcmdzKGluaXQpO1xuICAgIGlmICghdHVwbGVBcmdzKSBjaGVja0xWYWwoaW5pdCk7XG4gICAgZXhwZWN0KF9pbik7XG4gICAgdmFyIHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgZXhwZWN0KF9jb2xvbik7XG4gICAgdmFyIGJvZHkgPSBwYXJzZVN1aXRlKCk7XG4gICAgZmluaXNoTm9kZShub2RlLCBcIkJsb2NrU3RhdGVtZW50XCIpO1xuICAgIHJldHVybiBuYy5jcmVhdGVGb3Iobm9kZSwgaW5pdCwgdHVwbGVBcmdzLCByaWdodCwgYm9keSk7XG4gIH1cblxuICAvLyAjIyMgRXhwcmVzc2lvbiBwYXJzaW5nXG5cbiAgLy8gVGhlc2UgbmVzdCwgZnJvbSB0aGUgbW9zdCBnZW5lcmFsIGV4cHJlc3Npb24gdHlwZSBhdCB0aGUgdG9wIHRvXG4gIC8vICdhdG9taWMnLCBub25kaXZpc2libGUgZXhwcmVzc2lvbiB0eXBlcyBhdCB0aGUgYm90dG9tLiBNb3N0IG9mXG4gIC8vIHRoZSBmdW5jdGlvbnMgd2lsbCBzaW1wbHkgbGV0IHRoZSBmdW5jdGlvbihzKSBiZWxvdyB0aGVtIHBhcnNlLFxuICAvLyBhbmQsICppZiogdGhlIHN5bnRhY3RpYyBjb25zdHJ1Y3QgdGhleSBoYW5kbGUgaXMgcHJlc2VudCwgd3JhcFxuICAvLyB0aGUgQVNUIG5vZGUgdGhhdCB0aGUgaW5uZXIgcGFyc2VyIGdhdmUgdGhlbSBpbiBhbm90aGVyIG5vZGUuXG5cbiAgLy8gUGFyc2UgYSBmdWxsIGV4cHJlc3Npb24uIFRoZSBhcmd1bWVudHMgYXJlIHVzZWQgdG8gZm9yYmlkIGNvbW1hXG4gIC8vIHNlcXVlbmNlcyAoaW4gYXJndW1lbnQgbGlzdHMsIGFycmF5IGxpdGVyYWxzLCBvciBvYmplY3QgbGl0ZXJhbHMpXG4gIC8vIG9yIHRoZSBgaW5gIG9wZXJhdG9yIChpbiBmb3IgbG9vcHMgaW5pdGFsaXphdGlvbiBleHByZXNzaW9ucykuXG5cbiAgZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uKG5vQ29tbWEsIG5vSW4pIHtcbiAgICByZXR1cm4gcGFyc2VNYXliZUFzc2lnbihub0luKTtcbiAgfVxuXG4gIC8vIFVzZWQgZm9yIGNvbnN0cnVjdHMgbGlrZSBgc3dpdGNoYCBhbmQgYGlmYCB0aGF0IGluc2lzdCBvblxuICAvLyBwYXJlbnRoZXNlcyBhcm91bmQgdGhlaXIgZXhwcmVzc2lvbi5cblxuICBmdW5jdGlvbiBwYXJzZVBhcmVuRXhwcmVzc2lvbigpIHtcbiAgICBleHBlY3QoX3BhcmVuTCk7XG4gICAgdmFyIHZhbCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgIGV4cGVjdChfcGFyZW5SKTtcbiAgICByZXR1cm4gdmFsO1xuICB9XG5cbiAgLy8gUGFyc2UgYW4gYXNzaWdubWVudCBleHByZXNzaW9uLiBUaGlzIGluY2x1ZGVzIGFwcGxpY2F0aW9ucyBvZlxuICAvLyBvcGVyYXRvcnMgbGlrZSBgKz1gLlxuICAvLyBBZGQgJ3RoaXMuJyB0byBhc3NpZ25tZW50cyBpbiBhIGNsYXNzIGNvbnN0cnVjdG9yLlxuICAvLyBDb252ZXJ0IGlkZW50aWZpZXIgYXNzaWdubWVudCB0byB2YXJpYWJsZSBkZWNsYXJhdGlvbiBpZiB0aGVcbiAgLy8gaWRlbnRpZmllciBkb2Vzbid0IGV4aXN0IGluIHRoaXMgbmFtZXNwYWNlIHlldC5cblxuICBmdW5jdGlvbiBwYXJzZU1heWJlQXNzaWduKG5vSW4pIHtcbiAgICB2YXIgbGVmdCA9IHBhcnNlTWF5YmVUdXBsZShub0luKTtcbiAgICBpZiAodG9rVHlwZS5pc0Fzc2lnbikge1xuICAgICAgdmFyIHR1cGxlQXJncyA9IGdldFR1cGxlQXJncyhsZWZ0KTtcbiAgICAgIGlmICh0dXBsZUFyZ3MpIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgICB2YXIgcmlnaHQgPSBwYXJzZU1heWJlVHVwbGUobm9Jbik7XG4gICAgICAgIHZhciBibG9ja05vZGUgPSBzdGFydE5vZGVGcm9tKGxlZnQpO1xuICAgICAgICBibG9ja05vZGUuYm9keSA9IHVucGFja1R1cGxlKHR1cGxlQXJncywgcmlnaHQpO1xuICAgICAgICByZXR1cm4gZmluaXNoTm9kZShibG9ja05vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChzY29wZS5pc0NsYXNzKCkpIHtcbiAgICAgICAgdmFyIHRoaXNFeHByID0gbmMuY3JlYXRlTm9kZUZyb20obGVmdCwgXCJUaGlzRXhwcmVzc2lvblwiKTtcbiAgICAgICAgbGVmdCA9IG5jLmNyZWF0ZU5vZGVGcm9tKGxlZnQsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogdGhpc0V4cHIsIHByb3BlcnR5OiBsZWZ0IH0pO1xuICAgICAgfVxuXG4gICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZUZyb20obGVmdCk7XG4gICAgICBub2RlLm9wZXJhdG9yID0gdG9rVmFsO1xuICAgICAgbm9kZS5sZWZ0ID0gbGVmdDtcbiAgICAgIG5leHQoKTtcbiAgICAgIG5vZGUucmlnaHQgPSBwYXJzZU1heWJlVHVwbGUobm9Jbik7XG4gICAgICBjaGVja0xWYWwobGVmdCk7XG5cbiAgICAgIGlmIChub2RlLm9wZXJhdG9yID09PSAnKz0nIHx8IG5vZGUub3BlcmF0b3IgPT09ICcqPScpIHtcbiAgICAgICAgdmFyIHJpZ2h0ID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5yaWdodCwgbm9kZS5yaWdodCwgXCJDYWxsRXhwcmVzc2lvblwiKTtcbiAgICAgICAgcmlnaHQuY2FsbGVlID0gbmMuY3JlYXRlTm9kZU9wc0NhbGxlZShyaWdodCwgbm9kZS5vcGVyYXRvciA9PT0gJys9JyA/IFwiYWRkXCIgOiBcIm11bHRpcGx5XCIpO1xuICAgICAgICByaWdodC5hcmd1bWVudHMgPSBbbGVmdCwgbm9kZS5yaWdodF07XG4gICAgICAgIG5vZGUucmlnaHQgPSByaWdodDtcbiAgICAgICAgbm9kZS5vcGVyYXRvciA9ICc9JztcbiAgICAgIH1cblxuICAgICAgaWYgKGxlZnQudHlwZSA9PT0gXCJJZGVudGlmaWVyXCIgJiYgIXNjb3BlLmV4aXN0cyhsZWZ0Lm5hbWUpKSB7XG4gICAgICAgIGlmICghbm9kZS5vcGVyYXRvciB8fCBub2RlLm9wZXJhdG9yLmxlbmd0aCA+IDEpIHVuZXhwZWN0ZWQoKTtcbiAgICAgICAgc2NvcGUuYWRkVmFyKGxlZnQubmFtZSk7XG4gICAgICAgIHJldHVybiBuYy5jcmVhdGVWYXJEZWNsRnJvbUlkKG5vZGUubGVmdCwgbm9kZS5sZWZ0LCBub2RlLnJpZ2h0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiQXNzaWdubWVudEV4cHJlc3Npb25cIik7XG4gICAgfVxuICAgIHJldHVybiBsZWZ0O1xuICB9XG5cbiAgLy8gUGFyc2UgYSB0dXBsZVxuXG4gIGZ1bmN0aW9uIHBhcnNlTWF5YmVUdXBsZShub0luKSB7XG4gICAgdmFyIGV4cHIgPSBwYXJzZUV4cHJPcHMobm9Jbik7XG4gICAgaWYgKHRva1R5cGUgPT09IF9jb21tYSkge1xuICAgICAgcmV0dXJuIHBhcnNlVHVwbGUobm9JbiwgZXhwcik7XG4gICAgfVxuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgLy8gU3RhcnQgdGhlIHByZWNlZGVuY2UgcGFyc2VyLlxuXG4gIGZ1bmN0aW9uIHBhcnNlRXhwck9wcyhub0luKSB7XG4gICAgcmV0dXJuIHBhcnNlRXhwck9wKHBhcnNlTWF5YmVVbmFyeShub0luKSwgLTEsIG5vSW4pO1xuICB9XG5cbiAgLy8gUGFyc2UgYmluYXJ5IG9wZXJhdG9ycyB3aXRoIHRoZSBvcGVyYXRvciBwcmVjZWRlbmNlIHBhcnNpbmdcbiAgLy8gYWxnb3JpdGhtLiBgbGVmdGAgaXMgdGhlIGxlZnQtaGFuZCBzaWRlIG9mIHRoZSBvcGVyYXRvci5cbiAgLy8gYG1pblByZWNgIHByb3ZpZGVzIGNvbnRleHQgdGhhdCBhbGxvd3MgdGhlIGZ1bmN0aW9uIHRvIHN0b3AgYW5kXG4gIC8vIGRlZmVyIGZ1cnRoZXIgcGFyc2VyIHRvIG9uZSBvZiBpdHMgY2FsbGVycyB3aGVuIGl0IGVuY291bnRlcnMgYW5cbiAgLy8gb3BlcmF0b3IgdGhhdCBoYXMgYSBsb3dlciBwcmVjZWRlbmNlIHRoYW4gdGhlIHNldCBpdCBpcyBwYXJzaW5nLlxuICAvLyBFeHBvbmVudGlhdGlvbiBpcyBldmFsdWF0ZWQgcmlnaHQtdG8tbGVmdCwgc28gJ3ByZWMgPj0gbWluUHJlYydcbiAgLy8gRXhwb25lbnRpYXRpb24gb3BlcmF0b3IgJ3gqKnknIGlzIHJlcGxhY2VkIHdpdGggJ01hdGgucG93KHgsIHkpJ1xuICAvLyBGbG9vciBkaXZpc2lvbiBvcGVyYXRvciAneC8veScgaXMgcmVwbGFjZWQgd2l0aCAnTWF0aC5mbG9vcih4L3kpJ1xuICAvLyAnaW4nIGFuZCAnbm90IGluJyBpbXBsZW1lbnRlZCB2aWEgaW5kZXhPZigpXG5cbiAgZnVuY3Rpb24gcGFyc2VFeHByT3AobGVmdCwgbWluUHJlYywgbm9Jbikge1xuICAgIHZhciBub2RlLCBleHByTm9kZSwgcmlnaHQsIG9wID0gdG9rVHlwZSwgdmFsID0gdG9rVmFsO1xuICAgIHZhciBwcmVjID0gb3AgPT09IF9ub3QgPyBfaW4ucHJlYyA6IG9wLnByZWM7XG4gICAgaWYgKG9wID09PSBfZXhwb25lbnRpYXRpb24gJiYgcHJlYyA+PSBtaW5QcmVjKSB7XG4gICAgICBub2RlID0gc3RhcnROb2RlRnJvbShsZWZ0KTtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJpZ2h0ID0gcGFyc2VFeHByT3AocGFyc2VNYXliZVVuYXJ5KG5vSW4pLCBwcmVjLCBub0luKTtcbiAgICAgIGV4cHJOb2RlID0gbmMuY3JlYXRlTm9kZU1lbWJlckNhbGwobm9kZSwgXCJNYXRoXCIsIFwicG93XCIsIFtsZWZ0LCByaWdodF0pO1xuICAgICAgcmV0dXJuIHBhcnNlRXhwck9wKGV4cHJOb2RlLCBtaW5QcmVjLCBub0luKTtcbiAgICB9IGVsc2UgaWYgKHByZWMgIT0gbnVsbCAmJiAoIW5vSW4gfHwgb3AgIT09IF9pbikpIHtcbiAgICAgIGlmIChwcmVjID4gbWluUHJlYykge1xuICAgICAgICBuZXh0KCk7XG4gICAgICAgIG5vZGUgPSBzdGFydE5vZGVGcm9tKGxlZnQpO1xuICAgICAgICBpZiAob3AgPT09IF9mbG9vckRpdikge1xuICAgICAgICAgIHJpZ2h0ID0gcGFyc2VFeHByT3AocGFyc2VNYXliZVVuYXJ5KG5vSW4pLCBwcmVjLCBub0luKTtcbiAgICAgICAgICBmaW5pc2hOb2RlKG5vZGUpO1xuICAgICAgICAgIHZhciBiaW5FeHByID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJCaW5hcnlFeHByZXNzaW9uXCIsIHsgbGVmdDogbGVmdCwgb3BlcmF0b3I6ICcvJywgcmlnaHQ6IHJpZ2h0IH0pO1xuICAgICAgICAgIGV4cHJOb2RlID0gbmMuY3JlYXRlTm9kZU1lbWJlckNhbGwobm9kZSwgXCJNYXRoXCIsIFwiZmxvb3JcIiwgW2JpbkV4cHJdKTtcbiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gX2luIHx8IG9wID09PSBfbm90KSB7XG4gICAgICAgICAgaWYgKG9wID09PSBfaW4gfHwgZWF0KF9pbikpIHtcbiAgICAgICAgICAgIHJpZ2h0ID0gcGFyc2VFeHByT3AocGFyc2VNYXliZVVuYXJ5KG5vSW4pLCBwcmVjLCBub0luKTtcbiAgICAgICAgICAgIGZpbmlzaE5vZGUobm9kZSk7XG4gICAgICAgICAgICB2YXIgbm90TGl0ID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IG9wID09PSBfbm90IH0pO1xuICAgICAgICAgICAgZXhwck5vZGUgPSBuYy5jcmVhdGVOb2RlUnVudGltZUNhbGwobm9kZSwgJ29wcycsICdpbicsIFtsZWZ0LCByaWdodCwgbm90TGl0XSk7XG4gICAgICAgICAgfSBlbHNlIHJhaXNlKHRva1BvcywgXCJFeHBlY3RlZCAnbm90IGluJyBjb21wYXJpc29uIG9wZXJhdG9yXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKG9wID09PSBfcGx1c01pbiAmJiB2YWwgPT09ICcrJyB8fCBvcCA9PT0gX211bHRpcGx5TW9kdWxvICYmIHZhbCA9PT0gJyonKSB7XG4gICAgICAgICAgbm9kZS5hcmd1bWVudHMgPSBbbGVmdF07XG4gICAgICAgICAgbm9kZS5hcmd1bWVudHMucHVzaChwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pKTtcbiAgICAgICAgICBmaW5pc2hOb2RlKG5vZGUsIFwiQ2FsbEV4cHJlc3Npb25cIik7XG4gICAgICAgICAgbm9kZS5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlT3BzQ2FsbGVlKG5vZGUsIG9wID09PSBfcGx1c01pbiA/IFwiYWRkXCIgOiBcIm11bHRpcGx5XCIpO1xuICAgICAgICAgIGV4cHJOb2RlID0gbm9kZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAob3AgPT09IF9pcykge1xuICAgICAgICAgICAgaWYgKGVhdChfbm90KSkgbm9kZS5vcGVyYXRvciA9IFwiIT09XCI7XG4gICAgICAgICAgICBlbHNlIG5vZGUub3BlcmF0b3IgPSBcIj09PVwiO1xuICAgICAgICAgIH0gZWxzZSBub2RlLm9wZXJhdG9yID0gb3AucmVwICE9IG51bGwgPyBvcC5yZXAgOiB2YWw7XG4gICAgICAgICAgbm9kZS5sZWZ0ID0gbGVmdDtcbiAgICAgICAgICBub2RlLnJpZ2h0ID0gcGFyc2VFeHByT3AocGFyc2VNYXliZVVuYXJ5KG5vSW4pLCBwcmVjLCBub0luKTtcbiAgICAgICAgICBleHByTm9kZSA9IGZpbmlzaE5vZGUobm9kZSwgKG9wID09PSBfb3IgfHwgb3AgPT09IF9hbmQpID8gXCJMb2dpY2FsRXhwcmVzc2lvblwiIDogXCJCaW5hcnlFeHByZXNzaW9uXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJzZUV4cHJPcChleHByTm9kZSwgbWluUHJlYywgbm9Jbik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBsZWZ0O1xuICB9XG5cbiAgLy8gUGFyc2UgdW5hcnkgb3BlcmF0b3JzLlxuICAvLyAnLSsnIGFyZSBwcmVmaXhlcyBoZXJlLCB3aXRoIGRpZmZlcmVudCBwcmVjZWRlbmNlLlxuXG4gIGZ1bmN0aW9uIHBhcnNlTWF5YmVVbmFyeShub0luKSB7XG4gICAgaWYgKHRva1R5cGUucHJlZml4IHx8IHRva1R5cGUgPT09IF9wbHVzTWluKSB7XG4gICAgICB2YXIgcHJlYyA9IHRva1R5cGUgPT09IF9wbHVzTWluID8gX3Bvc05lZ05vdC5wcmVjIDogdG9rVHlwZS5wcmVjO1xuICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICAgIG5vZGUub3BlcmF0b3IgPSB0b2tUeXBlLnJlcCAhPSBudWxsID8gdG9rVHlwZS5yZXAgOiB0b2tWYWw7XG4gICAgICBub2RlLnByZWZpeCA9IHRydWU7XG4gICAgICB0b2tSZWdleHBBbGxvd2VkID0gdHJ1ZTtcbiAgICAgIG5leHQoKTtcbiAgICAgIG5vZGUuYXJndW1lbnQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJVbmFyeUV4cHJlc3Npb25cIik7XG4gICAgfVxuICAgIHJldHVybiBwYXJzZVN1YnNjcmlwdHMocGFyc2VFeHByQXRvbSgpKTtcbiAgfVxuXG4gIC8vIFBhcnNlIGNhbGwsIGRvdCwgYW5kIGBbXWAtc3Vic2NyaXB0IGV4cHJlc3Npb25zLlxuXG4gIGZ1bmN0aW9uIHBhcnNlU3Vic2NyaXB0cyhiYXNlLCBub0NhbGxzKSB7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGVGcm9tKGJhc2UpO1xuICAgIGlmIChlYXQoX2RvdCkpIHtcbiAgICAgIHZhciBpZCA9IHBhcnNlSWRlbnQodHJ1ZSk7XG4gICAgICBpZiAocHl0aG9uUnVudGltZS5pbXBvcnRzW2Jhc2UubmFtZV0gJiYgcHl0aG9uUnVudGltZS5pbXBvcnRzW2Jhc2UubmFtZV1baWQubmFtZV0pIHtcbiAgICAgICAgLy8gQ2FsbGluZyBhIFB5dGhvbiBpbXBvcnQgZnVuY3Rpb25cbiAgICAgICAgLy8gVE9ETzogVW5wYWNrIHBhcmFtZXRlcnMgaW50byBKYXZhU2NyaXB0LWZyaWVuZGx5IHBhcmFtZXRlcnNcbiAgICAgICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICAgICAgdmFyIGltcG9ydHNJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiaW1wb3J0c1wiIH0pO1xuICAgICAgICB2YXIgcnVudGltZU1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZUlkLCBwcm9wZXJ0eTogaW1wb3J0c0lkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICAgIG5vZGUub2JqZWN0ID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lTWVtYmVyLCBwcm9wZXJ0eTogYmFzZSwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgfSBlbHNlIGlmIChiYXNlLm5hbWUgJiYgYmFzZS5uYW1lID09PSBzY29wZS5nZXRUaGlzUmVwbGFjZSgpKSB7XG4gICAgICAgIG5vZGUub2JqZWN0ID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJUaGlzRXhwcmVzc2lvblwiKTtcbiAgICAgIH0gZWxzZSBub2RlLm9iamVjdCA9IGJhc2U7XG4gICAgICBub2RlLnByb3BlcnR5ID0gaWQ7XG4gICAgICBub2RlLmNvbXB1dGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gcGFyc2VTdWJzY3JpcHRzKGZpbmlzaE5vZGUobm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIpLCBub0NhbGxzKTtcbiAgICB9IGVsc2UgaWYgKGVhdChfYnJhY2tldEwpKSB7XG4gICAgICB2YXIgZXhwciwgaXNTbGljZSA9IGZhbHNlO1xuICAgICAgaWYgKGVhdChfY29sb24pKSBpc1NsaWNlID0gdHJ1ZTtcbiAgICAgIGVsc2UgZXhwciA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgaWYgKCFpc1NsaWNlICYmIGVhdChfY29sb24pKSBpc1NsaWNlID0gdHJ1ZTtcbiAgICAgIGlmIChpc1NsaWNlKSByZXR1cm4gcGFyc2VTbGljZShub2RlLCBiYXNlLCBleHByLCBub0NhbGxzKTtcbiAgICAgIHZhciBzdWJzY3JpcHRDYWxsID0gbmMuY3JlYXRlTm9kZVNwYW4oZXhwciwgZXhwciwgXCJDYWxsRXhwcmVzc2lvblwiKTtcbiAgICAgIHN1YnNjcmlwdENhbGwuY2FsbGVlID0gbmMuY3JlYXRlTm9kZU9wc0NhbGxlZShleHByLCBcInN1YnNjcmlwdEluZGV4XCIpO1xuICAgICAgc3Vic2NyaXB0Q2FsbC5hcmd1bWVudHMgPSBbYmFzZSwgZXhwcl07XG4gICAgICBub2RlLm9iamVjdCA9IGJhc2U7XG4gICAgICBub2RlLnByb3BlcnR5ID0gc3Vic2NyaXB0Q2FsbDtcbiAgICAgIG5vZGUuY29tcHV0ZWQgPSB0cnVlO1xuICAgICAgZXhwZWN0KF9icmFja2V0Uik7XG4gICAgICByZXR1cm4gcGFyc2VTdWJzY3JpcHRzKGZpbmlzaE5vZGUobm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIpLCBub0NhbGxzKTtcbiAgICB9IGVsc2UgaWYgKCFub0NhbGxzICYmIGVhdChfcGFyZW5MKSkge1xuICAgICAgaWYgKHNjb3BlLmlzVXNlckZ1bmN0aW9uKGJhc2UubmFtZSkpIHtcbiAgICAgICAgLy8gVW5wYWNrIHBhcmFtZXRlcnMgaW50byBKYXZhU2NyaXB0LWZyaWVuZGx5IHBhcmFtZXRlcnMsIGZ1cnRoZXIgcHJvY2Vzc2VkIGF0IHJ1bnRpbWVcbiAgICAgICAgdmFyIGNyZWF0ZVBhcmFtc0NhbGwgPSBuYy5jcmVhdGVOb2RlUnVudGltZUNhbGwobm9kZSwgJ3V0aWxzJywgJ2NyZWF0ZVBhcmFtc09iaicsIHBhcnNlUGFyYW1zTGlzdCgpKTtcbiAgICAgICAgbm9kZS5hcmd1bWVudHMgPSBbY3JlYXRlUGFyYW1zQ2FsbF07XG4gICAgICB9IGVsc2Ugbm9kZS5hcmd1bWVudHMgPSBwYXJzZUV4cHJMaXN0KF9wYXJlblIsIGZhbHNlKTtcbiAgICAgIGlmIChzY29wZS5pc05ld09iaihiYXNlLm5hbWUpKSBmaW5pc2hOb2RlKG5vZGUsIFwiTmV3RXhwcmVzc2lvblwiKTtcbiAgICAgIGVsc2UgZmluaXNoTm9kZShub2RlLCBcIkNhbGxFeHByZXNzaW9uXCIpO1xuICAgICAgaWYgKHB5dGhvblJ1bnRpbWUuZnVuY3Rpb25zW2Jhc2UubmFtZV0pIHtcbiAgICAgICAgLy8gQ2FsbGluZyBhIFB5dGhvbiBidWlsdC1pbiBmdW5jdGlvblxuICAgICAgICAvLyBUT0RPOiBVbnBhY2sgcGFyYW1ldGVycyBpbnRvIEphdmFTY3JpcHQtZnJpZW5kbHkgcGFyYW1ldGVyc1xuICAgICAgICBpZiAoYmFzZS50eXBlICE9PSBcIklkZW50aWZpZXJcIikgdW5leHBlY3RlZCgpO1xuICAgICAgICB2YXIgcnVudGltZUlkID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogb3B0aW9ucy5ydW50aW1lUGFyYW1OYW1lIH0pO1xuICAgICAgICB2YXIgZnVuY3Rpb25zSWQgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcImZ1bmN0aW9uc1wiIH0pO1xuICAgICAgICB2YXIgcnVudGltZU1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZUlkLCBwcm9wZXJ0eTogZnVuY3Rpb25zSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgICAgbm9kZS5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVNZW1iZXIsIHByb3BlcnR5OiBiYXNlLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICB9IGVsc2Ugbm9kZS5jYWxsZWUgPSBiYXNlO1xuICAgICAgcmV0dXJuIHBhcnNlU3Vic2NyaXB0cyhub2RlLCBub0NhbGxzKTtcbiAgICB9XG4gICAgcmV0dXJuIGJhc2U7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVNsaWNlKG5vZGUsIGJhc2UsIHN0YXJ0LCBub0NhbGxzKSB7XG4gICAgdmFyIGVuZCwgc3RlcDtcbiAgICBpZiAoIXN0YXJ0KSBzdGFydCA9IG5jLmNyZWF0ZU5vZGVGcm9tKG5vZGUsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBudWxsIH0pO1xuICAgIGlmICh0b2tUeXBlID09PSBfYnJhY2tldFIgfHwgZWF0KF9jb2xvbikpIHtcbiAgICAgIGVuZCA9IG5jLmNyZWF0ZU5vZGVGcm9tKG5vZGUsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBudWxsIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbmQgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIGlmICh0b2tUeXBlICE9PSBfYnJhY2tldFIpIGV4cGVjdChfY29sb24pO1xuICAgIH1cbiAgICBpZiAodG9rVHlwZSA9PT0gX2JyYWNrZXRSKSBzdGVwID0gbmMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IG51bGwgfSk7XG4gICAgZWxzZSBzdGVwID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgZXhwZWN0KF9icmFja2V0Uik7XG5cbiAgICBub2RlLmFyZ3VtZW50cyA9IFtzdGFydCwgZW5kLCBzdGVwXTtcbiAgICB2YXIgc2xpY2VJZCA9IG5jLmNyZWF0ZU5vZGVGcm9tKGJhc2UsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiX3B5U2xpY2VcIiB9KTtcbiAgICB2YXIgbWVtYmVyRXhwciA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogYmFzZSwgcHJvcGVydHk6IHNsaWNlSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICBub2RlLmNhbGxlZSA9IG1lbWJlckV4cHI7XG4gICAgcmV0dXJuIHBhcnNlU3Vic2NyaXB0cyhmaW5pc2hOb2RlKG5vZGUsIFwiQ2FsbEV4cHJlc3Npb25cIiksIG5vQ2FsbHMpO1xuICB9XG5cbiAgLy8gUGFyc2UgYW4gYXRvbWljIGV4cHJlc3Npb24gLSBlaXRoZXIgYSBzaW5nbGUgdG9rZW4gdGhhdCBpcyBhblxuICAvLyBleHByZXNzaW9uLCBhbiBleHByZXNzaW9uIHN0YXJ0ZWQgYnkgYSBrZXl3b3JkIGxpa2UgYGZ1bmN0aW9uYCBvclxuICAvLyBgbmV3YCwgb3IgYW4gZXhwcmVzc2lvbiB3cmFwcGVkIGluIHB1bmN0dWF0aW9uIGxpa2UgYCgpYCwgYFtdYCxcbiAgLy8gb3IgYHt9YC5cblxuICBmdW5jdGlvbiBwYXJzZUV4cHJBdG9tKCkge1xuICAgIHN3aXRjaCAodG9rVHlwZSkge1xuXG4gICAgY2FzZSBfZGljdDpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZURpY3QoX3BhcmVuUik7XG5cbiAgICBjYXNlIF9uYW1lOlxuICAgICAgcmV0dXJuIHBhcnNlSWRlbnQoKTtcblxuICAgIGNhc2UgX251bTogY2FzZSBfc3RyaW5nOiBjYXNlIF9yZWdleHA6XG4gICAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgICAgbm9kZS52YWx1ZSA9IHRva1ZhbDtcbiAgICAgIG5vZGUucmF3ID0gaW5wdXQuc2xpY2UodG9rU3RhcnQsIHRva0VuZCk7XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkxpdGVyYWxcIik7XG5cbiAgICBjYXNlIF9ub25lOiBjYXNlIF90cnVlOiBjYXNlIF9mYWxzZTpcbiAgICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgICBub2RlLnZhbHVlID0gdG9rVHlwZS5hdG9tVmFsdWU7XG4gICAgICBub2RlLnJhdyA9IHRva1R5cGUua2V5d29yZDtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiTGl0ZXJhbFwiKTtcblxuICAgIGNhc2UgX3BhcmVuTDpcbiAgICAgIHZhciB0b2tTdGFydExvYzEgPSB0b2tTdGFydExvYywgdG9rU3RhcnQxID0gdG9rU3RhcnQ7XG4gICAgICBuZXh0KCk7XG4gICAgICBpZiAodG9rVHlwZSA9PT0gX3BhcmVuUikge1xuICAgICAgICAvLyBFbXB0eSB0dXBsZVxuICAgICAgICB2YXIgbm9kZSA9IHBhcnNlVHVwbGUoZmFsc2UpO1xuICAgICAgICBlYXQoX3BhcmVuUik7XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgICAgfVxuICAgICAgdmFyIHZhbCA9IHBhcnNlTWF5YmVUdXBsZShmYWxzZSk7XG4gICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHtcbiAgICAgICAgdmFsLmxvYy5zdGFydCA9IHRva1N0YXJ0TG9jMTtcbiAgICAgICAgdmFsLmxvYy5lbmQgPSB0b2tFbmRMb2M7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5yYW5nZXMpXG4gICAgICAgIHZhbC5yYW5nZSA9IFt0b2tTdGFydDEsIHRva0VuZF07XG4gICAgICBleHBlY3QoX3BhcmVuUik7XG4gICAgICByZXR1cm4gdmFsO1xuXG4gICAgY2FzZSBfYnJhY2tldEw6XG4gICAgICByZXR1cm4gcGFyc2VMaXN0KCk7XG5cbiAgICBjYXNlIF9icmFjZUw6XG4gICAgICByZXR1cm4gcGFyc2VEaWN0KF9icmFjZVIpO1xuXG4gICAgY2FzZSBfaW5kZW50OlxuICAgICAgcmFpc2UodG9rU3RhcnQsIFwiVW5leHBlY3RlZCBpbmRlbnRcIik7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgdW5leHBlY3RlZCgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFBhcnNlIGxpc3RcblxuICAvLyBDdXN0b20gbGlzdCBvYmplY3QgaXMgdXNlZCB0byBzaW11bGF0ZSBuYXRpdmUgUHl0aG9uIGxpc3RcbiAgLy8gRS5nLiBQeXRob24gJ1tdJyBiZWNvbWVzIEphdmFTY3JpcHQgJ25ldyBfX3B5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCk7J1xuICAvLyBJZiBsaXN0IGNvbXByZWhlbnNpb24sIGJ1aWxkIHNvbWV0aGluZyBsaWtlIHRoaXM6XG4gIC8vKGZ1bmN0aW9uKCkge1xuICAvLyAgdmFyIF9saXN0ID0gW107XG4gIC8vICAuLi5cbiAgLy8gIF9saXN0LnB1c2goZXhwcik7XG4gIC8vICByZXR1cm4gX2xpc3Q7XG4gIC8vfSgpKTtcblxuICBmdW5jdGlvbiBwYXJzZUxpc3QoKSB7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICBub2RlLmFyZ3VtZW50cyA9IFtdO1xuICAgIG5leHQoKTtcblxuICAgIGlmICghZWF0KF9icmFja2V0UikpIHtcbiAgICAgIHZhciBleHByID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgIGlmICh0b2tUeXBlID09PSBfZm9yIHx8IHRva1R5cGUgPT09IF9pZikge1xuXG4gICAgICAgIC8vIExpc3QgY29tcHJlaGVuc2lvblxuICAgICAgICB2YXIgdG1wVmFyU3VmZml4ID0gbmV3QXN0SWRDb3VudCsrO1xuICAgICAgICBleHByID0gbmMuY3JlYXRlTGlzdENvbXBQdXNoKGV4cHIsIHRtcFZhclN1ZmZpeCk7XG4gICAgICAgIHZhciBib2R5ID0gcGFyc2VDb21wSXRlcihleHByLCB0cnVlKTtcbiAgICAgICAgZmluaXNoTm9kZShub2RlKTtcbiAgICAgICAgcmV0dXJuIG5jLmNyZWF0ZUxpc3RDb21wSWlmZShub2RlLCBib2R5LCB0bXBWYXJTdWZmaXgpO1xuXG4gICAgICB9IGVsc2UgaWYgKGVhdChfY29tbWEpKSB7XG4gICAgICAgIG5vZGUuYXJndW1lbnRzID0gW2V4cHJdLmNvbmNhdChwYXJzZUV4cHJMaXN0KF9icmFja2V0UiwgdHJ1ZSwgZmFsc2UpKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBleHBlY3QoX2JyYWNrZXRSKTtcbiAgICAgICAgbm9kZS5hcmd1bWVudHMgPSBbZXhwcl07XG4gICAgICB9XG4gICAgfVxuXG4gICAgZmluaXNoTm9kZShub2RlLCBcIk5ld0V4cHJlc3Npb25cIik7XG4gICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICB2YXIgb2JqZWN0c0lkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJvYmplY3RzXCIgfSk7XG4gICAgdmFyIHJ1bnRpbWVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVJZCwgcHJvcGVydHk6IG9iamVjdHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIHZhciBsaXN0SWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcImxpc3RcIiB9KTtcbiAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZU1lbWJlciwgcHJvcGVydHk6IGxpc3RJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgLy8gUGFyc2UgYSBjb21wX2l0ZXIgZnJvbSBQeXRob24gbGFuZ3VhZ2UgZ3JhbW1hclxuICAvLyBVc2VkIHRvIGJ1aWxkIGxpc3QgY29tcHJlaGVuc2lvbnNcbiAgLy8gJ2V4cHInIGlzIHRoZSBib2R5IHRvIGJlIHVzZWQgYWZ0ZXIgdW5yb2xsaW5nIHRoZSBpZnMgYW5kIGZvcnNcblxuICBmdW5jdGlvbiBwYXJzZUNvbXBJdGVyKGV4cHIsIGZpcnN0KSB7XG4gICAgaWYgKGZpcnN0ICYmIHRva1R5cGUgIT09IF9mb3IpIHVuZXhwZWN0ZWQoKTtcbiAgICBpZiAoZWF0KF9icmFja2V0UikpIHJldHVybiBleHByO1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgaWYgKGVhdChfZm9yKSkge1xuICAgICAgdmFyIGluaXQgPSBwYXJzZUV4cHJlc3Npb24oZmFsc2UsIHRydWUpO1xuICAgICAgdmFyIHR1cGxlQXJncyA9IGdldFR1cGxlQXJncyhpbml0KTtcbiAgICAgIGlmICghdHVwbGVBcmdzKSBjaGVja0xWYWwoaW5pdCk7XG4gICAgICBleHBlY3QoX2luKTtcbiAgICAgIHZhciByaWdodCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgdmFyIGJvZHkgPSBwYXJzZUNvbXBJdGVyKGV4cHIsIGZhbHNlKTtcbiAgICAgIHZhciBibG9jayA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJvZHksIGJvZHksIFwiQmxvY2tTdGF0ZW1lbnRcIiwgeyBib2R5OiBbYm9keV0gfSk7XG4gICAgICBmaW5pc2hOb2RlKG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gICAgICByZXR1cm4gbmMuY3JlYXRlRm9yKG5vZGUsIGluaXQsIHR1cGxlQXJncywgcmlnaHQsIGJsb2NrKTtcbiAgICB9IGVsc2UgaWYgKGVhdChfaWYpKSB7XG4gICAgICBpZiAodG9rVHlwZSA9PT0gX3BhcmVuTCkgbm9kZS50ZXN0ID0gcGFyc2VQYXJlbkV4cHJlc3Npb24oKTtcbiAgICAgIGVsc2Ugbm9kZS50ZXN0ID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBub2RlLmNvbnNlcXVlbnQgPSBwYXJzZUNvbXBJdGVyKGV4cHIsIGZhbHNlKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiSWZTdGF0ZW1lbnRcIik7XG4gICAgfSBlbHNlIHVuZXhwZWN0ZWQoKTtcbiAgfVxuXG4gIC8vIFBhcnNlIGNsYXNzXG5cbiAgZnVuY3Rpb24gcGFyc2VDbGFzcyhjdG9yTm9kZSkge1xuICAgIC8vIENvbnRhaW5lciBmb3IgY2xhc3MgY29uc3RydWN0b3IgYW5kIHByb3RvdHlwZSBmdW5jdGlvbnNcbiAgICB2YXIgY29udGFpbmVyID0gc3RhcnROb2RlRnJvbShjdG9yTm9kZSk7XG4gICAgY29udGFpbmVyLmJvZHkgPSBbXTtcblxuICAgIC8vIFBhcnNlIGNsYXNzIHNpZ25hdHVyZVxuICAgIGN0b3JOb2RlLmlkID0gcGFyc2VJZGVudCgpO1xuICAgIGN0b3JOb2RlLnBhcmFtcyA9IFtdO1xuICAgIHZhciBjbGFzc1BhcmFtcyA9IFtdO1xuICAgIGlmIChlYXQoX3BhcmVuTCkpIHtcbiAgICAgIHZhciBmaXJzdCA9IHRydWU7XG4gICAgICB3aGlsZSAoIWVhdChfcGFyZW5SKSkge1xuICAgICAgICBpZiAoIWZpcnN0KSBleHBlY3QoX2NvbW1hKTsgZWxzZSBmaXJzdCA9IGZhbHNlO1xuICAgICAgICBjbGFzc1BhcmFtcy5wdXNoKHBhcnNlSWRlbnQoKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjbGFzc1BhcmFtcy5sZW5ndGggPiAxKSByYWlzZSh0b2tQb3MsIFwiTXVsdGlwbGUgaW5oZXJpdGFuY2Ugbm90IHN1cHBvcnRlZFwiKTtcbiAgICBleHBlY3QoX2NvbG9uKTtcblxuICAgIC8vIFN0YXJ0IG5ldyBuYW1lc3BhY2UgZm9yIGNsYXNzIGJvZHlcbiAgICBzY29wZS5zdGFydENsYXNzKGN0b3JOb2RlLmlkLm5hbWUpO1xuXG4gICAgLy8gU2F2ZSBhIHJlZmVyZW5jZSBmb3Igc291cmNlIHJhbmdlc1xuICAgIHZhciBjbGFzc0JvZHlSZWZOb2RlID0gZmluaXNoTm9kZShzdGFydE5vZGUoKSk7XG5cbiAgICAvLyBQYXJzZSBjbGFzcyBib2R5XG4gICAgdmFyIGNsYXNzQmxvY2sgPSBwYXJzZVN1aXRlKCk7XG5cbiAgICAvLyBHZW5lcmF0ZSBhZGRpdGlvbmFsIEFTVCB0byBpbXBsZW1lbnQgY2xhc3NcbiAgICB2YXIgY2xhc3NTdG10ID0gbmMuY3JlYXRlQ2xhc3MoY29udGFpbmVyLCBjdG9yTm9kZSwgY2xhc3NQYXJhbXMsIGNsYXNzQm9keVJlZk5vZGUsIGNsYXNzQmxvY2spO1xuXG4gICAgc2NvcGUuZW5kKCk7XG5cbiAgICByZXR1cm4gY2xhc3NTdG10O1xuICB9XG5cbiAgLy8gUGFyc2UgZGljdGlvbmFyeVxuICAvLyBDdXN0b20gZGljdCBvYmplY3QgdXNlZCB0byBzaW11bGF0ZSBuYXRpdmUgUHl0aG9uIGRpY3RcbiAgLy8gRS5nLiBcInsnazEnOid2MScsICdrMic6J3YyJ31cIiBiZWNvbWVzIFwibmV3IF9fcHl0aG9uUnVudGltZS5vYmplY3RzLmRpY3QoWydrMScsICd2MSddLCBbJ2syJywgJ3YyJ10pO1wiXG5cbiAgZnVuY3Rpb24gcGFyc2VEaWN0KHRva0Nsb3NlKSB7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKSwgZmlyc3QgPSB0cnVlLCBrZXksIHZhbHVlO1xuICAgIG5vZGUuYXJndW1lbnRzID0gW107XG4gICAgbmV4dCgpO1xuICAgIHdoaWxlICghZWF0KHRva0Nsb3NlKSkge1xuICAgICAgaWYgKCFmaXJzdCkge1xuICAgICAgICBleHBlY3QoX2NvbW1hKTtcbiAgICAgIH0gZWxzZSBmaXJzdCA9IGZhbHNlO1xuXG4gICAgICBpZiAodG9rQ2xvc2UgPT09IF9icmFjZVIpIHtcbiAgICAgICAga2V5ID0gcGFyc2VQcm9wZXJ0eU5hbWUoKTtcbiAgICAgICAgZXhwZWN0KF9jb2xvbik7XG4gICAgICAgIHZhbHVlID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgIH0gZWxzZSBpZiAodG9rQ2xvc2UgPT09IF9wYXJlblIpIHtcbiAgICAgICAgdmFyIGtleUlkID0gcGFyc2VJZGVudCh0cnVlKTtcbiAgICAgICAga2V5ID0gc3RhcnROb2RlRnJvbShrZXlJZCk7XG4gICAgICAgIGtleS52YWx1ZSA9IGtleUlkLm5hbWU7XG4gICAgICAgIGZpbmlzaE5vZGUoa2V5LCBcIkxpdGVyYWxcIik7XG4gICAgICAgIGV4cGVjdChfZXEpO1xuICAgICAgICB2YWx1ZSA9IHBhcnNlRXhwck9wcyhmYWxzZSk7XG4gICAgICB9IGVsc2UgdW5leHBlY3RlZCgpO1xuICAgICAgbm9kZS5hcmd1bWVudHMucHVzaChuYy5jcmVhdGVOb2RlU3BhbihrZXksIHZhbHVlLCBcIkFycmF5RXhwcmVzc2lvblwiLCB7IGVsZW1lbnRzOiBba2V5LCB2YWx1ZV0gfSkpO1xuICAgIH1cbiAgICBmaW5pc2hOb2RlKG5vZGUsIFwiTmV3RXhwcmVzc2lvblwiKTtcblxuICAgIHZhciBydW50aW1lSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgfSk7XG4gICAgdmFyIG9iamVjdHNJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwib2JqZWN0c1wiIH0pO1xuICAgIHZhciBydW50aW1lTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lSWQsIHByb3BlcnR5OiBvYmplY3RzSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICB2YXIgbGlzdElkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJkaWN0XCIgfSk7XG4gICAgbm9kZS5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVNZW1iZXIsIHByb3BlcnR5OiBsaXN0SWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcblxuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VQcm9wZXJ0eU5hbWUoKSB7XG4gICAgaWYgKHRva1R5cGUgPT09IF9udW0gfHwgdG9rVHlwZSA9PT0gX3N0cmluZykgcmV0dXJuIHBhcnNlRXhwckF0b20oKTtcbiAgICByZXR1cm4gcGFyc2VJZGVudCh0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlRnVuY3Rpb24obm9kZSkge1xuICAgIC8vIFRPRE86IFRoZSBub2RlIGNyZWF0aW9uIHV0aWxpdGllcyB1c2VkIGhlcmUgYXJlIHRpZ2h0bHkgY291cGxlZCAoZS5nLiB2YXJpYWJsZSBuYW1lcylcblxuICAgIHZhciBzdWZmaXggPSBuZXdBc3RJZENvdW50Kys7XG4gICAgbm9kZS5pZCA9IHBhcnNlSWRlbnQoKTtcbiAgICBub2RlLnBhcmFtcyA9IFtdO1xuXG4gICAgLy8gUGFyc2UgcGFyYW1ldGVyc1xuXG4gICAgdmFyIGZvcm1hbHMgPSBbXTsgICAgIC8vIEluIG9yZGVyLCBtYXliZSB3aXRoIGRlZmF1bHQgdmFsdWVcbiAgICB2YXIgYXJnc0lkID0gbnVsbDsgICAgLy8gKmFyZ3NcbiAgICB2YXIga3dhcmdzSWQgPSBudWxsOyAgLy8gKiprd2FyZ3NcbiAgICB2YXIgZGVmYXVsdHNGb3VuZCA9IGZhbHNlO1xuICAgIHZhciBmaXJzdCA9IHRydWU7XG4gICAgZXhwZWN0KF9wYXJlbkwpO1xuICAgIHdoaWxlICghZWF0KF9wYXJlblIpKSB7XG4gICAgICBpZiAoIWZpcnN0KSBleHBlY3QoX2NvbW1hKTsgZWxzZSBmaXJzdCA9IGZhbHNlO1xuICAgICAgaWYgKHRva1ZhbCA9PT0gJyonKSB7XG4gICAgICAgIGlmIChrd2FyZ3NJZCkgcmFpc2UodG9rUG9zLCBcImludmFsaWQgc3ludGF4XCIpO1xuICAgICAgICBuZXh0KCk7IGFyZ3NJZCA9IHBhcnNlSWRlbnQoKTtcbiAgICAgIH0gZWxzZSBpZiAodG9rVmFsID09PSAnKionKSB7XG4gICAgICAgIG5leHQoKTsga3dhcmdzSWQgPSBwYXJzZUlkZW50KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoa3dhcmdzSWQpIHJhaXNlKHRva1BvcywgXCJpbnZhbGlkIHN5bnRheFwiKTtcbiAgICAgICAgdmFyIHBhcmFtSWQgPSBwYXJzZUlkZW50KCk7XG4gICAgICAgIGlmIChlYXQoX2VxKSkge1xuICAgICAgICAgIGZvcm1hbHMucHVzaCh7IGlkOiBwYXJhbUlkLCBleHByOiBwYXJzZUV4cHJPcHMoZmFsc2UpIH0pO1xuICAgICAgICAgIGRlZmF1bHRzRm91bmQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChkZWZhdWx0c0ZvdW5kKSByYWlzZSh0b2tQb3MsIFwibm9uLWRlZmF1bHQgYXJndW1lbnQgZm9sbG93cyBkZWZhdWx0IGFyZ3VtZW50XCIpO1xuICAgICAgICAgIGlmIChhcmdzSWQpIHJhaXNlKHRva1BvcywgXCJtaXNzaW5nIHJlcXVpcmVkIGtleXdvcmQtb25seSBhcmd1bWVudFwiKTtcbiAgICAgICAgICBmb3JtYWxzLnB1c2goeyBpZDogcGFyYW1JZCwgZXhwcjogbnVsbCB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBleHBlY3QoX2NvbG9uKTtcblxuICAgIC8vIFN0YXJ0IGEgbmV3IHNjb3BlIHdpdGggcmVnYXJkIHRvIHRoZSBgaW5GdW5jdGlvbmBcbiAgICAvLyBmbGFnIChyZXN0b3JlIHRoZW0gdG8gdGhlaXIgb2xkIHZhbHVlIGFmdGVyd2FyZHMpLlxuICAgIC8vIGBpbkZ1bmN0aW9uYCB1c2VkIHRvIHRocm93IHN5bnRheCBlcnJvciBmb3Igc3RyYXkgYHJldHVybmBcbiAgICB2YXIgb2xkSW5GdW5jID0gaW5GdW5jdGlvbiA9IHRydWU7XG5cbiAgICBzY29wZS5zdGFydEZuKG5vZGUuaWQubmFtZSk7XG5cbiAgICAvLyBJZiBjbGFzcyBtZXRob2QsIHJlbW92ZSBjbGFzcyBpbnN0YW5jZSB2YXIgZnJvbSBwYXJhbXMgYW5kIHNhdmUgZm9yICd0aGlzJyByZXBsYWNlbWVudFxuICAgIGlmIChzY29wZS5pc1BhcmVudENsYXNzKCkpIHtcbiAgICAgIHZhciBzZWxmSWQgPSBmb3JtYWxzLnNoaWZ0KCk7XG4gICAgICBzY29wZS5zZXRUaGlzUmVwbGFjZShzZWxmSWQuaWQubmFtZSk7XG4gICAgfVxuXG4gICAgdmFyIGJvZHkgPSBwYXJzZVN1aXRlKCk7XG4gICAgbm9kZS5ib2R5ID0gbmMuY3JlYXRlTm9kZVNwYW4oYm9keSwgYm9keSwgXCJCbG9ja1N0YXRlbWVudFwiLCB7IGJvZHk6IFtdIH0pO1xuXG4gICAgLy8gQWRkIHJ1bnRpbWUgcGFyYW1ldGVyIHByb2Nlc3NpbmdcbiAgICAvLyBUaGUgY2FsbGVyIG1heSBwYXNzIGEgY29tcGxleCBwYXJhbWV0ZXIgb2JqZWN0IGFzIGEgc2luZ2xlIHBhcmFtZXRlciBsaWtlIHRoaXM6XG4gICAgLy8ge2Zvcm1hbHM6WzxleHByPiwgPGV4cHI+LCAuLi5dLCBrZXl3b3Jkczp7PGlkPjo8ZXhwcj4sIDxpZD46PGV4cHI+LCAuLi59fVxuXG4gICAgaWYgKGZvcm1hbHMubGVuZ3RoID4gMCB8fCBhcmdzSWQgfHwga3dhcmdzSWQpIHtcbiAgICAgIC8vIHZhciBfX3BhcmFtcyA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgYXJndW1lbnRzWzBdLmZvcm1hbHMgJiYgYXJndW1lbnRzWzBdLmtleXdvcmRzID8gYXJndW1lbnRzWzBdIDogbnVsbDtcbiAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlTm9kZVBhcmFtc0NoZWNrKG5vZGUuaWQsIHN1ZmZpeCkpO1xuXG4gICAgICAvLyB2YXIgX19mb3JtYWxzSW5kZXggPSAwO1xuICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVHZW5lcmF0ZWRWYXJEZWNsRnJvbUlkKG5vZGUuaWQsXG4gICAgICAgIG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUuaWQsIG5vZGUuaWQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdfX2Zvcm1hbHNJbmRleCcgKyBzdWZmaXggfSksXG4gICAgICAgIG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUuaWQsIG5vZGUuaWQsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiAwIH0pKSk7XG5cbiAgICAgIC8vIHZhciBfX2FyZ3MgPSBhcmd1bWVudHM7XG4gICAgICBub2RlLmJvZHkuYm9keS5wdXNoKG5jLmNyZWF0ZUdlbmVyYXRlZFZhckRlY2xGcm9tSWQobm9kZS5pZCxcbiAgICAgICAgbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5pZCwgbm9kZS5pZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fYXJncycgKyBzdWZmaXggfSksXG4gICAgICAgIG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUuaWQsIG5vZGUuaWQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdhcmd1bWVudHMnIH0pKSk7XG4gICAgfVxuXG4gICAgaWYgKGZvcm1hbHMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gZnVuY3Rpb24gX19nZXRQYXJhbSh2LCBkKSB7XG4gICAgICAvLyAgIHZhciByID0gZDtcbiAgICAgIC8vICAgaWYgKF9fcGFyYW1zKSB7XG4gICAgICAvLyAgICAgaWYgKF9fZm9ybWFsc0luZGV4IDwgX19wYXJhbXMuZm9ybWFscy5sZW5ndGgpIHtcbiAgICAgIC8vICAgICAgIHIgPSBfX3BhcmFtcy5mb3JtYWxzW19fZm9ybWFsc0luZGV4KytdO1xuICAgICAgLy8gICAgIH0gZWxzZSBpZiAodiBpbiBfX3BhcmFtcy5rZXl3b3Jkcykge1xuICAgICAgLy8gICAgICAgciA9IF9fcGFyYW1zLmtleXdvcmRzW3ZdO1xuICAgICAgLy8gICAgICAgZGVsZXRlIF9fcGFyYW1zLmtleXdvcmRzW3ZdO1xuICAgICAgLy8gICAgIH1cbiAgICAgIC8vICAgfSBlbHNlIGlmIChfX2Zvcm1hbHNJbmRleCA8IF9fYXJncy5sZW5ndGgpIHtcbiAgICAgIC8vICAgICByID0gX19hcmdzW19fZm9ybWFsc0luZGV4KytdO1xuICAgICAgLy8gICB9XG4gICAgICAvLyAgIHJldHVybiByO1xuICAgICAgLy8gfVxuICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlR2V0UGFyYW1Gbihub2RlLmlkLCBzdWZmaXgpKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmb3JtYWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIC8vIHZhciA8cGFyYW0+ID0gX19nZXRQYXJhbSgnPHBhcmFtPicsIDxvcHRpb25hbCBkZWZhdWx0Pik7XG4gICAgICAgIHZhciBfX2dldFBhcmFtQ2FsbCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGZvcm1hbHNbaV0uaWQsIGZvcm1hbHNbaV0uaWQsIFwiQ2FsbEV4cHJlc3Npb25cIiwge1xuICAgICAgICAgIGNhbGxlZTogbmMuY3JlYXRlTm9kZVNwYW4oZm9ybWFsc1tpXS5pZCwgZm9ybWFsc1tpXS5pZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fZ2V0UGFyYW0nICsgc3VmZml4IH0pLFxuICAgICAgICAgIGFyZ3VtZW50czogW25jLmNyZWF0ZU5vZGVTcGFuKGZvcm1hbHNbaV0uaWQsIGZvcm1hbHNbaV0uaWQsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBmb3JtYWxzW2ldLmlkLm5hbWUgfSldXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZm9ybWFsc1tpXS5leHByKSBfX2dldFBhcmFtQ2FsbC5hcmd1bWVudHMucHVzaChmb3JtYWxzW2ldLmV4cHIpO1xuICAgICAgICBub2RlLmJvZHkuYm9keS5wdXNoKG5jLmNyZWF0ZUdlbmVyYXRlZFZhckRlY2xGcm9tSWQoZm9ybWFsc1tpXS5pZCwgZm9ybWFsc1tpXS5pZCwgX19nZXRQYXJhbUNhbGwpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgdmFyIHJlZk5vZGUgPSBhcmdzSWQgfHwga3dhcmdzSWQ7XG4gICAgaWYgKHJlZk5vZGUpIHtcbiAgICAgIGlmIChhcmdzSWQpIHtcbiAgICAgICAgLy8gdmFyIDxhcmdzPiA9IFtdO1xuICAgICAgICB2YXIgYXJnc0Fzc2lnbiA9IG5jLmNyZWF0ZUdlbmVyYXRlZFZhckRlY2xGcm9tSWQoYXJnc0lkLCBhcmdzSWQsIG5jLmNyZWF0ZU5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkFycmF5RXhwcmVzc2lvblwiLCB7IGVsZW1lbnRzOiBbXSB9KSk7XG4gICAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2goYXJnc0Fzc2lnbik7XG4gICAgICB9XG4gICAgICBpZiAoa3dhcmdzSWQpIHtcbiAgICAgICAgLy8gdmFyIDxrd2FyZ3M+ID0ge307XG4gICAgICAgIHZhciBrd2FyZ3NBc3NpZ24gPSBuYy5jcmVhdGVHZW5lcmF0ZWRWYXJEZWNsRnJvbUlkKGt3YXJnc0lkLCBrd2FyZ3NJZCwgbmMuY3JlYXRlTm9kZVNwYW4oa3dhcmdzSWQsIGt3YXJnc0lkLCBcIk9iamVjdEV4cHJlc3Npb25cIiwgeyBwcm9wZXJ0aWVzOiBbXSB9KSk7XG4gICAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2goa3dhcmdzQXNzaWduKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIChfX3BhcmFtcykge31cbiAgICAgIHZhciBhcmdzSWYgPSBuYy5jcmVhdGVOb2RlU3BhbihyZWZOb2RlLCByZWZOb2RlLCBcIklmU3RhdGVtZW50XCIsIHtcbiAgICAgICAgdGVzdDogbmMuY3JlYXRlTm9kZVNwYW4ocmVmTm9kZSwgcmVmTm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fcGFyYW1zJyArIHN1ZmZpeCB9KSxcbiAgICAgICAgY29uc2VxdWVudDogbmMuY3JlYXRlTm9kZVNwYW4ocmVmTm9kZSwgcmVmTm9kZSwgXCJCbG9ja1N0YXRlbWVudFwiLCB7IGJvZHk6IFtdIH0pfSlcbiAgICAgIGlmIChhcmdzSWQpIHtcbiAgICAgICAgLy8gd2hpbGUgKF9fZm9ybWFsc0luZGV4IDwgX19wYXJhbXMuZm9ybWFscy5sZW5ndGgpIHtcbiAgICAgICAgLy8gICA8YXJnc0lkPi5wdXNoKF9fcGFyYW1zLmZvcm1hbHNbX19mb3JtYWxzSW5kZXgrK10pOyB9XG4gICAgICAgIGFyZ3NJZi5jb25zZXF1ZW50LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlQXJnc1doaWxlQ29uc2VxdWVudChhcmdzSWQsIHN1ZmZpeCkpO1xuICAgICAgICAvLyB7IHdoaWxlIChfX2Zvcm1hbHNJbmRleCA8IF9fYXJncy5sZW5ndGgpIHtcbiAgICAgICAgLy8gICA8YXJnc0lkPi5wdXNoKF9fYXJnc1tfX2Zvcm1hbHNJbmRleCsrXSk7IH19XG4gICAgICAgIGFyZ3NJZi5hbHRlcm5hdGUgPSBuYy5jcmVhdGVOb2RlQXJnc0FsdGVybmF0ZShhcmdzSWQsIHN1ZmZpeCk7XG4gICAgICB9XG4gICAgICBpZiAoa3dhcmdzSWQpIHtcbiAgICAgICAgLy8gPGt3YXJncz4gPSBfX3BhcmFtcy5rZXl3b3Jkc1xuICAgICAgICBhcmdzSWYuY29uc2VxdWVudC5ib2R5LnB1c2gobmMuY3JlYXRlTm9kZVNwYW4oa3dhcmdzSWQsIGt3YXJnc0lkLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwge1xuICAgICAgICAgIGV4cHJlc3Npb246IG5jLmNyZWF0ZU5vZGVTcGFuKGt3YXJnc0lkLCBrd2FyZ3NJZCwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICBvcGVyYXRvcjogJz0nLCBsZWZ0OiBrd2FyZ3NJZCwgcmlnaHQ6IG5jLmNyZWF0ZU5vZGVNZW1iSWRzKGt3YXJnc0lkLCAnX19wYXJhbXMnICsgc3VmZml4LCAna2V5d29yZHMnKSxcbiAgICAgICAgICB9KVxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgICBub2RlLmJvZHkuYm9keS5wdXNoKGFyZ3NJZik7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydCBvcmlnaW5hbCBib2R5IHRvICdyZXR1cm4gKGZ1bmN0aW9uKCkgezxib2R5Pn0pLmNhbGwodGhpcyk7J1xuICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlTm9kZUZuQm9keUlpZmUoYm9keSkpO1xuXG4gICAgaW5GdW5jdGlvbiA9IG9sZEluRnVuYztcblxuICAgIC8vIFZlcmlmeSB0aGF0IGFyZ3VtZW50IG5hbWVzIGFyZSBub3QgcmVwZWF0ZWRcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1hbHMubGVuZ3RoOyArK2kpIHtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaTsgKytqKSBpZiAoZm9ybWFsc1tpXS5pZC5uYW1lID09PSBmb3JtYWxzW2pdLmlkLm5hbWUpXG4gICAgICAgIHJhaXNlKGZvcm1hbHNbaV0uaWQuc3RhcnQsIFwiQXJndW1lbnQgbmFtZSBjbGFzaFwiKTtcbiAgICB9XG5cbiAgICAvLyBJZiBjbGFzcyBtZXRob2QsIHJlcGxhY2Ugd2l0aCBwcm90b3R5cGUgZnVuY3Rpb24gbGl0ZXJhbHNcbiAgICB2YXIgcmV0Tm9kZTtcbiAgICBpZiAoc2NvcGUuaXNQYXJlbnRDbGFzcygpKSB7XG4gICAgICBmaW5pc2hOb2RlKG5vZGUpO1xuICAgICAgdmFyIGNsYXNzSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBzY29wZS5nZXRQYXJlbnRDbGFzc05hbWUoKSB9KTtcbiAgICAgIHZhciBwcm90b3R5cGVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwicHJvdG90eXBlXCIgfSk7XG4gICAgICB2YXIgZnVuY3Rpb25JZCA9IG5vZGUuaWQ7XG4gICAgICB2YXIgcHJvdG90eXBlTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBjbGFzc0lkLCBwcm9wZXJ0eTogcHJvdG90eXBlSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgIHZhciBmdW5jdGlvbk1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcHJvdG90eXBlTWVtYmVyLCBwcm9wZXJ0eTogZnVuY3Rpb25JZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgdmFyIGZ1bmN0aW9uRXhwciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiRnVuY3Rpb25FeHByZXNzaW9uXCIsIHsgYm9keTogbm9kZS5ib2R5LCBwYXJhbXM6IG5vZGUucGFyYW1zIH0pO1xuICAgICAgdmFyIGFzc2lnbkV4cHIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkFzc2lnbm1lbnRFeHByZXNzaW9uXCIsIHsgbGVmdDogZnVuY3Rpb25NZW1iZXIsIG9wZXJhdG9yOiBcIj1cIiwgcmlnaHQ6IGZ1bmN0aW9uRXhwciB9KTtcbiAgICAgIHJldE5vZGUgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwgeyBleHByZXNzaW9uOiBhc3NpZ25FeHByIH0pO1xuICAgIH0gZWxzZSByZXROb2RlID0gZmluaXNoTm9kZShub2RlLCBcIkZ1bmN0aW9uRGVjbGFyYXRpb25cIik7XG5cbiAgICBzY29wZS5lbmQoKTtcblxuICAgIHJldHVybiByZXROb2RlO1xuICB9XG5cbiAgLy8gUGFyc2VzIGEgY29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgZXhwcmVzc2lvbnMsIGFuZCByZXR1cm5zIHRoZW0gYXNcbiAgLy8gYW4gYXJyYXkuIGBjbG9zZWAgaXMgdGhlIHRva2VuIHR5cGUgdGhhdCBlbmRzIHRoZSBsaXN0LCBhbmRcbiAgLy8gYGFsbG93RW1wdHlgIGNhbiBiZSB0dXJuZWQgb24gdG8gYWxsb3cgc3Vic2VxdWVudCBjb21tYXMgd2l0aFxuICAvLyBub3RoaW5nIGluIGJldHdlZW4gdGhlbSB0byBiZSBwYXJzZWQgYXMgYG51bGxgICh3aGljaCBpcyBuZWVkZWRcbiAgLy8gZm9yIGFycmF5IGxpdGVyYWxzKS5cblxuICBmdW5jdGlvbiBwYXJzZUV4cHJMaXN0KGNsb3NlLCBhbGxvd1RyYWlsaW5nQ29tbWEsIGFsbG93RW1wdHkpIHtcbiAgICB2YXIgZWx0cyA9IFtdLCBmaXJzdCA9IHRydWU7XG4gICAgd2hpbGUgKCFlYXQoY2xvc2UpKSB7XG4gICAgICBpZiAoIWZpcnN0KSB7XG4gICAgICAgIGV4cGVjdChfY29tbWEpO1xuICAgICAgICBpZiAoYWxsb3dUcmFpbGluZ0NvbW1hICYmIG9wdGlvbnMuYWxsb3dUcmFpbGluZ0NvbW1hcyAmJiBlYXQoY2xvc2UpKSBicmVhaztcbiAgICAgIH0gZWxzZSBmaXJzdCA9IGZhbHNlO1xuXG4gICAgICBpZiAoYWxsb3dFbXB0eSAmJiB0b2tUeXBlID09PSBfY29tbWEpIGVsdHMucHVzaChudWxsKTtcbiAgICAgIGVsc2UgZWx0cy5wdXNoKHBhcnNlRXhwck9wcyhmYWxzZSkpO1xuICAgIH1cbiAgICByZXR1cm4gZWx0cztcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlUGFyYW1zTGlzdCgpIHtcbiAgICAvLyBJbjogZXhwciwgZXhwciwgLi4uLCBpZD1leHByLCBpZD1leHByLCAuLi5cbiAgICAvLyBPdXQ6IGV4cHIsIGV4cHIsIC4uLiwge2lkOmV4cHIsIF9fa3dwOnRydWV9LCB7aWQ6ZXhwciwgX19rd3A6dHJ1ZX0sIC4uLlxuICAgIHZhciBlbHRzID0gW10sIGZpcnN0ID0gdHJ1ZTtcbiAgICB3aGlsZSAoIWVhdChfcGFyZW5SKSkge1xuICAgICAgaWYgKCFmaXJzdCkgZXhwZWN0KF9jb21tYSk7XG4gICAgICBlbHNlIGZpcnN0ID0gZmFsc2U7XG4gICAgICB2YXIgZXhwciA9IHBhcnNlRXhwck9wcyhmYWxzZSk7XG4gICAgICBpZiAoZWF0KF9lcSkpIHtcbiAgICAgICAgdmFyIHJpZ2h0ID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgICAgdmFyIGt3SWQgPSBuYy5jcmVhdGVOb2RlU3BhbihleHByLCByaWdodCwgXCJJZGVudGlmaWVyXCIsIHtuYW1lOlwiX19rd3BcIn0pO1xuICAgICAgICB2YXIga3dMaXQgPSBuYy5jcmVhdGVOb2RlU3BhbihleHByLCByaWdodCwgXCJMaXRlcmFsXCIsIHt2YWx1ZTp0cnVlfSk7XG4gICAgICAgIHZhciBsZWZ0ID0gbmMuY3JlYXRlTm9kZVNwYW4oZXhwciwgcmlnaHQsIFwiT2JqZWN0RXhwcmVzc2lvblwiLCB7IHByb3BlcnRpZXM6IFtdIH0pO1xuICAgICAgICBsZWZ0LnByb3BlcnRpZXMucHVzaCh7IHR5cGU6IFwiUHJvcGVydHlcIiwga2V5OiBleHByLCB2YWx1ZTogcmlnaHQsIGtpbmQ6IFwiaW5pdFwiIH0pO1xuICAgICAgICBsZWZ0LnByb3BlcnRpZXMucHVzaCh7IHR5cGU6IFwiUHJvcGVydHlcIiwga2V5OiBrd0lkLCB2YWx1ZToga3dMaXQsIGtpbmQ6IFwiaW5pdFwiIH0pO1xuICAgICAgICBleHByID0gbGVmdDtcbiAgICAgIH1cbiAgICAgIGVsdHMucHVzaChleHByKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsdHM7XG4gIH1cblxuICAvLyBQYXJzZSB0aGUgbmV4dCB0b2tlbiBhcyBhbiBpZGVudGlmaWVyLiBJZiBgbGliZXJhbGAgaXMgdHJ1ZSAodXNlZFxuICAvLyB3aGVuIHBhcnNpbmcgcHJvcGVydGllcyksIGl0IHdpbGwgYWxzbyBjb252ZXJ0IGtleXdvcmRzIGludG9cbiAgLy8gaWRlbnRpZmllcnMuXG5cbiAgLy8gVE9ETzogbGliZXJhbD9cblxuICBmdW5jdGlvbiBwYXJzZUlkZW50KGxpYmVyYWwpIHtcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgIGlmIChsaWJlcmFsKSBsaWJlcmFsID0gZmFsc2U7XG4gICAgaWYgKHRva1R5cGUgPT09IF9uYW1lKSB7XG4gICAgICBpZiAoIWxpYmVyYWwgJiYgc3RyaWN0ICYmIGlucHV0LnNsaWNlKHRva1N0YXJ0LCB0b2tFbmQpLmluZGV4T2YoXCJcXFxcXCIpID09IC0xKVxuICAgICAgICByYWlzZSh0b2tTdGFydCwgXCJUaGUga2V5d29yZCAnXCIgKyB0b2tWYWwgKyBcIicgaXMgcmVzZXJ2ZWRcIik7XG4gICAgICBub2RlLm5hbWUgPSB0b2tWYWw7XG4gICAgfSBlbHNlIGlmIChsaWJlcmFsICYmIHRva1R5cGUua2V5d29yZCkge1xuICAgICAgbm9kZS5uYW1lID0gdG9rVHlwZS5rZXl3b3JkO1xuICAgIH0gZWxzZSB7XG4gICAgICB1bmV4cGVjdGVkKCk7XG4gICAgfVxuICAgIHRva1JlZ2V4cEFsbG93ZWQgPSBmYWxzZTtcbiAgICBuZXh0KCk7XG4gICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJJZGVudGlmaWVyXCIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VUdXBsZShub0luLCBleHByKSB7XG4gICAgdmFyIG5vZGUgPSBleHByID8gc3RhcnROb2RlRnJvbShleHByKSA6IHN0YXJ0Tm9kZSgpO1xuICAgIG5vZGUuYXJndW1lbnRzID0gZXhwciA/IFtleHByXSA6IFtdO1xuXG4gICAgLy8gVHVwbGUgd2l0aCBzaW5nbGUgZWxlbWVudCBoYXMgc3BlY2lhbCB0cmFpbGluZyBjb21tYTogdCA9ICdoaScsXG4gICAgLy8gTG9vayBhaGVhZCBhbmQgZWF0IGNvbW1hIGluIHRoaXMgc2NlbmFyaW9cbiAgICBpZiAodG9rVHlwZSA9PT0gX2NvbW1hKSB7XG4gICAgICB2YXIgb2xkUG9zID0gdG9rUG9zOyBza2lwU3BhY2UoKTtcbiAgICAgIHZhciBuZXdQb3MgPSB0b2tQb3M7IHRva1BvcyA9IG9sZFBvcztcbiAgICAgIGlmIChuZXdQb3MgPj0gaW5wdXRMZW4gfHwgaW5wdXRbbmV3UG9zXSA9PT0gJzsnIHx8IGlucHV0W25ld1Bvc10gPT09ICcpJyB8fCBuZXdsaW5lLnRlc3QoaW5wdXRbbmV3UG9zXSkpXG4gICAgICAgIGVhdChfY29tbWEpO1xuICAgIH1cblxuICAgIHdoaWxlIChlYXQoX2NvbW1hKSkge1xuICAgICAgbm9kZS5hcmd1bWVudHMucHVzaChwYXJzZUV4cHJPcHMobm9JbikpO1xuICAgIH1cbiAgICBmaW5pc2hOb2RlKG5vZGUsIFwiTmV3RXhwcmVzc2lvblwiKTtcblxuICAgIHZhciBydW50aW1lSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgfSk7XG4gICAgdmFyIG9iamVjdHNJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwib2JqZWN0c1wiIH0pO1xuICAgIHZhciBydW50aW1lTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lSWQsIHByb3BlcnR5OiBvYmplY3RzSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICB2YXIgbGlzdElkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJ0dXBsZVwiIH0pO1xuICAgIG5vZGUuY2FsbGVlID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lTWVtYmVyLCBwcm9wZXJ0eTogbGlzdElkLCBjb21wdXRlZDogZmFsc2UgfSk7XG5cbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG5cbiAgLy8gIyMgUHl0aG9uIHJ1bnRpbWUgbGlicmFyeVxuXG4gIHZhciBweXRob25SdW50aW1lID0gZXhwb3J0cy5weXRob25SdW50aW1lID0ge1xuXG4gICAgLy8gU2hpbSBKYXZhU2NyaXB0IG9iamVjdHMgdGhhdCBpbXBlcnNvbmF0ZSBQeXRob24gZXF1aXZhbGVudHNcblxuICAgIC8vIFRPRE86IHVzZSAndHlwZScgb3IgaXNTZXF1ZW5jZSBpbnN0ZWFkIG9mICdpbnN0YW5jZW9mIEFycmF5JyB0byBpZCB0aGVzZVxuXG4gICAgaW50ZXJuYWw6IHtcbiAgICAgIC8vIE9ubHkgdXNlZCB3aXRoaW4gcnVudGltZVxuICAgICAgaXNTZXE6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBhICYmIChhLl90eXBlID09PSBcImxpc3RcIiB8fCBhLl90eXBlID09PSBcInR1cGxlXCIpOyB9LFxuICAgICAgc2xpY2U6IGZ1bmN0aW9uIChvYmosIHN0YXJ0LCBlbmQsIHN0ZXApIHtcbiAgICAgICAgaWYgKHN0ZXAgPT0gbnVsbCB8fCBzdGVwID09PSAwKSBzdGVwID0gMTsgLy8gVE9ETzogc3RlcCA9PT0gMCBpcyBhIHJ1bnRpbWUgZXJyb3JcbiAgICAgICAgaWYgKHN0YXJ0ID09IG51bGwpIHtcbiAgICAgICAgICBpZiAoc3RlcCA8IDApIHN0YXJ0ID0gb2JqLmxlbmd0aCAtIDE7XG4gICAgICAgICAgZWxzZSBzdGFydCA9IDA7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnQgPCAwKSBzdGFydCArPSBvYmoubGVuZ3RoO1xuICAgICAgICBpZiAoZW5kID09IG51bGwpIHtcbiAgICAgICAgICBpZiAoc3RlcCA8IDApIGVuZCA9IC0xO1xuICAgICAgICAgIGVsc2UgZW5kID0gb2JqLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIGlmIChlbmQgPCAwKSBlbmQgKz0gb2JqLmxlbmd0aDtcblxuICAgICAgICB2YXIgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCksIHRtcCwgaTtcbiAgICAgICAgaWYgKHN0ZXAgPCAwKSB7XG4gICAgICAgICAgdG1wID0gb2JqLnNsaWNlKGVuZCArIDEsIHN0YXJ0ICsgMSk7XG4gICAgICAgICAgZm9yIChpID0gdG1wLmxlbmd0aCAtIDE7IGkgPj0gMDsgaSArPSBzdGVwKSByZXQuYXBwZW5kKHRtcFtpXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdG1wID0gb2JqLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICAgICAgICAgIGlmIChzdGVwID09PSAxKSByZXQgPSBweXRob25SdW50aW1lLnV0aWxzLmNyZWF0ZUxpc3QodG1wKTtcbiAgICAgICAgICBlbHNlIGZvciAoaSA9IDA7IGkgPCB0bXAubGVuZ3RoOyBpICs9IHN0ZXApIHJldC5hcHBlbmQodG1wW2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfSxcbiAgICAgIGlzSlNBcnJheTogQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgdXRpbHM6IHtcbiAgICAgIGNvbnZlcnRUb0RpY3Q6IGZ1bmN0aW9uIChkaWN0KSB7XG4gICAgICAgIGlmICghZGljdC5oYXNPd25Qcm9wZXJ0eShcIl90eXBlXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpY3QsIFwiX3R5cGVcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICdkaWN0Jzt9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRpY3QuaGFzT3duUHJvcGVydHkoXCJfaXNQeXRob25cIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGljdCwgXCJfaXNQeXRob25cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGljdC5oYXNPd25Qcm9wZXJ0eShcIml0ZW1zXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpY3QsIFwiaXRlbXNcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgICAgICAgZm9yICh2YXIgayBpbiB0aGlzKSBpdGVtcy5hcHBlbmQobmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy50dXBsZShrLCB0aGlzW2tdKSk7XG4gICAgICAgICAgICAgIHJldHVybiBpdGVtcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGljdC5oYXNPd25Qcm9wZXJ0eShcImxlbmd0aFwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaWN0LCBcImxlbmd0aFwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcykubGVuZ3RoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkaWN0Lmhhc093blByb3BlcnR5KFwiY2xlYXJcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGljdCwgXCJjbGVhclwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcykgZGVsZXRlIHRoaXNbaV07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRpY3QuaGFzT3duUHJvcGVydHkoXCJnZXRcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGljdCwgXCJnZXRcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKGtleSwgZGVmKSB7XG4gICAgICAgICAgICAgIGlmIChrZXkgaW4gdGhpcykgcmV0dXJuIHRoaXNba2V5XTtcbiAgICAgICAgICAgICAgZWxzZSBpZiAoZGVmICE9PSB1bmRlZmluZWQpIHJldHVybiBkZWY7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkaWN0Lmhhc093blByb3BlcnR5KFwia2V5c1wiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaWN0LCBcImtleXNcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRpY3QuaGFzT3duUHJvcGVydHkoXCJwb3BcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGljdCwgXCJwb3BcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKGtleSwgZGVmKSB7XG4gICAgICAgICAgICAgIHZhciB2YWx1ZTtcbiAgICAgICAgICAgICAgaWYgKGtleSBpbiB0aGlzKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzW2tleV07XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXNba2V5XTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZWYgIT09IHVuZGVmaW5lZCkgdmFsdWUgPSBkZWY7XG4gICAgICAgICAgICAgIGVsc2UgcmV0dXJuIG5ldyBFcnJvcihcIktleUVycm9yXCIpO1xuICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRpY3QuaGFzT3duUHJvcGVydHkoXCJ2YWx1ZXNcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGljdCwgXCJ2YWx1ZXNcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICB2YXIgdmFsdWVzID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCk7XG4gICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzKSB2YWx1ZXMuYXBwZW5kKHRoaXNba2V5XSk7XG4gICAgICAgICAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNyZWF0ZURpY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMuZGljdCgpO1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiBhcmd1bWVudHNbMF0gaW5zdGFuY2VvZiBPYmplY3QpXG4gICAgICAgICAgZm9yICh2YXIgayBpbiBhcmd1bWVudHNbMF0pIHJldFtrXSA9IGFyZ3VtZW50c1swXVtrXTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcImNyZWF0ZURpY3QgZXhwZWN0cyBhIHNpbmdsZSBKYXZhU2NyaXB0IG9iamVjdFwiKVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfSxcbiAgICAgIGNyZWF0ZVBhcmFtc09iajogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBJbjogZXhwciwgZXhwciwgLi4uLCB7aWQ6ZXhwciwgX19rd3A6dHJ1ZX0sIHtpZDpleHByLCBfX2t3cDp0cnVlfSwgLi4uXG4gICAgICAgIC8vIE91dDoge2Zvcm1hbHM6W2V4cHIsIGV4cHIsIC4uLl0sIGtleXdvcmRzOntpZDpleHByLCBpZDpleHByLCAuLi59fVxuICAgICAgICB2YXIgcGFyYW1zID0geyBmb3JtYWxzOiBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKSwga2V5d29yZHM6IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMuZGljdCgpIH07XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKGFyZ3VtZW50c1tpXSAmJiBhcmd1bWVudHNbaV0uX19rd3AgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gYXJndW1lbnRzW2ldKVxuICAgICAgICAgICAgICBpZiAoayAhPT0gJ19fa3dwJykgcGFyYW1zLmtleXdvcmRzW2tdID0gYXJndW1lbnRzW2ldW2tdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHBhcmFtcy5mb3JtYWxzLnB1c2goYXJndW1lbnRzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgfSxcbiAgICAgIGNvbnZlcnRUb0xpc3Q6IGZ1bmN0aW9uIChsaXN0KSB7XG4gICAgICAgIGlmICghbGlzdC5oYXNPd25Qcm9wZXJ0eShcIl90eXBlXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwiX3R5cGVcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICdsaXN0JzsgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiX2lzUHl0aG9uXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwiX2lzUHl0aG9uXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJhcHBlbmRcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJhcHBlbmRcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgdGhpcy5wdXNoKHgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiY2xlYXJcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJjbGVhclwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHRoaXMuc3BsaWNlKDAsIHRoaXMubGVuZ3RoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGlzdC5oYXNPd25Qcm9wZXJ0eShcImNvcHlcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJjb3B5XCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2xpY2UoMCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJjb3VudFwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcImNvdW50XCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgIHZhciBjID0gMDtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgICAgIGlmICh0aGlzW2ldID09PSB4KSBjKys7XG4gICAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiZXF1YWxzXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwiZXF1YWxzXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGVuZ3RoICE9PSB4Lmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgaWYgKHRoaXNbaV0uaGFzT3duUHJvcGVydHkoXCJlcXVhbHNcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzW2ldLmVxdWFscyh4W2ldKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzW2ldICE9PSB4W2ldKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiZXh0ZW5kXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwiZXh0ZW5kXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChMKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTC5sZW5ndGg7IGkrKykgdGhpcy5wdXNoKExbaV0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiaW5kZXhcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJpbmRleFwiLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbmRleE9mKHgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiaW5kZXhPZlwiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcImluZGV4T2ZcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHgsIGZyb21JbmRleCkge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBmcm9tSW5kZXggPyBmcm9tSW5kZXggOiAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgaWYgKHRoaXNbaV0uaGFzT3duUHJvcGVydHkoXCJlcXVhbHNcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNbaV0uZXF1YWxzKHgpKSByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpc1tpXSA9PT0geCkgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwiaW5zZXJ0XCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwiaW5zZXJ0XCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChpLCB4KSB7XG4gICAgICAgICAgICAgIHRoaXMuc3BsaWNlKGksIDAsIHgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFsaXN0Lmhhc093blByb3BlcnR5KFwicG9wXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwicG9wXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgIGlmICghaSlcbiAgICAgICAgICAgICAgICBpID0gdGhpcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXNbaV07XG4gICAgICAgICAgICAgIHRoaXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGlzdC5oYXNPd25Qcm9wZXJ0eShcIl9weVNsaWNlXCIpKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpc3QsIFwiX3B5U2xpY2VcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIHN0ZXApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHB5dGhvblJ1bnRpbWUuaW50ZXJuYWwuc2xpY2UodGhpcywgc3RhcnQsIGVuZCwgc3RlcCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJyZW1vdmVcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJyZW1vdmVcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgdGhpcy5zcGxpY2UodGhpcy5pbmRleE9mKHgpLCAxKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGlzdC5oYXNPd25Qcm9wZXJ0eShcInNvcnRcIikpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdCwgXCJzb3J0XCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKHgsIHJldmVyc2UpIHtcbiAgICAgICAgICAgICAgdmFyIGxpc3QyID0gdGhpcy5zbGljZSgwKTtcbiAgICAgICAgICAgICAgdmFyIGFwcGx5X2tleSA9IGZ1bmN0aW9uKGEsIG51bWVyaWNhbCkge1xuICAgICAgICAgICAgICAgIHZhciBsaXN0MyA9IGxpc3QyLm1hcCh4KTtcbiAgICAgICAgICAgICAgICAvLyBjb25zdHJ1Y3QgYSBkaWN0IHRoYXQgbWFwcyB0aGUgbGlzdGF5IGJlZm9yZSBhbmQgYWZ0ZXIgdGhlIG1hcFxuICAgICAgICAgICAgICAgIHZhciBtYXBwaW5nID0ge31cbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgaW4gbGlzdDMpIG1hcHBpbmdbbGlzdDNbaV1dID0gbGlzdDJbaV07XG4gICAgICAgICAgICAgICAgaWYobnVtZXJpY2FsKVxuICAgICAgICAgICAgICAgICAgbGlzdDMuc29ydChmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhIC0gYjsgfSk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgbGlzdDMuc29ydCgpXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpIGluIGEpIGFbaV0gPSBtYXBwaW5nW2xpc3QzW2ldXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBmb3IodmFyIGkgaW4gdGhpcykge1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzW2ldICE9PSAnbnVtYmVyJyB8fCAhaXNGaW5pdGUodGhpc1tpXSkpIHtcbiAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiB4ICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcGx5X2tleSh0aGlzLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdDIuc29ydCgpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHRoaXMpIHRoaXNbal0gPSBsaXN0MltqXTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGlmKHJldmVyc2UpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmV2ZXJzZSgpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZih0eXBlb2YgeCAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGFwcGx5X2tleSh0aGlzLCB0cnVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsaXN0Mi5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGEgLSBiOyB9KTtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgaW4gdGhpcykgdGhpc1tpXSA9IGxpc3QyW2ldO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKHJldmVyc2UpXG4gICAgICAgICAgICAgICAgdGhpcy5yZXZlcnNlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxpc3QuaGFzT3duUHJvcGVydHkoXCJ0b1N0cmluZ1wiKSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShsaXN0LCBcInRvU3RyaW5nXCIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuICdbJyArIHRoaXMuam9pbignLCAnKSArICddJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY3JlYXRlTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCk7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIGFyZ3VtZW50c1swXSBpbnN0YW5jZW9mIEFycmF5KVxuICAgICAgICAgIGZvciAodmFyIGkgaW4gYXJndW1lbnRzWzBdKSByZXQucHVzaChhcmd1bWVudHNbMF1baV0pO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgZm9yICh2YXIgaSBpbiBhcmd1bWVudHMpIHJldC5wdXNoKGFyZ3VtZW50c1tpXSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9XG4gICAgfSxcblxuICAgIG9wczoge1xuICAgICAgYWRkOiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICBpZiAocHl0aG9uUnVudGltZS5pbnRlcm5hbC5pc1NlcShhKSAmJiBweXRob25SdW50aW1lLmludGVybmFsLmlzU2VxKGIpKSB7XG4gICAgICAgICAgaWYgKGEuX3R5cGUgIT09IGIuX3R5cGUpXG4gICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCJjYW4gb25seSBjb25jYXRlbmF0ZSBcIiArIGEuX3R5cGUgKyBcIiAobm90ICdcIiArIGIuX3R5cGUgKyBcIicpIHRvIFwiICsgYS5fdHlwZSk7XG4gICAgICAgICAgdmFyIHJldDtcbiAgICAgICAgICBpZiAoYS5fdHlwZSA9PT0gJ2xpc3QnKSByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgICBlbHNlIGlmIChhLl90eXBlID09PSAndHVwbGUnKSByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLnR1cGxlKCk7XG4gICAgICAgICAgaWYgKHJldCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKSByZXQucHVzaChhW2ldKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYi5sZW5ndGg7IGkrKykgcmV0LnB1c2goYltpXSk7XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYSArIGI7XG4gICAgICB9LFxuICAgICAgaW46IGZ1bmN0aW9uIChhLCBiLCBuKSB7XG4gICAgICAgIHZhciByID0gYi5oYXNPd25Qcm9wZXJ0eSgnaW5kZXhPZicpID8gYi5pbmRleE9mKGEpID49IDAgOiBhIGluIGI7XG4gICAgICAgIHJldHVybiBuID8gIXIgOiByO1xuICAgICAgfSxcbiAgICAgIG11bHRpcGx5OiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAvLyBUT0RPOiBub24tc2VxdWVuY2Ugb3BlcmFuZCBtdXN0IGJlIGFuIGludGVnZXJcbiAgICAgICAgaWYgKHB5dGhvblJ1bnRpbWUuaW50ZXJuYWwuaXNTZXEoYSkgJiYgIWlzTmFOKHBhcnNlSW50KGIpKSkge1xuICAgICAgICAgIHZhciByZXQ7XG4gICAgICAgICAgaWYgKGEuX3R5cGUgPT09ICdsaXN0JykgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCk7XG4gICAgICAgICAgZWxzZSBpZiAoYS5fdHlwZSA9PT0gJ3R1cGxlJykgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy50dXBsZSgpO1xuICAgICAgICAgIGlmIChyZXQpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYjsgaSsrKVxuICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGEubGVuZ3RoOyBqKyspIHJldC5wdXNoKGFbal0pO1xuICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocHl0aG9uUnVudGltZS5pbnRlcm5hbC5pc1NlcShiKSAmJiAhaXNOYU4ocGFyc2VJbnQoYSkpKSB7XG4gICAgICAgICAgdmFyIHJldDtcbiAgICAgICAgICBpZiAoYi5fdHlwZSA9PT0gJ2xpc3QnKSByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgICBlbHNlIGlmIChiLl90eXBlID09PSAndHVwbGUnKSByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLnR1cGxlKCk7XG4gICAgICAgICAgaWYgKHJldCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhOyBpKyspXG4gICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYi5sZW5ndGg7IGorKykgcmV0LnB1c2goYltqXSk7XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYSAqIGI7XG4gICAgICB9LFxuICAgICAgc3Vic2NyaXB0SW5kZXg6IGZ1bmN0aW9uIChvLCBpKSB7XG4gICAgICAgIGlmIChweXRob25SdW50aW1lLmludGVybmFsLmlzU2VxKG8pICYmIGkgPCAwKSByZXR1cm4gby5sZW5ndGggKyBpO1xuICAgICAgICBpZiAocHl0aG9uUnVudGltZS5pbnRlcm5hbC5pc0pTQXJyYXkobykgJiYgaSA8IDAgKSByZXR1cm4gby5sZW5ndGggKyBpO1xuICAgICAgICBpZiAoIHR5cGVvZiBvID09PSBcInN0cmluZ1wiICYmIGkgPCAwICkgcmV0dXJuIG8ubGVuZ3RoICsgaTtcbiAgICAgICAgcmV0dXJuIGk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIG9iamVjdHM6IHtcbiAgICAgIGRpY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG9iaiA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpIGluIGFyZ3VtZW50cykgb2JqW2FyZ3VtZW50c1tpXVswXV0gPSBhcmd1bWVudHNbaV1bMV07XG4gICAgICAgIHB5dGhvblJ1bnRpbWUudXRpbHMuY29udmVydFRvRGljdChvYmopO1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgfSxcbiAgICAgIGxpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFyciA9IFtdO1xuICAgICAgICBhcnIucHVzaC5hcHBseShhcnIsIGFyZ3VtZW50cyk7XG4gICAgICAgIHB5dGhvblJ1bnRpbWUudXRpbHMuY29udmVydFRvTGlzdChhcnIpO1xuICAgICAgICByZXR1cm4gYXJyO1xuICAgICAgfSxcbiAgICAgIHR1cGxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcnIgPSBbXTtcbiAgICAgICAgYXJyLnB1c2guYXBwbHkoYXJyLCBhcmd1bWVudHMpO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYXJyLCBcIl90eXBlXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICd0dXBsZSc7IH0sXG4gICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcnIsIFwiX2lzUHl0aG9uXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH0sXG4gICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcnIsIFwiY291bnRcIixcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgdmFyIGMgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgICBpZiAodGhpc1tpXSA9PT0geCkgYysrO1xuICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGFyciwgXCJlcXVhbHNcIixcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMubGVuZ3RoICE9PSB4Lmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpc1tpXS5oYXNPd25Qcm9wZXJ0eShcImVxdWFsc1wiKSkge1xuICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzW2ldLmVxdWFscyh4W2ldKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpc1tpXSAhPT0geFtpXSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcnIsIFwiaW5kZXhcIixcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhPZih4KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYXJyLCBcImluZGV4T2ZcIixcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoeCwgZnJvbUluZGV4KSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gZnJvbUluZGV4ID8gZnJvbUluZGV4IDogMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpc1tpXS5oYXNPd25Qcm9wZXJ0eShcImVxdWFsc1wiKSkge1xuICAgICAgICAgICAgICAgICAgaWYgKHRoaXNbaV0uZXF1YWxzKHgpKSByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXNbaV0gPT09IHgpIHJldHVybiBpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGFyciwgXCJfcHlTbGljZVwiLFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBzdGVwKSB7IFxuICAgICAgICAgICAgcmV0dXJuIHB5dGhvblJ1bnRpbWUuaW50ZXJuYWwuc2xpY2UodGhpcywgc3RhcnQsIGVuZCwgc3RlcCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYXJyLCBcInRvU3RyaW5nXCIsXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHMgPSAnKCcgKyB0aGlzLmpvaW4oJywgJyk7XG4gICAgICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDEpIHMgKz0gJywnO1xuICAgICAgICAgICAgcyArPSAnKSc7XG4gICAgICAgICAgICByZXR1cm4gcztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYXJyO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBQeXRob24gYnVpbHQtaW4gZnVuY3Rpb25zXG5cbiAgICBmdW5jdGlvbnM6IHtcbiAgICAgIGFiczogZnVuY3Rpb24oeCkge1xuICAgICAgICByZXR1cm4gTWF0aC5hYnMoeCk7XG4gICAgICB9LFxuICAgICAgYWxsOiBmdW5jdGlvbihpdGVyYWJsZSkge1xuICAgICAgICBmb3IgKHZhciBpIGluIGl0ZXJhYmxlKSBpZiAocHl0aG9uUnVudGltZS5mdW5jdGlvbnMuYm9vbChpdGVyYWJsZVtpXSkgIT09IHRydWUpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgICAgYW55OiBmdW5jdGlvbihpdGVyYWJsZSkge1xuICAgICAgICBmb3IgKHZhciBpIGluIGl0ZXJhYmxlKSBpZiAocHl0aG9uUnVudGltZS5mdW5jdGlvbnMuYm9vbChpdGVyYWJsZVtpXSkgPT09IHRydWUpIHJldHVybiB0cnVlO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9LFxuICAgICAgYXNjaWk6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICB2YXIgcyA9IHB5dGhvblJ1bnRpbWUuZnVuY3Rpb25zLnJlcHIob2JqKSxcbiAgICAgICAgICAgIGFzYyA9IFwiXCIsXG4gICAgICAgICAgICBjb2RlO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb2RlID0gcy5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgIGlmIChjb2RlIDw9IDEyNykgYXNjICs9IHNbaV07XG4gICAgICAgICAgZWxzZSBpZiAoY29kZSA8PSAweEZGKSBhc2MgKz0gXCJcXFxceFwiICsgY29kZS50b1N0cmluZygxNik7XG4gICAgICAgICAgZWxzZSBpZiAoMHhEODAwIDw9IGNvZGUgJiYgY29kZSA8PSAweERCRkYpIHsgLy8gVUNTLTIgZm9yIHRoZSBhc3RyYWwgY2hhcnNcbiAgICAgICAgICAgIC8vIGlmIChpKzEgPj0gcy5sZW5ndGgpIHRocm93IFwiSGlnaCBzdXJyb2dhdGUgbm90IGZvbGxvd2VkIGJ5IGxvdyBzdXJyb2dhdGVcIjsgLy8gSXMgdGhpcyBuZWVkZWQ/XG4gICAgICAgICAgICBjb2RlID0gKChjb2RlLTB4RDgwMCkqMHg0MDApKyhzLmNoYXJDb2RlQXQoKytpKS0weERDMDApKzB4MTAwMDA7XG4gICAgICAgICAgICBhc2MgKz0gXCJcXFxcVVwiICsgKFwiMDAwXCIrY29kZS50b1N0cmluZygxNikpLnNsaWNlKC04KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPD0gMHhGRkZGKSBhc2MgKz0gXCJcXFxcdVwiICsgKFwiMFwiK2NvZGUudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7XG4gICAgICAgICAgZWxzZSBpZiAoY29kZSA8PSAweDEwRkZGRikgYXNjICs9IFwiXFxcXFVcIiArIChcIjAwMFwiK2NvZGUudG9TdHJpbmcoMTYpKS5zbGljZSgtOCk7XG4gICAgICAgICAgZWxzZTsgLy8gSW52YWxpZCB2YWx1ZSwgc2hvdWxkIHByb2JhYmx5IHRocm93IHNvbWV0aGluZy4gSXQgc2hvdWxkIG5ldmVyIGdldCBoZXJlIHRob3VnaCBhcyBzdHJpbmdzIHNob3VsZG4ndCBjb250YWluIHRoZW0gaW4gdGhlIGZpcnN0IHBsYWNlXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFzYztcbiAgICAgIH0sXG4gICAgICBib29sOiBmdW5jdGlvbih4KSB7XG4gICAgICAgIHJldHVybiAhKHggPT09IHVuZGVmaW5lZCB8fCAvLyBObyBhcmd1bWVudFxuICAgICAgICAgICAgICAgICB4ID09PSBudWxsIHx8IC8vIE5vbmVcbiAgICAgICAgICAgICAgICAgeCA9PT0gZmFsc2UgfHwgLy8gRmFsc2VcbiAgICAgICAgICAgICAgICAgeCA9PT0gMCB8fCAvLyBaZXJvXG4gICAgICAgICAgICAgICAgIHgubGVuZ3RoID09PSAwIHx8IC8vIEVtcHR5IFNlcXVlbmNlXG4gICAgICAgICAgICAgICAgIC8vIFRPRE86IEVtcHR5IE1hcHBpbmcsIG5lZWRzIG1vcmUgc3VwcG9ydCBmb3IgcHl0aG9uIG1hcHBpbmdzIGZpcnN0XG4gICAgICAgICAgICAgICAgICh4Ll9fYm9vbF9fICE9PSB1bmRlZmluZWQgJiYgeC5fX2Jvb2xfXygpID09PSBmYWxzZSkgfHwgLy8gSWYgaXQgaGFzIGJvb2wgY29udmVyc2lvbiBkZWZpbmVkXG4gICAgICAgICAgICAgICAgICh4Ll9fbGVuX18gIT09IHVuZGVmaW5lZCAmJiAoeC5fX2xlbl9fKCkgPT09IGZhbHNlIHx8IHguX19sZW5fXygpID09PSAwKSkpOyAvLyBJZiBpdCBoYXMgbGVuZ3RoIGNvbnZlcnNpb24gZGVmaW5lZFxuICAgICAgfSxcbiAgICAgIGNocjogZnVuY3Rpb24oaSkge1xuICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShpKTsgLy8gVE9ETzogRXJyb3IgY29kZSBmb3Igbm90IDAgPD0gaSA8PSAxMTE0MTExXG4gICAgICB9LFxuICAgICAgZGl2bW9kOiBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIHJldHVybiBweXRob25SdW50aW1lLm9iamVjdHMudHVwbGUoTWF0aC5mbG9vcihhL2IpLCBhJWIpO1xuICAgICAgfSxcbiAgICAgIGVudW1lcmF0ZTogZnVuY3Rpb24oaXRlcmFibGUsIHN0YXJ0KSB7XG4gICAgICAgIHN0YXJ0ID0gc3RhcnQgfHwgMDtcbiAgICAgICAgdmFyIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICBmb3IgKHZhciBpIGluIGl0ZXJhYmxlKSByZXQucHVzaChuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLnR1cGxlKHN0YXJ0KyssIGl0ZXJhYmxlW2ldKSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9LFxuICAgICAgZmlsdGVyOiBmdW5jdGlvbihmbiwgaXRlcmFibGUpIHtcbiAgICAgICAgZm4gPSBmbiB8fCBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9O1xuICAgICAgICB2YXIgcmV0ID0gbmV3IHB5dGhvblJ1bnRpbWUub2JqZWN0cy5saXN0KCk7XG4gICAgICAgIGZvciAodmFyIGkgaW4gaXRlcmFibGUpIGlmIChmbihpdGVyYWJsZVtpXSkpIHJldC5wdXNoKGl0ZXJhYmxlW2ldKTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH0sXG4gICAgICBmbG9hdDogZnVuY3Rpb24oeCkge1xuICAgICAgICBpZiAoeCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gMC4wO1xuICAgICAgICBlbHNlIGlmICh0eXBlb2YgeCA9PSBcInN0cmluZ1wiKSB7IC8vIFRPRE86IEZpeCB0eXBlIGNoZWNrXG4gICAgICAgICAgeCA9IHgudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgaWYgKCgvXlsrLV0/aW5mKGluaXR5KT8kL2kpLmV4ZWMoeCkgIT09IG51bGwpIHJldHVybiBJbmZpbml0eSooeFswXT09PVwiLVwiPy0xOjEpO1xuICAgICAgICAgIGVsc2UgaWYgKCgvXm5hbiQvaSkuZXhlYyh4KSAhPT0gbnVsbCkgcmV0dXJuIE5hTjtcbiAgICAgICAgICBlbHNlIHJldHVybiBwYXJzZUZsb2F0KHgpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB4ID09IFwibnVtYmVyXCIpIHsgLy8gVE9ETzogRml4IHR5cGUgY2hlY2tcbiAgICAgICAgICByZXR1cm4geDsgLy8gVE9ETzogR2V0IHB5dGhvbiB0eXBlcyB3b3JraW5nIHJpZ2h0IHNvIHdlIGNhbiByZXR1cm4gYW4gYWN0dWFsIGZsb2F0XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHguX19mbG9hdF9fICE9PSB1bmRlZmluZWQpIHJldHVybiB4Ll9fZmxvYXRfXygpO1xuICAgICAgICAgIGVsc2UgcmV0dXJuIG51bGw7IC8vIFRPRE86IFRocm93IFR5cGVFcnJvcjogZmxvYXQoKSBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nIG9yIGEgbnVtYmVyLCBub3QgJzx0eXBlIG9mIHg+J1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaGV4OiBmdW5jdGlvbih4KSB7XG4gICAgICAgIHJldHVybiB4LnRvU3RyaW5nKDE2KTtcbiAgICAgIH0sXG4gICAgICBpbnQ6IGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludChzKTtcbiAgICAgIH0sXG4gICAgICBsZW46IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHJldHVybiBvLmxlbmd0aDtcbiAgICAgIH0sXG4gICAgICBsaXN0OiBmdW5jdGlvbiAoaXRlcmFibGUpIHtcbiAgICAgICAgdmFyIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICBpZiAoaXRlcmFibGUgaW5zdGFuY2VvZiBBcnJheSkgZm9yICh2YXIgaSBpbiBpdGVyYWJsZSkgcmV0LnB1c2goaXRlcmFibGVbaV0pO1xuICAgICAgICBlbHNlIGZvciAodmFyIGkgaW4gaXRlcmFibGUpIHJldC5wdXNoKGkpO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfSxcbiAgICAgIG1hcDogZnVuY3Rpb24oZm4sIGl0ZXJhYmxlKSB7XG4gICAgICAgIC8vIFRPRE86IHN1cHBvcnQgYWRkaXRpb25hbCBpdGVyYWJsZXMgcGFzc2VkXG4gICAgICAgIHZhciByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBpdGVyYWJsZSkgcmV0LnB1c2goZm4oaXRlcmFibGVbaV0pKTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH0sXG4gICAgICBtYXg6IGZ1bmN0aW9uKGFyZzEsIGFyZzIpIHtcbiAgICAgICAgLy8gVE9ETzogc3VwcG9ydCBvcHRpb25hbCBrZXl3b3JkLW9ubHkgYXJndW1lbnRzXG4gICAgICAgIC8vIFRPRE86IGVtcHR5IGl0ZXJhYmxlIHJhaXNlcyBQeXRob24gVmFsdWVFcnJvclxuICAgICAgICBpZiAoIWFyZzIpIHsgLy8gaXRlcmFibGVcbiAgICAgICAgICB2YXIgbWF4ID0gbnVsbDtcbiAgICAgICAgICBmb3IgKHZhciBpIGluIGFyZzEpIGlmIChtYXggPT09IG51bGwgfHwgYXJnMVtpXSA+IG1heCkgbWF4ID0gYXJnMVtpXTtcbiAgICAgICAgICByZXR1cm4gbWF4O1xuICAgICAgICB9IGVsc2UgcmV0dXJuIGFyZzEgPj0gYXJnMiA/IGFyZzEgOiBhcmcyO1xuICAgICAgfSxcbiAgICAgIG1pbjogZnVuY3Rpb24oYXJnMSwgYXJnMikge1xuICAgICAgICAvLyBUT0RPOiBzdXBwb3J0IG9wdGlvbmFsIGtleXdvcmQtb25seSBhcmd1bWVudHNcbiAgICAgICAgLy8gVE9ETzogZW1wdHkgaXRlcmFibGUgcmFpc2VzIFB5dGhvbiBWYWx1ZUVycm9yXG4gICAgICAgIGlmICghYXJnMikgeyAvLyBpdGVyYWJsZVxuICAgICAgICAgIHZhciBtYXggPSBudWxsO1xuICAgICAgICAgIGZvciAodmFyIGkgaW4gYXJnMSkgaWYgKG1heCA9PT0gbnVsbCB8fCBhcmcxW2ldIDwgbWF4KSBtYXggPSBhcmcxW2ldO1xuICAgICAgICAgIHJldHVybiBtYXg7XG4gICAgICAgIH0gZWxzZSByZXR1cm4gYXJnMSA8PSBhcmcyID8gYXJnMSA6IGFyZzI7XG4gICAgICB9LFxuICAgICAgb2N0OiBmdW5jdGlvbih4KSB7XG4gICAgICAgIHJldHVybiB4LnRvU3RyaW5nKDgpO1xuICAgICAgfSxcbiAgICAgIG9yZDogZnVuY3Rpb24oYykge1xuICAgICAgICByZXR1cm4gYy5jaGFyQ29kZUF0KDApO1xuICAgICAgfSxcbiAgICAgIHBvdzogZnVuY3Rpb24oeCwgeSwgeikge1xuICAgICAgICByZXR1cm4geiA/IE1hdGgucG93KHgsIHkpICUgeiA6IE1hdGgucG93KHgsIHkpO1xuICAgICAgfSxcbiAgICAgIHByaW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzID0gXCJcIjtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspXG4gICAgICAgICAgcyArPSBpID09PSAwID8gYXJndW1lbnRzW2ldIDogXCIgXCIgKyBhcmd1bWVudHNbaV07XG4gICAgICAgIGNvbnNvbGUubG9nKHMpO1xuICAgICAgfSxcbiAgICAgIHJhbmdlOiBmdW5jdGlvbiAoc3RhcnQsIHN0b3AsIHN0ZXApIHtcbiAgICAgICAgaWYgKHN0b3AgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHN0b3AgPSBzdGFydDtcbiAgICAgICAgICBzdGFydCA9IDA7XG4gICAgICAgICAgc3RlcCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc3RlcCA9PT0gdW5kZWZpbmVkKSBzdGVwID0gMTtcbiAgICAgICAgdmFyIHIgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgaWYgKHN0YXJ0IDwgc3RvcCAmJiBzdGVwID4gMCB8fCBzdGFydCA+IHN0b3AgJiYgc3RlcCA8IDApIHtcbiAgICAgICAgICB2YXIgaSA9IHN0YXJ0O1xuICAgICAgICAgIHdoaWxlIChpIDwgc3RvcCAmJiBzdGVwID4gMCB8fCBpID4gc3RvcCAmJiBzdGVwIDwgMCkge1xuICAgICAgICAgICAgci5hcHBlbmQoaSk7XG4gICAgICAgICAgICBpICs9IHN0ZXA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByO1xuICAgICAgfSxcbiAgICAgIHJlcHI6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvYmogPT09ICdzdHJpbmcnKSByZXR1cm4gXCInXCIgKyBvYmogKyBcIidcIjsgLy8gVE9ETzogUGF0Y2ggdW50aWwgdHlwZXN5c3RlbSBjb21lcyB1cC5cbiAgICAgICAgaWYgKG9iai5fX3JlcHJfXyAhPT0gdW5kZWZpbmVkKSByZXR1cm4gb2JqLl9fcmVwcl9fKCk7XG4gICAgICAgIGVsc2UgaWYgKG9iai5fX2NsYXNzX18gIT09IHVuZGVmaW5lZCAmJiBvYmouX19jbGFzc19fLm1vZHVsZSAhPT0gdW5kZWZpbmVkICYmIG9iai5fX2NsYXNzX18uX19uYW1lX18pIHtcbiAgICAgICAgICByZXR1cm4gJzwnK29iai5fX2NsYXNzX18uX19tb2R1bGVfXysnLicrb2JqLl9fY2xhc3NfXy5fX25hbWVfXysnIG9iamVjdD4nO1xuICAgICAgICB9IGVsc2UgcmV0dXJuIG9iai50b1N0cmluZygpOyAvLyBSYWlzZSBhIHBsZWFzZSByZXBvcnQgd2FybmluZyBoZXJlLCB3ZSBzaG91bGQgbmV2ZXIgcmVhY2ggdGhpcyBwaWVjZSBvZiBjb2RlXG4gICAgICB9LFxuICAgICAgcmV2ZXJzZWQ6IGZ1bmN0aW9uIChzZXEpIHtcbiAgICAgICAgdmFyIHJldCA9IG5ldyBweXRob25SdW50aW1lLm9iamVjdHMubGlzdCgpO1xuICAgICAgICBmb3IgKHZhciBpIGluIHNlcSkgcmV0LnB1c2goc2VxW2ldKTtcbiAgICAgICAgcmV0dXJuIHJldC5yZXZlcnNlKCk7XG4gICAgICB9LFxuICAgICAgcm91bmQ6IGZ1bmN0aW9uIChudW0sIG5kaWdpdHMpIHtcbiAgICAgICAgaWYgKG5kaWdpdHMpIHtcbiAgICAgICAgICB2YXIgc2NhbGUgPSBNYXRoLnBvdygxMCwgbmRpZ2l0cyk7XG4gICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobnVtICogc2NhbGUpIC8gc2NhbGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobnVtKTtcbiAgICAgIH0sXG4gICAgICBzb3J0ZWQ6IGZ1bmN0aW9uIChpdGVyYWJsZSwga2V5LCByZXZlcnNlKSB7XG4gICAgICAgIHZhciByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBpdGVyYWJsZSkgcmV0LnB1c2goaXRlcmFibGVbaV0pO1xuICAgICAgICBpZihrZXkpIHJldC5zb3J0KGtleSk7IGVsc2UgcmV0LnNvcnQoKTtcbiAgICAgICAgaWYgKHJldmVyc2UpIHJldC5yZXZlcnNlKCk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9LFxuICAgICAgc3RyOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIHJldHVybiBvYmoudG9TdHJpbmcoKTtcbiAgICAgIH0sXG4gICAgICBzdW06IGZ1bmN0aW9uIChpdGVyYWJsZSwgc3RhcnQpIHtcbiAgICAgICAgLy8gVE9ETzogc3RhcnQgY2FuJ3QgYmUgYSBzdHJpbmdcbiAgICAgICAgdmFyIHJldCA9IHN0YXJ0IHx8IDA7XG4gICAgICAgIGZvciAodmFyIGkgaW4gaXRlcmFibGUpIHJldCArPSBpdGVyYWJsZVtpXTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH0sXG4gICAgICB0dXBsZTogZnVuY3Rpb24gKGl0ZXJhYmxlKSB7XG4gICAgICAgIHZhciByZXQgPSBuZXcgcHl0aG9uUnVudGltZS5vYmplY3RzLnR1cGxlKCk7XG4gICAgICAgIGZvciAodmFyIGkgaW4gaXRlcmFibGUpIHJldC5wdXNoKGl0ZXJhYmxlW2ldKTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gUHl0aG9uIGltcG9ydHNcbiAgICAvLyBUT0RPOiBmcm9tIHggaW1wb3J0IHksIHpcblxuICAgIGltcG9ydHM6IHtcbiAgICAgIHJhbmRvbToge1xuICAgICAgICByYW5kb206IGZ1bmN0aW9uICgpIHsgcmV0dXJuIE1hdGgucmFuZG9tKCk7IH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG59KTtcbiIsIi8vIEZpbGJlcnQ6IExvb3NlIHBhcnNlclxuLy9cbi8vIFRoaXMgbW9kdWxlIHByb3ZpZGVzIGFuIGFsdGVybmF0aXZlIHBhcnNlciAoYHBhcnNlX2RhbW1pdGApIHRoYXRcbi8vIGV4cG9zZXMgdGhhdCBzYW1lIGludGVyZmFjZSBhcyBgcGFyc2VgLCBidXQgd2lsbCB0cnkgdG8gcGFyc2Vcbi8vIGFueXRoaW5nIGFzIFB5dGhvbiwgcmVwYWlyaW5nIHN5bnRheCBlcnJvcnMgdGhlIGJlc3QgaXQgY2FuLlxuLy8gVGhlcmUgYXJlIGNpcmN1bXN0YW5jZXMgaW4gd2hpY2ggaXQgd2lsbCByYWlzZSBhbiBlcnJvciBhbmQgZ2l2ZVxuLy8gdXAsIGJ1dCB0aGV5IGFyZSB2ZXJ5IHJhcmUuIFRoZSByZXN1bHRpbmcgQVNUIHdpbGwgYmUgYSBtb3N0bHlcbi8vIHZhbGlkIEphdmFTY3JpcHQgQVNUIChhcyBwZXIgdGhlIFtNb3ppbGxhIHBhcnNlciBBUEldW2FwaV0sIGV4Y2VwdFxuLy8gdGhhdDpcbi8vXG4vLyAtIFJldHVybiBvdXRzaWRlIGZ1bmN0aW9ucyBpcyBhbGxvd2VkXG4vL1xuLy8gLSBCb2d1cyBJZGVudGlmaWVyIG5vZGVzIHdpdGggYSBuYW1lIG9mIGBcIuKcllwiYCBhcmUgaW5zZXJ0ZWQgd2hlbmV2ZXJcbi8vICAgdGhlIHBhcnNlciBnb3QgdG9vIGNvbmZ1c2VkIHRvIHJldHVybiBhbnl0aGluZyBtZWFuaW5nZnVsLlxuLy9cbi8vIFthcGldOiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1NwaWRlck1vbmtleS9QYXJzZXJfQVBJXG4vL1xuLy8gVGhlIGV4cGVjdGVkIHVzZSBmb3IgdGhpcyBpcyB0byAqZmlyc3QqIHRyeSBgZmlsYmVydC5wYXJzZWAsIGFuZCBvbmx5XG4vLyBpZiB0aGF0IGZhaWxzIHN3aXRjaCB0byBgcGFyc2VfZGFtbWl0YC4gVGhlIGxvb3NlIHBhcnNlciBtaWdodFxuLy8gcGFyc2UgYmFkbHkgaW5kZW50ZWQgY29kZSBpbmNvcnJlY3RseSwgc28gKipkb24ndCoqIHVzZSBpdCBhc1xuLy8geW91ciBkZWZhdWx0IHBhcnNlci5cbi8vXG4vLyBRdWl0ZSBhIGxvdCBvZiBmaWxiZXJ0LmpzIGlzIGR1cGxpY2F0ZWQgaGVyZS4gVGhlIGFsdGVybmF0aXZlIHdhcyB0b1xuLy8gYWRkIGEgKmxvdCogb2YgZXh0cmEgY3J1ZnQgdG8gdGhhdCBmaWxlLCBtYWtpbmcgaXQgbGVzcyByZWFkYWJsZVxuLy8gYW5kIHNsb3dlci4gQ29weWluZyBhbmQgZWRpdGluZyB0aGUgY29kZSBhbGxvd2VkIGludmFzaXZlIGNoYW5nZXMgYW5kIFxuLy8gc2ltcGxpZmljYXRpb25zIHdpdGhvdXQgY3JlYXRpbmcgYSBjb21wbGljYXRlZCB0YW5nbGUuXG5cbihmdW5jdGlvbihyb290LCBtb2QpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG1vZHVsZSA9PSBcIm9iamVjdFwiKSByZXR1cm4gbW9kKGV4cG9ydHMsIHJlcXVpcmUoXCIuL2ZpbGJlcnRcIikpOyAvLyBDb21tb25KU1xuICBpZiAodHlwZW9mIGRlZmluZSA9PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkgcmV0dXJuIGRlZmluZShbXCJleHBvcnRzXCIsIFwiLi9maWxiZXJ0X2xvb3NlXCJdLCBtb2QpOyAvLyBBTURcbiAgbW9kKHJvb3QuZmlsYmVydF9sb29zZSB8fCAocm9vdC5maWxiZXJ0X2xvb3NlID0ge30pLCByb290LmZpbGJlcnQpOyAvLyBQbGFpbiBicm93c2VyIGVudlxufSkodGhpcywgZnVuY3Rpb24oZXhwb3J0cywgZmlsYmVydCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgdHQgPSBmaWxiZXJ0LnRva1R5cGVzO1xuICB2YXIgc2NvcGUgPSBmaWxiZXJ0LnNjb3BlO1xuICB2YXIgaW5kZW50SGlzdCA9IGZpbGJlcnQuaW5kZW50SGlzdDtcblxuICB2YXIgb3B0aW9ucywgaW5wdXQsIGlucHV0TGVuLCBmZXRjaFRva2VuLCBuYztcblxuICBleHBvcnRzLnBhcnNlX2RhbW1pdCA9IGZ1bmN0aW9uKGlucHQsIG9wdHMpIHtcbiAgICBpbnB1dCA9IFN0cmluZyhpbnB0KTsgaW5wdXRMZW4gPSBpbnB1dC5sZW5ndGg7XG4gICAgc2V0T3B0aW9ucyhvcHRzKTtcbiAgICBpZiAoIW9wdGlvbnMudGFiU2l6ZSkgb3B0aW9ucy50YWJTaXplID0gNDtcbiAgICBmZXRjaFRva2VuID0gZmlsYmVydC50b2tlbml6ZShpbnB0LCBvcHRpb25zKTtcbiAgICBhaGVhZC5sZW5ndGggPSAwO1xuICAgIG5ld0FzdElkQ291bnQgPSAwO1xuICAgIHNjb3BlLmluaXQoKTtcbiAgICBuYyA9IGZpbGJlcnQuZ2V0Tm9kZUNyZWF0b3Ioc3RhcnROb2RlLCBzdGFydE5vZGVGcm9tLCBmaW5pc2hOb2RlLCB1bnBhY2tUdXBsZSk7XG4gICAgbmV4dCgpO1xuICAgIHJldHVybiBwYXJzZVRvcExldmVsKCk7XG4gIH07XG5cbiAgZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRzKSB7XG4gICAgb3B0aW9ucyA9IG9wdHMgfHwge307XG4gICAgZm9yICh2YXIgb3B0IGluIGZpbGJlcnQuZGVmYXVsdE9wdGlvbnMpIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9wdGlvbnMsIG9wdCkpXG4gICAgICBvcHRpb25zW29wdF0gPSBmaWxiZXJ0LmRlZmF1bHRPcHRpb25zW29wdF07XG4gICAgc291cmNlRmlsZSA9IG9wdGlvbnMuc291cmNlRmlsZSB8fCBudWxsO1xuICB9XG5cbiAgdmFyIGxhc3RFbmQsIHRva2VuID0ge3N0YXJ0OiAwLCBlbmQ6IDB9LCBhaGVhZCA9IFtdO1xuICB2YXIgbGFzdEVuZExvYywgc291cmNlRmlsZTtcblxuICB2YXIgbmV3QXN0SWRDb3VudCA9IDA7XG5cbiAgZnVuY3Rpb24gbmV4dCgpIHtcbiAgICBsYXN0RW5kID0gdG9rZW4uZW5kO1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykgbGFzdEVuZExvYyA9IHRva2VuLmVuZExvYztcblxuICAgIGlmIChhaGVhZC5sZW5ndGgpIHRva2VuID0gYWhlYWQuc2hpZnQoKTtcbiAgICBlbHNlIHRva2VuID0gcmVhZFRva2VuKCk7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkVG9rZW4oKSB7XG4gICAgZm9yICg7Oykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGZldGNoVG9rZW4oKTtcbiAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgU3ludGF4RXJyb3IpKSB0aHJvdyBlO1xuXG4gICAgICAgIC8vIFRyeSB0byBza2lwIHNvbWUgdGV4dCwgYmFzZWQgb24gdGhlIGVycm9yIG1lc3NhZ2UsIGFuZCB0aGVuIGNvbnRpbnVlXG4gICAgICAgIHZhciBtc2cgPSBlLm1lc3NhZ2UsIHBvcyA9IGUucmFpc2VkQXQsIHJlcGxhY2UgPSB0cnVlO1xuICAgICAgICBpZiAoL3VudGVybWluYXRlZC9pLnRlc3QobXNnKSkge1xuICAgICAgICAgIHBvcyA9IGxpbmVFbmQoZS5wb3MpO1xuICAgICAgICAgIGlmICgvc3RyaW5nLy50ZXN0KG1zZykpIHtcbiAgICAgICAgICAgIHJlcGxhY2UgPSB7c3RhcnQ6IGUucG9zLCBlbmQ6IHBvcywgdHlwZTogdHQuc3RyaW5nLCB2YWx1ZTogaW5wdXQuc2xpY2UoZS5wb3MgKyAxLCBwb3MpfTtcbiAgICAgICAgICB9IGVsc2UgaWYgKC9yZWd1bGFyIGV4cHIvaS50ZXN0KG1zZykpIHtcbiAgICAgICAgICAgIHZhciByZSA9IGlucHV0LnNsaWNlKGUucG9zLCBwb3MpO1xuICAgICAgICAgICAgdHJ5IHsgcmUgPSBuZXcgUmVnRXhwKHJlKTsgfSBjYXRjaChlKSB7fVxuICAgICAgICAgICAgcmVwbGFjZSA9IHtzdGFydDogZS5wb3MsIGVuZDogcG9zLCB0eXBlOiB0dC5yZWdleHAsIHZhbHVlOiByZX07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcGxhY2UgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoL2ludmFsaWQgKHVuaWNvZGV8cmVnZXhwfG51bWJlcil8ZXhwZWN0aW5nIHVuaWNvZGV8b2N0YWwgbGl0ZXJhbHxpcyByZXNlcnZlZHxkaXJlY3RseSBhZnRlciBudW1iZXIvaS50ZXN0KG1zZykpIHtcbiAgICAgICAgICB3aGlsZSAocG9zIDwgaW5wdXQubGVuZ3RoICYmICFpc1NwYWNlKGlucHV0LmNoYXJDb2RlQXQocG9zKSkgJiYgIWlzTmV3bGluZShpbnB1dC5jaGFyQ29kZUF0KHBvcykpKSArK3BvcztcbiAgICAgICAgfSBlbHNlIGlmICgvY2hhcmFjdGVyIGVzY2FwZXxleHBlY3RlZCBoZXhhZGVjaW1hbC9pLnRlc3QobXNnKSkge1xuICAgICAgICAgIHdoaWxlIChwb3MgPCBpbnB1dC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBjaCA9IGlucHV0LmNoYXJDb2RlQXQocG9zKyspO1xuICAgICAgICAgICAgaWYgKGNoID09PSAzNCB8fCBjaCA9PT0gMzkgfHwgaXNOZXdsaW5lKGNoKSkgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKC91bmV4cGVjdGVkIGNoYXJhY3Rlci9pLnRlc3QobXNnKSkge1xuICAgICAgICAgIHBvcysrO1xuICAgICAgICAgIHJlcGxhY2UgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICgvcmVndWxhciBleHByZXNzaW9uL2kudGVzdChtc2cpKSB7XG4gICAgICAgICAgcmVwbGFjZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgfVxuICAgICAgICByZXNldFRvKHBvcyk7XG4gICAgICAgIGlmIChyZXBsYWNlID09PSB0cnVlKSByZXBsYWNlID0ge3N0YXJ0OiBwb3MsIGVuZDogcG9zLCB0eXBlOiB0dC5uYW1lLCB2YWx1ZTogXCLinJZcIn07XG4gICAgICAgIGlmIChyZXBsYWNlKSB7XG4gICAgICAgICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgICAgICAgICByZXBsYWNlLnN0YXJ0TG9jID0gZmlsYmVydC5nZXRMaW5lSW5mbyhpbnB1dCwgcmVwbGFjZS5zdGFydCk7XG4gICAgICAgICAgICByZXBsYWNlLmVuZExvYyA9IGZpbGJlcnQuZ2V0TGluZUluZm8oaW5wdXQsIHJlcGxhY2UuZW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlcGxhY2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiByZXNldFRvKHBvcykge1xuICAgIHZhciBjaCA9IGlucHV0LmNoYXJBdChwb3MgLSAxKTtcbiAgICB2YXIgcmVBbGxvd2VkID0gIWNoIHx8IC9bXFxbXFx7XFwoLDs6P1xcLyo9K1xcLX4hfCYlXjw+XS8udGVzdChjaCkgfHxcbiAgICAgIC9bZW53ZmRdLy50ZXN0KGNoKSAmJiAvXFxiKGtleXdvcmRzfGNhc2V8ZWxzZXxyZXR1cm58dGhyb3d8bmV3fGlufChpbnN0YW5jZXx0eXBlKW9mfGRlbGV0ZXx2b2lkKSQvLnRlc3QoaW5wdXQuc2xpY2UocG9zIC0gMTAsIHBvcykpO1xuICAgIGZldGNoVG9rZW4uanVtcFRvKHBvcywgcmVBbGxvd2VkKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNvcHlUb2tlbih0b2tlbikge1xuICAgIHZhciBjb3B5ID0ge3N0YXJ0OiB0b2tlbi5zdGFydCwgZW5kOiB0b2tlbi5lbmQsIHR5cGU6IHRva2VuLnR5cGUsIHZhbHVlOiB0b2tlbi52YWx1ZX07XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgICBjb3B5LnN0YXJ0TG9jID0gdG9rZW4uc3RhcnRMb2M7XG4gICAgICBjb3B5LmVuZExvYyA9IHRva2VuLmVuZExvYztcbiAgICB9XG4gICAgcmV0dXJuIGNvcHk7XG4gIH1cblxuICBmdW5jdGlvbiBsb29rQWhlYWQobikge1xuICAgIC8vIENvcHkgdG9rZW4gb2JqZWN0cywgYmVjYXVzZSBmZXRjaFRva2VuIHdpbGwgb3ZlcndyaXRlIHRoZSBvbmVcbiAgICAvLyBpdCByZXR1cm5zLCBhbmQgaW4gdGhpcyBjYXNlIHdlIHN0aWxsIG5lZWQgaXRcbiAgICBpZiAoIWFoZWFkLmxlbmd0aClcbiAgICAgIHRva2VuID0gY29weVRva2VuKHRva2VuKTtcbiAgICB3aGlsZSAobiA+IGFoZWFkLmxlbmd0aClcbiAgICAgIGFoZWFkLnB1c2goY29weVRva2VuKHJlYWRUb2tlbigpKSk7XG4gICAgcmV0dXJuIGFoZWFkW24tMV07XG4gIH1cblxuICB2YXIgbmV3bGluZSA9IC9bXFxuXFxyXFx1MjAyOFxcdTIwMjldLztcbiAgdmFyIG5vbkFTQ0lJd2hpdGVzcGFjZSA9IC9bXFx1MTY4MFxcdTE4MGVcXHUyMDAwLVxcdTIwMGFcXHUyMDJmXFx1MjA1ZlxcdTMwMDBcXHVmZWZmXS87XG5cbiAgZnVuY3Rpb24gaXNOZXdsaW5lKGNoKSB7XG4gICAgcmV0dXJuIGNoID09PSAxMCB8fCBjaCA9PT0gMTMgfHwgY2ggPT09IDgyMzIgfHwgY2ggPT09IDgzMjk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGlzU3BhY2UoY2gpIHtcbiAgICByZXR1cm4gY2ggPT09IDkgfHwgY2ggPT09IDExIHx8IGNoID09PSAxMiB8fFxuICAgICAgY2ggPT09IDMyIHx8IC8vICcgJ1xuICAgICAgY2ggPT09IDM1IHx8IC8vICcjJ1xuICAgICAgY2ggPT09IDE2MCB8fCAvLyAnXFx4YTAnXG4gICAgICBjaCA+PSA1NzYwICYmIG5vbkFTQ0lJd2hpdGVzcGFjZS50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gbGluZUVuZChwb3MpIHtcbiAgICB3aGlsZSAocG9zIDwgaW5wdXQubGVuZ3RoICYmICFpc05ld2xpbmUoaW5wdXQuY2hhckNvZGVBdChwb3MpKSkgKytwb3M7XG4gICAgcmV0dXJuIHBvcztcbiAgfVxuXG4gIGZ1bmN0aW9uIHNraXBMaW5lKCkge1xuICAgIGZldGNoVG9rZW4uanVtcFRvKGxpbmVFbmQodG9rZW4uc3RhcnQpLCBmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBOb2RlKHN0YXJ0KSB7XG4gICAgdGhpcy50eXBlID0gbnVsbDtcbiAgfVxuICBOb2RlLnByb3RvdHlwZSA9IGZpbGJlcnQuTm9kZS5wcm90b3R5cGU7XG5cbiAgZnVuY3Rpb24gU291cmNlTG9jYXRpb24oc3RhcnQpIHtcbiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQgfHwgdG9rZW4uc3RhcnRMb2MgfHwge2xpbmU6IDEsIGNvbHVtbjogMH07XG4gICAgdGhpcy5lbmQgPSBudWxsO1xuICAgIGlmIChzb3VyY2VGaWxlICE9PSBudWxsKSB0aGlzLnNvdXJjZSA9IHNvdXJjZUZpbGU7XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydE5vZGUoKSB7XG4gICAgdmFyIG5vZGUgPSBuZXcgTm9kZSh0b2tlbi5zdGFydCk7XG4gICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKVxuICAgICAgbm9kZS5sb2MgPSBuZXcgU291cmNlTG9jYXRpb24oKTtcbiAgICBpZiAob3B0aW9ucy5kaXJlY3RTb3VyY2VGaWxlKVxuICAgICAgbm9kZS5zb3VyY2VGaWxlID0gb3B0aW9ucy5kaXJlY3RTb3VyY2VGaWxlO1xuICAgIGlmIChvcHRpb25zLnJhbmdlcylcbiAgICAgIG5vZGUucmFuZ2UgPSBbdG9rZW4uc3RhcnQsIDBdO1xuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RhcnROb2RlRnJvbShvdGhlcikge1xuICAgIHZhciBub2RlID0gbmV3IE5vZGUob3RoZXIuc3RhcnQpO1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucylcbiAgICAgIG5vZGUubG9jID0gbmV3IFNvdXJjZUxvY2F0aW9uKG90aGVyLmxvYy5zdGFydCk7XG4gICAgaWYgKG9wdGlvbnMucmFuZ2VzKVxuICAgICAgbm9kZS5yYW5nZSA9IFtvdGhlci5yYW5nZVswXSwgMF07XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBmdW5jdGlvbiBmaW5pc2hOb2RlKG5vZGUsIHR5cGUpIHtcbiAgICBub2RlLnR5cGUgPSB0eXBlO1xuICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucylcbiAgICAgIG5vZGUubG9jLmVuZCA9IGxhc3RFbmRMb2M7XG4gICAgaWYgKG9wdGlvbnMucmFuZ2VzKVxuICAgICAgbm9kZS5yYW5nZVsxXSA9IGxhc3RFbmQ7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBmdW5jdGlvbiBnZXREdW1teUxvYygpIHtcbiAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHtcbiAgICAgIHZhciBsb2MgPSBuZXcgU291cmNlTG9jYXRpb24oKTtcbiAgICAgIGxvYy5lbmQgPSBsb2Muc3RhcnQ7XG4gICAgICByZXR1cm4gbG9jO1xuICAgIH1cbiAgfVxuXG4gIHZhciBkdW1teUNvdW50ID0gMFxuICBmdW5jdGlvbiBkdW1teUlkZW50KCkge1xuICAgIHZhciBkdW1teSA9IG5ldyBOb2RlKHRva2VuLnN0YXJ0KTtcbiAgICBkdW1teS50eXBlID0gXCJJZGVudGlmaWVyXCI7XG4gICAgZHVtbXkuZW5kID0gdG9rZW4uc3RhcnQ7XG4gICAgZHVtbXkubmFtZSA9IFwiZHVtbXlcIiArIGR1bW15Q291bnQrKztcbiAgICBkdW1teS5sb2MgPSBnZXREdW1teUxvYygpO1xuICAgIHJldHVybiBkdW1teTtcbiAgfVxuICBmdW5jdGlvbiBpc0R1bW15KG5vZGUpIHsgcmV0dXJuIG5vZGUubmFtZSAmJiBub2RlLm5hbWUuaW5kZXhPZihcImR1bW15XCIpID09PSAwOyB9XG5cbiAgZnVuY3Rpb24gZWF0KHR5cGUpIHtcbiAgICBpZiAodG9rZW4udHlwZSA9PT0gdHlwZSkge1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZXhwZWN0KHR5cGUpIHtcbiAgICBpZiAoZWF0KHR5cGUpKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAobG9va0FoZWFkKDEpLnR5cGUgPT0gdHlwZSkge1xuICAgICAgbmV4dCgpOyBuZXh0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGxvb2tBaGVhZCgyKS50eXBlID09IHR5cGUpIHtcbiAgICAgIG5leHQoKTsgbmV4dCgpOyBuZXh0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja0xWYWwoZXhwcikge1xuICAgIGlmIChleHByLnR5cGUgPT09IFwiSWRlbnRpZmllclwiIHx8IGV4cHIudHlwZSA9PT0gXCJNZW1iZXJFeHByZXNzaW9uXCIpIHJldHVybiBleHByO1xuICAgIHJldHVybiBkdW1teUlkZW50KCk7XG4gIH1cblxuICAvLyBHZXQgYXJncyBmb3IgYSBuZXcgdHVwbGUgZXhwcmVzc2lvblxuXG4gIGZ1bmN0aW9uIGdldFR1cGxlQXJncyhleHByKSB7XG4gICAgaWYgKGV4cHIuY2FsbGVlICYmIGV4cHIuY2FsbGVlLm9iamVjdCAmJiBleHByLmNhbGxlZS5vYmplY3Qub2JqZWN0ICYmXG4gICAgICBleHByLmNhbGxlZS5vYmplY3Qub2JqZWN0Lm5hbWUgPT09IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSAmJlxuICAgICAgZXhwci5jYWxsZWUucHJvcGVydHkgJiYgZXhwci5jYWxsZWUucHJvcGVydHkubmFtZSA9PT0gXCJ0dXBsZVwiKVxuICAgICAgcmV0dXJuIGV4cHIuYXJndW1lbnRzO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8gVW5wYWNrIGFuIGx2YWx1ZSB0dXBsZSBpbnRvIGluZGl2dWFsIHZhcmlhYmxlIGFzc2lnbm1lbnRzXG4gIC8vICdhcmcwLCBhcmcxID0gcmlnaHQnIGJlY29tZXM6XG4gIC8vIHZhciB0bXAgPSByaWdodFxuICAvLyBhcmcwID0gdG1wWzBdXG4gIC8vIGFyZzEgPSB0bXBbMV1cbiAgLy8gLi4uXG5cbiAgZnVuY3Rpb24gdW5wYWNrVHVwbGUodHVwbGVBcmdzLCByaWdodCkge1xuICAgIHZhciB2YXJTdG10cyA9IFtdO1xuXG4gICAgLy8gdmFyIHRtcCA9IHJpZ2h0XG5cbiAgICB2YXIgdG1wSWQgPSBuYy5jcmVhdGVOb2RlU3BhbihyaWdodCwgcmlnaHQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiX19maWxiZXJ0VG1wXCIgKyBuZXdBc3RJZENvdW50KysgfSk7XG4gICAgdmFyIHRtcERlY2wgPSBuYy5jcmVhdGVWYXJEZWNsRnJvbUlkKHJpZ2h0LCB0bXBJZCwgcmlnaHQpO1xuICAgIHZhclN0bXRzLnB1c2godG1wRGVjbCk7XG5cbiAgICAvLyBhcmdOID0gdG1wW05dXG5cbiAgICBpZiAodHVwbGVBcmdzICYmIHR1cGxlQXJncy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR1cGxlQXJncy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgbHZhbCA9IHR1cGxlQXJnc1tpXTtcbiAgICAgICAgdmFyIHN1YlR1cGxlQXJncyA9IGdldFR1cGxlQXJncyhsdmFsKTtcbiAgICAgICAgaWYgKHN1YlR1cGxlQXJncykge1xuICAgICAgICAgIHZhciBzdWJMaXQgPSBuYy5jcmVhdGVOb2RlU3BhbihyaWdodCwgcmlnaHQsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBpIH0pO1xuICAgICAgICAgIHZhciBzdWJSaWdodCA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJpZ2h0LCByaWdodCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiB0bXBJZCwgcHJvcGVydHk6IHN1YkxpdCwgY29tcHV0ZWQ6IHRydWUgfSk7XG4gICAgICAgICAgdmFyIHN1YlN0bXRzID0gdW5wYWNrVHVwbGUoc3ViVHVwbGVBcmdzLCBzdWJSaWdodCk7XG4gICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzdWJTdG10cy5sZW5ndGg7IGorKykgdmFyU3RtdHMucHVzaChzdWJTdG10c1tqXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hlY2tMVmFsKGx2YWwpO1xuICAgICAgICAgIHZhciBpbmRleElkID0gbmMuY3JlYXRlTm9kZVNwYW4ocmlnaHQsIHJpZ2h0LCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogaSB9KTtcbiAgICAgICAgICB2YXIgaW5pdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJpZ2h0LCByaWdodCwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiB0bXBJZCwgcHJvcGVydHk6IGluZGV4SWQsIGNvbXB1dGVkOiB0cnVlIH0pO1xuICAgICAgICAgIGlmIChsdmFsLnR5cGUgPT09IFwiSWRlbnRpZmllclwiICYmICFzY29wZS5leGlzdHMobHZhbC5uYW1lKSkge1xuICAgICAgICAgICAgc2NvcGUuYWRkVmFyKGx2YWwubmFtZSk7XG4gICAgICAgICAgICB2YXIgdmFyRGVjbCA9IG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQobHZhbCwgbHZhbCwgaW5pdCk7XG4gICAgICAgICAgICB2YXJTdG10cy5wdXNoKHZhckRlY2wpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBub2RlID0gc3RhcnROb2RlRnJvbShsdmFsKTtcbiAgICAgICAgICAgIG5vZGUubGVmdCA9IGx2YWw7XG4gICAgICAgICAgICBub2RlLm9wZXJhdG9yID0gXCI9XCI7XG4gICAgICAgICAgICBub2RlLnJpZ2h0ID0gaW5pdDtcbiAgICAgICAgICAgIGZpbmlzaE5vZGUobm9kZSwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiKTtcbiAgICAgICAgICAgIHZhclN0bXRzLnB1c2gobmMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHsgZXhwcmVzc2lvbjogbm9kZSB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhclN0bXRzO1xuICB9XG5cbiAgLy8gIyMjIFN0YXRlbWVudCBwYXJzaW5nXG5cbiAgZnVuY3Rpb24gcGFyc2VUb3BMZXZlbCgpIHtcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgIG5vZGUuYm9keSA9IFtdO1xuICAgIHdoaWxlICh0b2tlbi50eXBlICE9PSB0dC5lb2YpIHtcbiAgICAgIHZhciBzdG10ID0gcGFyc2VTdGF0ZW1lbnQoKTtcbiAgICAgIGlmIChzdG10KSBub2RlLmJvZHkucHVzaChzdG10KTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJQcm9ncmFtXCIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VTdGF0ZW1lbnQoKSB7XG4gICAgdmFyIHN0YXJ0dHlwZSA9IHRva2VuLnR5cGUsIG5vZGUgPSBzdGFydE5vZGUoKTtcblxuICAgIHN3aXRjaCAoc3RhcnR0eXBlKSB7XG5cbiAgICBjYXNlIHR0Ll9icmVhazpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiQnJlYWtTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIHR0Ll9jb250aW51ZTpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiQ29udGludWVTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIHR0Ll9jbGFzczpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZUNsYXNzKG5vZGUpO1xuXG4gICAgY2FzZSB0dC5fZGVmOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlRnVuY3Rpb24obm9kZSk7XG5cbiAgICBjYXNlIHR0Ll9mb3I6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gcGFyc2VGb3Iobm9kZSk7XG5cbiAgICBjYXNlIHR0Ll9mcm9tOiAvLyBTa2lwcGluZyBmcm9tIGFuZCBpbXBvcnQgc3RhdGVtZW50cyBmb3Igbm93XG4gICAgICBza2lwTGluZSgpO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlU3RhdGVtZW50KCk7XG5cbiAgICBjYXNlIHR0Ll9pZjogY2FzZSB0dC5fZWxpZjpcbiAgICAgIG5leHQoKTtcbiAgICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5wYXJlbkwpIG5vZGUudGVzdCA9IHBhcnNlUGFyZW5FeHByZXNzaW9uKCk7XG4gICAgICBlbHNlIG5vZGUudGVzdCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgZXhwZWN0KHR0LmNvbG9uKTtcbiAgICAgIG5vZGUuY29uc2VxdWVudCA9IHBhcnNlU3VpdGUoKTtcbiAgICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5fZWxpZilcbiAgICAgICAgbm9kZS5hbHRlcm5hdGUgPSBwYXJzZVN0YXRlbWVudCgpO1xuICAgICAgZWxzZVxuICAgICAgICBub2RlLmFsdGVybmF0ZSA9IGVhdCh0dC5fZWxzZSkgJiYgZWF0KHR0LmNvbG9uKSA/IHBhcnNlU3VpdGUoKSA6IG51bGw7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIklmU3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSB0dC5faW1wb3J0OiAvLyBTa2lwcGluZyBmcm9tIGFuZCBpbXBvcnQgc3RhdGVtZW50cyBmb3Igbm93XG4gICAgICBza2lwTGluZSgpO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIHBhcnNlU3RhdGVtZW50KCk7XG5cbiAgICBjYXNlIHR0Lm5ld2xpbmU6XG4gICAgICAvLyBUT0RPOiBwYXJzZVN0YXRlbWVudCgpIHNob3VsZCBwcm9iYWJseSBlYXQgaXQncyBvd24gbmV3bGluZVxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICBjYXNlIHR0Ll9wYXNzOlxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJFbXB0eVN0YXRlbWVudFwiKTtcblxuICAgIGNhc2UgdHQuX3JldHVybjpcbiAgICAgIG5leHQoKTtcbiAgICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5uZXdsaW5lIHx8IHRva2VuLnR5cGUgPT09IHR0LmVvZikgbm9kZS5hcmd1bWVudCA9IG51bGw7XG4gICAgICBlbHNlIHsgbm9kZS5hcmd1bWVudCA9IHBhcnNlRXhwcmVzc2lvbigpOyB9XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIlJldHVyblN0YXRlbWVudFwiKTsgXG5cbiAgICBjYXNlIHR0Ll93aGlsZTpcbiAgICAgIG5leHQoKTtcbiAgICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5wYXJlbkwpIG5vZGUudGVzdCA9IHBhcnNlUGFyZW5FeHByZXNzaW9uKCk7XG4gICAgICBlbHNlIG5vZGUudGVzdCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgZXhwZWN0KHR0LmNvbG9uKTtcbiAgICAgIG5vZGUuYm9keSA9IHBhcnNlU3VpdGUoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiV2hpbGVTdGF0ZW1lbnRcIik7XG5cbiAgICBjYXNlIHR0LnNlbWk6XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkVtcHR5U3RhdGVtZW50XCIpO1xuXG4gICAgY2FzZSB0dC5pbmRlbnQ6XG4gICAgICAvLyBVbmV4cGVjdGVkIGluZGVudCwgbGV0J3MgaWdub3JlIGl0XG4gICAgICBpbmRlbnRIaXN0LnVuZG9JbmRlbnQoKTtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZVN0YXRlbWVudCgpO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHZhciBleHByID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBpZiAoaXNEdW1teShleHByKSkge1xuICAgICAgICBuZXh0KCk7XG4gICAgICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5lb2YpIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiRW1wdHlTdGF0ZW1lbnRcIik7XG4gICAgICAgIHJldHVybiBwYXJzZVN0YXRlbWVudCgpO1xuICAgICAgfSBlbHNlIGlmIChleHByLnR5cGUgPT09IFwiVmFyaWFibGVEZWNsYXJhdGlvblwiIHx8IGV4cHIudHlwZSA9PT0gXCJCbG9ja1N0YXRlbWVudFwiKSB7XG4gICAgICAgIHJldHVybiBleHByO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbm9kZS5leHByZXNzaW9uID0gZXhwcjtcbiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlU3VpdGUoKSB7XG4gICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICBub2RlLmJvZHkgPSBbXTtcbiAgICBpZiAoZWF0KHR0Lm5ld2xpbmUpKSB7XG4gICAgICBlYXQodHQuaW5kZW50KTtcbiAgICAgIHdoaWxlICghZWF0KHR0LmRlZGVudCkgJiYgdG9rZW4udHlwZSAhPT0gdHQuZW9mKSB7XG4gICAgICAgIHZhciBzdG10ID0gcGFyc2VTdGF0ZW1lbnQoKTtcbiAgICAgICAgaWYgKHN0bXQpIG5vZGUuYm9keS5wdXNoKHN0bXQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBub2RlLmJvZHkucHVzaChwYXJzZVN0YXRlbWVudCgpKTtcbiAgICAgIG5leHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJCbG9ja1N0YXRlbWVudFwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlRm9yKG5vZGUpIHtcbiAgICB2YXIgaW5pdCA9IHBhcnNlRXhwcmVzc2lvbihmYWxzZSwgdHJ1ZSk7XG4gICAgdmFyIHR1cGxlQXJncyA9IGdldFR1cGxlQXJncyhpbml0KTtcbiAgICBpZiAoIXR1cGxlQXJncykgY2hlY2tMVmFsKGluaXQpO1xuICAgIGV4cGVjdCh0dC5faW4pO1xuICAgIHZhciByaWdodCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgIGV4cGVjdCh0dC5jb2xvbik7XG4gICAgdmFyIGJvZHkgPSBwYXJzZVN1aXRlKCk7XG4gICAgZmluaXNoTm9kZShub2RlLCBcIkJsb2NrU3RhdGVtZW50XCIpO1xuICAgIHJldHVybiBuYy5jcmVhdGVGb3Iobm9kZSwgaW5pdCwgdHVwbGVBcmdzLCByaWdodCwgYm9keSk7XG4gIH1cblxuICAvLyAjIyMgRXhwcmVzc2lvbiBwYXJzaW5nXG5cbiAgZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uKG5vQ29tbWEsIG5vSW4pIHtcbiAgICByZXR1cm4gcGFyc2VNYXliZUFzc2lnbihub0luKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlUGFyZW5FeHByZXNzaW9uKCkge1xuICAgIGV4cGVjdCh0dC5wYXJlbkwpO1xuICAgIHZhciB2YWwgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICBleHBlY3QodHQucGFyZW5SKTtcbiAgICByZXR1cm4gdmFsO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VNYXliZUFzc2lnbihub0luKSB7XG4gICAgdmFyIGxlZnQgPSBwYXJzZU1heWJlVHVwbGUobm9Jbik7XG4gICAgaWYgKHRva2VuLnR5cGUuaXNBc3NpZ24pIHtcbiAgICAgIHZhciB0dXBsZUFyZ3MgPSBnZXRUdXBsZUFyZ3MobGVmdCk7XG4gICAgICBpZiAodHVwbGVBcmdzKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgICAgdmFyIHJpZ2h0ID0gcGFyc2VNYXliZVR1cGxlKG5vSW4pO1xuICAgICAgICB2YXIgYmxvY2tOb2RlID0gc3RhcnROb2RlRnJvbShsZWZ0KTtcbiAgICAgICAgYmxvY2tOb2RlLmJvZHkgPSB1bnBhY2tUdXBsZSh0dXBsZUFyZ3MsIHJpZ2h0KTtcbiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUoYmxvY2tOb2RlLCBcIkJsb2NrU3RhdGVtZW50XCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoc2NvcGUuaXNDbGFzcygpKSB7XG4gICAgICAgIHZhciB0aGlzRXhwciA9IG5jLmNyZWF0ZU5vZGVGcm9tKGxlZnQsIFwiVGhpc0V4cHJlc3Npb25cIik7XG4gICAgICAgIGxlZnQgPSBuYy5jcmVhdGVOb2RlRnJvbShsZWZ0LCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHRoaXNFeHByLCBwcm9wZXJ0eTogbGVmdCB9KTtcbiAgICAgIH1cblxuICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGVGcm9tKGxlZnQpO1xuICAgICAgbm9kZS5vcGVyYXRvciA9IHRva2VuLnZhbHVlO1xuICAgICAgbm9kZS5sZWZ0ID0gY2hlY2tMVmFsKGxlZnQpO1xuICAgICAgbmV4dCgpO1xuICAgICAgbm9kZS5yaWdodCA9IHBhcnNlTWF5YmVUdXBsZShub0luKTtcblxuICAgICAgaWYgKG5vZGUub3BlcmF0b3IgPT09ICcrPScgfHwgbm9kZS5vcGVyYXRvciA9PT0gJyo9Jykge1xuICAgICAgICB2YXIgcmlnaHQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLnJpZ2h0LCBub2RlLnJpZ2h0LCBcIkNhbGxFeHByZXNzaW9uXCIpO1xuICAgICAgICByaWdodC5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlT3BzQ2FsbGVlKHJpZ2h0LCBub2RlLm9wZXJhdG9yID09PSAnKz0nID8gXCJhZGRcIiA6IFwibXVsdGlwbHlcIik7XG4gICAgICAgIHJpZ2h0LmFyZ3VtZW50cyA9IFtsZWZ0LCBub2RlLnJpZ2h0XTtcbiAgICAgICAgbm9kZS5yaWdodCA9IHJpZ2h0O1xuICAgICAgICBub2RlLm9wZXJhdG9yID0gJz0nO1xuICAgICAgfVxuXG4gICAgICBpZiAobGVmdC50eXBlID09PSBcIklkZW50aWZpZXJcIiAmJiAhc2NvcGUuZXhpc3RzKGxlZnQubmFtZSkpIHtcbiAgICAgICAgc2NvcGUuYWRkVmFyKGxlZnQubmFtZSk7XG4gICAgICAgIHJldHVybiBuYy5jcmVhdGVWYXJEZWNsRnJvbUlkKG5vZGUubGVmdCwgbm9kZS5sZWZ0LCBub2RlLnJpZ2h0KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGxlZnQ7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZU1heWJlVHVwbGUobm9Jbikge1xuICAgIHZhciBleHByID0gcGFyc2VFeHByT3BzKG5vSW4pO1xuICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5jb21tYSkge1xuICAgICAgcmV0dXJuIHBhcnNlVHVwbGUobm9JbiwgZXhwcik7XG4gICAgfVxuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VFeHByT3BzKG5vSW4pIHtcbiAgICByZXR1cm4gcGFyc2VFeHByT3AocGFyc2VNYXliZVVuYXJ5KG5vSW4pLCAtMSwgbm9Jbik7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUV4cHJPcChsZWZ0LCBtaW5QcmVjLCBub0luKSB7XG4gICAgdmFyIG5vZGUsIGV4cHJOb2RlLCByaWdodCwgb3AgPSB0b2tlbi50eXBlLCB2YWwgPSB0b2tlbi52YWx1ZTtcbiAgICB2YXIgcHJlYyA9IG9wID09PSB0dC5fbm90ID8gdHQuX2luLnByZWMgOiBvcC5wcmVjO1xuICAgIGlmIChvcCA9PT0gdHQuZXhwb25lbnRpYXRpb24gJiYgcHJlYyA+PSBtaW5QcmVjKSB7XG4gICAgICBub2RlID0gc3RhcnROb2RlRnJvbShsZWZ0KTtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJpZ2h0ID0gcGFyc2VFeHByT3AocGFyc2VNYXliZVVuYXJ5KG5vSW4pLCBwcmVjLCBub0luKTtcbiAgICAgIGV4cHJOb2RlID0gbmMuY3JlYXRlTm9kZU1lbWJlckNhbGwobm9kZSwgXCJNYXRoXCIsIFwicG93XCIsIFtsZWZ0LCByaWdodF0pO1xuICAgICAgcmV0dXJuIHBhcnNlRXhwck9wKGV4cHJOb2RlLCBtaW5QcmVjLCBub0luKTtcbiAgICB9IGVsc2UgaWYgKHByZWMgIT0gbnVsbCAmJiAoIW5vSW4gfHwgb3AgIT09IHR0Ll9pbikpIHtcbiAgICAgIGlmIChwcmVjID4gbWluUHJlYykge1xuICAgICAgICBuZXh0KCk7XG4gICAgICAgIG5vZGUgPSBzdGFydE5vZGVGcm9tKGxlZnQpO1xuICAgICAgICBpZiAob3AgPT09IHR0LmZsb29yRGl2KSB7XG4gICAgICAgICAgcmlnaHQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgICAgIGZpbmlzaE5vZGUobm9kZSk7XG4gICAgICAgICAgdmFyIGJpbkV4cHIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkJpbmFyeUV4cHJlc3Npb25cIiwgeyBsZWZ0OiBsZWZ0LCBvcGVyYXRvcjogJy8nLCByaWdodDogcmlnaHQgfSk7XG4gICAgICAgICAgZXhwck5vZGUgPSBuYy5jcmVhdGVOb2RlTWVtYmVyQ2FsbChub2RlLCBcIk1hdGhcIiwgXCJmbG9vclwiLCBbYmluRXhwcl0pO1xuICAgICAgICB9IGVsc2UgaWYgKG9wID09PSB0dC5faW4gfHwgb3AgPT09IHR0Ll9ub3QpIHtcbiAgICAgICAgICBpZiAob3AgPT09IHR0Ll9pbiB8fCBlYXQodHQuX2luKSkge1xuICAgICAgICAgICAgcmlnaHQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgICAgICAgZmluaXNoTm9kZShub2RlKTtcbiAgICAgICAgICAgIHZhciBub3RMaXQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkxpdGVyYWxcIiwgeyB2YWx1ZTogb3AgPT09IHR0Ll9ub3QgfSk7XG4gICAgICAgICAgICBleHByTm9kZSA9IG5jLmNyZWF0ZU5vZGVSdW50aW1lQ2FsbChub2RlLCAnb3BzJywgJ2luJywgW2xlZnQsIHJpZ2h0LCBub3RMaXRdKTtcbiAgICAgICAgICB9IGVsc2UgZXhwck5vZGUgPSBkdW1teUlkZW50KCk7XG4gICAgICAgIH0gZWxzZSBpZiAob3AgPT09IHR0LnBsdXNNaW4gJiYgdmFsID09PSAnKycgfHwgb3AgPT09IHR0Lm11bHRpcGx5TW9kdWxvICYmIHZhbCA9PT0gJyonKSB7XG4gICAgICAgICAgbm9kZS5hcmd1bWVudHMgPSBbbGVmdF07XG4gICAgICAgICAgbm9kZS5hcmd1bWVudHMucHVzaChwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pKTtcbiAgICAgICAgICBmaW5pc2hOb2RlKG5vZGUsIFwiQ2FsbEV4cHJlc3Npb25cIik7XG4gICAgICAgICAgbm9kZS5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlT3BzQ2FsbGVlKG5vZGUsIG9wID09PSB0dC5wbHVzTWluID8gXCJhZGRcIiA6IFwibXVsdGlwbHlcIik7XG4gICAgICAgICAgZXhwck5vZGUgPSBub2RlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChvcCA9PT0gdHQuX2lzKSB7XG4gICAgICAgICAgICBpZiAoZWF0KHR0Ll9ub3QpKSBub2RlLm9wZXJhdG9yID0gXCIhPT1cIjtcbiAgICAgICAgICAgIGVsc2Ugbm9kZS5vcGVyYXRvciA9IFwiPT09XCI7XG4gICAgICAgICAgfSBlbHNlIG5vZGUub3BlcmF0b3IgPSBvcC5yZXAgIT0gbnVsbCA/IG9wLnJlcCA6IHZhbDtcblxuICAgICAgICAgIC8vIEFjY2VwdCAnPT09JyBhcyAnPT0nXG4gICAgICAgICAgaWYgKGlucHV0W3Rva2VuLnN0YXJ0IC0gMV0gPT09ICc9JyAmJiBpbnB1dFt0b2tlbi5zdGFydCAtIDJdID09PSAnPScpIG5leHQoKTtcblxuICAgICAgICAgIG5vZGUubGVmdCA9IGxlZnQ7XG4gICAgICAgICAgbm9kZS5yaWdodCA9IHBhcnNlRXhwck9wKHBhcnNlTWF5YmVVbmFyeShub0luKSwgcHJlYywgbm9Jbik7XG4gICAgICAgICAgZXhwck5vZGUgPSBmaW5pc2hOb2RlKG5vZGUsIChvcCA9PT0gdHQuX29yIHx8IG9wID09PSB0dC5fYW5kKSA/IFwiTG9naWNhbEV4cHJlc3Npb25cIiA6IFwiQmluYXJ5RXhwcmVzc2lvblwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyc2VFeHByT3AoZXhwck5vZGUsIG1pblByZWMsIG5vSW4pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbGVmdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlTWF5YmVVbmFyeShub0luKSB7XG4gICAgaWYgKHRva2VuLnR5cGUucHJlZml4IHx8IHRva2VuLnR5cGUgPT09IHR0LnBsdXNNaW4pIHtcbiAgICAgIHZhciBwcmVjID0gdG9rZW4udHlwZSA9PT0gdHQucGx1c01pbiA/IHR0LnBvc05lZ05vdC5wcmVjIDogdG9rZW4udHlwZS5wcmVjO1xuICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICAgIG5vZGUub3BlcmF0b3IgPSB0b2tlbi50eXBlLnJlcCAhPSBudWxsID8gdG9rZW4udHlwZS5yZXAgOiB0b2tlbi52YWx1ZTtcbiAgICAgIG5vZGUucHJlZml4ID0gdHJ1ZTtcbiAgICAgIG5leHQoKTtcbiAgICAgIG5vZGUuYXJndW1lbnQgPSBwYXJzZUV4cHJPcChwYXJzZU1heWJlVW5hcnkobm9JbiksIHByZWMsIG5vSW4pO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJVbmFyeUV4cHJlc3Npb25cIik7XG4gICAgfVxuICAgIHJldHVybiBwYXJzZVN1YnNjcmlwdHMocGFyc2VFeHByQXRvbSgpLCBmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVN1YnNjcmlwdHMoYmFzZSwgbm9DYWxscykge1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlRnJvbShiYXNlKTtcbiAgICBpZiAoZWF0KHR0LmRvdCkpIHtcbiAgICAgIHZhciBpZCA9IHBhcnNlSWRlbnQodHJ1ZSk7XG4gICAgICBpZiAoZmlsYmVydC5weXRob25SdW50aW1lLmltcG9ydHNbYmFzZS5uYW1lXSAmJiBmaWxiZXJ0LnB5dGhvblJ1bnRpbWUuaW1wb3J0c1tiYXNlLm5hbWVdW2lkLm5hbWVdKSB7XG4gICAgICAgIC8vIENhbGxpbmcgYSBQeXRob24gaW1wb3J0IGZ1bmN0aW9uXG4gICAgICAgIHZhciBydW50aW1lSWQgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgfSk7XG4gICAgICAgIHZhciBpbXBvcnRzSWQgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcImltcG9ydHNcIiB9KTtcbiAgICAgICAgdmFyIHJ1bnRpbWVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVJZCwgcHJvcGVydHk6IGltcG9ydHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICBub2RlLm9iamVjdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZU1lbWJlciwgcHJvcGVydHk6IGJhc2UsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgIH0gZWxzZSBpZiAoYmFzZS5uYW1lICYmIGJhc2UubmFtZSA9PT0gc2NvcGUuZ2V0VGhpc1JlcGxhY2UoKSkge1xuICAgICAgICBub2RlLm9iamVjdCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiVGhpc0V4cHJlc3Npb25cIik7XG4gICAgICB9IGVsc2Ugbm9kZS5vYmplY3QgPSBiYXNlO1xuICAgICAgbm9kZS5wcm9wZXJ0eSA9IGlkO1xuICAgICAgbm9kZS5jb21wdXRlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHBhcnNlU3Vic2NyaXB0cyhmaW5pc2hOb2RlKG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiKSwgbm9DYWxscyk7XG4gICAgfSBlbHNlIGlmIChlYXQodHQuYnJhY2tldEwpKSB7XG4gICAgICB2YXIgZXhwciwgaXNTbGljZSA9IGZhbHNlO1xuICAgICAgaWYgKGVhdCh0dC5jb2xvbikpIGlzU2xpY2UgPSB0cnVlO1xuICAgICAgZWxzZSBleHByID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICBpZiAoIWlzU2xpY2UgJiYgZWF0KHR0LmNvbG9uKSkgaXNTbGljZSA9IHRydWU7XG4gICAgICBpZiAoaXNTbGljZSkgcmV0dXJuIHBhcnNlU2xpY2Uobm9kZSwgYmFzZSwgZXhwciwgbm9DYWxscyk7XG4gICAgICB2YXIgc3Vic2NyaXB0Q2FsbCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGV4cHIsIGV4cHIsIFwiQ2FsbEV4cHJlc3Npb25cIik7XG4gICAgICBzdWJzY3JpcHRDYWxsLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVPcHNDYWxsZWUoZXhwciwgXCJzdWJzY3JpcHRJbmRleFwiKTtcbiAgICAgIHN1YnNjcmlwdENhbGwuYXJndW1lbnRzID0gW2Jhc2UsIGV4cHJdO1xuICAgICAgbm9kZS5vYmplY3QgPSBiYXNlO1xuICAgICAgbm9kZS5wcm9wZXJ0eSA9IHN1YnNjcmlwdENhbGw7XG4gICAgICBub2RlLmNvbXB1dGVkID0gdHJ1ZTtcbiAgICAgIGV4cGVjdCh0dC5icmFja2V0Uik7XG4gICAgICByZXR1cm4gcGFyc2VTdWJzY3JpcHRzKGZpbmlzaE5vZGUobm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIpLCBub0NhbGxzKTtcbiAgICB9IGVsc2UgaWYgKCFub0NhbGxzICYmIGVhdCh0dC5wYXJlbkwpKSB7XG4gICAgICBpZiAoc2NvcGUuaXNVc2VyRnVuY3Rpb24oYmFzZS5uYW1lKSkge1xuICAgICAgICAvLyBVbnBhY2sgcGFyYW1ldGVycyBpbnRvIEphdmFTY3JpcHQtZnJpZW5kbHkgcGFyYW1ldGVycywgZnVydGhlciBwcm9jZXNzZWQgYXQgcnVudGltZVxuICAgICAgICB2YXIgY3JlYXRlUGFyYW1zQ2FsbCA9IG5jLmNyZWF0ZU5vZGVSdW50aW1lQ2FsbChub2RlLCAndXRpbHMnLCAnY3JlYXRlUGFyYW1zT2JqJywgcGFyc2VQYXJhbXNMaXN0KCkpO1xuICAgICAgICBub2RlLmFyZ3VtZW50cyA9IFtjcmVhdGVQYXJhbXNDYWxsXTtcbiAgICAgIH0gZWxzZSBub2RlLmFyZ3VtZW50cyA9IHBhcnNlRXhwckxpc3QodHQucGFyZW5SLCBmYWxzZSk7XG4gICAgICBcbiAgICAgIGlmIChzY29wZS5pc05ld09iaihiYXNlLm5hbWUpKSBmaW5pc2hOb2RlKG5vZGUsIFwiTmV3RXhwcmVzc2lvblwiKTtcbiAgICAgIGVsc2UgZmluaXNoTm9kZShub2RlLCBcIkNhbGxFeHByZXNzaW9uXCIpO1xuICAgICAgaWYgKGZpbGJlcnQucHl0aG9uUnVudGltZS5mdW5jdGlvbnNbYmFzZS5uYW1lXSkge1xuICAgICAgICAvLyBDYWxsaW5nIGEgUHl0aG9uIGJ1aWx0LWluIGZ1bmN0aW9uXG4gICAgICAgIHZhciBydW50aW1lSWQgPSBuYy5jcmVhdGVOb2RlU3BhbihiYXNlLCBiYXNlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgfSk7XG4gICAgICAgIHZhciBmdW5jdGlvbnNJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwiZnVuY3Rpb25zXCIgfSk7XG4gICAgICAgIHZhciBydW50aW1lTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lSWQsIHByb3BlcnR5OiBmdW5jdGlvbnNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJhc2UsIGJhc2UsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZU1lbWJlciwgcHJvcGVydHk6IGJhc2UsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgIH0gZWxzZSBub2RlLmNhbGxlZSA9IGJhc2U7XG4gICAgICByZXR1cm4gcGFyc2VTdWJzY3JpcHRzKG5vZGUsIG5vQ2FsbHMpO1xuICAgIH1cbiAgICByZXR1cm4gYmFzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlU2xpY2Uobm9kZSwgYmFzZSwgc3RhcnQsIG5vQ2FsbHMpIHtcbiAgICB2YXIgZW5kLCBzdGVwO1xuICAgIGlmICghc3RhcnQpIHN0YXJ0ID0gbmMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IG51bGwgfSk7XG4gICAgaWYgKHRva2VuLnR5cGUgPT09IHR0LmJyYWNrZXRSIHx8IGVhdCh0dC5jb2xvbikpIHtcbiAgICAgIGVuZCA9IG5jLmNyZWF0ZU5vZGVGcm9tKG5vZGUsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiBudWxsIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbmQgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIGlmICh0b2tlbi50eXBlICE9PSB0dC5icmFja2V0UikgZXhwZWN0KHR0LmNvbG9uKTtcbiAgICB9XG4gICAgaWYgKHRva2VuLnR5cGUgPT09IHR0LmJyYWNrZXRSKSBzdGVwID0gbmMuY3JlYXRlTm9kZUZyb20obm9kZSwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IG51bGwgfSk7XG4gICAgZWxzZSBzdGVwID0gcGFyc2VFeHByZXNzaW9uKCk7XG4gICAgZXhwZWN0KHR0LmJyYWNrZXRSKTtcblxuICAgIG5vZGUuYXJndW1lbnRzID0gW3N0YXJ0LCBlbmQsIHN0ZXBdO1xuICAgIHZhciBzbGljZUlkID0gbmMuY3JlYXRlTm9kZUZyb20oYmFzZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfcHlTbGljZVwiIH0pO1xuICAgIHZhciBtZW1iZXJFeHByID0gbmMuY3JlYXRlTm9kZVNwYW4oYmFzZSwgYmFzZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBiYXNlLCBwcm9wZXJ0eTogc2xpY2VJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIG5vZGUuY2FsbGVlID0gbWVtYmVyRXhwcjtcbiAgICByZXR1cm4gcGFyc2VTdWJzY3JpcHRzKGZpbmlzaE5vZGUobm9kZSwgXCJDYWxsRXhwcmVzc2lvblwiKSwgbm9DYWxscyk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUV4cHJBdG9tKCkge1xuICAgIHN3aXRjaCAodG9rZW4udHlwZSkge1xuXG4gICAgY2FzZSB0dC5fZGljdDpcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBwYXJzZURpY3QodHQucGFyZW5SKTtcblxuICAgIGNhc2UgdHQubmFtZTpcbiAgICAgIHJldHVybiBwYXJzZUlkZW50KCk7XG5cbiAgICBjYXNlIHR0Lm51bTogY2FzZSB0dC5zdHJpbmc6IGNhc2UgdHQucmVnZXhwOlxuICAgICAgdmFyIG5vZGUgPSBzdGFydE5vZGUoKTtcbiAgICAgIG5vZGUudmFsdWUgPSB0b2tlbi52YWx1ZTtcbiAgICAgIG5vZGUucmF3ID0gaW5wdXQuc2xpY2UodG9rZW4uc3RhcnQsIHRva2VuLmVuZCk7XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIkxpdGVyYWxcIik7XG5cbiAgICBjYXNlIHR0Ll9Ob25lOiBjYXNlIHR0Ll9UcnVlOiBjYXNlIHR0Ll9GYWxzZTpcbiAgICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgICBub2RlLnZhbHVlID0gdG9rZW4udHlwZS5hdG9tVmFsdWU7XG4gICAgICBub2RlLnJhdyA9IHRva2VuLnR5cGUua2V5d29yZDtcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBmaW5pc2hOb2RlKG5vZGUsIFwiTGl0ZXJhbFwiKTtcblxuICAgIGNhc2UgdHQucGFyZW5MOlxuICAgICAgdmFyIHRva1N0YXJ0TG9jMSA9IHRva2VuLnN0YXJ0TG9jLCB0b2tTdGFydDEgPSB0b2tlbi5zdGFydDtcbiAgICAgIG5leHQoKTtcbiAgICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5wYXJlblIpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBwYXJzZVR1cGxlKHRydWUpO1xuICAgICAgICBlYXQodHQucGFyZW5SKTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICB9XG4gICAgICB2YXIgdmFsID0gcGFyc2VNYXliZVR1cGxlKHRydWUpO1xuICAgICAgaWYgKG9wdGlvbnMubG9jYXRpb25zKSB7XG4gICAgICAgIHZhbC5sb2Muc3RhcnQgPSB0b2tTdGFydExvYzE7XG4gICAgICAgIHZhbC5sb2MuZW5kID0gdG9rZW4uZW5kTG9jO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMucmFuZ2VzKVxuICAgICAgICB2YWwucmFuZ2UgPSBbdG9rU3RhcnQxLCB0b2tlbi5lbmRdO1xuICAgICAgZXhwZWN0KHR0LnBhcmVuUik7XG4gICAgICByZXR1cm4gdmFsO1xuXG4gICAgY2FzZSB0dC5icmFja2V0TDpcbiAgICAgIHJldHVybiBwYXJzZUxpc3QoKTtcblxuICAgIGNhc2UgdHQuYnJhY2VMOlxuICAgICAgcmV0dXJuIHBhcnNlRGljdCh0dC5icmFjZVIpO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBkdW1teUlkZW50KCk7XG4gICAgfVxuICB9XG5cbiAgLy8gUGFyc2UgbGlzdFxuXG4gIC8vIEN1c3RvbSBsaXN0IG9iamVjdCBpcyB1c2VkIHRvIHNpbXVsYXRlIG5hdGl2ZSBQeXRob24gbGlzdFxuICAvLyBFLmcuIFB5dGhvbiAnW10nIGJlY29tZXMgSmF2YVNjcmlwdCAnbmV3IF9fcHl0aG9uUnVudGltZS5vYmplY3RzLmxpc3QoKTsnXG4gIC8vIElmIGxpc3QgY29tcHJlaGVuc2lvbiwgYnVpbGQgc29tZXRoaW5nIGxpa2UgdGhpczpcbiAgLy8oZnVuY3Rpb24oKSB7XG4gIC8vICB2YXIgX2xpc3QgPSBbXTtcbiAgLy8gIC4uLlxuICAvLyAgX2xpc3QucHVzaChleHByKTtcbiAgLy8gIHJldHVybiBfbGlzdDtcbiAgLy99KCkpO1xuXG4gIGZ1bmN0aW9uIHBhcnNlTGlzdCgpIHtcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpO1xuICAgIG5vZGUuYXJndW1lbnRzID0gW107XG4gICAgbmV4dCgpO1xuXG4gICAgaWYgKCFlYXQodHQuYnJhY2tldFIpKSB7XG4gICAgICB2YXIgZXhwciA9IHBhcnNlRXhwck9wcyhmYWxzZSk7XG4gICAgICBpZiAodG9rZW4udHlwZSA9PT0gdHQuX2ZvciB8fCB0b2tlbi50eXBlID09PSB0dC5faWYpIHtcblxuICAgICAgICAvLyBMaXN0IGNvbXByZWhlbnNpb25cbiAgICAgICAgdmFyIHRtcFZhclN1ZmZpeCA9IG5ld0FzdElkQ291bnQrKztcbiAgICAgICAgZXhwciA9IG5jLmNyZWF0ZUxpc3RDb21wUHVzaChleHByLCB0bXBWYXJTdWZmaXgpO1xuICAgICAgICB2YXIgYm9keSA9IHBhcnNlQ29tcEl0ZXIoZXhwciwgdHJ1ZSk7XG4gICAgICAgIGZpbmlzaE5vZGUobm9kZSk7XG4gICAgICAgIHJldHVybiBuYy5jcmVhdGVMaXN0Q29tcElpZmUobm9kZSwgYm9keSwgdG1wVmFyU3VmZml4KTtcblxuICAgICAgfSBlbHNlIGlmIChlYXQodHQuY29tbWEpKSB7XG4gICAgICAgIG5vZGUuYXJndW1lbnRzID0gW2V4cHJdLmNvbmNhdChwYXJzZUV4cHJMaXN0KHR0LmJyYWNrZXRSLCB0cnVlLCBmYWxzZSkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGV4cGVjdCh0dC5icmFja2V0Uik7XG4gICAgICAgIG5vZGUuYXJndW1lbnRzID0gW2V4cHJdO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZpbmlzaE5vZGUobm9kZSwgXCJOZXdFeHByZXNzaW9uXCIpO1xuICAgIHZhciBydW50aW1lSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBvcHRpb25zLnJ1bnRpbWVQYXJhbU5hbWUgfSk7XG4gICAgdmFyIG9iamVjdHNJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IFwib2JqZWN0c1wiIH0pO1xuICAgIHZhciBydW50aW1lTWVtYmVyID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJNZW1iZXJFeHByZXNzaW9uXCIsIHsgb2JqZWN0OiBydW50aW1lSWQsIHByb3BlcnR5OiBvYmplY3RzSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICB2YXIgbGlzdElkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJsaXN0XCIgfSk7XG4gICAgbm9kZS5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVNZW1iZXIsIHByb3BlcnR5OiBsaXN0SWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIC8vIFBhcnNlIGEgY29tcF9pdGVyIGZyb20gUHl0aG9uIGxhbmd1YWdlIGdyYW1tYXJcbiAgLy8gJ2V4cHInIGlzIHRoZSBib2R5IHRvIGJlIHVzZWQgYWZ0ZXIgdW5yb2xsaW5nIHRoZSBpZnMgYW5kIGZvcnNcblxuICBmdW5jdGlvbiBwYXJzZUNvbXBJdGVyKGV4cHIsIGZpcnN0KSB7XG4gICAgaWYgKGZpcnN0ICYmIHRva2VuLnR5cGUgIT09IHR0Ll9mb3IpIHJldHVybiBkdW1teUlkZW50KCk7XG4gICAgaWYgKGVhdCh0dC5icmFja2V0UikpIHJldHVybiBleHByO1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgaWYgKGVhdCh0dC5fZm9yKSkge1xuICAgICAgdmFyIGluaXQgPSBwYXJzZUV4cHJlc3Npb24oZmFsc2UsIHRydWUpO1xuICAgICAgdmFyIHR1cGxlQXJncyA9IGdldFR1cGxlQXJncyhpbml0KTtcbiAgICAgIGlmICghdHVwbGVBcmdzKSBjaGVja0xWYWwoaW5pdCk7XG4gICAgICBleHBlY3QodHQuX2luKTtcbiAgICAgIHZhciByaWdodCA9IHBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgdmFyIGJvZHkgPSBwYXJzZUNvbXBJdGVyKGV4cHIsIGZhbHNlKTtcbiAgICAgIHZhciBibG9jayA9IG5jLmNyZWF0ZU5vZGVTcGFuKGJvZHksIGJvZHksIFwiQmxvY2tTdGF0ZW1lbnRcIiwgeyBib2R5OiBbYm9keV0gfSk7XG4gICAgICBmaW5pc2hOb2RlKG5vZGUsIFwiQmxvY2tTdGF0ZW1lbnRcIik7XG4gICAgICByZXR1cm4gbmMuY3JlYXRlRm9yKG5vZGUsIGluaXQsIHR1cGxlQXJncywgcmlnaHQsIGJsb2NrKTtcbiAgICB9IGVsc2UgaWYgKGVhdCh0dC5faWYpKSB7XG4gICAgICBpZiAodG9rZW4udHlwZSA9PT0gdHQucGFyZW5MKSBub2RlLnRlc3QgPSBwYXJzZVBhcmVuRXhwcmVzc2lvbigpO1xuICAgICAgZWxzZSBub2RlLnRlc3QgPSBwYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIG5vZGUuY29uc2VxdWVudCA9IHBhcnNlQ29tcEl0ZXIoZXhwciwgZmFsc2UpO1xuICAgICAgcmV0dXJuIGZpbmlzaE5vZGUobm9kZSwgXCJJZlN0YXRlbWVudFwiKTtcbiAgICB9IGVsc2UgcmV0dXJuIGR1bW15SWRlbnQoKTtcbiAgfVxuXG4gIC8vIFBhcnNlIGNsYXNzXG5cbiAgZnVuY3Rpb24gcGFyc2VDbGFzcyhjdG9yTm9kZSkge1xuICAgIC8vIENvbnRhaW5lciBmb3IgY2xhc3MgY29uc3RydWN0b3IgYW5kIHByb3RvdHlwZSBmdW5jdGlvbnNcbiAgICB2YXIgY29udGFpbmVyID0gc3RhcnROb2RlRnJvbShjdG9yTm9kZSk7XG4gICAgY29udGFpbmVyLmJvZHkgPSBbXTtcblxuICAgIC8vIFBhcnNlIGNsYXNzIHNpZ25hdHVyZVxuICAgIGN0b3JOb2RlLmlkID0gcGFyc2VJZGVudCgpO1xuICAgIGN0b3JOb2RlLnBhcmFtcyA9IFtdO1xuICAgIHZhciBjbGFzc1BhcmFtcyA9IFtdO1xuICAgIGlmIChlYXQodHQucGFyZW5MKSkge1xuICAgICAgdmFyIGZpcnN0ID0gdHJ1ZTtcbiAgICAgIHdoaWxlICghZWF0KHR0LnBhcmVuUikgJiYgdG9rZW4udHlwZSAhPT0gdHQuZW9mKSB7XG4gICAgICAgIGlmICghZmlyc3QpIGV4cGVjdCh0dC5jb21tYSk7IGVsc2UgZmlyc3QgPSBmYWxzZTtcbiAgICAgICAgY2xhc3NQYXJhbXMucHVzaChwYXJzZUlkZW50KCkpO1xuICAgICAgfVxuICAgIH1cbiAgICBleHBlY3QodHQuY29sb24pO1xuXG4gICAgLy8gU3RhcnQgbmV3IG5hbWVzcGFjZSBmb3IgY2xhc3MgYm9keVxuICAgIHNjb3BlLnN0YXJ0Q2xhc3MoY3Rvck5vZGUuaWQubmFtZSk7XG5cbiAgICAvLyBTYXZlIGEgcmVmZXJlbmNlIGZvciBzb3VyY2UgcmFuZ2VzXG4gICAgdmFyIGNsYXNzQm9keVJlZk5vZGUgPSBmaW5pc2hOb2RlKHN0YXJ0Tm9kZSgpKTtcblxuICAgIC8vIFBhcnNlIGNsYXNzIGJvZHlcbiAgICB2YXIgY2xhc3NCbG9jayA9IHBhcnNlU3VpdGUoKTtcblxuICAgIC8vIEdlbmVyYXRlIGFkZGl0aW9uYWwgQVNUIHRvIGltcGxlbWVudCBjbGFzc1xuICAgIHZhciBjbGFzc1N0bXQgPSBuYy5jcmVhdGVDbGFzcyhjb250YWluZXIsIGN0b3JOb2RlLCBjbGFzc1BhcmFtcywgY2xhc3NCb2R5UmVmTm9kZSwgY2xhc3NCbG9jayk7XG5cbiAgICBzY29wZS5lbmQoKTtcblxuICAgIHJldHVybiBjbGFzc1N0bXQ7XG4gIH1cblxuICAvLyBQYXJzZSBkaWN0aW9uYXJ5XG4gIC8vIEN1c3RvbSBkaWN0IG9iamVjdCB1c2VkIHRvIHNpbXVsYXRlIG5hdGl2ZSBQeXRob24gZGljdFxuICAvLyBFLmcuIFwieydrMSc6J3YxJywgJ2syJzondjInfVwiIGJlY29tZXMgXCJuZXcgX19weXRob25SdW50aW1lLm9iamVjdHMuZGljdChbJ2sxJywgJ3YxJ10sIFsnazInLCAndjInXSk7XCJcblxuICBmdW5jdGlvbiBwYXJzZURpY3QodG9rQ2xvc2UpIHtcbiAgICB2YXIgbm9kZSA9IHN0YXJ0Tm9kZSgpLCBmaXJzdCA9IHRydWUsIGtleSwgdmFsdWU7XG4gICAgbm9kZS5hcmd1bWVudHMgPSBbXTtcbiAgICBuZXh0KCk7XG4gICAgd2hpbGUgKCFlYXQodG9rQ2xvc2UpICYmICFlYXQodHQubmV3bGluZSkgJiYgdG9rZW4udHlwZSAhPT0gdHQuZW9mKSB7XG4gICAgICBpZiAoIWZpcnN0KSB7XG4gICAgICAgIGV4cGVjdCh0dC5jb21tYSk7XG4gICAgICB9IGVsc2UgZmlyc3QgPSBmYWxzZTtcblxuICAgICAgaWYgKHRva0Nsb3NlID09PSB0dC5icmFjZVIpIHtcbiAgICAgICAga2V5ID0gcGFyc2VQcm9wZXJ0eU5hbWUoKTtcbiAgICAgICAgZXhwZWN0KHR0LmNvbG9uKTtcbiAgICAgICAgdmFsdWUgPSBwYXJzZUV4cHJPcHMoZmFsc2UpO1xuICAgICAgfSBlbHNlIGlmICh0b2tDbG9zZSA9PT0gdHQucGFyZW5SKSB7XG4gICAgICAgIHZhciBrZXlJZCA9IHBhcnNlSWRlbnQodHJ1ZSk7XG4gICAgICAgIGtleSA9IHN0YXJ0Tm9kZUZyb20oa2V5SWQpO1xuICAgICAgICBrZXkudmFsdWUgPSBrZXlJZC5uYW1lO1xuICAgICAgICBmaW5pc2hOb2RlKGtleSwgXCJMaXRlcmFsXCIpO1xuICAgICAgICBleHBlY3QodHQuZXEpO1xuICAgICAgICB2YWx1ZSA9IHBhcnNlRXhwck9wcyhmYWxzZSk7XG4gICAgICB9XG4gICAgICBub2RlLmFyZ3VtZW50cy5wdXNoKG5jLmNyZWF0ZU5vZGVTcGFuKGtleSwgdmFsdWUsIFwiQXJyYXlFeHByZXNzaW9uXCIsIHsgZWxlbWVudHM6IFtrZXksIHZhbHVlXSB9KSk7XG4gICAgfVxuICAgIGZpbmlzaE5vZGUobm9kZSwgXCJOZXdFeHByZXNzaW9uXCIpO1xuXG4gICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICB2YXIgb2JqZWN0c0lkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJvYmplY3RzXCIgfSk7XG4gICAgdmFyIHJ1bnRpbWVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVJZCwgcHJvcGVydHk6IG9iamVjdHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIHZhciBsaXN0SWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcImRpY3RcIiB9KTtcbiAgICBub2RlLmNhbGxlZSA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogcnVudGltZU1lbWJlciwgcHJvcGVydHk6IGxpc3RJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVByb3BlcnR5TmFtZSgpIHtcbiAgICBpZiAodG9rZW4udHlwZSA9PT0gdHQubnVtIHx8IHRva2VuLnR5cGUgPT09IHR0LnN0cmluZykgcmV0dXJuIHBhcnNlRXhwckF0b20oKTtcbiAgICBpZiAodG9rZW4udHlwZSA9PT0gdHQubmFtZSB8fCB0b2tlbi50eXBlLmtleXdvcmQpIHJldHVybiBwYXJzZUlkZW50KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUlkZW50KCkge1xuICAgIHZhciBub2RlID0gc3RhcnROb2RlKCk7XG4gICAgbm9kZS5uYW1lID0gdG9rZW4udHlwZSA9PT0gdHQubmFtZSA/IHRva2VuLnZhbHVlIDogdG9rZW4udHlwZS5rZXl3b3JkO1xuICAgIGlmICghbm9kZS5uYW1lKSBub2RlID0gZHVtbXlJZGVudCgpO1xuICAgIG5leHQoKTtcbiAgICByZXR1cm4gZmluaXNoTm9kZShub2RlLCBcIklkZW50aWZpZXJcIik7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUZ1bmN0aW9uKG5vZGUpIHtcbiAgICB2YXIgc3VmZml4ID0gbmV3QXN0SWRDb3VudCsrO1xuICAgIG5vZGUuaWQgPSBwYXJzZUlkZW50KCk7XG4gICAgbm9kZS5wYXJhbXMgPSBbXTtcblxuICAgIC8vIFBhcnNlIHBhcmFtZXRlcnNcblxuICAgIHZhciBmb3JtYWxzID0gW107ICAgICAvLyBJbiBvcmRlciwgbWF5YmUgd2l0aCBkZWZhdWx0IHZhbHVlXG4gICAgdmFyIGFyZ3NJZCA9IG51bGw7ICAgIC8vICphcmdzXG4gICAgdmFyIGt3YXJnc0lkID0gbnVsbDsgIC8vICoqa3dhcmdzXG4gICAgdmFyIGZpcnN0ID0gdHJ1ZTtcbiAgICBleHBlY3QodHQucGFyZW5MKTtcbiAgICB3aGlsZSAoIWVhdCh0dC5wYXJlblIpICYmIHRva2VuLnR5cGUgIT09IHR0LmVvZikge1xuICAgICAgaWYgKCFmaXJzdCkgZXhwZWN0KHR0LmNvbW1hKTsgZWxzZSBmaXJzdCA9IGZhbHNlO1xuICAgICAgaWYgKHRva2VuLnZhbHVlID09PSAnKicpIHtcbiAgICAgICAgbmV4dCgpOyBhcmdzSWQgPSBwYXJzZUlkZW50KCk7XG4gICAgICB9IGVsc2UgaWYgKHRva2VuLnZhbHVlID09PSAnKionKSB7XG4gICAgICAgIG5leHQoKTsga3dhcmdzSWQgPSBwYXJzZUlkZW50KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcGFyYW1JZCA9IHBhcnNlSWRlbnQoKTtcbiAgICAgICAgaWYgKGVhdCh0dC5lcSkpXG4gICAgICAgICAgZm9ybWFscy5wdXNoKHsgaWQ6IHBhcmFtSWQsIGV4cHI6IHBhcnNlRXhwck9wcyhmYWxzZSkgfSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBmb3JtYWxzLnB1c2goeyBpZDogcGFyYW1JZCwgZXhwcjogbnVsbCB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZXhwZWN0KHR0LmNvbG9uKTtcblxuICAgIHNjb3BlLnN0YXJ0Rm4obm9kZS5pZC5uYW1lKTtcblxuICAgIC8vIElmIGNsYXNzIG1ldGhvZCwgcmVtb3ZlIGNsYXNzIGluc3RhbmNlIHZhciBmcm9tIHBhcmFtcyBhbmQgc2F2ZSBmb3IgJ3RoaXMnIHJlcGxhY2VtZW50XG4gICAgaWYgKHNjb3BlLmlzUGFyZW50Q2xhc3MoKSkge1xuICAgICAgdmFyIHNlbGZJZCA9IGZvcm1hbHMuc2hpZnQoKTtcbiAgICAgIHNjb3BlLnNldFRoaXNSZXBsYWNlKHNlbGZJZC5pZC5uYW1lKTtcbiAgICB9XG5cbiAgICB2YXIgYm9keSA9IHBhcnNlU3VpdGUoKTtcbiAgICBub2RlLmJvZHkgPSBuYy5jcmVhdGVOb2RlU3Bhbihib2R5LCBib2R5LCBcIkJsb2NrU3RhdGVtZW50XCIsIHsgYm9keTogW10gfSk7XG5cbiAgICAvLyBBZGQgcnVudGltZSBwYXJhbWV0ZXIgcHJvY2Vzc2luZ1xuXG4gICAgaWYgKGZvcm1hbHMubGVuZ3RoID4gMCB8fCBhcmdzSWQgfHwga3dhcmdzSWQpIHtcbiAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlTm9kZVBhcmFtc0NoZWNrKG5vZGUuaWQsIHN1ZmZpeCkpO1xuICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChuYy5jcmVhdGVWYXJEZWNsRnJvbUlkKG5vZGUuaWQsXG4gICAgICAgIG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUuaWQsIG5vZGUuaWQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdfX2Zvcm1hbHNJbmRleCcgKyBzdWZmaXggfSksXG4gICAgICAgIG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUuaWQsIG5vZGUuaWQsIFwiTGl0ZXJhbFwiLCB7IHZhbHVlOiAwIH0pKSk7XG4gICAgICBub2RlLmJvZHkuYm9keS5wdXNoKG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQobm9kZS5pZCxcbiAgICAgICAgbmMuY3JlYXRlTm9kZVNwYW4obm9kZS5pZCwgbm9kZS5pZCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogJ19fYXJncycgKyBzdWZmaXggfSksXG4gICAgICAgIG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUuaWQsIG5vZGUuaWQsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6ICdhcmd1bWVudHMnIH0pKSk7XG4gICAgfVxuICAgIGlmIChmb3JtYWxzLmxlbmd0aCA+IDApIHtcbiAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlTm9kZUdldFBhcmFtRm4obm9kZS5pZCwgc3VmZml4KSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1hbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIF9fZ2V0UGFyYW1DYWxsID0gbmMuY3JlYXRlTm9kZVNwYW4oZm9ybWFsc1tpXS5pZCwgZm9ybWFsc1tpXS5pZCwgXCJDYWxsRXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgY2FsbGVlOiBuYy5jcmVhdGVOb2RlU3Bhbihmb3JtYWxzW2ldLmlkLCBmb3JtYWxzW2ldLmlkLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19nZXRQYXJhbScgKyBzdWZmaXggfSksXG4gICAgICAgICAgYXJndW1lbnRzOiBbbmMuY3JlYXRlTm9kZVNwYW4oZm9ybWFsc1tpXS5pZCwgZm9ybWFsc1tpXS5pZCwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IGZvcm1hbHNbaV0uaWQubmFtZSB9KV1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChmb3JtYWxzW2ldLmV4cHIpIF9fZ2V0UGFyYW1DYWxsLmFyZ3VtZW50cy5wdXNoKGZvcm1hbHNbaV0uZXhwcik7XG4gICAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlVmFyRGVjbEZyb21JZChmb3JtYWxzW2ldLmlkLCBmb3JtYWxzW2ldLmlkLCBfX2dldFBhcmFtQ2FsbCkpO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgcmVmTm9kZSA9IGFyZ3NJZCB8fCBrd2FyZ3NJZDtcbiAgICBpZiAocmVmTm9kZSkge1xuICAgICAgaWYgKGFyZ3NJZCkge1xuICAgICAgICB2YXIgYXJnc0Fzc2lnbiA9IG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQoYXJnc0lkLCBhcmdzSWQsIG5jLmNyZWF0ZU5vZGVTcGFuKGFyZ3NJZCwgYXJnc0lkLCBcIkFycmF5RXhwcmVzc2lvblwiLCB7IGVsZW1lbnRzOiBbXSB9KSk7XG4gICAgICAgIG5vZGUuYm9keS5ib2R5LnB1c2goYXJnc0Fzc2lnbik7XG4gICAgICB9XG4gICAgICBpZiAoa3dhcmdzSWQpIHtcbiAgICAgICAgdmFyIGt3YXJnc0Fzc2lnbiA9IG5jLmNyZWF0ZVZhckRlY2xGcm9tSWQoa3dhcmdzSWQsIGt3YXJnc0lkLCBuYy5jcmVhdGVOb2RlU3Bhbihrd2FyZ3NJZCwga3dhcmdzSWQsIFwiT2JqZWN0RXhwcmVzc2lvblwiLCB7IHByb3BlcnRpZXM6IFtdIH0pKTtcbiAgICAgICAgbm9kZS5ib2R5LmJvZHkucHVzaChrd2FyZ3NBc3NpZ24pO1xuICAgICAgfVxuICAgICAgdmFyIGFyZ3NJZiA9IG5jLmNyZWF0ZU5vZGVTcGFuKHJlZk5vZGUsIHJlZk5vZGUsIFwiSWZTdGF0ZW1lbnRcIiwge1xuICAgICAgICB0ZXN0OiBuYy5jcmVhdGVOb2RlU3BhbihyZWZOb2RlLCByZWZOb2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiAnX19wYXJhbXMnICsgc3VmZml4IH0pLFxuICAgICAgICBjb25zZXF1ZW50OiBuYy5jcmVhdGVOb2RlU3BhbihyZWZOb2RlLCByZWZOb2RlLCBcIkJsb2NrU3RhdGVtZW50XCIsIHsgYm9keTogW10gfSlcbiAgICAgIH0pXG4gICAgICBpZiAoYXJnc0lkKSB7XG4gICAgICAgIGFyZ3NJZi5jb25zZXF1ZW50LmJvZHkucHVzaChuYy5jcmVhdGVOb2RlQXJnc1doaWxlQ29uc2VxdWVudChhcmdzSWQsIHN1ZmZpeCkpO1xuICAgICAgICBhcmdzSWYuYWx0ZXJuYXRlID0gbmMuY3JlYXRlTm9kZUFyZ3NBbHRlcm5hdGUoYXJnc0lkKTtcbiAgICAgIH1cbiAgICAgIGlmIChrd2FyZ3NJZCkge1xuICAgICAgICBhcmdzSWYuY29uc2VxdWVudC5ib2R5LnB1c2gobmMuY3JlYXRlTm9kZVNwYW4oa3dhcmdzSWQsIGt3YXJnc0lkLCBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIiwge1xuICAgICAgICAgIGV4cHJlc3Npb246IG5jLmNyZWF0ZU5vZGVTcGFuKGt3YXJnc0lkLCBrd2FyZ3NJZCwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiLCB7XG4gICAgICAgICAgICBvcGVyYXRvcjogJz0nLCBsZWZ0OiBrd2FyZ3NJZCwgcmlnaHQ6IG5jLmNyZWF0ZU5vZGVNZW1iSWRzKGt3YXJnc0lkLCAnX19wYXJhbXMnICsgc3VmZml4LCAna2V5d29yZHMnKSxcbiAgICAgICAgICB9KVxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgICBub2RlLmJvZHkuYm9keS5wdXNoKGFyZ3NJZik7XG4gICAgfVxuICAgIG5vZGUuYm9keS5ib2R5LnB1c2gobmMuY3JlYXRlTm9kZUZuQm9keUlpZmUoYm9keSkpO1xuXG4gICAgLy8gSWYgY2xhc3MgbWV0aG9kLCByZXBsYWNlIHdpdGggcHJvdG90eXBlIGZ1bmN0aW9uIGxpdGVyYWxzXG4gICAgdmFyIHJldE5vZGU7XG4gICAgaWYgKHNjb3BlLmlzUGFyZW50Q2xhc3MoKSkge1xuICAgICAgZmluaXNoTm9kZShub2RlKTtcbiAgICAgIHZhciBjbGFzc0lkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogc2NvcGUuZ2V0UGFyZW50Q2xhc3NOYW1lKCkgfSk7XG4gICAgICB2YXIgcHJvdG90eXBlSWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcInByb3RvdHlwZVwiIH0pO1xuICAgICAgdmFyIGZ1bmN0aW9uSWQgPSBub2RlLmlkO1xuICAgICAgdmFyIHByb3RvdHlwZU1lbWJlciA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiTWVtYmVyRXhwcmVzc2lvblwiLCB7IG9iamVjdDogY2xhc3NJZCwgcHJvcGVydHk6IHByb3RvdHlwZUlkLCBjb21wdXRlZDogZmFsc2UgfSk7XG4gICAgICB2YXIgZnVuY3Rpb25NZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHByb3RvdHlwZU1lbWJlciwgcHJvcGVydHk6IGZ1bmN0aW9uSWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcbiAgICAgIHZhciBmdW5jdGlvbkV4cHIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIkZ1bmN0aW9uRXhwcmVzc2lvblwiLCB7IGJvZHk6IG5vZGUuYm9keSwgcGFyYW1zOiBub2RlLnBhcmFtcyB9KTtcbiAgICAgIHZhciBhc3NpZ25FeHByID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiLCB7IGxlZnQ6IGZ1bmN0aW9uTWVtYmVyLCBvcGVyYXRvcjogXCI9XCIsIHJpZ2h0OiBmdW5jdGlvbkV4cHIgfSk7XG4gICAgICByZXROb2RlID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJFeHByZXNzaW9uU3RhdGVtZW50XCIsIHsgZXhwcmVzc2lvbjogYXNzaWduRXhwciB9KTtcbiAgICB9IGVsc2UgcmV0Tm9kZSA9IGZpbmlzaE5vZGUobm9kZSwgXCJGdW5jdGlvbkRlY2xhcmF0aW9uXCIpO1xuXG4gICAgc2NvcGUuZW5kKCk7XG5cbiAgICByZXR1cm4gcmV0Tm9kZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlRXhwckxpc3QoY2xvc2UpIHtcbiAgICB2YXIgZWx0cyA9IFtdO1xuICAgIHdoaWxlICghZWF0KGNsb3NlKSAmJiAhZWF0KHR0Lm5ld2xpbmUpICYmIHRva2VuLnR5cGUgIT09IHR0LmVvZikge1xuICAgICAgdmFyIGVsdCA9IHBhcnNlRXhwck9wcyhmYWxzZSk7XG4gICAgICBpZiAoaXNEdW1teShlbHQpKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsdHMucHVzaChlbHQpO1xuICAgICAgfVxuICAgICAgd2hpbGUgKGVhdCh0dC5jb21tYSkpIHt9XG4gICAgfVxuICAgIHJldHVybiBlbHRzO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VQYXJhbXNMaXN0KCkge1xuICAgIHZhciBlbHRzID0gW10sIGZpcnN0ID0gdHJ1ZTtcbiAgICB3aGlsZSAoIWVhdCh0dC5wYXJlblIpICYmICFlYXQodHQubmV3bGluZSkgJiYgdG9rZW4udHlwZSAhPT0gdHQuZW9mKSB7XG4gICAgICBpZiAoIWZpcnN0KSBleHBlY3QodHQuY29tbWEpO1xuICAgICAgZWxzZSBmaXJzdCA9IGZhbHNlO1xuICAgICAgdmFyIGV4cHIgPSBwYXJzZUV4cHJPcHMoZmFsc2UpO1xuICAgICAgaWYgKGVhdCh0dC5lcSkpIHtcbiAgICAgICAgdmFyIHJpZ2h0ID0gcGFyc2VFeHByT3BzKGZhbHNlKTtcbiAgICAgICAgdmFyIGt3SWQgPSBuYy5jcmVhdGVOb2RlU3BhbihleHByLCByaWdodCwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJfX2t3cFwiIH0pO1xuICAgICAgICB2YXIga3dMaXQgPSBuYy5jcmVhdGVOb2RlU3BhbihleHByLCByaWdodCwgXCJMaXRlcmFsXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgICAgIHZhciBsZWZ0ID0gbmMuY3JlYXRlTm9kZVNwYW4oZXhwciwgcmlnaHQsIFwiT2JqZWN0RXhwcmVzc2lvblwiLCB7IHByb3BlcnRpZXM6IFtdIH0pO1xuICAgICAgICBsZWZ0LnByb3BlcnRpZXMucHVzaCh7IHR5cGU6IFwiUHJvcGVydHlcIiwga2V5OiBleHByLCB2YWx1ZTogcmlnaHQsIGtpbmQ6IFwiaW5pdFwiIH0pO1xuICAgICAgICBsZWZ0LnByb3BlcnRpZXMucHVzaCh7IHR5cGU6IFwiUHJvcGVydHlcIiwga2V5OiBrd0lkLCB2YWx1ZToga3dMaXQsIGtpbmQ6IFwiaW5pdFwiIH0pO1xuICAgICAgICBleHByID0gbGVmdDtcbiAgICAgIH1cbiAgICAgIGVsdHMucHVzaChleHByKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVR1cGxlKG5vSW4sIGV4cHIpIHtcbiAgICB2YXIgbm9kZSA9IGV4cHIgPyBzdGFydE5vZGVGcm9tKGV4cHIpIDogc3RhcnROb2RlKCk7XG4gICAgbm9kZS5hcmd1bWVudHMgPSBleHByID8gW2V4cHJdIDogW107XG5cbiAgICAvLyBUdXBsZSB3aXRoIHNpbmdsZSBlbGVtZW50IGhhcyBzcGVjaWFsIHRyYWlsaW5nIGNvbW1hOiB0ID0gJ2hpJyxcbiAgICAvLyBMb29rIGFoZWFkIGFuZCBlYXQgY29tbWEgaW4gdGhpcyBzY2VuYXJpb1xuICAgIGlmICh0b2tlbi50eXBlID09PSB0dC5jb21tYSkge1xuICAgICAgdmFyIHBvcyA9IHRva2VuLnN0YXJ0ICsgMTtcbiAgICAgIHdoaWxlIChpc1NwYWNlKGlucHV0LmNoYXJDb2RlQXQocG9zKSkpICsrcG9zO1xuICAgICAgaWYgKHBvcyA+PSBpbnB1dExlbiB8fCBpbnB1dFtwb3NdID09PSAnOycgfHwgaW5wdXRbcG9zXSA9PT0gJyknIHx8IGlzTmV3bGluZShpbnB1dC5jaGFyQ29kZUF0KHBvcykpKVxuICAgICAgICBlYXQodHQuY29tbWEpO1xuICAgIH1cblxuICAgIHdoaWxlIChlYXQodHQuY29tbWEpKSB7XG4gICAgICBub2RlLmFyZ3VtZW50cy5wdXNoKHBhcnNlRXhwck9wcyhub0luKSk7XG4gICAgfVxuICAgIGZpbmlzaE5vZGUobm9kZSwgXCJOZXdFeHByZXNzaW9uXCIpO1xuXG4gICAgdmFyIHJ1bnRpbWVJZCA9IG5jLmNyZWF0ZU5vZGVTcGFuKG5vZGUsIG5vZGUsIFwiSWRlbnRpZmllclwiLCB7IG5hbWU6IG9wdGlvbnMucnVudGltZVBhcmFtTmFtZSB9KTtcbiAgICB2YXIgb2JqZWN0c0lkID0gbmMuY3JlYXRlTm9kZVNwYW4obm9kZSwgbm9kZSwgXCJJZGVudGlmaWVyXCIsIHsgbmFtZTogXCJvYmplY3RzXCIgfSk7XG4gICAgdmFyIHJ1bnRpbWVNZW1iZXIgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVJZCwgcHJvcGVydHk6IG9iamVjdHNJZCwgY29tcHV0ZWQ6IGZhbHNlIH0pO1xuICAgIHZhciBsaXN0SWQgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIklkZW50aWZpZXJcIiwgeyBuYW1lOiBcInR1cGxlXCIgfSk7XG4gICAgbm9kZS5jYWxsZWUgPSBuYy5jcmVhdGVOb2RlU3Bhbihub2RlLCBub2RlLCBcIk1lbWJlckV4cHJlc3Npb25cIiwgeyBvYmplY3Q6IHJ1bnRpbWVNZW1iZXIsIHByb3BlcnR5OiBsaXN0SWQsIGNvbXB1dGVkOiBmYWxzZSB9KTtcblxuICAgIHJldHVybiBub2RlO1xuICB9XG59KTtcbiIsIlRhckdaID0gZnVuY3Rpb24oKXt9O1xyXG5cclxuLy8gTG9hZCBhbmQgcGFyc2UgYXJjaGl2ZSwgY2FsbHMgb25sb2FkIGFmdGVyIGxvYWRpbmcgYWxsIGZpbGVzLlxyXG5UYXJHWi5sb2FkID0gZnVuY3Rpb24odXJsLCBvbmxvYWQsIG9uc3RyZWFtLCBvbmVycm9yKSBcclxue1xyXG4gIHZhciBvID0gbmV3IFRhckdaKCk7XHJcbiAgby5vbmxvYWQgPSBvbmxvYWQ7XHJcbiAgby5vbmVycm9yID0gb25lcnJvcjtcclxuICBvLm9uc3RyZWFtID0gb25zdHJlYW07XHJcbiAgby5sb2FkKHVybCk7XHJcbiAgcmV0dXJuIG87XHJcbn07XHJcblxyXG4vLyBTdHJlYW1zIGFuIGFyY2hpdmUgZnJvbSB0aGUgZ2l2ZW4gdXJsLCBjYWxsaW5nIG9uc3RyZWFtIGFmdGVyIGxvYWRpbmcgZWFjaCBmaWxlIGluIGFyY2hpdmUuXHJcbi8vIENhbGxzIG9ubG9hZCBhZnRlciBsb2FkaW5nIGFsbCBmaWxlcy5cclxuVGFyR1ouc3RyZWFtID0gZnVuY3Rpb24odXJsLCBvbnN0cmVhbSwgb25sb2FkLCBvbmVycm9yKSBcclxue1xyXG4gIHZhciBvID0gbmV3IFRhckdaKCk7XHJcbiAgby5vbmxvYWQgPSBvbmxvYWQ7XHJcbiAgby5vbmVycm9yID0gb25lcnJvcjtcclxuICBvLm9uc3RyZWFtID0gb25zdHJlYW07XHJcbiAgby5sb2FkKHVybCk7XHJcbiAgcmV0dXJuIG87XHJcbn07XHJcblxyXG5UYXJHWi5wcm90b3R5cGUgPSB7XHJcbiAgb25lcnJvciA6IG51bGwsXHJcbiAgb25sb2FkIDogbnVsbCxcclxuICBvbnN0cmVhbSA6IG51bGwsXHJcbiAgb25kYXRhIDogbnVsbCxcclxuICBcclxuICBsb2FkIDogZnVuY3Rpb24odXJsKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgb2Zmc2V0ID0ge2NodW5rQnl0ZXM6IDAsIGNodW5rczogMH07XHJcbiAgICB2YXIgYnl0ZU9mZnNldCA9IDA7XHJcbiAgICB0aGlzLmZpbGVzID0gW107XHJcbiAgICBHWmlwLmxvYWQodXJsLFxyXG4gICAgICBmdW5jdGlvbihoKSB7XHJcbiAgICAgICAgYnl0ZU9mZnNldCA9IHNlbGYucHJvY2Vzc1RhckNodW5rcyhoLmRhdGEsIGJ5dGVPZmZzZXQsIGgub3V0cHV0U2l6ZSk7XHJcbiAgICAgICAgaWYgKHNlbGYub25sb2FkKVxyXG4gICAgICAgICAgc2VsZi5vbmxvYWQoc2VsZi5maWxlcywgaCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGZ1bmN0aW9uKGgpIHtcclxuICAgICAgICBzZWxmLmd6aXAgPSBoO1xyXG4gICAgICAgIGlmIChzZWxmLm9uZGF0YSkgc2VsZi5vbmRhdGEoaCk7XHJcbiAgICAgICAgYnl0ZU9mZnNldCA9IHNlbGYucHJvY2Vzc1RhckNodW5rcyhoLmRhdGEsIGJ5dGVPZmZzZXQsIGgub3V0cHV0U2l6ZSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGZ1bmN0aW9uKHhociwgZSwgaCkge1xyXG4gICAgICAgIGlmIChzZWxmLm9uZXJyb3IpXHJcbiAgICAgICAgICBzZWxmLm9uZXJyb3IoeGhyLCBlLCBoKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9LFxyXG4gXHJcbiAgY2xlYW5IaWdoQnl0ZSA6IGZ1bmN0aW9uKHMpIHtcclxuICAgIHJldHVybiBzLnJlcGxhY2UoLy4vZywgZnVuY3Rpb24obSkgeyBcclxuICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUobS5jaGFyQ29kZUF0KDApICYgMHhmZik7XHJcbiAgICB9KTtcclxuICB9LFxyXG4gIFxyXG4gIHBhcnNlVGFyIDogZnVuY3Rpb24odGV4dCkge1xyXG4gICAgdGhpcy5maWxlcyA9IFtdO1xyXG4gICAgdGhpcy5wcm9jZXNzVGFyQ2h1bmtzKFt0ZXh0XSwgMCwgdGV4dC5sZW5ndGgpO1xyXG4gIH0sXHJcbiAgcHJvY2Vzc1RhckNodW5rcyA6IGZ1bmN0aW9uIChjaHVua3MsIG9mZnNldCwgdG90YWxTaXplKSB7XHJcbiAgICB3aGlsZSAodG90YWxTaXplID49IG9mZnNldCArIDUxMikge1xyXG4gICAgICB2YXIgaGVhZGVyID0gdGhpcy5maWxlcy5sZW5ndGggPT0gMCA/IG51bGwgOiB0aGlzLmZpbGVzW3RoaXMuZmlsZXMubGVuZ3RoLTFdO1xyXG4gICAgICBpZiAoaGVhZGVyICYmIGhlYWRlci5kYXRhID09IG51bGwpIHtcclxuICAgICAgICBpZiAob2Zmc2V0ICsgaGVhZGVyLmxlbmd0aCA8PSB0b3RhbFNpemUpIHtcclxuICAgICAgICAgIGhlYWRlci5kYXRhID0gdGhpcy5jaHVua1N1YnN0cmluZyhjaHVua3MsIG9mZnNldCwgb2Zmc2V0K2hlYWRlci5sZW5ndGgpO1xyXG4gICAgICAgICAgaGVhZGVyLnRvRGF0YVVSTCA9IHRoaXMuX190b0RhdGFVUkw7XHJcbiAgICAgICAgICBvZmZzZXQgKz0gNTEyICogTWF0aC5jZWlsKGhlYWRlci5sZW5ndGggLyA1MTIpO1xyXG4gICAgICAgICAgaWYgKHRoaXMub25zdHJlYW0pIFxyXG4gICAgICAgICAgICB0aGlzLm9uc3RyZWFtKGhlYWRlciwgdGhpcy5nemlwKTtcclxuICAgICAgICB9IGVsc2UgeyAvLyBub3QgbG9hZGVkIHlldFxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciBzID0gdGhpcy5jaHVua1N1YnN0cmluZyhjaHVua3MsIG9mZnNldCwgb2Zmc2V0KzUxMik7XHJcbiAgICAgICAgdmFyIGhlYWRlciA9IHRoaXMucGFyc2VUYXJIZWFkZXIocywgMCk7XHJcbiAgICAgICAgaWYgKGhlYWRlci5sZW5ndGggPiAwIHx8IGhlYWRlci5maWxlbmFtZSAhPSAnJykge1xyXG4gICAgICAgICAgdGhpcy5maWxlcy5wdXNoKGhlYWRlcik7XHJcbiAgICAgICAgICBvZmZzZXQgKz0gNTEyO1xyXG4gICAgICAgICAgaGVhZGVyLm9mZnNldCA9IG9mZnNldDtcclxuICAgICAgICB9IGVsc2UgeyAvLyBlbXB0eSBoZWFkZXIsIHN0b3AgcHJvY2Vzc2luZ1xyXG4gICAgICAgICAgb2Zmc2V0ID0gdG90YWxTaXplO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9mZnNldDtcclxuICB9LFxyXG4gIHBhcnNlVGFySGVhZGVyIDogZnVuY3Rpb24odGV4dCwgb2Zmc2V0KSB7XHJcbiAgICB2YXIgaSA9IG9mZnNldCB8fCAwO1xyXG4gICAgdmFyIGggPSB7fTtcclxuICAgIGguZmlsZW5hbWUgPSB0ZXh0LnN1YnN0cmluZyhpLCBpKz0xMDApLnNwbGl0KFwiXFwwXCIsIDEpWzBdO1xyXG4gICAgaC5tb2RlID0gdGV4dC5zdWJzdHJpbmcoaSwgaSs9OCkuc3BsaXQoXCJcXDBcIiwgMSlbMF07XHJcbiAgICBoLnVpZCA9IHRleHQuc3Vic3RyaW5nKGksIGkrPTgpLnNwbGl0KFwiXFwwXCIsIDEpWzBdO1xyXG4gICAgaC5naWQgPSB0ZXh0LnN1YnN0cmluZyhpLCBpKz04KS5zcGxpdChcIlxcMFwiLCAxKVswXTtcclxuICAgIGgubGVuZ3RoID0gdGhpcy5wYXJzZVRhck51bWJlcih0ZXh0LnN1YnN0cmluZyhpLCBpKz0xMikpO1xyXG4gICAgaC5sYXN0TW9kaWZpZWQgPSB0ZXh0LnN1YnN0cmluZyhpLCBpKz0xMikuc3BsaXQoXCJcXDBcIiwgMSlbMF07XHJcbiAgICBoLmNoZWNrU3VtID0gdGV4dC5zdWJzdHJpbmcoaSwgaSs9OCkuc3BsaXQoXCJcXDBcIiwgMSlbMF07XHJcbiAgICBoLmZpbGVUeXBlID0gdGV4dC5zdWJzdHJpbmcoaSwgaSs9MSkuc3BsaXQoXCJcXDBcIiwgMSlbMF07XHJcbiAgICBoLmxpbmtOYW1lID0gdGV4dC5zdWJzdHJpbmcoaSwgaSs9MTAwKS5zcGxpdChcIlxcMFwiLCAxKVswXTtcclxuICAgIHJldHVybiBoO1xyXG4gIH0sXHJcbiAgcGFyc2VUYXJOdW1iZXIgOiBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICAvLyBpZiAodGV4dC5jaGFyQ29kZUF0KDApICYgMHg4MCA9PSAxKSB7XHJcbiAgICAvLyBHTlUgdGFyIDgtYnl0ZSBiaW5hcnkgYmlnLWVuZGlhbiBudW1iZXJcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBwYXJzZUludCh0ZXh0LnJlcGxhY2UoL1teXFxkXS9nLCAnJyksIDgpO1xyXG4gICAgLy8gfVxyXG4gIH0sXHJcblxyXG4gIC8vIGV4dHJhY3Qgc3Vic3RyaW5nIGZyb20gYW4gYXJyYXkgb2Ygc3RyaW5nc1xyXG4gIGNodW5rU3Vic3RyaW5nIDogZnVuY3Rpb24gKGNodW5rcywgc3RhcnQsIGVuZCkge1xyXG4gICAgdmFyIHNvZmY9MCwgZW9mZj0wLCBpPTAsIGo9MDtcclxuICAgIGZvciAoaT0wOyBpPGNodW5rcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAoc29mZiArIGNodW5rc1tpXS5sZW5ndGggPiBzdGFydClcclxuICAgICAgICBicmVhaztcclxuICAgICAgc29mZiArPSBjaHVua3NbaV0ubGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgdmFyIHN0cnMgPSBbXTtcclxuICAgIGVvZmYgPSBzb2ZmO1xyXG4gICAgZm9yIChqPWk7IGo8Y2h1bmtzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgIHN0cnMucHVzaChjaHVua3Nbal0pO1xyXG4gICAgICBpZiAoZW9mZiArIGNodW5rc1tqXS5sZW5ndGggPiBlbmQpXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGVvZmYgKz0gY2h1bmtzW2pdLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHZhciBzID0gc3Rycy5qb2luKCcnKTtcclxuICAgIHJldHVybiBzLnN1YnN0cmluZyhzdGFydC1zb2ZmLCBzdGFydC1zb2ZmKyhlbmQtc3RhcnQpKTtcclxuICB9LFxyXG5cclxuICBfX3RvRGF0YVVSTCA6IGZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKHRoaXMuZGF0YS5zdWJzdHJpbmcoMCw0MCkubWF0Y2goL15kYXRhOlteXFwvXStcXC9bXixdKywvKSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5kYXRhO1xyXG4gICAgfSBlbHNlIGlmIChUYXJHWi5wcm90b3R5cGUuY2xlYW5IaWdoQnl0ZSh0aGlzLmRhdGEuc3Vic3RyaW5nKDAsMTApKS5tYXRjaCgvXFwzNzdcXDMzMFxcMzc3XFwzNDAuLkpGSUYvKSkge1xyXG4gICAgICByZXR1cm4gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJytidG9hKFRhckdaLnByb3RvdHlwZS5jbGVhbkhpZ2hCeXRlKHRoaXMuZGF0YSkpO1xyXG4gICAgfSBlbHNlIGlmIChUYXJHWi5wcm90b3R5cGUuY2xlYW5IaWdoQnl0ZSh0aGlzLmRhdGEuc3Vic3RyaW5nKDAsNikpID09IFwiXFwyMTFQTkdcXHJcXG5cIikge1xyXG4gICAgICByZXR1cm4gJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwnK2J0b2EoVGFyR1oucHJvdG90eXBlLmNsZWFuSGlnaEJ5dGUodGhpcy5kYXRhKSk7XHJcbiAgICB9IGVsc2UgaWYgKFRhckdaLnByb3RvdHlwZS5jbGVhbkhpZ2hCeXRlKHRoaXMuZGF0YS5zdWJzdHJpbmcoMCw2KSkubWF0Y2goL0dJRjhbNzldYS8pKSB7XHJcbiAgICAgIHJldHVybiAnZGF0YTppbWFnZS9naWY7YmFzZTY0LCcrYnRvYShUYXJHWi5wcm90b3R5cGUuY2xlYW5IaWdoQnl0ZSh0aGlzLmRhdGEpKTtcclxuICAgIH0gZWxzZSBcclxuICAgIHtcclxuICAgICAgLy9jb25zb2xlLmxvZyhcInRvRGF0YVVSTDogSSBkb24ndCBrbm93IGhvdyB0byBoYW5kbGUgXCIgKyB0aGlzLmZpbGVuYW1lKTtcclxuICAgICAgcmV0dXJuICdkYXRhOmF1ZGlvL3dhdjtiYXNlNjQsJytidG9hKFRhckdaLnByb3RvdHlwZS5jbGVhbkhpZ2hCeXRlKHRoaXMuZGF0YSkpO1xyXG4gICAgfVxyXG4gIH1cclxufTtcclxuXHJcblxyXG5cclxuQmluID0ge1xyXG4gIGJ5dGUgOiBmdW5jdGlvbihzLCBvZmZzZXQpIHtcclxuICAgIHJldHVybiBzLmNoYXJDb2RlQXQob2Zmc2V0KSAmIDB4ZmY7XHJcbiAgfSxcclxuXHJcbiAgVUludDE2QkUgOiBmdW5jdGlvbihzLCBvZmZzZXQpIHtcclxuICAgIHJldHVybiAoKEJpbi5ieXRlKHMsIG9mZnNldCkgPDwgOCkgfCBCaW4uYnl0ZShzLCBvZmZzZXQrMSkpO1xyXG4gIH0sXHJcblxyXG4gIFVJbnQzMkJFIDogZnVuY3Rpb24ocywgb2Zmc2V0KSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICAoQmluLmJ5dGUocywgb2Zmc2V0KSA8PCAyNCkgfFxyXG4gICAgICAoQmluLmJ5dGUocywgb2Zmc2V0KzEpIDw8IDE2KSB8XHJcbiAgICAgIChCaW4uYnl0ZShzLCBvZmZzZXQrMikgPDwgOCkgfFxyXG4gICAgICAgQmluLmJ5dGUocywgb2Zmc2V0KzMpKTtcclxuICB9LFxyXG5cclxuICBVSW50MTZMRSA6IGZ1bmN0aW9uKHMsIG9mZnNldCkge1xyXG4gICAgcmV0dXJuICgoQmluLmJ5dGUocywgb2Zmc2V0KzEpIDw8IDgpIHwgQmluLmJ5dGUocywgb2Zmc2V0KSk7XHJcbiAgfSxcclxuXHJcbiAgVUludDMyTEUgOiBmdW5jdGlvbihzLCBvZmZzZXQpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIChCaW4uYnl0ZShzLCBvZmZzZXQrMykgPDwgMjQpIHxcclxuICAgICAgKEJpbi5ieXRlKHMsIG9mZnNldCsyKSA8PCAxNikgfFxyXG4gICAgICAoQmluLmJ5dGUocywgb2Zmc2V0KzEpIDw8IDgpIHxcclxuICAgICAgIEJpbi5ieXRlKHMsIG9mZnNldCkpO1xyXG4gIH0sXHJcblxyXG4gIENTdHJpbmcgOiBmdW5jdGlvbihzLCBvZmZzZXQpIHtcclxuICAgIHZhciB6ZXJvSWR4ID0gb2Zmc2V0O1xyXG4gICAgZm9yICg7IHplcm9JZHg8cy5sZW5ndGg7IHplcm9JZHgrKykge1xyXG4gICAgICBpZiAoQmluLmJ5dGUocywgemVyb0lkeCkgPT0gMClcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIGlmICh6ZXJvSWR4ID09IHMubGVuZ3RoKVxyXG4gICAgICB0aHJvdyhcIk5vIG51bGwgYnl0ZSBlbmNvdW50ZXJlZFwiKTtcclxuICAgIHJldHVybiBzLnN1YnN0cmluZyhvZmZzZXQsIHplcm9JZHgpO1xyXG4gIH0sXHJcblxyXG4gIENSQzE2IDogZnVuY3Rpb24ocywgc3RhcnQsIGxlbmd0aCwgY3JjKSB7XHJcbiAgICByZXR1cm4gY3JjMzIocywgc3RhcnQsIGxlbmd0aCwgY3JjKSAmIDB4ZmZmZjtcclxuICB9LFxyXG5cclxuICBDUkMzMiA6IGZ1bmN0aW9uKHMsIHN0YXJ0LCBsZW5ndGgsIGNyYykge1xyXG4gICAgcmV0dXJuIGNyYzMyKHMsIHN0YXJ0LCBsZW5ndGgsIGNyYyk7XHJcbiAgfVxyXG59O1xyXG5cclxuR1ppcCA9IHtcclxuICBERUZMQVRFOiAgOCxcclxuICBGVEVYVDogICAgMSA8PCAwLFxyXG4gIEZIQ1JDOiAgICAxIDw8IDEsXHJcbiAgRkVYVFJBOiAgIDEgPDwgMixcclxuICBGTkFNRTogICAgMSA8PCAzLFxyXG4gIEZDT01NRU5UOiAxIDw8IDQsXHJcblxyXG4gIGxvYWRsb2NhbCA6IGZ1bmN0aW9uKGRhdGEsIG9ubG9hZCwgb25zdHJlYW0sIG9uZXJyb3IpIFxyXG4gIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBoID0gbnVsbDtcclxuICAgIHZhciBzID0gZGF0YTtcclxuXHJcbiAgICB0cnkgXHJcbiAgICB7XHJcbiAgICBcdHZhciB0ID0gbmV3IERhdGU7XHJcbiAgICBcdGlmICghaCkgaCA9IHNlbGYucGFyc2VIZWFkZXIocyk7XHJcbiAgICBcdHNlbGYucGFyc2VBbGxCb2R5KHMsIGgsIG9uc3RyZWFtKTtcclxuICAgIFx0c2VsZi5wYXJzZUZvb3RlcihzLCBoKTtcclxuICAgIFx0dmFyIGVsYXBzZWQgPSBuZXcgRGF0ZSgpIC0gdDtcclxuICAgIFx0aC5kZWNvbXByZXNzaW9uVGltZSArPSBlbGFwc2VkO1xyXG4gICAgfSBcclxuICAgIGNhdGNoKGUpIFxyXG4gICAge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChvbmxvYWQpXHJcblx0e1xyXG4gICAgXHRvbmxvYWQoaCwgbnVsbCk7XHJcblx0fVxyXG4gIH0sXHRcclxuXHJcbiAgbG9hZCA6IGZ1bmN0aW9uKGRhdGEsIHVybCwgb25sb2FkLCBvbnN0cmVhbSwgb25lcnJvcikgXHJcbiAge1xyXG4gICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIGggPSBudWxsO1xyXG4gICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT0gNCkge1xyXG4gICAgICAgIGlmICh4aHIuc3RhdHVzID09IDIwMCB8fCB4aHIuc3RhdHVzID09IDApIHtcclxuICAgICAgICAgIHZhciBzID0geGhyLnJlc3BvbnNlVGV4dDtcclxuXHJcblx0ICAgICAgY29uc29sZS5sb2coJ2RhdGEnKTtcdFx0XHJcblx0XHQgIGNvbnNvbGUubG9nKHMpO1xyXG5cclxuXHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgdCA9IG5ldyBEYXRlO1xyXG4gICAgICAgICAgICBpZiAoIWgpIGggPSBzZWxmLnBhcnNlSGVhZGVyKHMpO1xyXG4gICAgICAgICAgICBzZWxmLnBhcnNlQWxsQm9keShzLCBoLCBvbnN0cmVhbSk7XHJcbiAgICAgICAgICAgIHNlbGYucGFyc2VGb290ZXIocywgaCk7XHJcbiAgICAgICAgICAgIHZhciBlbGFwc2VkID0gbmV3IERhdGUoKSAtIHQ7XHJcbiAgICAgICAgICAgIGguZGVjb21wcmVzc2lvblRpbWUgKz0gZWxhcHNlZDtcclxuICAgICAgICAgIH0gY2F0Y2goZSkge1xyXG4gICAgICAgICAgICBvbmVycm9yKHhociwgZSwgaCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChvbmxvYWQpXHJcbiAgICAgICAgICAgIG9ubG9hZChoLCB4aHIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAob25lcnJvcilcclxuICAgICAgICAgICAgb25lcnJvcih4aHIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmICh4aHIucmVhZHlTdGF0ZSA9PSAzKSB7XHJcbiAgICAgICAgaWYgKHhoci5zdGF0dXMgPT0gMjAwIHx8IHhoci5zdGF0dXMgPT0gMCkge1xyXG4gICAgICAgICAgdmFyIHMgPSB4aHIucmVzcG9uc2VUZXh0O1xyXG4gICAgICAgICAgaWYgKHMubGVuZ3RoIDwgMTAyNCkgcmV0dXJuOyAvLyByZWFkIGluIGhlYWRlclxyXG4gICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdmFyIHQgPSBuZXcgRGF0ZTtcclxuICAgICAgICAgICAgaWYgKCFoKSBoID0gc2VsZi5wYXJzZUhlYWRlcihzKTtcclxuICAgICAgICAgICAgc2VsZi5wYXJzZUJvZHkocywgaCwgb25zdHJlYW0pO1xyXG4gICAgICAgICAgICB2YXIgZWxhcHNlZCA9IG5ldyBEYXRlKCkgLSB0O1xyXG4gICAgICAgICAgICBoLmRlY29tcHJlc3Npb25UaW1lICs9IGVsYXBzZWQ7XHJcbiAgICAgICAgICB9IGNhdGNoKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHhoci5vcGVuKFwiR0VUXCIsIHVybCwgdHJ1ZSk7XHJcbiAgICB4aHIub3ZlcnJpZGVNaW1lVHlwZShcInRleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWRcIik7XHJcbiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcInRleHQvcGxhaW5cIik7XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKCdzZW5kJyk7XHJcbiAgICB4aHIuc2VuZChudWxsKTtcclxuICB9LFxyXG5cclxuICBwYXJzZUhlYWRlciA6IGZ1bmN0aW9uKHMpIHtcclxuICAgIHZhciBoID0ge307XHJcbiAgICBoLmRlY29tcHJlc3Npb25UaW1lID0gMDtcclxuICAgIGguaWQxID0gQmluLmJ5dGUocywwKTtcclxuICAgIGguaWQyID0gQmluLmJ5dGUocywxKTtcclxuICAgIGguY29tcHJlc3Npb25NZXRob2QgPSBCaW4uYnl0ZShzLDIpO1xyXG4gICAgaWYgKGguaWQxICE9IDB4MWYgfHwgaC5pZDIgIT0gMHg4YiB8fCBoLmNvbXByZXNzaW9uTWV0aG9kICE9IEdaaXAuREVGTEFURSkge1xyXG4gICAgICB0aHJvdyhcIk5vdCBhIEdaaXAgZmlsZTogXCIgKyBoLmlkMSArICcsJyArIGguaWQyICsgJywnICsgaC5jb21wcmVzc2lvbk1ldGhvZCk7XHJcbiAgICB9XHJcbiAgICBoLmZsYWdzID0gQmluLmJ5dGUocywzKTtcclxuICAgIGgubXRpbWUgPSBCaW4uVUludDMyTEUocywgNCk7XHJcbiAgICBoLmV4dHJhRmxhZ3MgPSBCaW4uYnl0ZShzLCA4KTtcclxuICAgIGgub3BlcmF0aW5nU3lzdGVtID0gQmluLmJ5dGUocywgOSk7XHJcbiAgICB2YXIgb2Zmc2V0ID0gMTA7XHJcbiAgICBpZiAoaC5mbGFncyAmIEdaaXAuRkVYVFJBKSB7XHJcbiAgICAgIHZhciB4bGVuID0gQmluLlVJbnQxNkxFKHMsIG9mZnNldCk7XHJcbiAgICAgIG9mZnNldCArPSAyO1xyXG4gICAgICBoLmV4dHJhRmllbGQgPSBzLnN1YnN0cmluZyhvZmZzZXQsIG9mZnNldCt4bGVuKTtcclxuICAgICAgb2Zmc2V0ICs9IHhsZW47XHJcbiAgICB9XHJcbiAgICBpZiAoaC5mbGFncyAmIEdaaXAuRk5BTUUpIHtcclxuICAgICAgaC5maWxlbmFtZSA9IEJpbi5DU3RyaW5nKHMsIG9mZnNldCk7XHJcbiAgICAgIG9mZnNldCArPSBoLmZpbGVuYW1lLmxlbmd0aCArIDE7XHJcbiAgICB9XHJcbiAgICBpZiAoaC5mbGFncyAmIEdaaXAuRkNPTU1FTlQpIHtcclxuICAgICAgaC5jb21tZW50ID0gQmluLkNTdHJpbmcocywgb2Zmc2V0KTtcclxuICAgICAgb2Zmc2V0ICs9IGguY29tbWVudC5sZW5ndGggKyAxO1xyXG4gICAgfVxyXG4gICAgaC5jb21wdXRlZEhlYWRlckNSQzE2ID0gQmluLkNSQzE2KHMsIDAsIG9mZnNldCwgMCk7XHJcbiAgICBpZiAoaC5mbGFncyAmIEdaaXAuRkhDUkMpIHtcclxuICAgICAgaC5oZWFkZXJDUkMxNiA9IEJpbi5VSW50MTZMRShzLCBvZmZzZXQpO1xyXG4gICAgICBpZiAoaC5jb21wdXRlZEhlYWRlckNSQzE2ICE9IG51bGwgJiYgaC5oZWFkZXJDUkMxNiAhPSBoLmNvbXB1dGVkSGVhZGVyQ1JDMTYpXHJcbiAgICAgICAgdGhyb3coXCJIZWFkZXIgQ1JDMTYgY2hlY2sgZmFpbGVkXCIpO1xyXG4gICAgICBvZmZzZXQgKz0gMjtcclxuICAgIH1cclxuICAgIGgub2Zmc2V0ID0gb2Zmc2V0O1xyXG4gICAgaC5kYXRhID0gW107XHJcbiAgICBoLm91dHB1dFNpemUgPSAwO1xyXG4gICAgaC5pbmZsYXRlciA9IG5ldyBJbmZsYXRlcigpO1xyXG4gICAgaC5pbmZsYXRlci5zdGFydF9pbmZsYXRlKGgpO1xyXG4gICAgcmV0dXJuIGg7XHJcbiAgfSxcclxuICBcclxuICBwYXJzZUJvZHkgOiBmdW5jdGlvbihzLCBoLCBvbnN0cmVhbSkge1xyXG4gICAgaC5pbmZsYXRlci5jb250aW51ZV9pbmZsYXRlKHMsIGgsIG9uc3RyZWFtKTtcclxuICAgIHJldHVybiBoO1xyXG4gIH0sXHJcbiAgXHJcbiAgcGFyc2VBbGxCb2R5IDogZnVuY3Rpb24ocywgaCwgb25zdHJlYW0pIHtcclxuICAgIGguaW5mbGF0ZXIuZmluYWxfaW5mbGF0ZShzLCBoLCBvbnN0cmVhbSk7XHJcbiAgICByZXR1cm4gaDtcclxuICB9LFxyXG4gIFxyXG4gIHBhcnNlRm9vdGVyIDogZnVuY3Rpb24ocywgaCkge1xyXG4gICAgaC5DUkMzMiA9IEJpbi5VSW50MzJMRShzLCBzLmxlbmd0aC04KTtcclxuICAgIGlmIChoLmNvbXB1dGVkQ1JDMzIgJiYgaC5jb21wdXRlZENSQzMyICE9IGguQ1JDMzIpXHJcbiAgICAgIHRocm93KFwiRGF0YSBDUkMzMiBjaGVjayBmYWlsZWRcIik7XHJcbiAgICBoLmlucHV0U2l6ZSA9IEJpbi5VSW50MzJMRShzLCBzLmxlbmd0aC00KTtcclxuICAgIGlmIChoLmRhdGEgIT0gbnVsbCAmJiBoLmlucHV0U2l6ZSAhPSAoaC5vdXRwdXRTaXplICUgMHhmZmZmZmZmZikpXHJcbiAgICAgIHRocm93KFwiRGF0YSBsZW5ndGggY2hlY2sgZmFpbGVkXCIpO1xyXG4gICAgcmV0dXJuIGg7XHJcbiAgfVxyXG59O1xyXG5cclxuLyogICBcclxuPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBcclxuQ3JjMzIgaXMgYSBKYXZhU2NyaXB0IGZ1bmN0aW9uIGZvciBjb21wdXRpbmcgdGhlIENSQzMyIG9mIGEgc3RyaW5nIFxyXG4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uIFxyXG4gXHJcblZlcnNpb246IDEuMiAtIDIwMDYvMTEgLSBodHRwOi8vbm90ZXNsb2cuY29tL2NhdGVnb3J5L2phdmFzY3JpcHQvIFxyXG4gXHJcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXHJcbkNvcHlyaWdodCAoYykgMjAwNiBBbmRyZWEgRXJjb2xpbm8gXHJcbmh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwIFxyXG49PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IFxyXG4qLyBcclxuIFxyXG4oZnVuY3Rpb24oKSB7IFxyXG4gICAgdmFyIHRhYmxlID0gXCIwMDAwMDAwMCA3NzA3MzA5NiBFRTBFNjEyQyA5OTA5NTFCQSAwNzZEQzQxOSA3MDZBRjQ4RiBFOTYzQTUzNSA5RTY0OTVBMyAwRURCODgzMiA3OURDQjhBNCBFMEQ1RTkxRSA5N0QyRDk4OCAwOUI2NEMyQiA3RUIxN0NCRCBFN0I4MkQwNyA5MEJGMUQ5MSAxREI3MTA2NCA2QUIwMjBGMiBGM0I5NzE0OCA4NEJFNDFERSAxQURBRDQ3RCA2RERERTRFQiBGNEQ0QjU1MSA4M0QzODVDNyAxMzZDOTg1NiA2NDZCQThDMCBGRDYyRjk3QSA4QTY1QzlFQyAxNDAxNUM0RiA2MzA2NkNEOSBGQTBGM0Q2MyA4RDA4MERGNSAzQjZFMjBDOCA0QzY5MTA1RSBENTYwNDFFNCBBMjY3NzE3MiAzQzAzRTREMSA0QjA0RDQ0NyBEMjBEODVGRCBBNTBBQjU2QiAzNUI1QThGQSA0MkIyOTg2QyBEQkJCQzlENiBBQ0JDRjk0MCAzMkQ4NkNFMyA0NURGNUM3NSBEQ0Q2MERDRiBBQkQxM0Q1OSAyNkQ5MzBBQyA1MURFMDAzQSBDOEQ3NTE4MCBCRkQwNjExNiAyMUI0RjRCNSA1NkIzQzQyMyBDRkJBOTU5OSBCOEJEQTUwRiAyODAyQjg5RSA1RjA1ODgwOCBDNjBDRDlCMiBCMTBCRTkyNCAyRjZGN0M4NyA1ODY4NEMxMSBDMTYxMURBQiBCNjY2MkQzRCA3NkRDNDE5MCAwMURCNzEwNiA5OEQyMjBCQyBFRkQ1MTAyQSA3MUIxODU4OSAwNkI2QjUxRiA5RkJGRTRBNSBFOEI4RDQzMyA3ODA3QzlBMiAwRjAwRjkzNCA5NjA5QTg4RSBFMTBFOTgxOCA3RjZBMERCQiAwODZEM0QyRCA5MTY0NkM5NyBFNjYzNUMwMSA2QjZCNTFGNCAxQzZDNjE2MiA4NTY1MzBEOCBGMjYyMDA0RSA2QzA2OTVFRCAxQjAxQTU3QiA4MjA4RjRDMSBGNTBGQzQ1NyA2NUIwRDlDNiAxMkI3RTk1MCA4QkJFQjhFQSBGQ0I5ODg3QyA2MkREMURERiAxNURBMkQ0OSA4Q0QzN0NGMyBGQkQ0NEM2NSA0REIyNjE1OCAzQUI1NTFDRSBBM0JDMDA3NCBENEJCMzBFMiA0QURGQTU0MSAzREQ4OTVENyBBNEQxQzQ2RCBEM0Q2RjRGQiA0MzY5RTk2QSAzNDZFRDlGQyBBRDY3ODg0NiBEQTYwQjhEMCA0NDA0MkQ3MyAzMzAzMURFNSBBQTBBNEM1RiBERDBEN0NDOSA1MDA1NzEzQyAyNzAyNDFBQSBCRTBCMTAxMCBDOTBDMjA4NiA1NzY4QjUyNSAyMDZGODVCMyBCOTY2RDQwOSBDRTYxRTQ5RiA1RURFRjkwRSAyOUQ5Qzk5OCBCMEQwOTgyMiBDN0Q3QThCNCA1OUIzM0QxNyAyRUI0MEQ4MSBCN0JENUMzQiBDMEJBNkNBRCBFREI4ODMyMCA5QUJGQjNCNiAwM0I2RTIwQyA3NEIxRDI5QSBFQUQ1NDczOSA5REQyNzdBRiAwNERCMjYxNSA3M0RDMTY4MyBFMzYzMEIxMiA5NDY0M0I4NCAwRDZENkEzRSA3QTZBNUFBOCBFNDBFQ0YwQiA5MzA5RkY5RCAwQTAwQUUyNyA3RDA3OUVCMSBGMDBGOTM0NCA4NzA4QTNEMiAxRTAxRjI2OCA2OTA2QzJGRSBGNzYyNTc1RCA4MDY1NjdDQiAxOTZDMzY3MSA2RTZCMDZFNyBGRUQ0MUI3NiA4OUQzMkJFMCAxMERBN0E1QSA2N0RENEFDQyBGOUI5REY2RiA4RUJFRUZGOSAxN0I3QkU0MyA2MEIwOEVENSBENkQ2QTNFOCBBMUQxOTM3RSAzOEQ4QzJDNCA0RkRGRjI1MiBEMUJCNjdGMSBBNkJDNTc2NyAzRkI1MDZERCA0OEIyMzY0QiBEODBEMkJEQSBBRjBBMUI0QyAzNjAzNEFGNiA0MTA0N0E2MCBERjYwRUZDMyBBODY3REY1NSAzMTZFOEVFRiA0NjY5QkU3OSBDQjYxQjM4QyBCQzY2ODMxQSAyNTZGRDJBMCA1MjY4RTIzNiBDQzBDNzc5NSBCQjBCNDcwMyAyMjAyMTZCOSA1NTA1MjYyRiBDNUJBM0JCRSBCMkJEMEIyOCAyQkI0NUE5MiA1Q0IzNkEwNCBDMkQ3RkZBNyBCNUQwQ0YzMSAyQ0Q5OUU4QiA1QkRFQUUxRCA5QjY0QzJCMCBFQzYzRjIyNiA3NTZBQTM5QyAwMjZEOTMwQSA5QzA5MDZBOSBFQjBFMzYzRiA3MjA3Njc4NSAwNTAwNTcxMyA5NUJGNEE4MiBFMkI4N0ExNCA3QkIxMkJBRSAwQ0I2MUIzOCA5MkQyOEU5QiBFNUQ1QkUwRCA3Q0RDRUZCNyAwQkRCREYyMSA4NkQzRDJENCBGMUQ0RTI0MiA2OEREQjNGOCAxRkRBODM2RSA4MUJFMTZDRCBGNkI5MjY1QiA2RkIwNzdFMSAxOEI3NDc3NyA4ODA4NUFFNiBGRjBGNkE3MCA2NjA2M0JDQSAxMTAxMEI1QyA4RjY1OUVGRiBGODYyQUU2OSA2MTZCRkZEMyAxNjZDQ0Y0NSBBMDBBRTI3OCBENzBERDJFRSA0RTA0ODM1NCAzOTAzQjNDMiBBNzY3MjY2MSBEMDYwMTZGNyA0OTY5NDc0RCAzRTZFNzdEQiBBRUQxNkE0QSBEOUQ2NUFEQyA0MERGMEI2NiAzN0Q4M0JGMCBBOUJDQUU1MyBERUJCOUVDNSA0N0IyQ0Y3RiAzMEI1RkZFOSBCREJERjIxQyBDQUJBQzI4QSA1M0IzOTMzMCAyNEI0QTNBNiBCQUQwMzYwNSBDREQ3MDY5MyA1NERFNTcyOSAyM0Q5NjdCRiBCMzY2N0EyRSBDNDYxNEFCOCA1RDY4MUIwMiAyQTZGMkI5NCBCNDBCQkUzNyBDMzBDOEVBMSA1QTA1REYxQiAyRDAyRUY4RFwiO1xyXG4gICAgdmFyIGludFRhYmxlID0gW107XHJcbiAgICBmb3IgKHZhciBpPTA7IGkgPCB0YWJsZS5sZW5ndGggLyA5OyBpKyspIHtcclxuICAgICAgaW50VGFibGUucHVzaChwYXJzZUludCh0YWJsZS5zdWJzdHIoIGkqOSwgOCksIDE2KSk7XHJcbiAgICB9XHJcbiAgICAvKiBOdW1iZXIgKi8gXHJcbiAgICBjcmMzMiA9IGZ1bmN0aW9uKCAvKiBTdHJpbmcgKi8gc3RyLCBzdGFydCwgbGVuZ3RoLCAvKiBOdW1iZXIgKi8gY3JjICkgeyBcclxuICAgICAgICBjcmMgPSBjcmMgXiAoLTEpO1xyXG4gICAgICAgIHZhciBlbmQgPSBNYXRoLm1pbihzdHIubGVuZ3RoLCBzdGFydCArIGxlbmd0aCk7XHJcbiAgICAgICAgZm9yKCB2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKysgKSB7XHJcbiAgICAgICAgICAgIHZhciBuID0gKCBjcmMgXiBzdHIuY2hhckNvZGVBdCggaSApICkgJiAweEZGOyBcclxuICAgICAgICAgICAgY3JjID0gKCBjcmMgPj4+IDggKSBeIGludFRhYmxlW25dO1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgcmV0dXJuIGNyYyBeICgtMSk7IFxyXG4gICAgfTsgXHJcbn0pKCk7XHJcblxyXG4vKlxyXG4gKiAkSWQ6IHJhd2luZmxhdGUuanMsdiAwLjIgMjAwOS8wMy8wMSAxODozMjoyNCBkYW5rb2dhaSBFeHAgJFxyXG4gKlxyXG4gKiBvcmlnaW5hbDpcclxuICogaHR0cDovL3d3dy5vbmljb3MuY29tL3N0YWZmL2l6L2FtdXNlL2phdmFzY3JpcHQvZXhwZXJ0L2luZmxhdGUudHh0XHJcbiAqL1xyXG5cclxuSW5mbGF0ZXIgPSAoZnVuY3Rpb24oKXtcclxuXHJcbi8qIENvcHlyaWdodCAoQykgMTk5OSBNYXNhbmFvIEl6dW1vIDxpekBvbmljb3MuY28uanA+XHJcbiAqIFZlcnNpb246IDEuMC4wLjFcclxuICogTGFzdE1vZGlmaWVkOiBEZWMgMjUgMTk5OVxyXG4gKi9cclxuXHJcbi8qIEludGVyZmFjZTpcclxuICogZGF0YSA9IHppcF9pbmZsYXRlKHNyYyk7XHJcbiAqL1xyXG5cclxuLyogY29uc3RhbnQgcGFyYW1ldGVycyAqL1xyXG52YXIgemlwX1dTSVpFID0gMzI3Njg7ICAgICAgICAvLyBTbGlkaW5nIFdpbmRvdyBzaXplXHJcbnZhciB6aXBfU1RPUkVEX0JMT0NLID0gMDtcclxudmFyIHppcF9TVEFUSUNfVFJFRVMgPSAxO1xyXG52YXIgemlwX0RZTl9UUkVFUyAgPSAyO1xyXG5cclxuLyogZm9yIGluZmxhdGUgKi9cclxudmFyIHppcF9sYml0cyA9IDk7ICAgICAgICAgLy8gYml0cyBpbiBiYXNlIGxpdGVyYWwvbGVuZ3RoIGxvb2t1cCB0YWJsZVxyXG52YXIgemlwX2RiaXRzID0gNjsgICAgICAgICAvLyBiaXRzIGluIGJhc2UgZGlzdGFuY2UgbG9va3VwIHRhYmxlXHJcbnZhciB6aXBfSU5CVUZTSVogPSAzMjc2ODsgICAgLy8gSW5wdXQgYnVmZmVyIHNpemVcclxudmFyIHppcF9JTkJVRl9FWFRSQSA9IDY0OyAgICAvLyBFeHRyYSBidWZmZXJcclxuXHJcbi8qIHZhcmlhYmxlcyAoaW5mbGF0ZSkgKi9cclxudmFyIHppcF9zbGlkZTtcclxudmFyIHppcF93cDsgICAgICAgICAgICAvLyBjdXJyZW50IHBvc2l0aW9uIGluIHNsaWRlXHJcbnZhciB6aXBfZml4ZWRfdGwgPSBudWxsOyAgICAvLyBpbmZsYXRlIHN0YXRpY1xyXG52YXIgemlwX2ZpeGVkX3RkOyAgICAgICAgLy8gaW5mbGF0ZSBzdGF0aWNcclxudmFyIHppcF9maXhlZF9ibCwgZml4ZWRfYmQ7ICAgIC8vIGluZmxhdGUgc3RhdGljXHJcbnZhciB6aXBfYml0X2J1ZjsgICAgICAgIC8vIGJpdCBidWZmZXJcclxudmFyIHppcF9iaXRfbGVuOyAgICAgICAgLy8gYml0cyBpbiBiaXQgYnVmZmVyXHJcbnZhciB6aXBfbWV0aG9kO1xyXG52YXIgemlwX2VvZjtcclxudmFyIHppcF9jb3B5X2xlbmc7XHJcbnZhciB6aXBfY29weV9kaXN0O1xyXG52YXIgemlwX3RsLCB6aXBfdGQ7ICAgIC8vIGxpdGVyYWwvbGVuZ3RoIGFuZCBkaXN0YW5jZSBkZWNvZGVyIHRhYmxlc1xyXG52YXIgemlwX2JsLCB6aXBfYmQ7ICAgIC8vIG51bWJlciBvZiBiaXRzIGRlY29kZWQgYnkgdGwgYW5kIHRkXHJcblxyXG52YXIgemlwX2luZmxhdGVfZGF0YTtcclxudmFyIHppcF9pbmZsYXRlX3BvcztcclxuXHJcblxyXG4vKiBjb25zdGFudCB0YWJsZXMgKGluZmxhdGUpICovXHJcbnZhciB6aXBfTUFTS19CSVRTID0gbmV3IEFycmF5KFxyXG4gIDB4MDAwMCxcclxuICAweDAwMDEsIDB4MDAwMywgMHgwMDA3LCAweDAwMGYsIDB4MDAxZiwgMHgwMDNmLCAweDAwN2YsIDB4MDBmZixcclxuICAweDAxZmYsIDB4MDNmZiwgMHgwN2ZmLCAweDBmZmYsIDB4MWZmZiwgMHgzZmZmLCAweDdmZmYsIDB4ZmZmZik7XHJcbi8vIFRhYmxlcyBmb3IgZGVmbGF0ZSBmcm9tIFBLWklQJ3MgYXBwbm90ZS50eHQuXHJcbnZhciB6aXBfY3BsZW5zID0gbmV3IEFycmF5KCAvLyBDb3B5IGxlbmd0aHMgZm9yIGxpdGVyYWwgY29kZXMgMjU3Li4yODVcclxuICAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMCwgMTEsIDEzLCAxNSwgMTcsIDE5LCAyMywgMjcsIDMxLFxyXG4gIDM1LCA0MywgNTEsIDU5LCA2NywgODMsIDk5LCAxMTUsIDEzMSwgMTYzLCAxOTUsIDIyNywgMjU4LCAwLCAwKTtcclxuLyogbm90ZTogc2VlIG5vdGUgIzEzIGFib3ZlIGFib3V0IHRoZSAyNTggaW4gdGhpcyBsaXN0LiAqL1xyXG52YXIgemlwX2NwbGV4dCA9IG5ldyBBcnJheSggLy8gRXh0cmEgYml0cyBmb3IgbGl0ZXJhbCBjb2RlcyAyNTcuLjI4NVxyXG4gIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDEsIDEsIDEsIDIsIDIsIDIsIDIsXHJcbiAgMywgMywgMywgMywgNCwgNCwgNCwgNCwgNSwgNSwgNSwgNSwgMCwgOTksIDk5KTsgLy8gOTk9PWludmFsaWRcclxudmFyIHppcF9jcGRpc3QgPSBuZXcgQXJyYXkoIC8vIENvcHkgb2Zmc2V0cyBmb3IgZGlzdGFuY2UgY29kZXMgMC4uMjlcclxuICAxLCAyLCAzLCA0LCA1LCA3LCA5LCAxMywgMTcsIDI1LCAzMywgNDksIDY1LCA5NywgMTI5LCAxOTMsXHJcbiAgMjU3LCAzODUsIDUxMywgNzY5LCAxMDI1LCAxNTM3LCAyMDQ5LCAzMDczLCA0MDk3LCA2MTQ1LFxyXG4gIDgxOTMsIDEyMjg5LCAxNjM4NSwgMjQ1NzcpO1xyXG52YXIgemlwX2NwZGV4dCA9IG5ldyBBcnJheSggLy8gRXh0cmEgYml0cyBmb3IgZGlzdGFuY2UgY29kZXNcclxuICAwLCAwLCAwLCAwLCAxLCAxLCAyLCAyLCAzLCAzLCA0LCA0LCA1LCA1LCA2LCA2LFxyXG4gIDcsIDcsIDgsIDgsIDksIDksIDEwLCAxMCwgMTEsIDExLFxyXG4gIDEyLCAxMiwgMTMsIDEzKTtcclxudmFyIHppcF9ib3JkZXIgPSBuZXcgQXJyYXkoICAvLyBPcmRlciBvZiB0aGUgYml0IGxlbmd0aCBjb2RlIGxlbmd0aHNcclxuICAxNiwgMTcsIDE4LCAwLCA4LCA3LCA5LCA2LCAxMCwgNSwgMTEsIDQsIDEyLCAzLCAxMywgMiwgMTQsIDEsIDE1KTtcclxuLyogb2JqZWN0cyAoaW5mbGF0ZSkgKi9cclxuXHJcbnZhciB6aXBfSHVmdExpc3QgPSBmdW5jdGlvbigpIHtcclxuICB0aGlzLm5leHQgPSBudWxsO1xyXG4gIHRoaXMubGlzdCA9IG51bGw7XHJcbn07XHJcblxyXG52YXIgemlwX0h1ZnROb2RlID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy5lID0gMDsgLy8gbnVtYmVyIG9mIGV4dHJhIGJpdHMgb3Igb3BlcmF0aW9uXHJcbiAgdGhpcy5iID0gMDsgLy8gbnVtYmVyIG9mIGJpdHMgaW4gdGhpcyBjb2RlIG9yIHN1YmNvZGVcclxuXHJcbiAgLy8gdW5pb25cclxuICB0aGlzLm4gPSAwOyAvLyBsaXRlcmFsLCBsZW5ndGggYmFzZSwgb3IgZGlzdGFuY2UgYmFzZVxyXG4gIHRoaXMudCA9IG51bGw7IC8vICh6aXBfSHVmdE5vZGUpIHBvaW50ZXIgdG8gbmV4dCBsZXZlbCBvZiB0YWJsZVxyXG59O1xyXG5cclxudmFyIHppcF9IdWZ0QnVpbGQgPSBmdW5jdGlvbihiLCAgICAvLyBjb2RlIGxlbmd0aHMgaW4gYml0cyAoYWxsIGFzc3VtZWQgPD0gQk1BWClcclxuICAgICAgICAgICAgIG4sICAgIC8vIG51bWJlciBvZiBjb2RlcyAoYXNzdW1lZCA8PSBOX01BWClcclxuICAgICAgICAgICAgIHMsICAgIC8vIG51bWJlciBvZiBzaW1wbGUtdmFsdWVkIGNvZGVzICgwLi5zLTEpXHJcbiAgICAgICAgICAgICBkLCAgICAvLyBsaXN0IG9mIGJhc2UgdmFsdWVzIGZvciBub24tc2ltcGxlIGNvZGVzXHJcbiAgICAgICAgICAgICBlLCAgICAvLyBsaXN0IG9mIGV4dHJhIGJpdHMgZm9yIG5vbi1zaW1wbGUgY29kZXNcclxuICAgICAgICAgICAgIG1tICAgIC8vIG1heGltdW0gbG9va3VwIGJpdHNcclxuICAgICAgICAgICApIHtcclxuICB0aGlzLkJNQVggPSAxNjsgICAvLyBtYXhpbXVtIGJpdCBsZW5ndGggb2YgYW55IGNvZGVcclxuICB0aGlzLk5fTUFYID0gMjg4OyAvLyBtYXhpbXVtIG51bWJlciBvZiBjb2RlcyBpbiBhbnkgc2V0XHJcbiAgdGhpcy5zdGF0dXMgPSAwOyAgICAvLyAwOiBzdWNjZXNzLCAxOiBpbmNvbXBsZXRlIHRhYmxlLCAyOiBiYWQgaW5wdXRcclxuICB0aGlzLnJvb3QgPSBudWxsOyAgICAvLyAoemlwX0h1ZnRMaXN0KSBzdGFydGluZyB0YWJsZVxyXG4gIHRoaXMubSA9IDA7ICAgICAgICAvLyBtYXhpbXVtIGxvb2t1cCBiaXRzLCByZXR1cm5zIGFjdHVhbFxyXG5cclxuLyogR2l2ZW4gYSBsaXN0IG9mIGNvZGUgbGVuZ3RocyBhbmQgYSBtYXhpbXVtIHRhYmxlIHNpemUsIG1ha2UgYSBzZXQgb2ZcclxuICAgdGFibGVzIHRvIGRlY29kZSB0aGF0IHNldCBvZiBjb2Rlcy4gICAgUmV0dXJuIHplcm8gb24gc3VjY2Vzcywgb25lIGlmXHJcbiAgIHRoZSBnaXZlbiBjb2RlIHNldCBpcyBpbmNvbXBsZXRlICh0aGUgdGFibGVzIGFyZSBzdGlsbCBidWlsdCBpbiB0aGlzXHJcbiAgIGNhc2UpLCB0d28gaWYgdGhlIGlucHV0IGlzIGludmFsaWQgKGFsbCB6ZXJvIGxlbmd0aCBjb2RlcyBvciBhblxyXG4gICBvdmVyc3Vic2NyaWJlZCBzZXQgb2YgbGVuZ3RocyksIGFuZCB0aHJlZSBpZiBub3QgZW5vdWdoIG1lbW9yeS5cclxuICAgVGhlIGNvZGUgd2l0aCB2YWx1ZSAyNTYgaXMgc3BlY2lhbCwgYW5kIHRoZSB0YWJsZXMgYXJlIGNvbnN0cnVjdGVkXHJcbiAgIHNvIHRoYXQgbm8gYml0cyBiZXlvbmQgdGhhdCBjb2RlIGFyZSBmZXRjaGVkIHdoZW4gdGhhdCBjb2RlIGlzXHJcbiAgIGRlY29kZWQuICovXHJcbiAge1xyXG4gICAgdmFyIGE7ICAgICAgICAgICAgLy8gY291bnRlciBmb3IgY29kZXMgb2YgbGVuZ3RoIGtcclxuICAgIHZhciBjID0gbmV3IEFycmF5KHRoaXMuQk1BWCsxKTsgICAgLy8gYml0IGxlbmd0aCBjb3VudCB0YWJsZVxyXG4gICAgdmFyIGVsOyAgICAgICAgICAgIC8vIGxlbmd0aCBvZiBFT0IgY29kZSAodmFsdWUgMjU2KVxyXG4gICAgdmFyIGY7ICAgICAgICAgICAgLy8gaSByZXBlYXRzIGluIHRhYmxlIGV2ZXJ5IGYgZW50cmllc1xyXG4gICAgdmFyIGc7ICAgICAgICAgICAgLy8gbWF4aW11bSBjb2RlIGxlbmd0aFxyXG4gICAgdmFyIGg7ICAgICAgICAgICAgLy8gdGFibGUgbGV2ZWxcclxuICAgIHZhciBpOyAgICAgICAgICAgIC8vIGNvdW50ZXIsIGN1cnJlbnQgY29kZVxyXG4gICAgdmFyIGo7ICAgICAgICAgICAgLy8gY291bnRlclxyXG4gICAgdmFyIGs7ICAgICAgICAgICAgLy8gbnVtYmVyIG9mIGJpdHMgaW4gY3VycmVudCBjb2RlXHJcbiAgICB2YXIgbHggPSBuZXcgQXJyYXkodGhpcy5CTUFYKzEpOyAgICAvLyBzdGFjayBvZiBiaXRzIHBlciB0YWJsZVxyXG4gICAgdmFyIHA7ICAgICAgICAgICAgLy8gcG9pbnRlciBpbnRvIGNbXSwgYltdLCBvciB2W11cclxuICAgIHZhciBwaWR4OyAgICAgICAgLy8gaW5kZXggb2YgcFxyXG4gICAgdmFyIHE7ICAgICAgICAgICAgLy8gKHppcF9IdWZ0Tm9kZSkgcG9pbnRzIHRvIGN1cnJlbnQgdGFibGVcclxuICAgIHZhciByID0gbmV3IHppcF9IdWZ0Tm9kZSgpOyAvLyB0YWJsZSBlbnRyeSBmb3Igc3RydWN0dXJlIGFzc2lnbm1lbnRcclxuICAgIHZhciB1ID0gbmV3IEFycmF5KHRoaXMuQk1BWCk7IC8vIHppcF9IdWZ0Tm9kZVtCTUFYXVtdICB0YWJsZSBzdGFja1xyXG4gICAgdmFyIHYgPSBuZXcgQXJyYXkodGhpcy5OX01BWCk7IC8vIHZhbHVlcyBpbiBvcmRlciBvZiBiaXQgbGVuZ3RoXHJcbiAgICB2YXIgdztcclxuICAgIHZhciB4ID0gbmV3IEFycmF5KHRoaXMuQk1BWCsxKTsvLyBiaXQgb2Zmc2V0cywgdGhlbiBjb2RlIHN0YWNrXHJcbiAgICB2YXIgeHA7ICAgICAgICAgICAgLy8gcG9pbnRlciBpbnRvIHggb3IgY1xyXG4gICAgdmFyIHk7ICAgICAgICAgICAgLy8gbnVtYmVyIG9mIGR1bW15IGNvZGVzIGFkZGVkXHJcbiAgICB2YXIgejsgICAgICAgICAgICAvLyBudW1iZXIgb2YgZW50cmllcyBpbiBjdXJyZW50IHRhYmxlXHJcbiAgICB2YXIgbztcclxuICAgIHZhciB0YWlsOyAgICAgICAgLy8gKHppcF9IdWZ0TGlzdClcclxuXHJcbiAgICB0YWlsID0gdGhpcy5yb290ID0gbnVsbDtcclxuICAgIGZvcihpID0gMDsgaSA8IGMubGVuZ3RoOyBpKyspXHJcbiAgICAgIGNbaV0gPSAwO1xyXG4gICAgZm9yKGkgPSAwOyBpIDwgbHgubGVuZ3RoOyBpKyspXHJcbiAgICAgIGx4W2ldID0gMDtcclxuICAgIGZvcihpID0gMDsgaSA8IHUubGVuZ3RoOyBpKyspXHJcbiAgICAgIHVbaV0gPSBudWxsO1xyXG4gICAgZm9yKGkgPSAwOyBpIDwgdi5sZW5ndGg7IGkrKylcclxuICAgICAgdltpXSA9IDA7XHJcbiAgICBmb3IoaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSsrKVxyXG4gICAgICB4W2ldID0gMDtcclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBjb3VudHMgZm9yIGVhY2ggYml0IGxlbmd0aFxyXG4gICAgZWwgPSBuID4gMjU2ID8gYlsyNTZdIDogdGhpcy5CTUFYOyAvLyBzZXQgbGVuZ3RoIG9mIEVPQiBjb2RlLCBpZiBhbnlcclxuICAgIHAgPSBiOyBwaWR4ID0gMDtcclxuICAgIGkgPSBuO1xyXG4gICAgZG8ge1xyXG4gICAgICBjW3BbcGlkeF1dKys7ICAgIC8vIGFzc3VtZSBhbGwgZW50cmllcyA8PSBCTUFYXHJcbiAgICAgIHBpZHgrKztcclxuICAgIH0gd2hpbGUoLS1pID4gMCk7XHJcbiAgICBpZihjWzBdID09IG4pIHsgICAgLy8gbnVsbCBpbnB1dC0tYWxsIHplcm8gbGVuZ3RoIGNvZGVzXHJcbiAgICAgIHRoaXMucm9vdCA9IG51bGw7XHJcbiAgICAgIHRoaXMubSA9IDA7XHJcbiAgICAgIHRoaXMuc3RhdHVzID0gMDtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZpbmQgbWluaW11bSBhbmQgbWF4aW11bSBsZW5ndGgsIGJvdW5kICptIGJ5IHRob3NlXHJcbiAgICBmb3IoaiA9IDE7IGogPD0gdGhpcy5CTUFYOyBqKyspXHJcbiAgICAgIGlmKGNbal0gIT0gMClcclxuICAgICAgICBicmVhaztcclxuICAgIGsgPSBqOyAgICAgICAgICAgIC8vIG1pbmltdW0gY29kZSBsZW5ndGhcclxuICAgIGlmKG1tIDwgailcclxuICAgICAgbW0gPSBqO1xyXG4gICAgZm9yKGkgPSB0aGlzLkJNQVg7IGkgIT0gMDsgaS0tKVxyXG4gICAgICBpZihjW2ldICE9IDApXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICBnID0gaTsgICAgICAgICAgICAvLyBtYXhpbXVtIGNvZGUgbGVuZ3RoXHJcbiAgICBpZihtbSA+IGkpXHJcbiAgICAgIG1tID0gaTtcclxuXHJcbiAgICAvLyBBZGp1c3QgbGFzdCBsZW5ndGggY291bnQgdG8gZmlsbCBvdXQgY29kZXMsIGlmIG5lZWRlZFxyXG4gICAgZm9yKHkgPSAxIDw8IGo7IGogPCBpOyBqKyssIHkgPDw9IDEpXHJcbiAgICAgIGlmKCh5IC09IGNbal0pIDwgMCkge1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gMjsgICAgLy8gYmFkIGlucHV0OiBtb3JlIGNvZGVzIHRoYW4gYml0c1xyXG4gICAgICAgIHRoaXMubSA9IG1tO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgaWYoKHkgLT0gY1tpXSkgPCAwKSB7XHJcbiAgICAgIHRoaXMuc3RhdHVzID0gMjtcclxuICAgICAgdGhpcy5tID0gbW07XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNbaV0gKz0geTtcclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBzdGFydGluZyBvZmZzZXRzIGludG8gdGhlIHZhbHVlIHRhYmxlIGZvciBlYWNoIGxlbmd0aFxyXG4gICAgeFsxXSA9IGogPSAwO1xyXG4gICAgcCA9IGM7XHJcbiAgICBwaWR4ID0gMTtcclxuICAgIHhwID0gMjtcclxuICAgIHdoaWxlKC0taSA+IDApICAgICAgICAvLyBub3RlIHRoYXQgaSA9PSBnIGZyb20gYWJvdmVcclxuICAgICAgeFt4cCsrXSA9IChqICs9IHBbcGlkeCsrXSk7XHJcblxyXG4gICAgLy8gTWFrZSBhIHRhYmxlIG9mIHZhbHVlcyBpbiBvcmRlciBvZiBiaXQgbGVuZ3Roc1xyXG4gICAgcCA9IGI7IHBpZHggPSAwO1xyXG4gICAgaSA9IDA7XHJcbiAgICBkbyB7XHJcbiAgICAgIGlmKChqID0gcFtwaWR4KytdKSAhPSAwKVxyXG4gICAgICAgIHZbeFtqXSsrXSA9IGk7XHJcbiAgICB9IHdoaWxlKCsraSA8IG4pO1xyXG4gICAgbiA9IHhbZ107ICAgICAgICAgICAgLy8gc2V0IG4gdG8gbGVuZ3RoIG9mIHZcclxuXHJcbiAgICAvLyBHZW5lcmF0ZSB0aGUgSHVmZm1hbiBjb2RlcyBhbmQgZm9yIGVhY2gsIG1ha2UgdGhlIHRhYmxlIGVudHJpZXNcclxuICAgIHhbMF0gPSBpID0gMDsgICAgICAgIC8vIGZpcnN0IEh1ZmZtYW4gY29kZSBpcyB6ZXJvXHJcbiAgICBwID0gdjsgcGlkeCA9IDA7ICAgICAgICAvLyBncmFiIHZhbHVlcyBpbiBiaXQgb3JkZXJcclxuICAgIGggPSAtMTsgICAgICAgICAgICAvLyBubyB0YWJsZXMgeWV0LS1sZXZlbCAtMVxyXG4gICAgdyA9IGx4WzBdID0gMDsgICAgICAgIC8vIG5vIGJpdHMgZGVjb2RlZCB5ZXRcclxuICAgIHEgPSBudWxsOyAgICAgICAgICAgIC8vIGRpdHRvXHJcbiAgICB6ID0gMDsgICAgICAgICAgICAvLyBkaXR0b1xyXG5cclxuICAgIC8vIGdvIHRocm91Z2ggdGhlIGJpdCBsZW5ndGhzIChrIGFscmVhZHkgaXMgYml0cyBpbiBzaG9ydGVzdCBjb2RlKVxyXG4gICAgZm9yKDsgayA8PSBnOyBrKyspIHtcclxuICAgICAgYSA9IGNba107XHJcbiAgICAgIHdoaWxlKGEtLSA+IDApIHtcclxuICAgICAgICAvLyBoZXJlIGkgaXMgdGhlIEh1ZmZtYW4gY29kZSBvZiBsZW5ndGggayBiaXRzIGZvciB2YWx1ZSBwW3BpZHhdXHJcbiAgICAgICAgLy8gbWFrZSB0YWJsZXMgdXAgdG8gcmVxdWlyZWQgbGV2ZWxcclxuICAgICAgICB3aGlsZShrID4gdyArIGx4WzEgKyBoXSkge1xyXG4gICAgICAgICAgdyArPSBseFsxICsgaF07IC8vIGFkZCBiaXRzIGFscmVhZHkgZGVjb2RlZFxyXG4gICAgICAgICAgaCsrO1xyXG5cclxuICAgICAgICAgIC8vIGNvbXB1dGUgbWluaW11bSBzaXplIHRhYmxlIGxlc3MgdGhhbiBvciBlcXVhbCB0byAqbSBiaXRzXHJcbiAgICAgICAgICB6ID0gKHogPSBnIC0gdykgPiBtbSA/IG1tIDogejsgLy8gdXBwZXIgbGltaXRcclxuICAgICAgICAgIGlmKChmID0gMSA8PCAoaiA9IGsgLSB3KSkgPiBhICsgMSkgeyAvLyB0cnkgYSBrLXcgYml0IHRhYmxlXHJcbiAgICAgICAgICAgIC8vIHRvbyBmZXcgY29kZXMgZm9yIGstdyBiaXQgdGFibGVcclxuICAgICAgICAgICAgZiAtPSBhICsgMTsgICAgLy8gZGVkdWN0IGNvZGVzIGZyb20gcGF0dGVybnMgbGVmdFxyXG4gICAgICAgICAgICB4cCA9IGs7XHJcbiAgICAgICAgICAgIHdoaWxlKCsraiA8IHopIHsgLy8gdHJ5IHNtYWxsZXIgdGFibGVzIHVwIHRvIHogYml0c1xyXG4gICAgICAgICAgICAgIGlmKChmIDw8PSAxKSA8PSBjWysreHBdKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7ICAgIC8vIGVub3VnaCBjb2RlcyB0byB1c2UgdXAgaiBiaXRzXHJcbiAgICAgICAgICAgICAgZiAtPSBjW3hwXTsgICAgLy8gZWxzZSBkZWR1Y3QgY29kZXMgZnJvbSBwYXR0ZXJuc1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZih3ICsgaiA+IGVsICYmIHcgPCBlbClcclxuICAgICAgICAgICAgaiA9IGVsIC0gdzsgICAgLy8gbWFrZSBFT0IgY29kZSBlbmQgYXQgdGFibGVcclxuICAgICAgICAgIHogPSAxIDw8IGo7ICAgIC8vIHRhYmxlIGVudHJpZXMgZm9yIGotYml0IHRhYmxlXHJcbiAgICAgICAgICBseFsxICsgaF0gPSBqOyAvLyBzZXQgdGFibGUgc2l6ZSBpbiBzdGFja1xyXG5cclxuICAgICAgICAgIC8vIGFsbG9jYXRlIGFuZCBsaW5rIGluIG5ldyB0YWJsZVxyXG4gICAgICAgICAgcSA9IG5ldyBBcnJheSh6KTtcclxuICAgICAgICAgIGZvcihvID0gMDsgbyA8IHo7IG8rKykge1xyXG4gICAgICAgICAgICBxW29dID0gbmV3IHppcF9IdWZ0Tm9kZSgpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmKHRhaWwgPT0gbnVsbClcclxuICAgICAgICAgICAgdGFpbCA9IHRoaXMucm9vdCA9IG5ldyB6aXBfSHVmdExpc3QoKTtcclxuICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGFpbCA9IHRhaWwubmV4dCA9IG5ldyB6aXBfSHVmdExpc3QoKTtcclxuICAgICAgICAgIHRhaWwubmV4dCA9IG51bGw7XHJcbiAgICAgICAgICB0YWlsLmxpc3QgPSBxO1xyXG4gICAgICAgICAgdVtoXSA9IHE7ICAgIC8vIHRhYmxlIHN0YXJ0cyBhZnRlciBsaW5rXHJcblxyXG4gICAgICAgICAgLyogY29ubmVjdCB0byBsYXN0IHRhYmxlLCBpZiB0aGVyZSBpcyBvbmUgKi9cclxuICAgICAgICAgIGlmKGggPiAwKSB7XHJcbiAgICAgICAgICAgIHhbaF0gPSBpOyAgICAgICAgLy8gc2F2ZSBwYXR0ZXJuIGZvciBiYWNraW5nIHVwXHJcbiAgICAgICAgICAgIHIuYiA9IGx4W2hdOyAgICAvLyBiaXRzIHRvIGR1bXAgYmVmb3JlIHRoaXMgdGFibGVcclxuICAgICAgICAgICAgci5lID0gMTYgKyBqOyAgICAvLyBiaXRzIGluIHRoaXMgdGFibGVcclxuICAgICAgICAgICAgci50ID0gcTsgICAgICAgIC8vIHBvaW50ZXIgdG8gdGhpcyB0YWJsZVxyXG4gICAgICAgICAgICBqID0gKGkgJiAoKDEgPDwgdykgLSAxKSkgPj4gKHcgLSBseFtoXSk7XHJcbiAgICAgICAgICAgIHVbaC0xXVtqXS5lID0gci5lO1xyXG4gICAgICAgICAgICB1W2gtMV1bal0uYiA9IHIuYjtcclxuICAgICAgICAgICAgdVtoLTFdW2pdLm4gPSByLm47XHJcbiAgICAgICAgICAgIHVbaC0xXVtqXS50ID0gci50O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc2V0IHVwIHRhYmxlIGVudHJ5IGluIHJcclxuICAgICAgICByLmIgPSBrIC0gdztcclxuICAgICAgICBpZihwaWR4ID49IG4pXHJcbiAgICAgICAgICByLmUgPSA5OTsgICAgICAgIC8vIG91dCBvZiB2YWx1ZXMtLWludmFsaWQgY29kZVxyXG4gICAgICAgIGVsc2UgaWYocFtwaWR4XSA8IHMpIHtcclxuICAgICAgICAgIHIuZSA9IChwW3BpZHhdIDwgMjU2ID8gMTYgOiAxNSk7IC8vIDI1NiBpcyBlbmQtb2YtYmxvY2sgY29kZVxyXG4gICAgICAgICAgci5uID0gcFtwaWR4KytdOyAgICAvLyBzaW1wbGUgY29kZSBpcyBqdXN0IHRoZSB2YWx1ZVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByLmUgPSBlW3BbcGlkeF0gLSBzXTsgICAgLy8gbm9uLXNpbXBsZS0tbG9vayB1cCBpbiBsaXN0c1xyXG4gICAgICAgICAgci5uID0gZFtwW3BpZHgrK10gLSBzXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGZpbGwgY29kZS1saWtlIGVudHJpZXMgd2l0aCByIC8vXHJcbiAgICAgICAgZiA9IDEgPDwgKGsgLSB3KTtcclxuICAgICAgICBmb3IoaiA9IGkgPj4gdzsgaiA8IHo7IGogKz0gZikge1xyXG4gICAgICAgICAgcVtqXS5lID0gci5lO1xyXG4gICAgICAgICAgcVtqXS5iID0gci5iO1xyXG4gICAgICAgICAgcVtqXS5uID0gci5uO1xyXG4gICAgICAgICAgcVtqXS50ID0gci50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gYmFja3dhcmRzIGluY3JlbWVudCB0aGUgay1iaXQgY29kZSBpXHJcbiAgICAgICAgZm9yKGogPSAxIDw8IChrIC0gMSk7IChpICYgaikgIT0gMDsgaiA+Pj0gMSlcclxuICAgICAgICAgIGkgXj0gajtcclxuICAgICAgICBpIF49IGo7XHJcblxyXG4gICAgICAgIC8vIGJhY2t1cCBvdmVyIGZpbmlzaGVkIHRhYmxlc1xyXG4gICAgICAgIHdoaWxlKChpICYgKCgxIDw8IHcpIC0gMSkpICE9IHhbaF0pIHtcclxuICAgICAgICAgIHcgLT0gbHhbaF07ICAgICAgICAvLyBkb24ndCBuZWVkIHRvIHVwZGF0ZSBxXHJcbiAgICAgICAgICBoLS07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyogcmV0dXJuIGFjdHVhbCBzaXplIG9mIGJhc2UgdGFibGUgKi9cclxuICAgIHRoaXMubSA9IGx4WzFdO1xyXG5cclxuICAgIC8qIFJldHVybiB0cnVlICgxKSBpZiB3ZSB3ZXJlIGdpdmVuIGFuIGluY29tcGxldGUgdGFibGUgKi9cclxuICAgIHRoaXMuc3RhdHVzID0gKCh5ICE9IDAgJiYgZyAhPSAxKSA/IDEgOiAwKTtcclxuICB9IC8qIGVuZCBvZiBjb25zdHJ1Y3RvciAqL1xyXG59O1xyXG5cclxuXHJcbi8qIHJvdXRpbmVzIChpbmZsYXRlKSAqL1xyXG5cclxudmFyIHppcF9HRVRfQllURSA9IGZ1bmN0aW9uKCkge1xyXG4gIGlmKHppcF9pbmZsYXRlX2RhdGEubGVuZ3RoIDw9IHppcF9pbmZsYXRlX3BvcylcclxuICAgIHJldHVybiAtMTtcclxuICByZXR1cm4gemlwX2luZmxhdGVfZGF0YS5jaGFyQ29kZUF0KHppcF9pbmZsYXRlX3BvcysrKSAmIDB4ZmY7XHJcbn07XHJcblxyXG52YXIgemlwX05FRURCSVRTID0gZnVuY3Rpb24obikge1xyXG4gIHdoaWxlKHppcF9iaXRfbGVuIDwgbikge1xyXG4gICAgemlwX2JpdF9idWYgfD0gemlwX0dFVF9CWVRFKCkgPDwgemlwX2JpdF9sZW47XHJcbiAgICB6aXBfYml0X2xlbiArPSA4O1xyXG4gIH1cclxufTtcclxuXHJcbnZhciB6aXBfR0VUQklUUyA9IGZ1bmN0aW9uKG4pIHtcclxuICByZXR1cm4gemlwX2JpdF9idWYgJiB6aXBfTUFTS19CSVRTW25dO1xyXG59O1xyXG5cclxudmFyIHppcF9EVU1QQklUUyA9IGZ1bmN0aW9uKG4pIHtcclxuICB6aXBfYml0X2J1ZiA+Pj0gbjtcclxuICB6aXBfYml0X2xlbiAtPSBuO1xyXG59O1xyXG5cclxudmFyIHppcF9pbmZsYXRlX2NvZGVzID0gZnVuY3Rpb24oYnVmZiwgb2ZmLCBzaXplKSB7XHJcbiAgLyogaW5mbGF0ZSAoZGVjb21wcmVzcykgdGhlIGNvZGVzIGluIGEgZGVmbGF0ZWQgKGNvbXByZXNzZWQpIGJsb2NrLlxyXG4gICAgIFJldHVybiBhbiBlcnJvciBjb2RlIG9yIHplcm8gaWYgaXQgYWxsIGdvZXMgb2suICovXHJcbiAgdmFyIGU7ICAgICAgICAvLyB0YWJsZSBlbnRyeSBmbGFnL251bWJlciBvZiBleHRyYSBiaXRzXHJcbiAgdmFyIHQ7ICAgICAgICAvLyAoemlwX0h1ZnROb2RlKSBwb2ludGVyIHRvIHRhYmxlIGVudHJ5XHJcbiAgdmFyIG47XHJcblxyXG4gIGlmKHNpemUgPT0gMClcclxuICAgIHJldHVybiAwO1xyXG5cclxuICAvLyBpbmZsYXRlIHRoZSBjb2RlZCBkYXRhXHJcbiAgbiA9IDA7XHJcbiAgZm9yKDs7KSB7ICAgICAgICAgICAgLy8gZG8gdW50aWwgZW5kIG9mIGJsb2NrXHJcbiAgICB6aXBfTkVFREJJVFMoemlwX2JsKTtcclxuICAgIHQgPSB6aXBfdGwubGlzdFt6aXBfR0VUQklUUyh6aXBfYmwpXTtcclxuICAgIGUgPSB0LmU7XHJcbiAgICB3aGlsZShlID4gMTYpIHtcclxuICAgICAgaWYoZSA9PSA5OSlcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgIHppcF9EVU1QQklUUyh0LmIpO1xyXG4gICAgICBlIC09IDE2O1xyXG4gICAgICB6aXBfTkVFREJJVFMoZSk7XHJcbiAgICAgIHQgPSB0LnRbemlwX0dFVEJJVFMoZSldO1xyXG4gICAgICBlID0gdC5lO1xyXG4gICAgfVxyXG4gICAgemlwX0RVTVBCSVRTKHQuYik7XHJcblxyXG4gICAgaWYoZSA9PSAxNikgeyAgICAgICAgLy8gdGhlbiBpdCdzIGEgbGl0ZXJhbFxyXG4gICAgICB6aXBfd3AgJj0gemlwX1dTSVpFIC0gMTtcclxuICAgICAgYnVmZltvZmYgKyBuKytdID0gemlwX3NsaWRlW3ppcF93cCsrXSA9IHQubjtcclxuICAgICAgaWYobiA9PSBzaXplKVxyXG4gICAgICAgIHJldHVybiBzaXplO1xyXG4gICAgICBjb250aW51ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBleGl0IGlmIGVuZCBvZiBibG9ja1xyXG4gICAgaWYoZSA9PSAxNSlcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgLy8gaXQncyBhbiBFT0Igb3IgYSBsZW5ndGhcclxuXHJcbiAgICAvLyBnZXQgbGVuZ3RoIG9mIGJsb2NrIHRvIGNvcHlcclxuICAgIHppcF9ORUVEQklUUyhlKTtcclxuICAgIHppcF9jb3B5X2xlbmcgPSB0Lm4gKyB6aXBfR0VUQklUUyhlKTtcclxuICAgIHppcF9EVU1QQklUUyhlKTtcclxuXHJcbiAgICAvLyBkZWNvZGUgZGlzdGFuY2Ugb2YgYmxvY2sgdG8gY29weVxyXG4gICAgemlwX05FRURCSVRTKHppcF9iZCk7XHJcbiAgICB0ID0gemlwX3RkLmxpc3RbemlwX0dFVEJJVFMoemlwX2JkKV07XHJcbiAgICBlID0gdC5lO1xyXG5cclxuICAgIHdoaWxlKGUgPiAxNikge1xyXG4gICAgICBpZihlID09IDk5KVxyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgemlwX0RVTVBCSVRTKHQuYik7XHJcbiAgICAgIGUgLT0gMTY7XHJcbiAgICAgIHppcF9ORUVEQklUUyhlKTtcclxuICAgICAgdCA9IHQudFt6aXBfR0VUQklUUyhlKV07XHJcbiAgICAgIGUgPSB0LmU7XHJcbiAgICB9XHJcbiAgICB6aXBfRFVNUEJJVFModC5iKTtcclxuICAgIHppcF9ORUVEQklUUyhlKTtcclxuICAgIHppcF9jb3B5X2Rpc3QgPSB6aXBfd3AgLSB0Lm4gLSB6aXBfR0VUQklUUyhlKTtcclxuICAgIHppcF9EVU1QQklUUyhlKTtcclxuXHJcbiAgICAvLyBkbyB0aGUgY29weVxyXG4gICAgd2hpbGUoemlwX2NvcHlfbGVuZyA+IDAgJiYgbiA8IHNpemUpIHtcclxuICAgICAgemlwX2NvcHlfbGVuZy0tO1xyXG4gICAgICB6aXBfY29weV9kaXN0ICY9IHppcF9XU0laRSAtIDE7XHJcbiAgICAgIHppcF93cCAmPSB6aXBfV1NJWkUgLSAxO1xyXG4gICAgICBidWZmW29mZiArIG4rK10gPSB6aXBfc2xpZGVbemlwX3dwKytdXHJcbiAgICAgICAgPSB6aXBfc2xpZGVbemlwX2NvcHlfZGlzdCsrXTtcclxuICAgIH1cclxuXHJcbiAgICBpZihuID09IHNpemUpXHJcbiAgICAgIHJldHVybiBzaXplO1xyXG4gIH1cclxuXHJcbiAgemlwX21ldGhvZCA9IC0xOyAvLyBkb25lXHJcbiAgcmV0dXJuIG47XHJcbn07XHJcblxyXG52YXIgemlwX2luZmxhdGVfc3RvcmVkID0gZnVuY3Rpb24oYnVmZiwgb2ZmLCBzaXplKSB7XHJcbiAgLyogXCJkZWNvbXByZXNzXCIgYW4gaW5mbGF0ZWQgdHlwZSAwIChzdG9yZWQpIGJsb2NrLiAqL1xyXG4gIHZhciBuO1xyXG5cclxuICAvLyBnbyB0byBieXRlIGJvdW5kYXJ5XHJcbiAgbiA9IHppcF9iaXRfbGVuICYgNztcclxuICB6aXBfRFVNUEJJVFMobik7XHJcblxyXG4gIC8vIGdldCB0aGUgbGVuZ3RoIGFuZCBpdHMgY29tcGxlbWVudFxyXG4gIHppcF9ORUVEQklUUygxNik7XHJcbiAgbiA9IHppcF9HRVRCSVRTKDE2KTtcclxuICB6aXBfRFVNUEJJVFMoMTYpO1xyXG4gIHppcF9ORUVEQklUUygxNik7XHJcbiAgaWYobiAhPSAoKH56aXBfYml0X2J1ZikgJiAweGZmZmYpKVxyXG4gICAgcmV0dXJuIC0xOyAgICAgICAgICAgIC8vIGVycm9yIGluIGNvbXByZXNzZWQgZGF0YVxyXG4gIHppcF9EVU1QQklUUygxNik7XHJcblxyXG4gIC8vIHJlYWQgYW5kIG91dHB1dCB0aGUgY29tcHJlc3NlZCBkYXRhXHJcbiAgemlwX2NvcHlfbGVuZyA9IG47XHJcblxyXG4gIG4gPSAwO1xyXG4gIHdoaWxlKHppcF9jb3B5X2xlbmcgPiAwICYmIG4gPCBzaXplKSB7XHJcbiAgICB6aXBfY29weV9sZW5nLS07XHJcbiAgICB6aXBfd3AgJj0gemlwX1dTSVpFIC0gMTtcclxuICAgIHppcF9ORUVEQklUUyg4KTtcclxuICAgIGJ1ZmZbb2ZmICsgbisrXSA9IHppcF9zbGlkZVt6aXBfd3ArK10gPVxyXG4gICAgICB6aXBfR0VUQklUUyg4KTtcclxuICAgIHppcF9EVU1QQklUUyg4KTtcclxuICB9XHJcblxyXG4gIGlmKHppcF9jb3B5X2xlbmcgPT0gMClcclxuICAgIHppcF9tZXRob2QgPSAtMTsgLy8gZG9uZVxyXG4gIHJldHVybiBuO1xyXG59O1xyXG5cclxudmFyIHppcF9pbmZsYXRlX2ZpeGVkID0gZnVuY3Rpb24oYnVmZiwgb2ZmLCBzaXplKSB7XHJcbiAgLyogZGVjb21wcmVzcyBhbiBpbmZsYXRlZCB0eXBlIDEgKGZpeGVkIEh1ZmZtYW4gY29kZXMpIGJsb2NrLiAgV2Ugc2hvdWxkXHJcbiAgICAgZWl0aGVyIHJlcGxhY2UgdGhpcyB3aXRoIGEgY3VzdG9tIGRlY29kZXIsIG9yIGF0IGxlYXN0IHByZWNvbXB1dGUgdGhlXHJcbiAgICAgSHVmZm1hbiB0YWJsZXMuICovXHJcblxyXG4gIC8vIGlmIGZpcnN0IHRpbWUsIHNldCB1cCB0YWJsZXMgZm9yIGZpeGVkIGJsb2Nrc1xyXG4gIGlmKHppcF9maXhlZF90bCA9PSBudWxsKSB7XHJcbiAgICB2YXIgaTsgICAgICAgICAgICAvLyB0ZW1wb3JhcnkgdmFyaWFibGVcclxuICAgIHZhciBsID0gbmV3IEFycmF5KDI4OCk7ICAgIC8vIGxlbmd0aCBsaXN0IGZvciBodWZ0X2J1aWxkXHJcbiAgICB2YXIgaDsgICAgLy8gemlwX0h1ZnRCdWlsZFxyXG5cclxuICAgIC8vIGxpdGVyYWwgdGFibGVcclxuICAgIGZvcihpID0gMDsgaSA8IDE0NDsgaSsrKVxyXG4gICAgICBsW2ldID0gODtcclxuICAgIGZvcig7IGkgPCAyNTY7IGkrKylcclxuICAgICAgbFtpXSA9IDk7XHJcbiAgICBmb3IoOyBpIDwgMjgwOyBpKyspXHJcbiAgICAgIGxbaV0gPSA3O1xyXG4gICAgZm9yKDsgaSA8IDI4ODsgaSsrKSAgICAvLyBtYWtlIGEgY29tcGxldGUsIGJ1dCB3cm9uZyBjb2RlIHNldFxyXG4gICAgICBsW2ldID0gODtcclxuICAgIHppcF9maXhlZF9ibCA9IDc7XHJcblxyXG4gICAgaCA9IG5ldyB6aXBfSHVmdEJ1aWxkKGwsIDI4OCwgMjU3LCB6aXBfY3BsZW5zLCB6aXBfY3BsZXh0LFxyXG4gICAgICAgICAgICAgICAgemlwX2ZpeGVkX2JsKTtcclxuICAgIGlmKGguc3RhdHVzICE9IDApIHtcclxuICAgICAgYWxlcnQoXCJIdWZCdWlsZCBlcnJvcjogXCIraC5zdGF0dXMpO1xyXG4gICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcbiAgICB6aXBfZml4ZWRfdGwgPSBoLnJvb3Q7XHJcbiAgICB6aXBfZml4ZWRfYmwgPSBoLm07XHJcblxyXG4gICAgLy8gZGlzdGFuY2UgdGFibGVcclxuICAgIGZvcihpID0gMDsgaSA8IDMwOyBpKyspICAgIC8vIG1ha2UgYW4gaW5jb21wbGV0ZSBjb2RlIHNldFxyXG4gICAgICBsW2ldID0gNTtcclxuICAgIHppcF9maXhlZF9iZCA9IDU7XHJcblxyXG4gICAgaCA9IG5ldyB6aXBfSHVmdEJ1aWxkKGwsIDMwLCAwLCB6aXBfY3BkaXN0LCB6aXBfY3BkZXh0LCB6aXBfZml4ZWRfYmQpO1xyXG4gICAgaWYoaC5zdGF0dXMgPiAxKSB7XHJcbiAgICAgIHppcF9maXhlZF90bCA9IG51bGw7XHJcbiAgICAgIHRocm93KFwiSHVmQnVpbGQgZXJyb3I6IFwiK2guc3RhdHVzKTtcclxuICAgICAgcmV0dXJuIC0xO1xyXG4gICAgfVxyXG4gICAgemlwX2ZpeGVkX3RkID0gaC5yb290O1xyXG4gICAgemlwX2ZpeGVkX2JkID0gaC5tO1xyXG4gIH1cclxuXHJcbiAgemlwX3RsID0gemlwX2ZpeGVkX3RsO1xyXG4gIHppcF90ZCA9IHppcF9maXhlZF90ZDtcclxuICB6aXBfYmwgPSB6aXBfZml4ZWRfYmw7XHJcbiAgemlwX2JkID0gemlwX2ZpeGVkX2JkO1xyXG4gIHJldHVybiB6aXBfaW5mbGF0ZV9jb2RlcyhidWZmLCBvZmYsIHNpemUpO1xyXG59O1xyXG5cclxudmFyIHppcF9pbmZsYXRlX2R5bmFtaWMgPSBmdW5jdGlvbihidWZmLCBvZmYsIHNpemUpIHtcclxuICAvLyBkZWNvbXByZXNzIGFuIGluZmxhdGVkIHR5cGUgMiAoZHluYW1pYyBIdWZmbWFuIGNvZGVzKSBibG9jay5cclxuICB2YXIgaTsgICAgICAgIC8vIHRlbXBvcmFyeSB2YXJpYWJsZXNcclxuICB2YXIgajtcclxuICB2YXIgbDsgICAgICAgIC8vIGxhc3QgbGVuZ3RoXHJcbiAgdmFyIG47ICAgICAgICAvLyBudW1iZXIgb2YgbGVuZ3RocyB0byBnZXRcclxuICB2YXIgdDsgICAgICAgIC8vICh6aXBfSHVmdE5vZGUpIGxpdGVyYWwvbGVuZ3RoIGNvZGUgdGFibGVcclxuICB2YXIgbmI7ICAgICAgICAvLyBudW1iZXIgb2YgYml0IGxlbmd0aCBjb2Rlc1xyXG4gIHZhciBubDsgICAgICAgIC8vIG51bWJlciBvZiBsaXRlcmFsL2xlbmd0aCBjb2Rlc1xyXG4gIHZhciBuZDsgICAgICAgIC8vIG51bWJlciBvZiBkaXN0YW5jZSBjb2Rlc1xyXG4gIHZhciBsbCA9IG5ldyBBcnJheSgyODYrMzApOyAvLyBsaXRlcmFsL2xlbmd0aCBhbmQgZGlzdGFuY2UgY29kZSBsZW5ndGhzXHJcbiAgdmFyIGg7ICAgICAgICAvLyAoemlwX0h1ZnRCdWlsZClcclxuXHJcbiAgZm9yKGkgPSAwOyBpIDwgbGwubGVuZ3RoOyBpKyspXHJcbiAgICBsbFtpXSA9IDA7XHJcblxyXG4gIC8vIHJlYWQgaW4gdGFibGUgbGVuZ3Roc1xyXG4gIHppcF9ORUVEQklUUyg1KTtcclxuICBubCA9IDI1NyArIHppcF9HRVRCSVRTKDUpOyAgICAvLyBudW1iZXIgb2YgbGl0ZXJhbC9sZW5ndGggY29kZXNcclxuICB6aXBfRFVNUEJJVFMoNSk7XHJcbiAgemlwX05FRURCSVRTKDUpO1xyXG4gIG5kID0gMSArIHppcF9HRVRCSVRTKDUpOyAgICAvLyBudW1iZXIgb2YgZGlzdGFuY2UgY29kZXNcclxuICB6aXBfRFVNUEJJVFMoNSk7XHJcbiAgemlwX05FRURCSVRTKDQpO1xyXG4gIG5iID0gNCArIHppcF9HRVRCSVRTKDQpOyAgICAvLyBudW1iZXIgb2YgYml0IGxlbmd0aCBjb2Rlc1xyXG4gIHppcF9EVU1QQklUUyg0KTtcclxuICBpZihubCA+IDI4NiB8fCBuZCA+IDMwKVxyXG4gICAgcmV0dXJuIC0xOyAgICAgICAgLy8gYmFkIGxlbmd0aHNcclxuXHJcbiAgLy8gcmVhZCBpbiBiaXQtbGVuZ3RoLWNvZGUgbGVuZ3Roc1xyXG4gIGZvcihqID0gMDsgaiA8IG5iOyBqKyspXHJcbiAge1xyXG4gICAgemlwX05FRURCSVRTKDMpO1xyXG4gICAgbGxbemlwX2JvcmRlcltqXV0gPSB6aXBfR0VUQklUUygzKTtcclxuICAgIHppcF9EVU1QQklUUygzKTtcclxuICB9XHJcbiAgZm9yKDsgaiA8IDE5OyBqKyspXHJcbiAgICBsbFt6aXBfYm9yZGVyW2pdXSA9IDA7XHJcblxyXG4gIC8vIGJ1aWxkIGRlY29kaW5nIHRhYmxlIGZvciB0cmVlcy0tc2luZ2xlIGxldmVsLCA3IGJpdCBsb29rdXBcclxuICB6aXBfYmwgPSA3O1xyXG4gIGggPSBuZXcgemlwX0h1ZnRCdWlsZChsbCwgMTksIDE5LCBudWxsLCBudWxsLCB6aXBfYmwpO1xyXG4gIGlmKGguc3RhdHVzICE9IDApXHJcbiAgICByZXR1cm4gLTE7ICAgIC8vIGluY29tcGxldGUgY29kZSBzZXRcclxuXHJcbiAgemlwX3RsID0gaC5yb290O1xyXG4gIHppcF9ibCA9IGgubTtcclxuXHJcbiAgLy8gcmVhZCBpbiBsaXRlcmFsIGFuZCBkaXN0YW5jZSBjb2RlIGxlbmd0aHNcclxuICBuID0gbmwgKyBuZDtcclxuICBpID0gbCA9IDA7XHJcbiAgd2hpbGUoaSA8IG4pIHtcclxuICAgIHppcF9ORUVEQklUUyh6aXBfYmwpO1xyXG4gICAgdCA9IHppcF90bC5saXN0W3ppcF9HRVRCSVRTKHppcF9ibCldO1xyXG4gICAgaiA9IHQuYjtcclxuICAgIHppcF9EVU1QQklUUyhqKTtcclxuICAgIGogPSB0Lm47XHJcbiAgICBpZihqIDwgMTYpICAgICAgICAvLyBsZW5ndGggb2YgY29kZSBpbiBiaXRzICgwLi4xNSlcclxuICAgICAgbGxbaSsrXSA9IGwgPSBqOyAgICAvLyBzYXZlIGxhc3QgbGVuZ3RoIGluIGxcclxuICAgIGVsc2UgaWYoaiA9PSAxNikgeyAgICAvLyByZXBlYXQgbGFzdCBsZW5ndGggMyB0byA2IHRpbWVzXHJcbiAgICAgIHppcF9ORUVEQklUUygyKTtcclxuICAgICAgaiA9IDMgKyB6aXBfR0VUQklUUygyKTtcclxuICAgICAgemlwX0RVTVBCSVRTKDIpO1xyXG4gICAgICBpZihpICsgaiA+IG4pXHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICB3aGlsZShqLS0gPiAwKVxyXG4gICAgICAgIGxsW2krK10gPSBsO1xyXG4gICAgfSBlbHNlIGlmKGogPT0gMTcpIHsgICAgLy8gMyB0byAxMCB6ZXJvIGxlbmd0aCBjb2Rlc1xyXG4gICAgICB6aXBfTkVFREJJVFMoMyk7XHJcbiAgICAgIGogPSAzICsgemlwX0dFVEJJVFMoMyk7XHJcbiAgICAgIHppcF9EVU1QQklUUygzKTtcclxuICAgICAgaWYoaSArIGogPiBuKVxyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgd2hpbGUoai0tID4gMClcclxuICAgICAgICBsbFtpKytdID0gMDtcclxuICAgICAgbCA9IDA7XHJcbiAgICB9IGVsc2UgeyAgICAgICAgLy8gaiA9PSAxODogMTEgdG8gMTM4IHplcm8gbGVuZ3RoIGNvZGVzXHJcbiAgICAgIHppcF9ORUVEQklUUyg3KTtcclxuICAgICAgaiA9IDExICsgemlwX0dFVEJJVFMoNyk7XHJcbiAgICAgIHppcF9EVU1QQklUUyg3KTtcclxuICAgICAgaWYoaSArIGogPiBuKVxyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgd2hpbGUoai0tID4gMClcclxuICAgICAgICBsbFtpKytdID0gMDtcclxuICAgICAgbCA9IDA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBidWlsZCB0aGUgZGVjb2RpbmcgdGFibGVzIGZvciBsaXRlcmFsL2xlbmd0aCBhbmQgZGlzdGFuY2UgY29kZXNcclxuICB6aXBfYmwgPSB6aXBfbGJpdHM7XHJcbiAgaCA9IG5ldyB6aXBfSHVmdEJ1aWxkKGxsLCBubCwgMjU3LCB6aXBfY3BsZW5zLCB6aXBfY3BsZXh0LCB6aXBfYmwpO1xyXG4gIGlmKHppcF9ibCA9PSAwKSAgICAvLyBubyBsaXRlcmFscyBvciBsZW5ndGhzXHJcbiAgICBoLnN0YXR1cyA9IDE7XHJcbiAgaWYoaC5zdGF0dXMgIT0gMCkge1xyXG4gICAgaWYoaC5zdGF0dXMgPT0gMSlcclxuICAgICAgOy8vICoqaW5jb21wbGV0ZSBsaXRlcmFsIHRyZWUqKlxyXG4gICAgcmV0dXJuIC0xOyAgICAgICAgLy8gaW5jb21wbGV0ZSBjb2RlIHNldFxyXG4gIH1cclxuICB6aXBfdGwgPSBoLnJvb3Q7XHJcbiAgemlwX2JsID0gaC5tO1xyXG5cclxuICBmb3IoaSA9IDA7IGkgPCBuZDsgaSsrKVxyXG4gICAgbGxbaV0gPSBsbFtpICsgbmxdO1xyXG4gIHppcF9iZCA9IHppcF9kYml0cztcclxuICBoID0gbmV3IHppcF9IdWZ0QnVpbGQobGwsIG5kLCAwLCB6aXBfY3BkaXN0LCB6aXBfY3BkZXh0LCB6aXBfYmQpO1xyXG4gIHppcF90ZCA9IGgucm9vdDtcclxuICB6aXBfYmQgPSBoLm07XHJcblxyXG4gIGlmKHppcF9iZCA9PSAwICYmIG5sID4gMjU3KSB7ICAgLy8gbGVuZ3RocyBidXQgbm8gZGlzdGFuY2VzXHJcbiAgICAvLyAqKmluY29tcGxldGUgZGlzdGFuY2UgdHJlZSoqXHJcbiAgICByZXR1cm4gLTE7XHJcbiAgfVxyXG5cclxuICBpZihoLnN0YXR1cyA9PSAxKSB7XHJcbiAgICA7Ly8gKippbmNvbXBsZXRlIGRpc3RhbmNlIHRyZWUqKlxyXG4gIH1cclxuICBpZihoLnN0YXR1cyAhPSAwKVxyXG4gICAgcmV0dXJuIC0xO1xyXG5cclxuICAvLyBkZWNvbXByZXNzIHVudGlsIGFuIGVuZC1vZi1ibG9jayBjb2RlXHJcbiAgcmV0dXJuIHppcF9pbmZsYXRlX2NvZGVzKGJ1ZmYsIG9mZiwgc2l6ZSk7XHJcbn07XHJcblxyXG52YXIgemlwX2luZmxhdGVfc3RhcnQgPSBmdW5jdGlvbigpIHtcclxuICB2YXIgaTtcclxuXHJcbiAgaWYoemlwX3NsaWRlID09IG51bGwpXHJcbiAgICB6aXBfc2xpZGUgPSBuZXcgQXJyYXkoMiAqIHppcF9XU0laRSk7XHJcbiAgemlwX3dwID0gMDtcclxuICB6aXBfYml0X2J1ZiA9IDA7XHJcbiAgemlwX2JpdF9sZW4gPSAwO1xyXG4gIHppcF9tZXRob2QgPSAtMTtcclxuICB6aXBfZW9mID0gZmFsc2U7XHJcbiAgemlwX2NvcHlfbGVuZyA9IHppcF9jb3B5X2Rpc3QgPSAwO1xyXG4gIHppcF90bCA9IG51bGw7XHJcbn07XHJcblxyXG52YXIgemlwX2luZmxhdGVfaW50ZXJuYWwgPSBmdW5jdGlvbihidWZmLCBvZmYsIHNpemUpIHtcclxuICAvLyBkZWNvbXByZXNzIGFuIGluZmxhdGVkIGVudHJ5XHJcbiAgdmFyIG4sIGk7XHJcblxyXG4gIG4gPSAwO1xyXG4gIHdoaWxlKG4gPCBzaXplKSB7XHJcbiAgICBpZih6aXBfZW9mICYmIHppcF9tZXRob2QgPT0gLTEpXHJcbiAgICAgIHJldHVybiBuO1xyXG5cclxuICAgIGlmKHppcF9jb3B5X2xlbmcgPiAwKSB7XHJcbiAgICAgIGlmKHppcF9tZXRob2QgIT0gemlwX1NUT1JFRF9CTE9DSykge1xyXG4gICAgICAgIC8vIFNUQVRJQ19UUkVFUyBvciBEWU5fVFJFRVNcclxuICAgICAgICB3aGlsZSh6aXBfY29weV9sZW5nID4gMCAmJiBuIDwgc2l6ZSkge1xyXG4gICAgICAgICAgemlwX2NvcHlfbGVuZy0tO1xyXG4gICAgICAgICAgemlwX2NvcHlfZGlzdCAmPSB6aXBfV1NJWkUgLSAxO1xyXG4gICAgICAgICAgemlwX3dwICY9IHppcF9XU0laRSAtIDE7XHJcbiAgICAgICAgICBidWZmW29mZiArIG4rK10gPSB6aXBfc2xpZGVbemlwX3dwKytdID1cclxuICAgICAgICAgICAgemlwX3NsaWRlW3ppcF9jb3B5X2Rpc3QrK107XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHdoaWxlKHppcF9jb3B5X2xlbmcgPiAwICYmIG4gPCBzaXplKSB7XHJcbiAgICAgICAgICB6aXBfY29weV9sZW5nLS07XHJcbiAgICAgICAgICB6aXBfd3AgJj0gemlwX1dTSVpFIC0gMTtcclxuICAgICAgICAgIHppcF9ORUVEQklUUyg4KTtcclxuICAgICAgICAgIGJ1ZmZbb2ZmICsgbisrXSA9IHppcF9zbGlkZVt6aXBfd3ArK10gPSB6aXBfR0VUQklUUyg4KTtcclxuICAgICAgICAgIHppcF9EVU1QQklUUyg4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoemlwX2NvcHlfbGVuZyA9PSAwKVxyXG4gICAgICAgICAgemlwX21ldGhvZCA9IC0xOyAvLyBkb25lXHJcbiAgICAgIH1cclxuICAgICAgaWYobiA9PSBzaXplKVxyXG4gICAgICAgIHJldHVybiBuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHppcF9tZXRob2QgPT0gLTEpIHtcclxuICAgICAgaWYoemlwX2VvZilcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIC8vIHJlYWQgaW4gbGFzdCBibG9jayBiaXRcclxuICAgICAgemlwX05FRURCSVRTKDEpO1xyXG4gICAgICBpZih6aXBfR0VUQklUUygxKSAhPSAwKVxyXG4gICAgICAgIHppcF9lb2YgPSB0cnVlO1xyXG4gICAgICB6aXBfRFVNUEJJVFMoMSk7XHJcblxyXG4gICAgICAvLyByZWFkIGluIGJsb2NrIHR5cGVcclxuICAgICAgemlwX05FRURCSVRTKDIpO1xyXG4gICAgICB6aXBfbWV0aG9kID0gemlwX0dFVEJJVFMoMik7XHJcbiAgICAgIHppcF9EVU1QQklUUygyKTtcclxuICAgICAgemlwX3RsID0gbnVsbDtcclxuICAgICAgemlwX2NvcHlfbGVuZyA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgc3dpdGNoKHppcF9tZXRob2QpIHtcclxuICAgICAgY2FzZSAwOiAvLyB6aXBfU1RPUkVEX0JMT0NLXHJcbiAgICAgIGkgPSB6aXBfaW5mbGF0ZV9zdG9yZWQoYnVmZiwgb2ZmICsgbiwgc2l6ZSAtIG4pO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgMTogLy8gemlwX1NUQVRJQ19UUkVFU1xyXG4gICAgICBpZih6aXBfdGwgIT0gbnVsbClcclxuICAgICAgICBpID0gemlwX2luZmxhdGVfY29kZXMoYnVmZiwgb2ZmICsgbiwgc2l6ZSAtIG4pO1xyXG4gICAgICBlbHNlXHJcbiAgICAgICAgaSA9IHppcF9pbmZsYXRlX2ZpeGVkKGJ1ZmYsIG9mZiArIG4sIHNpemUgLSBuKTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlIDI6IC8vIHppcF9EWU5fVFJFRVNcclxuICAgICAgaWYoemlwX3RsICE9IG51bGwpXHJcbiAgICAgICAgaSA9IHppcF9pbmZsYXRlX2NvZGVzKGJ1ZmYsIG9mZiArIG4sIHNpemUgLSBuKTtcclxuICAgICAgZWxzZVxyXG4gICAgICAgIGkgPSB6aXBfaW5mbGF0ZV9keW5hbWljKGJ1ZmYsIG9mZiArIG4sIHNpemUgLSBuKTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBkZWZhdWx0OiAvLyBlcnJvclxyXG4gICAgICBpID0gLTE7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKGkgPT0gLTEpIHtcclxuICAgICAgaWYoemlwX2VvZilcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgcmV0dXJuIC0xO1xyXG4gICAgfVxyXG4gICAgbiArPSBpO1xyXG4gIH1cclxuICByZXR1cm4gbjtcclxufTtcclxuXHJcbnZhciBmaW5hbF9kYXRhID0gZmFsc2U7XHJcbnZhciBzdGFydF9pbmZsYXRlID0gZnVuY3Rpb24oaCkge1xyXG4gIGZpbmFsX2RhdGEgPSBmYWxzZTtcclxuICB6aXBfaW5mbGF0ZV9zdGFydCgpO1xyXG4gIHppcF9pbmZsYXRlX3BvcyA9IGgub2Zmc2V0O1xyXG4gIGguY29tcHV0ZWRDUkMzMiA9IDA7XHJcbn07XHJcbnZhciBjb250aW51ZV9pbmZsYXRlID0gZnVuY3Rpb24oc3RyLCBoLCBvbnN0cmVhbSkge1xyXG4gIHZhciBpLCBqO1xyXG4gIHZhciBCVUZTWiA9IDQwOTY7XHJcbiAgemlwX2luZmxhdGVfZGF0YSA9IHN0cjtcclxuICBpZiAoIWZpbmFsX2RhdGEgJiYgc3RyLmxlbmd0aCA8PSB6aXBfaW5mbGF0ZV9wb3MrQlVGU1orNjQpXHJcbiAgICByZXR1cm4gaDtcclxuXHJcbiAgdmFyIGJ1ZmYgPSBuZXcgQXJyYXkoQlVGU1opO1xyXG4gIHdoaWxlKChpID0gemlwX2luZmxhdGVfaW50ZXJuYWwoYnVmZiwgMCwgYnVmZi5sZW5ndGgpKSA+IDApIHtcclxuICAgIHZhciBjYnVmID0gbmV3IEFycmF5KGkpO1xyXG4gICAgZm9yKGogPSAwOyBqIDwgaTsgaisrKXtcclxuICAgICAgY2J1ZltqXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmZltqXSk7XHJcbiAgICB9XHJcbiAgICB2YXIgcyA9IGNidWYuam9pbihcIlwiKTtcclxuICAgIGguZGF0YS5wdXNoKHMpO1xyXG4gICAgaC5vdXRwdXRTaXplICs9IHMubGVuZ3RoO1xyXG4gICAgaC5vZmZzZXQgPSB6aXBfaW5mbGF0ZV9wb3M7XHJcbiAgICBoLmNvbXB1dGVkQ1JDMzIgPSBCaW4uQ1JDMzIocywgMCwgcy5sZW5ndGgsIGguY29tcHV0ZWRDUkMzMik7XHJcbiAgICBpZiAoIWZpbmFsX2RhdGEgJiYgc3RyLmxlbmd0aCA8PSB6aXBfaW5mbGF0ZV9wb3MrQlVGU1orNjQpXHJcbiAgICAgIGJyZWFrO1xyXG4gIH1cclxuICB6aXBfaW5mbGF0ZV9kYXRhID0gbnVsbDsgLy8gRy5DLlxyXG4gIGlmIChvbnN0cmVhbSkgb25zdHJlYW0oaCk7XHJcbiAgcmV0dXJuIGg7XHJcbn07XHJcbnZhciBmaW5hbF9pbmZsYXRlID0gZnVuY3Rpb24oc3RyLCBoLCBvbnN0cmVhbSkge1xyXG4gIGZpbmFsX2RhdGEgPSB0cnVlO1xyXG4gIGNvbnRpbnVlX2luZmxhdGUoc3RyLCBoLCBvbnN0cmVhbSk7XHJcbn07XHJcblxyXG50aGlzLmluZmxhdGUgPSBmdW5jdGlvbihzdHIsaCxvbnN0cmVhbSkge1xyXG4gIHN0YXJ0X2luZmxhdGUoaCk7XHJcbiAgcmV0dXJuIGZpbmFsX2luZmxhdGUoc3RyLGgsb25zdHJlYW0pO1xyXG59O1xyXG50aGlzLnN0YXJ0X2luZmxhdGUgPSBzdGFydF9pbmZsYXRlO1xyXG50aGlzLmNvbnRpbnVlX2luZmxhdGUgPSBjb250aW51ZV9pbmZsYXRlO1xyXG50aGlzLmZpbmFsX2luZmxhdGUgPSBmaW5hbF9pbmZsYXRlO1xyXG59KTsiLCIvKiAgUHJvdG90eXBlIEphdmFTY3JpcHQgZnJhbWV3b3JrLCB2ZXJzaW9uIDEuNy4yXG4gKiAgKGMpIDIwMDUtMjAxMCBTYW0gU3RlcGhlbnNvblxuICpcbiAqICBQcm90b3R5cGUgaXMgZnJlZWx5IGRpc3RyaWJ1dGFibGUgdW5kZXIgdGhlIHRlcm1zIG9mIGFuIE1JVC1zdHlsZSBsaWNlbnNlLlxuICogIEZvciBkZXRhaWxzLCBzZWUgdGhlIFByb3RvdHlwZSB3ZWIgc2l0ZTogaHR0cDovL3d3dy5wcm90b3R5cGVqcy5vcmcvXG4gKlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbnZhciBQcm90b3R5cGUgPSB7XG5cbiAgVmVyc2lvbjogJzEuNy4yJyxcblxuICBCcm93c2VyOiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuICAgIHZhciBpc09wZXJhID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHdpbmRvdy5vcGVyYSkgPT0gJ1tvYmplY3QgT3BlcmFdJztcbiAgICByZXR1cm4ge1xuICAgICAgSUU6ICAgICAgICAgICAgICEhd2luZG93LmF0dGFjaEV2ZW50ICYmICFpc09wZXJhLFxuICAgICAgT3BlcmE6ICAgICAgICAgIGlzT3BlcmEsXG4gICAgICBXZWJLaXQ6ICAgICAgICAgdWEuaW5kZXhPZignQXBwbGVXZWJLaXQvJykgPiAtMSxcbiAgICAgIEdlY2tvOiAgICAgICAgICB1YS5pbmRleE9mKCdHZWNrbycpID4gLTEgJiYgdWEuaW5kZXhPZignS0hUTUwnKSA9PT0gLTEsXG4gICAgICBNb2JpbGVTYWZhcmk6ICAgL0FwcGxlLipNb2JpbGUvLnRlc3QodWEpXG4gICAgfVxuICB9KSgpLFxuXG4gIEJyb3dzZXJGZWF0dXJlczoge1xuICAgIFhQYXRoOiAhIWRvY3VtZW50LmV2YWx1YXRlLFxuXG4gICAgU2VsZWN0b3JzQVBJOiAhIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IsXG5cbiAgICBFbGVtZW50RXh0ZW5zaW9uczogKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGNvbnN0cnVjdG9yID0gd2luZG93LkVsZW1lbnQgfHwgd2luZG93LkhUTUxFbGVtZW50O1xuICAgICAgcmV0dXJuICEhKGNvbnN0cnVjdG9yICYmIGNvbnN0cnVjdG9yLnByb3RvdHlwZSk7XG4gICAgfSkoKSxcbiAgICBTcGVjaWZpY0VsZW1lbnRFeHRlbnNpb25zOiAoZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodHlwZW9mIHdpbmRvdy5IVE1MRGl2RWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksXG4gICAgICAgICAgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKSxcbiAgICAgICAgICBpc1N1cHBvcnRlZCA9IGZhbHNlO1xuXG4gICAgICBpZiAoZGl2WydfX3Byb3RvX18nXSAmJiAoZGl2WydfX3Byb3RvX18nXSAhPT0gZm9ybVsnX19wcm90b19fJ10pKSB7XG4gICAgICAgIGlzU3VwcG9ydGVkID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgZGl2ID0gZm9ybSA9IG51bGw7XG5cbiAgICAgIHJldHVybiBpc1N1cHBvcnRlZDtcbiAgICB9KSgpXG4gIH0sXG5cbiAgU2NyaXB0RnJhZ21lbnQ6ICc8c2NyaXB0W14+XSo+KFtcXFxcU1xcXFxzXSo/KTxcXC9zY3JpcHRcXFxccyo+JyxcbiAgSlNPTkZpbHRlcjogL15cXC9cXCotc2VjdXJlLShbXFxzXFxTXSopXFwqXFwvXFxzKiQvLFxuXG4gIGVtcHR5RnVuY3Rpb246IGZ1bmN0aW9uKCkgeyB9LFxuXG4gIEs6IGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHggfVxufTtcblxuaWYgKFByb3RvdHlwZS5Ccm93c2VyLk1vYmlsZVNhZmFyaSlcbiAgUHJvdG90eXBlLkJyb3dzZXJGZWF0dXJlcy5TcGVjaWZpY0VsZW1lbnRFeHRlbnNpb25zID0gZmFsc2U7XG4vKiBCYXNlZCBvbiBBbGV4IEFybmVsbCdzIGluaGVyaXRhbmNlIGltcGxlbWVudGF0aW9uLiAqL1xuXG52YXIgQ2xhc3MgPSAoZnVuY3Rpb24oKSB7XG5cbiAgdmFyIElTX0RPTlRFTlVNX0JVR0dZID0gKGZ1bmN0aW9uKCl7XG4gICAgZm9yICh2YXIgcCBpbiB7IHRvU3RyaW5nOiAxIH0pIHtcbiAgICAgIGlmIChwID09PSAndG9TdHJpbmcnKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9KSgpO1xuXG4gIGZ1bmN0aW9uIHN1YmNsYXNzKCkge307XG4gIGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgcGFyZW50ID0gbnVsbCwgcHJvcGVydGllcyA9ICRBKGFyZ3VtZW50cyk7XG4gICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKHByb3BlcnRpZXNbMF0pKVxuICAgICAgcGFyZW50ID0gcHJvcGVydGllcy5zaGlmdCgpO1xuXG4gICAgZnVuY3Rpb24ga2xhc3MoKSB7XG4gICAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBPYmplY3QuZXh0ZW5kKGtsYXNzLCBDbGFzcy5NZXRob2RzKTtcbiAgICBrbGFzcy5zdXBlcmNsYXNzID0gcGFyZW50O1xuICAgIGtsYXNzLnN1YmNsYXNzZXMgPSBbXTtcblxuICAgIGlmIChwYXJlbnQpIHtcbiAgICAgIHN1YmNsYXNzLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7XG4gICAgICBrbGFzcy5wcm90b3R5cGUgPSBuZXcgc3ViY2xhc3M7XG4gICAgICBwYXJlbnQuc3ViY2xhc3Nlcy5wdXNoKGtsYXNzKTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKylcbiAgICAgIGtsYXNzLmFkZE1ldGhvZHMocHJvcGVydGllc1tpXSk7XG5cbiAgICBpZiAoIWtsYXNzLnByb3RvdHlwZS5pbml0aWFsaXplKVxuICAgICAga2xhc3MucHJvdG90eXBlLmluaXRpYWxpemUgPSBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbjtcblxuICAgIGtsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGtsYXNzO1xuICAgIHJldHVybiBrbGFzcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZE1ldGhvZHMoc291cmNlKSB7XG4gICAgdmFyIGFuY2VzdG9yICAgPSB0aGlzLnN1cGVyY2xhc3MgJiYgdGhpcy5zdXBlcmNsYXNzLnByb3RvdHlwZSxcbiAgICAgICAgcHJvcGVydGllcyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7XG5cbiAgICBpZiAoSVNfRE9OVEVOVU1fQlVHR1kpIHtcbiAgICAgIGlmIChzb3VyY2UudG9TdHJpbmcgIT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZylcbiAgICAgICAgcHJvcGVydGllcy5wdXNoKFwidG9TdHJpbmdcIik7XG4gICAgICBpZiAoc291cmNlLnZhbHVlT2YgIT0gT2JqZWN0LnByb3RvdHlwZS52YWx1ZU9mKVxuICAgICAgICBwcm9wZXJ0aWVzLnB1c2goXCJ2YWx1ZU9mXCIpO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgcHJvcGVydHkgPSBwcm9wZXJ0aWVzW2ldLCB2YWx1ZSA9IHNvdXJjZVtwcm9wZXJ0eV07XG4gICAgICBpZiAoYW5jZXN0b3IgJiYgT2JqZWN0LmlzRnVuY3Rpb24odmFsdWUpICYmXG4gICAgICAgICAgdmFsdWUuYXJndW1lbnROYW1lcygpWzBdID09IFwiJHN1cGVyXCIpIHtcbiAgICAgICAgdmFyIG1ldGhvZCA9IHZhbHVlO1xuICAgICAgICB2YWx1ZSA9IChmdW5jdGlvbihtKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgeyByZXR1cm4gYW5jZXN0b3JbbV0uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfTtcbiAgICAgICAgfSkocHJvcGVydHkpLndyYXAobWV0aG9kKTtcblxuICAgICAgICB2YWx1ZS52YWx1ZU9mID0gKGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ldGhvZC52YWx1ZU9mLmNhbGwobWV0aG9kKTsgfTtcbiAgICAgICAgfSkobWV0aG9kKTtcblxuICAgICAgICB2YWx1ZS50b1N0cmluZyA9IChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiBtZXRob2QudG9TdHJpbmcuY2FsbChtZXRob2QpOyB9O1xuICAgICAgICB9KShtZXRob2QpO1xuICAgICAgfVxuICAgICAgdGhpcy5wcm90b3R5cGVbcHJvcGVydHldID0gdmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGNyZWF0ZTogY3JlYXRlLFxuICAgIE1ldGhvZHM6IHtcbiAgICAgIGFkZE1ldGhvZHM6IGFkZE1ldGhvZHNcbiAgICB9XG4gIH07XG59KSgpO1xuKGZ1bmN0aW9uKCkge1xuXG4gIHZhciBfdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgICAgX2hhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxcbiAgICAgIE5VTExfVFlQRSA9ICdOdWxsJyxcbiAgICAgIFVOREVGSU5FRF9UWVBFID0gJ1VuZGVmaW5lZCcsXG4gICAgICBCT09MRUFOX1RZUEUgPSAnQm9vbGVhbicsXG4gICAgICBOVU1CRVJfVFlQRSA9ICdOdW1iZXInLFxuICAgICAgU1RSSU5HX1RZUEUgPSAnU3RyaW5nJyxcbiAgICAgIE9CSkVDVF9UWVBFID0gJ09iamVjdCcsXG4gICAgICBGVU5DVElPTl9DTEFTUyA9ICdbb2JqZWN0IEZ1bmN0aW9uXScsXG4gICAgICBCT09MRUFOX0NMQVNTID0gJ1tvYmplY3QgQm9vbGVhbl0nLFxuICAgICAgTlVNQkVSX0NMQVNTID0gJ1tvYmplY3QgTnVtYmVyXScsXG4gICAgICBTVFJJTkdfQ0xBU1MgPSAnW29iamVjdCBTdHJpbmddJyxcbiAgICAgIEFSUkFZX0NMQVNTID0gJ1tvYmplY3QgQXJyYXldJyxcbiAgICAgIERBVEVfQ0xBU1MgPSAnW29iamVjdCBEYXRlXScsXG4gICAgICBOQVRJVkVfSlNPTl9TVFJJTkdJRllfU1VQUE9SVCA9IHdpbmRvdy5KU09OICYmXG4gICAgICAgIHR5cGVvZiBKU09OLnN0cmluZ2lmeSA9PT0gJ2Z1bmN0aW9uJyAmJlxuICAgICAgICBKU09OLnN0cmluZ2lmeSgwKSA9PT0gJzAnICYmXG4gICAgICAgIHR5cGVvZiBKU09OLnN0cmluZ2lmeShQcm90b3R5cGUuSykgPT09ICd1bmRlZmluZWQnO1xuXG5cblxuICB2YXIgRE9OVF9FTlVNUyA9IFsndG9TdHJpbmcnLCAndG9Mb2NhbGVTdHJpbmcnLCAndmFsdWVPZicsXG4gICAnaGFzT3duUHJvcGVydHknLCAnaXNQcm90b3R5cGVPZicsICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsICdjb25zdHJ1Y3RvciddO1xuXG4gIHZhciBJU19ET05URU5VTV9CVUdHWSA9IChmdW5jdGlvbigpe1xuICAgIGZvciAodmFyIHAgaW4geyB0b1N0cmluZzogMSB9KSB7XG4gICAgICBpZiAocCA9PT0gJ3RvU3RyaW5nJykgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSkoKTtcblxuICBmdW5jdGlvbiBUeXBlKG8pIHtcbiAgICBzd2l0Y2gobykge1xuICAgICAgY2FzZSBudWxsOiByZXR1cm4gTlVMTF9UWVBFO1xuICAgICAgY2FzZSAodm9pZCAwKTogcmV0dXJuIFVOREVGSU5FRF9UWVBFO1xuICAgIH1cbiAgICB2YXIgdHlwZSA9IHR5cGVvZiBvO1xuICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICBjYXNlICdib29sZWFuJzogcmV0dXJuIEJPT0xFQU5fVFlQRTtcbiAgICAgIGNhc2UgJ251bWJlcic6ICByZXR1cm4gTlVNQkVSX1RZUEU7XG4gICAgICBjYXNlICdzdHJpbmcnOiAgcmV0dXJuIFNUUklOR19UWVBFO1xuICAgIH1cbiAgICByZXR1cm4gT0JKRUNUX1RZUEU7XG4gIH1cblxuICBmdW5jdGlvbiBleHRlbmQoZGVzdGluYXRpb24sIHNvdXJjZSkge1xuICAgIGZvciAodmFyIHByb3BlcnR5IGluIHNvdXJjZSlcbiAgICAgIGRlc3RpbmF0aW9uW3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07XG4gICAgcmV0dXJuIGRlc3RpbmF0aW9uO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5zcGVjdChvYmplY3QpIHtcbiAgICB0cnkge1xuICAgICAgaWYgKGlzVW5kZWZpbmVkKG9iamVjdCkpIHJldHVybiAndW5kZWZpbmVkJztcbiAgICAgIGlmIChvYmplY3QgPT09IG51bGwpIHJldHVybiAnbnVsbCc7XG4gICAgICByZXR1cm4gb2JqZWN0Lmluc3BlY3QgPyBvYmplY3QuaW5zcGVjdCgpIDogU3RyaW5nKG9iamVjdCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgaWYgKGUgaW5zdGFuY2VvZiBSYW5nZUVycm9yKSByZXR1cm4gJy4uLic7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHRvSlNPTih2YWx1ZSkge1xuICAgIHJldHVybiBTdHIoJycsIHsgJyc6IHZhbHVlIH0sIFtdKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIFN0cihrZXksIGhvbGRlciwgc3RhY2spIHtcbiAgICB2YXIgdmFsdWUgPSBob2xkZXJba2V5XTtcbiAgICBpZiAoVHlwZSh2YWx1ZSkgPT09IE9CSkVDVF9UWVBFICYmIHR5cGVvZiB2YWx1ZS50b0pTT04gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUudG9KU09OKGtleSk7XG4gICAgfVxuXG4gICAgdmFyIF9jbGFzcyA9IF90b1N0cmluZy5jYWxsKHZhbHVlKTtcblxuICAgIHN3aXRjaCAoX2NsYXNzKSB7XG4gICAgICBjYXNlIE5VTUJFUl9DTEFTUzpcbiAgICAgIGNhc2UgQk9PTEVBTl9DTEFTUzpcbiAgICAgIGNhc2UgU1RSSU5HX0NMQVNTOlxuICAgICAgICB2YWx1ZSA9IHZhbHVlLnZhbHVlT2YoKTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHZhbHVlKSB7XG4gICAgICBjYXNlIG51bGw6IHJldHVybiAnbnVsbCc7XG4gICAgICBjYXNlIHRydWU6IHJldHVybiAndHJ1ZSc7XG4gICAgICBjYXNlIGZhbHNlOiByZXR1cm4gJ2ZhbHNlJztcbiAgICB9XG5cbiAgICB2YXIgdHlwZSA9IHR5cGVvZiB2YWx1ZTtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgIHJldHVybiB2YWx1ZS5pbnNwZWN0KHRydWUpO1xuICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgcmV0dXJuIGlzRmluaXRlKHZhbHVlKSA/IFN0cmluZyh2YWx1ZSkgOiAnbnVsbCc7XG4gICAgICBjYXNlICdvYmplY3QnOlxuXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBzdGFjay5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChzdGFja1tpXSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDeWNsaWMgcmVmZXJlbmNlIHRvICdcIiArIHZhbHVlICsgXCInIGluIG9iamVjdFwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RhY2sucHVzaCh2YWx1ZSk7XG5cbiAgICAgICAgdmFyIHBhcnRpYWwgPSBbXTtcbiAgICAgICAgaWYgKF9jbGFzcyA9PT0gQVJSQVlfQ0xBU1MpIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gdmFsdWUubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBzdHIgPSBTdHIoaSwgdmFsdWUsIHN0YWNrKTtcbiAgICAgICAgICAgIHBhcnRpYWwucHVzaCh0eXBlb2Ygc3RyID09PSAndW5kZWZpbmVkJyA/ICdudWxsJyA6IHN0cik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHBhcnRpYWwgPSAnWycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICddJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHZhbHVlKTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGtleSA9IGtleXNbaV0sIHN0ciA9IFN0cihrZXksIHZhbHVlLCBzdGFjayk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHN0ciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgcGFydGlhbC5wdXNoKGtleS5pbnNwZWN0KHRydWUpKyAnOicgKyBzdHIpO1xuICAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcGFydGlhbCA9ICd7JyArIHBhcnRpYWwuam9pbignLCcpICsgJ30nO1xuICAgICAgICB9XG4gICAgICAgIHN0YWNrLnBvcCgpO1xuICAgICAgICByZXR1cm4gcGFydGlhbDtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdHJpbmdpZnkob2JqZWN0KSB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iamVjdCk7XG4gIH1cblxuICBmdW5jdGlvbiB0b1F1ZXJ5U3RyaW5nKG9iamVjdCkge1xuICAgIHJldHVybiAkSChvYmplY3QpLnRvUXVlcnlTdHJpbmcoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvSFRNTChvYmplY3QpIHtcbiAgICByZXR1cm4gb2JqZWN0ICYmIG9iamVjdC50b0hUTUwgPyBvYmplY3QudG9IVE1MKCkgOiBTdHJpbmcuaW50ZXJwcmV0KG9iamVjdCk7XG4gIH1cblxuICBmdW5jdGlvbiBrZXlzKG9iamVjdCkge1xuICAgIGlmIChUeXBlKG9iamVjdCkgIT09IE9CSkVDVF9UWVBFKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoKTsgfVxuICAgIHZhciByZXN1bHRzID0gW107XG4gICAgZm9yICh2YXIgcHJvcGVydHkgaW4gb2JqZWN0KSB7XG4gICAgICBpZiAoX2hhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpXG4gICAgICAgIHJlc3VsdHMucHVzaChwcm9wZXJ0eSk7XG4gICAgfVxuXG4gICAgaWYgKElTX0RPTlRFTlVNX0JVR0dZKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgcHJvcGVydHkgPSBET05UX0VOVU1TW2ldOyBpKyspIHtcbiAgICAgICAgaWYgKF9oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpKVxuICAgICAgICAgIHJlc3VsdHMucHVzaChwcm9wZXJ0eSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiB2YWx1ZXMob2JqZWN0KSB7XG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBvYmplY3QpXG4gICAgICByZXN1bHRzLnB1c2gob2JqZWN0W3Byb3BlcnR5XSk7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBjbG9uZShvYmplY3QpIHtcbiAgICByZXR1cm4gZXh0ZW5kKHsgfSwgb2JqZWN0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzRWxlbWVudChvYmplY3QpIHtcbiAgICByZXR1cm4gISEob2JqZWN0ICYmIG9iamVjdC5ub2RlVHlwZSA9PSAxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzQXJyYXkob2JqZWN0KSB7XG4gICAgcmV0dXJuIF90b1N0cmluZy5jYWxsKG9iamVjdCkgPT09IEFSUkFZX0NMQVNTO1xuICB9XG5cbiAgdmFyIGhhc05hdGl2ZUlzQXJyYXkgPSAodHlwZW9mIEFycmF5LmlzQXJyYXkgPT0gJ2Z1bmN0aW9uJylcbiAgICAmJiBBcnJheS5pc0FycmF5KFtdKSAmJiAhQXJyYXkuaXNBcnJheSh7fSk7XG5cbiAgaWYgKGhhc05hdGl2ZUlzQXJyYXkpIHtcbiAgICBpc0FycmF5ID0gQXJyYXkuaXNBcnJheTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzSGFzaChvYmplY3QpIHtcbiAgICByZXR1cm4gb2JqZWN0IGluc3RhbmNlb2YgSGFzaDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzRnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgcmV0dXJuIF90b1N0cmluZy5jYWxsKG9iamVjdCkgPT09IEZVTkNUSU9OX0NMQVNTO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNTdHJpbmcob2JqZWN0KSB7XG4gICAgcmV0dXJuIF90b1N0cmluZy5jYWxsKG9iamVjdCkgPT09IFNUUklOR19DTEFTUztcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzTnVtYmVyKG9iamVjdCkge1xuICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbChvYmplY3QpID09PSBOVU1CRVJfQ0xBU1M7XG4gIH1cblxuICBmdW5jdGlvbiBpc0RhdGUob2JqZWN0KSB7XG4gICAgcmV0dXJuIF90b1N0cmluZy5jYWxsKG9iamVjdCkgPT09IERBVEVfQ0xBU1M7XG4gIH1cblxuICBmdW5jdGlvbiBpc1VuZGVmaW5lZChvYmplY3QpIHtcbiAgICByZXR1cm4gdHlwZW9mIG9iamVjdCA9PT0gXCJ1bmRlZmluZWRcIjtcbiAgfVxuXG4gIGV4dGVuZChPYmplY3QsIHtcbiAgICBleHRlbmQ6ICAgICAgICBleHRlbmQsXG4gICAgaW5zcGVjdDogICAgICAgaW5zcGVjdCxcbiAgICB0b0pTT046ICAgICAgICBOQVRJVkVfSlNPTl9TVFJJTkdJRllfU1VQUE9SVCA/IHN0cmluZ2lmeSA6IHRvSlNPTixcbiAgICB0b1F1ZXJ5U3RyaW5nOiB0b1F1ZXJ5U3RyaW5nLFxuICAgIHRvSFRNTDogICAgICAgIHRvSFRNTCxcbiAgICBrZXlzOiAgICAgICAgICBPYmplY3Qua2V5cyB8fCBrZXlzLFxuICAgIHZhbHVlczogICAgICAgIHZhbHVlcyxcbiAgICBjbG9uZTogICAgICAgICBjbG9uZSxcbiAgICBpc0VsZW1lbnQ6ICAgICBpc0VsZW1lbnQsXG4gICAgaXNBcnJheTogICAgICAgaXNBcnJheSxcbiAgICBpc0hhc2g6ICAgICAgICBpc0hhc2gsXG4gICAgaXNGdW5jdGlvbjogICAgaXNGdW5jdGlvbixcbiAgICBpc1N0cmluZzogICAgICBpc1N0cmluZyxcbiAgICBpc051bWJlcjogICAgICBpc051bWJlcixcbiAgICBpc0RhdGU6ICAgICAgICBpc0RhdGUsXG4gICAgaXNVbmRlZmluZWQ6ICAgaXNVbmRlZmluZWRcbiAgfSk7XG59KSgpO1xuT2JqZWN0LmV4dGVuZChGdW5jdGlvbi5wcm90b3R5cGUsIChmdW5jdGlvbigpIHtcbiAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlO1xuXG4gIGZ1bmN0aW9uIHVwZGF0ZShhcnJheSwgYXJncykge1xuICAgIHZhciBhcnJheUxlbmd0aCA9IGFycmF5Lmxlbmd0aCwgbGVuZ3RoID0gYXJncy5sZW5ndGg7XG4gICAgd2hpbGUgKGxlbmd0aC0tKSBhcnJheVthcnJheUxlbmd0aCArIGxlbmd0aF0gPSBhcmdzW2xlbmd0aF07XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgZnVuY3Rpb24gbWVyZ2UoYXJyYXksIGFyZ3MpIHtcbiAgICBhcnJheSA9IHNsaWNlLmNhbGwoYXJyYXksIDApO1xuICAgIHJldHVybiB1cGRhdGUoYXJyYXksIGFyZ3MpO1xuICB9XG5cbiAgZnVuY3Rpb24gYXJndW1lbnROYW1lcygpIHtcbiAgICB2YXIgbmFtZXMgPSB0aGlzLnRvU3RyaW5nKCkubWF0Y2goL15bXFxzXFwoXSpmdW5jdGlvblteKF0qXFwoKFteKV0qKVxcKS8pWzFdXG4gICAgICAucmVwbGFjZSgvXFwvXFwvLio/W1xcclxcbl18XFwvXFwqKD86LnxbXFxyXFxuXSkqP1xcKlxcLy9nLCAnJylcbiAgICAgIC5yZXBsYWNlKC9cXHMrL2csICcnKS5zcGxpdCgnLCcpO1xuICAgIHJldHVybiBuYW1lcy5sZW5ndGggPT0gMSAmJiAhbmFtZXNbMF0gPyBbXSA6IG5hbWVzO1xuICB9XG5cblxuICBmdW5jdGlvbiBiaW5kKGNvbnRleHQpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIgJiYgT2JqZWN0LmlzVW5kZWZpbmVkKGFyZ3VtZW50c1swXSkpXG4gICAgICByZXR1cm4gdGhpcztcblxuICAgIGlmICghT2JqZWN0LmlzRnVuY3Rpb24odGhpcykpXG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIG9iamVjdCBpcyBub3QgY2FsbGFibGUuXCIpO1xuXG4gICAgdmFyIG5vcCA9IGZ1bmN0aW9uKCkge307XG4gICAgdmFyIF9fbWV0aG9kID0gdGhpcywgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcblxuICAgIHZhciBib3VuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGEgPSBtZXJnZShhcmdzLCBhcmd1bWVudHMpO1xuICAgICAgdmFyIGMgPSB0aGlzIGluc3RhbmNlb2YgYm91bmQgPyB0aGlzIDogY29udGV4dDtcbiAgICAgIHJldHVybiBfX21ldGhvZC5hcHBseShjLCBhKTtcbiAgICB9O1xuXG4gICAgbm9wLnByb3RvdHlwZSAgID0gdGhpcy5wcm90b3R5cGU7XG4gICAgYm91bmQucHJvdG90eXBlID0gbmV3IG5vcCgpO1xuXG4gICAgcmV0dXJuIGJvdW5kO1xuICB9XG5cbiAgZnVuY3Rpb24gYmluZEFzRXZlbnRMaXN0ZW5lcihjb250ZXh0KSB7XG4gICAgdmFyIF9fbWV0aG9kID0gdGhpcywgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICByZXR1cm4gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIHZhciBhID0gdXBkYXRlKFtldmVudCB8fCB3aW5kb3cuZXZlbnRdLCBhcmdzKTtcbiAgICAgIHJldHVybiBfX21ldGhvZC5hcHBseShjb250ZXh0LCBhKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjdXJyeSgpIHtcbiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aGlzO1xuICAgIHZhciBfX21ldGhvZCA9IHRoaXMsIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGEgPSBtZXJnZShhcmdzLCBhcmd1bWVudHMpO1xuICAgICAgcmV0dXJuIF9fbWV0aG9kLmFwcGx5KHRoaXMsIGEpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGRlbGF5KHRpbWVvdXQpIHtcbiAgICB2YXIgX19tZXRob2QgPSB0aGlzLCBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgIHRpbWVvdXQgPSB0aW1lb3V0ICogMTAwMDtcbiAgICByZXR1cm4gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gX19tZXRob2QuYXBwbHkoX19tZXRob2QsIGFyZ3MpO1xuICAgIH0sIHRpbWVvdXQpO1xuICB9XG5cbiAgZnVuY3Rpb24gZGVmZXIoKSB7XG4gICAgdmFyIGFyZ3MgPSB1cGRhdGUoWzAuMDFdLCBhcmd1bWVudHMpO1xuICAgIHJldHVybiB0aGlzLmRlbGF5LmFwcGx5KHRoaXMsIGFyZ3MpO1xuICB9XG5cbiAgZnVuY3Rpb24gd3JhcCh3cmFwcGVyKSB7XG4gICAgdmFyIF9fbWV0aG9kID0gdGhpcztcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYSA9IHVwZGF0ZShbX19tZXRob2QuYmluZCh0aGlzKV0sIGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gd3JhcHBlci5hcHBseSh0aGlzLCBhKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBtZXRob2RpemUoKSB7XG4gICAgaWYgKHRoaXMuX21ldGhvZGl6ZWQpIHJldHVybiB0aGlzLl9tZXRob2RpemVkO1xuICAgIHZhciBfX21ldGhvZCA9IHRoaXM7XG4gICAgcmV0dXJuIHRoaXMuX21ldGhvZGl6ZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBhID0gdXBkYXRlKFt0aGlzXSwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiBfX21ldGhvZC5hcHBseShudWxsLCBhKTtcbiAgICB9O1xuICB9XG5cbiAgdmFyIGV4dGVuc2lvbnMgPSB7XG4gICAgYXJndW1lbnROYW1lczogICAgICAgYXJndW1lbnROYW1lcyxcbiAgICBiaW5kQXNFdmVudExpc3RlbmVyOiBiaW5kQXNFdmVudExpc3RlbmVyLFxuICAgIGN1cnJ5OiAgICAgICAgICAgICAgIGN1cnJ5LFxuICAgIGRlbGF5OiAgICAgICAgICAgICAgIGRlbGF5LFxuICAgIGRlZmVyOiAgICAgICAgICAgICAgIGRlZmVyLFxuICAgIHdyYXA6ICAgICAgICAgICAgICAgIHdyYXAsXG4gICAgbWV0aG9kaXplOiAgICAgICAgICAgbWV0aG9kaXplXG4gIH07XG5cbiAgaWYgKCFGdW5jdGlvbi5wcm90b3R5cGUuYmluZClcbiAgICBleHRlbnNpb25zLmJpbmQgPSBiaW5kO1xuXG4gIHJldHVybiBleHRlbnNpb25zO1xufSkoKSk7XG5cblxuXG4oZnVuY3Rpb24ocHJvdG8pIHtcblxuXG4gIGZ1bmN0aW9uIHRvSVNPU3RyaW5nKCkge1xuICAgIHJldHVybiB0aGlzLmdldFVUQ0Z1bGxZZWFyKCkgKyAnLScgK1xuICAgICAgKHRoaXMuZ2V0VVRDTW9udGgoKSArIDEpLnRvUGFkZGVkU3RyaW5nKDIpICsgJy0nICtcbiAgICAgIHRoaXMuZ2V0VVRDRGF0ZSgpLnRvUGFkZGVkU3RyaW5nKDIpICsgJ1QnICtcbiAgICAgIHRoaXMuZ2V0VVRDSG91cnMoKS50b1BhZGRlZFN0cmluZygyKSArICc6JyArXG4gICAgICB0aGlzLmdldFVUQ01pbnV0ZXMoKS50b1BhZGRlZFN0cmluZygyKSArICc6JyArXG4gICAgICB0aGlzLmdldFVUQ1NlY29uZHMoKS50b1BhZGRlZFN0cmluZygyKSArICdaJztcbiAgfVxuXG5cbiAgZnVuY3Rpb24gdG9KU09OKCkge1xuICAgIHJldHVybiB0aGlzLnRvSVNPU3RyaW5nKCk7XG4gIH1cblxuICBpZiAoIXByb3RvLnRvSVNPU3RyaW5nKSBwcm90by50b0lTT1N0cmluZyA9IHRvSVNPU3RyaW5nO1xuICBpZiAoIXByb3RvLnRvSlNPTikgcHJvdG8udG9KU09OID0gdG9KU09OO1xuXG59KShEYXRlLnByb3RvdHlwZSk7XG5cblxuUmVnRXhwLnByb3RvdHlwZS5tYXRjaCA9IFJlZ0V4cC5wcm90b3R5cGUudGVzdDtcblxuUmVnRXhwLmVzY2FwZSA9IGZ1bmN0aW9uKHN0cikge1xuICByZXR1cm4gU3RyaW5nKHN0cikucmVwbGFjZSgvKFsuKis/Xj0hOiR7fSgpfFtcXF1cXC9cXFxcXSkvZywgJ1xcXFwkMScpO1xufTtcbnZhciBQZXJpb2RpY2FsRXhlY3V0ZXIgPSBDbGFzcy5jcmVhdGUoe1xuICBpbml0aWFsaXplOiBmdW5jdGlvbihjYWxsYmFjaywgZnJlcXVlbmN5KSB7XG4gICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIHRoaXMuZnJlcXVlbmN5ID0gZnJlcXVlbmN5O1xuICAgIHRoaXMuY3VycmVudGx5RXhlY3V0aW5nID0gZmFsc2U7XG5cbiAgICB0aGlzLnJlZ2lzdGVyQ2FsbGJhY2soKTtcbiAgfSxcblxuICByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwodGhpcy5vblRpbWVyRXZlbnQuYmluZCh0aGlzKSwgdGhpcy5mcmVxdWVuY3kgKiAxMDAwKTtcbiAgfSxcblxuICBleGVjdXRlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNhbGxiYWNrKHRoaXMpO1xuICB9LFxuXG4gIHN0b3A6IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy50aW1lcikgcmV0dXJuO1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcik7XG4gICAgdGhpcy50aW1lciA9IG51bGw7XG4gIH0sXG5cbiAgb25UaW1lckV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuY3VycmVudGx5RXhlY3V0aW5nKSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmN1cnJlbnRseUV4ZWN1dGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuZXhlY3V0ZSgpO1xuICAgICAgICB0aGlzLmN1cnJlbnRseUV4ZWN1dGluZyA9IGZhbHNlO1xuICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgIHRoaXMuY3VycmVudGx5RXhlY3V0aW5nID0gZmFsc2U7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcbk9iamVjdC5leHRlbmQoU3RyaW5nLCB7XG4gIGludGVycHJldDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICcnIDogU3RyaW5nKHZhbHVlKTtcbiAgfSxcbiAgc3BlY2lhbENoYXI6IHtcbiAgICAnXFxiJzogJ1xcXFxiJyxcbiAgICAnXFx0JzogJ1xcXFx0JyxcbiAgICAnXFxuJzogJ1xcXFxuJyxcbiAgICAnXFxmJzogJ1xcXFxmJyxcbiAgICAnXFxyJzogJ1xcXFxyJyxcbiAgICAnXFxcXCc6ICdcXFxcXFxcXCdcbiAgfVxufSk7XG5cbk9iamVjdC5leHRlbmQoU3RyaW5nLnByb3RvdHlwZSwgKGZ1bmN0aW9uKCkge1xuICB2YXIgTkFUSVZFX0pTT05fUEFSU0VfU1VQUE9SVCA9IHdpbmRvdy5KU09OICYmXG4gICAgdHlwZW9mIEpTT04ucGFyc2UgPT09ICdmdW5jdGlvbicgJiZcbiAgICBKU09OLnBhcnNlKCd7XCJ0ZXN0XCI6IHRydWV9JykudGVzdDtcblxuICBmdW5jdGlvbiBwcmVwYXJlUmVwbGFjZW1lbnQocmVwbGFjZW1lbnQpIHtcbiAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24ocmVwbGFjZW1lbnQpKSByZXR1cm4gcmVwbGFjZW1lbnQ7XG4gICAgdmFyIHRlbXBsYXRlID0gbmV3IFRlbXBsYXRlKHJlcGxhY2VtZW50KTtcbiAgICByZXR1cm4gZnVuY3Rpb24obWF0Y2gpIHsgcmV0dXJuIHRlbXBsYXRlLmV2YWx1YXRlKG1hdGNoKSB9O1xuICB9XG5cbiAgZnVuY3Rpb24gaXNOb25FbXB0eVJlZ0V4cChyZWdleHApIHtcbiAgICByZXR1cm4gcmVnZXhwLnNvdXJjZSAmJiByZWdleHAuc291cmNlICE9PSAnKD86KSc7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGdzdWIocGF0dGVybiwgcmVwbGFjZW1lbnQpIHtcbiAgICB2YXIgcmVzdWx0ID0gJycsIHNvdXJjZSA9IHRoaXMsIG1hdGNoO1xuICAgIHJlcGxhY2VtZW50ID0gcHJlcGFyZVJlcGxhY2VtZW50KHJlcGxhY2VtZW50KTtcblxuICAgIGlmIChPYmplY3QuaXNTdHJpbmcocGF0dGVybikpXG4gICAgICBwYXR0ZXJuID0gUmVnRXhwLmVzY2FwZShwYXR0ZXJuKTtcblxuICAgIGlmICghKHBhdHRlcm4ubGVuZ3RoIHx8IGlzTm9uRW1wdHlSZWdFeHAocGF0dGVybikpKSB7XG4gICAgICByZXBsYWNlbWVudCA9IHJlcGxhY2VtZW50KCcnKTtcbiAgICAgIHJldHVybiByZXBsYWNlbWVudCArIHNvdXJjZS5zcGxpdCgnJykuam9pbihyZXBsYWNlbWVudCkgKyByZXBsYWNlbWVudDtcbiAgICB9XG5cbiAgICB3aGlsZSAoc291cmNlLmxlbmd0aCA+IDApIHtcbiAgICAgIG1hdGNoID0gc291cmNlLm1hdGNoKHBhdHRlcm4pXG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMF0ubGVuZ3RoID4gMCkge1xuICAgICAgICByZXN1bHQgKz0gc291cmNlLnNsaWNlKDAsIG1hdGNoLmluZGV4KTtcbiAgICAgICAgcmVzdWx0ICs9IFN0cmluZy5pbnRlcnByZXQocmVwbGFjZW1lbnQobWF0Y2gpKTtcbiAgICAgICAgc291cmNlICA9IHNvdXJjZS5zbGljZShtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgKz0gc291cmNlLCBzb3VyY2UgPSAnJztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN1YihwYXR0ZXJuLCByZXBsYWNlbWVudCwgY291bnQpIHtcbiAgICByZXBsYWNlbWVudCA9IHByZXBhcmVSZXBsYWNlbWVudChyZXBsYWNlbWVudCk7XG4gICAgY291bnQgPSBPYmplY3QuaXNVbmRlZmluZWQoY291bnQpID8gMSA6IGNvdW50O1xuXG4gICAgcmV0dXJuIHRoaXMuZ3N1YihwYXR0ZXJuLCBmdW5jdGlvbihtYXRjaCkge1xuICAgICAgaWYgKC0tY291bnQgPCAwKSByZXR1cm4gbWF0Y2hbMF07XG4gICAgICByZXR1cm4gcmVwbGFjZW1lbnQobWF0Y2gpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2NhbihwYXR0ZXJuLCBpdGVyYXRvcikge1xuICAgIHRoaXMuZ3N1YihwYXR0ZXJuLCBpdGVyYXRvcik7XG4gICAgcmV0dXJuIFN0cmluZyh0aGlzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRydW5jYXRlKGxlbmd0aCwgdHJ1bmNhdGlvbikge1xuICAgIGxlbmd0aCA9IGxlbmd0aCB8fCAzMDtcbiAgICB0cnVuY2F0aW9uID0gT2JqZWN0LmlzVW5kZWZpbmVkKHRydW5jYXRpb24pID8gJy4uLicgOiB0cnVuY2F0aW9uO1xuICAgIHJldHVybiB0aGlzLmxlbmd0aCA+IGxlbmd0aCA/XG4gICAgICB0aGlzLnNsaWNlKDAsIGxlbmd0aCAtIHRydW5jYXRpb24ubGVuZ3RoKSArIHRydW5jYXRpb24gOiBTdHJpbmcodGhpcyk7XG4gIH1cblxuICBmdW5jdGlvbiBzdHJpcCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9eXFxzKy8sICcnKS5yZXBsYWNlKC9cXHMrJC8sICcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0cmlwVGFncygpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC88XFx3KyhcXHMrKFwiW15cIl0qXCJ8J1teJ10qJ3xbXj5dKSspPz58PFxcL1xcdys+L2dpLCAnJyk7XG4gIH1cblxuICBmdW5jdGlvbiBzdHJpcFNjcmlwdHMoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZShuZXcgUmVnRXhwKFByb3RvdHlwZS5TY3JpcHRGcmFnbWVudCwgJ2ltZycpLCAnJyk7XG4gIH1cblxuICBmdW5jdGlvbiBleHRyYWN0U2NyaXB0cygpIHtcbiAgICB2YXIgbWF0Y2hBbGwgPSBuZXcgUmVnRXhwKFByb3RvdHlwZS5TY3JpcHRGcmFnbWVudCwgJ2ltZycpLFxuICAgICAgICBtYXRjaE9uZSA9IG5ldyBSZWdFeHAoUHJvdG90eXBlLlNjcmlwdEZyYWdtZW50LCAnaW0nKTtcbiAgICByZXR1cm4gKHRoaXMubWF0Y2gobWF0Y2hBbGwpIHx8IFtdKS5tYXAoZnVuY3Rpb24oc2NyaXB0VGFnKSB7XG4gICAgICByZXR1cm4gKHNjcmlwdFRhZy5tYXRjaChtYXRjaE9uZSkgfHwgWycnLCAnJ10pWzFdO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZXZhbFNjcmlwdHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZXh0cmFjdFNjcmlwdHMoKS5tYXAoZnVuY3Rpb24oc2NyaXB0KSB7IHJldHVybiBldmFsKHNjcmlwdCk7IH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZXNjYXBlSFRNTCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC8mL2csJyZhbXA7JykucmVwbGFjZSgvPC9nLCcmbHQ7JykucmVwbGFjZSgvPi9nLCcmZ3Q7Jyk7XG4gIH1cblxuICBmdW5jdGlvbiB1bmVzY2FwZUhUTUwoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBUYWdzKCkucmVwbGFjZSgvJmx0Oy9nLCc8JykucmVwbGFjZSgvJmd0Oy9nLCc+JykucmVwbGFjZSgvJmFtcDsvZywnJicpO1xuICB9XG5cblxuICBmdW5jdGlvbiB0b1F1ZXJ5UGFyYW1zKHNlcGFyYXRvcikge1xuICAgIHZhciBtYXRjaCA9IHRoaXMuc3RyaXAoKS5tYXRjaCgvKFtePyNdKikoIy4qKT8kLyk7XG4gICAgaWYgKCFtYXRjaCkgcmV0dXJuIHsgfTtcblxuICAgIHJldHVybiBtYXRjaFsxXS5zcGxpdChzZXBhcmF0b3IgfHwgJyYnKS5pbmplY3QoeyB9LCBmdW5jdGlvbihoYXNoLCBwYWlyKSB7XG4gICAgICBpZiAoKHBhaXIgPSBwYWlyLnNwbGl0KCc9JykpWzBdKSB7XG4gICAgICAgIHZhciBrZXkgPSBkZWNvZGVVUklDb21wb25lbnQocGFpci5zaGlmdCgpKSxcbiAgICAgICAgICAgIHZhbHVlID0gcGFpci5sZW5ndGggPiAxID8gcGFpci5qb2luKCc9JykgOiBwYWlyWzBdO1xuXG4gICAgICAgIGlmICh2YWx1ZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmdzdWIoJysnLCAnICcpO1xuICAgICAgICAgIHZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChrZXkgaW4gaGFzaCkge1xuICAgICAgICAgIGlmICghT2JqZWN0LmlzQXJyYXkoaGFzaFtrZXldKSkgaGFzaFtrZXldID0gW2hhc2hba2V5XV07XG4gICAgICAgICAgaGFzaFtrZXldLnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaGFzaFtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gaGFzaDtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvQXJyYXkoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3BsaXQoJycpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3VjYygpIHtcbiAgICByZXR1cm4gdGhpcy5zbGljZSgwLCB0aGlzLmxlbmd0aCAtIDEpICtcbiAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5jaGFyQ29kZUF0KHRoaXMubGVuZ3RoIC0gMSkgKyAxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRpbWVzKGNvdW50KSB7XG4gICAgcmV0dXJuIGNvdW50IDwgMSA/ICcnIDogbmV3IEFycmF5KGNvdW50ICsgMSkuam9pbih0aGlzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbWVsaXplKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoLy0rKC4pPy9nLCBmdW5jdGlvbihtYXRjaCwgY2hyKSB7XG4gICAgICByZXR1cm4gY2hyID8gY2hyLnRvVXBwZXJDYXNlKCkgOiAnJztcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhcGl0YWxpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLnN1YnN0cmluZygxKS50b0xvd2VyQ2FzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gdW5kZXJzY29yZSgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC86Oi9nLCAnLycpXG4gICAgICAgICAgICAgICAucmVwbGFjZSgvKFtBLVpdKykoW0EtWl1bYS16XSkvZywgJyQxXyQyJylcbiAgICAgICAgICAgICAgIC5yZXBsYWNlKC8oW2EtelxcZF0pKFtBLVpdKS9nLCAnJDFfJDInKVxuICAgICAgICAgICAgICAgLnJlcGxhY2UoLy0vZywgJ18nKVxuICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBkYXNoZXJpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXy9nLCAnLScpO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5zcGVjdCh1c2VEb3VibGVRdW90ZXMpIHtcbiAgICB2YXIgZXNjYXBlZFN0cmluZyA9IHRoaXMucmVwbGFjZSgvW1xceDAwLVxceDFmXFxcXF0vZywgZnVuY3Rpb24oY2hhcmFjdGVyKSB7XG4gICAgICBpZiAoY2hhcmFjdGVyIGluIFN0cmluZy5zcGVjaWFsQ2hhcikge1xuICAgICAgICByZXR1cm4gU3RyaW5nLnNwZWNpYWxDaGFyW2NoYXJhY3Rlcl07XG4gICAgICB9XG4gICAgICByZXR1cm4gJ1xcXFx1MDAnICsgY2hhcmFjdGVyLmNoYXJDb2RlQXQoKS50b1BhZGRlZFN0cmluZygyLCAxNik7XG4gICAgfSk7XG4gICAgaWYgKHVzZURvdWJsZVF1b3RlcykgcmV0dXJuICdcIicgKyBlc2NhcGVkU3RyaW5nLnJlcGxhY2UoL1wiL2csICdcXFxcXCInKSArICdcIic7XG4gICAgcmV0dXJuIFwiJ1wiICsgZXNjYXBlZFN0cmluZy5yZXBsYWNlKC8nL2csICdcXFxcXFwnJykgKyBcIidcIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVuZmlsdGVySlNPTihmaWx0ZXIpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKGZpbHRlciB8fCBQcm90b3R5cGUuSlNPTkZpbHRlciwgJyQxJyk7XG4gIH1cblxuICBmdW5jdGlvbiBpc0pTT04oKSB7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG4gICAgaWYgKHN0ci5ibGFuaygpKSByZXR1cm4gZmFsc2U7XG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL1xcXFwoPzpbXCJcXFxcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZywgJ0AnKTtcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXCJbXlwiXFxcXFxcblxccl0qXCJ8dHJ1ZXxmYWxzZXxudWxsfC0/XFxkKyg/OlxcLlxcZCopPyg/OltlRV1bK1xcLV0/XFxkKyk/L2csICddJyk7XG4gICAgc3RyID0gc3RyLnJlcGxhY2UoLyg/Ol58OnwsKSg/OlxccypcXFspKy9nLCAnJyk7XG4gICAgcmV0dXJuICgvXltcXF0sOnt9XFxzXSokLykudGVzdChzdHIpO1xuICB9XG5cbiAgZnVuY3Rpb24gZXZhbEpTT04oc2FuaXRpemUpIHtcbiAgICB2YXIganNvbiA9IHRoaXMudW5maWx0ZXJKU09OKCksXG4gICAgICAgIGN4ID0gL1tcXHUwMDAwXFx1MDBhZFxcdTA2MDAtXFx1MDYwNFxcdTA3MGZcXHUxN2I0XFx1MTdiNVxcdTIwMGMtXFx1MjAwZlxcdTIwMjgtXFx1MjAyZlxcdTIwNjAtXFx1MjA2ZlxcdWZlZmZcXHVmZmYwLVxcdWZmZmZdL2c7XG4gICAgaWYgKGN4LnRlc3QoanNvbikpIHtcbiAgICAgIGpzb24gPSBqc29uLnJlcGxhY2UoY3gsIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHJldHVybiAnXFxcXHUnICsgKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgaWYgKCFzYW5pdGl6ZSB8fCBqc29uLmlzSlNPTigpKSByZXR1cm4gZXZhbCgnKCcgKyBqc29uICsgJyknKTtcbiAgICB9IGNhdGNoIChlKSB7IH1cbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoJ0JhZGx5IGZvcm1lZCBKU09OIHN0cmluZzogJyArIHRoaXMuaW5zcGVjdCgpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlSlNPTigpIHtcbiAgICB2YXIganNvbiA9IHRoaXMudW5maWx0ZXJKU09OKCk7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoanNvbik7XG4gIH1cblxuICBmdW5jdGlvbiBpbmNsdWRlKHBhdHRlcm4pIHtcbiAgICByZXR1cm4gdGhpcy5pbmRleE9mKHBhdHRlcm4pID4gLTE7XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydHNXaXRoKHBhdHRlcm4sIHBvc2l0aW9uKSB7XG4gICAgcG9zaXRpb24gPSBPYmplY3QuaXNOdW1iZXIocG9zaXRpb24pID8gcG9zaXRpb24gOiAwO1xuICAgIHJldHVybiB0aGlzLmxhc3RJbmRleE9mKHBhdHRlcm4sIHBvc2l0aW9uKSA9PT0gcG9zaXRpb247XG4gIH1cblxuICBmdW5jdGlvbiBlbmRzV2l0aChwYXR0ZXJuLCBwb3NpdGlvbikge1xuICAgIHBhdHRlcm4gPSBTdHJpbmcocGF0dGVybik7XG4gICAgcG9zaXRpb24gPSBPYmplY3QuaXNOdW1iZXIocG9zaXRpb24pID8gcG9zaXRpb24gOiB0aGlzLmxlbmd0aDtcbiAgICBpZiAocG9zaXRpb24gPCAwKSBwb3NpdGlvbiA9IDA7XG4gICAgaWYgKHBvc2l0aW9uID4gdGhpcy5sZW5ndGgpIHBvc2l0aW9uID0gdGhpcy5sZW5ndGg7XG4gICAgdmFyIGQgPSBwb3NpdGlvbiAtIHBhdHRlcm4ubGVuZ3RoO1xuICAgIHJldHVybiBkID49IDAgJiYgdGhpcy5pbmRleE9mKHBhdHRlcm4sIGQpID09PSBkO1xuICB9XG5cbiAgZnVuY3Rpb24gZW1wdHkoKSB7XG4gICAgcmV0dXJuIHRoaXMgPT0gJyc7XG4gIH1cblxuICBmdW5jdGlvbiBibGFuaygpIHtcbiAgICByZXR1cm4gL15cXHMqJC8udGVzdCh0aGlzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGludGVycG9sYXRlKG9iamVjdCwgcGF0dGVybikge1xuICAgIHJldHVybiBuZXcgVGVtcGxhdGUodGhpcywgcGF0dGVybikuZXZhbHVhdGUob2JqZWN0KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgZ3N1YjogICAgICAgICAgIGdzdWIsXG4gICAgc3ViOiAgICAgICAgICAgIHN1YixcbiAgICBzY2FuOiAgICAgICAgICAgc2NhbixcbiAgICB0cnVuY2F0ZTogICAgICAgdHJ1bmNhdGUsXG4gICAgc3RyaXA6ICAgICAgICAgIFN0cmluZy5wcm90b3R5cGUudHJpbSB8fCBzdHJpcCxcbiAgICBzdHJpcFRhZ3M6ICAgICAgc3RyaXBUYWdzLFxuICAgIHN0cmlwU2NyaXB0czogICBzdHJpcFNjcmlwdHMsXG4gICAgZXh0cmFjdFNjcmlwdHM6IGV4dHJhY3RTY3JpcHRzLFxuICAgIGV2YWxTY3JpcHRzOiAgICBldmFsU2NyaXB0cyxcbiAgICBlc2NhcGVIVE1MOiAgICAgZXNjYXBlSFRNTCxcbiAgICB1bmVzY2FwZUhUTUw6ICAgdW5lc2NhcGVIVE1MLFxuICAgIHRvUXVlcnlQYXJhbXM6ICB0b1F1ZXJ5UGFyYW1zLFxuICAgIHBhcnNlUXVlcnk6ICAgICB0b1F1ZXJ5UGFyYW1zLFxuICAgIHRvQXJyYXk6ICAgICAgICB0b0FycmF5LFxuICAgIHN1Y2M6ICAgICAgICAgICBzdWNjLFxuICAgIHRpbWVzOiAgICAgICAgICB0aW1lcyxcbiAgICBjYW1lbGl6ZTogICAgICAgY2FtZWxpemUsXG4gICAgY2FwaXRhbGl6ZTogICAgIGNhcGl0YWxpemUsXG4gICAgdW5kZXJzY29yZTogICAgIHVuZGVyc2NvcmUsXG4gICAgZGFzaGVyaXplOiAgICAgIGRhc2hlcml6ZSxcbiAgICBpbnNwZWN0OiAgICAgICAgaW5zcGVjdCxcbiAgICB1bmZpbHRlckpTT046ICAgdW5maWx0ZXJKU09OLFxuICAgIGlzSlNPTjogICAgICAgICBpc0pTT04sXG4gICAgZXZhbEpTT046ICAgICAgIE5BVElWRV9KU09OX1BBUlNFX1NVUFBPUlQgPyBwYXJzZUpTT04gOiBldmFsSlNPTixcbiAgICBpbmNsdWRlOiAgICAgICAgaW5jbHVkZSxcbiAgICBzdGFydHNXaXRoOiAgICAgU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoIHx8IHN0YXJ0c1dpdGgsXG4gICAgZW5kc1dpdGg6ICAgICAgIFN0cmluZy5wcm90b3R5cGUuZW5kc1dpdGggfHwgZW5kc1dpdGgsXG4gICAgZW1wdHk6ICAgICAgICAgIGVtcHR5LFxuICAgIGJsYW5rOiAgICAgICAgICBibGFuayxcbiAgICBpbnRlcnBvbGF0ZTogICAgaW50ZXJwb2xhdGVcbiAgfTtcbn0pKCkpO1xuXG52YXIgVGVtcGxhdGUgPSBDbGFzcy5jcmVhdGUoe1xuICBpbml0aWFsaXplOiBmdW5jdGlvbih0ZW1wbGF0ZSwgcGF0dGVybikge1xuICAgIHRoaXMudGVtcGxhdGUgPSB0ZW1wbGF0ZS50b1N0cmluZygpO1xuICAgIHRoaXMucGF0dGVybiA9IHBhdHRlcm4gfHwgVGVtcGxhdGUuUGF0dGVybjtcbiAgfSxcblxuICBldmFsdWF0ZTogZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgaWYgKG9iamVjdCAmJiBPYmplY3QuaXNGdW5jdGlvbihvYmplY3QudG9UZW1wbGF0ZVJlcGxhY2VtZW50cykpXG4gICAgICBvYmplY3QgPSBvYmplY3QudG9UZW1wbGF0ZVJlcGxhY2VtZW50cygpO1xuXG4gICAgcmV0dXJuIHRoaXMudGVtcGxhdGUuZ3N1Yih0aGlzLnBhdHRlcm4sIGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiAobWF0Y2hbMV0gKyAnJyk7XG5cbiAgICAgIHZhciBiZWZvcmUgPSBtYXRjaFsxXSB8fCAnJztcbiAgICAgIGlmIChiZWZvcmUgPT0gJ1xcXFwnKSByZXR1cm4gbWF0Y2hbMl07XG5cbiAgICAgIHZhciBjdHggPSBvYmplY3QsIGV4cHIgPSBtYXRjaFszXSxcbiAgICAgICAgICBwYXR0ZXJuID0gL14oW14uW10rfFxcWygoPzouKj9bXlxcXFxdKT8pXFxdKShcXC58XFxbfCQpLztcblxuICAgICAgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoZXhwcik7XG4gICAgICBpZiAobWF0Y2ggPT0gbnVsbCkgcmV0dXJuIGJlZm9yZTtcblxuICAgICAgd2hpbGUgKG1hdGNoICE9IG51bGwpIHtcbiAgICAgICAgdmFyIGNvbXAgPSBtYXRjaFsxXS5zdGFydHNXaXRoKCdbJykgPyBtYXRjaFsyXS5yZXBsYWNlKC9cXFxcXFxcXF0vZywgJ10nKSA6IG1hdGNoWzFdO1xuICAgICAgICBjdHggPSBjdHhbY29tcF07XG4gICAgICAgIGlmIChudWxsID09IGN0eCB8fCAnJyA9PSBtYXRjaFszXSkgYnJlYWs7XG4gICAgICAgIGV4cHIgPSBleHByLnN1YnN0cmluZygnWycgPT0gbWF0Y2hbM10gPyBtYXRjaFsxXS5sZW5ndGggOiBtYXRjaFswXS5sZW5ndGgpO1xuICAgICAgICBtYXRjaCA9IHBhdHRlcm4uZXhlYyhleHByKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGJlZm9yZSArIFN0cmluZy5pbnRlcnByZXQoY3R4KTtcbiAgICB9KTtcbiAgfVxufSk7XG5UZW1wbGF0ZS5QYXR0ZXJuID0gLyhefC58XFxyfFxcbikoI1xceyguKj8pXFx9KS87XG5cbnZhciAkYnJlYWsgPSB7IH07XG5cbnZhciBFbnVtZXJhYmxlID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBlYWNoKGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuX2VhY2goaXRlcmF0b3IsIGNvbnRleHQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChlICE9ICRicmVhaykgdGhyb3cgZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmdW5jdGlvbiBlYWNoU2xpY2UobnVtYmVyLCBpdGVyYXRvciwgY29udGV4dCkge1xuICAgIHZhciBpbmRleCA9IC1udW1iZXIsIHNsaWNlcyA9IFtdLCBhcnJheSA9IHRoaXMudG9BcnJheSgpO1xuICAgIGlmIChudW1iZXIgPCAxKSByZXR1cm4gYXJyYXk7XG4gICAgd2hpbGUgKChpbmRleCArPSBudW1iZXIpIDwgYXJyYXkubGVuZ3RoKVxuICAgICAgc2xpY2VzLnB1c2goYXJyYXkuc2xpY2UoaW5kZXgsIGluZGV4K251bWJlcikpO1xuICAgIHJldHVybiBzbGljZXMuY29sbGVjdChpdGVyYXRvciwgY29udGV4dCk7XG4gIH1cblxuICBmdW5jdGlvbiBhbGwoaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuICAgIHZhciByZXN1bHQgPSB0cnVlO1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAhIWl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCB0aGlzKTtcbiAgICAgIGlmICghcmVzdWx0KSB0aHJvdyAkYnJlYWs7XG4gICAgfSwgdGhpcyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFueShpdGVyYXRvciwgY29udGV4dCkge1xuICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7XG4gICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIGlmIChyZXN1bHQgPSAhIWl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCB0aGlzKSlcbiAgICAgICAgdGhyb3cgJGJyZWFrO1xuICAgIH0sIHRoaXMpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBjb2xsZWN0KGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBQcm90b3R5cGUuSztcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIHJlc3VsdHMucHVzaChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgdGhpcykpO1xuICAgIH0sIHRoaXMpO1xuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgZnVuY3Rpb24gZGV0ZWN0KGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdDtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG4gICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIHRoaXMpKSB7XG4gICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICB0aHJvdyAkYnJlYWs7XG4gICAgICB9XG4gICAgfSwgdGhpcyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRBbGwoaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIGlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgdGhpcykpXG4gICAgICAgIHJlc3VsdHMucHVzaCh2YWx1ZSk7XG4gICAgfSwgdGhpcyk7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBncmVwKGZpbHRlciwgaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuICAgIHZhciByZXN1bHRzID0gW107XG5cbiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKGZpbHRlcikpXG4gICAgICBmaWx0ZXIgPSBuZXcgUmVnRXhwKFJlZ0V4cC5lc2NhcGUoZmlsdGVyKSk7XG5cbiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG4gICAgICBpZiAoZmlsdGVyLm1hdGNoKHZhbHVlKSlcbiAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCB0aGlzKSk7XG4gICAgfSwgdGhpcyk7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiBpbmNsdWRlKG9iamVjdCkge1xuICAgIGlmIChPYmplY3QuaXNGdW5jdGlvbih0aGlzLmluZGV4T2YpICYmIHRoaXMuaW5kZXhPZihvYmplY3QpICE9IC0xKVxuICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICB2YXIgZm91bmQgPSBmYWxzZTtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICh2YWx1ZSA9PSBvYmplY3QpIHtcbiAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICB0aHJvdyAkYnJlYWs7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvdW5kO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5Hcm91cHNPZihudW1iZXIsIGZpbGxXaXRoKSB7XG4gICAgZmlsbFdpdGggPSBPYmplY3QuaXNVbmRlZmluZWQoZmlsbFdpdGgpID8gbnVsbCA6IGZpbGxXaXRoO1xuICAgIHJldHVybiB0aGlzLmVhY2hTbGljZShudW1iZXIsIGZ1bmN0aW9uKHNsaWNlKSB7XG4gICAgICB3aGlsZShzbGljZS5sZW5ndGggPCBudW1iZXIpIHNsaWNlLnB1c2goZmlsbFdpdGgpO1xuICAgICAgcmV0dXJuIHNsaWNlO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5qZWN0KG1lbW8sIGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgbWVtbyA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgbWVtbywgdmFsdWUsIGluZGV4LCB0aGlzKTtcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gbWVtbztcbiAgfVxuXG4gIGZ1bmN0aW9uIGludm9rZShtZXRob2QpIHtcbiAgICB2YXIgYXJncyA9ICRBKGFyZ3VtZW50cykuc2xpY2UoMSk7XG4gICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWVbbWV0aG9kXS5hcHBseSh2YWx1ZSwgYXJncyk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBtYXgoaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuICAgIHZhciByZXN1bHQ7XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgdmFsdWUgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgdGhpcyk7XG4gICAgICBpZiAocmVzdWx0ID09IG51bGwgfHwgdmFsdWUgPj0gcmVzdWx0KVxuICAgICAgICByZXN1bHQgPSB2YWx1ZTtcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZnVuY3Rpb24gbWluKGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBQcm90b3R5cGUuSztcbiAgICB2YXIgcmVzdWx0O1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIHZhbHVlID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIHRoaXMpO1xuICAgICAgaWYgKHJlc3VsdCA9PSBudWxsIHx8IHZhbHVlIDwgcmVzdWx0KVxuICAgICAgICByZXN1bHQgPSB2YWx1ZTtcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZnVuY3Rpb24gcGFydGl0aW9uKGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBQcm90b3R5cGUuSztcbiAgICB2YXIgdHJ1ZXMgPSBbXSwgZmFsc2VzID0gW107XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCB0aGlzKSA/XG4gICAgICAgIHRydWVzIDogZmFsc2VzKS5wdXNoKHZhbHVlKTtcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gW3RydWVzLCBmYWxzZXNdO1xuICB9XG5cbiAgZnVuY3Rpb24gcGx1Y2socHJvcGVydHkpIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmVzdWx0cy5wdXNoKHZhbHVlW3Byb3BlcnR5XSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBmdW5jdGlvbiByZWplY3QoaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIGlmICghaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIHRoaXMpKVxuICAgICAgICByZXN1bHRzLnB1c2godmFsdWUpO1xuICAgIH0sIHRoaXMpO1xuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgZnVuY3Rpb24gc29ydEJ5KGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICBjcml0ZXJpYTogaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIHRoaXMpXG4gICAgICB9O1xuICAgIH0sIHRoaXMpLnNvcnQoZnVuY3Rpb24obGVmdCwgcmlnaHQpIHtcbiAgICAgIHZhciBhID0gbGVmdC5jcml0ZXJpYSwgYiA9IHJpZ2h0LmNyaXRlcmlhO1xuICAgICAgcmV0dXJuIGEgPCBiID8gLTEgOiBhID4gYiA/IDEgOiAwO1xuICAgIH0pLnBsdWNrKCd2YWx1ZScpO1xuICB9XG5cbiAgZnVuY3Rpb24gdG9BcnJheSgpIHtcbiAgICByZXR1cm4gdGhpcy5tYXAoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHppcCgpIHtcbiAgICB2YXIgaXRlcmF0b3IgPSBQcm90b3R5cGUuSywgYXJncyA9ICRBKGFyZ3VtZW50cyk7XG4gICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKGFyZ3MubGFzdCgpKSlcbiAgICAgIGl0ZXJhdG9yID0gYXJncy5wb3AoKTtcblxuICAgIHZhciBjb2xsZWN0aW9ucyA9IFt0aGlzXS5jb25jYXQoYXJncykubWFwKCRBKTtcbiAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG4gICAgICByZXR1cm4gaXRlcmF0b3IoY29sbGVjdGlvbnMucGx1Y2soaW5kZXgpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmxlbmd0aDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluc3BlY3QoKSB7XG4gICAgcmV0dXJuICcjPEVudW1lcmFibGU6JyArIHRoaXMudG9BcnJheSgpLmluc3BlY3QoKSArICc+JztcbiAgfVxuXG5cblxuXG5cblxuXG5cblxuICByZXR1cm4ge1xuICAgIGVhY2g6ICAgICAgIGVhY2gsXG4gICAgZWFjaFNsaWNlOiAgZWFjaFNsaWNlLFxuICAgIGFsbDogICAgICAgIGFsbCxcbiAgICBldmVyeTogICAgICBhbGwsXG4gICAgYW55OiAgICAgICAgYW55LFxuICAgIHNvbWU6ICAgICAgIGFueSxcbiAgICBjb2xsZWN0OiAgICBjb2xsZWN0LFxuICAgIG1hcDogICAgICAgIGNvbGxlY3QsXG4gICAgZGV0ZWN0OiAgICAgZGV0ZWN0LFxuICAgIGZpbmRBbGw6ICAgIGZpbmRBbGwsXG4gICAgc2VsZWN0OiAgICAgZmluZEFsbCxcbiAgICBmaWx0ZXI6ICAgICBmaW5kQWxsLFxuICAgIGdyZXA6ICAgICAgIGdyZXAsXG4gICAgaW5jbHVkZTogICAgaW5jbHVkZSxcbiAgICBtZW1iZXI6ICAgICBpbmNsdWRlLFxuICAgIGluR3JvdXBzT2Y6IGluR3JvdXBzT2YsXG4gICAgaW5qZWN0OiAgICAgaW5qZWN0LFxuICAgIGludm9rZTogICAgIGludm9rZSxcbiAgICBtYXg6ICAgICAgICBtYXgsXG4gICAgbWluOiAgICAgICAgbWluLFxuICAgIHBhcnRpdGlvbjogIHBhcnRpdGlvbixcbiAgICBwbHVjazogICAgICBwbHVjayxcbiAgICByZWplY3Q6ICAgICByZWplY3QsXG4gICAgc29ydEJ5OiAgICAgc29ydEJ5LFxuICAgIHRvQXJyYXk6ICAgIHRvQXJyYXksXG4gICAgZW50cmllczogICAgdG9BcnJheSxcbiAgICB6aXA6ICAgICAgICB6aXAsXG4gICAgc2l6ZTogICAgICAgc2l6ZSxcbiAgICBpbnNwZWN0OiAgICBpbnNwZWN0LFxuICAgIGZpbmQ6ICAgICAgIGRldGVjdFxuICB9O1xufSkoKTtcblxuZnVuY3Rpb24gJEEoaXRlcmFibGUpIHtcbiAgaWYgKCFpdGVyYWJsZSkgcmV0dXJuIFtdO1xuICBpZiAoJ3RvQXJyYXknIGluIE9iamVjdChpdGVyYWJsZSkpIHJldHVybiBpdGVyYWJsZS50b0FycmF5KCk7XG4gIHZhciBsZW5ndGggPSBpdGVyYWJsZS5sZW5ndGggfHwgMCwgcmVzdWx0cyA9IG5ldyBBcnJheShsZW5ndGgpO1xuICB3aGlsZSAobGVuZ3RoLS0pIHJlc3VsdHNbbGVuZ3RoXSA9IGl0ZXJhYmxlW2xlbmd0aF07XG4gIHJldHVybiByZXN1bHRzO1xufVxuXG5cbmZ1bmN0aW9uICR3KHN0cmluZykge1xuICBpZiAoIU9iamVjdC5pc1N0cmluZyhzdHJpbmcpKSByZXR1cm4gW107XG4gIHN0cmluZyA9IHN0cmluZy5zdHJpcCgpO1xuICByZXR1cm4gc3RyaW5nID8gc3RyaW5nLnNwbGl0KC9cXHMrLykgOiBbXTtcbn1cblxuQXJyYXkuZnJvbSA9ICRBO1xuXG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIGFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGUsXG4gICAgICBzbGljZSA9IGFycmF5UHJvdG8uc2xpY2UsXG4gICAgICBfZWFjaCA9IGFycmF5UHJvdG8uZm9yRWFjaDsgLy8gdXNlIG5hdGl2ZSBicm93c2VyIEpTIDEuNiBpbXBsZW1lbnRhdGlvbiBpZiBhdmFpbGFibGVcblxuICBmdW5jdGlvbiBlYWNoKGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IHRoaXMubGVuZ3RoID4+PiAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChpIGluIHRoaXMpIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdGhpc1tpXSwgaSwgdGhpcyk7XG4gICAgfVxuICB9XG4gIGlmICghX2VhY2gpIF9lYWNoID0gZWFjaDtcblxuICBmdW5jdGlvbiBjbGVhcigpIHtcbiAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmdW5jdGlvbiBmaXJzdCgpIHtcbiAgICByZXR1cm4gdGhpc1swXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxhc3QoKSB7XG4gICAgcmV0dXJuIHRoaXNbdGhpcy5sZW5ndGggLSAxXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNvbXBhY3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0KGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbDtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZsYXR0ZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5qZWN0KFtdLCBmdW5jdGlvbihhcnJheSwgdmFsdWUpIHtcbiAgICAgIGlmIChPYmplY3QuaXNBcnJheSh2YWx1ZSkpXG4gICAgICAgIHJldHVybiBhcnJheS5jb25jYXQodmFsdWUuZmxhdHRlbigpKTtcbiAgICAgIGFycmF5LnB1c2godmFsdWUpO1xuICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gd2l0aG91dCgpIHtcbiAgICB2YXIgdmFsdWVzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDApO1xuICAgIHJldHVybiB0aGlzLnNlbGVjdChmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmV0dXJuICF2YWx1ZXMuaW5jbHVkZSh2YWx1ZSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiByZXZlcnNlKGlubGluZSkge1xuICAgIHJldHVybiAoaW5saW5lID09PSBmYWxzZSA/IHRoaXMudG9BcnJheSgpIDogdGhpcykuX3JldmVyc2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVuaXEoc29ydGVkKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5qZWN0KFtdLCBmdW5jdGlvbihhcnJheSwgdmFsdWUsIGluZGV4KSB7XG4gICAgICBpZiAoMCA9PSBpbmRleCB8fCAoc29ydGVkID8gYXJyYXkubGFzdCgpICE9IHZhbHVlIDogIWFycmF5LmluY2x1ZGUodmFsdWUpKSlcbiAgICAgICAgYXJyYXkucHVzaCh2YWx1ZSk7XG4gICAgICByZXR1cm4gYXJyYXk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBpbnRlcnNlY3QoYXJyYXkpIHtcbiAgICByZXR1cm4gdGhpcy51bmlxKCkuZmluZEFsbChmdW5jdGlvbihpdGVtKSB7XG4gICAgICByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtKSAhPT0gLTE7XG4gICAgfSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGNsb25lKCkge1xuICAgIHJldHVybiBzbGljZS5jYWxsKHRoaXMsIDApO1xuICB9XG5cbiAgZnVuY3Rpb24gc2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5sZW5ndGg7XG4gIH1cblxuICBmdW5jdGlvbiBpbnNwZWN0KCkge1xuICAgIHJldHVybiAnWycgKyB0aGlzLm1hcChPYmplY3QuaW5zcGVjdCkuam9pbignLCAnKSArICddJztcbiAgfVxuXG4gIGZ1bmN0aW9uIGluZGV4T2YoaXRlbSwgaSkge1xuICAgIGlmICh0aGlzID09IG51bGwpIHRocm93IG5ldyBUeXBlRXJyb3IoKTtcblxuICAgIHZhciBhcnJheSA9IE9iamVjdCh0aGlzKSwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoID4+PiAwO1xuICAgIGlmIChsZW5ndGggPT09IDApIHJldHVybiAtMTtcblxuICAgIGkgPSBOdW1iZXIoaSk7XG4gICAgaWYgKGlzTmFOKGkpKSB7XG4gICAgICBpID0gMDtcbiAgICB9IGVsc2UgaWYgKGkgIT09IDAgJiYgaXNGaW5pdGUoaSkpIHtcbiAgICAgIGkgPSAoaSA+IDAgPyAxIDogLTEpICogTWF0aC5mbG9vcihNYXRoLmFicyhpKSk7XG4gICAgfVxuXG4gICAgaWYgKGkgPiBsZW5ndGgpIHJldHVybiAtMTtcblxuICAgIHZhciBrID0gaSA+PSAwID8gaSA6IE1hdGgubWF4KGxlbmd0aCAtIE1hdGguYWJzKGkpLCAwKTtcbiAgICBmb3IgKDsgayA8IGxlbmd0aDsgaysrKVxuICAgICAgaWYgKGsgaW4gYXJyYXkgJiYgYXJyYXlba10gPT09IGl0ZW0pIHJldHVybiBrO1xuICAgIHJldHVybiAtMTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gbGFzdEluZGV4T2YoaXRlbSwgaSkge1xuICAgIGlmICh0aGlzID09IG51bGwpIHRocm93IG5ldyBUeXBlRXJyb3IoKTtcblxuICAgIHZhciBhcnJheSA9IE9iamVjdCh0aGlzKSwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoID4+PiAwO1xuICAgIGlmIChsZW5ndGggPT09IDApIHJldHVybiAtMTtcblxuICAgIGlmICghT2JqZWN0LmlzVW5kZWZpbmVkKGkpKSB7XG4gICAgICBpID0gTnVtYmVyKGkpO1xuICAgICAgaWYgKGlzTmFOKGkpKSB7XG4gICAgICAgIGkgPSAwO1xuICAgICAgfSBlbHNlIGlmIChpICE9PSAwICYmIGlzRmluaXRlKGkpKSB7XG4gICAgICAgIGkgPSAoaSA+IDAgPyAxIDogLTEpICogTWF0aC5mbG9vcihNYXRoLmFicyhpKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGkgPSBsZW5ndGg7XG4gICAgfVxuXG4gICAgdmFyIGsgPSBpID49IDAgPyBNYXRoLm1pbihpLCBsZW5ndGggLSAxKSA6XG4gICAgIGxlbmd0aCAtIE1hdGguYWJzKGkpO1xuXG4gICAgZm9yICg7IGsgPj0gMDsgay0tKVxuICAgICAgaWYgKGsgaW4gYXJyYXkgJiYgYXJyYXlba10gPT09IGl0ZW0pIHJldHVybiBrO1xuICAgIHJldHVybiAtMTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNvbmNhdChfKSB7XG4gICAgdmFyIGFycmF5ID0gW10sIGl0ZW1zID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDApLCBpdGVtLCBuID0gMDtcbiAgICBpdGVtcy51bnNoaWZ0KHRoaXMpO1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBpdGVtcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaXRlbSA9IGl0ZW1zW2ldO1xuICAgICAgaWYgKE9iamVjdC5pc0FycmF5KGl0ZW0pICYmICEoJ2NhbGxlZScgaW4gaXRlbSkpIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGFycmF5TGVuZ3RoID0gaXRlbS5sZW5ndGg7IGogPCBhcnJheUxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgaWYgKGogaW4gaXRlbSkgYXJyYXlbbl0gPSBpdGVtW2pdO1xuICAgICAgICAgIG4rKztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXJyYXlbbisrXSA9IGl0ZW07XG4gICAgICB9XG4gICAgfVxuICAgIGFycmF5Lmxlbmd0aCA9IG47XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cblxuICBmdW5jdGlvbiB3cmFwTmF0aXZlKG1ldGhvZCkge1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBtZXRob2QuY2FsbCh0aGlzLCBQcm90b3R5cGUuSyk7XG4gICAgICB9IGVsc2UgaWYgKGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgICAgICBhcmdzLnVuc2hpZnQoUHJvdG90eXBlLkspO1xuICAgICAgICByZXR1cm4gbWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG1ldGhvZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuXG4gIGZ1bmN0aW9uIG1hcChpdGVyYXRvcikge1xuICAgIGlmICh0aGlzID09IG51bGwpIHRocm93IG5ldyBUeXBlRXJyb3IoKTtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuXG4gICAgdmFyIG9iamVjdCA9IE9iamVjdCh0aGlzKTtcbiAgICB2YXIgcmVzdWx0cyA9IFtdLCBjb250ZXh0ID0gYXJndW1lbnRzWzFdLCBuID0gMDtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmplY3QubGVuZ3RoID4+PiAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChpIGluIG9iamVjdCkge1xuICAgICAgICByZXN1bHRzW25dID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmplY3RbaV0sIGksIG9iamVjdCk7XG4gICAgICB9XG4gICAgICBuKys7XG4gICAgfVxuICAgIHJlc3VsdHMubGVuZ3RoID0gbjtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIGlmIChhcnJheVByb3RvLm1hcCkge1xuICAgIG1hcCA9IHdyYXBOYXRpdmUoQXJyYXkucHJvdG90eXBlLm1hcCk7XG4gIH1cblxuICBmdW5jdGlvbiBmaWx0ZXIoaXRlcmF0b3IpIHtcbiAgICBpZiAodGhpcyA9PSBudWxsIHx8ICFPYmplY3QuaXNGdW5jdGlvbihpdGVyYXRvcikpXG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7XG5cbiAgICB2YXIgb2JqZWN0ID0gT2JqZWN0KHRoaXMpO1xuICAgIHZhciByZXN1bHRzID0gW10sIGNvbnRleHQgPSBhcmd1bWVudHNbMV0sIHZhbHVlO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iamVjdC5sZW5ndGggPj4+IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGkgaW4gb2JqZWN0KSB7XG4gICAgICAgIHZhbHVlID0gb2JqZWN0W2ldO1xuICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaSwgb2JqZWN0KSkge1xuICAgICAgICAgIHJlc3VsdHMucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBpZiAoYXJyYXlQcm90by5maWx0ZXIpIHtcbiAgICBmaWx0ZXIgPSBBcnJheS5wcm90b3R5cGUuZmlsdGVyO1xuICB9XG5cbiAgZnVuY3Rpb24gc29tZShpdGVyYXRvcikge1xuICAgIGlmICh0aGlzID09IG51bGwpIHRocm93IG5ldyBUeXBlRXJyb3IoKTtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuICAgIHZhciBjb250ZXh0ID0gYXJndW1lbnRzWzFdO1xuXG4gICAgdmFyIG9iamVjdCA9IE9iamVjdCh0aGlzKTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gb2JqZWN0Lmxlbmd0aCA+Pj4gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoaSBpbiBvYmplY3QgJiYgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmplY3RbaV0sIGksIG9iamVjdCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKGFycmF5UHJvdG8uc29tZSkge1xuICAgIHZhciBzb21lID0gd3JhcE5hdGl2ZShBcnJheS5wcm90b3R5cGUuc29tZSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGV2ZXJ5KGl0ZXJhdG9yKSB7XG4gICAgaWYgKHRoaXMgPT0gbnVsbCkgdGhyb3cgbmV3IFR5cGVFcnJvcigpO1xuICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7XG4gICAgdmFyIGNvbnRleHQgPSBhcmd1bWVudHNbMV07XG5cbiAgICB2YXIgb2JqZWN0ID0gT2JqZWN0KHRoaXMpO1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmplY3QubGVuZ3RoID4+PiAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChpIGluIG9iamVjdCAmJiAhaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmplY3RbaV0sIGksIG9iamVjdCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaWYgKGFycmF5UHJvdG8uZXZlcnkpIHtcbiAgICB2YXIgZXZlcnkgPSB3cmFwTmF0aXZlKEFycmF5LnByb3RvdHlwZS5ldmVyeSk7XG4gIH1cblxuICB2YXIgX3JlZHVjZSA9IGFycmF5UHJvdG8ucmVkdWNlO1xuICBmdW5jdGlvbiBpbmplY3QobWVtbywgaXRlcmF0b3IpIHtcbiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LO1xuICAgIHZhciBjb250ZXh0ID0gYXJndW1lbnRzWzJdO1xuICAgIHJldHVybiBfcmVkdWNlLmNhbGwodGhpcywgaXRlcmF0b3IuYmluZChjb250ZXh0KSwgbWVtbyk7XG4gIH1cblxuICBpZiAoIWFycmF5UHJvdG8ucmVkdWNlKSB7XG4gICAgdmFyIGluamVjdCA9IEVudW1lcmFibGUuaW5qZWN0O1xuICB9XG5cbiAgT2JqZWN0LmV4dGVuZChhcnJheVByb3RvLCBFbnVtZXJhYmxlKTtcblxuICBpZiAoIWFycmF5UHJvdG8uX3JldmVyc2UpXG4gICAgYXJyYXlQcm90by5fcmV2ZXJzZSA9IGFycmF5UHJvdG8ucmV2ZXJzZTtcblxuICBPYmplY3QuZXh0ZW5kKGFycmF5UHJvdG8sIHtcbiAgICBfZWFjaDogICAgIF9lYWNoLFxuXG4gICAgbWFwOiAgICAgICBtYXAsXG4gICAgY29sbGVjdDogICBtYXAsXG4gICAgc2VsZWN0OiAgICBmaWx0ZXIsXG4gICAgZmlsdGVyOiAgICBmaWx0ZXIsXG4gICAgZmluZEFsbDogICBmaWx0ZXIsXG4gICAgc29tZTogICAgICBzb21lLFxuICAgIGFueTogICAgICAgc29tZSxcbiAgICBldmVyeTogICAgIGV2ZXJ5LFxuICAgIGFsbDogICAgICAgZXZlcnksXG4gICAgaW5qZWN0OiAgICBpbmplY3QsXG5cbiAgICBjbGVhcjogICAgIGNsZWFyLFxuICAgIGZpcnN0OiAgICAgZmlyc3QsXG4gICAgbGFzdDogICAgICBsYXN0LFxuICAgIGNvbXBhY3Q6ICAgY29tcGFjdCxcbiAgICBmbGF0dGVuOiAgIGZsYXR0ZW4sXG4gICAgd2l0aG91dDogICB3aXRob3V0LFxuICAgIHJldmVyc2U6ICAgcmV2ZXJzZSxcbiAgICB1bmlxOiAgICAgIHVuaXEsXG4gICAgaW50ZXJzZWN0OiBpbnRlcnNlY3QsXG4gICAgY2xvbmU6ICAgICBjbG9uZSxcbiAgICB0b0FycmF5OiAgIGNsb25lLFxuICAgIHNpemU6ICAgICAgc2l6ZSxcbiAgICBpbnNwZWN0OiAgIGluc3BlY3RcbiAgfSk7XG5cbiAgdmFyIENPTkNBVF9BUkdVTUVOVFNfQlVHR1kgPSAoZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFtdLmNvbmNhdChhcmd1bWVudHMpWzBdWzBdICE9PSAxO1xuICB9KSgxLDIpO1xuXG4gIGlmIChDT05DQVRfQVJHVU1FTlRTX0JVR0dZKSBhcnJheVByb3RvLmNvbmNhdCA9IGNvbmNhdDtcblxuICBpZiAoIWFycmF5UHJvdG8uaW5kZXhPZikgYXJyYXlQcm90by5pbmRleE9mID0gaW5kZXhPZjtcbiAgaWYgKCFhcnJheVByb3RvLmxhc3RJbmRleE9mKSBhcnJheVByb3RvLmxhc3RJbmRleE9mID0gbGFzdEluZGV4T2Y7XG59KSgpO1xuZnVuY3Rpb24gJEgob2JqZWN0KSB7XG4gIHJldHVybiBuZXcgSGFzaChvYmplY3QpO1xufTtcblxudmFyIEhhc2ggPSBDbGFzcy5jcmVhdGUoRW51bWVyYWJsZSwgKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBpbml0aWFsaXplKG9iamVjdCkge1xuICAgIHRoaXMuX29iamVjdCA9IE9iamVjdC5pc0hhc2gob2JqZWN0KSA/IG9iamVjdC50b09iamVjdCgpIDogT2JqZWN0LmNsb25lKG9iamVjdCk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIF9lYWNoKGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgdmFyIGkgPSAwO1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9vYmplY3QpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX29iamVjdFtrZXldLCBwYWlyID0gW2tleSwgdmFsdWVdO1xuICAgICAgcGFpci5rZXkgPSBrZXk7XG4gICAgICBwYWlyLnZhbHVlID0gdmFsdWU7XG4gICAgICBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHBhaXIsIGkpO1xuICAgICAgaSsrO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldChrZXksIHZhbHVlKSB7XG4gICAgcmV0dXJuIHRoaXMuX29iamVjdFtrZXldID0gdmFsdWU7XG4gIH1cblxuICBmdW5jdGlvbiBnZXQoa2V5KSB7XG4gICAgaWYgKHRoaXMuX29iamVjdFtrZXldICE9PSBPYmplY3QucHJvdG90eXBlW2tleV0pXG4gICAgICByZXR1cm4gdGhpcy5fb2JqZWN0W2tleV07XG4gIH1cblxuICBmdW5jdGlvbiB1bnNldChrZXkpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLl9vYmplY3Rba2V5XTtcbiAgICBkZWxldGUgdGhpcy5fb2JqZWN0W2tleV07XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gdG9PYmplY3QoKSB7XG4gICAgcmV0dXJuIE9iamVjdC5jbG9uZSh0aGlzLl9vYmplY3QpO1xuICB9XG5cblxuXG4gIGZ1bmN0aW9uIGtleXMoKSB7XG4gICAgcmV0dXJuIHRoaXMucGx1Y2soJ2tleScpO1xuICB9XG5cbiAgZnVuY3Rpb24gdmFsdWVzKCkge1xuICAgIHJldHVybiB0aGlzLnBsdWNrKCd2YWx1ZScpO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5kZXgodmFsdWUpIHtcbiAgICB2YXIgbWF0Y2ggPSB0aGlzLmRldGVjdChmdW5jdGlvbihwYWlyKSB7XG4gICAgICByZXR1cm4gcGFpci52YWx1ZSA9PT0gdmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIG1hdGNoICYmIG1hdGNoLmtleTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1lcmdlKG9iamVjdCkge1xuICAgIHJldHVybiB0aGlzLmNsb25lKCkudXBkYXRlKG9iamVjdCk7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGUob2JqZWN0KSB7XG4gICAgcmV0dXJuIG5ldyBIYXNoKG9iamVjdCkuaW5qZWN0KHRoaXMsIGZ1bmN0aW9uKHJlc3VsdCwgcGFpcikge1xuICAgICAgcmVzdWx0LnNldChwYWlyLmtleSwgcGFpci52YWx1ZSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gdG9RdWVyeVBhaXIoa2V5LCB2YWx1ZSkge1xuICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQodmFsdWUpKSByZXR1cm4ga2V5O1xuXG4gICAgdmFsdWUgPSBTdHJpbmcuaW50ZXJwcmV0KHZhbHVlKTtcblxuICAgIHZhbHVlID0gdmFsdWUuZ3N1YigvKFxccik/XFxuLywgJ1xcclxcbicpO1xuICAgIHZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcbiAgICB2YWx1ZSA9IHZhbHVlLmdzdWIoLyUyMC8sICcrJyk7XG4gICAgcmV0dXJuIGtleSArICc9JyArIHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gdG9RdWVyeVN0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy5pbmplY3QoW10sIGZ1bmN0aW9uKHJlc3VsdHMsIHBhaXIpIHtcbiAgICAgIHZhciBrZXkgPSBlbmNvZGVVUklDb21wb25lbnQocGFpci5rZXkpLCB2YWx1ZXMgPSBwYWlyLnZhbHVlO1xuXG4gICAgICBpZiAodmFsdWVzICYmIHR5cGVvZiB2YWx1ZXMgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgaWYgKE9iamVjdC5pc0FycmF5KHZhbHVlcykpIHtcbiAgICAgICAgICB2YXIgcXVlcnlWYWx1ZXMgPSBbXTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdmFsdWVzLmxlbmd0aCwgdmFsdWU7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZXNbaV07XG4gICAgICAgICAgICBxdWVyeVZhbHVlcy5wdXNoKHRvUXVlcnlQYWlyKGtleSwgdmFsdWUpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdHMuY29uY2F0KHF1ZXJ5VmFsdWVzKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHJlc3VsdHMucHVzaCh0b1F1ZXJ5UGFpcihrZXksIHZhbHVlcykpO1xuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfSkuam9pbignJicpO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5zcGVjdCgpIHtcbiAgICByZXR1cm4gJyM8SGFzaDp7JyArIHRoaXMubWFwKGZ1bmN0aW9uKHBhaXIpIHtcbiAgICAgIHJldHVybiBwYWlyLm1hcChPYmplY3QuaW5zcGVjdCkuam9pbignOiAnKTtcbiAgICB9KS5qb2luKCcsICcpICsgJ30+JztcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb25lKCkge1xuICAgIHJldHVybiBuZXcgSGFzaCh0aGlzKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaW5pdGlhbGl6ZTogICAgICAgICAgICAgaW5pdGlhbGl6ZSxcbiAgICBfZWFjaDogICAgICAgICAgICAgICAgICBfZWFjaCxcbiAgICBzZXQ6ICAgICAgICAgICAgICAgICAgICBzZXQsXG4gICAgZ2V0OiAgICAgICAgICAgICAgICAgICAgZ2V0LFxuICAgIHVuc2V0OiAgICAgICAgICAgICAgICAgIHVuc2V0LFxuICAgIHRvT2JqZWN0OiAgICAgICAgICAgICAgIHRvT2JqZWN0LFxuICAgIHRvVGVtcGxhdGVSZXBsYWNlbWVudHM6IHRvT2JqZWN0LFxuICAgIGtleXM6ICAgICAgICAgICAgICAgICAgIGtleXMsXG4gICAgdmFsdWVzOiAgICAgICAgICAgICAgICAgdmFsdWVzLFxuICAgIGluZGV4OiAgICAgICAgICAgICAgICAgIGluZGV4LFxuICAgIG1lcmdlOiAgICAgICAgICAgICAgICAgIG1lcmdlLFxuICAgIHVwZGF0ZTogICAgICAgICAgICAgICAgIHVwZGF0ZSxcbiAgICB0b1F1ZXJ5U3RyaW5nOiAgICAgICAgICB0b1F1ZXJ5U3RyaW5nLFxuICAgIGluc3BlY3Q6ICAgICAgICAgICAgICAgIGluc3BlY3QsXG4gICAgdG9KU09OOiAgICAgICAgICAgICAgICAgdG9PYmplY3QsXG4gICAgY2xvbmU6ICAgICAgICAgICAgICAgICAgY2xvbmVcbiAgfTtcbn0pKCkpO1xuXG5IYXNoLmZyb20gPSAkSDtcbk9iamVjdC5leHRlbmQoTnVtYmVyLnByb3RvdHlwZSwgKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0NvbG9yUGFydCgpIHtcbiAgICByZXR1cm4gdGhpcy50b1BhZGRlZFN0cmluZygyLCAxNik7XG4gIH1cblxuICBmdW5jdGlvbiBzdWNjKCkge1xuICAgIHJldHVybiB0aGlzICsgMTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRpbWVzKGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgJFIoMCwgdGhpcywgdHJ1ZSkuZWFjaChpdGVyYXRvciwgY29udGV4dCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmdW5jdGlvbiB0b1BhZGRlZFN0cmluZyhsZW5ndGgsIHJhZGl4KSB7XG4gICAgdmFyIHN0cmluZyA9IHRoaXMudG9TdHJpbmcocmFkaXggfHwgMTApO1xuICAgIHJldHVybiAnMCcudGltZXMobGVuZ3RoIC0gc3RyaW5nLmxlbmd0aCkgKyBzdHJpbmc7XG4gIH1cblxuICBmdW5jdGlvbiBhYnMoKSB7XG4gICAgcmV0dXJuIE1hdGguYWJzKHRoaXMpO1xuICB9XG5cbiAgZnVuY3Rpb24gcm91bmQoKSB7XG4gICAgcmV0dXJuIE1hdGgucm91bmQodGhpcyk7XG4gIH1cblxuICBmdW5jdGlvbiBjZWlsKCkge1xuICAgIHJldHVybiBNYXRoLmNlaWwodGhpcyk7XG4gIH1cblxuICBmdW5jdGlvbiBmbG9vcigpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdG9Db2xvclBhcnQ6ICAgIHRvQ29sb3JQYXJ0LFxuICAgIHN1Y2M6ICAgICAgICAgICBzdWNjLFxuICAgIHRpbWVzOiAgICAgICAgICB0aW1lcyxcbiAgICB0b1BhZGRlZFN0cmluZzogdG9QYWRkZWRTdHJpbmcsXG4gICAgYWJzOiAgICAgICAgICAgIGFicyxcbiAgICByb3VuZDogICAgICAgICAgcm91bmQsXG4gICAgY2VpbDogICAgICAgICAgIGNlaWwsXG4gICAgZmxvb3I6ICAgICAgICAgIGZsb29yXG4gIH07XG59KSgpKTtcblxuZnVuY3Rpb24gJFIoc3RhcnQsIGVuZCwgZXhjbHVzaXZlKSB7XG4gIHJldHVybiBuZXcgT2JqZWN0UmFuZ2Uoc3RhcnQsIGVuZCwgZXhjbHVzaXZlKTtcbn1cblxudmFyIE9iamVjdFJhbmdlID0gQ2xhc3MuY3JlYXRlKEVudW1lcmFibGUsIChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gaW5pdGlhbGl6ZShzdGFydCwgZW5kLCBleGNsdXNpdmUpIHtcbiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7XG4gICAgdGhpcy5lbmQgPSBlbmQ7XG4gICAgdGhpcy5leGNsdXNpdmUgPSBleGNsdXNpdmU7XG4gIH1cblxuICBmdW5jdGlvbiBfZWFjaChpdGVyYXRvciwgY29udGV4dCkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMuc3RhcnQsIGk7XG4gICAgZm9yIChpID0gMDsgdGhpcy5pbmNsdWRlKHZhbHVlKTsgaSsrKSB7XG4gICAgICBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpKTtcbiAgICAgIHZhbHVlID0gdmFsdWUuc3VjYygpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGluY2x1ZGUodmFsdWUpIHtcbiAgICBpZiAodmFsdWUgPCB0aGlzLnN0YXJ0KVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICh0aGlzLmV4Y2x1c2l2ZSlcbiAgICAgIHJldHVybiB2YWx1ZSA8IHRoaXMuZW5kO1xuICAgIHJldHVybiB2YWx1ZSA8PSB0aGlzLmVuZDtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaW5pdGlhbGl6ZTogaW5pdGlhbGl6ZSxcbiAgICBfZWFjaDogICAgICBfZWFjaCxcbiAgICBpbmNsdWRlOiAgICBpbmNsdWRlXG4gIH07XG59KSgpKTtcblxuXG5cbnZhciBBYnN0cmFjdCA9IHsgfTtcblxuXG52YXIgVHJ5ID0ge1xuICB0aGVzZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJldHVyblZhbHVlO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGxhbWJkYSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVyblZhbHVlID0gbGFtYmRhKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfSBjYXRjaCAoZSkgeyB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICB9XG59O1xuXG52YXIgQWpheCA9IHtcbiAgZ2V0VHJhbnNwb3J0OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gVHJ5LnRoZXNlKFxuICAgICAgZnVuY3Rpb24oKSB7cmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpfSxcbiAgICAgIGZ1bmN0aW9uKCkge3JldHVybiBuZXcgQWN0aXZlWE9iamVjdCgnTXN4bWwyLlhNTEhUVFAnKX0sXG4gICAgICBmdW5jdGlvbigpIHtyZXR1cm4gbmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxIVFRQJyl9XG4gICAgKSB8fCBmYWxzZTtcbiAgfSxcblxuICBhY3RpdmVSZXF1ZXN0Q291bnQ6IDBcbn07XG5cbkFqYXguUmVzcG9uZGVycyA9IHtcbiAgcmVzcG9uZGVyczogW10sXG5cbiAgX2VhY2g6IGZ1bmN0aW9uKGl0ZXJhdG9yLCBjb250ZXh0KSB7XG4gICAgdGhpcy5yZXNwb25kZXJzLl9lYWNoKGl0ZXJhdG9yLCBjb250ZXh0KTtcbiAgfSxcblxuICByZWdpc3RlcjogZnVuY3Rpb24ocmVzcG9uZGVyKSB7XG4gICAgaWYgKCF0aGlzLmluY2x1ZGUocmVzcG9uZGVyKSlcbiAgICAgIHRoaXMucmVzcG9uZGVycy5wdXNoKHJlc3BvbmRlcik7XG4gIH0sXG5cbiAgdW5yZWdpc3RlcjogZnVuY3Rpb24ocmVzcG9uZGVyKSB7XG4gICAgdGhpcy5yZXNwb25kZXJzID0gdGhpcy5yZXNwb25kZXJzLndpdGhvdXQocmVzcG9uZGVyKTtcbiAgfSxcblxuICBkaXNwYXRjaDogZnVuY3Rpb24oY2FsbGJhY2ssIHJlcXVlc3QsIHRyYW5zcG9ydCwganNvbikge1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbihyZXNwb25kZXIpIHtcbiAgICAgIGlmIChPYmplY3QuaXNGdW5jdGlvbihyZXNwb25kZXJbY2FsbGJhY2tdKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJlc3BvbmRlcltjYWxsYmFja10uYXBwbHkocmVzcG9uZGVyLCBbcmVxdWVzdCwgdHJhbnNwb3J0LCBqc29uXSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG59O1xuXG5PYmplY3QuZXh0ZW5kKEFqYXguUmVzcG9uZGVycywgRW51bWVyYWJsZSk7XG5cbkFqYXguUmVzcG9uZGVycy5yZWdpc3Rlcih7XG4gIG9uQ3JlYXRlOiAgIGZ1bmN0aW9uKCkgeyBBamF4LmFjdGl2ZVJlcXVlc3RDb3VudCsrIH0sXG4gIG9uQ29tcGxldGU6IGZ1bmN0aW9uKCkgeyBBamF4LmFjdGl2ZVJlcXVlc3RDb3VudC0tIH1cbn0pO1xuQWpheC5CYXNlID0gQ2xhc3MuY3JlYXRlKHtcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgIG1ldGhvZDogICAgICAgJ3Bvc3QnLFxuICAgICAgYXN5bmNocm9ub3VzOiB0cnVlLFxuICAgICAgY29udGVudFR5cGU6ICAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcbiAgICAgIGVuY29kaW5nOiAgICAgJ1VURi04JyxcbiAgICAgIHBhcmFtZXRlcnM6ICAgJycsXG4gICAgICBldmFsSlNPTjogICAgIHRydWUsXG4gICAgICBldmFsSlM6ICAgICAgIHRydWVcbiAgICB9O1xuICAgIE9iamVjdC5leHRlbmQodGhpcy5vcHRpb25zLCBvcHRpb25zIHx8IHsgfSk7XG5cbiAgICB0aGlzLm9wdGlvbnMubWV0aG9kID0gdGhpcy5vcHRpb25zLm1ldGhvZC50b0xvd2VyQ2FzZSgpO1xuXG4gICAgaWYgKE9iamVjdC5pc0hhc2godGhpcy5vcHRpb25zLnBhcmFtZXRlcnMpKVxuICAgICAgdGhpcy5vcHRpb25zLnBhcmFtZXRlcnMgPSB0aGlzLm9wdGlvbnMucGFyYW1ldGVycy50b09iamVjdCgpO1xuICB9XG59KTtcbkFqYXguUmVxdWVzdCA9IENsYXNzLmNyZWF0ZShBamF4LkJhc2UsIHtcbiAgX2NvbXBsZXRlOiBmYWxzZSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbigkc3VwZXIsIHVybCwgb3B0aW9ucykge1xuICAgICRzdXBlcihvcHRpb25zKTtcbiAgICB0aGlzLnRyYW5zcG9ydCA9IEFqYXguZ2V0VHJhbnNwb3J0KCk7XG4gICAgdGhpcy5yZXF1ZXN0KHVybCk7XG4gIH0sXG5cbiAgcmVxdWVzdDogZnVuY3Rpb24odXJsKSB7XG4gICAgdGhpcy51cmwgPSB1cmw7XG4gICAgdGhpcy5tZXRob2QgPSB0aGlzLm9wdGlvbnMubWV0aG9kO1xuICAgIHZhciBwYXJhbXMgPSBPYmplY3QuaXNTdHJpbmcodGhpcy5vcHRpb25zLnBhcmFtZXRlcnMpID9cbiAgICAgICAgICB0aGlzLm9wdGlvbnMucGFyYW1ldGVycyA6XG4gICAgICAgICAgT2JqZWN0LnRvUXVlcnlTdHJpbmcodGhpcy5vcHRpb25zLnBhcmFtZXRlcnMpO1xuXG4gICAgaWYgKCFbJ2dldCcsICdwb3N0J10uaW5jbHVkZSh0aGlzLm1ldGhvZCkpIHtcbiAgICAgIHBhcmFtcyArPSAocGFyYW1zID8gJyYnIDogJycpICsgXCJfbWV0aG9kPVwiICsgdGhpcy5tZXRob2Q7XG4gICAgICB0aGlzLm1ldGhvZCA9ICdwb3N0JztcbiAgICB9XG5cbiAgICBpZiAocGFyYW1zICYmIHRoaXMubWV0aG9kID09PSAnZ2V0Jykge1xuICAgICAgdGhpcy51cmwgKz0gKHRoaXMudXJsLmluY2x1ZGUoJz8nKSA/ICcmJyA6ICc/JykgKyBwYXJhbXM7XG4gICAgfVxuXG4gICAgdGhpcy5wYXJhbWV0ZXJzID0gcGFyYW1zLnRvUXVlcnlQYXJhbXMoKTtcblxuICAgIHRyeSB7XG4gICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgQWpheC5SZXNwb25zZSh0aGlzKTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMub25DcmVhdGUpIHRoaXMub3B0aW9ucy5vbkNyZWF0ZShyZXNwb25zZSk7XG4gICAgICBBamF4LlJlc3BvbmRlcnMuZGlzcGF0Y2goJ29uQ3JlYXRlJywgdGhpcywgcmVzcG9uc2UpO1xuXG4gICAgICB0aGlzLnRyYW5zcG9ydC5vcGVuKHRoaXMubWV0aG9kLnRvVXBwZXJDYXNlKCksIHRoaXMudXJsLFxuICAgICAgICB0aGlzLm9wdGlvbnMuYXN5bmNocm9ub3VzKTtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hc3luY2hyb25vdXMpIHRoaXMucmVzcG9uZFRvUmVhZHlTdGF0ZS5iaW5kKHRoaXMpLmRlZmVyKDEpO1xuXG4gICAgICB0aGlzLnRyYW5zcG9ydC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSB0aGlzLm9uU3RhdGVDaGFuZ2UuYmluZCh0aGlzKTtcbiAgICAgIHRoaXMuc2V0UmVxdWVzdEhlYWRlcnMoKTtcblxuICAgICAgdGhpcy5ib2R5ID0gdGhpcy5tZXRob2QgPT0gJ3Bvc3QnID8gKHRoaXMub3B0aW9ucy5wb3N0Qm9keSB8fCBwYXJhbXMpIDogbnVsbDtcbiAgICAgIHRoaXMudHJhbnNwb3J0LnNlbmQodGhpcy5ib2R5KTtcblxuICAgICAgLyogRm9yY2UgRmlyZWZveCB0byBoYW5kbGUgcmVhZHkgc3RhdGUgNCBmb3Igc3luY2hyb25vdXMgcmVxdWVzdHMgKi9cbiAgICAgIGlmICghdGhpcy5vcHRpb25zLmFzeW5jaHJvbm91cyAmJiB0aGlzLnRyYW5zcG9ydC5vdmVycmlkZU1pbWVUeXBlKVxuICAgICAgICB0aGlzLm9uU3RhdGVDaGFuZ2UoKTtcblxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5kaXNwYXRjaEV4Y2VwdGlvbihlKTtcbiAgICB9XG4gIH0sXG5cbiAgb25TdGF0ZUNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJlYWR5U3RhdGUgPSB0aGlzLnRyYW5zcG9ydC5yZWFkeVN0YXRlO1xuICAgIGlmIChyZWFkeVN0YXRlID4gMSAmJiAhKChyZWFkeVN0YXRlID09IDQpICYmIHRoaXMuX2NvbXBsZXRlKSlcbiAgICAgIHRoaXMucmVzcG9uZFRvUmVhZHlTdGF0ZSh0aGlzLnRyYW5zcG9ydC5yZWFkeVN0YXRlKTtcbiAgfSxcblxuICBzZXRSZXF1ZXN0SGVhZGVyczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGhlYWRlcnMgPSB7XG4gICAgICAnWC1SZXF1ZXN0ZWQtV2l0aCc6ICdYTUxIdHRwUmVxdWVzdCcsXG4gICAgICAnWC1Qcm90b3R5cGUtVmVyc2lvbic6IFByb3RvdHlwZS5WZXJzaW9uLFxuICAgICAgJ0FjY2VwdCc6ICd0ZXh0L2phdmFzY3JpcHQsIHRleHQvaHRtbCwgYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCwgKi8qJ1xuICAgIH07XG5cbiAgICBpZiAodGhpcy5tZXRob2QgPT0gJ3Bvc3QnKSB7XG4gICAgICBoZWFkZXJzWydDb250ZW50LXR5cGUnXSA9IHRoaXMub3B0aW9ucy5jb250ZW50VHlwZSArXG4gICAgICAgICh0aGlzLm9wdGlvbnMuZW5jb2RpbmcgPyAnOyBjaGFyc2V0PScgKyB0aGlzLm9wdGlvbnMuZW5jb2RpbmcgOiAnJyk7XG5cbiAgICAgIC8qIEZvcmNlIFwiQ29ubmVjdGlvbjogY2xvc2VcIiBmb3Igb2xkZXIgTW96aWxsYSBicm93c2VycyB0byB3b3JrXG4gICAgICAgKiBhcm91bmQgYSBidWcgd2hlcmUgWE1MSHR0cFJlcXVlc3Qgc2VuZHMgYW4gaW5jb3JyZWN0XG4gICAgICAgKiBDb250ZW50LWxlbmd0aCBoZWFkZXIuIFNlZSBNb3ppbGxhIEJ1Z3ppbGxhICMyNDY2NTEuXG4gICAgICAgKi9cbiAgICAgIGlmICh0aGlzLnRyYW5zcG9ydC5vdmVycmlkZU1pbWVUeXBlICYmXG4gICAgICAgICAgKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0dlY2tvXFwvKFxcZHs0fSkvKSB8fCBbMCwyMDA1XSlbMV0gPCAyMDA1KVxuICAgICAgICAgICAgaGVhZGVyc1snQ29ubmVjdGlvbiddID0gJ2Nsb3NlJztcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5yZXF1ZXN0SGVhZGVycyA9PSAnb2JqZWN0Jykge1xuICAgICAgdmFyIGV4dHJhcyA9IHRoaXMub3B0aW9ucy5yZXF1ZXN0SGVhZGVycztcblxuICAgICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKGV4dHJhcy5wdXNoKSlcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGV4dHJhcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gMilcbiAgICAgICAgICBoZWFkZXJzW2V4dHJhc1tpXV0gPSBleHRyYXNbaSsxXTtcbiAgICAgIGVsc2VcbiAgICAgICAgJEgoZXh0cmFzKS5lYWNoKGZ1bmN0aW9uKHBhaXIpIHsgaGVhZGVyc1twYWlyLmtleV0gPSBwYWlyLnZhbHVlIH0pO1xuICAgIH1cblxuICAgIGZvciAodmFyIG5hbWUgaW4gaGVhZGVycylcbiAgICAgIGlmIChoZWFkZXJzW25hbWVdICE9IG51bGwpXG4gICAgICAgIHRoaXMudHJhbnNwb3J0LnNldFJlcXVlc3RIZWFkZXIobmFtZSwgaGVhZGVyc1tuYW1lXSk7XG4gIH0sXG5cbiAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN0YXR1cyA9IHRoaXMuZ2V0U3RhdHVzKCk7XG4gICAgcmV0dXJuICFzdGF0dXMgfHwgKHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwKSB8fCBzdGF0dXMgPT0gMzA0O1xuICB9LFxuXG4gIGdldFN0YXR1czogZnVuY3Rpb24oKSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLnRyYW5zcG9ydC5zdGF0dXMgPT09IDEyMjMpIHJldHVybiAyMDQ7XG4gICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuc3RhdHVzIHx8IDA7XG4gICAgfSBjYXRjaCAoZSkgeyByZXR1cm4gMCB9XG4gIH0sXG5cbiAgcmVzcG9uZFRvUmVhZHlTdGF0ZTogZnVuY3Rpb24ocmVhZHlTdGF0ZSkge1xuICAgIHZhciBzdGF0ZSA9IEFqYXguUmVxdWVzdC5FdmVudHNbcmVhZHlTdGF0ZV0sIHJlc3BvbnNlID0gbmV3IEFqYXguUmVzcG9uc2UodGhpcyk7XG5cbiAgICBpZiAoc3RhdGUgPT0gJ0NvbXBsZXRlJykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5fY29tcGxldGUgPSB0cnVlO1xuICAgICAgICAodGhpcy5vcHRpb25zWydvbicgKyByZXNwb25zZS5zdGF0dXNdXG4gICAgICAgICB8fCB0aGlzLm9wdGlvbnNbJ29uJyArICh0aGlzLnN1Y2Nlc3MoKSA/ICdTdWNjZXNzJyA6ICdGYWlsdXJlJyldXG4gICAgICAgICB8fCBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbikocmVzcG9uc2UsIHJlc3BvbnNlLmhlYWRlckpTT04pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aGlzLmRpc3BhdGNoRXhjZXB0aW9uKGUpO1xuICAgICAgfVxuXG4gICAgICB2YXIgY29udGVudFR5cGUgPSByZXNwb25zZS5nZXRIZWFkZXIoJ0NvbnRlbnQtdHlwZScpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5ldmFsSlMgPT0gJ2ZvcmNlJ1xuICAgICAgICAgIHx8ICh0aGlzLm9wdGlvbnMuZXZhbEpTICYmIHRoaXMuaXNTYW1lT3JpZ2luKCkgJiYgY29udGVudFR5cGVcbiAgICAgICAgICAmJiBjb250ZW50VHlwZS5tYXRjaCgvXlxccyoodGV4dHxhcHBsaWNhdGlvbilcXC8oeC0pPyhqYXZhfGVjbWEpc2NyaXB0KDsuKik/XFxzKiQvaSkpKVxuICAgICAgICB0aGlzLmV2YWxSZXNwb25zZSgpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAodGhpcy5vcHRpb25zWydvbicgKyBzdGF0ZV0gfHwgUHJvdG90eXBlLmVtcHR5RnVuY3Rpb24pKHJlc3BvbnNlLCByZXNwb25zZS5oZWFkZXJKU09OKTtcbiAgICAgIEFqYXguUmVzcG9uZGVycy5kaXNwYXRjaCgnb24nICsgc3RhdGUsIHRoaXMsIHJlc3BvbnNlLCByZXNwb25zZS5oZWFkZXJKU09OKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmRpc3BhdGNoRXhjZXB0aW9uKGUpO1xuICAgIH1cblxuICAgIGlmIChzdGF0ZSA9PSAnQ29tcGxldGUnKSB7XG4gICAgICB0aGlzLnRyYW5zcG9ydC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbjtcbiAgICB9XG4gIH0sXG5cbiAgaXNTYW1lT3JpZ2luOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbSA9IHRoaXMudXJsLm1hdGNoKC9eXFxzKmh0dHBzPzpcXC9cXC9bXlxcL10qLyk7XG4gICAgcmV0dXJuICFtIHx8IChtWzBdID09ICcje3Byb3RvY29sfS8vI3tkb21haW59I3twb3J0fScuaW50ZXJwb2xhdGUoe1xuICAgICAgcHJvdG9jb2w6IGxvY2F0aW9uLnByb3RvY29sLFxuICAgICAgZG9tYWluOiBkb2N1bWVudC5kb21haW4sXG4gICAgICBwb3J0OiBsb2NhdGlvbi5wb3J0ID8gJzonICsgbG9jYXRpb24ucG9ydCA6ICcnXG4gICAgfSkpO1xuICB9LFxuXG4gIGdldEhlYWRlcjogZnVuY3Rpb24obmFtZSkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuZ2V0UmVzcG9uc2VIZWFkZXIobmFtZSkgfHwgbnVsbDtcbiAgICB9IGNhdGNoIChlKSB7IHJldHVybiBudWxsOyB9XG4gIH0sXG5cbiAgZXZhbFJlc3BvbnNlOiBmdW5jdGlvbigpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGV2YWwoKHRoaXMudHJhbnNwb3J0LnJlc3BvbnNlVGV4dCB8fCAnJykudW5maWx0ZXJKU09OKCkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuZGlzcGF0Y2hFeGNlcHRpb24oZSk7XG4gICAgfVxuICB9LFxuXG4gIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbihleGNlcHRpb24pIHtcbiAgICAodGhpcy5vcHRpb25zLm9uRXhjZXB0aW9uIHx8IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uKSh0aGlzLCBleGNlcHRpb24pO1xuICAgIEFqYXguUmVzcG9uZGVycy5kaXNwYXRjaCgnb25FeGNlcHRpb24nLCB0aGlzLCBleGNlcHRpb24pO1xuICB9XG59KTtcblxuQWpheC5SZXF1ZXN0LkV2ZW50cyA9XG4gIFsnVW5pbml0aWFsaXplZCcsICdMb2FkaW5nJywgJ0xvYWRlZCcsICdJbnRlcmFjdGl2ZScsICdDb21wbGV0ZSddO1xuXG5cblxuXG5cblxuXG5cbkFqYXguUmVzcG9uc2UgPSBDbGFzcy5jcmVhdGUoe1xuICBpbml0aWFsaXplOiBmdW5jdGlvbihyZXF1ZXN0KXtcbiAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHZhciB0cmFuc3BvcnQgID0gdGhpcy50cmFuc3BvcnQgID0gcmVxdWVzdC50cmFuc3BvcnQsXG4gICAgICAgIHJlYWR5U3RhdGUgPSB0aGlzLnJlYWR5U3RhdGUgPSB0cmFuc3BvcnQucmVhZHlTdGF0ZTtcblxuICAgIGlmICgocmVhZHlTdGF0ZSA+IDIgJiYgIVByb3RvdHlwZS5Ccm93c2VyLklFKSB8fCByZWFkeVN0YXRlID09IDQpIHtcbiAgICAgIHRoaXMuc3RhdHVzICAgICAgID0gdGhpcy5nZXRTdGF0dXMoKTtcbiAgICAgIHRoaXMuc3RhdHVzVGV4dCAgID0gdGhpcy5nZXRTdGF0dXNUZXh0KCk7XG4gICAgICB0aGlzLnJlc3BvbnNlVGV4dCA9IFN0cmluZy5pbnRlcnByZXQodHJhbnNwb3J0LnJlc3BvbnNlVGV4dCk7XG4gICAgICB0aGlzLmhlYWRlckpTT04gICA9IHRoaXMuX2dldEhlYWRlckpTT04oKTtcbiAgICB9XG5cbiAgICBpZiAocmVhZHlTdGF0ZSA9PSA0KSB7XG4gICAgICB2YXIgeG1sID0gdHJhbnNwb3J0LnJlc3BvbnNlWE1MO1xuICAgICAgdGhpcy5yZXNwb25zZVhNTCAgPSBPYmplY3QuaXNVbmRlZmluZWQoeG1sKSA/IG51bGwgOiB4bWw7XG4gICAgICB0aGlzLnJlc3BvbnNlSlNPTiA9IHRoaXMuX2dldFJlc3BvbnNlSlNPTigpO1xuICAgIH1cbiAgfSxcblxuICBzdGF0dXM6ICAgICAgMCxcblxuICBzdGF0dXNUZXh0OiAnJyxcblxuICBnZXRTdGF0dXM6IEFqYXguUmVxdWVzdC5wcm90b3R5cGUuZ2V0U3RhdHVzLFxuXG4gIGdldFN0YXR1c1RleHQ6IGZ1bmN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuc3RhdHVzVGV4dCB8fCAnJztcbiAgICB9IGNhdGNoIChlKSB7IHJldHVybiAnJyB9XG4gIH0sXG5cbiAgZ2V0SGVhZGVyOiBBamF4LlJlcXVlc3QucHJvdG90eXBlLmdldEhlYWRlcixcblxuICBnZXRBbGxIZWFkZXJzOiBmdW5jdGlvbigpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCk7XG4gICAgfSBjYXRjaCAoZSkgeyByZXR1cm4gbnVsbCB9XG4gIH0sXG5cbiAgZ2V0UmVzcG9uc2VIZWFkZXI6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuZ2V0UmVzcG9uc2VIZWFkZXIobmFtZSk7XG4gIH0sXG5cbiAgZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCk7XG4gIH0sXG5cbiAgX2dldEhlYWRlckpTT046IGZ1bmN0aW9uKCkge1xuICAgIHZhciBqc29uID0gdGhpcy5nZXRIZWFkZXIoJ1gtSlNPTicpO1xuICAgIGlmICghanNvbikgcmV0dXJuIG51bGw7XG5cbiAgICB0cnkge1xuICAgICAganNvbiA9IGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoanNvbikpO1xuICAgIH0gY2F0Y2goZSkge1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICByZXR1cm4ganNvbi5ldmFsSlNPTih0aGlzLnJlcXVlc3Qub3B0aW9ucy5zYW5pdGl6ZUpTT04gfHxcbiAgICAgICAgIXRoaXMucmVxdWVzdC5pc1NhbWVPcmlnaW4oKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5yZXF1ZXN0LmRpc3BhdGNoRXhjZXB0aW9uKGUpO1xuICAgIH1cbiAgfSxcblxuICBfZ2V0UmVzcG9uc2VKU09OOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMucmVxdWVzdC5vcHRpb25zO1xuICAgIGlmICghb3B0aW9ucy5ldmFsSlNPTiB8fCAob3B0aW9ucy5ldmFsSlNPTiAhPSAnZm9yY2UnICYmXG4gICAgICAhKHRoaXMuZ2V0SGVhZGVyKCdDb250ZW50LXR5cGUnKSB8fCAnJykuaW5jbHVkZSgnYXBwbGljYXRpb24vanNvbicpKSB8fFxuICAgICAgICB0aGlzLnJlc3BvbnNlVGV4dC5ibGFuaygpKVxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gdGhpcy5yZXNwb25zZVRleHQuZXZhbEpTT04ob3B0aW9ucy5zYW5pdGl6ZUpTT04gfHxcbiAgICAgICAgIXRoaXMucmVxdWVzdC5pc1NhbWVPcmlnaW4oKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5yZXF1ZXN0LmRpc3BhdGNoRXhjZXB0aW9uKGUpO1xuICAgIH1cbiAgfVxufSk7XG5cbkFqYXguVXBkYXRlciA9IENsYXNzLmNyZWF0ZShBamF4LlJlcXVlc3QsIHtcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oJHN1cGVyLCBjb250YWluZXIsIHVybCwgb3B0aW9ucykge1xuICAgIHRoaXMuY29udGFpbmVyID0ge1xuICAgICAgc3VjY2VzczogKGNvbnRhaW5lci5zdWNjZXNzIHx8IGNvbnRhaW5lciksXG4gICAgICBmYWlsdXJlOiAoY29udGFpbmVyLmZhaWx1cmUgfHwgKGNvbnRhaW5lci5zdWNjZXNzID8gbnVsbCA6IGNvbnRhaW5lcikpXG4gICAgfTtcblxuICAgIG9wdGlvbnMgPSBPYmplY3QuY2xvbmUob3B0aW9ucyk7XG4gICAgdmFyIG9uQ29tcGxldGUgPSBvcHRpb25zLm9uQ29tcGxldGU7XG4gICAgb3B0aW9ucy5vbkNvbXBsZXRlID0gKGZ1bmN0aW9uKHJlc3BvbnNlLCBqc29uKSB7XG4gICAgICB0aGlzLnVwZGF0ZUNvbnRlbnQocmVzcG9uc2UucmVzcG9uc2VUZXh0KTtcbiAgICAgIGlmIChPYmplY3QuaXNGdW5jdGlvbihvbkNvbXBsZXRlKSkgb25Db21wbGV0ZShyZXNwb25zZSwganNvbik7XG4gICAgfSkuYmluZCh0aGlzKTtcblxuICAgICRzdXBlcih1cmwsIG9wdGlvbnMpO1xuICB9LFxuXG4gIHVwZGF0ZUNvbnRlbnQ6IGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkge1xuICAgIHZhciByZWNlaXZlciA9IHRoaXMuY29udGFpbmVyW3RoaXMuc3VjY2VzcygpID8gJ3N1Y2Nlc3MnIDogJ2ZhaWx1cmUnXSxcbiAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcblxuICAgIGlmICghb3B0aW9ucy5ldmFsU2NyaXB0cykgcmVzcG9uc2VUZXh0ID0gcmVzcG9uc2VUZXh0LnN0cmlwU2NyaXB0cygpO1xuXG4gICAgaWYgKHJlY2VpdmVyID0gJChyZWNlaXZlcikpIHtcbiAgICAgIGlmIChvcHRpb25zLmluc2VydGlvbikge1xuICAgICAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKG9wdGlvbnMuaW5zZXJ0aW9uKSkge1xuICAgICAgICAgIHZhciBpbnNlcnRpb24gPSB7IH07IGluc2VydGlvbltvcHRpb25zLmluc2VydGlvbl0gPSByZXNwb25zZVRleHQ7XG4gICAgICAgICAgcmVjZWl2ZXIuaW5zZXJ0KGluc2VydGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBvcHRpb25zLmluc2VydGlvbihyZWNlaXZlciwgcmVzcG9uc2VUZXh0KTtcbiAgICAgIH1cbiAgICAgIGVsc2UgcmVjZWl2ZXIudXBkYXRlKHJlc3BvbnNlVGV4dCk7XG4gICAgfVxuICB9XG59KTtcblxuQWpheC5QZXJpb2RpY2FsVXBkYXRlciA9IENsYXNzLmNyZWF0ZShBamF4LkJhc2UsIHtcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oJHN1cGVyLCBjb250YWluZXIsIHVybCwgb3B0aW9ucykge1xuICAgICRzdXBlcihvcHRpb25zKTtcbiAgICB0aGlzLm9uQ29tcGxldGUgPSB0aGlzLm9wdGlvbnMub25Db21wbGV0ZTtcblxuICAgIHRoaXMuZnJlcXVlbmN5ID0gKHRoaXMub3B0aW9ucy5mcmVxdWVuY3kgfHwgMik7XG4gICAgdGhpcy5kZWNheSA9ICh0aGlzLm9wdGlvbnMuZGVjYXkgfHwgMSk7XG5cbiAgICB0aGlzLnVwZGF0ZXIgPSB7IH07XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy51cmwgPSB1cmw7XG5cbiAgICB0aGlzLnN0YXJ0KCk7XG4gIH0sXG5cbiAgc3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMub3B0aW9ucy5vbkNvbXBsZXRlID0gdGhpcy51cGRhdGVDb21wbGV0ZS5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25UaW1lckV2ZW50KCk7XG4gIH0sXG5cbiAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51cGRhdGVyLm9wdGlvbnMub25Db21wbGV0ZSA9IHVuZGVmaW5lZDtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7XG4gICAgKHRoaXMub25Db21wbGV0ZSB8fCBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbikuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfSxcblxuICB1cGRhdGVDb21wbGV0ZTogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLmRlY2F5KSB7XG4gICAgICB0aGlzLmRlY2F5ID0gKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCA9PSB0aGlzLmxhc3RUZXh0ID9cbiAgICAgICAgdGhpcy5kZWNheSAqIHRoaXMub3B0aW9ucy5kZWNheSA6IDEpO1xuXG4gICAgICB0aGlzLmxhc3RUZXh0ID0gcmVzcG9uc2UucmVzcG9uc2VUZXh0O1xuICAgIH1cbiAgICB0aGlzLnRpbWVyID0gdGhpcy5vblRpbWVyRXZlbnQuYmluZCh0aGlzKS5kZWxheSh0aGlzLmRlY2F5ICogdGhpcy5mcmVxdWVuY3kpO1xuICB9LFxuXG4gIG9uVGltZXJFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy51cGRhdGVyID0gbmV3IEFqYXguVXBkYXRlcih0aGlzLmNvbnRhaW5lciwgdGhpcy51cmwsIHRoaXMub3B0aW9ucyk7XG4gIH1cbn0pO1xuXG4oZnVuY3Rpb24oR0xPQkFMKSB7XG5cbiAgdmFyIFVOREVGSU5FRDtcbiAgdmFyIFNMSUNFID0gQXJyYXkucHJvdG90eXBlLnNsaWNlO1xuXG4gIHZhciBESVYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuXG4gIGZ1bmN0aW9uICQoZWxlbWVudCkge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGVsZW1lbnRzID0gW10sIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKylcbiAgICAgICAgZWxlbWVudHMucHVzaCgkKGFyZ3VtZW50c1tpXSkpO1xuICAgICAgcmV0dXJuIGVsZW1lbnRzO1xuICAgIH1cblxuICAgIGlmIChPYmplY3QuaXNTdHJpbmcoZWxlbWVudCkpXG4gICAgICBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudCk7XG4gICAgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpO1xuICB9XG5cbiAgR0xPQkFMLiQgPSAkO1xuXG5cbiAgaWYgKCFHTE9CQUwuTm9kZSkgR0xPQkFMLk5vZGUgPSB7fTtcblxuICBpZiAoIUdMT0JBTC5Ob2RlLkVMRU1FTlRfTk9ERSkge1xuICAgIE9iamVjdC5leHRlbmQoR0xPQkFMLk5vZGUsIHtcbiAgICAgIEVMRU1FTlRfTk9ERTogICAgICAgICAgICAgICAgMSxcbiAgICAgIEFUVFJJQlVURV9OT0RFOiAgICAgICAgICAgICAgMixcbiAgICAgIFRFWFRfTk9ERTogICAgICAgICAgICAgICAgICAgMyxcbiAgICAgIENEQVRBX1NFQ1RJT05fTk9ERTogICAgICAgICAgNCxcbiAgICAgIEVOVElUWV9SRUZFUkVOQ0VfTk9ERTogICAgICAgNSxcbiAgICAgIEVOVElUWV9OT0RFOiAgICAgICAgICAgICAgICAgNixcbiAgICAgIFBST0NFU1NJTkdfSU5TVFJVQ1RJT05fTk9ERTogNyxcbiAgICAgIENPTU1FTlRfTk9ERTogICAgICAgICAgICAgICAgOCxcbiAgICAgIERPQ1VNRU5UX05PREU6ICAgICAgICAgICAgICAgOSxcbiAgICAgIERPQ1VNRU5UX1RZUEVfTk9ERTogICAgICAgICAxMCxcbiAgICAgIERPQ1VNRU5UX0ZSQUdNRU5UX05PREU6ICAgICAxMSxcbiAgICAgIE5PVEFUSU9OX05PREU6ICAgICAgICAgICAgICAxMlxuICAgIH0pO1xuICB9XG5cbiAgdmFyIEVMRU1FTlRfQ0FDSEUgPSB7fTtcblxuICBmdW5jdGlvbiBzaG91bGRVc2VDcmVhdGlvbkNhY2hlKHRhZ05hbWUsIGF0dHJpYnV0ZXMpIHtcbiAgICBpZiAodGFnTmFtZSA9PT0gJ3NlbGVjdCcpIHJldHVybiBmYWxzZTtcbiAgICBpZiAoJ3R5cGUnIGluIGF0dHJpYnV0ZXMpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHZhciBIQVNfRVhURU5ERURfQ1JFQVRFX0VMRU1FTlRfU1lOVEFYID0gKGZ1bmN0aW9uKCl7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJzxpbnB1dCBuYW1lPVwieFwiPicpO1xuICAgICAgcmV0dXJuIGVsLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0JyAmJiBlbC5uYW1lID09PSAneCc7XG4gICAgfVxuICAgIGNhdGNoKGVycikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSkoKTtcblxuXG4gIHZhciBvbGRFbGVtZW50ID0gR0xPQkFMLkVsZW1lbnQ7XG4gIGZ1bmN0aW9uIEVsZW1lbnQodGFnTmFtZSwgYXR0cmlidXRlcykge1xuICAgIGF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzIHx8IHt9O1xuICAgIHRhZ05hbWUgPSB0YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBpZiAoSEFTX0VYVEVOREVEX0NSRUFURV9FTEVNRU5UX1NZTlRBWCAmJiBhdHRyaWJ1dGVzLm5hbWUpIHtcbiAgICAgIHRhZ05hbWUgPSAnPCcgKyB0YWdOYW1lICsgJyBuYW1lPVwiJyArIGF0dHJpYnV0ZXMubmFtZSArICdcIj4nO1xuICAgICAgZGVsZXRlIGF0dHJpYnV0ZXMubmFtZTtcbiAgICAgIHJldHVybiBFbGVtZW50LndyaXRlQXR0cmlidXRlKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSksIGF0dHJpYnV0ZXMpO1xuICAgIH1cblxuICAgIGlmICghRUxFTUVOVF9DQUNIRVt0YWdOYW1lXSlcbiAgICAgIEVMRU1FTlRfQ0FDSEVbdGFnTmFtZV0gPSBFbGVtZW50LmV4dGVuZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpKTtcblxuICAgIHZhciBub2RlID0gc2hvdWxkVXNlQ3JlYXRpb25DYWNoZSh0YWdOYW1lLCBhdHRyaWJ1dGVzKSA/XG4gICAgIEVMRU1FTlRfQ0FDSEVbdGFnTmFtZV0uY2xvbmVOb2RlKGZhbHNlKSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG5cbiAgICByZXR1cm4gRWxlbWVudC53cml0ZUF0dHJpYnV0ZShub2RlLCBhdHRyaWJ1dGVzKTtcbiAgfVxuXG4gIEdMT0JBTC5FbGVtZW50ID0gRWxlbWVudDtcblxuICBPYmplY3QuZXh0ZW5kKEdMT0JBTC5FbGVtZW50LCBvbGRFbGVtZW50IHx8IHt9KTtcbiAgaWYgKG9sZEVsZW1lbnQpIEdMT0JBTC5FbGVtZW50LnByb3RvdHlwZSA9IG9sZEVsZW1lbnQucHJvdG90eXBlO1xuXG4gIEVsZW1lbnQuTWV0aG9kcyA9IHsgQnlUYWc6IHt9LCBTaW11bGF0ZWQ6IHt9IH07XG5cbiAgdmFyIG1ldGhvZHMgPSB7fTtcblxuICB2YXIgSU5TUEVDVF9BVFRSSUJVVEVTID0geyBpZDogJ2lkJywgY2xhc3NOYW1lOiAnY2xhc3MnIH07XG4gIGZ1bmN0aW9uIGluc3BlY3QoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciByZXN1bHQgPSAnPCcgKyBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgIHZhciBhdHRyaWJ1dGUsIHZhbHVlO1xuICAgIGZvciAodmFyIHByb3BlcnR5IGluIElOU1BFQ1RfQVRUUklCVVRFUykge1xuICAgICAgYXR0cmlidXRlID0gSU5TUEVDVF9BVFRSSUJVVEVTW3Byb3BlcnR5XTtcbiAgICAgIHZhbHVlID0gKGVsZW1lbnRbcHJvcGVydHldIHx8ICcnKS50b1N0cmluZygpO1xuICAgICAgaWYgKHZhbHVlKSByZXN1bHQgKz0gJyAnICsgYXR0cmlidXRlICsgJz0nICsgdmFsdWUuaW5zcGVjdCh0cnVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0ICsgJz4nO1xuICB9XG5cbiAgbWV0aG9kcy5pbnNwZWN0ID0gaW5zcGVjdDtcblxuXG4gIGZ1bmN0aW9uIHZpc2libGUoZWxlbWVudCkge1xuICAgIHJldHVybiAkKGVsZW1lbnQpLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJztcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvZ2dsZShlbGVtZW50LCBib29sKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChib29sKSlcbiAgICAgIGJvb2wgPSAhRWxlbWVudC52aXNpYmxlKGVsZW1lbnQpO1xuICAgIEVsZW1lbnRbYm9vbCA/ICdzaG93JyA6ICdoaWRlJ10oZWxlbWVudCk7XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZGUoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3coZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cblxuICBPYmplY3QuZXh0ZW5kKG1ldGhvZHMsIHtcbiAgICB2aXNpYmxlOiB2aXNpYmxlLFxuICAgIHRvZ2dsZTogIHRvZ2dsZSxcbiAgICBoaWRlOiAgICBoaWRlLFxuICAgIHNob3c6ICAgIHNob3dcbiAgfSk7XG5cblxuICBmdW5jdGlvbiByZW1vdmUoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIHZhciBTRUxFQ1RfRUxFTUVOVF9JTk5FUkhUTUxfQlVHR1kgPSAoZnVuY3Rpb24oKXtcbiAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpLFxuICAgICAgICBpc0J1Z2d5ID0gdHJ1ZTtcbiAgICBlbC5pbm5lckhUTUwgPSBcIjxvcHRpb24gdmFsdWU9XFxcInRlc3RcXFwiPnRlc3Q8L29wdGlvbj5cIjtcbiAgICBpZiAoZWwub3B0aW9ucyAmJiBlbC5vcHRpb25zWzBdKSB7XG4gICAgICBpc0J1Z2d5ID0gZWwub3B0aW9uc1swXS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpICE9PSBcIk9QVElPTlwiO1xuICAgIH1cbiAgICBlbCA9IG51bGw7XG4gICAgcmV0dXJuIGlzQnVnZ3k7XG4gIH0pKCk7XG5cbiAgdmFyIFRBQkxFX0VMRU1FTlRfSU5ORVJIVE1MX0JVR0dZID0gKGZ1bmN0aW9uKCl7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiKTtcbiAgICAgIGlmIChlbCAmJiBlbC50Qm9kaWVzKSB7XG4gICAgICAgIGVsLmlubmVySFRNTCA9IFwiPHRib2R5Pjx0cj48dGQ+dGVzdDwvdGQ+PC90cj48L3Rib2R5PlwiO1xuICAgICAgICB2YXIgaXNCdWdneSA9IHR5cGVvZiBlbC50Qm9kaWVzWzBdID09IFwidW5kZWZpbmVkXCI7XG4gICAgICAgIGVsID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIGlzQnVnZ3k7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KSgpO1xuXG4gIHZhciBMSU5LX0VMRU1FTlRfSU5ORVJIVE1MX0JVR0dZID0gKGZ1bmN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGVsLmlubmVySFRNTCA9IFwiPGxpbmsgLz5cIjtcbiAgICAgIHZhciBpc0J1Z2d5ID0gKGVsLmNoaWxkTm9kZXMubGVuZ3RoID09PSAwKTtcbiAgICAgIGVsID0gbnVsbDtcbiAgICAgIHJldHVybiBpc0J1Z2d5O1xuICAgIH0gY2F0Y2goZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KSgpO1xuXG4gIHZhciBBTllfSU5ORVJIVE1MX0JVR0dZID0gU0VMRUNUX0VMRU1FTlRfSU5ORVJIVE1MX0JVR0dZIHx8XG4gICBUQUJMRV9FTEVNRU5UX0lOTkVSSFRNTF9CVUdHWSB8fCBMSU5LX0VMRU1FTlRfSU5ORVJIVE1MX0JVR0dZO1xuXG4gIHZhciBTQ1JJUFRfRUxFTUVOVF9SRUpFQ1RTX1RFWFROT0RFX0FQUEVORElORyA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpLFxuICAgICAgICBpc0J1Z2d5ID0gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIHMuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJcIikpO1xuICAgICAgaXNCdWdneSA9ICFzLmZpcnN0Q2hpbGQgfHxcbiAgICAgICAgcy5maXJzdENoaWxkICYmIHMuZmlyc3RDaGlsZC5ub2RlVHlwZSAhPT0gMztcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpc0J1Z2d5ID0gdHJ1ZTtcbiAgICB9XG4gICAgcyA9IG51bGw7XG4gICAgcmV0dXJuIGlzQnVnZ3k7XG4gIH0pKCk7XG5cbiAgZnVuY3Rpb24gdXBkYXRlKGVsZW1lbnQsIGNvbnRlbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgIHZhciBkZXNjZW5kYW50cyA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKSxcbiAgICAgaSA9IGRlc2NlbmRhbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSBwdXJnZUVsZW1lbnQoZGVzY2VuZGFudHNbaV0pO1xuXG4gICAgaWYgKGNvbnRlbnQgJiYgY29udGVudC50b0VsZW1lbnQpXG4gICAgICBjb250ZW50ID0gY29udGVudC50b0VsZW1lbnQoKTtcblxuICAgIGlmIChPYmplY3QuaXNFbGVtZW50KGNvbnRlbnQpKVxuICAgICAgcmV0dXJuIGVsZW1lbnQudXBkYXRlKCkuaW5zZXJ0KGNvbnRlbnQpO1xuXG5cbiAgICBjb250ZW50ID0gT2JqZWN0LnRvSFRNTChjb250ZW50KTtcbiAgICB2YXIgdGFnTmFtZSA9IGVsZW1lbnQudGFnTmFtZS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgaWYgKHRhZ05hbWUgPT09ICdTQ1JJUFQnICYmIFNDUklQVF9FTEVNRU5UX1JFSkVDVFNfVEVYVE5PREVfQVBQRU5ESU5HKSB7XG4gICAgICBlbGVtZW50LnRleHQgPSBjb250ZW50O1xuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuXG4gICAgaWYgKEFOWV9JTk5FUkhUTUxfQlVHR1kpIHtcbiAgICAgIGlmICh0YWdOYW1lIGluIElOU0VSVElPTl9UUkFOU0xBVElPTlMudGFncykge1xuICAgICAgICB3aGlsZSAoZWxlbWVudC5maXJzdENoaWxkKVxuICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2hpbGQoZWxlbWVudC5maXJzdENoaWxkKTtcblxuICAgICAgICB2YXIgbm9kZXMgPSBnZXRDb250ZW50RnJvbUFub255bW91c0VsZW1lbnQodGFnTmFtZSwgY29udGVudC5zdHJpcFNjcmlwdHMoKSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKylcbiAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xuXG4gICAgICB9IGVsc2UgaWYgKExJTktfRUxFTUVOVF9JTk5FUkhUTUxfQlVHR1kgJiYgT2JqZWN0LmlzU3RyaW5nKGNvbnRlbnQpICYmIGNvbnRlbnQuaW5kZXhPZignPGxpbmsnKSA+IC0xKSB7XG4gICAgICAgIHdoaWxlIChlbGVtZW50LmZpcnN0Q2hpbGQpXG4gICAgICAgICAgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXG4gICAgICAgIHZhciBub2RlcyA9IGdldENvbnRlbnRGcm9tQW5vbnltb3VzRWxlbWVudCh0YWdOYW1lLFxuICAgICAgICAgY29udGVudC5zdHJpcFNjcmlwdHMoKSwgdHJ1ZSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKVxuICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IGNvbnRlbnQuc3RyaXBTY3JpcHRzKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gY29udGVudC5zdHJpcFNjcmlwdHMoKTtcbiAgICB9XG5cbiAgICBjb250ZW50LmV2YWxTY3JpcHRzLmJpbmQoY29udGVudCkuZGVmZXIoKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlcGxhY2UoZWxlbWVudCwgY29udGVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgaWYgKGNvbnRlbnQgJiYgY29udGVudC50b0VsZW1lbnQpIHtcbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnRvRWxlbWVudCgpO1xuICAgIH0gZWxzZSBpZiAoIU9iamVjdC5pc0VsZW1lbnQoY29udGVudCkpIHtcbiAgICAgIGNvbnRlbnQgPSBPYmplY3QudG9IVE1MKGNvbnRlbnQpO1xuICAgICAgdmFyIHJhbmdlID0gZWxlbWVudC5vd25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICByYW5nZS5zZWxlY3ROb2RlKGVsZW1lbnQpO1xuICAgICAgY29udGVudC5ldmFsU2NyaXB0cy5iaW5kKGNvbnRlbnQpLmRlZmVyKCk7XG4gICAgICBjb250ZW50ID0gcmFuZ2UuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KGNvbnRlbnQuc3RyaXBTY3JpcHRzKCkpO1xuICAgIH1cblxuICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY29udGVudCwgZWxlbWVudCk7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICB2YXIgSU5TRVJUSU9OX1RSQU5TTEFUSU9OUyA9IHtcbiAgICBiZWZvcmU6IGZ1bmN0aW9uKGVsZW1lbnQsIG5vZGUpIHtcbiAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgZWxlbWVudCk7XG4gICAgfSxcbiAgICB0b3A6IGZ1bmN0aW9uKGVsZW1lbnQsIG5vZGUpIHtcbiAgICAgIGVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIGVsZW1lbnQuZmlyc3RDaGlsZCk7XG4gICAgfSxcbiAgICBib3R0b206IGZ1bmN0aW9uKGVsZW1lbnQsIG5vZGUpIHtcbiAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgfSxcbiAgICBhZnRlcjogZnVuY3Rpb24oZWxlbWVudCwgbm9kZSkge1xuICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCBlbGVtZW50Lm5leHRTaWJsaW5nKTtcbiAgICB9LFxuXG4gICAgdGFnczoge1xuICAgICAgVEFCTEU6ICBbJzx0YWJsZT4nLCAgICAgICAgICAgICAgICAnPC90YWJsZT4nLCAgICAgICAgICAgICAgICAgICAxXSxcbiAgICAgIFRCT0RZOiAgWyc8dGFibGU+PHRib2R5PicsICAgICAgICAgJzwvdGJvZHk+PC90YWJsZT4nLCAgICAgICAgICAgMl0sXG4gICAgICBUUjogICAgIFsnPHRhYmxlPjx0Ym9keT48dHI+JywgICAgICc8L3RyPjwvdGJvZHk+PC90YWJsZT4nLCAgICAgIDNdLFxuICAgICAgVEQ6ICAgICBbJzx0YWJsZT48dGJvZHk+PHRyPjx0ZD4nLCAnPC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT4nLCA0XSxcbiAgICAgIFNFTEVDVDogWyc8c2VsZWN0PicsICAgICAgICAgICAgICAgJzwvc2VsZWN0PicsICAgICAgICAgICAgICAgICAgMV1cbiAgICB9XG4gIH07XG5cbiAgdmFyIHRhZ3MgPSBJTlNFUlRJT05fVFJBTlNMQVRJT05TLnRhZ3M7XG5cbiAgT2JqZWN0LmV4dGVuZCh0YWdzLCB7XG4gICAgVEhFQUQ6IHRhZ3MuVEJPRFksXG4gICAgVEZPT1Q6IHRhZ3MuVEJPRFksXG4gICAgVEg6ICAgIHRhZ3MuVERcbiAgfSk7XG5cbiAgZnVuY3Rpb24gcmVwbGFjZV9JRShlbGVtZW50LCBjb250ZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgaWYgKGNvbnRlbnQgJiYgY29udGVudC50b0VsZW1lbnQpXG4gICAgICBjb250ZW50ID0gY29udGVudC50b0VsZW1lbnQoKTtcbiAgICBpZiAoT2JqZWN0LmlzRWxlbWVudChjb250ZW50KSkge1xuICAgICAgZWxlbWVudC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChjb250ZW50LCBlbGVtZW50KTtcbiAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cblxuICAgIGNvbnRlbnQgPSBPYmplY3QudG9IVE1MKGNvbnRlbnQpO1xuICAgIHZhciBwYXJlbnQgPSBlbGVtZW50LnBhcmVudE5vZGUsIHRhZ05hbWUgPSBwYXJlbnQudGFnTmFtZS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgaWYgKHRhZ05hbWUgaW4gSU5TRVJUSU9OX1RSQU5TTEFUSU9OUy50YWdzKSB7XG4gICAgICB2YXIgbmV4dFNpYmxpbmcgPSBFbGVtZW50Lm5leHQoZWxlbWVudCk7XG4gICAgICB2YXIgZnJhZ21lbnRzID0gZ2V0Q29udGVudEZyb21Bbm9ueW1vdXNFbGVtZW50KFxuICAgICAgIHRhZ05hbWUsIGNvbnRlbnQuc3RyaXBTY3JpcHRzKCkpO1xuXG4gICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XG5cbiAgICAgIHZhciBpdGVyYXRvcjtcbiAgICAgIGlmIChuZXh0U2libGluZylcbiAgICAgICAgaXRlcmF0b3IgPSBmdW5jdGlvbihub2RlKSB7IHBhcmVudC5pbnNlcnRCZWZvcmUobm9kZSwgbmV4dFNpYmxpbmcpIH07XG4gICAgICBlbHNlXG4gICAgICAgIGl0ZXJhdG9yID0gZnVuY3Rpb24obm9kZSkgeyBwYXJlbnQuYXBwZW5kQ2hpbGQobm9kZSk7IH1cblxuICAgICAgZnJhZ21lbnRzLmVhY2goaXRlcmF0b3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50Lm91dGVySFRNTCA9IGNvbnRlbnQuc3RyaXBTY3JpcHRzKCk7XG4gICAgfVxuXG4gICAgY29udGVudC5ldmFsU2NyaXB0cy5iaW5kKGNvbnRlbnQpLmRlZmVyKCk7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBpZiAoJ291dGVySFRNTCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KVxuICAgIHJlcGxhY2UgPSByZXBsYWNlX0lFO1xuXG4gIGZ1bmN0aW9uIGlzQ29udGVudChjb250ZW50KSB7XG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChjb250ZW50KSB8fCBjb250ZW50ID09PSBudWxsKSByZXR1cm4gZmFsc2U7XG5cbiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKGNvbnRlbnQpIHx8IE9iamVjdC5pc051bWJlcihjb250ZW50KSkgcmV0dXJuIHRydWU7XG4gICAgaWYgKE9iamVjdC5pc0VsZW1lbnQoY29udGVudCkpIHJldHVybiB0cnVlO1xuICAgIGlmIChjb250ZW50LnRvRWxlbWVudCB8fCBjb250ZW50LnRvSFRNTCkgcmV0dXJuIHRydWU7XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBpbnNlcnRDb250ZW50QXQoZWxlbWVudCwgY29udGVudCwgcG9zaXRpb24pIHtcbiAgICBwb3NpdGlvbiAgID0gcG9zaXRpb24udG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgbWV0aG9kID0gSU5TRVJUSU9OX1RSQU5TTEFUSU9OU1twb3NpdGlvbl07XG5cbiAgICBpZiAoY29udGVudCAmJiBjb250ZW50LnRvRWxlbWVudCkgY29udGVudCA9IGNvbnRlbnQudG9FbGVtZW50KCk7XG4gICAgaWYgKE9iamVjdC5pc0VsZW1lbnQoY29udGVudCkpIHtcbiAgICAgIG1ldGhvZChlbGVtZW50LCBjb250ZW50KTtcbiAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cblxuICAgIGNvbnRlbnQgPSBPYmplY3QudG9IVE1MKGNvbnRlbnQpO1xuICAgIHZhciB0YWdOYW1lID0gKChwb3NpdGlvbiA9PT0gJ2JlZm9yZScgfHwgcG9zaXRpb24gPT09ICdhZnRlcicpID9cbiAgICAgZWxlbWVudC5wYXJlbnROb2RlIDogZWxlbWVudCkudGFnTmFtZS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgdmFyIGNoaWxkTm9kZXMgPSBnZXRDb250ZW50RnJvbUFub255bW91c0VsZW1lbnQodGFnTmFtZSwgY29udGVudC5zdHJpcFNjcmlwdHMoKSk7XG5cbiAgICBpZiAocG9zaXRpb24gPT09ICd0b3AnIHx8IHBvc2l0aW9uID09PSAnYWZ0ZXInKSBjaGlsZE5vZGVzLnJldmVyc2UoKTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gY2hpbGROb2Rlc1tpXTsgaSsrKVxuICAgICAgbWV0aG9kKGVsZW1lbnQsIG5vZGUpO1xuXG4gICAgY29udGVudC5ldmFsU2NyaXB0cy5iaW5kKGNvbnRlbnQpLmRlZmVyKCk7XG4gIH1cblxuICBmdW5jdGlvbiBpbnNlcnQoZWxlbWVudCwgaW5zZXJ0aW9ucykge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgaWYgKGlzQ29udGVudChpbnNlcnRpb25zKSlcbiAgICAgIGluc2VydGlvbnMgPSB7IGJvdHRvbTogaW5zZXJ0aW9ucyB9O1xuXG4gICAgZm9yICh2YXIgcG9zaXRpb24gaW4gaW5zZXJ0aW9ucylcbiAgICAgIGluc2VydENvbnRlbnRBdChlbGVtZW50LCBpbnNlcnRpb25zW3Bvc2l0aW9uXSwgcG9zaXRpb24pO1xuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiB3cmFwKGVsZW1lbnQsIHdyYXBwZXIsIGF0dHJpYnV0ZXMpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgIGlmIChPYmplY3QuaXNFbGVtZW50KHdyYXBwZXIpKSB7XG4gICAgICAkKHdyYXBwZXIpLndyaXRlQXR0cmlidXRlKGF0dHJpYnV0ZXMgfHwge30pO1xuICAgIH0gZWxzZSBpZiAoT2JqZWN0LmlzU3RyaW5nKHdyYXBwZXIpKSB7XG4gICAgICB3cmFwcGVyID0gbmV3IEVsZW1lbnQod3JhcHBlciwgYXR0cmlidXRlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdyYXBwZXIgPSBuZXcgRWxlbWVudCgnZGl2Jywgd3JhcHBlcik7XG4gICAgfVxuXG4gICAgaWYgKGVsZW1lbnQucGFyZW50Tm9kZSlcbiAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQod3JhcHBlciwgZWxlbWVudCk7XG5cbiAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuXG4gICAgcmV0dXJuIHdyYXBwZXI7XG4gIH1cblxuICBmdW5jdGlvbiBjbGVhbldoaXRlc3BhY2UoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBub2RlID0gZWxlbWVudC5maXJzdENoaWxkO1xuXG4gICAgd2hpbGUgKG5vZGUpIHtcbiAgICAgIHZhciBuZXh0Tm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XG4gICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUgJiYgIS9cXFMvLnRlc3Qobm9kZS5ub2RlVmFsdWUpKVxuICAgICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKG5vZGUpO1xuICAgICAgbm9kZSA9IG5leHROb2RlO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVtcHR5KGVsZW1lbnQpIHtcbiAgICByZXR1cm4gJChlbGVtZW50KS5pbm5lckhUTUwuYmxhbmsoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldENvbnRlbnRGcm9tQW5vbnltb3VzRWxlbWVudCh0YWdOYW1lLCBodG1sLCBmb3JjZSkge1xuICAgIHZhciB0ID0gSU5TRVJUSU9OX1RSQU5TTEFUSU9OUy50YWdzW3RhZ05hbWVdLCBkaXYgPSBESVY7XG5cbiAgICB2YXIgd29ya2Fyb3VuZCA9ICEhdDtcbiAgICBpZiAoIXdvcmthcm91bmQgJiYgZm9yY2UpIHtcbiAgICAgIHdvcmthcm91bmQgPSB0cnVlO1xuICAgICAgdCA9IFsnJywgJycsIDBdO1xuICAgIH1cblxuICAgIGlmICh3b3JrYXJvdW5kKSB7XG4gICAgICBkaXYuaW5uZXJIVE1MID0gJyYjMTYwOycgKyB0WzBdICsgaHRtbCArIHRbMV07XG4gICAgICBkaXYucmVtb3ZlQ2hpbGQoZGl2LmZpcnN0Q2hpbGQpO1xuICAgICAgZm9yICh2YXIgaSA9IHRbMl07IGktLTsgKVxuICAgICAgICBkaXYgPSBkaXYuZmlyc3RDaGlsZDtcbiAgICB9IGVsc2Uge1xuICAgICAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG4gICAgfVxuXG4gICAgcmV0dXJuICRBKGRpdi5jaGlsZE5vZGVzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb25lKGVsZW1lbnQsIGRlZXApIHtcbiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjtcbiAgICB2YXIgY2xvbmUgPSBlbGVtZW50LmNsb25lTm9kZShkZWVwKTtcbiAgICBpZiAoIUhBU19VTklRVUVfSURfUFJPUEVSVFkpIHtcbiAgICAgIGNsb25lLl9wcm90b3R5cGVVSUQgPSBVTkRFRklORUQ7XG4gICAgICBpZiAoZGVlcCkge1xuICAgICAgICB2YXIgZGVzY2VuZGFudHMgPSBFbGVtZW50LnNlbGVjdChjbG9uZSwgJyonKSxcbiAgICAgICAgIGkgPSBkZXNjZW5kYW50cy5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChpLS0pXG4gICAgICAgICAgZGVzY2VuZGFudHNbaV0uX3Byb3RvdHlwZVVJRCA9IFVOREVGSU5FRDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKGNsb25lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHB1cmdlRWxlbWVudChlbGVtZW50KSB7XG4gICAgdmFyIHVpZCA9IGdldFVuaXF1ZUVsZW1lbnRJRChlbGVtZW50KTtcbiAgICBpZiAodWlkKSB7XG4gICAgICBFbGVtZW50LnN0b3BPYnNlcnZpbmcoZWxlbWVudCk7XG4gICAgICBpZiAoIUhBU19VTklRVUVfSURfUFJPUEVSVFkpXG4gICAgICAgIGVsZW1lbnQuX3Byb3RvdHlwZVVJRCA9IFVOREVGSU5FRDtcbiAgICAgIGRlbGV0ZSBFbGVtZW50LlN0b3JhZ2VbdWlkXTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwdXJnZUNvbGxlY3Rpb24oZWxlbWVudHMpIHtcbiAgICB2YXIgaSA9IGVsZW1lbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKVxuICAgICAgcHVyZ2VFbGVtZW50KGVsZW1lbnRzW2ldKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHB1cmdlQ29sbGVjdGlvbl9JRShlbGVtZW50cykge1xuICAgIHZhciBpID0gZWxlbWVudHMubGVuZ3RoLCBlbGVtZW50LCB1aWQ7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgZWxlbWVudCA9IGVsZW1lbnRzW2ldO1xuICAgICAgdWlkID0gZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpO1xuICAgICAgZGVsZXRlIEVsZW1lbnQuU3RvcmFnZVt1aWRdO1xuICAgICAgZGVsZXRlIEV2ZW50LmNhY2hlW3VpZF07XG4gICAgfVxuICB9XG5cbiAgaWYgKEhBU19VTklRVUVfSURfUFJPUEVSVFkpIHtcbiAgICBwdXJnZUNvbGxlY3Rpb24gPSBwdXJnZUNvbGxlY3Rpb25fSUU7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHB1cmdlKGVsZW1lbnQpIHtcbiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjtcbiAgICBwdXJnZUVsZW1lbnQoZWxlbWVudCk7XG5cbiAgICB2YXIgZGVzY2VuZGFudHMgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJyksXG4gICAgIGkgPSBkZXNjZW5kYW50cy5sZW5ndGg7XG5cbiAgICB3aGlsZSAoaS0tKSBwdXJnZUVsZW1lbnQoZGVzY2VuZGFudHNbaV0pO1xuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBPYmplY3QuZXh0ZW5kKG1ldGhvZHMsIHtcbiAgICByZW1vdmU6ICByZW1vdmUsXG4gICAgdXBkYXRlOiAgdXBkYXRlLFxuICAgIHJlcGxhY2U6IHJlcGxhY2UsXG4gICAgaW5zZXJ0OiAgaW5zZXJ0LFxuICAgIHdyYXA6ICAgIHdyYXAsXG4gICAgY2xlYW5XaGl0ZXNwYWNlOiBjbGVhbldoaXRlc3BhY2UsXG4gICAgZW1wdHk6ICAgZW1wdHksXG4gICAgY2xvbmU6ICAgY2xvbmUsXG4gICAgcHVyZ2U6ICAgcHVyZ2VcbiAgfSk7XG5cblxuXG4gIGZ1bmN0aW9uIHJlY3Vyc2l2ZWx5Q29sbGVjdChlbGVtZW50LCBwcm9wZXJ0eSwgbWF4aW11bUxlbmd0aCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIG1heGltdW1MZW5ndGggPSBtYXhpbXVtTGVuZ3RoIHx8IC0xO1xuICAgIHZhciBlbGVtZW50cyA9IFtdO1xuXG4gICAgd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50W3Byb3BlcnR5XSkge1xuICAgICAgaWYgKGVsZW1lbnQubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKVxuICAgICAgICBlbGVtZW50cy5wdXNoKEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpKTtcblxuICAgICAgaWYgKGVsZW1lbnRzLmxlbmd0aCA9PT0gbWF4aW11bUxlbmd0aCkgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnRzO1xuICB9XG5cblxuICBmdW5jdGlvbiBhbmNlc3RvcnMoZWxlbWVudCkge1xuICAgIHJldHVybiByZWN1cnNpdmVseUNvbGxlY3QoZWxlbWVudCwgJ3BhcmVudE5vZGUnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlc2NlbmRhbnRzKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gRWxlbWVudC5zZWxlY3QoZWxlbWVudCwgJyonKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpcnN0RGVzY2VuZGFudChlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCkuZmlyc3RDaGlsZDtcbiAgICB3aGlsZSAoZWxlbWVudCAmJiBlbGVtZW50Lm5vZGVUeXBlICE9PSBOb2RlLkVMRU1FTlRfTk9ERSlcbiAgICAgIGVsZW1lbnQgPSBlbGVtZW50Lm5leHRTaWJsaW5nO1xuXG4gICAgcmV0dXJuICQoZWxlbWVudCk7XG4gIH1cblxuICBmdW5jdGlvbiBpbW1lZGlhdGVEZXNjZW5kYW50cyhlbGVtZW50KSB7XG4gICAgdmFyIHJlc3VsdHMgPSBbXSwgY2hpbGQgPSAkKGVsZW1lbnQpLmZpcnN0Q2hpbGQ7XG5cbiAgICB3aGlsZSAoY2hpbGQpIHtcbiAgICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUpXG4gICAgICAgIHJlc3VsdHMucHVzaChFbGVtZW50LmV4dGVuZChjaGlsZCkpO1xuXG4gICAgICBjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJldmlvdXNTaWJsaW5ncyhlbGVtZW50KSB7XG4gICAgcmV0dXJuIHJlY3Vyc2l2ZWx5Q29sbGVjdChlbGVtZW50LCAncHJldmlvdXNTaWJsaW5nJyk7XG4gIH1cblxuICBmdW5jdGlvbiBuZXh0U2libGluZ3MoZWxlbWVudCkge1xuICAgIHJldHVybiByZWN1cnNpdmVseUNvbGxlY3QoZWxlbWVudCwgJ25leHRTaWJsaW5nJyk7XG4gIH1cblxuICBmdW5jdGlvbiBzaWJsaW5ncyhlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIHByZXZpb3VzID0gcHJldmlvdXNTaWJsaW5ncyhlbGVtZW50KSxcbiAgICAgbmV4dCA9IG5leHRTaWJsaW5ncyhlbGVtZW50KTtcbiAgICByZXR1cm4gcHJldmlvdXMucmV2ZXJzZSgpLmNvbmNhdChuZXh0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1hdGNoKGVsZW1lbnQsIHNlbGVjdG9yKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKHNlbGVjdG9yKSlcbiAgICAgIHJldHVybiBQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2goZWxlbWVudCwgc2VsZWN0b3IpO1xuXG4gICAgcmV0dXJuIHNlbGVjdG9yLm1hdGNoKGVsZW1lbnQpO1xuICB9XG5cblxuICBmdW5jdGlvbiBfcmVjdXJzaXZlbHlGaW5kKGVsZW1lbnQsIHByb3BlcnR5LCBleHByZXNzaW9uLCBpbmRleCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpLCBleHByZXNzaW9uID0gZXhwcmVzc2lvbiB8fCAwLCBpbmRleCA9IGluZGV4IHx8IDA7XG4gICAgaWYgKE9iamVjdC5pc051bWJlcihleHByZXNzaW9uKSkge1xuICAgICAgaW5kZXggPSBleHByZXNzaW9uLCBleHByZXNzaW9uID0gbnVsbDtcbiAgICB9XG5cbiAgICB3aGlsZSAoZWxlbWVudCA9IGVsZW1lbnRbcHJvcGVydHldKSB7XG4gICAgICBpZiAoZWxlbWVudC5ub2RlVHlwZSAhPT0gMSkgY29udGludWU7XG4gICAgICBpZiAoZXhwcmVzc2lvbiAmJiAhUHJvdG90eXBlLlNlbGVjdG9yLm1hdGNoKGVsZW1lbnQsIGV4cHJlc3Npb24pKVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIGlmICgtLWluZGV4ID49IDApIGNvbnRpbnVlO1xuXG4gICAgICByZXR1cm4gRWxlbWVudC5leHRlbmQoZWxlbWVudCk7XG4gICAgfVxuICB9XG5cblxuICBmdW5jdGlvbiB1cChlbGVtZW50LCBleHByZXNzaW9uLCBpbmRleCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHJldHVybiAkKGVsZW1lbnQucGFyZW50Tm9kZSk7XG4gICAgcmV0dXJuIF9yZWN1cnNpdmVseUZpbmQoZWxlbWVudCwgJ3BhcmVudE5vZGUnLCBleHByZXNzaW9uLCBpbmRleCk7XG4gIH1cblxuICBmdW5jdGlvbiBkb3duKGVsZW1lbnQsIGV4cHJlc3Npb24sIGluZGV4KSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHJldHVybiBmaXJzdERlc2NlbmRhbnQoZWxlbWVudCk7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCksIGV4cHJlc3Npb24gPSBleHByZXNzaW9uIHx8IDAsIGluZGV4ID0gaW5kZXggfHwgMDtcblxuICAgIGlmIChPYmplY3QuaXNOdW1iZXIoZXhwcmVzc2lvbikpXG4gICAgICBpbmRleCA9IGV4cHJlc3Npb24sIGV4cHJlc3Npb24gPSAnKic7XG5cbiAgICB2YXIgbm9kZSA9IFByb3RvdHlwZS5TZWxlY3Rvci5zZWxlY3QoZXhwcmVzc2lvbiwgZWxlbWVudClbaW5kZXhdO1xuICAgIHJldHVybiBFbGVtZW50LmV4dGVuZChub2RlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByZXZpb3VzKGVsZW1lbnQsIGV4cHJlc3Npb24sIGluZGV4KSB7XG4gICAgcmV0dXJuIF9yZWN1cnNpdmVseUZpbmQoZWxlbWVudCwgJ3ByZXZpb3VzU2libGluZycsIGV4cHJlc3Npb24sIGluZGV4KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG5leHQoZWxlbWVudCwgZXhwcmVzc2lvbiwgaW5kZXgpIHtcbiAgICByZXR1cm4gX3JlY3Vyc2l2ZWx5RmluZChlbGVtZW50LCAnbmV4dFNpYmxpbmcnLCBleHByZXNzaW9uLCBpbmRleCk7XG4gIH1cblxuICBmdW5jdGlvbiBzZWxlY3QoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBleHByZXNzaW9ucyA9IFNMSUNFLmNhbGwoYXJndW1lbnRzLCAxKS5qb2luKCcsICcpO1xuICAgIHJldHVybiBQcm90b3R5cGUuU2VsZWN0b3Iuc2VsZWN0KGV4cHJlc3Npb25zLCBlbGVtZW50KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkamFjZW50KGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgZXhwcmVzc2lvbnMgPSBTTElDRS5jYWxsKGFyZ3VtZW50cywgMSkuam9pbignLCAnKTtcbiAgICB2YXIgc2libGluZ3MgPSBFbGVtZW50LnNpYmxpbmdzKGVsZW1lbnQpLCByZXN1bHRzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDAsIHNpYmxpbmc7IHNpYmxpbmcgPSBzaWJsaW5nc1tpXTsgaSsrKSB7XG4gICAgICBpZiAoUHJvdG90eXBlLlNlbGVjdG9yLm1hdGNoKHNpYmxpbmcsIGV4cHJlc3Npb25zKSlcbiAgICAgICAgcmVzdWx0cy5wdXNoKHNpYmxpbmcpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgZnVuY3Rpb24gZGVzY2VuZGFudE9mX0RPTShlbGVtZW50LCBhbmNlc3Rvcikge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpLCBhbmNlc3RvciA9ICQoYW5jZXN0b3IpO1xuICAgIHdoaWxlIChlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlKVxuICAgICAgaWYgKGVsZW1lbnQgPT09IGFuY2VzdG9yKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBkZXNjZW5kYW50T2ZfY29udGFpbnMoZWxlbWVudCwgYW5jZXN0b3IpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KSwgYW5jZXN0b3IgPSAkKGFuY2VzdG9yKTtcbiAgICBpZiAoIWFuY2VzdG9yLmNvbnRhaW5zKSByZXR1cm4gZGVzY2VuZGFudE9mX0RPTShlbGVtZW50LCBhbmNlc3Rvcik7XG4gICAgcmV0dXJuIGFuY2VzdG9yLmNvbnRhaW5zKGVsZW1lbnQpICYmIGFuY2VzdG9yICE9PSBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gZGVzY2VuZGFudE9mX2NvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGVsZW1lbnQsIGFuY2VzdG9yKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCksIGFuY2VzdG9yID0gJChhbmNlc3Rvcik7XG4gICAgcmV0dXJuIChlbGVtZW50LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGFuY2VzdG9yKSAmIDgpID09PSA4O1xuICB9XG5cbiAgdmFyIGRlc2NlbmRhbnRPZjtcbiAgaWYgKERJVi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbikge1xuICAgIGRlc2NlbmRhbnRPZiA9IGRlc2NlbmRhbnRPZl9jb21wYXJlRG9jdW1lbnRQb3NpdGlvbjtcbiAgfSBlbHNlIGlmIChESVYuY29udGFpbnMpIHtcbiAgICBkZXNjZW5kYW50T2YgPSBkZXNjZW5kYW50T2ZfY29udGFpbnM7XG4gIH0gZWxzZSB7XG4gICAgZGVzY2VuZGFudE9mID0gZGVzY2VuZGFudE9mX0RPTTtcbiAgfVxuXG5cbiAgT2JqZWN0LmV4dGVuZChtZXRob2RzLCB7XG4gICAgcmVjdXJzaXZlbHlDb2xsZWN0OiAgIHJlY3Vyc2l2ZWx5Q29sbGVjdCxcbiAgICBhbmNlc3RvcnM6ICAgICAgICAgICAgYW5jZXN0b3JzLFxuICAgIGRlc2NlbmRhbnRzOiAgICAgICAgICBkZXNjZW5kYW50cyxcbiAgICBmaXJzdERlc2NlbmRhbnQ6ICAgICAgZmlyc3REZXNjZW5kYW50LFxuICAgIGltbWVkaWF0ZURlc2NlbmRhbnRzOiBpbW1lZGlhdGVEZXNjZW5kYW50cyxcbiAgICBwcmV2aW91c1NpYmxpbmdzOiAgICAgcHJldmlvdXNTaWJsaW5ncyxcbiAgICBuZXh0U2libGluZ3M6ICAgICAgICAgbmV4dFNpYmxpbmdzLFxuICAgIHNpYmxpbmdzOiAgICAgICAgICAgICBzaWJsaW5ncyxcbiAgICBtYXRjaDogICAgICAgICAgICAgICAgbWF0Y2gsXG4gICAgdXA6ICAgICAgICAgICAgICAgICAgIHVwLFxuICAgIGRvd246ICAgICAgICAgICAgICAgICBkb3duLFxuICAgIHByZXZpb3VzOiAgICAgICAgICAgICBwcmV2aW91cyxcbiAgICBuZXh0OiAgICAgICAgICAgICAgICAgbmV4dCxcbiAgICBzZWxlY3Q6ICAgICAgICAgICAgICAgc2VsZWN0LFxuICAgIGFkamFjZW50OiAgICAgICAgICAgICBhZGphY2VudCxcbiAgICBkZXNjZW5kYW50T2Y6ICAgICAgICAgZGVzY2VuZGFudE9mLFxuXG4gICAgZ2V0RWxlbWVudHNCeVNlbGVjdG9yOiBzZWxlY3QsXG5cbiAgICBjaGlsZEVsZW1lbnRzOiAgICAgICAgIGltbWVkaWF0ZURlc2NlbmRhbnRzXG4gIH0pO1xuXG5cbiAgdmFyIGlkQ291bnRlciA9IDE7XG4gIGZ1bmN0aW9uIGlkZW50aWZ5KGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgaWQgPSBFbGVtZW50LnJlYWRBdHRyaWJ1dGUoZWxlbWVudCwgJ2lkJyk7XG4gICAgaWYgKGlkKSByZXR1cm4gaWQ7XG5cbiAgICBkbyB7IGlkID0gJ2Fub255bW91c19lbGVtZW50XycgKyBpZENvdW50ZXIrKyB9IHdoaWxlICgkKGlkKSk7XG5cbiAgICBFbGVtZW50LndyaXRlQXR0cmlidXRlKGVsZW1lbnQsICdpZCcsIGlkKTtcbiAgICByZXR1cm4gaWQ7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHJlYWRBdHRyaWJ1dGUoZWxlbWVudCwgbmFtZSkge1xuICAgIHJldHVybiAkKGVsZW1lbnQpLmdldEF0dHJpYnV0ZShuYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRBdHRyaWJ1dGVfSUUoZWxlbWVudCwgbmFtZSkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgdmFyIHRhYmxlID0gQVRUUklCVVRFX1RSQU5TTEFUSU9OUy5yZWFkO1xuICAgIGlmICh0YWJsZS52YWx1ZXNbbmFtZV0pXG4gICAgICByZXR1cm4gdGFibGUudmFsdWVzW25hbWVdKGVsZW1lbnQsIG5hbWUpO1xuXG4gICAgaWYgKHRhYmxlLm5hbWVzW25hbWVdKSBuYW1lID0gdGFibGUubmFtZXNbbmFtZV07XG5cbiAgICBpZiAobmFtZS5pbmNsdWRlKCc6JykpIHtcbiAgICAgIGlmICghZWxlbWVudC5hdHRyaWJ1dGVzIHx8ICFlbGVtZW50LmF0dHJpYnV0ZXNbbmFtZV0pIHJldHVybiBudWxsO1xuICAgICAgcmV0dXJuIGVsZW1lbnQuYXR0cmlidXRlc1tuYW1lXS52YWx1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGUobmFtZSk7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkQXR0cmlidXRlX09wZXJhKGVsZW1lbnQsIG5hbWUpIHtcbiAgICBpZiAobmFtZSA9PT0gJ3RpdGxlJykgcmV0dXJuIGVsZW1lbnQudGl0bGU7XG4gICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKG5hbWUpO1xuICB9XG5cbiAgdmFyIFBST0JMRU1BVElDX0FUVFJJQlVURV9SRUFESU5HID0gKGZ1bmN0aW9uKCkge1xuICAgIERJVi5zZXRBdHRyaWJ1dGUoJ29uY2xpY2snLCBbXSk7XG4gICAgdmFyIHZhbHVlID0gRElWLmdldEF0dHJpYnV0ZSgnb25jbGljaycpO1xuICAgIHZhciBpc0Z1bmN0aW9uID0gT2JqZWN0LmlzQXJyYXkodmFsdWUpO1xuICAgIERJVi5yZW1vdmVBdHRyaWJ1dGUoJ29uY2xpY2snKTtcbiAgICByZXR1cm4gaXNGdW5jdGlvbjtcbiAgfSkoKTtcblxuICBpZiAoUFJPQkxFTUFUSUNfQVRUUklCVVRFX1JFQURJTkcpIHtcbiAgICByZWFkQXR0cmlidXRlID0gcmVhZEF0dHJpYnV0ZV9JRTtcbiAgfSBlbHNlIGlmIChQcm90b3R5cGUuQnJvd3Nlci5PcGVyYSkge1xuICAgIHJlYWRBdHRyaWJ1dGUgPSByZWFkQXR0cmlidXRlX09wZXJhO1xuICB9XG5cblxuICBmdW5jdGlvbiB3cml0ZUF0dHJpYnV0ZShlbGVtZW50LCBuYW1lLCB2YWx1ZSkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBhdHRyaWJ1dGVzID0ge30sIHRhYmxlID0gQVRUUklCVVRFX1RSQU5TTEFUSU9OUy53cml0ZTtcblxuICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGF0dHJpYnV0ZXMgPSBuYW1lO1xuICAgIH0gZWxzZSB7XG4gICAgICBhdHRyaWJ1dGVzW25hbWVdID0gT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSA/IHRydWUgOiB2YWx1ZTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBhdHRyIGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgIG5hbWUgPSB0YWJsZS5uYW1lc1thdHRyXSB8fCBhdHRyO1xuICAgICAgdmFsdWUgPSBhdHRyaWJ1dGVzW2F0dHJdO1xuICAgICAgaWYgKHRhYmxlLnZhbHVlc1thdHRyXSlcbiAgICAgICAgbmFtZSA9IHRhYmxlLnZhbHVlc1thdHRyXShlbGVtZW50LCB2YWx1ZSkgfHwgbmFtZTtcbiAgICAgIGlmICh2YWx1ZSA9PT0gZmFsc2UgfHwgdmFsdWUgPT09IG51bGwpXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKG5hbWUpO1xuICAgICAgZWxzZSBpZiAodmFsdWUgPT09IHRydWUpXG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIG5hbWUpO1xuICAgICAgZWxzZSBlbGVtZW50LnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICB2YXIgUFJPQkxFTUFUSUNfSEFTX0FUVFJJQlVURV9XSVRIX0NIRUNLQk9YRVMgPSAoZnVuY3Rpb24gKCkge1xuICAgIGlmICghSEFTX0VYVEVOREVEX0NSRUFURV9FTEVNRU5UX1NZTlRBWCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB2YXIgY2hlY2tib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCI+Jyk7XG4gICAgY2hlY2tib3guY2hlY2tlZCA9IHRydWU7XG4gICAgdmFyIG5vZGUgPSBjaGVja2JveC5nZXRBdHRyaWJ1dGVOb2RlKCdjaGVja2VkJyk7XG4gICAgcmV0dXJuICFub2RlIHx8ICFub2RlLnNwZWNpZmllZDtcbiAgfSkoKTtcblxuICBmdW5jdGlvbiBoYXNBdHRyaWJ1dGUoZWxlbWVudCwgYXR0cmlidXRlKSB7XG4gICAgYXR0cmlidXRlID0gQVRUUklCVVRFX1RSQU5TTEFUSU9OUy5oYXNbYXR0cmlidXRlXSB8fCBhdHRyaWJ1dGU7XG4gICAgdmFyIG5vZGUgPSAkKGVsZW1lbnQpLmdldEF0dHJpYnV0ZU5vZGUoYXR0cmlidXRlKTtcbiAgICByZXR1cm4gISEobm9kZSAmJiBub2RlLnNwZWNpZmllZCk7XG4gIH1cblxuICBmdW5jdGlvbiBoYXNBdHRyaWJ1dGVfSUUoZWxlbWVudCwgYXR0cmlidXRlKSB7XG4gICAgaWYgKGF0dHJpYnV0ZSA9PT0gJ2NoZWNrZWQnKSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5jaGVja2VkO1xuICAgIH1cbiAgICByZXR1cm4gaGFzQXR0cmlidXRlKGVsZW1lbnQsIGF0dHJpYnV0ZSk7XG4gIH1cblxuICBHTE9CQUwuRWxlbWVudC5NZXRob2RzLlNpbXVsYXRlZC5oYXNBdHRyaWJ1dGUgPVxuICAgUFJPQkxFTUFUSUNfSEFTX0FUVFJJQlVURV9XSVRIX0NIRUNLQk9YRVMgP1xuICAgaGFzQXR0cmlidXRlX0lFIDogaGFzQXR0cmlidXRlO1xuXG4gIGZ1bmN0aW9uIGNsYXNzTmFtZXMoZWxlbWVudCkge1xuICAgIHJldHVybiBuZXcgRWxlbWVudC5DbGFzc05hbWVzKGVsZW1lbnQpO1xuICB9XG5cbiAgdmFyIHJlZ0V4cENhY2hlID0ge307XG4gIGZ1bmN0aW9uIGdldFJlZ0V4cEZvckNsYXNzTmFtZShjbGFzc05hbWUpIHtcbiAgICBpZiAocmVnRXhwQ2FjaGVbY2xhc3NOYW1lXSkgcmV0dXJuIHJlZ0V4cENhY2hlW2NsYXNzTmFtZV07XG5cbiAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiKF58XFxcXHMrKVwiICsgY2xhc3NOYW1lICsgXCIoXFxcXHMrfCQpXCIpO1xuICAgIHJlZ0V4cENhY2hlW2NsYXNzTmFtZV0gPSByZTtcbiAgICByZXR1cm4gcmU7XG4gIH1cblxuICBmdW5jdGlvbiBoYXNDbGFzc05hbWUoZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgaWYgKCEoZWxlbWVudCA9ICQoZWxlbWVudCkpKSByZXR1cm47XG5cbiAgICB2YXIgZWxlbWVudENsYXNzTmFtZSA9IGVsZW1lbnQuY2xhc3NOYW1lO1xuXG4gICAgaWYgKGVsZW1lbnRDbGFzc05hbWUubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGVsZW1lbnRDbGFzc05hbWUgPT09IGNsYXNzTmFtZSkgcmV0dXJuIHRydWU7XG5cbiAgICByZXR1cm4gZ2V0UmVnRXhwRm9yQ2xhc3NOYW1lKGNsYXNzTmFtZSkudGVzdChlbGVtZW50Q2xhc3NOYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZENsYXNzTmFtZShlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjtcblxuICAgIGlmICghaGFzQ2xhc3NOYW1lKGVsZW1lbnQsIGNsYXNzTmFtZSkpXG4gICAgICBlbGVtZW50LmNsYXNzTmFtZSArPSAoZWxlbWVudC5jbGFzc05hbWUgPyAnICcgOiAnJykgKyBjbGFzc05hbWU7XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUNsYXNzTmFtZShlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjtcblxuICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUucmVwbGFjZShcbiAgICAgZ2V0UmVnRXhwRm9yQ2xhc3NOYW1lKGNsYXNzTmFtZSksICcgJykuc3RyaXAoKTtcblxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gdG9nZ2xlQ2xhc3NOYW1lKGVsZW1lbnQsIGNsYXNzTmFtZSwgYm9vbCkge1xuICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuO1xuXG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChib29sKSlcbiAgICAgIGJvb2wgPSAhaGFzQ2xhc3NOYW1lKGVsZW1lbnQsIGNsYXNzTmFtZSk7XG5cbiAgICB2YXIgbWV0aG9kID0gRWxlbWVudFtib29sID8gJ2FkZENsYXNzTmFtZScgOiAncmVtb3ZlQ2xhc3NOYW1lJ107XG4gICAgcmV0dXJuIG1ldGhvZChlbGVtZW50LCBjbGFzc05hbWUpO1xuICB9XG5cbiAgdmFyIEFUVFJJQlVURV9UUkFOU0xBVElPTlMgPSB7fTtcblxuICB2YXIgY2xhc3NQcm9wID0gJ2NsYXNzTmFtZScsIGZvclByb3AgPSAnZm9yJztcblxuICBESVYuc2V0QXR0cmlidXRlKGNsYXNzUHJvcCwgJ3gnKTtcbiAgaWYgKERJVi5jbGFzc05hbWUgIT09ICd4Jykge1xuICAgIERJVi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3gnKTtcbiAgICBpZiAoRElWLmNsYXNzTmFtZSA9PT0gJ3gnKVxuICAgICAgY2xhc3NQcm9wID0gJ2NsYXNzJztcbiAgfVxuXG4gIHZhciBMQUJFTCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIExBQkVMLnNldEF0dHJpYnV0ZShmb3JQcm9wLCAneCcpO1xuICBpZiAoTEFCRUwuaHRtbEZvciAhPT0gJ3gnKSB7XG4gICAgTEFCRUwuc2V0QXR0cmlidXRlKCdodG1sRm9yJywgJ3gnKTtcbiAgICBpZiAoTEFCRUwuaHRtbEZvciA9PT0gJ3gnKVxuICAgICAgZm9yUHJvcCA9ICdodG1sRm9yJztcbiAgfVxuICBMQUJFTCA9IG51bGw7XG5cbiAgZnVuY3Rpb24gX2dldEF0dHIoZWxlbWVudCwgYXR0cmlidXRlKSB7XG4gICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0QXR0cjIoZWxlbWVudCwgYXR0cmlidXRlKSB7XG4gICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgMik7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0QXR0ck5vZGUoZWxlbWVudCwgYXR0cmlidXRlKSB7XG4gICAgdmFyIG5vZGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZU5vZGUoYXR0cmlidXRlKTtcbiAgICByZXR1cm4gbm9kZSA/IG5vZGUudmFsdWUgOiAnJztcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRGbGFnKGVsZW1lbnQsIGF0dHJpYnV0ZSkge1xuICAgIHJldHVybiAkKGVsZW1lbnQpLmhhc0F0dHJpYnV0ZShhdHRyaWJ1dGUpID8gYXR0cmlidXRlIDogbnVsbDtcbiAgfVxuXG4gIERJVi5vbmNsaWNrID0gUHJvdG90eXBlLmVtcHR5RnVuY3Rpb247XG4gIHZhciBvbmNsaWNrVmFsdWUgPSBESVYuZ2V0QXR0cmlidXRlKCdvbmNsaWNrJyk7XG5cbiAgdmFyIF9nZXRFdjtcblxuICBpZiAoU3RyaW5nKG9uY2xpY2tWYWx1ZSkuaW5kZXhPZigneycpID4gLTEpIHtcbiAgICBfZ2V0RXYgPSBmdW5jdGlvbihlbGVtZW50LCBhdHRyaWJ1dGUpIHtcbiAgICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSk7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm4gbnVsbDtcbiAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcbiAgICAgIHZhbHVlID0gdmFsdWUuc3BsaXQoJ3snKVsxXTtcbiAgICAgIHZhbHVlID0gdmFsdWUuc3BsaXQoJ30nKVswXTtcbiAgICAgIHJldHVybiB2YWx1ZS5zdHJpcCgpO1xuICAgIH07XG4gIH1cbiAgZWxzZSBpZiAob25jbGlja1ZhbHVlID09PSAnJykge1xuICAgIF9nZXRFdiA9IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJpYnV0ZSkge1xuICAgICAgdmFyIHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKTtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICAgICAgcmV0dXJuIHZhbHVlLnN0cmlwKCk7XG4gICAgfTtcbiAgfVxuXG4gIEFUVFJJQlVURV9UUkFOU0xBVElPTlMucmVhZCA9IHtcbiAgICBuYW1lczoge1xuICAgICAgJ2NsYXNzJzogICAgIGNsYXNzUHJvcCxcbiAgICAgICdjbGFzc05hbWUnOiBjbGFzc1Byb3AsXG4gICAgICAnZm9yJzogICAgICAgZm9yUHJvcCxcbiAgICAgICdodG1sRm9yJzogICBmb3JQcm9wXG4gICAgfSxcblxuICAgIHZhbHVlczoge1xuICAgICAgc3R5bGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuc3R5bGUuY3NzVGV4dC50b0xvd2VyQ2FzZSgpO1xuICAgICAgfSxcbiAgICAgIHRpdGxlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50LnRpdGxlO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBBVFRSSUJVVEVfVFJBTlNMQVRJT05TLndyaXRlID0ge1xuICAgIG5hbWVzOiB7XG4gICAgICBjbGFzc05hbWU6ICAgJ2NsYXNzJyxcbiAgICAgIGh0bWxGb3I6ICAgICAnZm9yJyxcbiAgICAgIGNlbGxwYWRkaW5nOiAnY2VsbFBhZGRpbmcnLFxuICAgICAgY2VsbHNwYWNpbmc6ICdjZWxsU3BhY2luZydcbiAgICB9LFxuXG4gICAgdmFsdWVzOiB7XG4gICAgICBjaGVja2VkOiBmdW5jdGlvbihlbGVtZW50LCB2YWx1ZSkge1xuICAgICAgICBlbGVtZW50LmNoZWNrZWQgPSAhIXZhbHVlO1xuICAgICAgfSxcblxuICAgICAgc3R5bGU6IGZ1bmN0aW9uKGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUuY3NzVGV4dCA9IHZhbHVlID8gdmFsdWUgOiAnJztcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgQVRUUklCVVRFX1RSQU5TTEFUSU9OUy5oYXMgPSB7IG5hbWVzOiB7fSB9O1xuXG4gIE9iamVjdC5leHRlbmQoQVRUUklCVVRFX1RSQU5TTEFUSU9OUy53cml0ZS5uYW1lcyxcbiAgIEFUVFJJQlVURV9UUkFOU0xBVElPTlMucmVhZC5uYW1lcyk7XG5cbiAgdmFyIENBTUVMX0NBU0VEX0FUVFJJQlVURV9OQU1FUyA9ICR3KCdjb2xTcGFuIHJvd1NwYW4gdkFsaWduIGRhdGVUaW1lICcgK1xuICAgJ2FjY2Vzc0tleSB0YWJJbmRleCBlbmNUeXBlIG1heExlbmd0aCByZWFkT25seSBsb25nRGVzYyBmcmFtZUJvcmRlcicpO1xuXG4gIGZvciAodmFyIGkgPSAwLCBhdHRyOyBhdHRyID0gQ0FNRUxfQ0FTRURfQVRUUklCVVRFX05BTUVTW2ldOyBpKyspIHtcbiAgICBBVFRSSUJVVEVfVFJBTlNMQVRJT05TLndyaXRlLm5hbWVzW2F0dHIudG9Mb3dlckNhc2UoKV0gPSBhdHRyO1xuICAgIEFUVFJJQlVURV9UUkFOU0xBVElPTlMuaGFzLm5hbWVzW2F0dHIudG9Mb3dlckNhc2UoKV0gICA9IGF0dHI7XG4gIH1cblxuICBPYmplY3QuZXh0ZW5kKEFUVFJJQlVURV9UUkFOU0xBVElPTlMucmVhZC52YWx1ZXMsIHtcbiAgICBocmVmOiAgICAgICAgX2dldEF0dHIyLFxuICAgIHNyYzogICAgICAgICBfZ2V0QXR0cjIsXG4gICAgdHlwZTogICAgICAgIF9nZXRBdHRyLFxuICAgIGFjdGlvbjogICAgICBfZ2V0QXR0ck5vZGUsXG4gICAgZGlzYWJsZWQ6ICAgIF9nZXRGbGFnLFxuICAgIGNoZWNrZWQ6ICAgICBfZ2V0RmxhZyxcbiAgICByZWFkb25seTogICAgX2dldEZsYWcsXG4gICAgbXVsdGlwbGU6ICAgIF9nZXRGbGFnLFxuICAgIG9ubG9hZDogICAgICBfZ2V0RXYsXG4gICAgb251bmxvYWQ6ICAgIF9nZXRFdixcbiAgICBvbmNsaWNrOiAgICAgX2dldEV2LFxuICAgIG9uZGJsY2xpY2s6ICBfZ2V0RXYsXG4gICAgb25tb3VzZWRvd246IF9nZXRFdixcbiAgICBvbm1vdXNldXA6ICAgX2dldEV2LFxuICAgIG9ubW91c2VvdmVyOiBfZ2V0RXYsXG4gICAgb25tb3VzZW1vdmU6IF9nZXRFdixcbiAgICBvbm1vdXNlb3V0OiAgX2dldEV2LFxuICAgIG9uZm9jdXM6ICAgICBfZ2V0RXYsXG4gICAgb25ibHVyOiAgICAgIF9nZXRFdixcbiAgICBvbmtleXByZXNzOiAgX2dldEV2LFxuICAgIG9ua2V5ZG93bjogICBfZ2V0RXYsXG4gICAgb25rZXl1cDogICAgIF9nZXRFdixcbiAgICBvbnN1Ym1pdDogICAgX2dldEV2LFxuICAgIG9ucmVzZXQ6ICAgICBfZ2V0RXYsXG4gICAgb25zZWxlY3Q6ICAgIF9nZXRFdixcbiAgICBvbmNoYW5nZTogICAgX2dldEV2XG4gIH0pO1xuXG5cbiAgT2JqZWN0LmV4dGVuZChtZXRob2RzLCB7XG4gICAgaWRlbnRpZnk6ICAgICAgICBpZGVudGlmeSxcbiAgICByZWFkQXR0cmlidXRlOiAgIHJlYWRBdHRyaWJ1dGUsXG4gICAgd3JpdGVBdHRyaWJ1dGU6ICB3cml0ZUF0dHJpYnV0ZSxcbiAgICBjbGFzc05hbWVzOiAgICAgIGNsYXNzTmFtZXMsXG4gICAgaGFzQ2xhc3NOYW1lOiAgICBoYXNDbGFzc05hbWUsXG4gICAgYWRkQ2xhc3NOYW1lOiAgICBhZGRDbGFzc05hbWUsXG4gICAgcmVtb3ZlQ2xhc3NOYW1lOiByZW1vdmVDbGFzc05hbWUsXG4gICAgdG9nZ2xlQ2xhc3NOYW1lOiB0b2dnbGVDbGFzc05hbWVcbiAgfSk7XG5cblxuICBmdW5jdGlvbiBub3JtYWxpemVTdHlsZU5hbWUoc3R5bGUpIHtcbiAgICBpZiAoc3R5bGUgPT09ICdmbG9hdCcgfHwgc3R5bGUgPT09ICdzdHlsZUZsb2F0JylcbiAgICAgIHJldHVybiAnY3NzRmxvYXQnO1xuICAgIHJldHVybiBzdHlsZS5jYW1lbGl6ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gbm9ybWFsaXplU3R5bGVOYW1lX0lFKHN0eWxlKSB7XG4gICAgaWYgKHN0eWxlID09PSAnZmxvYXQnIHx8IHN0eWxlID09PSAnY3NzRmxvYXQnKVxuICAgICAgcmV0dXJuICdzdHlsZUZsb2F0JztcbiAgICByZXR1cm4gc3R5bGUuY2FtZWxpemUoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFN0eWxlKGVsZW1lbnQsIHN0eWxlcykge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBlbGVtZW50U3R5bGUgPSBlbGVtZW50LnN0eWxlLCBtYXRjaDtcblxuICAgIGlmIChPYmplY3QuaXNTdHJpbmcoc3R5bGVzKSkge1xuICAgICAgZWxlbWVudFN0eWxlLmNzc1RleHQgKz0gJzsnICsgc3R5bGVzO1xuICAgICAgaWYgKHN0eWxlcy5pbmNsdWRlKCdvcGFjaXR5JykpIHtcbiAgICAgICAgdmFyIG9wYWNpdHkgPSBzdHlsZXMubWF0Y2goL29wYWNpdHk6XFxzKihcXGQ/XFwuP1xcZCopLylbMV07XG4gICAgICAgIEVsZW1lbnQuc2V0T3BhY2l0eShlbGVtZW50LCBvcGFjaXR5KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cblxuICAgIGZvciAodmFyIHByb3BlcnR5IGluIHN0eWxlcykge1xuICAgICAgaWYgKHByb3BlcnR5ID09PSAnb3BhY2l0eScpIHtcbiAgICAgICAgRWxlbWVudC5zZXRPcGFjaXR5KGVsZW1lbnQsIHN0eWxlc1twcm9wZXJ0eV0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHZhbHVlID0gc3R5bGVzW3Byb3BlcnR5XTtcbiAgICAgICAgaWYgKHByb3BlcnR5ID09PSAnZmxvYXQnIHx8IHByb3BlcnR5ID09PSAnY3NzRmxvYXQnKSB7XG4gICAgICAgICAgcHJvcGVydHkgPSBPYmplY3QuaXNVbmRlZmluZWQoZWxlbWVudFN0eWxlLnN0eWxlRmxvYXQpID9cbiAgICAgICAgICAgJ2Nzc0Zsb2F0JyA6ICdzdHlsZUZsb2F0JztcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50U3R5bGVbcHJvcGVydHldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGdldFN0eWxlKGVsZW1lbnQsIHN0eWxlKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgc3R5bGUgPSBub3JtYWxpemVTdHlsZU5hbWUoc3R5bGUpO1xuXG4gICAgdmFyIHZhbHVlID0gZWxlbWVudC5zdHlsZVtzdHlsZV07XG4gICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA9PT0gJ2F1dG8nKSB7XG4gICAgICB2YXIgY3NzID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKTtcbiAgICAgIHZhbHVlID0gY3NzID8gY3NzW3N0eWxlXSA6IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHN0eWxlID09PSAnb3BhY2l0eScpIHJldHVybiB2YWx1ZSA/IHBhcnNlRmxvYXQodmFsdWUpIDogMS4wO1xuICAgIHJldHVybiB2YWx1ZSA9PT0gJ2F1dG8nID8gbnVsbCA6IHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0U3R5bGVfT3BlcmEoZWxlbWVudCwgc3R5bGUpIHtcbiAgICBzd2l0Y2ggKHN0eWxlKSB7XG4gICAgICBjYXNlICdoZWlnaHQnOiBjYXNlICd3aWR0aCc6XG4gICAgICAgIGlmICghRWxlbWVudC52aXNpYmxlKGVsZW1lbnQpKSByZXR1cm4gbnVsbDtcblxuICAgICAgICB2YXIgZGltID0gcGFyc2VJbnQoZ2V0U3R5bGUoZWxlbWVudCwgc3R5bGUpLCAxMCk7XG5cbiAgICAgICAgaWYgKGRpbSAhPT0gZWxlbWVudFsnb2Zmc2V0JyArIHN0eWxlLmNhcGl0YWxpemUoKV0pXG4gICAgICAgICAgcmV0dXJuIGRpbSArICdweCc7XG5cbiAgICAgICAgcmV0dXJuIEVsZW1lbnQubWVhc3VyZShlbGVtZW50LCBzdHlsZSk7XG5cbiAgICAgIGRlZmF1bHQ6IHJldHVybiBnZXRTdHlsZShlbGVtZW50LCBzdHlsZSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0U3R5bGVfSUUoZWxlbWVudCwgc3R5bGUpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICBzdHlsZSA9IG5vcm1hbGl6ZVN0eWxlTmFtZV9JRShzdHlsZSk7XG5cbiAgICB2YXIgdmFsdWUgPSBlbGVtZW50LnN0eWxlW3N0eWxlXTtcbiAgICBpZiAoIXZhbHVlICYmIGVsZW1lbnQuY3VycmVudFN0eWxlKSB7XG4gICAgICB2YWx1ZSA9IGVsZW1lbnQuY3VycmVudFN0eWxlW3N0eWxlXTtcbiAgICB9XG5cbiAgICBpZiAoc3R5bGUgPT09ICdvcGFjaXR5JyAmJiAhU1RBTkRBUkRfQ1NTX09QQUNJVFlfU1VQUE9SVEVEKVxuICAgICAgcmV0dXJuIGdldE9wYWNpdHlfSUUoZWxlbWVudCk7XG5cbiAgICBpZiAodmFsdWUgPT09ICdhdXRvJykge1xuICAgICAgaWYgKChzdHlsZSA9PT0gJ3dpZHRoJyB8fCBzdHlsZSA9PT0gJ2hlaWdodCcpICYmIEVsZW1lbnQudmlzaWJsZShlbGVtZW50KSlcbiAgICAgICAgcmV0dXJuIEVsZW1lbnQubWVhc3VyZShlbGVtZW50LCBzdHlsZSkgKyAncHgnO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RyaXBBbHBoYUZyb21GaWx0ZXJfSUUoZmlsdGVyKSB7XG4gICAgcmV0dXJuIChmaWx0ZXIgfHwgJycpLnJlcGxhY2UoL2FscGhhXFwoW15cXCldKlxcKS9naSwgJycpO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFzTGF5b3V0X0lFKGVsZW1lbnQpIHtcbiAgICBpZiAoIWVsZW1lbnQuY3VycmVudFN0eWxlIHx8ICFlbGVtZW50LmN1cnJlbnRTdHlsZS5oYXNMYXlvdXQpXG4gICAgICBlbGVtZW50LnN0eWxlLnpvb20gPSAxO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgdmFyIFNUQU5EQVJEX0NTU19PUEFDSVRZX1NVUFBPUlRFRCA9IChmdW5jdGlvbigpIHtcbiAgICBESVYuc3R5bGUuY3NzVGV4dCA9IFwib3BhY2l0eTouNTVcIjtcbiAgICByZXR1cm4gL14wLjU1Ly50ZXN0KERJVi5zdHlsZS5vcGFjaXR5KTtcbiAgfSkoKTtcblxuICBmdW5jdGlvbiBzZXRPcGFjaXR5KGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgaWYgKHZhbHVlID09IDEgfHwgdmFsdWUgPT09ICcnKSB2YWx1ZSA9ICcnO1xuICAgIGVsc2UgaWYgKHZhbHVlIDwgMC4wMDAwMSkgdmFsdWUgPSAwO1xuICAgIGVsZW1lbnQuc3R5bGUub3BhY2l0eSA9IHZhbHVlO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0T3BhY2l0eV9JRShlbGVtZW50LCB2YWx1ZSkge1xuICAgIGlmIChTVEFOREFSRF9DU1NfT1BBQ0lUWV9TVVBQT1JURUQpXG4gICAgICByZXR1cm4gc2V0T3BhY2l0eShlbGVtZW50LCB2YWx1ZSk7XG5cbiAgICBlbGVtZW50ID0gaGFzTGF5b3V0X0lFKCQoZWxlbWVudCkpO1xuICAgIHZhciBmaWx0ZXIgPSBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdmaWx0ZXInKSxcbiAgICAgc3R5bGUgPSBlbGVtZW50LnN0eWxlO1xuXG4gICAgaWYgKHZhbHVlID09IDEgfHwgdmFsdWUgPT09ICcnKSB7XG4gICAgICBmaWx0ZXIgPSBzdHJpcEFscGhhRnJvbUZpbHRlcl9JRShmaWx0ZXIpO1xuICAgICAgaWYgKGZpbHRlcikgc3R5bGUuZmlsdGVyID0gZmlsdGVyO1xuICAgICAgZWxzZSBzdHlsZS5yZW1vdmVBdHRyaWJ1dGUoJ2ZpbHRlcicpO1xuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlIDwgMC4wMDAwMSkgdmFsdWUgPSAwO1xuXG4gICAgc3R5bGUuZmlsdGVyID0gc3RyaXBBbHBoYUZyb21GaWx0ZXJfSUUoZmlsdGVyKSArXG4gICAgICdhbHBoYShvcGFjaXR5PScgKyAodmFsdWUgKiAxMDApICsgJyknO1xuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGdldE9wYWNpdHkoZWxlbWVudCkge1xuICAgIHJldHVybiBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdvcGFjaXR5Jyk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRPcGFjaXR5X0lFKGVsZW1lbnQpIHtcbiAgICBpZiAoU1RBTkRBUkRfQ1NTX09QQUNJVFlfU1VQUE9SVEVEKVxuICAgICAgcmV0dXJuIGdldE9wYWNpdHkoZWxlbWVudCk7XG5cbiAgICB2YXIgZmlsdGVyID0gRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAnZmlsdGVyJyk7XG4gICAgaWYgKGZpbHRlci5sZW5ndGggPT09IDApIHJldHVybiAxLjA7XG4gICAgdmFyIG1hdGNoID0gKGZpbHRlciB8fCAnJykubWF0Y2goL2FscGhhXFwob3BhY2l0eT0oLiopXFwpLyk7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSByZXR1cm4gcGFyc2VGbG9hdChtYXRjaFsxXSkgLyAxMDA7XG4gICAgcmV0dXJuIDEuMDtcbiAgfVxuXG5cbiAgT2JqZWN0LmV4dGVuZChtZXRob2RzLCB7XG4gICAgc2V0U3R5bGU6ICAgc2V0U3R5bGUsXG4gICAgZ2V0U3R5bGU6ICAgZ2V0U3R5bGUsXG4gICAgc2V0T3BhY2l0eTogc2V0T3BhY2l0eSxcbiAgICBnZXRPcGFjaXR5OiBnZXRPcGFjaXR5XG4gIH0pO1xuXG4gIGlmICgnc3R5bGVGbG9hdCcgaW4gRElWLnN0eWxlKSB7XG4gICAgbWV0aG9kcy5nZXRTdHlsZSA9IGdldFN0eWxlX0lFO1xuICAgIG1ldGhvZHMuc2V0T3BhY2l0eSA9IHNldE9wYWNpdHlfSUU7XG4gICAgbWV0aG9kcy5nZXRPcGFjaXR5ID0gZ2V0T3BhY2l0eV9JRTtcbiAgfVxuXG4gIHZhciBVSUQgPSAwO1xuXG4gIEdMT0JBTC5FbGVtZW50LlN0b3JhZ2UgPSB7IFVJRDogMSB9O1xuXG4gIGZ1bmN0aW9uIGdldFVuaXF1ZUVsZW1lbnRJRChlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQgPT09IHdpbmRvdykgcmV0dXJuIDA7XG5cbiAgICBpZiAodHlwZW9mIGVsZW1lbnQuX3Byb3RvdHlwZVVJRCA9PT0gJ3VuZGVmaW5lZCcpXG4gICAgICBlbGVtZW50Ll9wcm90b3R5cGVVSUQgPSBFbGVtZW50LlN0b3JhZ2UuVUlEKys7XG4gICAgcmV0dXJuIGVsZW1lbnQuX3Byb3RvdHlwZVVJRDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFVuaXF1ZUVsZW1lbnRJRF9JRShlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQgPT09IHdpbmRvdykgcmV0dXJuIDA7XG4gICAgaWYgKGVsZW1lbnQgPT0gZG9jdW1lbnQpIHJldHVybiAxO1xuICAgIHJldHVybiBlbGVtZW50LnVuaXF1ZUlEO1xuICB9XG5cbiAgdmFyIEhBU19VTklRVUVfSURfUFJPUEVSVFkgPSAoJ3VuaXF1ZUlEJyBpbiBESVYpO1xuICBpZiAoSEFTX1VOSVFVRV9JRF9QUk9QRVJUWSlcbiAgICBnZXRVbmlxdWVFbGVtZW50SUQgPSBnZXRVbmlxdWVFbGVtZW50SURfSUU7XG5cbiAgZnVuY3Rpb24gZ2V0U3RvcmFnZShlbGVtZW50KSB7XG4gICAgaWYgKCEoZWxlbWVudCA9ICQoZWxlbWVudCkpKSByZXR1cm47XG5cbiAgICB2YXIgdWlkID0gZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpO1xuXG4gICAgaWYgKCFFbGVtZW50LlN0b3JhZ2VbdWlkXSlcbiAgICAgIEVsZW1lbnQuU3RvcmFnZVt1aWRdID0gJEgoKTtcblxuICAgIHJldHVybiBFbGVtZW50LlN0b3JhZ2VbdWlkXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3JlKGVsZW1lbnQsIGtleSwgdmFsdWUpIHtcbiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjtcbiAgICB2YXIgc3RvcmFnZSA9IGdldFN0b3JhZ2UoZWxlbWVudCk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIHN0b3JhZ2UudXBkYXRlKGtleSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0b3JhZ2Uuc2V0KGtleSwgdmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJldHJpZXZlKGVsZW1lbnQsIGtleSwgZGVmYXVsdFZhbHVlKSB7XG4gICAgaWYgKCEoZWxlbWVudCA9ICQoZWxlbWVudCkpKSByZXR1cm47XG4gICAgdmFyIHN0b3JhZ2UgPSBnZXRTdG9yYWdlKGVsZW1lbnQpLCB2YWx1ZSA9IHN0b3JhZ2UuZ2V0KGtleSk7XG5cbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSkge1xuICAgICAgc3RvcmFnZS5zZXQoa2V5LCBkZWZhdWx0VmFsdWUpO1xuICAgICAgdmFsdWUgPSBkZWZhdWx0VmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cblxuICBPYmplY3QuZXh0ZW5kKG1ldGhvZHMsIHtcbiAgICBnZXRTdG9yYWdlOiBnZXRTdG9yYWdlLFxuICAgIHN0b3JlOiAgICAgIHN0b3JlLFxuICAgIHJldHJpZXZlOiAgIHJldHJpZXZlXG4gIH0pO1xuXG5cbiAgdmFyIE1ldGhvZHMgPSB7fSwgQnlUYWcgPSBFbGVtZW50Lk1ldGhvZHMuQnlUYWcsXG4gICBGID0gUHJvdG90eXBlLkJyb3dzZXJGZWF0dXJlcztcblxuICBpZiAoIUYuRWxlbWVudEV4dGVuc2lvbnMgJiYgKCdfX3Byb3RvX18nIGluIERJVikpIHtcbiAgICBHTE9CQUwuSFRNTEVsZW1lbnQgPSB7fTtcbiAgICBHTE9CQUwuSFRNTEVsZW1lbnQucHJvdG90eXBlID0gRElWWydfX3Byb3RvX18nXTtcbiAgICBGLkVsZW1lbnRFeHRlbnNpb25zID0gdHJ1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrRWxlbWVudFByb3RvdHlwZURlZmljaWVuY3kodGFnTmFtZSkge1xuICAgIGlmICh0eXBlb2Ygd2luZG93LkVsZW1lbnQgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKCFIQVNfRVhURU5ERURfQ1JFQVRFX0VMRU1FTlRfU1lOVEFYKSByZXR1cm4gZmFsc2U7XG4gICAgdmFyIHByb3RvID0gd2luZG93LkVsZW1lbnQucHJvdG90eXBlO1xuICAgIGlmIChwcm90bykge1xuICAgICAgdmFyIGlkID0gJ18nICsgKE1hdGgucmFuZG9tKCkgKyAnJykuc2xpY2UoMiksXG4gICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpO1xuICAgICAgcHJvdG9baWRdID0gJ3gnO1xuICAgICAgdmFyIGlzQnVnZ3kgPSAoZWxbaWRdICE9PSAneCcpO1xuICAgICAgZGVsZXRlIHByb3RvW2lkXTtcbiAgICAgIGVsID0gbnVsbDtcbiAgICAgIHJldHVybiBpc0J1Z2d5O1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBIVE1MT0JKRUNURUxFTUVOVF9QUk9UT1RZUEVfQlVHR1kgPVxuICAgY2hlY2tFbGVtZW50UHJvdG90eXBlRGVmaWNpZW5jeSgnb2JqZWN0Jyk7XG5cbiAgZnVuY3Rpb24gZXh0ZW5kRWxlbWVudFdpdGgoZWxlbWVudCwgbWV0aG9kcykge1xuICAgIGZvciAodmFyIHByb3BlcnR5IGluIG1ldGhvZHMpIHtcbiAgICAgIHZhciB2YWx1ZSA9IG1ldGhvZHNbcHJvcGVydHldO1xuICAgICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKHZhbHVlKSAmJiAhKHByb3BlcnR5IGluIGVsZW1lbnQpKVxuICAgICAgICBlbGVtZW50W3Byb3BlcnR5XSA9IHZhbHVlLm1ldGhvZGl6ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBFWFRFTkRFRCA9IHt9O1xuICBmdW5jdGlvbiBlbGVtZW50SXNFeHRlbmRlZChlbGVtZW50KSB7XG4gICAgdmFyIHVpZCA9IGdldFVuaXF1ZUVsZW1lbnRJRChlbGVtZW50KTtcbiAgICByZXR1cm4gKHVpZCBpbiBFWFRFTkRFRCk7XG4gIH1cblxuICBmdW5jdGlvbiBleHRlbmQoZWxlbWVudCkge1xuICAgIGlmICghZWxlbWVudCB8fCBlbGVtZW50SXNFeHRlbmRlZChlbGVtZW50KSkgcmV0dXJuIGVsZW1lbnQ7XG4gICAgaWYgKGVsZW1lbnQubm9kZVR5cGUgIT09IE5vZGUuRUxFTUVOVF9OT0RFIHx8IGVsZW1lbnQgPT0gd2luZG93KVxuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG5cbiAgICB2YXIgbWV0aG9kcyA9IE9iamVjdC5jbG9uZShNZXRob2RzKSxcbiAgICAgdGFnTmFtZSA9IGVsZW1lbnQudGFnTmFtZS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgaWYgKEJ5VGFnW3RhZ05hbWVdKSBPYmplY3QuZXh0ZW5kKG1ldGhvZHMsIEJ5VGFnW3RhZ05hbWVdKTtcblxuICAgIGV4dGVuZEVsZW1lbnRXaXRoKGVsZW1lbnQsIG1ldGhvZHMpO1xuICAgIEVYVEVOREVEW2dldFVuaXF1ZUVsZW1lbnRJRChlbGVtZW50KV0gPSB0cnVlO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gZXh0ZW5kX0lFOChlbGVtZW50KSB7XG4gICAgaWYgKCFlbGVtZW50IHx8IGVsZW1lbnRJc0V4dGVuZGVkKGVsZW1lbnQpKSByZXR1cm4gZWxlbWVudDtcblxuICAgIHZhciB0ID0gZWxlbWVudC50YWdOYW1lO1xuICAgIGlmICh0ICYmICgvXig/Om9iamVjdHxhcHBsZXR8ZW1iZWQpJC9pLnRlc3QodCkpKSB7XG4gICAgICBleHRlbmRFbGVtZW50V2l0aChlbGVtZW50LCBFbGVtZW50Lk1ldGhvZHMpO1xuICAgICAgZXh0ZW5kRWxlbWVudFdpdGgoZWxlbWVudCwgRWxlbWVudC5NZXRob2RzLlNpbXVsYXRlZCk7XG4gICAgICBleHRlbmRFbGVtZW50V2l0aChlbGVtZW50LCBFbGVtZW50Lk1ldGhvZHMuQnlUYWdbdC50b1VwcGVyQ2FzZSgpXSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBpZiAoRi5TcGVjaWZpY0VsZW1lbnRFeHRlbnNpb25zKSB7XG4gICAgZXh0ZW5kID0gSFRNTE9CSkVDVEVMRU1FTlRfUFJPVE9UWVBFX0JVR0dZID8gZXh0ZW5kX0lFOCA6IFByb3RvdHlwZS5LO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkTWV0aG9kc1RvVGFnTmFtZSh0YWdOYW1lLCBtZXRob2RzKSB7XG4gICAgdGFnTmFtZSA9IHRhZ05hbWUudG9VcHBlckNhc2UoKTtcbiAgICBpZiAoIUJ5VGFnW3RhZ05hbWVdKSBCeVRhZ1t0YWdOYW1lXSA9IHt9O1xuICAgIE9iamVjdC5leHRlbmQoQnlUYWdbdGFnTmFtZV0sIG1ldGhvZHMpO1xuICB9XG5cbiAgZnVuY3Rpb24gbWVyZ2VNZXRob2RzKGRlc3RpbmF0aW9uLCBtZXRob2RzLCBvbmx5SWZBYnNlbnQpIHtcbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKG9ubHlJZkFic2VudCkpIG9ubHlJZkFic2VudCA9IGZhbHNlO1xuICAgIGZvciAodmFyIHByb3BlcnR5IGluIG1ldGhvZHMpIHtcbiAgICAgIHZhciB2YWx1ZSA9IG1ldGhvZHNbcHJvcGVydHldO1xuICAgICAgaWYgKCFPYmplY3QuaXNGdW5jdGlvbih2YWx1ZSkpIGNvbnRpbnVlO1xuICAgICAgaWYgKCFvbmx5SWZBYnNlbnQgfHwgIShwcm9wZXJ0eSBpbiBkZXN0aW5hdGlvbikpXG4gICAgICAgIGRlc3RpbmF0aW9uW3Byb3BlcnR5XSA9IHZhbHVlLm1ldGhvZGl6ZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRET01DbGFzcyh0YWdOYW1lKSB7XG4gICAgdmFyIGtsYXNzO1xuICAgIHZhciB0cmFucyA9IHtcbiAgICAgIFwiT1BUR1JPVVBcIjogXCJPcHRHcm91cFwiLCBcIlRFWFRBUkVBXCI6IFwiVGV4dEFyZWFcIiwgXCJQXCI6IFwiUGFyYWdyYXBoXCIsXG4gICAgICBcIkZJRUxEU0VUXCI6IFwiRmllbGRTZXRcIiwgXCJVTFwiOiBcIlVMaXN0XCIsIFwiT0xcIjogXCJPTGlzdFwiLCBcIkRMXCI6IFwiRExpc3RcIixcbiAgICAgIFwiRElSXCI6IFwiRGlyZWN0b3J5XCIsIFwiSDFcIjogXCJIZWFkaW5nXCIsIFwiSDJcIjogXCJIZWFkaW5nXCIsIFwiSDNcIjogXCJIZWFkaW5nXCIsXG4gICAgICBcIkg0XCI6IFwiSGVhZGluZ1wiLCBcIkg1XCI6IFwiSGVhZGluZ1wiLCBcIkg2XCI6IFwiSGVhZGluZ1wiLCBcIlFcIjogXCJRdW90ZVwiLFxuICAgICAgXCJJTlNcIjogXCJNb2RcIiwgXCJERUxcIjogXCJNb2RcIiwgXCJBXCI6IFwiQW5jaG9yXCIsIFwiSU1HXCI6IFwiSW1hZ2VcIiwgXCJDQVBUSU9OXCI6XG4gICAgICBcIlRhYmxlQ2FwdGlvblwiLCBcIkNPTFwiOiBcIlRhYmxlQ29sXCIsIFwiQ09MR1JPVVBcIjogXCJUYWJsZUNvbFwiLCBcIlRIRUFEXCI6XG4gICAgICBcIlRhYmxlU2VjdGlvblwiLCBcIlRGT09UXCI6IFwiVGFibGVTZWN0aW9uXCIsIFwiVEJPRFlcIjogXCJUYWJsZVNlY3Rpb25cIiwgXCJUUlwiOlxuICAgICAgXCJUYWJsZVJvd1wiLCBcIlRIXCI6IFwiVGFibGVDZWxsXCIsIFwiVERcIjogXCJUYWJsZUNlbGxcIiwgXCJGUkFNRVNFVFwiOlxuICAgICAgXCJGcmFtZVNldFwiLCBcIklGUkFNRVwiOiBcIklGcmFtZVwiXG4gICAgfTtcbiAgICBpZiAodHJhbnNbdGFnTmFtZV0pIGtsYXNzID0gJ0hUTUwnICsgdHJhbnNbdGFnTmFtZV0gKyAnRWxlbWVudCc7XG4gICAgaWYgKHdpbmRvd1trbGFzc10pIHJldHVybiB3aW5kb3dba2xhc3NdO1xuICAgIGtsYXNzID0gJ0hUTUwnICsgdGFnTmFtZSArICdFbGVtZW50JztcbiAgICBpZiAod2luZG93W2tsYXNzXSkgcmV0dXJuIHdpbmRvd1trbGFzc107XG4gICAga2xhc3MgPSAnSFRNTCcgKyB0YWdOYW1lLmNhcGl0YWxpemUoKSArICdFbGVtZW50JztcbiAgICBpZiAod2luZG93W2tsYXNzXSkgcmV0dXJuIHdpbmRvd1trbGFzc107XG5cbiAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSksXG4gICAgIHByb3RvID0gZWxlbWVudFsnX19wcm90b19fJ10gfHwgZWxlbWVudC5jb25zdHJ1Y3Rvci5wcm90b3R5cGU7XG5cbiAgICBlbGVtZW50ID0gbnVsbDtcbiAgICByZXR1cm4gcHJvdG87XG4gIH1cblxuICBmdW5jdGlvbiBhZGRNZXRob2RzKG1ldGhvZHMpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgYWRkRm9ybU1ldGhvZHMoKTtcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgICB2YXIgdGFnTmFtZSA9IG1ldGhvZHM7XG4gICAgICBtZXRob2RzID0gYXJndW1lbnRzWzFdO1xuICAgIH1cblxuICAgIGlmICghdGFnTmFtZSkge1xuICAgICAgT2JqZWN0LmV4dGVuZChFbGVtZW50Lk1ldGhvZHMsIG1ldGhvZHMgfHwge30pO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoT2JqZWN0LmlzQXJyYXkodGFnTmFtZSkpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHRhZzsgdGFnID0gdGFnTmFtZVtpXTsgaSsrKVxuICAgICAgICAgIGFkZE1ldGhvZHNUb1RhZ05hbWUodGFnLCBtZXRob2RzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFkZE1ldGhvZHNUb1RhZ05hbWUodGFnTmFtZSwgbWV0aG9kcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIEVMRU1FTlRfUFJPVE9UWVBFID0gd2luZG93LkhUTUxFbGVtZW50ID8gSFRNTEVsZW1lbnQucHJvdG90eXBlIDpcbiAgICAgRWxlbWVudC5wcm90b3R5cGU7XG5cbiAgICBpZiAoRi5FbGVtZW50RXh0ZW5zaW9ucykge1xuICAgICAgbWVyZ2VNZXRob2RzKEVMRU1FTlRfUFJPVE9UWVBFLCBFbGVtZW50Lk1ldGhvZHMpO1xuICAgICAgbWVyZ2VNZXRob2RzKEVMRU1FTlRfUFJPVE9UWVBFLCBFbGVtZW50Lk1ldGhvZHMuU2ltdWxhdGVkLCB0cnVlKTtcbiAgICB9XG5cbiAgICBpZiAoRi5TcGVjaWZpY0VsZW1lbnRFeHRlbnNpb25zKSB7XG4gICAgICBmb3IgKHZhciB0YWcgaW4gRWxlbWVudC5NZXRob2RzLkJ5VGFnKSB7XG4gICAgICAgIHZhciBrbGFzcyA9IGZpbmRET01DbGFzcyh0YWcpO1xuICAgICAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKGtsYXNzKSkgY29udGludWU7XG4gICAgICAgIG1lcmdlTWV0aG9kcyhrbGFzcy5wcm90b3R5cGUsIEJ5VGFnW3RhZ10pO1xuICAgICAgfVxuICAgIH1cblxuICAgIE9iamVjdC5leHRlbmQoRWxlbWVudCwgRWxlbWVudC5NZXRob2RzKTtcbiAgICBPYmplY3QuZXh0ZW5kKEVsZW1lbnQsIEVsZW1lbnQuTWV0aG9kcy5TaW11bGF0ZWQpO1xuICAgIGRlbGV0ZSBFbGVtZW50LkJ5VGFnO1xuICAgIGRlbGV0ZSBFbGVtZW50LlNpbXVsYXRlZDtcblxuICAgIEVsZW1lbnQuZXh0ZW5kLnJlZnJlc2goKTtcblxuICAgIEVMRU1FTlRfQ0FDSEUgPSB7fTtcbiAgfVxuXG4gIE9iamVjdC5leHRlbmQoR0xPQkFMLkVsZW1lbnQsIHtcbiAgICBleHRlbmQ6ICAgICBleHRlbmQsXG4gICAgYWRkTWV0aG9kczogYWRkTWV0aG9kc1xuICB9KTtcblxuICBpZiAoZXh0ZW5kID09PSBQcm90b3R5cGUuSykge1xuICAgIEdMT0JBTC5FbGVtZW50LmV4dGVuZC5yZWZyZXNoID0gUHJvdG90eXBlLmVtcHR5RnVuY3Rpb247XG4gIH0gZWxzZSB7XG4gICAgR0xPQkFMLkVsZW1lbnQuZXh0ZW5kLnJlZnJlc2ggPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzLkVsZW1lbnRFeHRlbnNpb25zKSByZXR1cm47XG4gICAgICBPYmplY3QuZXh0ZW5kKE1ldGhvZHMsIEVsZW1lbnQuTWV0aG9kcyk7XG4gICAgICBPYmplY3QuZXh0ZW5kKE1ldGhvZHMsIEVsZW1lbnQuTWV0aG9kcy5TaW11bGF0ZWQpO1xuXG4gICAgICBFWFRFTkRFRCA9IHt9O1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBhZGRGb3JtTWV0aG9kcygpIHtcbiAgICBPYmplY3QuZXh0ZW5kKEZvcm0sIEZvcm0uTWV0aG9kcyk7XG4gICAgT2JqZWN0LmV4dGVuZChGb3JtLkVsZW1lbnQsIEZvcm0uRWxlbWVudC5NZXRob2RzKTtcbiAgICBPYmplY3QuZXh0ZW5kKEVsZW1lbnQuTWV0aG9kcy5CeVRhZywge1xuICAgICAgXCJGT1JNXCI6ICAgICBPYmplY3QuY2xvbmUoRm9ybS5NZXRob2RzKSxcbiAgICAgIFwiSU5QVVRcIjogICAgT2JqZWN0LmNsb25lKEZvcm0uRWxlbWVudC5NZXRob2RzKSxcbiAgICAgIFwiU0VMRUNUXCI6ICAgT2JqZWN0LmNsb25lKEZvcm0uRWxlbWVudC5NZXRob2RzKSxcbiAgICAgIFwiVEVYVEFSRUFcIjogT2JqZWN0LmNsb25lKEZvcm0uRWxlbWVudC5NZXRob2RzKSxcbiAgICAgIFwiQlVUVE9OXCI6ICAgT2JqZWN0LmNsb25lKEZvcm0uRWxlbWVudC5NZXRob2RzKVxuICAgIH0pO1xuICB9XG5cbiAgRWxlbWVudC5hZGRNZXRob2RzKG1ldGhvZHMpO1xuXG4gIGZ1bmN0aW9uIGRlc3Ryb3lDYWNoZV9JRSgpIHtcbiAgICBESVYgPSBudWxsO1xuICAgIEVMRU1FTlRfQ0FDSEUgPSBudWxsO1xuICB9XG5cbiAgaWYgKHdpbmRvdy5hdHRhY2hFdmVudClcbiAgICB3aW5kb3cuYXR0YWNoRXZlbnQoJ29udW5sb2FkJywgZGVzdHJveUNhY2hlX0lFKTtcblxufSkodGhpcyk7XG4oZnVuY3Rpb24oKSB7XG5cbiAgZnVuY3Rpb24gdG9EZWNpbWFsKHBjdFN0cmluZykge1xuICAgIHZhciBtYXRjaCA9IHBjdFN0cmluZy5tYXRjaCgvXihcXGQrKSU/JC9pKTtcbiAgICBpZiAoIW1hdGNoKSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gKE51bWJlcihtYXRjaFsxXSkgLyAxMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0UmF3U3R5bGUoZWxlbWVudCwgc3R5bGUpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuc3R5bGVbc3R5bGVdO1xuICAgIGlmICghdmFsdWUgfHwgdmFsdWUgPT09ICdhdXRvJykge1xuICAgICAgdmFyIGNzcyA9IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCk7XG4gICAgICB2YWx1ZSA9IGNzcyA/IGNzc1tzdHlsZV0gOiBudWxsO1xuICAgIH1cblxuICAgIGlmIChzdHlsZSA9PT0gJ29wYWNpdHknKSByZXR1cm4gdmFsdWUgPyBwYXJzZUZsb2F0KHZhbHVlKSA6IDEuMDtcbiAgICByZXR1cm4gdmFsdWUgPT09ICdhdXRvJyA/IG51bGwgOiB2YWx1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFJhd1N0eWxlX0lFKGVsZW1lbnQsIHN0eWxlKSB7XG4gICAgdmFyIHZhbHVlID0gZWxlbWVudC5zdHlsZVtzdHlsZV07XG4gICAgaWYgKCF2YWx1ZSAmJiBlbGVtZW50LmN1cnJlbnRTdHlsZSkge1xuICAgICAgdmFsdWUgPSBlbGVtZW50LmN1cnJlbnRTdHlsZVtzdHlsZV07XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldENvbnRlbnRXaWR0aChlbGVtZW50LCBjb250ZXh0KSB7XG4gICAgdmFyIGJveFdpZHRoID0gZWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgIHZhciBibCA9IGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ2JvcmRlckxlZnRXaWR0aCcsICBjb250ZXh0KSB8fCAwO1xuICAgIHZhciBiciA9IGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ2JvcmRlclJpZ2h0V2lkdGgnLCBjb250ZXh0KSB8fCAwO1xuICAgIHZhciBwbCA9IGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ3BhZGRpbmdMZWZ0JywgICAgICBjb250ZXh0KSB8fCAwO1xuICAgIHZhciBwciA9IGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ3BhZGRpbmdSaWdodCcsICAgICBjb250ZXh0KSB8fCAwO1xuXG4gICAgcmV0dXJuIGJveFdpZHRoIC0gYmwgLSBiciAtIHBsIC0gcHI7XG4gIH1cblxuICBpZiAoJ2N1cnJlbnRTdHlsZScgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgZ2V0UmF3U3R5bGUgPSBnZXRSYXdTdHlsZV9JRTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gZ2V0UGl4ZWxWYWx1ZSh2YWx1ZSwgcHJvcGVydHksIGNvbnRleHQpIHtcbiAgICB2YXIgZWxlbWVudCA9IG51bGw7XG4gICAgaWYgKE9iamVjdC5pc0VsZW1lbnQodmFsdWUpKSB7XG4gICAgICBlbGVtZW50ID0gdmFsdWU7XG4gICAgICB2YWx1ZSA9IGdldFJhd1N0eWxlKGVsZW1lbnQsIHByb3BlcnR5KTtcbiAgICB9XG5cbiAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKCgvXig/Oi0pP1xcZCsoXFwuXFxkKyk/KHB4KT8kL2kpLnRlc3QodmFsdWUpKSB7XG4gICAgICByZXR1cm4gd2luZG93LnBhcnNlRmxvYXQodmFsdWUpO1xuICAgIH1cblxuICAgIHZhciBpc1BlcmNlbnRhZ2UgPSB2YWx1ZS5pbmNsdWRlKCclJyksIGlzVmlld3BvcnQgPSAoY29udGV4dCA9PT0gZG9jdW1lbnQudmlld3BvcnQpO1xuXG4gICAgaWYgKC9cXGQvLnRlc3QodmFsdWUpICYmIGVsZW1lbnQgJiYgZWxlbWVudC5ydW50aW1lU3R5bGUgJiYgIShpc1BlcmNlbnRhZ2UgJiYgaXNWaWV3cG9ydCkpIHtcbiAgICAgIHZhciBzdHlsZSA9IGVsZW1lbnQuc3R5bGUubGVmdCwgclN0eWxlID0gZWxlbWVudC5ydW50aW1lU3R5bGUubGVmdDtcbiAgICAgIGVsZW1lbnQucnVudGltZVN0eWxlLmxlZnQgPSBlbGVtZW50LmN1cnJlbnRTdHlsZS5sZWZ0O1xuICAgICAgZWxlbWVudC5zdHlsZS5sZWZ0ID0gdmFsdWUgfHwgMDtcbiAgICAgIHZhbHVlID0gZWxlbWVudC5zdHlsZS5waXhlbExlZnQ7XG4gICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSBzdHlsZTtcbiAgICAgIGVsZW1lbnQucnVudGltZVN0eWxlLmxlZnQgPSByU3R5bGU7XG5cbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICBpZiAoZWxlbWVudCAmJiBpc1BlcmNlbnRhZ2UpIHtcbiAgICAgIGNvbnRleHQgPSBjb250ZXh0IHx8IGVsZW1lbnQucGFyZW50Tm9kZTtcbiAgICAgIHZhciBkZWNpbWFsID0gdG9EZWNpbWFsKHZhbHVlKSwgd2hvbGUgPSBudWxsO1xuXG4gICAgICB2YXIgaXNIb3Jpem9udGFsID0gcHJvcGVydHkuaW5jbHVkZSgnbGVmdCcpIHx8IHByb3BlcnR5LmluY2x1ZGUoJ3JpZ2h0JykgfHxcbiAgICAgICBwcm9wZXJ0eS5pbmNsdWRlKCd3aWR0aCcpO1xuXG4gICAgICB2YXIgaXNWZXJ0aWNhbCAgID0gcHJvcGVydHkuaW5jbHVkZSgndG9wJykgfHwgcHJvcGVydHkuaW5jbHVkZSgnYm90dG9tJykgfHxcbiAgICAgICAgcHJvcGVydHkuaW5jbHVkZSgnaGVpZ2h0Jyk7XG5cbiAgICAgIGlmIChjb250ZXh0ID09PSBkb2N1bWVudC52aWV3cG9ydCkge1xuICAgICAgICBpZiAoaXNIb3Jpem9udGFsKSB7XG4gICAgICAgICAgd2hvbGUgPSBkb2N1bWVudC52aWV3cG9ydC5nZXRXaWR0aCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICB3aG9sZSA9IGRvY3VtZW50LnZpZXdwb3J0LmdldEhlaWdodCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNIb3Jpem9udGFsKSB7XG4gICAgICAgICAgd2hvbGUgPSAkKGNvbnRleHQpLm1lYXN1cmUoJ3dpZHRoJyk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNWZXJ0aWNhbCkge1xuICAgICAgICAgIHdob2xlID0gJChjb250ZXh0KS5tZWFzdXJlKCdoZWlnaHQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gKHdob2xlID09PSBudWxsKSA/IDAgOiB3aG9sZSAqIGRlY2ltYWw7XG4gICAgfVxuXG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBmdW5jdGlvbiB0b0NTU1BpeGVscyhudW1iZXIpIHtcbiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKG51bWJlcikgJiYgbnVtYmVyLmVuZHNXaXRoKCdweCcpKVxuICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICByZXR1cm4gbnVtYmVyICsgJ3B4JztcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzRGlzcGxheWVkKGVsZW1lbnQpIHtcbiAgICB3aGlsZSAoZWxlbWVudCAmJiBlbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgIHZhciBkaXNwbGF5ID0gZWxlbWVudC5nZXRTdHlsZSgnZGlzcGxheScpO1xuICAgICAgaWYgKGRpc3BsYXkgPT09ICdub25lJykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBlbGVtZW50ID0gJChlbGVtZW50LnBhcmVudE5vZGUpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHZhciBoYXNMYXlvdXQgPSBQcm90b3R5cGUuSztcbiAgaWYgKCdjdXJyZW50U3R5bGUnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkge1xuICAgIGhhc0xheW91dCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgIGlmICghZWxlbWVudC5jdXJyZW50U3R5bGUuaGFzTGF5b3V0KSB7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUuem9vbSA9IDE7XG4gICAgICB9XG4gICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gY3NzTmFtZUZvcihrZXkpIHtcbiAgICBpZiAoa2V5LmluY2x1ZGUoJ2JvcmRlcicpKSBrZXkgPSBrZXkgKyAnLXdpZHRoJztcbiAgICByZXR1cm4ga2V5LmNhbWVsaXplKCk7XG4gIH1cblxuICBFbGVtZW50LkxheW91dCA9IENsYXNzLmNyZWF0ZShIYXNoLCB7XG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oJHN1cGVyLCBlbGVtZW50LCBwcmVDb21wdXRlKSB7XG4gICAgICAkc3VwZXIoKTtcbiAgICAgIHRoaXMuZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICAgIEVsZW1lbnQuTGF5b3V0LlBST1BFUlRJRVMuZWFjaCggZnVuY3Rpb24ocHJvcGVydHkpIHtcbiAgICAgICAgdGhpcy5fc2V0KHByb3BlcnR5LCBudWxsKTtcbiAgICAgIH0sIHRoaXMpO1xuXG4gICAgICBpZiAocHJlQ29tcHV0ZSkge1xuICAgICAgICB0aGlzLl9wcmVDb21wdXRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLl9iZWdpbigpO1xuICAgICAgICBFbGVtZW50LkxheW91dC5QUk9QRVJUSUVTLmVhY2goIHRoaXMuX2NvbXB1dGUsIHRoaXMgKTtcbiAgICAgICAgdGhpcy5fZW5kKCk7XG4gICAgICAgIHRoaXMuX3ByZUNvbXB1dGluZyA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfc2V0OiBmdW5jdGlvbihwcm9wZXJ0eSwgdmFsdWUpIHtcbiAgICAgIHJldHVybiBIYXNoLnByb3RvdHlwZS5zZXQuY2FsbCh0aGlzLCBwcm9wZXJ0eSwgdmFsdWUpO1xuICAgIH0sXG5cbiAgICBzZXQ6IGZ1bmN0aW9uKHByb3BlcnR5LCB2YWx1ZSkge1xuICAgICAgdGhyb3cgXCJQcm9wZXJ0aWVzIG9mIEVsZW1lbnQuTGF5b3V0IGFyZSByZWFkLW9ubHkuXCI7XG4gICAgfSxcblxuICAgIGdldDogZnVuY3Rpb24oJHN1cGVyLCBwcm9wZXJ0eSkge1xuICAgICAgdmFyIHZhbHVlID0gJHN1cGVyKHByb3BlcnR5KTtcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbCA/IHRoaXMuX2NvbXB1dGUocHJvcGVydHkpIDogdmFsdWU7XG4gICAgfSxcblxuICAgIF9iZWdpbjogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5faXNQcmVwYXJlZCgpKSByZXR1cm47XG5cbiAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgaWYgKGlzRGlzcGxheWVkKGVsZW1lbnQpKSB7XG4gICAgICAgIHRoaXMuX3NldFByZXBhcmVkKHRydWUpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cblxuICAgICAgdmFyIG9yaWdpbmFsU3R5bGVzID0ge1xuICAgICAgICBwb3NpdGlvbjogICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uICAgfHwgJycsXG4gICAgICAgIHdpZHRoOiAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggICAgICB8fCAnJyxcbiAgICAgICAgdmlzaWJpbGl0eTogZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5IHx8ICcnLFxuICAgICAgICBkaXNwbGF5OiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgICAgfHwgJydcbiAgICAgIH07XG5cbiAgICAgIGVsZW1lbnQuc3RvcmUoJ3Byb3RvdHlwZV9vcmlnaW5hbF9zdHlsZXMnLCBvcmlnaW5hbFN0eWxlcyk7XG5cbiAgICAgIHZhciBwb3NpdGlvbiA9IGdldFJhd1N0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpLCB3aWR0aCA9IGVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cbiAgICAgIGlmICh3aWR0aCA9PT0gMCB8fCB3aWR0aCA9PT0gbnVsbCkge1xuICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICB3aWR0aCA9IGVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICB9XG5cbiAgICAgIHZhciBjb250ZXh0ID0gKHBvc2l0aW9uID09PSAnZml4ZWQnKSA/IGRvY3VtZW50LnZpZXdwb3J0IDpcbiAgICAgICBlbGVtZW50LnBhcmVudE5vZGU7XG5cbiAgICAgIHZhciB0ZW1wU3R5bGVzID0ge1xuICAgICAgICB2aXNpYmlsaXR5OiAnaGlkZGVuJyxcbiAgICAgICAgZGlzcGxheTogICAgJ2Jsb2NrJ1xuICAgICAgfTtcblxuICAgICAgaWYgKHBvc2l0aW9uICE9PSAnZml4ZWQnKSB0ZW1wU3R5bGVzLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcblxuICAgICAgZWxlbWVudC5zZXRTdHlsZSh0ZW1wU3R5bGVzKTtcblxuICAgICAgdmFyIHBvc2l0aW9uZWRXaWR0aCA9IGVsZW1lbnQub2Zmc2V0V2lkdGgsIG5ld1dpZHRoO1xuICAgICAgaWYgKHdpZHRoICYmIChwb3NpdGlvbmVkV2lkdGggPT09IHdpZHRoKSkge1xuICAgICAgICBuZXdXaWR0aCA9IGdldENvbnRlbnRXaWR0aChlbGVtZW50LCBjb250ZXh0KTtcbiAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT09ICdhYnNvbHV0ZScgfHwgcG9zaXRpb24gPT09ICdmaXhlZCcpIHtcbiAgICAgICAgbmV3V2lkdGggPSBnZXRDb250ZW50V2lkdGgoZWxlbWVudCwgY29udGV4dCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnROb2RlLCBwTGF5b3V0ID0gJChwYXJlbnQpLmdldExheW91dCgpO1xuXG4gICAgICAgIG5ld1dpZHRoID0gcExheW91dC5nZXQoJ3dpZHRoJykgLVxuICAgICAgICAgdGhpcy5nZXQoJ21hcmdpbi1sZWZ0JykgLVxuICAgICAgICAgdGhpcy5nZXQoJ2JvcmRlci1sZWZ0JykgLVxuICAgICAgICAgdGhpcy5nZXQoJ3BhZGRpbmctbGVmdCcpIC1cbiAgICAgICAgIHRoaXMuZ2V0KCdwYWRkaW5nLXJpZ2h0JykgLVxuICAgICAgICAgdGhpcy5nZXQoJ2JvcmRlci1yaWdodCcpIC1cbiAgICAgICAgIHRoaXMuZ2V0KCdtYXJnaW4tcmlnaHQnKTtcbiAgICAgIH1cblxuICAgICAgZWxlbWVudC5zZXRTdHlsZSh7IHdpZHRoOiBuZXdXaWR0aCArICdweCcgfSk7XG5cbiAgICAgIHRoaXMuX3NldFByZXBhcmVkKHRydWUpO1xuICAgIH0sXG5cbiAgICBfZW5kOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgdmFyIG9yaWdpbmFsU3R5bGVzID0gZWxlbWVudC5yZXRyaWV2ZSgncHJvdG90eXBlX29yaWdpbmFsX3N0eWxlcycpO1xuICAgICAgZWxlbWVudC5zdG9yZSgncHJvdG90eXBlX29yaWdpbmFsX3N0eWxlcycsIG51bGwpO1xuICAgICAgZWxlbWVudC5zZXRTdHlsZShvcmlnaW5hbFN0eWxlcyk7XG4gICAgICB0aGlzLl9zZXRQcmVwYXJlZChmYWxzZSk7XG4gICAgfSxcblxuICAgIF9jb21wdXRlOiBmdW5jdGlvbihwcm9wZXJ0eSkge1xuICAgICAgdmFyIENPTVBVVEFUSU9OUyA9IEVsZW1lbnQuTGF5b3V0LkNPTVBVVEFUSU9OUztcbiAgICAgIGlmICghKHByb3BlcnR5IGluIENPTVBVVEFUSU9OUykpIHtcbiAgICAgICAgdGhyb3cgXCJQcm9wZXJ0eSBub3QgZm91bmQuXCI7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLl9zZXQocHJvcGVydHksIENPTVBVVEFUSU9OU1twcm9wZXJ0eV0uY2FsbCh0aGlzLCB0aGlzLmVsZW1lbnQpKTtcbiAgICB9LFxuXG4gICAgX2lzUHJlcGFyZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5yZXRyaWV2ZSgncHJvdG90eXBlX2VsZW1lbnRfbGF5b3V0X3ByZXBhcmVkJywgZmFsc2UpO1xuICAgIH0sXG5cbiAgICBfc2V0UHJlcGFyZWQ6IGZ1bmN0aW9uKGJvb2wpIHtcbiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQuc3RvcmUoJ3Byb3RvdHlwZV9lbGVtZW50X2xheW91dF9wcmVwYXJlZCcsIGJvb2wpO1xuICAgIH0sXG5cbiAgICB0b09iamVjdDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYXJncyA9ICRBKGFyZ3VtZW50cyk7XG4gICAgICB2YXIga2V5cyA9IChhcmdzLmxlbmd0aCA9PT0gMCkgPyBFbGVtZW50LkxheW91dC5QUk9QRVJUSUVTIDpcbiAgICAgICBhcmdzLmpvaW4oJyAnKS5zcGxpdCgnICcpO1xuICAgICAgdmFyIG9iaiA9IHt9O1xuICAgICAga2V5cy5lYWNoKCBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgaWYgKCFFbGVtZW50LkxheW91dC5QUk9QRVJUSUVTLmluY2x1ZGUoa2V5KSkgcmV0dXJuO1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmdldChrZXkpO1xuICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgb2JqW2tleV0gPSB2YWx1ZTtcbiAgICAgIH0sIHRoaXMpO1xuICAgICAgcmV0dXJuIG9iajtcbiAgICB9LFxuXG4gICAgdG9IYXNoOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvYmogPSB0aGlzLnRvT2JqZWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gbmV3IEhhc2gob2JqKTtcbiAgICB9LFxuXG4gICAgdG9DU1M6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFyZ3MgPSAkQShhcmd1bWVudHMpO1xuICAgICAgdmFyIGtleXMgPSAoYXJncy5sZW5ndGggPT09IDApID8gRWxlbWVudC5MYXlvdXQuUFJPUEVSVElFUyA6XG4gICAgICAgYXJncy5qb2luKCcgJykuc3BsaXQoJyAnKTtcbiAgICAgIHZhciBjc3MgPSB7fTtcblxuICAgICAga2V5cy5lYWNoKCBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgaWYgKCFFbGVtZW50LkxheW91dC5QUk9QRVJUSUVTLmluY2x1ZGUoa2V5KSkgcmV0dXJuO1xuICAgICAgICBpZiAoRWxlbWVudC5MYXlvdXQuQ09NUE9TSVRFX1BST1BFUlRJRVMuaW5jbHVkZShrZXkpKSByZXR1cm47XG5cbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5nZXQoa2V5KTtcbiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIGNzc1tjc3NOYW1lRm9yKGtleSldID0gdmFsdWUgKyAncHgnO1xuICAgICAgfSwgdGhpcyk7XG4gICAgICByZXR1cm4gY3NzO1xuICAgIH0sXG5cbiAgICBpbnNwZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBcIiM8RWxlbWVudC5MYXlvdXQ+XCI7XG4gICAgfVxuICB9KTtcblxuICBPYmplY3QuZXh0ZW5kKEVsZW1lbnQuTGF5b3V0LCB7XG4gICAgUFJPUEVSVElFUzogJHcoJ2hlaWdodCB3aWR0aCB0b3AgbGVmdCByaWdodCBib3R0b20gYm9yZGVyLWxlZnQgYm9yZGVyLXJpZ2h0IGJvcmRlci10b3AgYm9yZGVyLWJvdHRvbSBwYWRkaW5nLWxlZnQgcGFkZGluZy1yaWdodCBwYWRkaW5nLXRvcCBwYWRkaW5nLWJvdHRvbSBtYXJnaW4tdG9wIG1hcmdpbi1ib3R0b20gbWFyZ2luLWxlZnQgbWFyZ2luLXJpZ2h0IHBhZGRpbmctYm94LXdpZHRoIHBhZGRpbmctYm94LWhlaWdodCBib3JkZXItYm94LXdpZHRoIGJvcmRlci1ib3gtaGVpZ2h0IG1hcmdpbi1ib3gtd2lkdGggbWFyZ2luLWJveC1oZWlnaHQnKSxcblxuICAgIENPTVBPU0lURV9QUk9QRVJUSUVTOiAkdygncGFkZGluZy1ib3gtd2lkdGggcGFkZGluZy1ib3gtaGVpZ2h0IG1hcmdpbi1ib3gtd2lkdGggbWFyZ2luLWJveC1oZWlnaHQgYm9yZGVyLWJveC13aWR0aCBib3JkZXItYm94LWhlaWdodCcpLFxuXG4gICAgQ09NUFVUQVRJT05TOiB7XG4gICAgICAnaGVpZ2h0JzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fYmVnaW4oKTtcblxuICAgICAgICB2YXIgYkhlaWdodCA9IHRoaXMuZ2V0KCdib3JkZXItYm94LWhlaWdodCcpO1xuICAgICAgICBpZiAoYkhlaWdodCA8PSAwKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLl9wcmVDb21wdXRpbmcpIHRoaXMuX2VuZCgpO1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGJUb3AgPSB0aGlzLmdldCgnYm9yZGVyLXRvcCcpLFxuICAgICAgICAgYkJvdHRvbSA9IHRoaXMuZ2V0KCdib3JkZXItYm90dG9tJyk7XG5cbiAgICAgICAgdmFyIHBUb3AgPSB0aGlzLmdldCgncGFkZGluZy10b3AnKSxcbiAgICAgICAgIHBCb3R0b20gPSB0aGlzLmdldCgncGFkZGluZy1ib3R0b20nKTtcblxuICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fZW5kKCk7XG5cbiAgICAgICAgcmV0dXJuIGJIZWlnaHQgLSBiVG9wIC0gYkJvdHRvbSAtIHBUb3AgLSBwQm90dG9tO1xuICAgICAgfSxcblxuICAgICAgJ3dpZHRoJzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fYmVnaW4oKTtcblxuICAgICAgICB2YXIgYldpZHRoID0gdGhpcy5nZXQoJ2JvcmRlci1ib3gtd2lkdGgnKTtcbiAgICAgICAgaWYgKGJXaWR0aCA8PSAwKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLl9wcmVDb21wdXRpbmcpIHRoaXMuX2VuZCgpO1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGJMZWZ0ID0gdGhpcy5nZXQoJ2JvcmRlci1sZWZ0JyksXG4gICAgICAgICBiUmlnaHQgPSB0aGlzLmdldCgnYm9yZGVyLXJpZ2h0Jyk7XG5cbiAgICAgICAgdmFyIHBMZWZ0ID0gdGhpcy5nZXQoJ3BhZGRpbmctbGVmdCcpLFxuICAgICAgICAgcFJpZ2h0ID0gdGhpcy5nZXQoJ3BhZGRpbmctcmlnaHQnKTtcblxuICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fZW5kKCk7XG4gICAgICAgIHJldHVybiBiV2lkdGggLSBiTGVmdCAtIGJSaWdodCAtIHBMZWZ0IC0gcFJpZ2h0O1xuICAgICAgfSxcblxuICAgICAgJ3BhZGRpbmctYm94LWhlaWdodCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuZ2V0KCdoZWlnaHQnKSxcbiAgICAgICAgIHBUb3AgPSB0aGlzLmdldCgncGFkZGluZy10b3AnKSxcbiAgICAgICAgIHBCb3R0b20gPSB0aGlzLmdldCgncGFkZGluZy1ib3R0b20nKTtcblxuICAgICAgICByZXR1cm4gaGVpZ2h0ICsgcFRvcCArIHBCb3R0b207XG4gICAgICB9LFxuXG4gICAgICAncGFkZGluZy1ib3gtd2lkdGgnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0KCd3aWR0aCcpLFxuICAgICAgICAgcExlZnQgPSB0aGlzLmdldCgncGFkZGluZy1sZWZ0JyksXG4gICAgICAgICBwUmlnaHQgPSB0aGlzLmdldCgncGFkZGluZy1yaWdodCcpO1xuXG4gICAgICAgIHJldHVybiB3aWR0aCArIHBMZWZ0ICsgcFJpZ2h0O1xuICAgICAgfSxcblxuICAgICAgJ2JvcmRlci1ib3gtaGVpZ2h0JzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fYmVnaW4oKTtcbiAgICAgICAgdmFyIGhlaWdodCA9IGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICBpZiAoIXRoaXMuX3ByZUNvbXB1dGluZykgdGhpcy5fZW5kKCk7XG4gICAgICAgIHJldHVybiBoZWlnaHQ7XG4gICAgICB9LFxuXG4gICAgICAnYm9yZGVyLWJveC13aWR0aCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9wcmVDb21wdXRpbmcpIHRoaXMuX2JlZ2luKCk7XG4gICAgICAgIHZhciB3aWR0aCA9IGVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIGlmICghdGhpcy5fcHJlQ29tcHV0aW5nKSB0aGlzLl9lbmQoKTtcbiAgICAgICAgcmV0dXJuIHdpZHRoO1xuICAgICAgfSxcblxuICAgICAgJ21hcmdpbi1ib3gtaGVpZ2h0JzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgYkhlaWdodCA9IHRoaXMuZ2V0KCdib3JkZXItYm94LWhlaWdodCcpLFxuICAgICAgICAgbVRvcCA9IHRoaXMuZ2V0KCdtYXJnaW4tdG9wJyksXG4gICAgICAgICBtQm90dG9tID0gdGhpcy5nZXQoJ21hcmdpbi1ib3R0b20nKTtcblxuICAgICAgICBpZiAoYkhlaWdodCA8PSAwKSByZXR1cm4gMDtcblxuICAgICAgICByZXR1cm4gYkhlaWdodCArIG1Ub3AgKyBtQm90dG9tO1xuICAgICAgfSxcblxuICAgICAgJ21hcmdpbi1ib3gtd2lkdGgnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBiV2lkdGggPSB0aGlzLmdldCgnYm9yZGVyLWJveC13aWR0aCcpLFxuICAgICAgICAgbUxlZnQgPSB0aGlzLmdldCgnbWFyZ2luLWxlZnQnKSxcbiAgICAgICAgIG1SaWdodCA9IHRoaXMuZ2V0KCdtYXJnaW4tcmlnaHQnKTtcblxuICAgICAgICBpZiAoYldpZHRoIDw9IDApIHJldHVybiAwO1xuXG4gICAgICAgIHJldHVybiBiV2lkdGggKyBtTGVmdCArIG1SaWdodDtcbiAgICAgIH0sXG5cbiAgICAgICd0b3AnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSBlbGVtZW50LnBvc2l0aW9uZWRPZmZzZXQoKTtcbiAgICAgICAgcmV0dXJuIG9mZnNldC50b3A7XG4gICAgICB9LFxuXG4gICAgICAnYm90dG9tJzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgb2Zmc2V0ID0gZWxlbWVudC5wb3NpdGlvbmVkT2Zmc2V0KCksXG4gICAgICAgICBwYXJlbnQgPSBlbGVtZW50LmdldE9mZnNldFBhcmVudCgpLFxuICAgICAgICAgcEhlaWdodCA9IHBhcmVudC5tZWFzdXJlKCdoZWlnaHQnKTtcblxuICAgICAgICB2YXIgbUhlaWdodCA9IHRoaXMuZ2V0KCdib3JkZXItYm94LWhlaWdodCcpO1xuXG4gICAgICAgIHJldHVybiBwSGVpZ2h0IC0gbUhlaWdodCAtIG9mZnNldC50b3A7XG4gICAgICB9LFxuXG4gICAgICAnbGVmdCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IGVsZW1lbnQucG9zaXRpb25lZE9mZnNldCgpO1xuICAgICAgICByZXR1cm4gb2Zmc2V0LmxlZnQ7XG4gICAgICB9LFxuXG4gICAgICAncmlnaHQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSBlbGVtZW50LnBvc2l0aW9uZWRPZmZzZXQoKSxcbiAgICAgICAgIHBhcmVudCA9IGVsZW1lbnQuZ2V0T2Zmc2V0UGFyZW50KCksXG4gICAgICAgICBwV2lkdGggPSBwYXJlbnQubWVhc3VyZSgnd2lkdGgnKTtcblxuICAgICAgICB2YXIgbVdpZHRoID0gdGhpcy5nZXQoJ2JvcmRlci1ib3gtd2lkdGgnKTtcblxuICAgICAgICByZXR1cm4gcFdpZHRoIC0gbVdpZHRoIC0gb2Zmc2V0LmxlZnQ7XG4gICAgICB9LFxuXG4gICAgICAncGFkZGluZy10b3AnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQaXhlbFZhbHVlKGVsZW1lbnQsICdwYWRkaW5nVG9wJyk7XG4gICAgICB9LFxuXG4gICAgICAncGFkZGluZy1ib3R0b20nOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQaXhlbFZhbHVlKGVsZW1lbnQsICdwYWRkaW5nQm90dG9tJyk7XG4gICAgICB9LFxuXG4gICAgICAncGFkZGluZy1sZWZ0JzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAncGFkZGluZ0xlZnQnKTtcbiAgICAgIH0sXG5cbiAgICAgICdwYWRkaW5nLXJpZ2h0JzogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGl4ZWxWYWx1ZShlbGVtZW50LCAncGFkZGluZ1JpZ2h0Jyk7XG4gICAgICB9LFxuXG4gICAgICAnYm9yZGVyLXRvcCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ2JvcmRlclRvcFdpZHRoJyk7XG4gICAgICB9LFxuXG4gICAgICAnYm9yZGVyLWJvdHRvbSc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ2JvcmRlckJvdHRvbVdpZHRoJyk7XG4gICAgICB9LFxuXG4gICAgICAnYm9yZGVyLWxlZnQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQaXhlbFZhbHVlKGVsZW1lbnQsICdib3JkZXJMZWZ0V2lkdGgnKTtcbiAgICAgIH0sXG5cbiAgICAgICdib3JkZXItcmlnaHQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQaXhlbFZhbHVlKGVsZW1lbnQsICdib3JkZXJSaWdodFdpZHRoJyk7XG4gICAgICB9LFxuXG4gICAgICAnbWFyZ2luLXRvcCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ21hcmdpblRvcCcpO1xuICAgICAgfSxcblxuICAgICAgJ21hcmdpbi1ib3R0b20nOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQaXhlbFZhbHVlKGVsZW1lbnQsICdtYXJnaW5Cb3R0b20nKTtcbiAgICAgIH0sXG5cbiAgICAgICdtYXJnaW4tbGVmdCc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsVmFsdWUoZWxlbWVudCwgJ21hcmdpbkxlZnQnKTtcbiAgICAgIH0sXG5cbiAgICAgICdtYXJnaW4tcmlnaHQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQaXhlbFZhbHVlKGVsZW1lbnQsICdtYXJnaW5SaWdodCcpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgaWYgKCdnZXRCb3VuZGluZ0NsaWVudFJlY3QnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkge1xuICAgIE9iamVjdC5leHRlbmQoRWxlbWVudC5MYXlvdXQuQ09NUFVUQVRJT05TLCB7XG4gICAgICAncmlnaHQnOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSBoYXNMYXlvdXQoZWxlbWVudC5nZXRPZmZzZXRQYXJlbnQoKSk7XG4gICAgICAgIHZhciByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgIHBSZWN0ID0gcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgIHJldHVybiAocFJlY3QucmlnaHQgLSByZWN0LnJpZ2h0KS5yb3VuZCgpO1xuICAgICAgfSxcblxuICAgICAgJ2JvdHRvbSc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHBhcmVudCA9IGhhc0xheW91dChlbGVtZW50LmdldE9mZnNldFBhcmVudCgpKTtcbiAgICAgICAgdmFyIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgcFJlY3QgPSBwYXJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgcmV0dXJuIChwUmVjdC5ib3R0b20gLSByZWN0LmJvdHRvbSkucm91bmQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIEVsZW1lbnQuT2Zmc2V0ID0gQ2xhc3MuY3JlYXRlKHtcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihsZWZ0LCB0b3ApIHtcbiAgICAgIHRoaXMubGVmdCA9IGxlZnQucm91bmQoKTtcbiAgICAgIHRoaXMudG9wICA9IHRvcC5yb3VuZCgpO1xuXG4gICAgICB0aGlzWzBdID0gdGhpcy5sZWZ0O1xuICAgICAgdGhpc1sxXSA9IHRoaXMudG9wO1xuICAgIH0sXG5cbiAgICByZWxhdGl2ZVRvOiBmdW5jdGlvbihvZmZzZXQpIHtcbiAgICAgIHJldHVybiBuZXcgRWxlbWVudC5PZmZzZXQoXG4gICAgICAgIHRoaXMubGVmdCAtIG9mZnNldC5sZWZ0LFxuICAgICAgICB0aGlzLnRvcCAgLSBvZmZzZXQudG9wXG4gICAgICApO1xuICAgIH0sXG5cbiAgICBpbnNwZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBcIiM8RWxlbWVudC5PZmZzZXQgbGVmdDogI3tsZWZ0fSB0b3A6ICN7dG9wfT5cIi5pbnRlcnBvbGF0ZSh0aGlzKTtcbiAgICB9LFxuXG4gICAgdG9TdHJpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIFwiWyN7bGVmdH0sICN7dG9wfV1cIi5pbnRlcnBvbGF0ZSh0aGlzKTtcbiAgICB9LFxuXG4gICAgdG9BcnJheTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gW3RoaXMubGVmdCwgdGhpcy50b3BdO1xuICAgIH1cbiAgfSk7XG5cbiAgZnVuY3Rpb24gZ2V0TGF5b3V0KGVsZW1lbnQsIHByZUNvbXB1dGUpIHtcbiAgICByZXR1cm4gbmV3IEVsZW1lbnQuTGF5b3V0KGVsZW1lbnQsIHByZUNvbXB1dGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gbWVhc3VyZShlbGVtZW50LCBwcm9wZXJ0eSkge1xuICAgIHJldHVybiAkKGVsZW1lbnQpLmdldExheW91dCgpLmdldChwcm9wZXJ0eSk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRIZWlnaHQoZWxlbWVudCkge1xuICAgIHJldHVybiBFbGVtZW50LmdldERpbWVuc2lvbnMoZWxlbWVudCkuaGVpZ2h0O1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0V2lkdGgoZWxlbWVudCkge1xuICAgIHJldHVybiBFbGVtZW50LmdldERpbWVuc2lvbnMoZWxlbWVudCkud2lkdGg7XG4gIH1cblxuICBmdW5jdGlvbiBnZXREaW1lbnNpb25zKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgZGlzcGxheSA9IEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ2Rpc3BsYXknKTtcblxuICAgIGlmIChkaXNwbGF5ICYmIGRpc3BsYXkgIT09ICdub25lJykge1xuICAgICAgcmV0dXJuIHsgd2lkdGg6IGVsZW1lbnQub2Zmc2V0V2lkdGgsIGhlaWdodDogZWxlbWVudC5vZmZzZXRIZWlnaHQgfTtcbiAgICB9XG5cbiAgICB2YXIgc3R5bGUgPSBlbGVtZW50LnN0eWxlO1xuICAgIHZhciBvcmlnaW5hbFN0eWxlcyA9IHtcbiAgICAgIHZpc2liaWxpdHk6IHN0eWxlLnZpc2liaWxpdHksXG4gICAgICBwb3NpdGlvbjogICBzdHlsZS5wb3NpdGlvbixcbiAgICAgIGRpc3BsYXk6ICAgIHN0eWxlLmRpc3BsYXlcbiAgICB9O1xuXG4gICAgdmFyIG5ld1N0eWxlcyA9IHtcbiAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgICAgZGlzcGxheTogICAgJ2Jsb2NrJ1xuICAgIH07XG5cbiAgICBpZiAob3JpZ2luYWxTdHlsZXMucG9zaXRpb24gIT09ICdmaXhlZCcpXG4gICAgICBuZXdTdHlsZXMucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuXG4gICAgRWxlbWVudC5zZXRTdHlsZShlbGVtZW50LCBuZXdTdHlsZXMpO1xuXG4gICAgdmFyIGRpbWVuc2lvbnMgPSB7XG4gICAgICB3aWR0aDogIGVsZW1lbnQub2Zmc2V0V2lkdGgsXG4gICAgICBoZWlnaHQ6IGVsZW1lbnQub2Zmc2V0SGVpZ2h0XG4gICAgfTtcblxuICAgIEVsZW1lbnQuc2V0U3R5bGUoZWxlbWVudCwgb3JpZ2luYWxTdHlsZXMpO1xuXG4gICAgcmV0dXJuIGRpbWVuc2lvbnM7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRPZmZzZXRQYXJlbnQoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgaWYgKGlzRG9jdW1lbnQoZWxlbWVudCkgfHwgaXNEZXRhY2hlZChlbGVtZW50KSB8fCBpc0JvZHkoZWxlbWVudCkgfHwgaXNIdG1sKGVsZW1lbnQpKVxuICAgICAgcmV0dXJuICQoZG9jdW1lbnQuYm9keSk7XG5cbiAgICB2YXIgaXNJbmxpbmUgPSAoRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAnZGlzcGxheScpID09PSAnaW5saW5lJyk7XG4gICAgaWYgKCFpc0lubGluZSAmJiBlbGVtZW50Lm9mZnNldFBhcmVudCkgcmV0dXJuICQoZWxlbWVudC5vZmZzZXRQYXJlbnQpO1xuXG4gICAgd2hpbGUgKChlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlKSAmJiBlbGVtZW50ICE9PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICBpZiAoRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAncG9zaXRpb24nKSAhPT0gJ3N0YXRpYycpIHtcbiAgICAgICAgcmV0dXJuIGlzSHRtbChlbGVtZW50KSA/ICQoZG9jdW1lbnQuYm9keSkgOiAkKGVsZW1lbnQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAkKGRvY3VtZW50LmJvZHkpO1xuICB9XG5cblxuICBmdW5jdGlvbiBjdW11bGF0aXZlT2Zmc2V0KGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgdmFsdWVUID0gMCwgdmFsdWVMID0gMDtcbiAgICBpZiAoZWxlbWVudC5wYXJlbnROb2RlKSB7XG4gICAgICBkbyB7XG4gICAgICAgIHZhbHVlVCArPSBlbGVtZW50Lm9mZnNldFRvcCAgfHwgMDtcbiAgICAgICAgdmFsdWVMICs9IGVsZW1lbnQub2Zmc2V0TGVmdCB8fCAwO1xuICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICB9IHdoaWxlIChlbGVtZW50KTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBFbGVtZW50Lk9mZnNldCh2YWx1ZUwsIHZhbHVlVCk7XG4gIH1cblxuICBmdW5jdGlvbiBwb3NpdGlvbmVkT2Zmc2V0KGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgIHZhciBsYXlvdXQgPSBlbGVtZW50LmdldExheW91dCgpO1xuXG4gICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDA7XG4gICAgZG8ge1xuICAgICAgdmFsdWVUICs9IGVsZW1lbnQub2Zmc2V0VG9wICB8fCAwO1xuICAgICAgdmFsdWVMICs9IGVsZW1lbnQub2Zmc2V0TGVmdCB8fCAwO1xuICAgICAgZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50O1xuICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGlzQm9keShlbGVtZW50KSkgYnJlYWs7XG4gICAgICAgIHZhciBwID0gRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAncG9zaXRpb24nKTtcbiAgICAgICAgaWYgKHAgIT09ICdzdGF0aWMnKSBicmVhaztcbiAgICAgIH1cbiAgICB9IHdoaWxlIChlbGVtZW50KTtcblxuICAgIHZhbHVlTCAtPSBsYXlvdXQuZ2V0KCdtYXJnaW4tdG9wJyk7XG4gICAgdmFsdWVUIC09IGxheW91dC5nZXQoJ21hcmdpbi1sZWZ0Jyk7XG5cbiAgICByZXR1cm4gbmV3IEVsZW1lbnQuT2Zmc2V0KHZhbHVlTCwgdmFsdWVUKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGN1bXVsYXRpdmVTY3JvbGxPZmZzZXQoZWxlbWVudCkge1xuICAgIHZhciB2YWx1ZVQgPSAwLCB2YWx1ZUwgPSAwO1xuICAgIGRvIHtcbiAgICAgIGlmIChlbGVtZW50ID09PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICAgIHZhciBib2R5U2Nyb2xsTm9kZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUgfHwgZG9jdW1lbnQuYm9keTtcbiAgICAgICAgdmFsdWVUICs9ICFPYmplY3QuaXNVbmRlZmluZWQod2luZG93LnBhZ2VZT2Zmc2V0KSA/IHdpbmRvdy5wYWdlWU9mZnNldCA6IGJvZHlTY3JvbGxOb2RlLnNjcm9sbFRvcCB8fCAwO1xuICAgICAgICB2YWx1ZUwgKz0gIU9iamVjdC5pc1VuZGVmaW5lZCh3aW5kb3cucGFnZVhPZmZzZXQpID8gd2luZG93LnBhZ2VYT2Zmc2V0IDogYm9keVNjcm9sbE5vZGUuc2Nyb2xsTGVmdCB8fCAwO1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlVCArPSBlbGVtZW50LnNjcm9sbFRvcCAgfHwgMDtcbiAgICAgICAgdmFsdWVMICs9IGVsZW1lbnQuc2Nyb2xsTGVmdCB8fCAwO1xuICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgfVxuICAgIH0gd2hpbGUgKGVsZW1lbnQpO1xuICAgIHJldHVybiBuZXcgRWxlbWVudC5PZmZzZXQodmFsdWVMLCB2YWx1ZVQpO1xuICB9XG5cbiAgZnVuY3Rpb24gdmlld3BvcnRPZmZzZXQoZm9yRWxlbWVudCkge1xuICAgIHZhciB2YWx1ZVQgPSAwLCB2YWx1ZUwgPSAwLCBkb2NCb2R5ID0gZG9jdW1lbnQuYm9keTtcblxuICAgIGZvckVsZW1lbnQgPSAkKGZvckVsZW1lbnQpO1xuICAgIHZhciBlbGVtZW50ID0gZm9yRWxlbWVudDtcbiAgICBkbyB7XG4gICAgICB2YWx1ZVQgKz0gZWxlbWVudC5vZmZzZXRUb3AgIHx8IDA7XG4gICAgICB2YWx1ZUwgKz0gZWxlbWVudC5vZmZzZXRMZWZ0IHx8IDA7XG4gICAgICBpZiAoZWxlbWVudC5vZmZzZXRQYXJlbnQgPT0gZG9jQm9keSAmJlxuICAgICAgICBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpID09ICdhYnNvbHV0ZScpIGJyZWFrO1xuICAgIH0gd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50Lm9mZnNldFBhcmVudCk7XG5cbiAgICBlbGVtZW50ID0gZm9yRWxlbWVudDtcbiAgICBkbyB7XG4gICAgICBpZiAoZWxlbWVudCAhPSBkb2NCb2R5KSB7XG4gICAgICAgIHZhbHVlVCAtPSBlbGVtZW50LnNjcm9sbFRvcCAgfHwgMDtcbiAgICAgICAgdmFsdWVMIC09IGVsZW1lbnQuc2Nyb2xsTGVmdCB8fCAwO1xuICAgICAgfVxuICAgIH0gd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGUpO1xuICAgIHJldHVybiBuZXcgRWxlbWVudC5PZmZzZXQodmFsdWVMLCB2YWx1ZVQpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWJzb2x1dGl6ZShlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICBpZiAoRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAncG9zaXRpb24nKSA9PT0gJ2Fic29sdXRlJykge1xuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuXG4gICAgdmFyIG9mZnNldFBhcmVudCA9IGdldE9mZnNldFBhcmVudChlbGVtZW50KTtcbiAgICB2YXIgZU9mZnNldCA9IGVsZW1lbnQudmlld3BvcnRPZmZzZXQoKSxcbiAgICAgcE9mZnNldCA9IG9mZnNldFBhcmVudC52aWV3cG9ydE9mZnNldCgpO1xuXG4gICAgdmFyIG9mZnNldCA9IGVPZmZzZXQucmVsYXRpdmVUbyhwT2Zmc2V0KTtcbiAgICB2YXIgbGF5b3V0ID0gZWxlbWVudC5nZXRMYXlvdXQoKTtcblxuICAgIGVsZW1lbnQuc3RvcmUoJ3Byb3RvdHlwZV9hYnNvbHV0aXplX29yaWdpbmFsX3N0eWxlcycsIHtcbiAgICAgIHBvc2l0aW9uOiBlbGVtZW50LmdldFN0eWxlKCdwb3NpdGlvbicpLFxuICAgICAgbGVmdDogICAgIGVsZW1lbnQuZ2V0U3R5bGUoJ2xlZnQnKSxcbiAgICAgIHRvcDogICAgICBlbGVtZW50LmdldFN0eWxlKCd0b3AnKSxcbiAgICAgIHdpZHRoOiAgICBlbGVtZW50LmdldFN0eWxlKCd3aWR0aCcpLFxuICAgICAgaGVpZ2h0OiAgIGVsZW1lbnQuZ2V0U3R5bGUoJ2hlaWdodCcpXG4gICAgfSk7XG5cbiAgICBlbGVtZW50LnNldFN0eWxlKHtcbiAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgdG9wOiAgICBvZmZzZXQudG9wICsgJ3B4JyxcbiAgICAgIGxlZnQ6ICAgb2Zmc2V0LmxlZnQgKyAncHgnLFxuICAgICAgd2lkdGg6ICBsYXlvdXQuZ2V0KCd3aWR0aCcpICsgJ3B4JyxcbiAgICAgIGhlaWdodDogbGF5b3V0LmdldCgnaGVpZ2h0JykgKyAncHgnXG4gICAgfSk7XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbGF0aXZpemUoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIGlmIChFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpID09PSAncmVsYXRpdmUnKSB7XG4gICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG5cbiAgICB2YXIgb3JpZ2luYWxTdHlsZXMgPVxuICAgICBlbGVtZW50LnJldHJpZXZlKCdwcm90b3R5cGVfYWJzb2x1dGl6ZV9vcmlnaW5hbF9zdHlsZXMnKTtcblxuICAgIGlmIChvcmlnaW5hbFN0eWxlcykgZWxlbWVudC5zZXRTdHlsZShvcmlnaW5hbFN0eWxlcyk7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHNjcm9sbFRvKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgcG9zID0gRWxlbWVudC5jdW11bGF0aXZlT2Zmc2V0KGVsZW1lbnQpO1xuICAgIHdpbmRvdy5zY3JvbGxUbyhwb3MubGVmdCwgcG9zLnRvcCk7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIG1ha2VQb3NpdGlvbmVkKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgcG9zaXRpb24gPSBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpLCBzdHlsZXMgPSB7fTtcbiAgICBpZiAocG9zaXRpb24gPT09ICdzdGF0aWMnIHx8ICFwb3NpdGlvbikge1xuICAgICAgc3R5bGVzLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcbiAgICAgIGlmIChQcm90b3R5cGUuQnJvd3Nlci5PcGVyYSkge1xuICAgICAgICBzdHlsZXMudG9wICA9IDA7XG4gICAgICAgIHN0eWxlcy5sZWZ0ID0gMDtcbiAgICAgIH1cbiAgICAgIEVsZW1lbnQuc2V0U3R5bGUoZWxlbWVudCwgc3R5bGVzKTtcbiAgICAgIEVsZW1lbnQuc3RvcmUoZWxlbWVudCwgJ3Byb3RvdHlwZV9tYWRlX3Bvc2l0aW9uZWQnLCB0cnVlKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiB1bmRvUG9zaXRpb25lZChlbGVtZW50KSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIHN0b3JhZ2UgPSBFbGVtZW50LmdldFN0b3JhZ2UoZWxlbWVudCksXG4gICAgIG1hZGVQb3NpdGlvbmVkID0gc3RvcmFnZS5nZXQoJ3Byb3RvdHlwZV9tYWRlX3Bvc2l0aW9uZWQnKTtcblxuICAgIGlmIChtYWRlUG9zaXRpb25lZCkge1xuICAgICAgc3RvcmFnZS51bnNldCgncHJvdG90eXBlX21hZGVfcG9zaXRpb25lZCcpO1xuICAgICAgRWxlbWVudC5zZXRTdHlsZShlbGVtZW50LCB7XG4gICAgICAgIHBvc2l0aW9uOiAnJyxcbiAgICAgICAgdG9wOiAgICAgICcnLFxuICAgICAgICBib3R0b206ICAgJycsXG4gICAgICAgIGxlZnQ6ICAgICAnJyxcbiAgICAgICAgcmlnaHQ6ICAgICcnXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiBtYWtlQ2xpcHBpbmcoZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgdmFyIHN0b3JhZ2UgPSBFbGVtZW50LmdldFN0b3JhZ2UoZWxlbWVudCksXG4gICAgIG1hZGVDbGlwcGluZyA9IHN0b3JhZ2UuZ2V0KCdwcm90b3R5cGVfbWFkZV9jbGlwcGluZycpO1xuXG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChtYWRlQ2xpcHBpbmcpKSB7XG4gICAgICB2YXIgb3ZlcmZsb3cgPSBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdvdmVyZmxvdycpO1xuICAgICAgc3RvcmFnZS5zZXQoJ3Byb3RvdHlwZV9tYWRlX2NsaXBwaW5nJywgb3ZlcmZsb3cpO1xuICAgICAgaWYgKG92ZXJmbG93ICE9PSAnaGlkZGVuJylcbiAgICAgICAgZWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xuICAgIH1cblxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gdW5kb0NsaXBwaW5nKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgc3RvcmFnZSA9IEVsZW1lbnQuZ2V0U3RvcmFnZShlbGVtZW50KSxcbiAgICAgb3ZlcmZsb3cgPSBzdG9yYWdlLmdldCgncHJvdG90eXBlX21hZGVfY2xpcHBpbmcnKTtcblxuICAgIGlmICghT2JqZWN0LmlzVW5kZWZpbmVkKG92ZXJmbG93KSkge1xuICAgICAgc3RvcmFnZS51bnNldCgncHJvdG90eXBlX21hZGVfY2xpcHBpbmcnKTtcbiAgICAgIGVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSBvdmVyZmxvdyB8fCAnJztcbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb25lUG9zaXRpb24oZWxlbWVudCwgc291cmNlLCBvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IE9iamVjdC5leHRlbmQoe1xuICAgICAgc2V0TGVmdDogICAgdHJ1ZSxcbiAgICAgIHNldFRvcDogICAgIHRydWUsXG4gICAgICBzZXRXaWR0aDogICB0cnVlLFxuICAgICAgc2V0SGVpZ2h0OiAgdHJ1ZSxcbiAgICAgIG9mZnNldFRvcDogIDAsXG4gICAgICBvZmZzZXRMZWZ0OiAwXG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XG5cbiAgICBzb3VyY2UgID0gJChzb3VyY2UpO1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBwLCBkZWx0YSwgbGF5b3V0LCBzdHlsZXMgPSB7fTtcblxuICAgIGlmIChvcHRpb25zLnNldExlZnQgfHwgb3B0aW9ucy5zZXRUb3ApIHtcbiAgICAgIHAgPSBFbGVtZW50LnZpZXdwb3J0T2Zmc2V0KHNvdXJjZSk7XG4gICAgICBkZWx0YSA9IFswLCAwXTtcbiAgICAgIGlmIChFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpID09PSAnYWJzb2x1dGUnKSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSBFbGVtZW50LmdldE9mZnNldFBhcmVudChlbGVtZW50KTtcbiAgICAgICAgaWYgKHBhcmVudCAhPT0gZG9jdW1lbnQuYm9keSkgZGVsdGEgPSBFbGVtZW50LnZpZXdwb3J0T2Zmc2V0KHBhcmVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuc2V0V2lkdGggfHwgb3B0aW9ucy5zZXRIZWlnaHQpIHtcbiAgICAgIGxheW91dCA9IEVsZW1lbnQuZ2V0TGF5b3V0KHNvdXJjZSk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuc2V0TGVmdClcbiAgICAgIHN0eWxlcy5sZWZ0ID0gKHBbMF0gLSBkZWx0YVswXSArIG9wdGlvbnMub2Zmc2V0TGVmdCkgKyAncHgnO1xuICAgIGlmIChvcHRpb25zLnNldFRvcClcbiAgICAgIHN0eWxlcy50b3AgID0gKHBbMV0gLSBkZWx0YVsxXSArIG9wdGlvbnMub2Zmc2V0VG9wKSAgKyAncHgnO1xuXG4gICAgaWYgKG9wdGlvbnMuc2V0V2lkdGgpXG4gICAgICBzdHlsZXMud2lkdGggID0gbGF5b3V0LmdldCgnYm9yZGVyLWJveC13aWR0aCcpICArICdweCc7XG4gICAgaWYgKG9wdGlvbnMuc2V0SGVpZ2h0KVxuICAgICAgc3R5bGVzLmhlaWdodCA9IGxheW91dC5nZXQoJ2JvcmRlci1ib3gtaGVpZ2h0JykgKyAncHgnO1xuXG4gICAgcmV0dXJuIEVsZW1lbnQuc2V0U3R5bGUoZWxlbWVudCwgc3R5bGVzKTtcbiAgfVxuXG5cbiAgaWYgKFByb3RvdHlwZS5Ccm93c2VyLklFKSB7XG4gICAgZ2V0T2Zmc2V0UGFyZW50ID0gZ2V0T2Zmc2V0UGFyZW50LndyYXAoXG4gICAgICBmdW5jdGlvbihwcm9jZWVkLCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgICAgIGlmIChpc0RvY3VtZW50KGVsZW1lbnQpIHx8IGlzRGV0YWNoZWQoZWxlbWVudCkgfHwgaXNCb2R5KGVsZW1lbnQpIHx8IGlzSHRtbChlbGVtZW50KSlcbiAgICAgICAgICByZXR1cm4gJChkb2N1bWVudC5ib2R5KTtcblxuICAgICAgICB2YXIgcG9zaXRpb24gPSBlbGVtZW50LmdldFN0eWxlKCdwb3NpdGlvbicpO1xuICAgICAgICBpZiAocG9zaXRpb24gIT09ICdzdGF0aWMnKSByZXR1cm4gcHJvY2VlZChlbGVtZW50KTtcblxuICAgICAgICBlbGVtZW50LnNldFN0eWxlKHsgcG9zaXRpb246ICdyZWxhdGl2ZScgfSk7XG4gICAgICAgIHZhciB2YWx1ZSA9IHByb2NlZWQoZWxlbWVudCk7XG4gICAgICAgIGVsZW1lbnQuc2V0U3R5bGUoeyBwb3NpdGlvbjogcG9zaXRpb24gfSk7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgcG9zaXRpb25lZE9mZnNldCA9IHBvc2l0aW9uZWRPZmZzZXQud3JhcChmdW5jdGlvbihwcm9jZWVkLCBlbGVtZW50KSB7XG4gICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgIGlmICghZWxlbWVudC5wYXJlbnROb2RlKSByZXR1cm4gbmV3IEVsZW1lbnQuT2Zmc2V0KDAsIDApO1xuICAgICAgdmFyIHBvc2l0aW9uID0gZWxlbWVudC5nZXRTdHlsZSgncG9zaXRpb24nKTtcbiAgICAgIGlmIChwb3NpdGlvbiAhPT0gJ3N0YXRpYycpIHJldHVybiBwcm9jZWVkKGVsZW1lbnQpO1xuXG4gICAgICB2YXIgb2Zmc2V0UGFyZW50ID0gZWxlbWVudC5nZXRPZmZzZXRQYXJlbnQoKTtcbiAgICAgIGlmIChvZmZzZXRQYXJlbnQgJiYgb2Zmc2V0UGFyZW50LmdldFN0eWxlKCdwb3NpdGlvbicpID09PSAnZml4ZWQnKVxuICAgICAgICBoYXNMYXlvdXQob2Zmc2V0UGFyZW50KTtcblxuICAgICAgZWxlbWVudC5zZXRTdHlsZSh7IHBvc2l0aW9uOiAncmVsYXRpdmUnIH0pO1xuICAgICAgdmFyIHZhbHVlID0gcHJvY2VlZChlbGVtZW50KTtcbiAgICAgIGVsZW1lbnQuc2V0U3R5bGUoeyBwb3NpdGlvbjogcG9zaXRpb24gfSk7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoUHJvdG90eXBlLkJyb3dzZXIuV2Via2l0KSB7XG4gICAgY3VtdWxhdGl2ZU9mZnNldCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDA7XG4gICAgICBkbyB7XG4gICAgICAgIHZhbHVlVCArPSBlbGVtZW50Lm9mZnNldFRvcCAgfHwgMDtcbiAgICAgICAgdmFsdWVMICs9IGVsZW1lbnQub2Zmc2V0TGVmdCB8fCAwO1xuICAgICAgICBpZiAoZWxlbWVudC5vZmZzZXRQYXJlbnQgPT0gZG9jdW1lbnQuYm9keSkge1xuICAgICAgICAgIGlmIChFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpID09ICdhYnNvbHV0ZScpIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50O1xuICAgICAgfSB3aGlsZSAoZWxlbWVudCk7XG5cbiAgICAgIHJldHVybiBuZXcgRWxlbWVudC5PZmZzZXQodmFsdWVMLCB2YWx1ZVQpO1xuICAgIH07XG4gIH1cblxuXG4gIEVsZW1lbnQuYWRkTWV0aG9kcyh7XG4gICAgZ2V0TGF5b3V0OiAgICAgICAgICAgICAgZ2V0TGF5b3V0LFxuICAgIG1lYXN1cmU6ICAgICAgICAgICAgICAgIG1lYXN1cmUsXG4gICAgZ2V0V2lkdGg6ICAgICAgICAgICAgICAgZ2V0V2lkdGgsXG4gICAgZ2V0SGVpZ2h0OiAgICAgICAgICAgICAgZ2V0SGVpZ2h0LFxuICAgIGdldERpbWVuc2lvbnM6ICAgICAgICAgIGdldERpbWVuc2lvbnMsXG4gICAgZ2V0T2Zmc2V0UGFyZW50OiAgICAgICAgZ2V0T2Zmc2V0UGFyZW50LFxuICAgIGN1bXVsYXRpdmVPZmZzZXQ6ICAgICAgIGN1bXVsYXRpdmVPZmZzZXQsXG4gICAgcG9zaXRpb25lZE9mZnNldDogICAgICAgcG9zaXRpb25lZE9mZnNldCxcbiAgICBjdW11bGF0aXZlU2Nyb2xsT2Zmc2V0OiBjdW11bGF0aXZlU2Nyb2xsT2Zmc2V0LFxuICAgIHZpZXdwb3J0T2Zmc2V0OiAgICAgICAgIHZpZXdwb3J0T2Zmc2V0LFxuICAgIGFic29sdXRpemU6ICAgICAgICAgICAgIGFic29sdXRpemUsXG4gICAgcmVsYXRpdml6ZTogICAgICAgICAgICAgcmVsYXRpdml6ZSxcbiAgICBzY3JvbGxUbzogICAgICAgICAgICAgICBzY3JvbGxUbyxcbiAgICBtYWtlUG9zaXRpb25lZDogICAgICAgICBtYWtlUG9zaXRpb25lZCxcbiAgICB1bmRvUG9zaXRpb25lZDogICAgICAgICB1bmRvUG9zaXRpb25lZCxcbiAgICBtYWtlQ2xpcHBpbmc6ICAgICAgICAgICBtYWtlQ2xpcHBpbmcsXG4gICAgdW5kb0NsaXBwaW5nOiAgICAgICAgICAgdW5kb0NsaXBwaW5nLFxuICAgIGNsb25lUG9zaXRpb246ICAgICAgICAgIGNsb25lUG9zaXRpb25cbiAgfSk7XG5cbiAgZnVuY3Rpb24gaXNCb2R5KGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnQk9EWSc7XG4gIH1cblxuICBmdW5jdGlvbiBpc0h0bWwoZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50Lm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdIVE1MJztcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzRG9jdW1lbnQoZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50Lm5vZGVUeXBlID09PSBOb2RlLkRPQ1VNRU5UX05PREU7XG4gIH1cblxuICBmdW5jdGlvbiBpc0RldGFjaGVkKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudCAhPT0gZG9jdW1lbnQuYm9keSAmJlxuICAgICAhRWxlbWVudC5kZXNjZW5kYW50T2YoZWxlbWVudCwgZG9jdW1lbnQuYm9keSk7XG4gIH1cblxuICBpZiAoJ2dldEJvdW5kaW5nQ2xpZW50UmVjdCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgRWxlbWVudC5hZGRNZXRob2RzKHtcbiAgICAgIHZpZXdwb3J0T2Zmc2V0OiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBpZiAoaXNEZXRhY2hlZChlbGVtZW50KSkgcmV0dXJuIG5ldyBFbGVtZW50Lk9mZnNldCgwLCAwKTtcblxuICAgICAgICB2YXIgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICBkb2NFbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICAgICAgcmV0dXJuIG5ldyBFbGVtZW50Lk9mZnNldChyZWN0LmxlZnQgLSBkb2NFbC5jbGllbnRMZWZ0LFxuICAgICAgICAgcmVjdC50b3AgLSBkb2NFbC5jbGllbnRUb3ApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cblxufSkoKTtcblxuKGZ1bmN0aW9uKCkge1xuXG4gIHZhciBJU19PTERfT1BFUkEgPSBQcm90b3R5cGUuQnJvd3Nlci5PcGVyYSAmJlxuICAgKHdpbmRvdy5wYXJzZUZsb2F0KHdpbmRvdy5vcGVyYS52ZXJzaW9uKCkpIDwgOS41KTtcbiAgdmFyIFJPT1QgPSBudWxsO1xuICBmdW5jdGlvbiBnZXRSb290RWxlbWVudCgpIHtcbiAgICBpZiAoUk9PVCkgcmV0dXJuIFJPT1Q7XG4gICAgUk9PVCA9IElTX09MRF9PUEVSQSA/IGRvY3VtZW50LmJvZHkgOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgcmV0dXJuIFJPT1Q7XG4gIH1cblxuICBmdW5jdGlvbiBnZXREaW1lbnNpb25zKCkge1xuICAgIHJldHVybiB7IHdpZHRoOiB0aGlzLmdldFdpZHRoKCksIGhlaWdodDogdGhpcy5nZXRIZWlnaHQoKSB9O1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0V2lkdGgoKSB7XG4gICAgcmV0dXJuIGdldFJvb3RFbGVtZW50KCkuY2xpZW50V2lkdGg7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRIZWlnaHQoKSB7XG4gICAgcmV0dXJuIGdldFJvb3RFbGVtZW50KCkuY2xpZW50SGVpZ2h0O1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0U2Nyb2xsT2Zmc2V0cygpIHtcbiAgICB2YXIgeCA9IHdpbmRvdy5wYWdlWE9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCB8fFxuICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQ7XG4gICAgdmFyIHkgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fFxuICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDtcblxuICAgIHJldHVybiBuZXcgRWxlbWVudC5PZmZzZXQoeCwgeSk7XG4gIH1cblxuICBkb2N1bWVudC52aWV3cG9ydCA9IHtcbiAgICBnZXREaW1lbnNpb25zOiAgICBnZXREaW1lbnNpb25zLFxuICAgIGdldFdpZHRoOiAgICAgICAgIGdldFdpZHRoLFxuICAgIGdldEhlaWdodDogICAgICAgIGdldEhlaWdodCxcbiAgICBnZXRTY3JvbGxPZmZzZXRzOiBnZXRTY3JvbGxPZmZzZXRzXG4gIH07XG5cbn0pKCk7XG53aW5kb3cuJCQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGV4cHJlc3Npb24gPSAkQShhcmd1bWVudHMpLmpvaW4oJywgJyk7XG4gIHJldHVybiBQcm90b3R5cGUuU2VsZWN0b3Iuc2VsZWN0KGV4cHJlc3Npb24sIGRvY3VtZW50KTtcbn07XG5cblByb3RvdHlwZS5TZWxlY3RvciA9IChmdW5jdGlvbigpIHtcblxuICBmdW5jdGlvbiBzZWxlY3QoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2QgXCJQcm90b3R5cGUuU2VsZWN0b3Iuc2VsZWN0XCIgbXVzdCBiZSBkZWZpbmVkLicpO1xuICB9XG5cbiAgZnVuY3Rpb24gbWF0Y2goKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2QgXCJQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2hcIiBtdXN0IGJlIGRlZmluZWQuJyk7XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kKGVsZW1lbnRzLCBleHByZXNzaW9uLCBpbmRleCkge1xuICAgIGluZGV4ID0gaW5kZXggfHwgMDtcbiAgICB2YXIgbWF0Y2ggPSBQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2gsIGxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aCwgbWF0Y2hJbmRleCA9IDAsIGk7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChtYXRjaChlbGVtZW50c1tpXSwgZXhwcmVzc2lvbikgJiYgaW5kZXggPT0gbWF0Y2hJbmRleCsrKSB7XG4gICAgICAgIHJldHVybiBFbGVtZW50LmV4dGVuZChlbGVtZW50c1tpXSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZXh0ZW5kRWxlbWVudHMoZWxlbWVudHMpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnRzW2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnRzO1xuICB9XG5cblxuICB2YXIgSyA9IFByb3RvdHlwZS5LO1xuXG4gIHJldHVybiB7XG4gICAgc2VsZWN0OiBzZWxlY3QsXG4gICAgbWF0Y2g6IG1hdGNoLFxuICAgIGZpbmQ6IGZpbmQsXG4gICAgZXh0ZW5kRWxlbWVudHM6IChFbGVtZW50LmV4dGVuZCA9PT0gSykgPyBLIDogZXh0ZW5kRWxlbWVudHMsXG4gICAgZXh0ZW5kRWxlbWVudDogRWxlbWVudC5leHRlbmRcbiAgfTtcbn0pKCk7XG5Qcm90b3R5cGUuX29yaWdpbmFsX3Byb3BlcnR5ID0gd2luZG93LlNpenpsZTtcbi8qIVxuICogU2l6emxlIENTUyBTZWxlY3RvciBFbmdpbmUgdkBWRVJTSU9OXG4gKiBodHRwOi8vc2l6emxlanMuY29tL1xuICpcbiAqIENvcHlyaWdodCAyMDEzIGpRdWVyeSBGb3VuZGF0aW9uLCBJbmMuIGFuZCBvdGhlciBjb250cmlidXRvcnNcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZVxuICpcbiAqIERhdGU6IEBEQVRFXG4gKi9cbihmdW5jdGlvbiggd2luZG93ICkge1xuXG52YXIgaSxcblx0c3VwcG9ydCxcblx0RXhwcixcblx0Z2V0VGV4dCxcblx0aXNYTUwsXG5cdGNvbXBpbGUsXG5cdHNlbGVjdCxcblx0b3V0ZXJtb3N0Q29udGV4dCxcblx0c29ydElucHV0LFxuXHRoYXNEdXBsaWNhdGUsXG5cblx0c2V0RG9jdW1lbnQsXG5cdGRvY3VtZW50LFxuXHRkb2NFbGVtLFxuXHRkb2N1bWVudElzSFRNTCxcblx0cmJ1Z2d5UVNBLFxuXHRyYnVnZ3lNYXRjaGVzLFxuXHRtYXRjaGVzLFxuXHRjb250YWlucyxcblxuXHRleHBhbmRvID0gXCJzaXp6bGVcIiArIC0obmV3IERhdGUoKSksXG5cdHByZWZlcnJlZERvYyA9IHdpbmRvdy5kb2N1bWVudCxcblx0ZGlycnVucyA9IDAsXG5cdGRvbmUgPSAwLFxuXHRjbGFzc0NhY2hlID0gY3JlYXRlQ2FjaGUoKSxcblx0dG9rZW5DYWNoZSA9IGNyZWF0ZUNhY2hlKCksXG5cdGNvbXBpbGVyQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuXHRzb3J0T3JkZXIgPSBmdW5jdGlvbiggYSwgYiApIHtcblx0XHRpZiAoIGEgPT09IGIgKSB7XG5cdFx0XHRoYXNEdXBsaWNhdGUgPSB0cnVlO1xuXHRcdH1cblx0XHRyZXR1cm4gMDtcblx0fSxcblxuXHRzdHJ1bmRlZmluZWQgPSB0eXBlb2YgdW5kZWZpbmVkLFxuXHRNQVhfTkVHQVRJVkUgPSAxIDw8IDMxLFxuXG5cdGhhc093biA9ICh7fSkuaGFzT3duUHJvcGVydHksXG5cdGFyciA9IFtdLFxuXHRwb3AgPSBhcnIucG9wLFxuXHRwdXNoX25hdGl2ZSA9IGFyci5wdXNoLFxuXHRwdXNoID0gYXJyLnB1c2gsXG5cdHNsaWNlID0gYXJyLnNsaWNlLFxuXHRpbmRleE9mID0gYXJyLmluZGV4T2YgfHwgZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0dmFyIGkgPSAwLFxuXHRcdFx0bGVuID0gdGhpcy5sZW5ndGg7XG5cdFx0Zm9yICggOyBpIDwgbGVuOyBpKysgKSB7XG5cdFx0XHRpZiAoIHRoaXNbaV0gPT09IGVsZW0gKSB7XG5cdFx0XHRcdHJldHVybiBpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gLTE7XG5cdH0sXG5cblx0Ym9vbGVhbnMgPSBcImNoZWNrZWR8c2VsZWN0ZWR8YXN5bmN8YXV0b2ZvY3VzfGF1dG9wbGF5fGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxpc21hcHxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkXCIsXG5cblxuXHR3aGl0ZXNwYWNlID0gXCJbXFxcXHgyMFxcXFx0XFxcXHJcXFxcblxcXFxmXVwiLFxuXHRjaGFyYWN0ZXJFbmNvZGluZyA9IFwiKD86XFxcXFxcXFwufFtcXFxcdy1dfFteXFxcXHgwMC1cXFxceGEwXSkrXCIsXG5cblx0aWRlbnRpZmllciA9IGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoIFwid1wiLCBcIncjXCIgKSxcblxuXHRhdHRyaWJ1dGVzID0gXCJcXFxcW1wiICsgd2hpdGVzcGFjZSArIFwiKihcIiArIGNoYXJhY3RlckVuY29kaW5nICsgXCIpXCIgKyB3aGl0ZXNwYWNlICtcblx0XHRcIiooPzooWypeJHwhfl0/PSlcIiArIHdoaXRlc3BhY2UgKyBcIiooPzooWydcXFwiXSkoKD86XFxcXFxcXFwufFteXFxcXFxcXFxdKSo/KVxcXFwzfChcIiArIGlkZW50aWZpZXIgKyBcIil8KXwpXCIgKyB3aGl0ZXNwYWNlICsgXCIqXFxcXF1cIixcblxuXHRwc2V1ZG9zID0gXCI6KFwiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyBcIikoPzpcXFxcKCgoWydcXFwiXSkoKD86XFxcXFxcXFwufFteXFxcXFxcXFxdKSo/KVxcXFwzfCgoPzpcXFxcXFxcXC58W15cXFxcXFxcXCgpW1xcXFxdXXxcIiArIGF0dHJpYnV0ZXMucmVwbGFjZSggMywgOCApICsgXCIpKil8LiopXFxcXCl8KVwiLFxuXG5cdHJ0cmltID0gbmV3IFJlZ0V4cCggXCJeXCIgKyB3aGl0ZXNwYWNlICsgXCIrfCgoPzpefFteXFxcXFxcXFxdKSg/OlxcXFxcXFxcLikqKVwiICsgd2hpdGVzcGFjZSArIFwiKyRcIiwgXCJnXCIgKSxcblxuXHRyY29tbWEgPSBuZXcgUmVnRXhwKCBcIl5cIiArIHdoaXRlc3BhY2UgKyBcIiosXCIgKyB3aGl0ZXNwYWNlICsgXCIqXCIgKSxcblx0cmNvbWJpbmF0b3JzID0gbmV3IFJlZ0V4cCggXCJeXCIgKyB3aGl0ZXNwYWNlICsgXCIqKFs+K35dfFwiICsgd2hpdGVzcGFjZSArIFwiKVwiICsgd2hpdGVzcGFjZSArIFwiKlwiICksXG5cblx0cmF0dHJpYnV0ZVF1b3RlcyA9IG5ldyBSZWdFeHAoIFwiPVwiICsgd2hpdGVzcGFjZSArIFwiKihbXlxcXFxdJ1xcXCJdKj8pXCIgKyB3aGl0ZXNwYWNlICsgXCIqXFxcXF1cIiwgXCJnXCIgKSxcblxuXHRycHNldWRvID0gbmV3IFJlZ0V4cCggcHNldWRvcyApLFxuXHRyaWRlbnRpZmllciA9IG5ldyBSZWdFeHAoIFwiXlwiICsgaWRlbnRpZmllciArIFwiJFwiICksXG5cblx0bWF0Y2hFeHByID0ge1xuXHRcdFwiSURcIjogbmV3IFJlZ0V4cCggXCJeIyhcIiArIGNoYXJhY3RlckVuY29kaW5nICsgXCIpXCIgKSxcblx0XHRcIkNMQVNTXCI6IG5ldyBSZWdFeHAoIFwiXlxcXFwuKFwiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyBcIilcIiApLFxuXHRcdFwiVEFHXCI6IG5ldyBSZWdFeHAoIFwiXihcIiArIGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoIFwid1wiLCBcIncqXCIgKSArIFwiKVwiICksXG5cdFx0XCJBVFRSXCI6IG5ldyBSZWdFeHAoIFwiXlwiICsgYXR0cmlidXRlcyApLFxuXHRcdFwiUFNFVURPXCI6IG5ldyBSZWdFeHAoIFwiXlwiICsgcHNldWRvcyApLFxuXHRcdFwiQ0hJTERcIjogbmV3IFJlZ0V4cCggXCJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXFxcKFwiICsgd2hpdGVzcGFjZSArXG5cdFx0XHRcIiooZXZlbnxvZGR8KChbKy1dfCkoXFxcXGQqKW58KVwiICsgd2hpdGVzcGFjZSArIFwiKig/OihbKy1dfClcIiArIHdoaXRlc3BhY2UgK1xuXHRcdFx0XCIqKFxcXFxkKyl8KSlcIiArIHdoaXRlc3BhY2UgKyBcIipcXFxcKXwpXCIsIFwiaVwiICksXG5cdFx0XCJib29sXCI6IG5ldyBSZWdFeHAoIFwiXig/OlwiICsgYm9vbGVhbnMgKyBcIikkXCIsIFwiaVwiICksXG5cdFx0XCJuZWVkc0NvbnRleHRcIjogbmV3IFJlZ0V4cCggXCJeXCIgKyB3aGl0ZXNwYWNlICsgXCIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXFxcKFwiICtcblx0XHRcdHdoaXRlc3BhY2UgKyBcIiooKD86LVxcXFxkKT9cXFxcZCopXCIgKyB3aGl0ZXNwYWNlICsgXCIqXFxcXCl8KSg/PVteLV18JClcIiwgXCJpXCIgKVxuXHR9LFxuXG5cdHJpbnB1dHMgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLFxuXHRyaGVhZGVyID0gL15oXFxkJC9pLFxuXG5cdHJuYXRpdmUgPSAvXltee10rXFx7XFxzKlxcW25hdGl2ZSBcXHcvLFxuXG5cdHJxdWlja0V4cHIgPSAvXig/OiMoW1xcdy1dKyl8KFxcdyspfFxcLihbXFx3LV0rKSkkLyxcblxuXHRyc2libGluZyA9IC9bK35dLyxcblx0cmVzY2FwZSA9IC8nfFxcXFwvZyxcblxuXHRydW5lc2NhcGUgPSBuZXcgUmVnRXhwKCBcIlxcXFxcXFxcKFtcXFxcZGEtZl17MSw2fVwiICsgd2hpdGVzcGFjZSArIFwiP3woXCIgKyB3aGl0ZXNwYWNlICsgXCIpfC4pXCIsIFwiaWdcIiApLFxuXHRmdW5lc2NhcGUgPSBmdW5jdGlvbiggXywgZXNjYXBlZCwgZXNjYXBlZFdoaXRlc3BhY2UgKSB7XG5cdFx0dmFyIGhpZ2ggPSBcIjB4XCIgKyBlc2NhcGVkIC0gMHgxMDAwMDtcblx0XHRyZXR1cm4gaGlnaCAhPT0gaGlnaCB8fCBlc2NhcGVkV2hpdGVzcGFjZSA/XG5cdFx0XHRlc2NhcGVkIDpcblx0XHRcdGhpZ2ggPCAwID9cblx0XHRcdFx0U3RyaW5nLmZyb21DaGFyQ29kZSggaGlnaCArIDB4MTAwMDAgKSA6XG5cdFx0XHRcdFN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggPj4gMTAgfCAweEQ4MDAsIGhpZ2ggJiAweDNGRiB8IDB4REMwMCApO1xuXHR9O1xuXG50cnkge1xuXHRwdXNoLmFwcGx5KFxuXHRcdChhcnIgPSBzbGljZS5jYWxsKCBwcmVmZXJyZWREb2MuY2hpbGROb2RlcyApKSxcblx0XHRwcmVmZXJyZWREb2MuY2hpbGROb2Rlc1xuXHQpO1xuXHRhcnJbIHByZWZlcnJlZERvYy5jaGlsZE5vZGVzLmxlbmd0aCBdLm5vZGVUeXBlO1xufSBjYXRjaCAoIGUgKSB7XG5cdHB1c2ggPSB7IGFwcGx5OiBhcnIubGVuZ3RoID9cblxuXHRcdGZ1bmN0aW9uKCB0YXJnZXQsIGVscyApIHtcblx0XHRcdHB1c2hfbmF0aXZlLmFwcGx5KCB0YXJnZXQsIHNsaWNlLmNhbGwoZWxzKSApO1xuXHRcdH0gOlxuXG5cdFx0ZnVuY3Rpb24oIHRhcmdldCwgZWxzICkge1xuXHRcdFx0dmFyIGogPSB0YXJnZXQubGVuZ3RoLFxuXHRcdFx0XHRpID0gMDtcblx0XHRcdHdoaWxlICggKHRhcmdldFtqKytdID0gZWxzW2krK10pICkge31cblx0XHRcdHRhcmdldC5sZW5ndGggPSBqIC0gMTtcblx0XHR9XG5cdH07XG59XG5cbmZ1bmN0aW9uIFNpenpsZSggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7XG5cdHZhciBtYXRjaCwgZWxlbSwgbSwgbm9kZVR5cGUsXG5cdFx0aSwgZ3JvdXBzLCBvbGQsIG5pZCwgbmV3Q29udGV4dCwgbmV3U2VsZWN0b3I7XG5cblx0aWYgKCAoIGNvbnRleHQgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IHByZWZlcnJlZERvYyApICE9PSBkb2N1bWVudCApIHtcblx0XHRzZXREb2N1bWVudCggY29udGV4dCApO1xuXHR9XG5cblx0Y29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7XG5cdHJlc3VsdHMgPSByZXN1bHRzIHx8IFtdO1xuXG5cdGlmICggIXNlbGVjdG9yIHx8IHR5cGVvZiBzZWxlY3RvciAhPT0gXCJzdHJpbmdcIiApIHtcblx0XHRyZXR1cm4gcmVzdWx0cztcblx0fVxuXG5cdGlmICggKG5vZGVUeXBlID0gY29udGV4dC5ub2RlVHlwZSkgIT09IDEgJiYgbm9kZVR5cGUgIT09IDkgKSB7XG5cdFx0cmV0dXJuIFtdO1xuXHR9XG5cblx0aWYgKCBkb2N1bWVudElzSFRNTCAmJiAhc2VlZCApIHtcblxuXHRcdGlmICggKG1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApKSApIHtcblx0XHRcdGlmICggKG0gPSBtYXRjaFsxXSkgKSB7XG5cdFx0XHRcdGlmICggbm9kZVR5cGUgPT09IDkgKSB7XG5cdFx0XHRcdFx0ZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIG0gKTtcblx0XHRcdFx0XHRpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkge1xuXHRcdFx0XHRcdFx0aWYgKCBlbGVtLmlkID09PSBtICkge1xuXHRcdFx0XHRcdFx0XHRyZXN1bHRzLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAoIGNvbnRleHQub3duZXJEb2N1bWVudCAmJiAoZWxlbSA9IGNvbnRleHQub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbSApKSAmJlxuXHRcdFx0XHRcdFx0Y29udGFpbnMoIGNvbnRleHQsIGVsZW0gKSAmJiBlbGVtLmlkID09PSBtICkge1xuXHRcdFx0XHRcdFx0cmVzdWx0cy5wdXNoKCBlbGVtICk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0fSBlbHNlIGlmICggbWF0Y2hbMl0gKSB7XG5cdFx0XHRcdHB1c2guYXBwbHkoIHJlc3VsdHMsIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHNlbGVjdG9yICkgKTtcblx0XHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cblx0XHRcdH0gZWxzZSBpZiAoIChtID0gbWF0Y2hbM10pICYmIHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7XG5cdFx0XHRcdHB1c2guYXBwbHkoIHJlc3VsdHMsIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggbSApICk7XG5cdFx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICggc3VwcG9ydC5xc2EgJiYgKCFyYnVnZ3lRU0EgfHwgIXJidWdneVFTQS50ZXN0KCBzZWxlY3RvciApKSApIHtcblx0XHRcdG5pZCA9IG9sZCA9IGV4cGFuZG87XG5cdFx0XHRuZXdDb250ZXh0ID0gY29udGV4dDtcblx0XHRcdG5ld1NlbGVjdG9yID0gbm9kZVR5cGUgPT09IDkgJiYgc2VsZWN0b3I7XG5cblx0XHRcdGlmICggbm9kZVR5cGUgPT09IDEgJiYgY29udGV4dC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcIm9iamVjdFwiICkge1xuXHRcdFx0XHRncm91cHMgPSB0b2tlbml6ZSggc2VsZWN0b3IgKTtcblxuXHRcdFx0XHRpZiAoIChvbGQgPSBjb250ZXh0LmdldEF0dHJpYnV0ZShcImlkXCIpKSApIHtcblx0XHRcdFx0XHRuaWQgPSBvbGQucmVwbGFjZSggcmVzY2FwZSwgXCJcXFxcJCZcIiApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnRleHQuc2V0QXR0cmlidXRlKCBcImlkXCIsIG5pZCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdG5pZCA9IFwiW2lkPSdcIiArIG5pZCArIFwiJ10gXCI7XG5cblx0XHRcdFx0aSA9IGdyb3Vwcy5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRcdGdyb3Vwc1tpXSA9IG5pZCArIHRvU2VsZWN0b3IoIGdyb3Vwc1tpXSApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdG5ld0NvbnRleHQgPSByc2libGluZy50ZXN0KCBzZWxlY3RvciApICYmIHRlc3RDb250ZXh0KCBjb250ZXh0LnBhcmVudE5vZGUgKSB8fCBjb250ZXh0O1xuXHRcdFx0XHRuZXdTZWxlY3RvciA9IGdyb3Vwcy5qb2luKFwiLFwiKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCBuZXdTZWxlY3RvciApIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRwdXNoLmFwcGx5KCByZXN1bHRzLFxuXHRcdFx0XHRcdFx0bmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCBuZXdTZWxlY3RvciApXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblx0XHRcdFx0fSBjYXRjaChxc2FFcnJvcikge1xuXHRcdFx0XHR9IGZpbmFsbHkge1xuXHRcdFx0XHRcdGlmICggIW9sZCApIHtcblx0XHRcdFx0XHRcdGNvbnRleHQucmVtb3ZlQXR0cmlidXRlKFwiaWRcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHNlbGVjdCggc2VsZWN0b3IucmVwbGFjZSggcnRyaW0sIFwiJDFcIiApLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICk7XG59XG5cbi8qKlxuICogQ3JlYXRlIGtleS12YWx1ZSBjYWNoZXMgb2YgbGltaXRlZCBzaXplXG4gKiBAcmV0dXJucyB7RnVuY3Rpb24oc3RyaW5nLCBPYmplY3QpfSBSZXR1cm5zIHRoZSBPYmplY3QgZGF0YSBhZnRlciBzdG9yaW5nIGl0IG9uIGl0c2VsZiB3aXRoXG4gKlx0cHJvcGVydHkgbmFtZSB0aGUgKHNwYWNlLXN1ZmZpeGVkKSBzdHJpbmcgYW5kIChpZiB0aGUgY2FjaGUgaXMgbGFyZ2VyIHRoYW4gRXhwci5jYWNoZUxlbmd0aClcbiAqXHRkZWxldGluZyB0aGUgb2xkZXN0IGVudHJ5XG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkge1xuXHR2YXIga2V5cyA9IFtdO1xuXG5cdGZ1bmN0aW9uIGNhY2hlKCBrZXksIHZhbHVlICkge1xuXHRcdGlmICgga2V5cy5wdXNoKCBrZXkgKyBcIiBcIiApID4gRXhwci5jYWNoZUxlbmd0aCApIHtcblx0XHRcdGRlbGV0ZSBjYWNoZVsga2V5cy5zaGlmdCgpIF07XG5cdFx0fVxuXHRcdHJldHVybiAoY2FjaGVbIGtleSArIFwiIFwiIF0gPSB2YWx1ZSk7XG5cdH1cblx0cmV0dXJuIGNhY2hlO1xufVxuXG4vKipcbiAqIE1hcmsgYSBmdW5jdGlvbiBmb3Igc3BlY2lhbCB1c2UgYnkgU2l6emxlXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gbWFya1xuICovXG5mdW5jdGlvbiBtYXJrRnVuY3Rpb24oIGZuICkge1xuXHRmblsgZXhwYW5kbyBdID0gdHJ1ZTtcblx0cmV0dXJuIGZuO1xufVxuXG4vKipcbiAqIFN1cHBvcnQgdGVzdGluZyB1c2luZyBhbiBlbGVtZW50XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBQYXNzZWQgdGhlIGNyZWF0ZWQgZGl2IGFuZCBleHBlY3RzIGEgYm9vbGVhbiByZXN1bHRcbiAqL1xuZnVuY3Rpb24gYXNzZXJ0KCBmbiApIHtcblx0dmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0dHJ5IHtcblx0XHRyZXR1cm4gISFmbiggZGl2ICk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH0gZmluYWxseSB7XG5cdFx0aWYgKCBkaXYucGFyZW50Tm9kZSApIHtcblx0XHRcdGRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBkaXYgKTtcblx0XHR9XG5cdFx0ZGl2ID0gbnVsbDtcblx0fVxufVxuXG4vKipcbiAqIEFkZHMgdGhlIHNhbWUgaGFuZGxlciBmb3IgYWxsIG9mIHRoZSBzcGVjaWZpZWQgYXR0cnNcbiAqIEBwYXJhbSB7U3RyaW5nfSBhdHRycyBQaXBlLXNlcGFyYXRlZCBsaXN0IG9mIGF0dHJpYnV0ZXNcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgVGhlIG1ldGhvZCB0aGF0IHdpbGwgYmUgYXBwbGllZFxuICovXG5mdW5jdGlvbiBhZGRIYW5kbGUoIGF0dHJzLCBoYW5kbGVyICkge1xuXHR2YXIgYXJyID0gYXR0cnMuc3BsaXQoXCJ8XCIpLFxuXHRcdGkgPSBhdHRycy5sZW5ndGg7XG5cblx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0RXhwci5hdHRySGFuZGxlWyBhcnJbaV0gXSA9IGhhbmRsZXI7XG5cdH1cbn1cblxuLyoqXG4gKiBDaGVja3MgZG9jdW1lbnQgb3JkZXIgb2YgdHdvIHNpYmxpbmdzXG4gKiBAcGFyYW0ge0VsZW1lbnR9IGFcbiAqIEBwYXJhbSB7RWxlbWVudH0gYlxuICogQHJldHVybnMge051bWJlcn0gUmV0dXJucyBsZXNzIHRoYW4gMCBpZiBhIHByZWNlZGVzIGIsIGdyZWF0ZXIgdGhhbiAwIGlmIGEgZm9sbG93cyBiXG4gKi9cbmZ1bmN0aW9uIHNpYmxpbmdDaGVjayggYSwgYiApIHtcblx0dmFyIGN1ciA9IGIgJiYgYSxcblx0XHRkaWZmID0gY3VyICYmIGEubm9kZVR5cGUgPT09IDEgJiYgYi5ub2RlVHlwZSA9PT0gMSAmJlxuXHRcdFx0KCB+Yi5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKSAtXG5cdFx0XHQoIH5hLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSApO1xuXG5cdGlmICggZGlmZiApIHtcblx0XHRyZXR1cm4gZGlmZjtcblx0fVxuXG5cdGlmICggY3VyICkge1xuXHRcdHdoaWxlICggKGN1ciA9IGN1ci5uZXh0U2libGluZykgKSB7XG5cdFx0XHRpZiAoIGN1ciA9PT0gYiApIHtcblx0XHRcdFx0cmV0dXJuIC0xO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiBhID8gMSA6IC0xO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgaW5wdXQgdHlwZXNcbiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUlucHV0UHNldWRvKCB0eXBlICkge1xuXHRyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0dmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0cmV0dXJuIG5hbWUgPT09IFwiaW5wdXRcIiAmJiBlbGVtLnR5cGUgPT09IHR5cGU7XG5cdH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBidXR0b25zXG4gKiBAcGFyYW0ge1N0cmluZ30gdHlwZVxuICovXG5mdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7XG5cdHJldHVybiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHR2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRyZXR1cm4gKG5hbWUgPT09IFwiaW5wdXRcIiB8fCBuYW1lID09PSBcImJ1dHRvblwiKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7XG5cdH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBwb3NpdGlvbmFsc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gZm5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25hbFBzZXVkbyggZm4gKSB7XG5cdHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIGFyZ3VtZW50ICkge1xuXHRcdGFyZ3VtZW50ID0gK2FyZ3VtZW50O1xuXHRcdHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMgKSB7XG5cdFx0XHR2YXIgaixcblx0XHRcdFx0bWF0Y2hJbmRleGVzID0gZm4oIFtdLCBzZWVkLmxlbmd0aCwgYXJndW1lbnQgKSxcblx0XHRcdFx0aSA9IG1hdGNoSW5kZXhlcy5sZW5ndGg7XG5cblx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRpZiAoIHNlZWRbIChqID0gbWF0Y2hJbmRleGVzW2ldKSBdICkge1xuXHRcdFx0XHRcdHNlZWRbal0gPSAhKG1hdGNoZXNbal0gPSBzZWVkW2pdKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBDaGVja3MgYSBub2RlIGZvciB2YWxpZGl0eSBhcyBhIFNpenpsZSBjb250ZXh0XG4gKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0PX0gY29udGV4dFxuICogQHJldHVybnMge0VsZW1lbnR8T2JqZWN0fEJvb2xlYW59IFRoZSBpbnB1dCBub2RlIGlmIGFjY2VwdGFibGUsIG90aGVyd2lzZSBhIGZhbHN5IHZhbHVlXG4gKi9cbmZ1bmN0aW9uIHRlc3RDb250ZXh0KCBjb250ZXh0ICkge1xuXHRyZXR1cm4gY29udGV4dCAmJiB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gc3RydW5kZWZpbmVkICYmIGNvbnRleHQ7XG59XG5cbnN1cHBvcnQgPSBTaXp6bGUuc3VwcG9ydCA9IHt9O1xuXG4vKipcbiAqIERldGVjdHMgWE1MIG5vZGVzXG4gKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBlbGVtIEFuIGVsZW1lbnQgb3IgYSBkb2N1bWVudFxuICogQHJldHVybnMge0Jvb2xlYW59IFRydWUgaWZmIGVsZW0gaXMgYSBub24tSFRNTCBYTUwgbm9kZVxuICovXG5pc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkge1xuXHR2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDtcblx0cmV0dXJuIGRvY3VtZW50RWxlbWVudCA/IGRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSAhPT0gXCJIVE1MXCIgOiBmYWxzZTtcbn07XG5cbi8qKlxuICogU2V0cyBkb2N1bWVudC1yZWxhdGVkIHZhcmlhYmxlcyBvbmNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudFxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY3VycmVudCBkb2N1bWVudFxuICovXG5zZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkge1xuXHR2YXIgaGFzQ29tcGFyZSxcblx0XHRkb2MgPSBub2RlID8gbm9kZS5vd25lckRvY3VtZW50IHx8IG5vZGUgOiBwcmVmZXJyZWREb2MsXG5cdFx0cGFyZW50ID0gZG9jLmRlZmF1bHRWaWV3O1xuXG5cdGlmICggZG9jID09PSBkb2N1bWVudCB8fCBkb2Mubm9kZVR5cGUgIT09IDkgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQgKSB7XG5cdFx0cmV0dXJuIGRvY3VtZW50O1xuXHR9XG5cblx0ZG9jdW1lbnQgPSBkb2M7XG5cdGRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50O1xuXG5cdGRvY3VtZW50SXNIVE1MID0gIWlzWE1MKCBkb2MgKTtcblxuXHRpZiAoIHBhcmVudCAmJiBwYXJlbnQgIT09IHBhcmVudC50b3AgKSB7XG5cdFx0aWYgKCBwYXJlbnQuYWRkRXZlbnRMaXN0ZW5lciApIHtcblx0XHRcdHBhcmVudC5hZGRFdmVudExpc3RlbmVyKCBcInVubG9hZFwiLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0c2V0RG9jdW1lbnQoKTtcblx0XHRcdH0sIGZhbHNlICk7XG5cdFx0fSBlbHNlIGlmICggcGFyZW50LmF0dGFjaEV2ZW50ICkge1xuXHRcdFx0cGFyZW50LmF0dGFjaEV2ZW50KCBcIm9udW5sb2FkXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZXREb2N1bWVudCgpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0LyogQXR0cmlidXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblx0c3VwcG9ydC5hdHRyaWJ1dGVzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdFx0ZGl2LmNsYXNzTmFtZSA9IFwiaVwiO1xuXHRcdHJldHVybiAhZGl2LmdldEF0dHJpYnV0ZShcImNsYXNzTmFtZVwiKTtcblx0fSk7XG5cblx0LyogZ2V0RWxlbWVudChzKUJ5KlxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblx0c3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRcdGRpdi5hcHBlbmRDaGlsZCggZG9jLmNyZWF0ZUNvbW1lbnQoXCJcIikgKTtcblx0XHRyZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikubGVuZ3RoO1xuXHR9KTtcblxuXHRzdXBwb3J0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgPSBybmF0aXZlLnRlc3QoIGRvYy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICkgJiYgYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdFx0ZGl2LmlubmVySFRNTCA9IFwiPGRpdiBjbGFzcz0nYSc+PC9kaXY+PGRpdiBjbGFzcz0nYSBpJz48L2Rpdj5cIjtcblxuXHRcdGRpdi5maXJzdENoaWxkLmNsYXNzTmFtZSA9IFwiaVwiO1xuXHRcdHJldHVybiBkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImlcIikubGVuZ3RoID09PSAyO1xuXHR9KTtcblxuXHRzdXBwb3J0LmdldEJ5SWQgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHtcblx0XHRkb2NFbGVtLmFwcGVuZENoaWxkKCBkaXYgKS5pZCA9IGV4cGFuZG87XG5cdFx0cmV0dXJuICFkb2MuZ2V0RWxlbWVudHNCeU5hbWUgfHwgIWRvYy5nZXRFbGVtZW50c0J5TmFtZSggZXhwYW5kbyApLmxlbmd0aDtcblx0fSk7XG5cblx0aWYgKCBzdXBwb3J0LmdldEJ5SWQgKSB7XG5cdFx0RXhwci5maW5kW1wiSURcIl0gPSBmdW5jdGlvbiggaWQsIGNvbnRleHQgKSB7XG5cdFx0XHRpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgZG9jdW1lbnRJc0hUTUwgKSB7XG5cdFx0XHRcdHZhciBtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggaWQgKTtcblx0XHRcdFx0cmV0dXJuIG0gJiYgbS5wYXJlbnROb2RlID8gW21dIDogW107XG5cdFx0XHR9XG5cdFx0fTtcblx0XHRFeHByLmZpbHRlcltcIklEXCJdID0gZnVuY3Rpb24oIGlkICkge1xuXHRcdFx0dmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZShcImlkXCIpID09PSBhdHRySWQ7XG5cdFx0XHR9O1xuXHRcdH07XG5cdH0gZWxzZSB7XG5cdFx0ZGVsZXRlIEV4cHIuZmluZFtcIklEXCJdO1xuXG5cdFx0RXhwci5maWx0ZXJbXCJJRFwiXSA9ICBmdW5jdGlvbiggaWQgKSB7XG5cdFx0XHR2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTtcblx0XHRcdHJldHVybiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdFx0dmFyIG5vZGUgPSB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSBzdHJ1bmRlZmluZWQgJiYgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKFwiaWRcIik7XG5cdFx0XHRcdHJldHVybiBub2RlICYmIG5vZGUudmFsdWUgPT09IGF0dHJJZDtcblx0XHRcdH07XG5cdFx0fTtcblx0fVxuXG5cdEV4cHIuZmluZFtcIlRBR1wiXSA9IHN1cHBvcnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgP1xuXHRcdGZ1bmN0aW9uKCB0YWcsIGNvbnRleHQgKSB7XG5cdFx0XHRpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSBzdHJ1bmRlZmluZWQgKSB7XG5cdFx0XHRcdHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCB0YWcgKTtcblx0XHRcdH1cblx0XHR9IDpcblx0XHRmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkge1xuXHRcdFx0dmFyIGVsZW0sXG5cdFx0XHRcdHRtcCA9IFtdLFxuXHRcdFx0XHRpID0gMCxcblx0XHRcdFx0cmVzdWx0cyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApO1xuXG5cdFx0XHRpZiAoIHRhZyA9PT0gXCIqXCIgKSB7XG5cdFx0XHRcdHdoaWxlICggKGVsZW0gPSByZXN1bHRzW2krK10pICkge1xuXHRcdFx0XHRcdGlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHtcblx0XHRcdFx0XHRcdHRtcC5wdXNoKCBlbGVtICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHRtcDtcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdH07XG5cblx0RXhwci5maW5kW1wiQ0xBU1NcIl0gPSBzdXBwb3J0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgZnVuY3Rpb24oIGNsYXNzTmFtZSwgY29udGV4dCApIHtcblx0XHRpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgIT09IHN0cnVuZGVmaW5lZCAmJiBkb2N1bWVudElzSFRNTCApIHtcblx0XHRcdHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIGNsYXNzTmFtZSApO1xuXHRcdH1cblx0fTtcblxuXHQvKiBRU0EvbWF0Y2hlc1NlbGVjdG9yXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuXG5cdHJidWdneU1hdGNoZXMgPSBbXTtcblxuXHRyYnVnZ3lRU0EgPSBbXTtcblxuXHRpZiAoIChzdXBwb3J0LnFzYSA9IHJuYXRpdmUudGVzdCggZG9jLnF1ZXJ5U2VsZWN0b3JBbGwgKSkgKSB7XG5cdFx0YXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdFx0XHRkaXYuaW5uZXJIVE1MID0gXCI8c2VsZWN0IHQ9Jyc+PG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD5cIjtcblxuXHRcdFx0aWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbChcIlt0Xj0nJ11cIikubGVuZ3RoICkge1xuXHRcdFx0XHRyYnVnZ3lRU0EucHVzaCggXCJbKl4kXT1cIiArIHdoaXRlc3BhY2UgKyBcIiooPzonJ3xcXFwiXFxcIilcIiApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbChcIltzZWxlY3RlZF1cIikubGVuZ3RoICkge1xuXHRcdFx0XHRyYnVnZ3lRU0EucHVzaCggXCJcXFxcW1wiICsgd2hpdGVzcGFjZSArIFwiKig/OnZhbHVlfFwiICsgYm9vbGVhbnMgKyBcIilcIiApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbChcIjpjaGVja2VkXCIpLmxlbmd0aCApIHtcblx0XHRcdFx0cmJ1Z2d5UVNBLnB1c2goXCI6Y2hlY2tlZFwiKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRcdFx0dmFyIGlucHV0ID0gZG9jLmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZSggXCJ0eXBlXCIsIFwiaGlkZGVuXCIgKTtcblx0XHRcdGRpdi5hcHBlbmRDaGlsZCggaW5wdXQgKS5zZXRBdHRyaWJ1dGUoIFwibmFtZVwiLCBcIkRcIiApO1xuXG5cdFx0XHRpZiAoIGRpdi5xdWVyeVNlbGVjdG9yQWxsKFwiW25hbWU9ZF1cIikubGVuZ3RoICkge1xuXHRcdFx0XHRyYnVnZ3lRU0EucHVzaCggXCJuYW1lXCIgKyB3aGl0ZXNwYWNlICsgXCIqWypeJHwhfl0/PVwiICk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKFwiOmVuYWJsZWRcIikubGVuZ3RoICkge1xuXHRcdFx0XHRyYnVnZ3lRU0EucHVzaCggXCI6ZW5hYmxlZFwiLCBcIjpkaXNhYmxlZFwiICk7XG5cdFx0XHR9XG5cblx0XHRcdGRpdi5xdWVyeVNlbGVjdG9yQWxsKFwiKiw6eFwiKTtcblx0XHRcdHJidWdneVFTQS5wdXNoKFwiLC4qOlwiKTtcblx0XHR9KTtcblx0fVxuXG5cdGlmICggKHN1cHBvcnQubWF0Y2hlc1NlbGVjdG9yID0gcm5hdGl2ZS50ZXN0KCAobWF0Y2hlcyA9IGRvY0VsZW0ud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8XG5cdFx0ZG9jRWxlbS5tb3pNYXRjaGVzU2VsZWN0b3IgfHxcblx0XHRkb2NFbGVtLm9NYXRjaGVzU2VsZWN0b3IgfHxcblx0XHRkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSApKSApIHtcblxuXHRcdGFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRcdFx0c3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCA9IG1hdGNoZXMuY2FsbCggZGl2LCBcImRpdlwiICk7XG5cblx0XHRcdG1hdGNoZXMuY2FsbCggZGl2LCBcIltzIT0nJ106eFwiICk7XG5cdFx0XHRyYnVnZ3lNYXRjaGVzLnB1c2goIFwiIT1cIiwgcHNldWRvcyApO1xuXHRcdH0pO1xuXHR9XG5cblx0cmJ1Z2d5UVNBID0gcmJ1Z2d5UVNBLmxlbmd0aCAmJiBuZXcgUmVnRXhwKCByYnVnZ3lRU0Euam9pbihcInxcIikgKTtcblx0cmJ1Z2d5TWF0Y2hlcyA9IHJidWdneU1hdGNoZXMubGVuZ3RoICYmIG5ldyBSZWdFeHAoIHJidWdneU1hdGNoZXMuam9pbihcInxcIikgKTtcblxuXHQvKiBDb250YWluc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cdGhhc0NvbXBhcmUgPSBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24gKTtcblxuXHRjb250YWlucyA9IGhhc0NvbXBhcmUgfHwgcm5hdGl2ZS50ZXN0KCBkb2NFbGVtLmNvbnRhaW5zICkgP1xuXHRcdGZ1bmN0aW9uKCBhLCBiICkge1xuXHRcdFx0dmFyIGFkb3duID0gYS5ub2RlVHlwZSA9PT0gOSA/IGEuZG9jdW1lbnRFbGVtZW50IDogYSxcblx0XHRcdFx0YnVwID0gYiAmJiBiLnBhcmVudE5vZGU7XG5cdFx0XHRyZXR1cm4gYSA9PT0gYnVwIHx8ICEhKCBidXAgJiYgYnVwLm5vZGVUeXBlID09PSAxICYmIChcblx0XHRcdFx0YWRvd24uY29udGFpbnMgP1xuXHRcdFx0XHRcdGFkb3duLmNvbnRhaW5zKCBidXAgKSA6XG5cdFx0XHRcdFx0YS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKCBidXAgKSAmIDE2XG5cdFx0XHQpKTtcblx0XHR9IDpcblx0XHRmdW5jdGlvbiggYSwgYiApIHtcblx0XHRcdGlmICggYiApIHtcblx0XHRcdFx0d2hpbGUgKCAoYiA9IGIucGFyZW50Tm9kZSkgKSB7XG5cdFx0XHRcdFx0aWYgKCBiID09PSBhICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fTtcblxuXHQvKiBTb3J0aW5nXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuXHRzb3J0T3JkZXIgPSBoYXNDb21wYXJlID9cblx0ZnVuY3Rpb24oIGEsIGIgKSB7XG5cblx0XHRpZiAoIGEgPT09IGIgKSB7XG5cdFx0XHRoYXNEdXBsaWNhdGUgPSB0cnVlO1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXG5cdFx0dmFyIGNvbXBhcmUgPSAhYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uO1xuXHRcdGlmICggY29tcGFyZSApIHtcblx0XHRcdHJldHVybiBjb21wYXJlO1xuXHRcdH1cblxuXHRcdGNvbXBhcmUgPSAoIGEub3duZXJEb2N1bWVudCB8fCBhICkgPT09ICggYi5vd25lckRvY3VtZW50IHx8IGIgKSA/XG5cdFx0XHRhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKCBiICkgOlxuXG5cdFx0XHQxO1xuXG5cdFx0aWYgKCBjb21wYXJlICYgMSB8fFxuXHRcdFx0KCFzdXBwb3J0LnNvcnREZXRhY2hlZCAmJiBiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKCBhICkgPT09IGNvbXBhcmUpICkge1xuXG5cdFx0XHRpZiAoIGEgPT09IGRvYyB8fCBhLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGEpICkge1xuXHRcdFx0XHRyZXR1cm4gLTE7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIGIgPT09IGRvYyB8fCBiLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGIpICkge1xuXHRcdFx0XHRyZXR1cm4gMTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNvcnRJbnB1dCA/XG5cdFx0XHRcdCggaW5kZXhPZi5jYWxsKCBzb3J0SW5wdXQsIGEgKSAtIGluZGV4T2YuY2FsbCggc29ydElucHV0LCBiICkgKSA6XG5cdFx0XHRcdDA7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxO1xuXHR9IDpcblx0ZnVuY3Rpb24oIGEsIGIgKSB7XG5cdFx0aWYgKCBhID09PSBiICkge1xuXHRcdFx0aGFzRHVwbGljYXRlID0gdHJ1ZTtcblx0XHRcdHJldHVybiAwO1xuXHRcdH1cblxuXHRcdHZhciBjdXIsXG5cdFx0XHRpID0gMCxcblx0XHRcdGF1cCA9IGEucGFyZW50Tm9kZSxcblx0XHRcdGJ1cCA9IGIucGFyZW50Tm9kZSxcblx0XHRcdGFwID0gWyBhIF0sXG5cdFx0XHRicCA9IFsgYiBdO1xuXG5cdFx0aWYgKCAhYXVwIHx8ICFidXAgKSB7XG5cdFx0XHRyZXR1cm4gYSA9PT0gZG9jID8gLTEgOlxuXHRcdFx0XHRiID09PSBkb2MgPyAxIDpcblx0XHRcdFx0YXVwID8gLTEgOlxuXHRcdFx0XHRidXAgPyAxIDpcblx0XHRcdFx0c29ydElucHV0ID9cblx0XHRcdFx0KCBpbmRleE9mLmNhbGwoIHNvcnRJbnB1dCwgYSApIC0gaW5kZXhPZi5jYWxsKCBzb3J0SW5wdXQsIGIgKSApIDpcblx0XHRcdFx0MDtcblxuXHRcdH0gZWxzZSBpZiAoIGF1cCA9PT0gYnVwICkge1xuXHRcdFx0cmV0dXJuIHNpYmxpbmdDaGVjayggYSwgYiApO1xuXHRcdH1cblxuXHRcdGN1ciA9IGE7XG5cdFx0d2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkge1xuXHRcdFx0YXAudW5zaGlmdCggY3VyICk7XG5cdFx0fVxuXHRcdGN1ciA9IGI7XG5cdFx0d2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkge1xuXHRcdFx0YnAudW5zaGlmdCggY3VyICk7XG5cdFx0fVxuXG5cdFx0d2hpbGUgKCBhcFtpXSA9PT0gYnBbaV0gKSB7XG5cdFx0XHRpKys7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGkgP1xuXHRcdFx0c2libGluZ0NoZWNrKCBhcFtpXSwgYnBbaV0gKSA6XG5cblx0XHRcdGFwW2ldID09PSBwcmVmZXJyZWREb2MgPyAtMSA6XG5cdFx0XHRicFtpXSA9PT0gcHJlZmVycmVkRG9jID8gMSA6XG5cdFx0XHQwO1xuXHR9O1xuXG5cdHJldHVybiBkb2M7XG59O1xuXG5TaXp6bGUubWF0Y2hlcyA9IGZ1bmN0aW9uKCBleHByLCBlbGVtZW50cyApIHtcblx0cmV0dXJuIFNpenpsZSggZXhwciwgbnVsbCwgbnVsbCwgZWxlbWVudHMgKTtcbn07XG5cblNpenpsZS5tYXRjaGVzU2VsZWN0b3IgPSBmdW5jdGlvbiggZWxlbSwgZXhwciApIHtcblx0aWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkge1xuXHRcdHNldERvY3VtZW50KCBlbGVtICk7XG5cdH1cblxuXHRleHByID0gZXhwci5yZXBsYWNlKCByYXR0cmlidXRlUXVvdGVzLCBcIj0nJDEnXVwiICk7XG5cblx0aWYgKCBzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciAmJiBkb2N1bWVudElzSFRNTCAmJlxuXHRcdCggIXJidWdneU1hdGNoZXMgfHwgIXJidWdneU1hdGNoZXMudGVzdCggZXhwciApICkgJiZcblx0XHQoICFyYnVnZ3lRU0EgICAgIHx8ICFyYnVnZ3lRU0EudGVzdCggZXhwciApICkgKSB7XG5cblx0XHR0cnkge1xuXHRcdFx0dmFyIHJldCA9IG1hdGNoZXMuY2FsbCggZWxlbSwgZXhwciApO1xuXG5cdFx0XHRpZiAoIHJldCB8fCBzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoIHx8XG5cdFx0XHRcdFx0ZWxlbS5kb2N1bWVudCAmJiBlbGVtLmRvY3VtZW50Lm5vZGVUeXBlICE9PSAxMSApIHtcblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH1cblx0XHR9IGNhdGNoKGUpIHt9XG5cdH1cblxuXHRyZXR1cm4gU2l6emxlKCBleHByLCBkb2N1bWVudCwgbnVsbCwgW2VsZW1dICkubGVuZ3RoID4gMDtcbn07XG5cblNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBjb250ZXh0LCBlbGVtICkge1xuXHRpZiAoICggY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgKSAhPT0gZG9jdW1lbnQgKSB7XG5cdFx0c2V0RG9jdW1lbnQoIGNvbnRleHQgKTtcblx0fVxuXHRyZXR1cm4gY29udGFpbnMoIGNvbnRleHQsIGVsZW0gKTtcbn07XG5cblNpenpsZS5hdHRyID0gZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7XG5cdGlmICggKCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSApICE9PSBkb2N1bWVudCApIHtcblx0XHRzZXREb2N1bWVudCggZWxlbSApO1xuXHR9XG5cblx0dmFyIGZuID0gRXhwci5hdHRySGFuZGxlWyBuYW1lLnRvTG93ZXJDYXNlKCkgXSxcblx0XHR2YWwgPSBmbiAmJiBoYXNPd24uY2FsbCggRXhwci5hdHRySGFuZGxlLCBuYW1lLnRvTG93ZXJDYXNlKCkgKSA/XG5cdFx0XHRmbiggZWxlbSwgbmFtZSwgIWRvY3VtZW50SXNIVE1MICkgOlxuXHRcdFx0dW5kZWZpbmVkO1xuXG5cdHJldHVybiB2YWwgIT09IHVuZGVmaW5lZCA/XG5cdFx0dmFsIDpcblx0XHRzdXBwb3J0LmF0dHJpYnV0ZXMgfHwgIWRvY3VtZW50SXNIVE1MID9cblx0XHRcdGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICkgOlxuXHRcdFx0KHZhbCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZShuYW1lKSkgJiYgdmFsLnNwZWNpZmllZCA/XG5cdFx0XHRcdHZhbC52YWx1ZSA6XG5cdFx0XHRcdG51bGw7XG59O1xuXG5TaXp6bGUuZXJyb3IgPSBmdW5jdGlvbiggbXNnICkge1xuXHR0aHJvdyBuZXcgRXJyb3IoIFwiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogXCIgKyBtc2cgKTtcbn07XG5cbi8qKlxuICogRG9jdW1lbnQgc29ydGluZyBhbmQgcmVtb3ZpbmcgZHVwbGljYXRlc1xuICogQHBhcmFtIHtBcnJheUxpa2V9IHJlc3VsdHNcbiAqL1xuU2l6emxlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiggcmVzdWx0cyApIHtcblx0dmFyIGVsZW0sXG5cdFx0ZHVwbGljYXRlcyA9IFtdLFxuXHRcdGogPSAwLFxuXHRcdGkgPSAwO1xuXG5cdGhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7XG5cdHNvcnRJbnB1dCA9ICFzdXBwb3J0LnNvcnRTdGFibGUgJiYgcmVzdWx0cy5zbGljZSggMCApO1xuXHRyZXN1bHRzLnNvcnQoIHNvcnRPcmRlciApO1xuXG5cdGlmICggaGFzRHVwbGljYXRlICkge1xuXHRcdHdoaWxlICggKGVsZW0gPSByZXN1bHRzW2krK10pICkge1xuXHRcdFx0aWYgKCBlbGVtID09PSByZXN1bHRzWyBpIF0gKSB7XG5cdFx0XHRcdGogPSBkdXBsaWNhdGVzLnB1c2goIGkgKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0d2hpbGUgKCBqLS0gKSB7XG5cdFx0XHRyZXN1bHRzLnNwbGljZSggZHVwbGljYXRlc1sgaiBdLCAxICk7XG5cdFx0fVxuXHR9XG5cblx0c29ydElucHV0ID0gbnVsbDtcblxuXHRyZXR1cm4gcmVzdWx0cztcbn07XG5cbi8qKlxuICogVXRpbGl0eSBmdW5jdGlvbiBmb3IgcmV0cmlldmluZyB0aGUgdGV4dCB2YWx1ZSBvZiBhbiBhcnJheSBvZiBET00gbm9kZXNcbiAqIEBwYXJhbSB7QXJyYXl8RWxlbWVudH0gZWxlbVxuICovXG5nZXRUZXh0ID0gU2l6emxlLmdldFRleHQgPSBmdW5jdGlvbiggZWxlbSApIHtcblx0dmFyIG5vZGUsXG5cdFx0cmV0ID0gXCJcIixcblx0XHRpID0gMCxcblx0XHRub2RlVHlwZSA9IGVsZW0ubm9kZVR5cGU7XG5cblx0aWYgKCAhbm9kZVR5cGUgKSB7XG5cdFx0d2hpbGUgKCAobm9kZSA9IGVsZW1baSsrXSkgKSB7XG5cdFx0XHRyZXQgKz0gZ2V0VGV4dCggbm9kZSApO1xuXHRcdH1cblx0fSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDkgfHwgbm9kZVR5cGUgPT09IDExICkge1xuXHRcdGlmICggdHlwZW9mIGVsZW0udGV4dENvbnRlbnQgPT09IFwic3RyaW5nXCIgKSB7XG5cdFx0XHRyZXR1cm4gZWxlbS50ZXh0Q29udGVudDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Zm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7XG5cdFx0XHRcdHJldCArPSBnZXRUZXh0KCBlbGVtICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9IGVsc2UgaWYgKCBub2RlVHlwZSA9PT0gMyB8fCBub2RlVHlwZSA9PT0gNCApIHtcblx0XHRyZXR1cm4gZWxlbS5ub2RlVmFsdWU7XG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufTtcblxuRXhwciA9IFNpenpsZS5zZWxlY3RvcnMgPSB7XG5cblx0Y2FjaGVMZW5ndGg6IDUwLFxuXG5cdGNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLFxuXG5cdG1hdGNoOiBtYXRjaEV4cHIsXG5cblx0YXR0ckhhbmRsZToge30sXG5cblx0ZmluZDoge30sXG5cblx0cmVsYXRpdmU6IHtcblx0XHRcIj5cIjogeyBkaXI6IFwicGFyZW50Tm9kZVwiLCBmaXJzdDogdHJ1ZSB9LFxuXHRcdFwiIFwiOiB7IGRpcjogXCJwYXJlbnROb2RlXCIgfSxcblx0XHRcIitcIjogeyBkaXI6IFwicHJldmlvdXNTaWJsaW5nXCIsIGZpcnN0OiB0cnVlIH0sXG5cdFx0XCJ+XCI6IHsgZGlyOiBcInByZXZpb3VzU2libGluZ1wiIH1cblx0fSxcblxuXHRwcmVGaWx0ZXI6IHtcblx0XHRcIkFUVFJcIjogZnVuY3Rpb24oIG1hdGNoICkge1xuXHRcdFx0bWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApO1xuXG5cdFx0XHRtYXRjaFszXSA9ICggbWF0Y2hbNF0gfHwgbWF0Y2hbNV0gfHwgXCJcIiApLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7XG5cblx0XHRcdGlmICggbWF0Y2hbMl0gPT09IFwifj1cIiApIHtcblx0XHRcdFx0bWF0Y2hbM10gPSBcIiBcIiArIG1hdGNoWzNdICsgXCIgXCI7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBtYXRjaC5zbGljZSggMCwgNCApO1xuXHRcdH0sXG5cblx0XHRcIkNISUxEXCI6IGZ1bmN0aW9uKCBtYXRjaCApIHtcblx0XHRcdC8qIG1hdGNoZXMgZnJvbSBtYXRjaEV4cHJbXCJDSElMRFwiXVxuXHRcdFx0XHQxIHR5cGUgKG9ubHl8bnRofC4uLilcblx0XHRcdFx0MiB3aGF0IChjaGlsZHxvZi10eXBlKVxuXHRcdFx0XHQzIGFyZ3VtZW50IChldmVufG9kZHxcXGQqfFxcZCpuKFsrLV1cXGQrKT98Li4uKVxuXHRcdFx0XHQ0IHhuLWNvbXBvbmVudCBvZiB4bit5IGFyZ3VtZW50IChbKy1dP1xcZCpufClcblx0XHRcdFx0NSBzaWduIG9mIHhuLWNvbXBvbmVudFxuXHRcdFx0XHQ2IHggb2YgeG4tY29tcG9uZW50XG5cdFx0XHRcdDcgc2lnbiBvZiB5LWNvbXBvbmVudFxuXHRcdFx0XHQ4IHkgb2YgeS1jb21wb25lbnRcblx0XHRcdCovXG5cdFx0XHRtYXRjaFsxXSA9IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCk7XG5cblx0XHRcdGlmICggbWF0Y2hbMV0uc2xpY2UoIDAsIDMgKSA9PT0gXCJudGhcIiApIHtcblx0XHRcdFx0aWYgKCAhbWF0Y2hbM10gKSB7XG5cdFx0XHRcdFx0U2l6emxlLmVycm9yKCBtYXRjaFswXSApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bWF0Y2hbNF0gPSArKCBtYXRjaFs0XSA/IG1hdGNoWzVdICsgKG1hdGNoWzZdIHx8IDEpIDogMiAqICggbWF0Y2hbM10gPT09IFwiZXZlblwiIHx8IG1hdGNoWzNdID09PSBcIm9kZFwiICkgKTtcblx0XHRcdFx0bWF0Y2hbNV0gPSArKCAoIG1hdGNoWzddICsgbWF0Y2hbOF0gKSB8fCBtYXRjaFszXSA9PT0gXCJvZGRcIiApO1xuXG5cdFx0XHR9IGVsc2UgaWYgKCBtYXRjaFszXSApIHtcblx0XHRcdFx0U2l6emxlLmVycm9yKCBtYXRjaFswXSApO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbWF0Y2g7XG5cdFx0fSxcblxuXHRcdFwiUFNFVURPXCI6IGZ1bmN0aW9uKCBtYXRjaCApIHtcblx0XHRcdHZhciBleGNlc3MsXG5cdFx0XHRcdHVucXVvdGVkID0gIW1hdGNoWzVdICYmIG1hdGNoWzJdO1xuXG5cdFx0XHRpZiAoIG1hdGNoRXhwcltcIkNISUxEXCJdLnRlc3QoIG1hdGNoWzBdICkgKSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIG1hdGNoWzNdICYmIG1hdGNoWzRdICE9PSB1bmRlZmluZWQgKSB7XG5cdFx0XHRcdG1hdGNoWzJdID0gbWF0Y2hbNF07XG5cblx0XHRcdH0gZWxzZSBpZiAoIHVucXVvdGVkICYmIHJwc2V1ZG8udGVzdCggdW5xdW90ZWQgKSAmJlxuXHRcdFx0XHQoZXhjZXNzID0gdG9rZW5pemUoIHVucXVvdGVkLCB0cnVlICkpICYmXG5cdFx0XHRcdChleGNlc3MgPSB1bnF1b3RlZC5pbmRleE9mKCBcIilcIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzICkgLSB1bnF1b3RlZC5sZW5ndGgpICkge1xuXG5cdFx0XHRcdG1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoIDAsIGV4Y2VzcyApO1xuXHRcdFx0XHRtYXRjaFsyXSA9IHVucXVvdGVkLnNsaWNlKCAwLCBleGNlc3MgKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG1hdGNoLnNsaWNlKCAwLCAzICk7XG5cdFx0fVxuXHR9LFxuXG5cdGZpbHRlcjoge1xuXG5cdFx0XCJUQUdcIjogZnVuY3Rpb24oIG5vZGVOYW1lU2VsZWN0b3IgKSB7XG5cdFx0XHR2YXIgbm9kZU5hbWUgPSBub2RlTmFtZVNlbGVjdG9yLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTtcblx0XHRcdHJldHVybiBub2RlTmFtZVNlbGVjdG9yID09PSBcIipcIiA/XG5cdFx0XHRcdGZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfSA6XG5cdFx0XHRcdGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRcdHJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbm9kZU5hbWU7XG5cdFx0XHRcdH07XG5cdFx0fSxcblxuXHRcdFwiQ0xBU1NcIjogZnVuY3Rpb24oIGNsYXNzTmFtZSApIHtcblx0XHRcdHZhciBwYXR0ZXJuID0gY2xhc3NDYWNoZVsgY2xhc3NOYW1lICsgXCIgXCIgXTtcblxuXHRcdFx0cmV0dXJuIHBhdHRlcm4gfHxcblx0XHRcdFx0KHBhdHRlcm4gPSBuZXcgUmVnRXhwKCBcIihefFwiICsgd2hpdGVzcGFjZSArIFwiKVwiICsgY2xhc3NOYW1lICsgXCIoXCIgKyB3aGl0ZXNwYWNlICsgXCJ8JClcIiApKSAmJlxuXHRcdFx0XHRjbGFzc0NhY2hlKCBjbGFzc05hbWUsIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRcdHJldHVybiBwYXR0ZXJuLnRlc3QoIHR5cGVvZiBlbGVtLmNsYXNzTmFtZSA9PT0gXCJzdHJpbmdcIiAmJiBlbGVtLmNsYXNzTmFtZSB8fCB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgIT09IHN0cnVuZGVmaW5lZCAmJiBlbGVtLmdldEF0dHJpYnV0ZShcImNsYXNzXCIpIHx8IFwiXCIgKTtcblx0XHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdFwiQVRUUlwiOiBmdW5jdGlvbiggbmFtZSwgb3BlcmF0b3IsIGNoZWNrICkge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHR2YXIgcmVzdWx0ID0gU2l6emxlLmF0dHIoIGVsZW0sIG5hbWUgKTtcblxuXHRcdFx0XHRpZiAoIHJlc3VsdCA9PSBudWxsICkge1xuXHRcdFx0XHRcdHJldHVybiBvcGVyYXRvciA9PT0gXCIhPVwiO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICggIW9wZXJhdG9yICkge1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVzdWx0ICs9IFwiXCI7XG5cblx0XHRcdFx0cmV0dXJuIG9wZXJhdG9yID09PSBcIj1cIiA/IHJlc3VsdCA9PT0gY2hlY2sgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcIiE9XCIgPyByZXN1bHQgIT09IGNoZWNrIDpcblx0XHRcdFx0XHRvcGVyYXRvciA9PT0gXCJePVwiID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcIio9XCIgPyBjaGVjayAmJiByZXN1bHQuaW5kZXhPZiggY2hlY2sgKSA+IC0xIDpcblx0XHRcdFx0XHRvcGVyYXRvciA9PT0gXCIkPVwiID8gY2hlY2sgJiYgcmVzdWx0LnNsaWNlKCAtY2hlY2subGVuZ3RoICkgPT09IGNoZWNrIDpcblx0XHRcdFx0XHRvcGVyYXRvciA9PT0gXCJ+PVwiID8gKCBcIiBcIiArIHJlc3VsdCArIFwiIFwiICkuaW5kZXhPZiggY2hlY2sgKSA+IC0xIDpcblx0XHRcdFx0XHRvcGVyYXRvciA9PT0gXCJ8PVwiID8gcmVzdWx0ID09PSBjaGVjayB8fCByZXN1bHQuc2xpY2UoIDAsIGNoZWNrLmxlbmd0aCArIDEgKSA9PT0gY2hlY2sgKyBcIi1cIiA6XG5cdFx0XHRcdFx0ZmFsc2U7XG5cdFx0XHR9O1xuXHRcdH0sXG5cblx0XHRcIkNISUxEXCI6IGZ1bmN0aW9uKCB0eXBlLCB3aGF0LCBhcmd1bWVudCwgZmlyc3QsIGxhc3QgKSB7XG5cdFx0XHR2YXIgc2ltcGxlID0gdHlwZS5zbGljZSggMCwgMyApICE9PSBcIm50aFwiLFxuXHRcdFx0XHRmb3J3YXJkID0gdHlwZS5zbGljZSggLTQgKSAhPT0gXCJsYXN0XCIsXG5cdFx0XHRcdG9mVHlwZSA9IHdoYXQgPT09IFwib2YtdHlwZVwiO1xuXG5cdFx0XHRyZXR1cm4gZmlyc3QgPT09IDEgJiYgbGFzdCA9PT0gMCA/XG5cblx0XHRcdFx0ZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdFx0cmV0dXJuICEhZWxlbS5wYXJlbnROb2RlO1xuXHRcdFx0XHR9IDpcblxuXHRcdFx0XHRmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkge1xuXHRcdFx0XHRcdHZhciBjYWNoZSwgb3V0ZXJDYWNoZSwgbm9kZSwgZGlmZiwgbm9kZUluZGV4LCBzdGFydCxcblx0XHRcdFx0XHRcdGRpciA9IHNpbXBsZSAhPT0gZm9yd2FyZCA/IFwibmV4dFNpYmxpbmdcIiA6IFwicHJldmlvdXNTaWJsaW5nXCIsXG5cdFx0XHRcdFx0XHRwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGUsXG5cdFx0XHRcdFx0XHRuYW1lID0gb2ZUeXBlICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSxcblx0XHRcdFx0XHRcdHVzZUNhY2hlID0gIXhtbCAmJiAhb2ZUeXBlO1xuXG5cdFx0XHRcdFx0aWYgKCBwYXJlbnQgKSB7XG5cblx0XHRcdFx0XHRcdGlmICggc2ltcGxlICkge1xuXHRcdFx0XHRcdFx0XHR3aGlsZSAoIGRpciApIHtcblx0XHRcdFx0XHRcdFx0XHRub2RlID0gZWxlbTtcblx0XHRcdFx0XHRcdFx0XHR3aGlsZSAoIChub2RlID0gbm9kZVsgZGlyIF0pICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdHN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gXCJvbmx5XCIgJiYgIXN0YXJ0ICYmIFwibmV4dFNpYmxpbmdcIjtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c3RhcnQgPSBbIGZvcndhcmQgPyBwYXJlbnQuZmlyc3RDaGlsZCA6IHBhcmVudC5sYXN0Q2hpbGQgXTtcblxuXHRcdFx0XHRcdFx0aWYgKCBmb3J3YXJkICYmIHVzZUNhY2hlICkge1xuXHRcdFx0XHRcdFx0XHRvdXRlckNhY2hlID0gcGFyZW50WyBleHBhbmRvIF0gfHwgKHBhcmVudFsgZXhwYW5kbyBdID0ge30pO1xuXHRcdFx0XHRcdFx0XHRjYWNoZSA9IG91dGVyQ2FjaGVbIHR5cGUgXSB8fCBbXTtcblx0XHRcdFx0XHRcdFx0bm9kZUluZGV4ID0gY2FjaGVbMF0gPT09IGRpcnJ1bnMgJiYgY2FjaGVbMV07XG5cdFx0XHRcdFx0XHRcdGRpZmYgPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsyXTtcblx0XHRcdFx0XHRcdFx0bm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1sgbm9kZUluZGV4IF07XG5cblx0XHRcdFx0XHRcdFx0d2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHxcblxuXHRcdFx0XHRcdFx0XHRcdChkaWZmID0gbm9kZUluZGV4ID0gMCkgfHwgc3RhcnQucG9wKCkpICkge1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCBub2RlLm5vZGVUeXBlID09PSAxICYmICsrZGlmZiAmJiBub2RlID09PSBlbGVtICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0b3V0ZXJDYWNoZVsgdHlwZSBdID0gWyBkaXJydW5zLCBub2RlSW5kZXgsIGRpZmYgXTtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKCB1c2VDYWNoZSAmJiAoY2FjaGUgPSAoZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0pICYmIGNhY2hlWzBdID09PSBkaXJydW5zICkge1xuXHRcdFx0XHRcdFx0XHRkaWZmID0gY2FjaGVbMV07XG5cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8XG5cdFx0XHRcdFx0XHRcdFx0KGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAoICggb2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSApICYmICsrZGlmZiApIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmICggdXNlQ2FjaGUgKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdChub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KSlbIHR5cGUgXSA9IFsgZGlycnVucywgZGlmZiBdO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoIG5vZGUgPT09IGVsZW0gKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRkaWZmIC09IGxhc3Q7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZGlmZiA9PT0gZmlyc3QgfHwgKCBkaWZmICUgZmlyc3QgPT09IDAgJiYgZGlmZiAvIGZpcnN0ID49IDAgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0fSxcblxuXHRcdFwiUFNFVURPXCI6IGZ1bmN0aW9uKCBwc2V1ZG8sIGFyZ3VtZW50ICkge1xuXHRcdFx0dmFyIGFyZ3MsXG5cdFx0XHRcdGZuID0gRXhwci5wc2V1ZG9zWyBwc2V1ZG8gXSB8fCBFeHByLnNldEZpbHRlcnNbIHBzZXVkby50b0xvd2VyQ2FzZSgpIF0gfHxcblx0XHRcdFx0XHRTaXp6bGUuZXJyb3IoIFwidW5zdXBwb3J0ZWQgcHNldWRvOiBcIiArIHBzZXVkbyApO1xuXG5cdFx0XHRpZiAoIGZuWyBleHBhbmRvIF0gKSB7XG5cdFx0XHRcdHJldHVybiBmbiggYXJndW1lbnQgKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCBmbi5sZW5ndGggPiAxICkge1xuXHRcdFx0XHRhcmdzID0gWyBwc2V1ZG8sIHBzZXVkbywgXCJcIiwgYXJndW1lbnQgXTtcblx0XHRcdFx0cmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eSggcHNldWRvLnRvTG93ZXJDYXNlKCkgKSA/XG5cdFx0XHRcdFx0bWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkge1xuXHRcdFx0XHRcdFx0dmFyIGlkeCxcblx0XHRcdFx0XHRcdFx0bWF0Y2hlZCA9IGZuKCBzZWVkLCBhcmd1bWVudCApLFxuXHRcdFx0XHRcdFx0XHRpID0gbWF0Y2hlZC5sZW5ndGg7XG5cdFx0XHRcdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0XHRcdFx0aWR4ID0gaW5kZXhPZi5jYWxsKCBzZWVkLCBtYXRjaGVkW2ldICk7XG5cdFx0XHRcdFx0XHRcdHNlZWRbIGlkeCBdID0gISggbWF0Y2hlc1sgaWR4IF0gPSBtYXRjaGVkW2ldICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSkgOlxuXHRcdFx0XHRcdGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZuKCBlbGVtLCAwLCBhcmdzICk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZuO1xuXHRcdH1cblx0fSxcblxuXHRwc2V1ZG9zOiB7XG5cdFx0XCJub3RcIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHtcblx0XHRcdHZhciBpbnB1dCA9IFtdLFxuXHRcdFx0XHRyZXN1bHRzID0gW10sXG5cdFx0XHRcdG1hdGNoZXIgPSBjb21waWxlKCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgXCIkMVwiICkgKTtcblxuXHRcdFx0cmV0dXJuIG1hdGNoZXJbIGV4cGFuZG8gXSA/XG5cdFx0XHRcdG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcywgY29udGV4dCwgeG1sICkge1xuXHRcdFx0XHRcdHZhciBlbGVtLFxuXHRcdFx0XHRcdFx0dW5tYXRjaGVkID0gbWF0Y2hlciggc2VlZCwgbnVsbCwgeG1sLCBbXSApLFxuXHRcdFx0XHRcdFx0aSA9IHNlZWQubGVuZ3RoO1xuXG5cdFx0XHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdFx0XHRpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHtcblx0XHRcdFx0XHRcdFx0c2VlZFtpXSA9ICEobWF0Y2hlc1tpXSA9IGVsZW0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkgOlxuXHRcdFx0XHRmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkge1xuXHRcdFx0XHRcdGlucHV0WzBdID0gZWxlbTtcblx0XHRcdFx0XHRtYXRjaGVyKCBpbnB1dCwgbnVsbCwgeG1sLCByZXN1bHRzICk7XG5cdFx0XHRcdFx0cmV0dXJuICFyZXN1bHRzLnBvcCgpO1xuXHRcdFx0XHR9O1xuXHRcdH0pLFxuXG5cdFx0XCJoYXNcIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHtcblx0XHRcdHJldHVybiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdFx0cmV0dXJuIFNpenpsZSggc2VsZWN0b3IsIGVsZW0gKS5sZW5ndGggPiAwO1xuXHRcdFx0fTtcblx0XHR9KSxcblxuXHRcdFwiY29udGFpbnNcIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCB0ZXh0ICkge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRyZXR1cm4gKCBlbGVtLnRleHRDb250ZW50IHx8IGVsZW0uaW5uZXJUZXh0IHx8IGdldFRleHQoIGVsZW0gKSApLmluZGV4T2YoIHRleHQgKSA+IC0xO1xuXHRcdFx0fTtcblx0XHR9KSxcblxuXHRcdFwibGFuZ1wiOiBtYXJrRnVuY3Rpb24oIGZ1bmN0aW9uKCBsYW5nICkge1xuXHRcdFx0aWYgKCAhcmlkZW50aWZpZXIudGVzdChsYW5nIHx8IFwiXCIpICkge1xuXHRcdFx0XHRTaXp6bGUuZXJyb3IoIFwidW5zdXBwb3J0ZWQgbGFuZzogXCIgKyBsYW5nICk7XG5cdFx0XHR9XG5cdFx0XHRsYW5nID0gbGFuZy5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdHZhciBlbGVtTGFuZztcblx0XHRcdFx0ZG8ge1xuXHRcdFx0XHRcdGlmICggKGVsZW1MYW5nID0gZG9jdW1lbnRJc0hUTUwgP1xuXHRcdFx0XHRcdFx0ZWxlbS5sYW5nIDpcblx0XHRcdFx0XHRcdGVsZW0uZ2V0QXR0cmlidXRlKFwieG1sOmxhbmdcIikgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoXCJsYW5nXCIpKSApIHtcblxuXHRcdFx0XHRcdFx0ZWxlbUxhbmcgPSBlbGVtTGFuZy50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIGVsZW1MYW5nID09PSBsYW5nIHx8IGVsZW1MYW5nLmluZGV4T2YoIGxhbmcgKyBcIi1cIiApID09PSAwO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSB3aGlsZSAoIChlbGVtID0gZWxlbS5wYXJlbnROb2RlKSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICk7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH07XG5cdFx0fSksXG5cblx0XHRcInRhcmdldFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuXHRcdFx0cmV0dXJuIGhhc2ggJiYgaGFzaC5zbGljZSggMSApID09PSBlbGVtLmlkO1xuXHRcdH0sXG5cblx0XHRcInJvb3RcIjogZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRyZXR1cm4gZWxlbSA9PT0gZG9jRWxlbTtcblx0XHR9LFxuXG5cdFx0XCJmb2N1c1wiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBlbGVtID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmICghZG9jdW1lbnQuaGFzRm9jdXMgfHwgZG9jdW1lbnQuaGFzRm9jdXMoKSkgJiYgISEoZWxlbS50eXBlIHx8IGVsZW0uaHJlZiB8fCB+ZWxlbS50YWJJbmRleCk7XG5cdFx0fSxcblxuXHRcdFwiZW5hYmxlZFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBlbGVtLmRpc2FibGVkID09PSBmYWxzZTtcblx0XHR9LFxuXG5cdFx0XCJkaXNhYmxlZFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBlbGVtLmRpc2FibGVkID09PSB0cnVlO1xuXHRcdH0sXG5cblx0XHRcImNoZWNrZWRcIjogZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHR2YXIgbm9kZU5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRyZXR1cm4gKG5vZGVOYW1lID09PSBcImlucHV0XCIgJiYgISFlbGVtLmNoZWNrZWQpIHx8IChub2RlTmFtZSA9PT0gXCJvcHRpb25cIiAmJiAhIWVsZW0uc2VsZWN0ZWQpO1xuXHRcdH0sXG5cblx0XHRcInNlbGVjdGVkXCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0aWYgKCBlbGVtLnBhcmVudE5vZGUgKSB7XG5cdFx0XHRcdGVsZW0ucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZWxlbS5zZWxlY3RlZCA9PT0gdHJ1ZTtcblx0XHR9LFxuXG5cdFx0XCJlbXB0eVwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdGZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkge1xuXHRcdFx0XHRpZiAoIGVsZW0ubm9kZVR5cGUgPCA2ICkge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSxcblxuXHRcdFwicGFyZW50XCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuICFFeHByLnBzZXVkb3NbXCJlbXB0eVwiXSggZWxlbSApO1xuXHRcdH0sXG5cblx0XHRcImhlYWRlclwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiByaGVhZGVyLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTtcblx0XHR9LFxuXG5cdFx0XCJpbnB1dFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiByaW5wdXRzLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTtcblx0XHR9LFxuXG5cdFx0XCJidXR0b25cIjogZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHR2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdHJldHVybiBuYW1lID09PSBcImlucHV0XCIgJiYgZWxlbS50eXBlID09PSBcImJ1dHRvblwiIHx8IG5hbWUgPT09IFwiYnV0dG9uXCI7XG5cdFx0fSxcblxuXHRcdFwidGV4dFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHZhciBhdHRyO1xuXHRcdFx0cmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJpbnB1dFwiICYmXG5cdFx0XHRcdGVsZW0udHlwZSA9PT0gXCJ0ZXh0XCIgJiZcblxuXHRcdFx0XHQoIChhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpKSA9PSBudWxsIHx8IGF0dHIudG9Mb3dlckNhc2UoKSA9PT0gXCJ0ZXh0XCIgKTtcblx0XHR9LFxuXG5cdFx0XCJmaXJzdFwiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIFsgMCBdO1xuXHRcdH0pLFxuXG5cdFx0XCJsYXN0XCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkge1xuXHRcdFx0cmV0dXJuIFsgbGVuZ3RoIC0gMSBdO1xuXHRcdH0pLFxuXG5cdFx0XCJlcVwiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7XG5cdFx0XHRyZXR1cm4gWyBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50IF07XG5cdFx0fSksXG5cblx0XHRcImV2ZW5cIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7XG5cdFx0XHR2YXIgaSA9IDA7XG5cdFx0XHRmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHtcblx0XHRcdFx0bWF0Y2hJbmRleGVzLnB1c2goIGkgKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBtYXRjaEluZGV4ZXM7XG5cdFx0fSksXG5cblx0XHRcIm9kZFwiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHtcblx0XHRcdHZhciBpID0gMTtcblx0XHRcdGZvciAoIDsgaSA8IGxlbmd0aDsgaSArPSAyICkge1xuXHRcdFx0XHRtYXRjaEluZGV4ZXMucHVzaCggaSApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG1hdGNoSW5kZXhlcztcblx0XHR9KSxcblxuXHRcdFwibHRcIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkge1xuXHRcdFx0dmFyIGkgPSBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50O1xuXHRcdFx0Zm9yICggOyAtLWkgPj0gMDsgKSB7XG5cdFx0XHRcdG1hdGNoSW5kZXhlcy5wdXNoKCBpICk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbWF0Y2hJbmRleGVzO1xuXHRcdH0pLFxuXG5cdFx0XCJndFwiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7XG5cdFx0XHR2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7XG5cdFx0XHRmb3IgKCA7ICsraSA8IGxlbmd0aDsgKSB7XG5cdFx0XHRcdG1hdGNoSW5kZXhlcy5wdXNoKCBpICk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbWF0Y2hJbmRleGVzO1xuXHRcdH0pXG5cdH1cbn07XG5cbkV4cHIucHNldWRvc1tcIm50aFwiXSA9IEV4cHIucHNldWRvc1tcImVxXCJdO1xuXG5mb3IgKCBpIGluIHsgcmFkaW86IHRydWUsIGNoZWNrYm94OiB0cnVlLCBmaWxlOiB0cnVlLCBwYXNzd29yZDogdHJ1ZSwgaW1hZ2U6IHRydWUgfSApIHtcblx0RXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVJbnB1dFBzZXVkbyggaSApO1xufVxuZm9yICggaSBpbiB7IHN1Ym1pdDogdHJ1ZSwgcmVzZXQ6IHRydWUgfSApIHtcblx0RXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVCdXR0b25Qc2V1ZG8oIGkgKTtcbn1cblxuZnVuY3Rpb24gc2V0RmlsdGVycygpIHt9XG5zZXRGaWx0ZXJzLnByb3RvdHlwZSA9IEV4cHIuZmlsdGVycyA9IEV4cHIucHNldWRvcztcbkV4cHIuc2V0RmlsdGVycyA9IG5ldyBzZXRGaWx0ZXJzKCk7XG5cbmZ1bmN0aW9uIHRva2VuaXplKCBzZWxlY3RvciwgcGFyc2VPbmx5ICkge1xuXHR2YXIgbWF0Y2hlZCwgbWF0Y2gsIHRva2VucywgdHlwZSxcblx0XHRzb0ZhciwgZ3JvdXBzLCBwcmVGaWx0ZXJzLFxuXHRcdGNhY2hlZCA9IHRva2VuQ2FjaGVbIHNlbGVjdG9yICsgXCIgXCIgXTtcblxuXHRpZiAoIGNhY2hlZCApIHtcblx0XHRyZXR1cm4gcGFyc2VPbmx5ID8gMCA6IGNhY2hlZC5zbGljZSggMCApO1xuXHR9XG5cblx0c29GYXIgPSBzZWxlY3Rvcjtcblx0Z3JvdXBzID0gW107XG5cdHByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjtcblxuXHR3aGlsZSAoIHNvRmFyICkge1xuXG5cdFx0aWYgKCAhbWF0Y2hlZCB8fCAobWF0Y2ggPSByY29tbWEuZXhlYyggc29GYXIgKSkgKSB7XG5cdFx0XHRpZiAoIG1hdGNoICkge1xuXHRcdFx0XHRzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaFswXS5sZW5ndGggKSB8fCBzb0Zhcjtcblx0XHRcdH1cblx0XHRcdGdyb3Vwcy5wdXNoKCAodG9rZW5zID0gW10pICk7XG5cdFx0fVxuXG5cdFx0bWF0Y2hlZCA9IGZhbHNlO1xuXG5cdFx0aWYgKCAobWF0Y2ggPSByY29tYmluYXRvcnMuZXhlYyggc29GYXIgKSkgKSB7XG5cdFx0XHRtYXRjaGVkID0gbWF0Y2guc2hpZnQoKTtcblx0XHRcdHRva2Vucy5wdXNoKHtcblx0XHRcdFx0dmFsdWU6IG1hdGNoZWQsXG5cdFx0XHRcdHR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCBcIiBcIiApXG5cdFx0XHR9KTtcblx0XHRcdHNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoZWQubGVuZ3RoICk7XG5cdFx0fVxuXG5cdFx0Zm9yICggdHlwZSBpbiBFeHByLmZpbHRlciApIHtcblx0XHRcdGlmICggKG1hdGNoID0gbWF0Y2hFeHByWyB0eXBlIF0uZXhlYyggc29GYXIgKSkgJiYgKCFwcmVGaWx0ZXJzWyB0eXBlIF0gfHxcblx0XHRcdFx0KG1hdGNoID0gcHJlRmlsdGVyc1sgdHlwZSBdKCBtYXRjaCApKSkgKSB7XG5cdFx0XHRcdG1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpO1xuXHRcdFx0XHR0b2tlbnMucHVzaCh7XG5cdFx0XHRcdFx0dmFsdWU6IG1hdGNoZWQsXG5cdFx0XHRcdFx0dHlwZTogdHlwZSxcblx0XHRcdFx0XHRtYXRjaGVzOiBtYXRjaFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0c29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoICFtYXRjaGVkICkge1xuXHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHBhcnNlT25seSA/XG5cdFx0c29GYXIubGVuZ3RoIDpcblx0XHRzb0ZhciA/XG5cdFx0XHRTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOlxuXHRcdFx0dG9rZW5DYWNoZSggc2VsZWN0b3IsIGdyb3VwcyApLnNsaWNlKCAwICk7XG59XG5cbmZ1bmN0aW9uIHRvU2VsZWN0b3IoIHRva2VucyApIHtcblx0dmFyIGkgPSAwLFxuXHRcdGxlbiA9IHRva2Vucy5sZW5ndGgsXG5cdFx0c2VsZWN0b3IgPSBcIlwiO1xuXHRmb3IgKCA7IGkgPCBsZW47IGkrKyApIHtcblx0XHRzZWxlY3RvciArPSB0b2tlbnNbaV0udmFsdWU7XG5cdH1cblx0cmV0dXJuIHNlbGVjdG9yO1xufVxuXG5mdW5jdGlvbiBhZGRDb21iaW5hdG9yKCBtYXRjaGVyLCBjb21iaW5hdG9yLCBiYXNlICkge1xuXHR2YXIgZGlyID0gY29tYmluYXRvci5kaXIsXG5cdFx0Y2hlY2tOb25FbGVtZW50cyA9IGJhc2UgJiYgZGlyID09PSBcInBhcmVudE5vZGVcIixcblx0XHRkb25lTmFtZSA9IGRvbmUrKztcblxuXHRyZXR1cm4gY29tYmluYXRvci5maXJzdCA/XG5cdFx0ZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHtcblx0XHRcdHdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgKSB7XG5cdFx0XHRcdGlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkge1xuXHRcdFx0XHRcdHJldHVybiBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gOlxuXG5cdFx0ZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHtcblx0XHRcdHZhciBvbGRDYWNoZSwgb3V0ZXJDYWNoZSxcblx0XHRcdFx0bmV3Q2FjaGUgPSBbIGRpcnJ1bnMsIGRvbmVOYW1lIF07XG5cblx0XHRcdGlmICggeG1sICkge1xuXHRcdFx0XHR3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkge1xuXHRcdFx0XHRcdGlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkge1xuXHRcdFx0XHRcdFx0aWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkge1xuXHRcdFx0XHRcdGlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkge1xuXHRcdFx0XHRcdFx0b3V0ZXJDYWNoZSA9IGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pO1xuXHRcdFx0XHRcdFx0aWYgKCAob2xkQ2FjaGUgPSBvdXRlckNhY2hlWyBkaXIgXSkgJiZcblx0XHRcdFx0XHRcdFx0b2xkQ2FjaGVbIDAgXSA9PT0gZGlycnVucyAmJiBvbGRDYWNoZVsgMSBdID09PSBkb25lTmFtZSApIHtcblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gKG5ld0NhY2hlWyAyIF0gPSBvbGRDYWNoZVsgMiBdKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdG91dGVyQ2FjaGVbIGRpciBdID0gbmV3Q2FjaGU7XG5cblx0XHRcdFx0XHRcdFx0aWYgKCAobmV3Q2FjaGVbIDIgXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApKSApIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG59XG5cbmZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApIHtcblx0cmV0dXJuIG1hdGNoZXJzLmxlbmd0aCA+IDEgP1xuXHRcdGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7XG5cdFx0XHR2YXIgaSA9IG1hdGNoZXJzLmxlbmd0aDtcblx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRpZiAoICFtYXRjaGVyc1tpXSggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9IDpcblx0XHRtYXRjaGVyc1swXTtcbn1cblxuZnVuY3Rpb24gbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IsIGNvbnRleHRzLCByZXN1bHRzICkge1xuXHR2YXIgaSA9IDAsXG5cdFx0bGVuID0gY29udGV4dHMubGVuZ3RoO1xuXHRmb3IgKCA7IGkgPCBsZW47IGkrKyApIHtcblx0XHRTaXp6bGUoIHNlbGVjdG9yLCBjb250ZXh0c1tpXSwgcmVzdWx0cyApO1xuXHR9XG5cdHJldHVybiByZXN1bHRzO1xufVxuXG5mdW5jdGlvbiBjb25kZW5zZSggdW5tYXRjaGVkLCBtYXAsIGZpbHRlciwgY29udGV4dCwgeG1sICkge1xuXHR2YXIgZWxlbSxcblx0XHRuZXdVbm1hdGNoZWQgPSBbXSxcblx0XHRpID0gMCxcblx0XHRsZW4gPSB1bm1hdGNoZWQubGVuZ3RoLFxuXHRcdG1hcHBlZCA9IG1hcCAhPSBudWxsO1xuXG5cdGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xuXHRcdGlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkge1xuXHRcdFx0aWYgKCAhZmlsdGVyIHx8IGZpbHRlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7XG5cdFx0XHRcdG5ld1VubWF0Y2hlZC5wdXNoKCBlbGVtICk7XG5cdFx0XHRcdGlmICggbWFwcGVkICkge1xuXHRcdFx0XHRcdG1hcC5wdXNoKCBpICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gbmV3VW5tYXRjaGVkO1xufVxuXG5mdW5jdGlvbiBzZXRNYXRjaGVyKCBwcmVGaWx0ZXIsIHNlbGVjdG9yLCBtYXRjaGVyLCBwb3N0RmlsdGVyLCBwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IgKSB7XG5cdGlmICggcG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlclsgZXhwYW5kbyBdICkge1xuXHRcdHBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKCBwb3N0RmlsdGVyICk7XG5cdH1cblx0aWYgKCBwb3N0RmluZGVyICYmICFwb3N0RmluZGVyWyBleHBhbmRvIF0gKSB7XG5cdFx0cG9zdEZpbmRlciA9IHNldE1hdGNoZXIoIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApO1xuXHR9XG5cdHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIHJlc3VsdHMsIGNvbnRleHQsIHhtbCApIHtcblx0XHR2YXIgdGVtcCwgaSwgZWxlbSxcblx0XHRcdHByZU1hcCA9IFtdLFxuXHRcdFx0cG9zdE1hcCA9IFtdLFxuXHRcdFx0cHJlZXhpc3RpbmcgPSByZXN1bHRzLmxlbmd0aCxcblxuXHRcdFx0ZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoIHNlbGVjdG9yIHx8IFwiKlwiLCBjb250ZXh0Lm5vZGVUeXBlID8gWyBjb250ZXh0IF0gOiBjb250ZXh0LCBbXSApLFxuXG5cdFx0XHRtYXRjaGVySW4gPSBwcmVGaWx0ZXIgJiYgKCBzZWVkIHx8ICFzZWxlY3RvciApID9cblx0XHRcdFx0Y29uZGVuc2UoIGVsZW1zLCBwcmVNYXAsIHByZUZpbHRlciwgY29udGV4dCwgeG1sICkgOlxuXHRcdFx0XHRlbGVtcyxcblxuXHRcdFx0bWF0Y2hlck91dCA9IG1hdGNoZXIgP1xuXHRcdFx0XHRwb3N0RmluZGVyIHx8ICggc2VlZCA/IHByZUZpbHRlciA6IHByZWV4aXN0aW5nIHx8IHBvc3RGaWx0ZXIgKSA/XG5cblx0XHRcdFx0XHRbXSA6XG5cblx0XHRcdFx0XHRyZXN1bHRzIDpcblx0XHRcdFx0bWF0Y2hlckluO1xuXG5cdFx0aWYgKCBtYXRjaGVyICkge1xuXHRcdFx0bWF0Y2hlciggbWF0Y2hlckluLCBtYXRjaGVyT3V0LCBjb250ZXh0LCB4bWwgKTtcblx0XHR9XG5cblx0XHRpZiAoIHBvc3RGaWx0ZXIgKSB7XG5cdFx0XHR0ZW1wID0gY29uZGVuc2UoIG1hdGNoZXJPdXQsIHBvc3RNYXAgKTtcblx0XHRcdHBvc3RGaWx0ZXIoIHRlbXAsIFtdLCBjb250ZXh0LCB4bWwgKTtcblxuXHRcdFx0aSA9IHRlbXAubGVuZ3RoO1xuXHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdGlmICggKGVsZW0gPSB0ZW1wW2ldKSApIHtcblx0XHRcdFx0XHRtYXRjaGVyT3V0WyBwb3N0TWFwW2ldIF0gPSAhKG1hdGNoZXJJblsgcG9zdE1hcFtpXSBdID0gZWxlbSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIHNlZWQgKSB7XG5cdFx0XHRpZiAoIHBvc3RGaW5kZXIgfHwgcHJlRmlsdGVyICkge1xuXHRcdFx0XHRpZiAoIHBvc3RGaW5kZXIgKSB7XG5cdFx0XHRcdFx0dGVtcCA9IFtdO1xuXHRcdFx0XHRcdGkgPSBtYXRjaGVyT3V0Lmxlbmd0aDtcblx0XHRcdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0XHRcdGlmICggKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSApIHtcblx0XHRcdFx0XHRcdFx0dGVtcC5wdXNoKCAobWF0Y2hlckluW2ldID0gZWxlbSkgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cG9zdEZpbmRlciggbnVsbCwgKG1hdGNoZXJPdXQgPSBbXSksIHRlbXAsIHhtbCApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aSA9IG1hdGNoZXJPdXQubGVuZ3RoO1xuXHRcdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0XHRpZiAoIChlbGVtID0gbWF0Y2hlck91dFtpXSkgJiZcblx0XHRcdFx0XHRcdCh0ZW1wID0gcG9zdEZpbmRlciA/IGluZGV4T2YuY2FsbCggc2VlZCwgZWxlbSApIDogcHJlTWFwW2ldKSA+IC0xICkge1xuXG5cdFx0XHRcdFx0XHRzZWVkW3RlbXBdID0gIShyZXN1bHRzW3RlbXBdID0gZWxlbSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0bWF0Y2hlck91dCA9IGNvbmRlbnNlKFxuXHRcdFx0XHRtYXRjaGVyT3V0ID09PSByZXN1bHRzID9cblx0XHRcdFx0XHRtYXRjaGVyT3V0LnNwbGljZSggcHJlZXhpc3RpbmcsIG1hdGNoZXJPdXQubGVuZ3RoICkgOlxuXHRcdFx0XHRcdG1hdGNoZXJPdXRcblx0XHRcdCk7XG5cdFx0XHRpZiAoIHBvc3RGaW5kZXIgKSB7XG5cdFx0XHRcdHBvc3RGaW5kZXIoIG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cHVzaC5hcHBseSggcmVzdWx0cywgbWF0Y2hlck91dCApO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG59XG5cbmZ1bmN0aW9uIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMgKSB7XG5cdHZhciBjaGVja0NvbnRleHQsIG1hdGNoZXIsIGosXG5cdFx0bGVuID0gdG9rZW5zLmxlbmd0aCxcblx0XHRsZWFkaW5nUmVsYXRpdmUgPSBFeHByLnJlbGF0aXZlWyB0b2tlbnNbMF0udHlwZSBdLFxuXHRcdGltcGxpY2l0UmVsYXRpdmUgPSBsZWFkaW5nUmVsYXRpdmUgfHwgRXhwci5yZWxhdGl2ZVtcIiBcIl0sXG5cdFx0aSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLFxuXG5cdFx0bWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvciggZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRyZXR1cm4gZWxlbSA9PT0gY2hlY2tDb250ZXh0O1xuXHRcdH0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUgKSxcblx0XHRtYXRjaEFueUNvbnRleHQgPSBhZGRDb21iaW5hdG9yKCBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBpbmRleE9mLmNhbGwoIGNoZWNrQ29udGV4dCwgZWxlbSApID4gLTE7XG5cdFx0fSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSApLFxuXHRcdG1hdGNoZXJzID0gWyBmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkge1xuXHRcdFx0cmV0dXJuICggIWxlYWRpbmdSZWxhdGl2ZSAmJiAoIHhtbCB8fCBjb250ZXh0ICE9PSBvdXRlcm1vc3RDb250ZXh0ICkgKSB8fCAoXG5cdFx0XHRcdChjaGVja0NvbnRleHQgPSBjb250ZXh0KS5ub2RlVHlwZSA/XG5cdFx0XHRcdFx0bWF0Y2hDb250ZXh0KCBlbGVtLCBjb250ZXh0LCB4bWwgKSA6XG5cdFx0XHRcdFx0bWF0Y2hBbnlDb250ZXh0KCBlbGVtLCBjb250ZXh0LCB4bWwgKSApO1xuXHRcdH0gXTtcblxuXHRmb3IgKCA7IGkgPCBsZW47IGkrKyApIHtcblx0XHRpZiAoIChtYXRjaGVyID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zW2ldLnR5cGUgXSkgKSB7XG5cdFx0XHRtYXRjaGVycyA9IFsgYWRkQ29tYmluYXRvcihlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKSwgbWF0Y2hlcikgXTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bWF0Y2hlciA9IEV4cHIuZmlsdGVyWyB0b2tlbnNbaV0udHlwZSBdLmFwcGx5KCBudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyApO1xuXG5cdFx0XHRpZiAoIG1hdGNoZXJbIGV4cGFuZG8gXSApIHtcblx0XHRcdFx0aiA9ICsraTtcblx0XHRcdFx0Zm9yICggOyBqIDwgbGVuOyBqKysgKSB7XG5cdFx0XHRcdFx0aWYgKCBFeHByLnJlbGF0aXZlWyB0b2tlbnNbal0udHlwZSBdICkge1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBzZXRNYXRjaGVyKFxuXHRcdFx0XHRcdGkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLFxuXHRcdFx0XHRcdGkgPiAxICYmIHRvU2VsZWN0b3IoXG5cdFx0XHRcdFx0XHR0b2tlbnMuc2xpY2UoIDAsIGkgLSAxICkuY29uY2F0KHsgdmFsdWU6IHRva2Vuc1sgaSAtIDIgXS50eXBlID09PSBcIiBcIiA/IFwiKlwiIDogXCJcIiB9KVxuXHRcdFx0XHRcdCkucmVwbGFjZSggcnRyaW0sIFwiJDFcIiApLFxuXHRcdFx0XHRcdG1hdGNoZXIsXG5cdFx0XHRcdFx0aSA8IGogJiYgbWF0Y2hlckZyb21Ub2tlbnMoIHRva2Vucy5zbGljZSggaSwgaiApICksXG5cdFx0XHRcdFx0aiA8IGxlbiAmJiBtYXRjaGVyRnJvbVRva2VucyggKHRva2VucyA9IHRva2Vucy5zbGljZSggaiApKSApLFxuXHRcdFx0XHRcdGogPCBsZW4gJiYgdG9TZWxlY3RvciggdG9rZW5zIClcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHRcdG1hdGNoZXJzLnB1c2goIG1hdGNoZXIgKTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICk7XG59XG5cbmZ1bmN0aW9uIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApIHtcblx0dmFyIGJ5U2V0ID0gc2V0TWF0Y2hlcnMubGVuZ3RoID4gMCxcblx0XHRieUVsZW1lbnQgPSBlbGVtZW50TWF0Y2hlcnMubGVuZ3RoID4gMCxcblx0XHRzdXBlck1hdGNoZXIgPSBmdW5jdGlvbiggc2VlZCwgY29udGV4dCwgeG1sLCByZXN1bHRzLCBvdXRlcm1vc3QgKSB7XG5cdFx0XHR2YXIgZWxlbSwgaiwgbWF0Y2hlcixcblx0XHRcdFx0bWF0Y2hlZENvdW50ID0gMCxcblx0XHRcdFx0aSA9IFwiMFwiLFxuXHRcdFx0XHR1bm1hdGNoZWQgPSBzZWVkICYmIFtdLFxuXHRcdFx0XHRzZXRNYXRjaGVkID0gW10sXG5cdFx0XHRcdGNvbnRleHRCYWNrdXAgPSBvdXRlcm1vc3RDb250ZXh0LFxuXHRcdFx0XHRlbGVtcyA9IHNlZWQgfHwgYnlFbGVtZW50ICYmIEV4cHIuZmluZFtcIlRBR1wiXSggXCIqXCIsIG91dGVybW9zdCApLFxuXHRcdFx0XHRkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKSxcblx0XHRcdFx0bGVuID0gZWxlbXMubGVuZ3RoO1xuXG5cdFx0XHRpZiAoIG91dGVybW9zdCApIHtcblx0XHRcdFx0b3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7XG5cdFx0XHR9XG5cblx0XHRcdGZvciAoIDsgaSAhPT0gbGVuICYmIChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKyApIHtcblx0XHRcdFx0aWYgKCBieUVsZW1lbnQgJiYgZWxlbSApIHtcblx0XHRcdFx0XHRqID0gMDtcblx0XHRcdFx0XHR3aGlsZSAoIChtYXRjaGVyID0gZWxlbWVudE1hdGNoZXJzW2orK10pICkge1xuXHRcdFx0XHRcdFx0aWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHtcblx0XHRcdFx0XHRcdFx0cmVzdWx0cy5wdXNoKCBlbGVtICk7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoIG91dGVybW9zdCApIHtcblx0XHRcdFx0XHRcdGRpcnJ1bnMgPSBkaXJydW5zVW5pcXVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggYnlTZXQgKSB7XG5cdFx0XHRcdFx0aWYgKCAoZWxlbSA9ICFtYXRjaGVyICYmIGVsZW0pICkge1xuXHRcdFx0XHRcdFx0bWF0Y2hlZENvdW50LS07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWVkICkge1xuXHRcdFx0XHRcdFx0dW5tYXRjaGVkLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0bWF0Y2hlZENvdW50ICs9IGk7XG5cdFx0XHRpZiAoIGJ5U2V0ICYmIGkgIT09IG1hdGNoZWRDb3VudCApIHtcblx0XHRcdFx0aiA9IDA7XG5cdFx0XHRcdHdoaWxlICggKG1hdGNoZXIgPSBzZXRNYXRjaGVyc1tqKytdKSApIHtcblx0XHRcdFx0XHRtYXRjaGVyKCB1bm1hdGNoZWQsIHNldE1hdGNoZWQsIGNvbnRleHQsIHhtbCApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCBzZWVkICkge1xuXHRcdFx0XHRcdGlmICggbWF0Y2hlZENvdW50ID4gMCApIHtcblx0XHRcdFx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRcdFx0XHRpZiAoICEodW5tYXRjaGVkW2ldIHx8IHNldE1hdGNoZWRbaV0pICkge1xuXHRcdFx0XHRcdFx0XHRcdHNldE1hdGNoZWRbaV0gPSBwb3AuY2FsbCggcmVzdWx0cyApO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2V0TWF0Y2hlZCA9IGNvbmRlbnNlKCBzZXRNYXRjaGVkICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7XG5cblx0XHRcdFx0aWYgKCBvdXRlcm1vc3QgJiYgIXNlZWQgJiYgc2V0TWF0Y2hlZC5sZW5ndGggPiAwICYmXG5cdFx0XHRcdFx0KCBtYXRjaGVkQ291bnQgKyBzZXRNYXRjaGVycy5sZW5ndGggKSA+IDEgKSB7XG5cblx0XHRcdFx0XHRTaXp6bGUudW5pcXVlU29ydCggcmVzdWx0cyApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICggb3V0ZXJtb3N0ICkge1xuXHRcdFx0XHRkaXJydW5zID0gZGlycnVuc1VuaXF1ZTtcblx0XHRcdFx0b3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHRCYWNrdXA7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB1bm1hdGNoZWQ7XG5cdFx0fTtcblxuXHRyZXR1cm4gYnlTZXQgP1xuXHRcdG1hcmtGdW5jdGlvbiggc3VwZXJNYXRjaGVyICkgOlxuXHRcdHN1cGVyTWF0Y2hlcjtcbn1cblxuY29tcGlsZSA9IFNpenpsZS5jb21waWxlID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBtYXRjaCAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHtcblx0dmFyIGksXG5cdFx0c2V0TWF0Y2hlcnMgPSBbXSxcblx0XHRlbGVtZW50TWF0Y2hlcnMgPSBbXSxcblx0XHRjYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArIFwiIFwiIF07XG5cblx0aWYgKCAhY2FjaGVkICkge1xuXHRcdGlmICggIW1hdGNoICkge1xuXHRcdFx0bWF0Y2ggPSB0b2tlbml6ZSggc2VsZWN0b3IgKTtcblx0XHR9XG5cdFx0aSA9IG1hdGNoLmxlbmd0aDtcblx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdGNhY2hlZCA9IG1hdGNoZXJGcm9tVG9rZW5zKCBtYXRjaFtpXSApO1xuXHRcdFx0aWYgKCBjYWNoZWRbIGV4cGFuZG8gXSApIHtcblx0XHRcdFx0c2V0TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRlbGVtZW50TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Y2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7XG5cblx0XHRjYWNoZWQuc2VsZWN0b3IgPSBzZWxlY3Rvcjtcblx0fVxuXHRyZXR1cm4gY2FjaGVkO1xufTtcblxuLyoqXG4gKiBBIGxvdy1sZXZlbCBzZWxlY3Rpb24gZnVuY3Rpb24gdGhhdCB3b3JrcyB3aXRoIFNpenpsZSdzIGNvbXBpbGVkXG4gKiAgc2VsZWN0b3IgZnVuY3Rpb25zXG4gKiBAcGFyYW0ge1N0cmluZ3xGdW5jdGlvbn0gc2VsZWN0b3IgQSBzZWxlY3RvciBvciBhIHByZS1jb21waWxlZFxuICogIHNlbGVjdG9yIGZ1bmN0aW9uIGJ1aWx0IHdpdGggU2l6emxlLmNvbXBpbGVcbiAqIEBwYXJhbSB7RWxlbWVudH0gY29udGV4dFxuICogQHBhcmFtIHtBcnJheX0gW3Jlc3VsdHNdXG4gKiBAcGFyYW0ge0FycmF5fSBbc2VlZF0gQSBzZXQgb2YgZWxlbWVudHMgdG8gbWF0Y2ggYWdhaW5zdFxuICovXG5zZWxlY3QgPSBTaXp6bGUuc2VsZWN0ID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICkge1xuXHR2YXIgaSwgdG9rZW5zLCB0b2tlbiwgdHlwZSwgZmluZCxcblx0XHRjb21waWxlZCA9IHR5cGVvZiBzZWxlY3RvciA9PT0gXCJmdW5jdGlvblwiICYmIHNlbGVjdG9yLFxuXHRcdG1hdGNoID0gIXNlZWQgJiYgdG9rZW5pemUoIChzZWxlY3RvciA9IGNvbXBpbGVkLnNlbGVjdG9yIHx8IHNlbGVjdG9yKSApO1xuXG5cdHJlc3VsdHMgPSByZXN1bHRzIHx8IFtdO1xuXG5cdGlmICggbWF0Y2gubGVuZ3RoID09PSAxICkge1xuXG5cdFx0dG9rZW5zID0gbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSggMCApO1xuXHRcdGlmICggdG9rZW5zLmxlbmd0aCA+IDIgJiYgKHRva2VuID0gdG9rZW5zWzBdKS50eXBlID09PSBcIklEXCIgJiZcblx0XHRcdFx0c3VwcG9ydC5nZXRCeUlkICYmIGNvbnRleHQubm9kZVR5cGUgPT09IDkgJiYgZG9jdW1lbnRJc0hUTUwgJiZcblx0XHRcdFx0RXhwci5yZWxhdGl2ZVsgdG9rZW5zWzFdLnR5cGUgXSApIHtcblxuXHRcdFx0Y29udGV4dCA9ICggRXhwci5maW5kW1wiSURcIl0oIHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSksIGNvbnRleHQgKSB8fCBbXSApWzBdO1xuXHRcdFx0aWYgKCAhY29udGV4dCApIHtcblx0XHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cblx0XHRcdH0gZWxzZSBpZiAoIGNvbXBpbGVkICkge1xuXHRcdFx0XHRjb250ZXh0ID0gY29udGV4dC5wYXJlbnROb2RlO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKCB0b2tlbnMuc2hpZnQoKS52YWx1ZS5sZW5ndGggKTtcblx0XHR9XG5cblx0XHRpID0gbWF0Y2hFeHByW1wibmVlZHNDb250ZXh0XCJdLnRlc3QoIHNlbGVjdG9yICkgPyAwIDogdG9rZW5zLmxlbmd0aDtcblx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdHRva2VuID0gdG9rZW5zW2ldO1xuXG5cdFx0XHRpZiAoIEV4cHIucmVsYXRpdmVbICh0eXBlID0gdG9rZW4udHlwZSkgXSApIHtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIChmaW5kID0gRXhwci5maW5kWyB0eXBlIF0pICkge1xuXHRcdFx0XHRpZiAoIChzZWVkID0gZmluZChcblx0XHRcdFx0XHR0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICksXG5cdFx0XHRcdFx0cnNpYmxpbmcudGVzdCggdG9rZW5zWzBdLnR5cGUgKSAmJiB0ZXN0Q29udGV4dCggY29udGV4dC5wYXJlbnROb2RlICkgfHwgY29udGV4dFxuXHRcdFx0XHQpKSApIHtcblxuXHRcdFx0XHRcdHRva2Vucy5zcGxpY2UoIGksIDEgKTtcblx0XHRcdFx0XHRzZWxlY3RvciA9IHNlZWQubGVuZ3RoICYmIHRvU2VsZWN0b3IoIHRva2VucyApO1xuXHRcdFx0XHRcdGlmICggIXNlbGVjdG9yICkge1xuXHRcdFx0XHRcdFx0cHVzaC5hcHBseSggcmVzdWx0cywgc2VlZCApO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQoIGNvbXBpbGVkIHx8IGNvbXBpbGUoIHNlbGVjdG9yLCBtYXRjaCApICkoXG5cdFx0c2VlZCxcblx0XHRjb250ZXh0LFxuXHRcdCFkb2N1bWVudElzSFRNTCxcblx0XHRyZXN1bHRzLFxuXHRcdHJzaWJsaW5nLnRlc3QoIHNlbGVjdG9yICkgJiYgdGVzdENvbnRleHQoIGNvbnRleHQucGFyZW50Tm9kZSApIHx8IGNvbnRleHRcblx0KTtcblx0cmV0dXJuIHJlc3VsdHM7XG59O1xuXG5cbnN1cHBvcnQuc29ydFN0YWJsZSA9IGV4cGFuZG8uc3BsaXQoXCJcIikuc29ydCggc29ydE9yZGVyICkuam9pbihcIlwiKSA9PT0gZXhwYW5kbztcblxuc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzID0gISFoYXNEdXBsaWNhdGU7XG5cbnNldERvY3VtZW50KCk7XG5cbnN1cHBvcnQuc29ydERldGFjaGVkID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYxICkge1xuXHRyZXR1cm4gZGl2MS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSApICYgMTtcbn0pO1xuXG5pZiAoICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHtcblx0ZGl2LmlubmVySFRNTCA9IFwiPGEgaHJlZj0nIyc+PC9hPlwiO1xuXHRyZXR1cm4gZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKSA9PT0gXCIjXCIgO1xufSkgKSB7XG5cdGFkZEhhbmRsZSggXCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoXCIsIGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHtcblx0XHRpZiAoICFpc1hNTCApIHtcblx0XHRcdHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSwgbmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInR5cGVcIiA/IDEgOiAyICk7XG5cdFx0fVxuXHR9KTtcbn1cblxuaWYgKCAhc3VwcG9ydC5hdHRyaWJ1dGVzIHx8ICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHtcblx0ZGl2LmlubmVySFRNTCA9IFwiPGlucHV0Lz5cIjtcblx0ZGl2LmZpcnN0Q2hpbGQuc2V0QXR0cmlidXRlKCBcInZhbHVlXCIsIFwiXCIgKTtcblx0cmV0dXJuIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSggXCJ2YWx1ZVwiICkgPT09IFwiXCI7XG59KSApIHtcblx0YWRkSGFuZGxlKCBcInZhbHVlXCIsIGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHtcblx0XHRpZiAoICFpc1hNTCAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiaW5wdXRcIiApIHtcblx0XHRcdHJldHVybiBlbGVtLmRlZmF1bHRWYWx1ZTtcblx0XHR9XG5cdH0pO1xufVxuXG5pZiAoICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHtcblx0cmV0dXJuIGRpdi5nZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSA9PSBudWxsO1xufSkgKSB7XG5cdGFkZEhhbmRsZSggYm9vbGVhbnMsIGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHtcblx0XHR2YXIgdmFsO1xuXHRcdGlmICggIWlzWE1MICkge1xuXHRcdFx0cmV0dXJuIGVsZW1bIG5hbWUgXSA9PT0gdHJ1ZSA/IG5hbWUudG9Mb3dlckNhc2UoKSA6XG5cdFx0XHRcdFx0KHZhbCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApKSAmJiB2YWwuc3BlY2lmaWVkID9cblx0XHRcdFx0XHR2YWwudmFsdWUgOlxuXHRcdFx0XHRudWxsO1xuXHRcdH1cblx0fSk7XG59XG5cbmlmICggdHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQgKSB7XG5cdGRlZmluZShmdW5jdGlvbigpIHsgcmV0dXJuIFNpenpsZTsgfSk7XG59IGVsc2UgaWYgKCB0eXBlb2YgbW9kdWxlICE9PSBcInVuZGVmaW5lZFwiICYmIG1vZHVsZS5leHBvcnRzICkge1xuXHRtb2R1bGUuZXhwb3J0cyA9IFNpenpsZTtcbn0gZWxzZSB7XG5cdHdpbmRvdy5TaXp6bGUgPSBTaXp6bGU7XG59XG5cbn0pKCB3aW5kb3cgKTtcblxuOyhmdW5jdGlvbihlbmdpbmUpIHtcbiAgdmFyIGV4dGVuZEVsZW1lbnRzID0gUHJvdG90eXBlLlNlbGVjdG9yLmV4dGVuZEVsZW1lbnRzO1xuXG4gIGZ1bmN0aW9uIHNlbGVjdChzZWxlY3Rvciwgc2NvcGUpIHtcbiAgICByZXR1cm4gZXh0ZW5kRWxlbWVudHMoZW5naW5lKHNlbGVjdG9yLCBzY29wZSB8fCBkb2N1bWVudCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gbWF0Y2goZWxlbWVudCwgc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gZW5naW5lLm1hdGNoZXMoc2VsZWN0b3IsIFtlbGVtZW50XSkubGVuZ3RoID09IDE7XG4gIH1cblxuICBQcm90b3R5cGUuU2VsZWN0b3IuZW5naW5lID0gZW5naW5lO1xuICBQcm90b3R5cGUuU2VsZWN0b3Iuc2VsZWN0ID0gc2VsZWN0O1xuICBQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2ggPSBtYXRjaDtcbn0pKFNpenpsZSk7XG5cbndpbmRvdy5TaXp6bGUgPSBQcm90b3R5cGUuX29yaWdpbmFsX3Byb3BlcnR5O1xuZGVsZXRlIFByb3RvdHlwZS5fb3JpZ2luYWxfcHJvcGVydHk7XG5cbnZhciBGb3JtID0ge1xuICByZXNldDogZnVuY3Rpb24oZm9ybSkge1xuICAgIGZvcm0gPSAkKGZvcm0pO1xuICAgIGZvcm0ucmVzZXQoKTtcbiAgICByZXR1cm4gZm9ybTtcbiAgfSxcblxuICBzZXJpYWxpemVFbGVtZW50czogZnVuY3Rpb24oZWxlbWVudHMsIG9wdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgIT0gJ29iamVjdCcpIG9wdGlvbnMgPSB7IGhhc2g6ICEhb3B0aW9ucyB9O1xuICAgIGVsc2UgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChvcHRpb25zLmhhc2gpKSBvcHRpb25zLmhhc2ggPSB0cnVlO1xuICAgIHZhciBrZXksIHZhbHVlLCBzdWJtaXR0ZWQgPSBmYWxzZSwgc3VibWl0ID0gb3B0aW9ucy5zdWJtaXQsIGFjY3VtdWxhdG9yLCBpbml0aWFsO1xuXG4gICAgaWYgKG9wdGlvbnMuaGFzaCkge1xuICAgICAgaW5pdGlhbCA9IHt9O1xuICAgICAgYWNjdW11bGF0b3IgPSBmdW5jdGlvbihyZXN1bHQsIGtleSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKGtleSBpbiByZXN1bHQpIHtcbiAgICAgICAgICBpZiAoIU9iamVjdC5pc0FycmF5KHJlc3VsdFtrZXldKSkgcmVzdWx0W2tleV0gPSBbcmVzdWx0W2tleV1dO1xuICAgICAgICAgIHJlc3VsdFtrZXldID0gcmVzdWx0W2tleV0uY29uY2F0KHZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBpbml0aWFsID0gJyc7XG4gICAgICBhY2N1bXVsYXRvciA9IGZ1bmN0aW9uKHJlc3VsdCwga2V5LCB2YWx1ZXMpIHtcbiAgICAgICAgaWYgKCFPYmplY3QuaXNBcnJheSh2YWx1ZXMpKSB7dmFsdWVzID0gW3ZhbHVlc107fVxuICAgICAgICBpZiAoIXZhbHVlcy5sZW5ndGgpIHtyZXR1cm4gcmVzdWx0O31cbiAgICAgICAgdmFyIGVuY29kZWRLZXkgPSBlbmNvZGVVUklDb21wb25lbnQoa2V5KS5nc3ViKC8lMjAvLCAnKycpO1xuICAgICAgICByZXR1cm4gcmVzdWx0ICsgKHJlc3VsdCA/IFwiJlwiIDogXCJcIikgKyB2YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIHZhbHVlID0gdmFsdWUuZ3N1YigvKFxccik/XFxuLywgJ1xcclxcbicpO1xuICAgICAgICAgIHZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmdzdWIoLyUyMC8sICcrJyk7XG4gICAgICAgICAgcmV0dXJuIGVuY29kZWRLZXkgKyBcIj1cIiArIHZhbHVlO1xuICAgICAgICB9KS5qb2luKFwiJlwiKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnRzLmluamVjdChpbml0aWFsLCBmdW5jdGlvbihyZXN1bHQsIGVsZW1lbnQpIHtcbiAgICAgIGlmICghZWxlbWVudC5kaXNhYmxlZCAmJiBlbGVtZW50Lm5hbWUpIHtcbiAgICAgICAga2V5ID0gZWxlbWVudC5uYW1lOyB2YWx1ZSA9ICQoZWxlbWVudCkuZ2V0VmFsdWUoKTtcbiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgZWxlbWVudC50eXBlICE9ICdmaWxlJyAmJiAoZWxlbWVudC50eXBlICE9ICdzdWJtaXQnIHx8ICghc3VibWl0dGVkICYmXG4gICAgICAgICAgICBzdWJtaXQgIT09IGZhbHNlICYmICghc3VibWl0IHx8IGtleSA9PSBzdWJtaXQpICYmIChzdWJtaXR0ZWQgPSB0cnVlKSkpKSB7XG4gICAgICAgICAgcmVzdWx0ID0gYWNjdW11bGF0b3IocmVzdWx0LCBrZXksIHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9KTtcbiAgfVxufTtcblxuRm9ybS5NZXRob2RzID0ge1xuICBzZXJpYWxpemU6IGZ1bmN0aW9uKGZvcm0sIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gRm9ybS5zZXJpYWxpemVFbGVtZW50cyhGb3JtLmdldEVsZW1lbnRzKGZvcm0pLCBvcHRpb25zKTtcbiAgfSxcblxuXG4gIGdldEVsZW1lbnRzOiBmdW5jdGlvbihmb3JtKSB7XG4gICAgdmFyIGVsZW1lbnRzID0gJChmb3JtKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpO1xuICAgIHZhciBlbGVtZW50LCByZXN1bHRzID0gW10sIHNlcmlhbGl6ZXJzID0gRm9ybS5FbGVtZW50LlNlcmlhbGl6ZXJzO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGVsZW1lbnQgPSBlbGVtZW50c1tpXTsgaSsrKSB7XG4gICAgICBpZiAoc2VyaWFsaXplcnNbZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCldKVxuICAgICAgICByZXN1bHRzLnB1c2goRWxlbWVudC5leHRlbmQoZWxlbWVudCkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfSxcblxuICBnZXRJbnB1dHM6IGZ1bmN0aW9uKGZvcm0sIHR5cGVOYW1lLCBuYW1lKSB7XG4gICAgZm9ybSA9ICQoZm9ybSk7XG4gICAgdmFyIGlucHV0cyA9IGZvcm0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2lucHV0Jyk7XG5cbiAgICBpZiAoIXR5cGVOYW1lICYmICFuYW1lKSByZXR1cm4gJEEoaW5wdXRzKS5tYXAoRWxlbWVudC5leHRlbmQpO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIG1hdGNoaW5nSW5wdXRzID0gW10sIGxlbmd0aCA9IGlucHV0cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGlucHV0ID0gaW5wdXRzW2ldO1xuICAgICAgaWYgKCh0eXBlTmFtZSAmJiBpbnB1dC50eXBlICE9IHR5cGVOYW1lKSB8fCAobmFtZSAmJiBpbnB1dC5uYW1lICE9IG5hbWUpKVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIG1hdGNoaW5nSW5wdXRzLnB1c2goRWxlbWVudC5leHRlbmQoaW5wdXQpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWF0Y2hpbmdJbnB1dHM7XG4gIH0sXG5cbiAgZGlzYWJsZTogZnVuY3Rpb24oZm9ybSkge1xuICAgIGZvcm0gPSAkKGZvcm0pO1xuICAgIEZvcm0uZ2V0RWxlbWVudHMoZm9ybSkuaW52b2tlKCdkaXNhYmxlJyk7XG4gICAgcmV0dXJuIGZvcm07XG4gIH0sXG5cbiAgZW5hYmxlOiBmdW5jdGlvbihmb3JtKSB7XG4gICAgZm9ybSA9ICQoZm9ybSk7XG4gICAgRm9ybS5nZXRFbGVtZW50cyhmb3JtKS5pbnZva2UoJ2VuYWJsZScpO1xuICAgIHJldHVybiBmb3JtO1xuICB9LFxuXG4gIGZpbmRGaXJzdEVsZW1lbnQ6IGZ1bmN0aW9uKGZvcm0pIHtcbiAgICB2YXIgZWxlbWVudHMgPSAkKGZvcm0pLmdldEVsZW1lbnRzKCkuZmluZEFsbChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICByZXR1cm4gJ2hpZGRlbicgIT0gZWxlbWVudC50eXBlICYmICFlbGVtZW50LmRpc2FibGVkO1xuICAgIH0pO1xuICAgIHZhciBmaXJzdEJ5SW5kZXggPSBlbGVtZW50cy5maW5kQWxsKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50Lmhhc0F0dHJpYnV0ZSgndGFiSW5kZXgnKSAmJiBlbGVtZW50LnRhYkluZGV4ID49IDA7XG4gICAgfSkuc29ydEJ5KGZ1bmN0aW9uKGVsZW1lbnQpIHsgcmV0dXJuIGVsZW1lbnQudGFiSW5kZXggfSkuZmlyc3QoKTtcblxuICAgIHJldHVybiBmaXJzdEJ5SW5kZXggPyBmaXJzdEJ5SW5kZXggOiBlbGVtZW50cy5maW5kKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2kudGVzdChlbGVtZW50LnRhZ05hbWUpO1xuICAgIH0pO1xuICB9LFxuXG4gIGZvY3VzRmlyc3RFbGVtZW50OiBmdW5jdGlvbihmb3JtKSB7XG4gICAgZm9ybSA9ICQoZm9ybSk7XG4gICAgdmFyIGVsZW1lbnQgPSBmb3JtLmZpbmRGaXJzdEVsZW1lbnQoKTtcbiAgICBpZiAoZWxlbWVudCkgZWxlbWVudC5hY3RpdmF0ZSgpO1xuICAgIHJldHVybiBmb3JtO1xuICB9LFxuXG4gIHJlcXVlc3Q6IGZ1bmN0aW9uKGZvcm0sIG9wdGlvbnMpIHtcbiAgICBmb3JtID0gJChmb3JtKSwgb3B0aW9ucyA9IE9iamVjdC5jbG9uZShvcHRpb25zIHx8IHsgfSk7XG5cbiAgICB2YXIgcGFyYW1zID0gb3B0aW9ucy5wYXJhbWV0ZXJzLCBhY3Rpb24gPSBmb3JtLnJlYWRBdHRyaWJ1dGUoJ2FjdGlvbicpIHx8ICcnO1xuICAgIGlmIChhY3Rpb24uYmxhbmsoKSkgYWN0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgb3B0aW9ucy5wYXJhbWV0ZXJzID0gZm9ybS5zZXJpYWxpemUodHJ1ZSk7XG5cbiAgICBpZiAocGFyYW1zKSB7XG4gICAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKHBhcmFtcykpIHBhcmFtcyA9IHBhcmFtcy50b1F1ZXJ5UGFyYW1zKCk7XG4gICAgICBPYmplY3QuZXh0ZW5kKG9wdGlvbnMucGFyYW1ldGVycywgcGFyYW1zKTtcbiAgICB9XG5cbiAgICBpZiAoZm9ybS5oYXNBdHRyaWJ1dGUoJ21ldGhvZCcpICYmICFvcHRpb25zLm1ldGhvZClcbiAgICAgIG9wdGlvbnMubWV0aG9kID0gZm9ybS5tZXRob2Q7XG5cbiAgICByZXR1cm4gbmV3IEFqYXguUmVxdWVzdChhY3Rpb24sIG9wdGlvbnMpO1xuICB9XG59O1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXG5Gb3JtLkVsZW1lbnQgPSB7XG4gIGZvY3VzOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgJChlbGVtZW50KS5mb2N1cygpO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9LFxuXG4gIHNlbGVjdDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICQoZWxlbWVudCkuc2VsZWN0KCk7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cbn07XG5cbkZvcm0uRWxlbWVudC5NZXRob2RzID0ge1xuXG4gIHNlcmlhbGl6ZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIGlmICghZWxlbWVudC5kaXNhYmxlZCAmJiBlbGVtZW50Lm5hbWUpIHtcbiAgICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuZ2V0VmFsdWUoKTtcbiAgICAgIGlmICh2YWx1ZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIHBhaXIgPSB7IH07XG4gICAgICAgIHBhaXJbZWxlbWVudC5uYW1lXSA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gT2JqZWN0LnRvUXVlcnlTdHJpbmcocGFpcik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAnJztcbiAgfSxcblxuICBnZXRWYWx1ZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBtZXRob2QgPSBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICByZXR1cm4gRm9ybS5FbGVtZW50LlNlcmlhbGl6ZXJzW21ldGhvZF0oZWxlbWVudCk7XG4gIH0sXG5cbiAgc2V0VmFsdWU6IGZ1bmN0aW9uKGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgdmFyIG1ldGhvZCA9IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIEZvcm0uRWxlbWVudC5TZXJpYWxpemVyc1ttZXRob2RdKGVsZW1lbnQsIHZhbHVlKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfSxcblxuICBjbGVhcjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICQoZWxlbWVudCkudmFsdWUgPSAnJztcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfSxcblxuICBwcmVzZW50OiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgcmV0dXJuICQoZWxlbWVudCkudmFsdWUgIT0gJyc7XG4gIH0sXG5cbiAgYWN0aXZhdGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB0cnkge1xuICAgICAgZWxlbWVudC5mb2N1cygpO1xuICAgICAgaWYgKGVsZW1lbnQuc2VsZWN0ICYmIChlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSAhPSAnaW5wdXQnIHx8XG4gICAgICAgICAgISgvXig/OmJ1dHRvbnxyZXNldHxzdWJtaXQpJC9pLnRlc3QoZWxlbWVudC50eXBlKSkpKVxuICAgICAgICBlbGVtZW50LnNlbGVjdCgpO1xuICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgIHJldHVybiBlbGVtZW50O1xuICB9LFxuXG4gIGRpc2FibGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICBlbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfSxcblxuICBlbmFibGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICBlbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cbn07XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG52YXIgRmllbGQgPSBGb3JtLkVsZW1lbnQ7XG5cbnZhciAkRiA9IEZvcm0uRWxlbWVudC5NZXRob2RzLmdldFZhbHVlO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuRm9ybS5FbGVtZW50LlNlcmlhbGl6ZXJzID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBpbnB1dChlbGVtZW50LCB2YWx1ZSkge1xuICAgIHN3aXRjaCAoZWxlbWVudC50eXBlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgICAgcmV0dXJuIGlucHV0U2VsZWN0b3IoZWxlbWVudCwgdmFsdWUpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHZhbHVlU2VsZWN0b3IoZWxlbWVudCwgdmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGlucHV0U2VsZWN0b3IoZWxlbWVudCwgdmFsdWUpIHtcbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSlcbiAgICAgIHJldHVybiBlbGVtZW50LmNoZWNrZWQgPyBlbGVtZW50LnZhbHVlIDogbnVsbDtcbiAgICBlbHNlIGVsZW1lbnQuY2hlY2tlZCA9ICEhdmFsdWU7XG4gIH1cblxuICBmdW5jdGlvbiB2YWx1ZVNlbGVjdG9yKGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZCh2YWx1ZSkpIHJldHVybiBlbGVtZW50LnZhbHVlO1xuICAgIGVsc2UgZWxlbWVudC52YWx1ZSA9IHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gc2VsZWN0KGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZCh2YWx1ZSkpXG4gICAgICByZXR1cm4gKGVsZW1lbnQudHlwZSA9PT0gJ3NlbGVjdC1vbmUnID8gc2VsZWN0T25lIDogc2VsZWN0TWFueSkoZWxlbWVudCk7XG5cbiAgICB2YXIgb3B0LCBjdXJyZW50VmFsdWUsIHNpbmdsZSA9ICFPYmplY3QuaXNBcnJheSh2YWx1ZSk7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGVsZW1lbnQubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIG9wdCA9IGVsZW1lbnQub3B0aW9uc1tpXTtcbiAgICAgIGN1cnJlbnRWYWx1ZSA9IHRoaXMub3B0aW9uVmFsdWUob3B0KTtcbiAgICAgIGlmIChzaW5nbGUpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSA9PSB2YWx1ZSkge1xuICAgICAgICAgIG9wdC5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIG9wdC5zZWxlY3RlZCA9IHZhbHVlLmluY2x1ZGUoY3VycmVudFZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZWxlY3RPbmUoZWxlbWVudCkge1xuICAgIHZhciBpbmRleCA9IGVsZW1lbnQuc2VsZWN0ZWRJbmRleDtcbiAgICByZXR1cm4gaW5kZXggPj0gMCA/IG9wdGlvblZhbHVlKGVsZW1lbnQub3B0aW9uc1tpbmRleF0pIDogbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNlbGVjdE1hbnkoZWxlbWVudCkge1xuICAgIHZhciB2YWx1ZXMsIGxlbmd0aCA9IGVsZW1lbnQubGVuZ3RoO1xuICAgIGlmICghbGVuZ3RoKSByZXR1cm4gbnVsbDtcblxuICAgIGZvciAodmFyIGkgPSAwLCB2YWx1ZXMgPSBbXTsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgb3B0ID0gZWxlbWVudC5vcHRpb25zW2ldO1xuICAgICAgaWYgKG9wdC5zZWxlY3RlZCkgdmFsdWVzLnB1c2gob3B0aW9uVmFsdWUob3B0KSk7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZXM7XG4gIH1cblxuICBmdW5jdGlvbiBvcHRpb25WYWx1ZShvcHQpIHtcbiAgICByZXR1cm4gRWxlbWVudC5oYXNBdHRyaWJ1dGUob3B0LCAndmFsdWUnKSA/IG9wdC52YWx1ZSA6IG9wdC50ZXh0O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpbnB1dDogICAgICAgICBpbnB1dCxcbiAgICBpbnB1dFNlbGVjdG9yOiBpbnB1dFNlbGVjdG9yLFxuICAgIHRleHRhcmVhOiAgICAgIHZhbHVlU2VsZWN0b3IsXG4gICAgc2VsZWN0OiAgICAgICAgc2VsZWN0LFxuICAgIHNlbGVjdE9uZTogICAgIHNlbGVjdE9uZSxcbiAgICBzZWxlY3RNYW55OiAgICBzZWxlY3RNYW55LFxuICAgIG9wdGlvblZhbHVlOiAgIG9wdGlvblZhbHVlLFxuICAgIGJ1dHRvbjogICAgICAgIHZhbHVlU2VsZWN0b3JcbiAgfTtcbn0pKCk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cbkFic3RyYWN0LlRpbWVkT2JzZXJ2ZXIgPSBDbGFzcy5jcmVhdGUoUGVyaW9kaWNhbEV4ZWN1dGVyLCB7XG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKCRzdXBlciwgZWxlbWVudCwgZnJlcXVlbmN5LCBjYWxsYmFjaykge1xuICAgICRzdXBlcihjYWxsYmFjaywgZnJlcXVlbmN5KTtcbiAgICB0aGlzLmVsZW1lbnQgICA9ICQoZWxlbWVudCk7XG4gICAgdGhpcy5sYXN0VmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gIH0sXG5cbiAgZXhlY3V0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpO1xuICAgIGlmIChPYmplY3QuaXNTdHJpbmcodGhpcy5sYXN0VmFsdWUpICYmIE9iamVjdC5pc1N0cmluZyh2YWx1ZSkgP1xuICAgICAgICB0aGlzLmxhc3RWYWx1ZSAhPSB2YWx1ZSA6IFN0cmluZyh0aGlzLmxhc3RWYWx1ZSkgIT0gU3RyaW5nKHZhbHVlKSkge1xuICAgICAgdGhpcy5jYWxsYmFjayh0aGlzLmVsZW1lbnQsIHZhbHVlKTtcbiAgICAgIHRoaXMubGFzdFZhbHVlID0gdmFsdWU7XG4gICAgfVxuICB9XG59KTtcblxuRm9ybS5FbGVtZW50Lk9ic2VydmVyID0gQ2xhc3MuY3JlYXRlKEFic3RyYWN0LlRpbWVkT2JzZXJ2ZXIsIHtcbiAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBGb3JtLkVsZW1lbnQuZ2V0VmFsdWUodGhpcy5lbGVtZW50KTtcbiAgfVxufSk7XG5cbkZvcm0uT2JzZXJ2ZXIgPSBDbGFzcy5jcmVhdGUoQWJzdHJhY3QuVGltZWRPYnNlcnZlciwge1xuICBnZXRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIEZvcm0uc2VyaWFsaXplKHRoaXMuZWxlbWVudCk7XG4gIH1cbn0pO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuQWJzdHJhY3QuRXZlbnRPYnNlcnZlciA9IENsYXNzLmNyZWF0ZSh7XG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsZW1lbnQsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5lbGVtZW50ICA9ICQoZWxlbWVudCk7XG4gICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuXG4gICAgdGhpcy5sYXN0VmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgaWYgKHRoaXMuZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gJ2Zvcm0nKVxuICAgICAgdGhpcy5yZWdpc3RlckZvcm1DYWxsYmFja3MoKTtcbiAgICBlbHNlXG4gICAgICB0aGlzLnJlZ2lzdGVyQ2FsbGJhY2sodGhpcy5lbGVtZW50KTtcbiAgfSxcblxuICBvbkVsZW1lbnRFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpO1xuICAgIGlmICh0aGlzLmxhc3RWYWx1ZSAhPSB2YWx1ZSkge1xuICAgICAgdGhpcy5jYWxsYmFjayh0aGlzLmVsZW1lbnQsIHZhbHVlKTtcbiAgICAgIHRoaXMubGFzdFZhbHVlID0gdmFsdWU7XG4gICAgfVxuICB9LFxuXG4gIHJlZ2lzdGVyRm9ybUNhbGxiYWNrczogZnVuY3Rpb24oKSB7XG4gICAgRm9ybS5nZXRFbGVtZW50cyh0aGlzLmVsZW1lbnQpLmVhY2godGhpcy5yZWdpc3RlckNhbGxiYWNrLCB0aGlzKTtcbiAgfSxcblxuICByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQudHlwZSkge1xuICAgICAgc3dpdGNoIChlbGVtZW50LnR5cGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICBjYXNlICdjaGVja2JveCc6XG4gICAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgICAgICBFdmVudC5vYnNlcnZlKGVsZW1lbnQsICdjbGljaycsIHRoaXMub25FbGVtZW50RXZlbnQuYmluZCh0aGlzKSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgRXZlbnQub2JzZXJ2ZShlbGVtZW50LCAnY2hhbmdlJywgdGhpcy5vbkVsZW1lbnRFdmVudC5iaW5kKHRoaXMpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5Gb3JtLkVsZW1lbnQuRXZlbnRPYnNlcnZlciA9IENsYXNzLmNyZWF0ZShBYnN0cmFjdC5FdmVudE9ic2VydmVyLCB7XG4gIGdldFZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gRm9ybS5FbGVtZW50LmdldFZhbHVlKHRoaXMuZWxlbWVudCk7XG4gIH1cbn0pO1xuXG5Gb3JtLkV2ZW50T2JzZXJ2ZXIgPSBDbGFzcy5jcmVhdGUoQWJzdHJhY3QuRXZlbnRPYnNlcnZlciwge1xuICBnZXRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIEZvcm0uc2VyaWFsaXplKHRoaXMuZWxlbWVudCk7XG4gIH1cbn0pO1xuKGZ1bmN0aW9uKEdMT0JBTCkge1xuICB2YXIgRElWID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHZhciBkb2NFbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgdmFyIE1PVVNFRU5URVJfTU9VU0VMRUFWRV9FVkVOVFNfU1VQUE9SVEVEID0gJ29ubW91c2VlbnRlcicgaW4gZG9jRWxcbiAgICYmICdvbm1vdXNlbGVhdmUnIGluIGRvY0VsO1xuXG4gIHZhciBFdmVudCA9IHtcbiAgICBLRVlfQkFDS1NQQUNFOiA4LFxuICAgIEtFWV9UQUI6ICAgICAgIDksXG4gICAgS0VZX1JFVFVSTjogICAxMyxcbiAgICBLRVlfRVNDOiAgICAgIDI3LFxuICAgIEtFWV9MRUZUOiAgICAgMzcsXG4gICAgS0VZX1VQOiAgICAgICAzOCxcbiAgICBLRVlfUklHSFQ6ICAgIDM5LFxuICAgIEtFWV9ET1dOOiAgICAgNDAsXG4gICAgS0VZX0RFTEVURTogICA0NixcbiAgICBLRVlfSE9NRTogICAgIDM2LFxuICAgIEtFWV9FTkQ6ICAgICAgMzUsXG4gICAgS0VZX1BBR0VVUDogICAzMyxcbiAgICBLRVlfUEFHRURPV046IDM0LFxuICAgIEtFWV9JTlNFUlQ6ICAgNDVcbiAgfTtcblxuXG4gIHZhciBpc0lFTGVnYWN5RXZlbnQgPSBmdW5jdGlvbihldmVudCkgeyByZXR1cm4gZmFsc2U7IH07XG5cbiAgaWYgKHdpbmRvdy5hdHRhY2hFdmVudCkge1xuICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgaXNJRUxlZ2FjeUV2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuICEoZXZlbnQgaW5zdGFuY2VvZiB3aW5kb3cuRXZlbnQpO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgaXNJRUxlZ2FjeUV2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHsgcmV0dXJuIHRydWU7IH07XG4gICAgfVxuICB9XG5cbiAgdmFyIF9pc0J1dHRvbjtcblxuICBmdW5jdGlvbiBfaXNCdXR0b25Gb3JET01FdmVudHMoZXZlbnQsIGNvZGUpIHtcbiAgICByZXR1cm4gZXZlbnQud2hpY2ggPyAoZXZlbnQud2hpY2ggPT09IGNvZGUgKyAxKSA6IChldmVudC5idXR0b24gPT09IGNvZGUpO1xuICB9XG5cbiAgdmFyIGxlZ2FjeUJ1dHRvbk1hcCA9IHsgMDogMSwgMTogNCwgMjogMiB9O1xuICBmdW5jdGlvbiBfaXNCdXR0b25Gb3JMZWdhY3lFdmVudHMoZXZlbnQsIGNvZGUpIHtcbiAgICByZXR1cm4gZXZlbnQuYnV0dG9uID09PSBsZWdhY3lCdXR0b25NYXBbY29kZV07XG4gIH1cblxuICBmdW5jdGlvbiBfaXNCdXR0b25Gb3JXZWJLaXQoZXZlbnQsIGNvZGUpIHtcbiAgICBzd2l0Y2ggKGNvZGUpIHtcbiAgICAgIGNhc2UgMDogcmV0dXJuIGV2ZW50LndoaWNoID09IDEgJiYgIWV2ZW50Lm1ldGFLZXk7XG4gICAgICBjYXNlIDE6IHJldHVybiBldmVudC53aGljaCA9PSAyIHx8IChldmVudC53aGljaCA9PSAxICYmIGV2ZW50Lm1ldGFLZXkpO1xuICAgICAgY2FzZSAyOiByZXR1cm4gZXZlbnQud2hpY2ggPT0gMztcbiAgICAgIGRlZmF1bHQ6IHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBpZiAod2luZG93LmF0dGFjaEV2ZW50KSB7XG4gICAgaWYgKCF3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgX2lzQnV0dG9uID0gX2lzQnV0dG9uRm9yTGVnYWN5RXZlbnRzO1xuICAgIH0gZWxzZSB7XG4gICAgICBfaXNCdXR0b24gPSBmdW5jdGlvbihldmVudCwgY29kZSkge1xuICAgICAgICByZXR1cm4gaXNJRUxlZ2FjeUV2ZW50KGV2ZW50KSA/IF9pc0J1dHRvbkZvckxlZ2FjeUV2ZW50cyhldmVudCwgY29kZSkgOlxuICAgICAgICAgX2lzQnV0dG9uRm9yRE9NRXZlbnRzKGV2ZW50LCBjb2RlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAoUHJvdG90eXBlLkJyb3dzZXIuV2ViS2l0KSB7XG4gICAgX2lzQnV0dG9uID0gX2lzQnV0dG9uRm9yV2ViS2l0O1xuICB9IGVsc2Uge1xuICAgIF9pc0J1dHRvbiA9IF9pc0J1dHRvbkZvckRPTUV2ZW50cztcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzTGVmdENsaWNrKGV2ZW50KSAgIHsgcmV0dXJuIF9pc0J1dHRvbihldmVudCwgMCkgfVxuXG4gIGZ1bmN0aW9uIGlzTWlkZGxlQ2xpY2soZXZlbnQpIHsgcmV0dXJuIF9pc0J1dHRvbihldmVudCwgMSkgfVxuXG4gIGZ1bmN0aW9uIGlzUmlnaHRDbGljayhldmVudCkgIHsgcmV0dXJuIF9pc0J1dHRvbihldmVudCwgMikgfVxuXG4gIGZ1bmN0aW9uIGVsZW1lbnQoZXZlbnQpIHtcbiAgICByZXR1cm4gRWxlbWVudC5leHRlbmQoX2VsZW1lbnQoZXZlbnQpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9lbGVtZW50KGV2ZW50KSB7XG4gICAgZXZlbnQgPSBFdmVudC5leHRlbmQoZXZlbnQpO1xuXG4gICAgdmFyIG5vZGUgPSBldmVudC50YXJnZXQsIHR5cGUgPSBldmVudC50eXBlLFxuICAgICBjdXJyZW50VGFyZ2V0ID0gZXZlbnQuY3VycmVudFRhcmdldDtcblxuICAgIGlmIChjdXJyZW50VGFyZ2V0ICYmIGN1cnJlbnRUYXJnZXQudGFnTmFtZSkge1xuICAgICAgaWYgKHR5cGUgPT09ICdsb2FkJyB8fCB0eXBlID09PSAnZXJyb3InIHx8XG4gICAgICAgICh0eXBlID09PSAnY2xpY2snICYmIGN1cnJlbnRUYXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnXG4gICAgICAgICAgJiYgY3VycmVudFRhcmdldC50eXBlID09PSAncmFkaW8nKSlcbiAgICAgICAgICAgIG5vZGUgPSBjdXJyZW50VGFyZ2V0O1xuICAgIH1cblxuICAgIHJldHVybiBub2RlLm5vZGVUeXBlID09IE5vZGUuVEVYVF9OT0RFID8gbm9kZS5wYXJlbnROb2RlIDogbm9kZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRFbGVtZW50KGV2ZW50LCBleHByZXNzaW9uKSB7XG4gICAgdmFyIGVsZW1lbnQgPSBfZWxlbWVudChldmVudCksIHNlbGVjdG9yID0gUHJvdG90eXBlLlNlbGVjdG9yO1xuICAgIGlmICghZXhwcmVzc2lvbikgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpO1xuICAgIHdoaWxlIChlbGVtZW50KSB7XG4gICAgICBpZiAoT2JqZWN0LmlzRWxlbWVudChlbGVtZW50KSAmJiBzZWxlY3Rvci5tYXRjaChlbGVtZW50LCBleHByZXNzaW9uKSlcbiAgICAgICAgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpO1xuICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwb2ludGVyKGV2ZW50KSB7XG4gICAgcmV0dXJuIHsgeDogcG9pbnRlclgoZXZlbnQpLCB5OiBwb2ludGVyWShldmVudCkgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvaW50ZXJYKGV2ZW50KSB7XG4gICAgdmFyIGRvY0VsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsXG4gICAgIGJvZHkgPSBkb2N1bWVudC5ib2R5IHx8IHsgc2Nyb2xsTGVmdDogMCB9O1xuXG4gICAgcmV0dXJuIGV2ZW50LnBhZ2VYIHx8IChldmVudC5jbGllbnRYICtcbiAgICAgIChkb2NFbGVtZW50LnNjcm9sbExlZnQgfHwgYm9keS5zY3JvbGxMZWZ0KSAtXG4gICAgICAoZG9jRWxlbWVudC5jbGllbnRMZWZ0IHx8IDApKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvaW50ZXJZKGV2ZW50KSB7XG4gICAgdmFyIGRvY0VsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsXG4gICAgIGJvZHkgPSBkb2N1bWVudC5ib2R5IHx8IHsgc2Nyb2xsVG9wOiAwIH07XG5cbiAgICByZXR1cm4gIGV2ZW50LnBhZ2VZIHx8IChldmVudC5jbGllbnRZICtcbiAgICAgICAoZG9jRWxlbWVudC5zY3JvbGxUb3AgfHwgYm9keS5zY3JvbGxUb3ApIC1cbiAgICAgICAoZG9jRWxlbWVudC5jbGllbnRUb3AgfHwgMCkpO1xuICB9XG5cblxuICBmdW5jdGlvbiBzdG9wKGV2ZW50KSB7XG4gICAgRXZlbnQuZXh0ZW5kKGV2ZW50KTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgZXZlbnQuc3RvcHBlZCA9IHRydWU7XG4gIH1cblxuXG4gIEV2ZW50Lk1ldGhvZHMgPSB7XG4gICAgaXNMZWZ0Q2xpY2s6ICAgaXNMZWZ0Q2xpY2ssXG4gICAgaXNNaWRkbGVDbGljazogaXNNaWRkbGVDbGljayxcbiAgICBpc1JpZ2h0Q2xpY2s6ICBpc1JpZ2h0Q2xpY2ssXG5cbiAgICBlbGVtZW50OiAgICAgZWxlbWVudCxcbiAgICBmaW5kRWxlbWVudDogZmluZEVsZW1lbnQsXG5cbiAgICBwb2ludGVyOiAgcG9pbnRlcixcbiAgICBwb2ludGVyWDogcG9pbnRlclgsXG4gICAgcG9pbnRlclk6IHBvaW50ZXJZLFxuXG4gICAgc3RvcDogc3RvcFxuICB9O1xuXG4gIHZhciBtZXRob2RzID0gT2JqZWN0LmtleXMoRXZlbnQuTWV0aG9kcykuaW5qZWN0KHsgfSwgZnVuY3Rpb24obSwgbmFtZSkge1xuICAgIG1bbmFtZV0gPSBFdmVudC5NZXRob2RzW25hbWVdLm1ldGhvZGl6ZSgpO1xuICAgIHJldHVybiBtO1xuICB9KTtcblxuICBpZiAod2luZG93LmF0dGFjaEV2ZW50KSB7XG4gICAgZnVuY3Rpb24gX3JlbGF0ZWRUYXJnZXQoZXZlbnQpIHtcbiAgICAgIHZhciBlbGVtZW50O1xuICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgICAgIGNhc2UgJ21vdXNlb3Zlcic6XG4gICAgICAgIGNhc2UgJ21vdXNlZW50ZXInOlxuICAgICAgICAgIGVsZW1lbnQgPSBldmVudC5mcm9tRWxlbWVudDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbW91c2VvdXQnOlxuICAgICAgICBjYXNlICdtb3VzZWxlYXZlJzpcbiAgICAgICAgICBlbGVtZW50ID0gZXZlbnQudG9FbGVtZW50O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpO1xuICAgIH1cblxuICAgIHZhciBhZGRpdGlvbmFsTWV0aG9kcyA9IHtcbiAgICAgIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7IHRoaXMuY2FuY2VsQnViYmxlID0gdHJ1ZSB9LFxuICAgICAgcHJldmVudERlZmF1bHQ6ICBmdW5jdGlvbigpIHsgdGhpcy5yZXR1cm5WYWx1ZSA9IGZhbHNlIH0sXG4gICAgICBpbnNwZWN0OiBmdW5jdGlvbigpIHsgcmV0dXJuICdbb2JqZWN0IEV2ZW50XScgfVxuICAgIH07XG5cbiAgICBFdmVudC5leHRlbmQgPSBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgaWYgKCFldmVudCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBpZiAoIWlzSUVMZWdhY3lFdmVudChldmVudCkpIHJldHVybiBldmVudDtcblxuICAgICAgaWYgKGV2ZW50Ll9leHRlbmRlZEJ5UHJvdG90eXBlKSByZXR1cm4gZXZlbnQ7XG4gICAgICBldmVudC5fZXh0ZW5kZWRCeVByb3RvdHlwZSA9IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uO1xuXG4gICAgICB2YXIgcG9pbnRlciA9IEV2ZW50LnBvaW50ZXIoZXZlbnQpO1xuXG4gICAgICBPYmplY3QuZXh0ZW5kKGV2ZW50LCB7XG4gICAgICAgIHRhcmdldDogZXZlbnQuc3JjRWxlbWVudCB8fCBlbGVtZW50LFxuICAgICAgICByZWxhdGVkVGFyZ2V0OiBfcmVsYXRlZFRhcmdldChldmVudCksXG4gICAgICAgIHBhZ2VYOiAgcG9pbnRlci54LFxuICAgICAgICBwYWdlWTogIHBvaW50ZXIueVxuICAgICAgfSk7XG5cbiAgICAgIE9iamVjdC5leHRlbmQoZXZlbnQsIG1ldGhvZHMpO1xuICAgICAgT2JqZWN0LmV4dGVuZChldmVudCwgYWRkaXRpb25hbE1ldGhvZHMpO1xuXG4gICAgICByZXR1cm4gZXZlbnQ7XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBFdmVudC5leHRlbmQgPSBQcm90b3R5cGUuSztcbiAgfVxuXG4gIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgIEV2ZW50LnByb3RvdHlwZSA9IHdpbmRvdy5FdmVudC5wcm90b3R5cGUgfHwgZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0hUTUxFdmVudHMnKS5fX3Byb3RvX187XG4gICAgT2JqZWN0LmV4dGVuZChFdmVudC5wcm90b3R5cGUsIG1ldGhvZHMpO1xuICB9XG5cbiAgdmFyIEVWRU5UX1RSQU5TTEFUSU9OUyA9IHtcbiAgICBtb3VzZWVudGVyOiAnbW91c2VvdmVyJyxcbiAgICBtb3VzZWxlYXZlOiAnbW91c2VvdXQnXG4gIH07XG5cbiAgZnVuY3Rpb24gZ2V0RE9NRXZlbnROYW1lKGV2ZW50TmFtZSkge1xuICAgIHJldHVybiBFVkVOVF9UUkFOU0xBVElPTlNbZXZlbnROYW1lXSB8fCBldmVudE5hbWU7XG4gIH1cblxuICBpZiAoTU9VU0VFTlRFUl9NT1VTRUxFQVZFX0VWRU5UU19TVVBQT1JURUQpXG4gICAgZ2V0RE9NRXZlbnROYW1lID0gUHJvdG90eXBlLks7XG5cbiAgZnVuY3Rpb24gZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudCA9PT0gd2luZG93KSByZXR1cm4gMDtcblxuICAgIGlmICh0eXBlb2YgZWxlbWVudC5fcHJvdG90eXBlVUlEID09PSAndW5kZWZpbmVkJylcbiAgICAgIGVsZW1lbnQuX3Byb3RvdHlwZVVJRCA9IEVsZW1lbnQuU3RvcmFnZS5VSUQrKztcbiAgICByZXR1cm4gZWxlbWVudC5fcHJvdG90eXBlVUlEO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VW5pcXVlRWxlbWVudElEX0lFKGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudCA9PT0gd2luZG93KSByZXR1cm4gMDtcbiAgICBpZiAoZWxlbWVudCA9PSBkb2N1bWVudCkgcmV0dXJuIDE7XG4gICAgcmV0dXJuIGVsZW1lbnQudW5pcXVlSUQ7XG4gIH1cblxuICBpZiAoJ3VuaXF1ZUlEJyBpbiBESVYpXG4gICAgZ2V0VW5pcXVlRWxlbWVudElEID0gZ2V0VW5pcXVlRWxlbWVudElEX0lFO1xuXG4gIGZ1bmN0aW9uIGlzQ3VzdG9tRXZlbnQoZXZlbnROYW1lKSB7XG4gICAgcmV0dXJuIGV2ZW50TmFtZS5pbmNsdWRlKCc6Jyk7XG4gIH1cblxuICBFdmVudC5faXNDdXN0b21FdmVudCA9IGlzQ3VzdG9tRXZlbnQ7XG5cbiAgZnVuY3Rpb24gZ2V0UmVnaXN0cnlGb3JFbGVtZW50KGVsZW1lbnQsIHVpZCkge1xuICAgIHZhciBDQUNIRSA9IEdMT0JBTC5FdmVudC5jYWNoZTtcbiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKHVpZCkpXG4gICAgICB1aWQgPSBnZXRVbmlxdWVFbGVtZW50SUQoZWxlbWVudCk7XG4gICAgaWYgKCFDQUNIRVt1aWRdKSBDQUNIRVt1aWRdID0geyBlbGVtZW50OiBlbGVtZW50IH07XG4gICAgcmV0dXJuIENBQ0hFW3VpZF07XG4gIH1cblxuICBmdW5jdGlvbiBkZXN0cm95UmVnaXN0cnlGb3JFbGVtZW50KGVsZW1lbnQsIHVpZCkge1xuICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQodWlkKSlcbiAgICAgIHVpZCA9IGdldFVuaXF1ZUVsZW1lbnRJRChlbGVtZW50KTtcbiAgICBkZWxldGUgR0xPQkFMLkV2ZW50LmNhY2hlW3VpZF07XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHJlZ2lzdGVyKGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgIHZhciByZWdpc3RyeSA9IGdldFJlZ2lzdHJ5Rm9yRWxlbWVudChlbGVtZW50KTtcbiAgICBpZiAoIXJlZ2lzdHJ5W2V2ZW50TmFtZV0pIHJlZ2lzdHJ5W2V2ZW50TmFtZV0gPSBbXTtcbiAgICB2YXIgZW50cmllcyA9IHJlZ2lzdHJ5W2V2ZW50TmFtZV07XG5cbiAgICB2YXIgaSA9IGVudHJpZXMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pXG4gICAgICBpZiAoZW50cmllc1tpXS5oYW5kbGVyID09PSBoYW5kbGVyKSByZXR1cm4gbnVsbDtcblxuICAgIHZhciB1aWQgPSBnZXRVbmlxdWVFbGVtZW50SUQoZWxlbWVudCk7XG4gICAgdmFyIHJlc3BvbmRlciA9IEdMT0JBTC5FdmVudC5fY3JlYXRlUmVzcG9uZGVyKHVpZCwgZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgICB2YXIgZW50cnkgPSB7XG4gICAgICByZXNwb25kZXI6IHJlc3BvbmRlcixcbiAgICAgIGhhbmRsZXI6ICAgaGFuZGxlclxuICAgIH07XG5cbiAgICBlbnRyaWVzLnB1c2goZW50cnkpO1xuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVucmVnaXN0ZXIoZWxlbWVudCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgdmFyIHJlZ2lzdHJ5ID0gZ2V0UmVnaXN0cnlGb3JFbGVtZW50KGVsZW1lbnQpO1xuICAgIHZhciBlbnRyaWVzID0gcmVnaXN0cnlbZXZlbnROYW1lXTtcbiAgICBpZiAoIWVudHJpZXMpIHJldHVybjtcblxuICAgIHZhciBpID0gZW50cmllcy5sZW5ndGgsIGVudHJ5O1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGlmIChlbnRyaWVzW2ldLmhhbmRsZXIgPT09IGhhbmRsZXIpIHtcbiAgICAgICAgZW50cnkgPSBlbnRyaWVzW2ldO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIWVudHJ5KSByZXR1cm47XG5cbiAgICB2YXIgaW5kZXggPSBlbnRyaWVzLmluZGV4T2YoZW50cnkpO1xuICAgIGVudHJpZXMuc3BsaWNlKGluZGV4LCAxKTtcblxuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gb2JzZXJ2ZShlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICB2YXIgZW50cnkgPSByZWdpc3RlcihlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpO1xuXG4gICAgaWYgKGVudHJ5ID09PSBudWxsKSByZXR1cm4gZWxlbWVudDtcblxuICAgIHZhciByZXNwb25kZXIgPSBlbnRyeS5yZXNwb25kZXI7XG4gICAgaWYgKGlzQ3VzdG9tRXZlbnQoZXZlbnROYW1lKSlcbiAgICAgIG9ic2VydmVDdXN0b21FdmVudChlbGVtZW50LCBldmVudE5hbWUsIHJlc3BvbmRlcik7XG4gICAgZWxzZVxuICAgICAgb2JzZXJ2ZVN0YW5kYXJkRXZlbnQoZWxlbWVudCwgZXZlbnROYW1lLCByZXNwb25kZXIpO1xuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiBvYnNlcnZlU3RhbmRhcmRFdmVudChlbGVtZW50LCBldmVudE5hbWUsIHJlc3BvbmRlcikge1xuICAgIHZhciBhY3R1YWxFdmVudE5hbWUgPSBnZXRET01FdmVudE5hbWUoZXZlbnROYW1lKTtcbiAgICBpZiAoZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoYWN0dWFsRXZlbnROYW1lLCByZXNwb25kZXIsIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudC5hdHRhY2hFdmVudCgnb24nICsgYWN0dWFsRXZlbnROYW1lLCByZXNwb25kZXIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9ic2VydmVDdXN0b21FdmVudChlbGVtZW50LCBldmVudE5hbWUsIHJlc3BvbmRlcikge1xuICAgIGlmIChlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZGF0YWF2YWlsYWJsZScsIHJlc3BvbmRlciwgZmFsc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50LmF0dGFjaEV2ZW50KCdvbmRhdGFhdmFpbGFibGUnLCByZXNwb25kZXIpO1xuICAgICAgZWxlbWVudC5hdHRhY2hFdmVudCgnb25sb3NlY2FwdHVyZScsICAgcmVzcG9uZGVyKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wT2JzZXJ2aW5nKGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgIHZhciBoYW5kbGVyR2l2ZW4gPSAhT2JqZWN0LmlzVW5kZWZpbmVkKGhhbmRsZXIpLFxuICAgICBldmVudE5hbWVHaXZlbiA9ICFPYmplY3QuaXNVbmRlZmluZWQoZXZlbnROYW1lKTtcblxuICAgIGlmICghZXZlbnROYW1lR2l2ZW4gJiYgIWhhbmRsZXJHaXZlbikge1xuICAgICAgc3RvcE9ic2VydmluZ0VsZW1lbnQoZWxlbWVudCk7XG4gICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG5cbiAgICBpZiAoIWhhbmRsZXJHaXZlbikge1xuICAgICAgc3RvcE9ic2VydmluZ0V2ZW50TmFtZShlbGVtZW50LCBldmVudE5hbWUpO1xuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuXG4gICAgdmFyIGVudHJ5ID0gdW5yZWdpc3RlcihlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpO1xuXG4gICAgaWYgKCFlbnRyeSkgcmV0dXJuIGVsZW1lbnQ7XG4gICAgcmVtb3ZlRXZlbnQoZWxlbWVudCwgZXZlbnROYW1lLCBlbnRyeS5yZXNwb25kZXIpO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcE9ic2VydmluZ1N0YW5kYXJkRXZlbnQoZWxlbWVudCwgZXZlbnROYW1lLCByZXNwb25kZXIpIHtcbiAgICB2YXIgYWN0dWFsRXZlbnROYW1lID0gZ2V0RE9NRXZlbnROYW1lKGV2ZW50TmFtZSk7XG4gICAgaWYgKGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xuICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGFjdHVhbEV2ZW50TmFtZSwgcmVzcG9uZGVyLCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQuZGV0YWNoRXZlbnQoJ29uJyArIGFjdHVhbEV2ZW50TmFtZSwgcmVzcG9uZGVyKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wT2JzZXJ2aW5nQ3VzdG9tRXZlbnQoZWxlbWVudCwgZXZlbnROYW1lLCByZXNwb25kZXIpIHtcbiAgICBpZiAoZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKSB7XG4gICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RhdGFhdmFpbGFibGUnLCByZXNwb25kZXIsIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudC5kZXRhY2hFdmVudCgnb25kYXRhYXZhaWxhYmxlJywgcmVzcG9uZGVyKTtcbiAgICAgIGVsZW1lbnQuZGV0YWNoRXZlbnQoJ29ubG9zZWNhcHR1cmUnLCAgIHJlc3BvbmRlcik7XG4gICAgfVxuICB9XG5cblxuXG4gIGZ1bmN0aW9uIHN0b3BPYnNlcnZpbmdFbGVtZW50KGVsZW1lbnQpIHtcbiAgICB2YXIgdWlkID0gZ2V0VW5pcXVlRWxlbWVudElEKGVsZW1lbnQpLCByZWdpc3RyeSA9IEdMT0JBTC5FdmVudC5jYWNoZVt1aWRdO1xuICAgIGlmICghcmVnaXN0cnkpIHJldHVybjtcblxuICAgIGRlc3Ryb3lSZWdpc3RyeUZvckVsZW1lbnQoZWxlbWVudCwgdWlkKTtcblxuICAgIHZhciBlbnRyaWVzLCBpO1xuICAgIGZvciAodmFyIGV2ZW50TmFtZSBpbiByZWdpc3RyeSkge1xuICAgICAgaWYgKGV2ZW50TmFtZSA9PT0gJ2VsZW1lbnQnKSBjb250aW51ZTtcblxuICAgICAgZW50cmllcyA9IHJlZ2lzdHJ5W2V2ZW50TmFtZV07XG4gICAgICBpID0gZW50cmllcy5sZW5ndGg7XG4gICAgICB3aGlsZSAoaS0tKVxuICAgICAgICByZW1vdmVFdmVudChlbGVtZW50LCBldmVudE5hbWUsIGVudHJpZXNbaV0ucmVzcG9uZGVyKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wT2JzZXJ2aW5nRXZlbnROYW1lKGVsZW1lbnQsIGV2ZW50TmFtZSkge1xuICAgIHZhciByZWdpc3RyeSA9IGdldFJlZ2lzdHJ5Rm9yRWxlbWVudChlbGVtZW50KTtcbiAgICB2YXIgZW50cmllcyA9IHJlZ2lzdHJ5W2V2ZW50TmFtZV07XG4gICAgaWYgKCFlbnRyaWVzKSByZXR1cm47XG4gICAgZGVsZXRlIHJlZ2lzdHJ5W2V2ZW50TmFtZV07XG5cbiAgICB2YXIgaSA9IGVudHJpZXMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pXG4gICAgICByZW1vdmVFdmVudChlbGVtZW50LCBldmVudE5hbWUsIGVudHJpZXNbaV0ucmVzcG9uZGVyKTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gcmVtb3ZlRXZlbnQoZWxlbWVudCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgaWYgKGlzQ3VzdG9tRXZlbnQoZXZlbnROYW1lKSlcbiAgICAgIHN0b3BPYnNlcnZpbmdDdXN0b21FdmVudChlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpO1xuICAgIGVsc2VcbiAgICAgIHN0b3BPYnNlcnZpbmdTdGFuZGFyZEV2ZW50KGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcik7XG4gIH1cblxuXG5cbiAgZnVuY3Rpb24gZ2V0RmlyZVRhcmdldChlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQgIT09IGRvY3VtZW50KSByZXR1cm4gZWxlbWVudDtcbiAgICBpZiAoZG9jdW1lbnQuY3JlYXRlRXZlbnQgJiYgIWVsZW1lbnQuZGlzcGF0Y2hFdmVudClcbiAgICAgIHJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICBmdW5jdGlvbiBmaXJlKGVsZW1lbnQsIGV2ZW50TmFtZSwgbWVtbywgYnViYmxlKSB7XG4gICAgZWxlbWVudCA9IGdldEZpcmVUYXJnZXQoJChlbGVtZW50KSk7XG4gICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChidWJibGUpKSBidWJibGUgPSB0cnVlO1xuICAgIG1lbW8gPSBtZW1vIHx8IHt9O1xuXG4gICAgdmFyIGV2ZW50ID0gZmlyZUV2ZW50KGVsZW1lbnQsIGV2ZW50TmFtZSwgbWVtbywgYnViYmxlKTtcbiAgICByZXR1cm4gRXZlbnQuZXh0ZW5kKGV2ZW50KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpcmVFdmVudF9ET00oZWxlbWVudCwgZXZlbnROYW1lLCBtZW1vLCBidWJibGUpIHtcbiAgICB2YXIgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpO1xuICAgIGV2ZW50LmluaXRFdmVudCgnZGF0YWF2YWlsYWJsZScsIGJ1YmJsZSwgdHJ1ZSk7XG5cbiAgICBldmVudC5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgZXZlbnQubWVtbyA9IG1lbW87XG5cbiAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgIHJldHVybiBldmVudDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpcmVFdmVudF9JRShlbGVtZW50LCBldmVudE5hbWUsIG1lbW8sIGJ1YmJsZSkge1xuICAgIHZhciBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCk7XG4gICAgZXZlbnQuZXZlbnRUeXBlID0gYnViYmxlID8gJ29uZGF0YWF2YWlsYWJsZScgOiAnb25sb3NlY2FwdHVyZSc7XG5cbiAgICBldmVudC5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgZXZlbnQubWVtbyA9IG1lbW87XG5cbiAgICBlbGVtZW50LmZpcmVFdmVudChldmVudC5ldmVudFR5cGUsIGV2ZW50KTtcbiAgICByZXR1cm4gZXZlbnQ7XG4gIH1cblxuICB2YXIgZmlyZUV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQgPyBmaXJlRXZlbnRfRE9NIDogZmlyZUV2ZW50X0lFO1xuXG5cblxuICBFdmVudC5IYW5kbGVyID0gQ2xhc3MuY3JlYXRlKHtcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihlbGVtZW50LCBldmVudE5hbWUsIHNlbGVjdG9yLCBjYWxsYmFjaykge1xuICAgICAgdGhpcy5lbGVtZW50ICAgPSAkKGVsZW1lbnQpO1xuICAgICAgdGhpcy5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgICB0aGlzLnNlbGVjdG9yICA9IHNlbGVjdG9yO1xuICAgICAgdGhpcy5jYWxsYmFjayAgPSBjYWxsYmFjaztcbiAgICAgIHRoaXMuaGFuZGxlciAgID0gdGhpcy5oYW5kbGVFdmVudC5iaW5kKHRoaXMpO1xuICAgIH0sXG5cblxuICAgIHN0YXJ0OiBmdW5jdGlvbigpIHtcbiAgICAgIEV2ZW50Lm9ic2VydmUodGhpcy5lbGVtZW50LCB0aGlzLmV2ZW50TmFtZSwgdGhpcy5oYW5kbGVyKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgIEV2ZW50LnN0b3BPYnNlcnZpbmcodGhpcy5lbGVtZW50LCB0aGlzLmV2ZW50TmFtZSwgdGhpcy5oYW5kbGVyKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBoYW5kbGVFdmVudDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIHZhciBlbGVtZW50ID0gRXZlbnQuZmluZEVsZW1lbnQoZXZlbnQsIHRoaXMuc2VsZWN0b3IpO1xuICAgICAgaWYgKGVsZW1lbnQpIHRoaXMuY2FsbGJhY2suY2FsbCh0aGlzLmVsZW1lbnQsIGV2ZW50LCBlbGVtZW50KTtcbiAgICB9XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIG9uKGVsZW1lbnQsIGV2ZW50TmFtZSwgc2VsZWN0b3IsIGNhbGxiYWNrKSB7XG4gICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKHNlbGVjdG9yKSAmJiBPYmplY3QuaXNVbmRlZmluZWQoY2FsbGJhY2spKSB7XG4gICAgICBjYWxsYmFjayA9IHNlbGVjdG9yLCBzZWxlY3RvciA9IG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBFdmVudC5IYW5kbGVyKGVsZW1lbnQsIGV2ZW50TmFtZSwgc2VsZWN0b3IsIGNhbGxiYWNrKS5zdGFydCgpO1xuICB9XG5cbiAgT2JqZWN0LmV4dGVuZChFdmVudCwgRXZlbnQuTWV0aG9kcyk7XG5cbiAgT2JqZWN0LmV4dGVuZChFdmVudCwge1xuICAgIGZpcmU6ICAgICAgICAgIGZpcmUsXG4gICAgb2JzZXJ2ZTogICAgICAgb2JzZXJ2ZSxcbiAgICBzdG9wT2JzZXJ2aW5nOiBzdG9wT2JzZXJ2aW5nLFxuICAgIG9uOiAgICAgICAgICAgIG9uXG4gIH0pO1xuXG4gIEVsZW1lbnQuYWRkTWV0aG9kcyh7XG4gICAgZmlyZTogICAgICAgICAgZmlyZSxcblxuICAgIG9ic2VydmU6ICAgICAgIG9ic2VydmUsXG5cbiAgICBzdG9wT2JzZXJ2aW5nOiBzdG9wT2JzZXJ2aW5nLFxuXG4gICAgb246ICAgICAgICAgICAgb25cbiAgfSk7XG5cbiAgT2JqZWN0LmV4dGVuZChkb2N1bWVudCwge1xuICAgIGZpcmU6ICAgICAgICAgIGZpcmUubWV0aG9kaXplKCksXG5cbiAgICBvYnNlcnZlOiAgICAgICBvYnNlcnZlLm1ldGhvZGl6ZSgpLFxuXG4gICAgc3RvcE9ic2VydmluZzogc3RvcE9ic2VydmluZy5tZXRob2RpemUoKSxcblxuICAgIG9uOiAgICAgICAgICAgIG9uLm1ldGhvZGl6ZSgpLFxuXG4gICAgbG9hZGVkOiAgICAgICAgZmFsc2VcbiAgfSk7XG5cbiAgaWYgKEdMT0JBTC5FdmVudCkgT2JqZWN0LmV4dGVuZCh3aW5kb3cuRXZlbnQsIEV2ZW50KTtcbiAgZWxzZSBHTE9CQUwuRXZlbnQgPSBFdmVudDtcblxuICBHTE9CQUwuRXZlbnQuY2FjaGUgPSB7fTtcblxuICBmdW5jdGlvbiBkZXN0cm95Q2FjaGVfSUUoKSB7XG4gICAgR0xPQkFMLkV2ZW50LmNhY2hlID0gbnVsbDtcbiAgfVxuXG4gIGlmICh3aW5kb3cuYXR0YWNoRXZlbnQpXG4gICAgd2luZG93LmF0dGFjaEV2ZW50KCdvbnVubG9hZCcsIGRlc3Ryb3lDYWNoZV9JRSk7XG5cbiAgRElWID0gbnVsbDtcbiAgZG9jRWwgPSBudWxsO1xufSkodGhpcyk7XG5cbihmdW5jdGlvbihHTE9CQUwpIHtcbiAgLyogQ29kZSBmb3IgY3JlYXRpbmcgbGVhay1mcmVlIGV2ZW50IHJlc3BvbmRlcnMgaXMgYmFzZWQgb24gd29yayBieVxuICAgSm9obi1EYXZpZCBEYWx0b24uICovXG5cbiAgdmFyIGRvY0VsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICB2YXIgTU9VU0VFTlRFUl9NT1VTRUxFQVZFX0VWRU5UU19TVVBQT1JURUQgPSAnb25tb3VzZWVudGVyJyBpbiBkb2NFbFxuICAgICYmICdvbm1vdXNlbGVhdmUnIGluIGRvY0VsO1xuXG4gIGZ1bmN0aW9uIGlzU2ltdWxhdGVkTW91c2VFbnRlckxlYXZlRXZlbnQoZXZlbnROYW1lKSB7XG4gICAgcmV0dXJuICFNT1VTRUVOVEVSX01PVVNFTEVBVkVfRVZFTlRTX1NVUFBPUlRFRCAmJlxuICAgICAoZXZlbnROYW1lID09PSAnbW91c2VlbnRlcicgfHwgZXZlbnROYW1lID09PSAnbW91c2VsZWF2ZScpO1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlUmVzcG9uZGVyKHVpZCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgaWYgKEV2ZW50Ll9pc0N1c3RvbUV2ZW50KGV2ZW50TmFtZSkpXG4gICAgICByZXR1cm4gY3JlYXRlUmVzcG9uZGVyRm9yQ3VzdG9tRXZlbnQodWlkLCBldmVudE5hbWUsIGhhbmRsZXIpO1xuICAgIGlmIChpc1NpbXVsYXRlZE1vdXNlRW50ZXJMZWF2ZUV2ZW50KGV2ZW50TmFtZSkpXG4gICAgICByZXR1cm4gY3JlYXRlTW91c2VFbnRlckxlYXZlUmVzcG9uZGVyKHVpZCwgZXZlbnROYW1lLCBoYW5kbGVyKTtcblxuICAgIHJldHVybiBmdW5jdGlvbihldmVudCkge1xuICAgICAgaWYgKCFFdmVudC5jYWNoZSkgcmV0dXJuO1xuXG4gICAgICB2YXIgZWxlbWVudCA9IEV2ZW50LmNhY2hlW3VpZF0uZWxlbWVudDtcbiAgICAgIEV2ZW50LmV4dGVuZChldmVudCwgZWxlbWVudCk7XG4gICAgICBoYW5kbGVyLmNhbGwoZWxlbWVudCwgZXZlbnQpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVSZXNwb25kZXJGb3JDdXN0b21FdmVudCh1aWQsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgIHJldHVybiBmdW5jdGlvbihldmVudCkge1xuICAgICAgdmFyIGVsZW1lbnQgPSBFdmVudC5jYWNoZVt1aWRdLmVsZW1lbnQ7XG5cbiAgICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQoZXZlbnQuZXZlbnROYW1lKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBpZiAoZXZlbnQuZXZlbnROYW1lICE9PSBldmVudE5hbWUpXG4gICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgRXZlbnQuZXh0ZW5kKGV2ZW50LCBlbGVtZW50KTtcbiAgICAgIGhhbmRsZXIuY2FsbChlbGVtZW50LCBldmVudCk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZU1vdXNlRW50ZXJMZWF2ZVJlc3BvbmRlcih1aWQsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgIHJldHVybiBmdW5jdGlvbihldmVudCkge1xuICAgICAgdmFyIGVsZW1lbnQgPSBFdmVudC5jYWNoZVt1aWRdLmVsZW1lbnQ7XG5cbiAgICAgIEV2ZW50LmV4dGVuZChldmVudCwgZWxlbWVudCk7XG4gICAgICB2YXIgcGFyZW50ID0gZXZlbnQucmVsYXRlZFRhcmdldDtcblxuICAgICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQgIT09IGVsZW1lbnQpIHtcbiAgICAgICAgdHJ5IHsgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU7IH1cbiAgICAgICAgY2F0Y2goZSkgeyBwYXJlbnQgPSBlbGVtZW50OyB9XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJlbnQgPT09IGVsZW1lbnQpIHJldHVybjtcbiAgICAgIGhhbmRsZXIuY2FsbChlbGVtZW50LCBldmVudCk7XG4gICAgfVxuICB9XG5cbiAgR0xPQkFMLkV2ZW50Ll9jcmVhdGVSZXNwb25kZXIgPSBjcmVhdGVSZXNwb25kZXI7XG4gIGRvY0VsID0gbnVsbDtcbn0pKHRoaXMpO1xuXG4oZnVuY3Rpb24oR0xPQkFMKSB7XG4gIC8qIFN1cHBvcnQgZm9yIHRoZSBET01Db250ZW50TG9hZGVkIGV2ZW50IGlzIGJhc2VkIG9uIHdvcmsgYnkgRGFuIFdlYmIsXG4gICAgIE1hdHRoaWFzIE1pbGxlciwgRGVhbiBFZHdhcmRzLCBKb2huIFJlc2lnLCBhbmQgRGllZ28gUGVyaW5pLiAqL1xuXG4gIHZhciBUSU1FUjtcblxuICBmdW5jdGlvbiBmaXJlQ29udGVudExvYWRlZEV2ZW50KCkge1xuICAgIGlmIChkb2N1bWVudC5sb2FkZWQpIHJldHVybjtcbiAgICBpZiAoVElNRVIpIHdpbmRvdy5jbGVhclRpbWVvdXQoVElNRVIpO1xuICAgIGRvY3VtZW50LmxvYWRlZCA9IHRydWU7XG4gICAgZG9jdW1lbnQuZmlyZSgnZG9tOmxvYWRlZCcpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2hlY2tSZWFkeVN0YXRlKCkge1xuICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XG4gICAgICBkb2N1bWVudC5kZXRhY2hFdmVudCgnb25yZWFkeXN0YXRlY2hhbmdlJywgY2hlY2tSZWFkeVN0YXRlKTtcbiAgICAgIGZpcmVDb250ZW50TG9hZGVkRXZlbnQoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwb2xsRG9TY3JvbGwoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgnbGVmdCcpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIFRJTUVSID0gcG9sbERvU2Nyb2xsLmRlZmVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZmlyZUNvbnRlbnRMb2FkZWRFdmVudCgpO1xuICB9XG5cblxuICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykge1xuICAgIGZpcmVDb250ZW50TG9hZGVkRXZlbnQoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmaXJlQ29udGVudExvYWRlZEV2ZW50LCBmYWxzZSk7XG4gIH0gZWxzZSB7XG4gICAgZG9jdW1lbnQuYXR0YWNoRXZlbnQoJ29ucmVhZHlzdGF0ZWNoYW5nZScsIGNoZWNrUmVhZHlTdGF0ZSk7XG4gICAgaWYgKHdpbmRvdyA9PSB0b3ApIFRJTUVSID0gcG9sbERvU2Nyb2xsLmRlZmVyKCk7XG4gIH1cblxuICBFdmVudC5vYnNlcnZlKHdpbmRvdywgJ2xvYWQnLCBmaXJlQ29udGVudExvYWRlZEV2ZW50KTtcbn0pKHRoaXMpO1xuXG5cbkVsZW1lbnQuYWRkTWV0aG9kcygpO1xuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIERFUFJFQ0FURUQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbkhhc2gudG9RdWVyeVN0cmluZyA9IE9iamVjdC50b1F1ZXJ5U3RyaW5nO1xuXG52YXIgVG9nZ2xlID0geyBkaXNwbGF5OiBFbGVtZW50LnRvZ2dsZSB9O1xuXG5FbGVtZW50Lk1ldGhvZHMuY2hpbGRPZiA9IEVsZW1lbnQuTWV0aG9kcy5kZXNjZW5kYW50T2Y7XG5cbnZhciBJbnNlcnRpb24gPSB7XG4gIEJlZm9yZTogZnVuY3Rpb24oZWxlbWVudCwgY29udGVudCkge1xuICAgIHJldHVybiBFbGVtZW50Lmluc2VydChlbGVtZW50LCB7YmVmb3JlOmNvbnRlbnR9KTtcbiAgfSxcblxuICBUb3A6IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRlbnQpIHtcbiAgICByZXR1cm4gRWxlbWVudC5pbnNlcnQoZWxlbWVudCwge3RvcDpjb250ZW50fSk7XG4gIH0sXG5cbiAgQm90dG9tOiBmdW5jdGlvbihlbGVtZW50LCBjb250ZW50KSB7XG4gICAgcmV0dXJuIEVsZW1lbnQuaW5zZXJ0KGVsZW1lbnQsIHtib3R0b206Y29udGVudH0pO1xuICB9LFxuXG4gIEFmdGVyOiBmdW5jdGlvbihlbGVtZW50LCBjb250ZW50KSB7XG4gICAgcmV0dXJuIEVsZW1lbnQuaW5zZXJ0KGVsZW1lbnQsIHthZnRlcjpjb250ZW50fSk7XG4gIH1cbn07XG5cbnZhciAkY29udGludWUgPSBuZXcgRXJyb3IoJ1widGhyb3cgJGNvbnRpbnVlXCIgaXMgZGVwcmVjYXRlZCwgdXNlIFwicmV0dXJuXCIgaW5zdGVhZCcpO1xuXG52YXIgUG9zaXRpb24gPSB7XG4gIGluY2x1ZGVTY3JvbGxPZmZzZXRzOiBmYWxzZSxcblxuICBwcmVwYXJlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmRlbHRhWCA9ICB3aW5kb3cucGFnZVhPZmZzZXRcbiAgICAgICAgICAgICAgICB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdFxuICAgICAgICAgICAgICAgIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdFxuICAgICAgICAgICAgICAgIHx8IDA7XG4gICAgdGhpcy5kZWx0YVkgPSAgd2luZG93LnBhZ2VZT2Zmc2V0XG4gICAgICAgICAgICAgICAgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcFxuICAgICAgICAgICAgICAgIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wXG4gICAgICAgICAgICAgICAgfHwgMDtcbiAgfSxcblxuICB3aXRoaW46IGZ1bmN0aW9uKGVsZW1lbnQsIHgsIHkpIHtcbiAgICBpZiAodGhpcy5pbmNsdWRlU2Nyb2xsT2Zmc2V0cylcbiAgICAgIHJldHVybiB0aGlzLndpdGhpbkluY2x1ZGluZ1Njcm9sbG9mZnNldHMoZWxlbWVudCwgeCwgeSk7XG4gICAgdGhpcy54Y29tcCA9IHg7XG4gICAgdGhpcy55Y29tcCA9IHk7XG4gICAgdGhpcy5vZmZzZXQgPSBFbGVtZW50LmN1bXVsYXRpdmVPZmZzZXQoZWxlbWVudCk7XG5cbiAgICByZXR1cm4gKHkgPj0gdGhpcy5vZmZzZXRbMV0gJiZcbiAgICAgICAgICAgIHkgPCAgdGhpcy5vZmZzZXRbMV0gKyBlbGVtZW50Lm9mZnNldEhlaWdodCAmJlxuICAgICAgICAgICAgeCA+PSB0aGlzLm9mZnNldFswXSAmJlxuICAgICAgICAgICAgeCA8ICB0aGlzLm9mZnNldFswXSArIGVsZW1lbnQub2Zmc2V0V2lkdGgpO1xuICB9LFxuXG4gIHdpdGhpbkluY2x1ZGluZ1Njcm9sbG9mZnNldHM6IGZ1bmN0aW9uKGVsZW1lbnQsIHgsIHkpIHtcbiAgICB2YXIgb2Zmc2V0Y2FjaGUgPSBFbGVtZW50LmN1bXVsYXRpdmVTY3JvbGxPZmZzZXQoZWxlbWVudCk7XG5cbiAgICB0aGlzLnhjb21wID0geCArIG9mZnNldGNhY2hlWzBdIC0gdGhpcy5kZWx0YVg7XG4gICAgdGhpcy55Y29tcCA9IHkgKyBvZmZzZXRjYWNoZVsxXSAtIHRoaXMuZGVsdGFZO1xuICAgIHRoaXMub2Zmc2V0ID0gRWxlbWVudC5jdW11bGF0aXZlT2Zmc2V0KGVsZW1lbnQpO1xuXG4gICAgcmV0dXJuICh0aGlzLnljb21wID49IHRoaXMub2Zmc2V0WzFdICYmXG4gICAgICAgICAgICB0aGlzLnljb21wIDwgIHRoaXMub2Zmc2V0WzFdICsgZWxlbWVudC5vZmZzZXRIZWlnaHQgJiZcbiAgICAgICAgICAgIHRoaXMueGNvbXAgPj0gdGhpcy5vZmZzZXRbMF0gJiZcbiAgICAgICAgICAgIHRoaXMueGNvbXAgPCAgdGhpcy5vZmZzZXRbMF0gKyBlbGVtZW50Lm9mZnNldFdpZHRoKTtcbiAgfSxcblxuICBvdmVybGFwOiBmdW5jdGlvbihtb2RlLCBlbGVtZW50KSB7XG4gICAgaWYgKCFtb2RlKSByZXR1cm4gMDtcbiAgICBpZiAobW9kZSA9PSAndmVydGljYWwnKVxuICAgICAgcmV0dXJuICgodGhpcy5vZmZzZXRbMV0gKyBlbGVtZW50Lm9mZnNldEhlaWdodCkgLSB0aGlzLnljb21wKSAvXG4gICAgICAgIGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIGlmIChtb2RlID09ICdob3Jpem9udGFsJylcbiAgICAgIHJldHVybiAoKHRoaXMub2Zmc2V0WzBdICsgZWxlbWVudC5vZmZzZXRXaWR0aCkgLSB0aGlzLnhjb21wKSAvXG4gICAgICAgIGVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gIH0sXG5cblxuICBjdW11bGF0aXZlT2Zmc2V0OiBFbGVtZW50Lk1ldGhvZHMuY3VtdWxhdGl2ZU9mZnNldCxcblxuICBwb3NpdGlvbmVkT2Zmc2V0OiBFbGVtZW50Lk1ldGhvZHMucG9zaXRpb25lZE9mZnNldCxcblxuICBhYnNvbHV0aXplOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgUG9zaXRpb24ucHJlcGFyZSgpO1xuICAgIHJldHVybiBFbGVtZW50LmFic29sdXRpemUoZWxlbWVudCk7XG4gIH0sXG5cbiAgcmVsYXRpdml6ZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIFBvc2l0aW9uLnByZXBhcmUoKTtcbiAgICByZXR1cm4gRWxlbWVudC5yZWxhdGl2aXplKGVsZW1lbnQpO1xuICB9LFxuXG4gIHJlYWxPZmZzZXQ6IEVsZW1lbnQuTWV0aG9kcy5jdW11bGF0aXZlU2Nyb2xsT2Zmc2V0LFxuXG4gIG9mZnNldFBhcmVudDogRWxlbWVudC5NZXRob2RzLmdldE9mZnNldFBhcmVudCxcblxuICBwYWdlOiBFbGVtZW50Lk1ldGhvZHMudmlld3BvcnRPZmZzZXQsXG5cbiAgY2xvbmU6IGZ1bmN0aW9uKHNvdXJjZSwgdGFyZ2V0LCBvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuICAgIHJldHVybiBFbGVtZW50LmNsb25lUG9zaXRpb24odGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpO1xuICB9XG59O1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lID0gZnVuY3Rpb24oaW5zdGFuY2VNZXRob2RzKXtcbiAgZnVuY3Rpb24gaXRlcihuYW1lKSB7XG4gICAgcmV0dXJuIG5hbWUuYmxhbmsoKSA/IG51bGwgOiBcIltjb250YWlucyhjb25jYXQoJyAnLCBAY2xhc3MsICcgJyksICcgXCIgKyBuYW1lICsgXCIgJyldXCI7XG4gIH1cblxuICBpbnN0YW5jZU1ldGhvZHMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IFByb3RvdHlwZS5Ccm93c2VyRmVhdHVyZXMuWFBhdGggP1xuICBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUudG9TdHJpbmcoKS5zdHJpcCgpO1xuICAgIHZhciBjb25kID0gL1xccy8udGVzdChjbGFzc05hbWUpID8gJHcoY2xhc3NOYW1lKS5tYXAoaXRlcikuam9pbignJykgOiBpdGVyKGNsYXNzTmFtZSk7XG4gICAgcmV0dXJuIGNvbmQgPyBkb2N1bWVudC5fZ2V0RWxlbWVudHNCeVhQYXRoKCcuLy8qJyArIGNvbmQsIGVsZW1lbnQpIDogW107XG4gIH0gOiBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUudG9TdHJpbmcoKS5zdHJpcCgpO1xuICAgIHZhciBlbGVtZW50cyA9IFtdLCBjbGFzc05hbWVzID0gKC9cXHMvLnRlc3QoY2xhc3NOYW1lKSA/ICR3KGNsYXNzTmFtZSkgOiBudWxsKTtcbiAgICBpZiAoIWNsYXNzTmFtZXMgJiYgIWNsYXNzTmFtZSkgcmV0dXJuIGVsZW1lbnRzO1xuXG4gICAgdmFyIG5vZGVzID0gJChlbGVtZW50KS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpO1xuICAgIGNsYXNzTmFtZSA9ICcgJyArIGNsYXNzTmFtZSArICcgJztcblxuICAgIGZvciAodmFyIGkgPSAwLCBjaGlsZCwgY247IGNoaWxkID0gbm9kZXNbaV07IGkrKykge1xuICAgICAgaWYgKGNoaWxkLmNsYXNzTmFtZSAmJiAoY24gPSAnICcgKyBjaGlsZC5jbGFzc05hbWUgKyAnICcpICYmIChjbi5pbmNsdWRlKGNsYXNzTmFtZSkgfHxcbiAgICAgICAgICAoY2xhc3NOYW1lcyAmJiBjbGFzc05hbWVzLmFsbChmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gIW5hbWUudG9TdHJpbmcoKS5ibGFuaygpICYmIGNuLmluY2x1ZGUoJyAnICsgbmFtZSArICcgJyk7XG4gICAgICAgICAgfSkpKSlcbiAgICAgICAgZWxlbWVudHMucHVzaChFbGVtZW50LmV4dGVuZChjaGlsZCkpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudHM7XG4gIH07XG5cbiAgcmV0dXJuIGZ1bmN0aW9uKGNsYXNzTmFtZSwgcGFyZW50RWxlbWVudCkge1xuICAgIHJldHVybiAkKHBhcmVudEVsZW1lbnQgfHwgZG9jdW1lbnQuYm9keSkuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpO1xuICB9O1xufShFbGVtZW50Lk1ldGhvZHMpO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuRWxlbWVudC5DbGFzc05hbWVzID0gQ2xhc3MuY3JlYXRlKCk7XG5FbGVtZW50LkNsYXNzTmFtZXMucHJvdG90eXBlID0ge1xuICBpbml0aWFsaXplOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTtcbiAgfSxcblxuICBfZWFjaDogZnVuY3Rpb24oaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB0aGlzLmVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLykuc2VsZWN0KGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBuYW1lLmxlbmd0aCA+IDA7XG4gICAgfSkuX2VhY2goaXRlcmF0b3IsIGNvbnRleHQpO1xuICB9LFxuXG4gIHNldDogZnVuY3Rpb24oY2xhc3NOYW1lKSB7XG4gICAgdGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgfSxcblxuICBhZGQ6IGZ1bmN0aW9uKGNsYXNzTmFtZVRvQWRkKSB7XG4gICAgaWYgKHRoaXMuaW5jbHVkZShjbGFzc05hbWVUb0FkZCkpIHJldHVybjtcbiAgICB0aGlzLnNldCgkQSh0aGlzKS5jb25jYXQoY2xhc3NOYW1lVG9BZGQpLmpvaW4oJyAnKSk7XG4gIH0sXG5cbiAgcmVtb3ZlOiBmdW5jdGlvbihjbGFzc05hbWVUb1JlbW92ZSkge1xuICAgIGlmICghdGhpcy5pbmNsdWRlKGNsYXNzTmFtZVRvUmVtb3ZlKSkgcmV0dXJuO1xuICAgIHRoaXMuc2V0KCRBKHRoaXMpLndpdGhvdXQoY2xhc3NOYW1lVG9SZW1vdmUpLmpvaW4oJyAnKSk7XG4gIH0sXG5cbiAgdG9TdHJpbmc6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkQSh0aGlzKS5qb2luKCcgJyk7XG4gIH1cbn07XG5cbk9iamVjdC5leHRlbmQoRWxlbWVudC5DbGFzc05hbWVzLnByb3RvdHlwZSwgRW51bWVyYWJsZSk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4oZnVuY3Rpb24oKSB7XG4gIHdpbmRvdy5TZWxlY3RvciA9IENsYXNzLmNyZWF0ZSh7XG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZXhwcmVzc2lvbikge1xuICAgICAgdGhpcy5leHByZXNzaW9uID0gZXhwcmVzc2lvbi5zdHJpcCgpO1xuICAgIH0sXG5cbiAgICBmaW5kRWxlbWVudHM6IGZ1bmN0aW9uKHJvb3RFbGVtZW50KSB7XG4gICAgICByZXR1cm4gUHJvdG90eXBlLlNlbGVjdG9yLnNlbGVjdCh0aGlzLmV4cHJlc3Npb24sIHJvb3RFbGVtZW50KTtcbiAgICB9LFxuXG4gICAgbWF0Y2g6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2goZWxlbWVudCwgdGhpcy5leHByZXNzaW9uKTtcbiAgICB9LFxuXG4gICAgdG9TdHJpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZXhwcmVzc2lvbjtcbiAgICB9LFxuXG4gICAgaW5zcGVjdDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gXCIjPFNlbGVjdG9yOiBcIiArIHRoaXMuZXhwcmVzc2lvbiArIFwiPlwiO1xuICAgIH1cbiAgfSk7XG5cbiAgT2JqZWN0LmV4dGVuZChTZWxlY3Rvciwge1xuICAgIG1hdGNoRWxlbWVudHM6IGZ1bmN0aW9uKGVsZW1lbnRzLCBleHByZXNzaW9uKSB7XG4gICAgICB2YXIgbWF0Y2ggPSBQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2gsXG4gICAgICAgICAgcmVzdWx0cyA9IFtdO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBlbGVtZW50c1tpXTtcbiAgICAgICAgaWYgKG1hdGNoKGVsZW1lbnQsIGV4cHJlc3Npb24pKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfSxcblxuICAgIGZpbmRFbGVtZW50OiBmdW5jdGlvbihlbGVtZW50cywgZXhwcmVzc2lvbiwgaW5kZXgpIHtcbiAgICAgIGluZGV4ID0gaW5kZXggfHwgMDtcbiAgICAgIHZhciBtYXRjaEluZGV4ID0gMCwgZWxlbWVudDtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBlbGVtZW50ID0gZWxlbWVudHNbaV07XG4gICAgICAgIGlmIChQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2goZWxlbWVudCwgZXhwcmVzc2lvbikgJiYgaW5kZXggPT09IG1hdGNoSW5kZXgrKykge1xuICAgICAgICAgIHJldHVybiBFbGVtZW50LmV4dGVuZChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBmaW5kQ2hpbGRFbGVtZW50czogZnVuY3Rpb24oZWxlbWVudCwgZXhwcmVzc2lvbnMpIHtcbiAgICAgIHZhciBzZWxlY3RvciA9IGV4cHJlc3Npb25zLnRvQXJyYXkoKS5qb2luKCcsICcpO1xuICAgICAgcmV0dXJuIFByb3RvdHlwZS5TZWxlY3Rvci5zZWxlY3Qoc2VsZWN0b3IsIGVsZW1lbnQgfHwgZG9jdW1lbnQpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8qXHQ9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblx0XHRcdFx0XHRcdFx0XHRcdEdpYnNvbiBSZXNlYXJjaCBDb3Jwb3JhdGlvblxyXG5cdFx0XHRcdFVIRVBSTkcgLSBVbHRyYSBIaWdoIEVudHJvcHkgUHNldWRvLVJhbmRvbSBOdW1iZXIgR2VuZXJhdG9yXHJcblx0PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cdFRoaXMgaXMgR1JDJ3MgY3J5cHRvZ3JhcGhpY2FsbHkgc3Ryb25nIFBSTkcgKHBzZXVkby1yYW5kb20gbnVtYmVyIGdlbmVyYXRvcilcclxuXHRmb3IgSmF2YVNjcmlwdC4gSXQgaXMgZHJpdmVuIGJ5IDE1MzYgYml0cyBvZiBlbnRyb3B5LCBzdG9yZWQgaW4gYW4gYXJyYXkgb2ZcclxuXHQ0OCwgMzItYml0IEphdmFTY3JpcHQgdmFyaWFibGVzLiAgU2luY2UgbWFueSBhcHBsaWNhdGlvbnMgb2YgdGhpcyBnZW5lcmF0b3IsXHJcblx0aW5jbHVkaW5nIG91cnMgd2l0aCB0aGUgXCJPZmYgVGhlIEdyaWRcIiBMYXRpbiBTcXVhcmUgZ2VuZXJhdG9yLCBtYXkgcmVxdWlyZVxyXG5cdHRoZSBkZXRlcmltaW5pc3RpYyByZS1nZW5lcmF0aW9uIG9mIGEgc2VxdWVuY2Ugb2YgUFJOcywgdGhpcyBQUk5HJ3MgaW5pdGlhbFxyXG5cdGVudHJvcGljIHN0YXRlIGNhbiBiZSByZWFkIGFuZCB3cml0dGVuIGFzIGEgc3RhdGljIHdob2xlLCBhbmQgaW5jcmVtZW50YWxseVxyXG5cdGV2b2x2ZWQgYnkgcG91cmluZyBuZXcgc291cmNlIGVudHJvcHkgaW50byB0aGUgZ2VuZXJhdG9yJ3MgaW50ZXJuYWwgc3RhdGUuXHJcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cdEVORExFU1MgVEhBTktTIGFyZSBkdWUgSm9oYW5uZXMgQmFhZ29lIGZvciBoaXMgY2FyZWZ1bCBkZXZlbG9wbWVudCBvZiBoaWdobHlcclxuXHRyb2J1c3QgSmF2YVNjcmlwdCBpbXBsZW1lbnRhdGlvbnMgb2YgSlMgUFJOR3MuICBUaGlzIHdvcmsgd2FzIGJhc2VkIHVwb24gaGlzXHJcblx0SmF2YVNjcmlwdCBcIkFsZWFcIiBQUk5HIHdoaWNoIGlzIGJhc2VkIHVwb24gdGhlIGV4dHJlbWVseSByb2J1c3QgTXVsdGlwbHktXHJcblx0V2l0aC1DYXJyeSAoTVdDKSBQUk5HIGludmVudGVkIGJ5IEdlb3JnZSBNYXJzYWdsaWEuIE1XQyBBbGdvcml0aG0gUmVmZXJlbmNlczpcclxuXHRodHRwOi8vd3d3LkdSQy5jb20vb3RnL01hcnNhZ2xpYV9QUk5Hcy5wZGZcclxuXHRodHRwOi8vd3d3LkdSQy5jb20vb3RnL01hcnNhZ2xpYV9NV0NfR2VuZXJhdG9ycy5wZGZcclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblx0VGhlIHF1YWxpdHkgb2YgdGhpcyBhbGdvcml0aG0ncyBwc2V1ZG8tcmFuZG9tIG51bWJlcnMgaGF2ZSBiZWVuIHZlcmlmaWVkIGJ5XHJcblx0bXVsdGlwbGUgaW5kZXBlbmRlbnQgcmVzZWFyY2hlcnMuIEl0IGhhbmRpbHkgcGFzc2VzIHRoZSBmZXJtaWxhYi5jaCB0ZXN0cyBhc1xyXG5cdHdlbGwgYXMgdGhlIFwiZGllaGFyZFwiIGFuZCBcImRpZWhhcmRlclwiIHRlc3Qgc3VpdGVzLiAgRm9yIGluZGl2aWR1YWxzIHdpc2hpbmdcclxuXHR0byBmdXJ0aGVyIHZlcmlmeSB0aGUgcXVhbGl0eSBvZiB0aGlzIGFsZ29yaXRobSdzIHBzZXVkby1yYW5kb20gbnVtYmVycywgYVxyXG5cdDI1Ni1tZWdhYnl0ZSBmaWxlIG9mIHRoaXMgYWxnb3JpdGhtJ3Mgb3V0cHV0IG1heSBiZSBkb3dubG9hZGVkIGZyb20gR1JDLmNvbSxcclxuXHRhbmQgYSBNaWNyb3NvZnQgV2luZG93cyBzY3JpcHRpbmcgaG9zdCAoV1NIKSB2ZXJzaW9uIG9mIHRoaXMgYWxnb3JpdGhtIG1heSBiZVxyXG5cdGRvd25sb2FkZWQgYW5kIHJ1biBmcm9tIHRoZSBXaW5kb3dzIGNvbW1hbmQgcHJvbXB0IHRvIGdlbmVyYXRlIHVuaXF1ZSBmaWxlc1xyXG5cdG9mIGFueSBzaXplOlxyXG5cdFRoZSBGZXJtaWxhYiBcIkVOVFwiIHRlc3RzOiBodHRwOi8vZm91cm1pbGFiLmNoL3JhbmRvbS9cclxuXHRUaGUgMjU2LW1lZ2FieXRlIHNhbXBsZSBQUk4gZmlsZSBhdCBHUkM6IGh0dHBzOi8vd3d3LkdSQy5jb20vb3RnL3VoZXBybmcuYmluXHJcblx0VGhlIFdpbmRvd3Mgc2NyaXB0aW5nIGhvc3QgdmVyc2lvbjogaHR0cHM6Ly93d3cuR1JDLmNvbS9vdGcvd3NoLXVoZXBybmcuanNcclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblx0UXVhbGlmeWluZyBNV0MgbXVsdGlwbGllcnMgYXJlOiAxODc4ODQsIDY4NjExOCwgODk4MTM0LCAxMTA0Mzc1LCAxMjUwMjA1LFxyXG5cdDE0NjA5MTAgYW5kIDE3Njg4NjMuIChXZSB1c2UgdGhlIGxhcmdlc3Qgb25lIHRoYXQncyA8IDJeMjEpXHJcblx0PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xyXG5cclxuZnVuY3Rpb24gdWhlcHJuZygpIHtcclxuXHRyZXR1cm4gKGZ1bmN0aW9uKCkge1xyXG4gIFx0XHR2YXIgbyA9IDQ4O1x0XHRcdFx0XHQvLyBzZXQgdGhlICdvcmRlcicgbnVtYmVyIG9mIEVOVFJPUFktaG9sZGluZyAzMi1iaXQgdmFsdWVzXHJcblx0XHR2YXIgYyA9IDE7XHRcdFx0XHRcdC8vIGluaXQgdGhlICdjYXJyeScgdXNlZCBieSB0aGUgbXVsdGlwbHktd2l0aC1jYXJyeSAoTVdDKSBhbGdvcml0aG1cclxuXHRcdHZhciBwID0gbztcdFx0XHRcdFx0Ly8gaW5pdCB0aGUgJ3BoYXNlJyAobWF4LTEpIG9mIHRoZSBpbnRlcm1lZGlhdGUgdmFyaWFibGUgcG9pbnRlclxyXG5cdFx0dmFyIHMgPSBuZXcgQXJyYXkobyk7XHQvLyBkZWNsYXJlIG91ciBpbnRlcm1lZGlhdGUgdmFyaWFibGVzIGFycmF5XHJcblx0XHR2YXIgaSxqLGs9MDtcdFx0XHRcdC8vIGdlbmVyYWwgcHVycG9zZSBsb2NhbHNcclxuXHJcblx0XHQvLyB3aGVuIG91ciBcInVoZXBybmdcIiBpcyBpbml0aWFsbHkgaW52b2tlZCBvdXIgUFJORyBzdGF0ZSBpcyBpbml0aWFsaXplZCBmcm9tIHRoZVxyXG5cdFx0Ly8gYnJvd3NlcidzIG93biBsb2NhbCBQUk5HLiBUaGlzIGlzIG9rYXkgc2luY2UgYWx0aG91Z2ggaXRzIGdlbmVyYXRvciBtaWdodCBub3RcclxuXHRcdC8vIGJlIHdvbmRlcmZ1bCwgaXQncyB1c2VmdWwgZm9yIGVzdGFibGlzaGluZyBsYXJnZSBzdGFydHVwIGVudHJvcHkgZm9yIG91ciB1c2FnZS5cdFx0XHJcblx0XHR2YXIgbWFzaCA9IE1hc2goKTtcdFx0Ly8gZ2V0IGEgcG9pbnRlciB0byBvdXIgaGlnaC1wZXJmb3JtYW5jZSBcIk1hc2hcIiBoYXNoXHJcblx0XHRmb3IgKGkgPSAwOyBpIDwgbzsgaSsrKSBzW2ldID0gbWFzaCggTWF0aC5yYW5kb20oKSApO1x0Ly8gZmlsbCB0aGUgYXJyYXkgd2l0aCBpbml0aWFsIG1hc2ggaGFzaCB2YWx1ZXNcclxuXHJcblx0XHQvLyB0aGlzIFBSSVZBVEUgKGludGVybmFsIGFjY2VzcyBvbmx5KSBmdW5jdGlvbiBpcyB0aGUgaGVhcnQgb2YgdGhlIG11bHRpcGx5LXdpdGgtY2FycnlcclxuXHRcdC8vIChNV0MpIFBSTkcgYWxnb3JpdGhtLiBXaGVuIGNhbGxlZCBpdCByZXR1cm5zIGEgcHNldWRvLXJhbmRvbSBudW1iZXIgaW4gdGhlIGZvcm0gb2YgYVxyXG5cdFx0Ly8gMzItYml0IEphdmFTY3JpcHQgZnJhY3Rpb24gKDAuMCB0byA8MS4wKSBpdCBpcyBhIFBSSVZBVEUgZnVuY3Rpb24gdXNlZCBieSB0aGUgZGVmYXVsdFxyXG5cdFx0Ly8gWzAtMV0gcmV0dXJuIGZ1bmN0aW9uLCBhbmQgYnkgdGhlIHJhbmRvbSAnc3RyaW5nKG4pJyBmdW5jdGlvbiB3aGljaCByZXR1cm5zICduJ1xyXG5cdFx0Ly8gY2hhcmFjdGVycyBmcm9tIDMzIHRvIDEyNi5cclxuXHRcdGZ1bmN0aW9uIHJhd3BybmcoKSB7XHJcblx0XHRcdGlmICgrK3AgPj0gbykgcCA9IDA7XHJcblx0XHRcdHZhciB0ID0gMTc2ODg2MyAqIHNbcF0gKyBjICogMi4zMjgzMDY0MzY1Mzg2OTYzZS0xMDsgLy8gMl4tMzJcclxuICAgICAgXHRyZXR1cm4gc1twXSA9IHQgLSAoYyA9IHQgfCAwKTtcclxuXHRcdH07XHJcblx0XHRcclxuXHRcdC8vIHRoaXMgRVhQT1JURUQgZnVuY3Rpb24gaXMgdGhlIGRlZmF1bHQgZnVuY3Rpb24gcmV0dXJuZWQgYnkgdGhpcyBsaWJyYXJ5LlxyXG5cdFx0Ly8gVGhlIHZhbHVlcyByZXR1cm5lZCBhcmUgaW50ZWdlcnMgaW4gdGhlIHJhbmdlIGZyb20gMCB0byByYW5nZS0xLiBXZSBmaXJzdFxyXG5cdFx0Ly8gb2J0YWluIHR3byAzMi1iaXQgZnJhY3Rpb25zIChmcm9tIHJhd3BybmcpIHRvIHN5bnRoZXNpemUgYSBzaW5nbGUgaGlnaFxyXG5cdFx0Ly8gcmVzb2x1dGlvbiA1My1iaXQgcHJuZyAoMCB0byA8MSksIHRoZW4gd2UgbXVsdGlwbHkgdGhpcyBieSB0aGUgY2FsbGVyJ3NcclxuXHRcdC8vIFwicmFuZ2VcIiBwYXJhbSBhbmQgdGFrZSB0aGUgXCJmbG9vclwiIHRvIHJldHVybiBhIGVxdWFsbHkgcHJvYmFibGUgaW50ZWdlci5cclxuXHRcdHZhciByYW5kb20gPSBmdW5jdGlvbiggcmFuZ2UgKSB7XHJcblx0XHRcdHJldHVybiBNYXRoLmZsb29yKHJhbmdlICogKHJhd3BybmcoKSArIChyYXdwcm5nKCkgKiAweDIwMDAwMCB8IDApICogMS4xMTAyMjMwMjQ2MjUxNTY1ZS0xNikpOyAvLyAyXi01M1xyXG5cdFx0fTtcclxuXHJcblx0XHQvLyB0aGlzIEVYUE9SVEVEIGZ1bmN0aW9uICdzdHJpbmcobiknIHJldHVybnMgYSBwc2V1ZG8tcmFuZG9tIHN0cmluZyBvZlxyXG5cdFx0Ly8gJ24nIHByaW50YWJsZSBjaGFyYWN0ZXJzIHJhbmdpbmcgZnJvbSBjaHIoMzMpIHRvIGNocigxMjYpIGluY2x1c2l2ZS5cclxuXHRcdHJhbmRvbS5zdHJpbmcgPSBmdW5jdGlvbiggY291bnQgKSB7XHJcblx0XHRcdHZhciBpLCBzPScnO1xyXG5cdFx0XHRmb3IgKCBpPTA7IGk8Y291bnQ7IGkrKyApIHMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSggMzMrcmFuZG9tKDk0KSApO1xyXG5cdFx0XHRyZXR1cm4gcztcclxuXHRcdH07XHJcblxyXG5cdFx0Ly8gdGhpcyBQUklWQVRFIFwiaGFzaFwiIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZXZvbHZlIHRoZSBnZW5lcmF0b3IncyBpbnRlcm5hbFxyXG5cdFx0Ly8gZW50cm9weSBzdGF0ZS4gSXQgaXMgYWxzbyBjYWxsZWQgYnkgdGhlIEVYUE9SVEVEIGFkZEVudHJvcHkoKSBmdW5jdGlvblxyXG5cdFx0Ly8gd2hpY2ggaXMgdXNlZCB0byBwb3VyIGVudHJvcHkgaW50byB0aGUgUFJORy5cclxuXHRcdGZ1bmN0aW9uIGhhc2goKSB7XHJcblx0XHRcdHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKVxyXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdGZvciAoaiA9IDA7IGogPCBvOyBqKyspIHtcclxuXHRcdFx0XHRcdHNbal0gLT0gbWFzaChhcmdzW2ldKTtcclxuXHRcdFx0XHRcdGlmIChzW2pdIDwgMCkgc1tqXSArPSAxO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHQvLyB0aGlzIEVYUE9SVEVEIFwiY2xlYW4gc3RyaW5nXCIgZnVuY3Rpb24gcmVtb3ZlcyBsZWFkaW5nIGFuZCB0cmFpbGluZyBzcGFjZXMgYW5kIG5vbi1wcmludGluZ1xyXG5cdFx0Ly8gY29udHJvbCBjaGFyYWN0ZXJzLCBpbmNsdWRpbmcgYW55IGVtYmVkZGVkIGNhcnJpYWdlLXJldHVybiAoQ1IpIGFuZCBsaW5lLWZlZWQgKExGKSBjaGFyYWN0ZXJzLFxyXG5cdFx0Ly8gZnJvbSBhbnkgc3RyaW5nIGl0IGlzIGhhbmRlZC4gdGhpcyBpcyBhbHNvIHVzZWQgYnkgdGhlICdoYXNoc3RyaW5nJyBmdW5jdGlvbiAoYmVsb3cpIHRvIGhlbHBcclxuXHRcdC8vIHVzZXJzIGFsd2F5cyBvYnRhaW4gdGhlIHNhbWUgRUZGRUNUSVZFIHVoZXBybmcgc2VlZGluZyBrZXkuXHJcblx0XHRyYW5kb20uY2xlYW5TdHJpbmcgPSBmdW5jdGlvbiggaW5TdHIgKSB7XHJcblx0XHRcdGluU3RyID0gaW5TdHIucmVwbGFjZSgvKF5cXHMqKXwoXFxzKiQpL2dpLFwiXCIpOyAvLyByZW1vdmUgYW55L2FsbCBsZWFkaW5nIHNwYWNlc1xyXG5cdFx0XHRpblN0ciA9IGluU3RyLnJlcGxhY2UoL1tcXHgwMC1cXHgxRl0vZ2ksXCJcIik7XHQvLyByZW1vdmUgYW55L2FsbCBjb250cm9sIGNoYXJhY3RlcnNcclxuXHRcdFx0aW5TdHIgPSBpblN0ci5yZXBsYWNlKC9cXG4gLyxcIlxcblwiKTtcdFx0XHRcdC8vIHJlbW92ZSBhbnkvYWxsIHRyYWlsaW5nIHNwYWNlc1xyXG5cdFx0XHRyZXR1cm4gaW5TdHI7XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIHJldHVybiB0aGUgY2xlYW5lZCB1cCByZXN1bHRcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Ly8gdGhpcyBFWFBPUlRFRCBcImhhc2ggc3RyaW5nXCIgZnVuY3Rpb24gaGFzaGVzIHRoZSBwcm92aWRlZCBjaGFyYWN0ZXIgc3RyaW5nIGFmdGVyIGZpcnN0IHJlbW92aW5nXHJcblx0XHQvLyBhbnkgbGVhZGluZyBvciB0cmFpbGluZyBzcGFjZXMgYW5kIGlnbm9yaW5nIGFueSBlbWJlZGRlZCBjYXJyaWFnZSByZXR1cm5zIChDUikgb3IgTGluZSBGZWVkcyAoTEYpXHJcblx0XHRyYW5kb20uaGFzaFN0cmluZyA9IGZ1bmN0aW9uKCBpblN0ciApIHtcclxuXHRcdFx0aW5TdHIgPSByYW5kb20uY2xlYW5TdHJpbmcoIGluU3RyICk7XHJcblx0XHRcdG1hc2goIGluU3RyICk7XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIHVzZSB0aGUgc3RyaW5nIHRvIGV2b2x2ZSB0aGUgJ21hc2gnIHN0YXRlXHJcblx0XHRcdGZvciAoIGkgPSAwOyBpIDwgaW5TdHIubGVuZ3RoOyBpKyspIHtcdFx0XHQvLyBzY2FuIHRocm91Z2ggdGhlIGNoYXJhY3RlcnMgaW4gb3VyIHN0cmluZ1xyXG5cdFx0XHRcdGsgPSBpblN0ci5jaGFyQ29kZUF0KCBpICk7XHRcdFx0XHRcdFx0Ly8gZ2V0IHRoZSBjaGFyYWN0ZXIgY29kZSBhdCB0aGUgbG9jYXRpb25cclxuXHRcdFx0XHRmb3IgKGogPSAwOyBqIDwgbzsgaisrKSB7XHRcdFx0XHRcdFx0Ly9cdFwibWFzaFwiIGl0IGludG8gdGhlIFVIRVBSTkcgc3RhdGVcclxuXHRcdFx0XHRcdHNbal0gLT0gbWFzaCggayApO1xyXG5cdFx0XHRcdFx0aWYgKHNbal0gPCAwKSBzW2pdICs9IDE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cdFx0XHRcdFxyXG5cdFx0Ly8gdGhpcyBoYW5keSBleHBvcnRlZCBmdW5jdGlvbiBpcyB1c2VkIHRvIGFkZCBlbnRyb3B5IHRvIG91ciB1aGVwcm5nIGF0IGFueSB0aW1lXHJcblx0XHRyYW5kb20uYWRkRW50cm9weSA9IGZ1bmN0aW9uKCAvKiBhY2NlcHQgemVybyBvciBtb3JlIGFyZ3VtZW50cyAqLyApIHtcclxuXHRcdFx0dmFyIGFyZ3MgPSBbXTtcclxuXHRcdFx0Zm9yICggaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKysgKSBhcmdzLnB1c2goIGFyZ3VtZW50c1tpXSApO1xyXG5cdFx0XHRoYXNoKCAoaysrKSArIChuZXcgRGF0ZSgpLmdldFRpbWUoKSkgKyBhcmdzLmpvaW4oJycpICsgTWF0aC5yYW5kb20oKSApO1xyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0Ly8gaWYgd2Ugd2FudCB0byBwcm92aWRlIGEgZGV0ZXJtaW5pc3RpYyBzdGFydHVwIGNvbnRleHQgZm9yIG91ciBQUk5HLFxyXG5cdFx0Ly8gYnV0IHdpdGhvdXQgZGlyZWN0bHkgc2V0dGluZyB0aGUgaW50ZXJuYWwgc3RhdGUgdmFyaWFibGVzLCB0aGlzIGFsbG93c1xyXG5cdFx0Ly8gdXMgdG8gaW5pdGlhbGl6ZSB0aGUgbWFzaCBoYXNoIGFuZCBQUk5HJ3MgaW50ZXJuYWwgc3RhdGUgYmVmb3JlIHByb3ZpZGluZ1xyXG5cdFx0Ly8gc29tZSBoYXNoaW5nIGlucHV0XHJcblx0XHRyYW5kb20uaW5pdFN0YXRlID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdG1hc2goKTtcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIHBhc3MgYSBudWxsIGFyZyB0byBmb3JjZSBtYXNoIGhhc2ggdG8gaW5pdFxyXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgbzsgaSsrKSBzW2ldID0gbWFzaCggJyAnICk7XHQvLyBmaWxsIHRoZSBhcnJheSB3aXRoIGluaXRpYWwgbWFzaCBoYXNoIHZhbHVlc1xyXG5cdFx0XHRjID0gMTtcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vIGluaXQgb3VyIG11bHRpcGx5LXdpdGgtY2FycnkgY2FycnlcclxuXHRcdFx0cCA9IG87XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBpbml0IG91ciBwaGFzZVxyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0Ly8gd2UgdXNlIHRoaXMgKG9wdGlvbmFsKSBleHBvcnRlZCBmdW5jdGlvbiB0byBzaWduYWwgdGhlIEphdmFTY3JpcHQgaW50ZXJwcmV0ZXJcclxuXHRcdC8vIHRoYXQgd2UncmUgZmluaXNoZWQgdXNpbmcgdGhlIFwiTWFzaFwiIGhhc2ggZnVuY3Rpb24gc28gdGhhdCBpdCBjYW4gZnJlZSB1cCB0aGVcclxuXHRcdC8vIGxvY2FsIFwiaW5zdGFuY2UgdmFyaWFibGVzXCIgaXMgd2lsbCBoYXZlIGJlZW4gbWFpbnRhaW5pbmcuICBJdCdzIG5vdCBzdHJpY3RseVxyXG5cdFx0Ly8gbmVjZXNzYXJ5LCBvZiBjb3Vyc2UsIGJ1dCBpdCdzIGdvb2QgSmF2YVNjcmlwdCBjaXRpemVuc2hpcC5cclxuXHRcdHJhbmRvbS5kb25lID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdG1hc2ggPSBudWxsO1xyXG5cdFx0fTtcclxuXHJcblx0XHQvLyB3aGVuIG91ciBtYWluIG91dGVyIFwidWhlcHJuZ1wiIGZ1bmN0aW9uIGlzIGNhbGxlZCwgYWZ0ZXIgc2V0dGluZyB1cCBvdXJcclxuXHRcdC8vIGluaXRpYWwgdmFyaWFibGVzIGFuZCBlbnRyb3BpYyBzdGF0ZSwgd2UgcmV0dXJuIGFuIFwiaW5zdGFuY2UgcG9pbnRlclwiXHJcblx0XHQvLyB0byB0aGUgaW50ZXJuYWwgYW5vbnltb3VzIGZ1bmN0aW9uIHdoaWNoIGNhbiB0aGVuIGJlIHVzZWQgdG8gYWNjZXNzXHJcblx0XHQvLyB0aGUgdWhlcHJuZydzIHZhcmlvdXMgZXhwb3J0ZWQgZnVuY3Rpb25zLiAgQXMgd2l0aCB0aGUgXCIuZG9uZVwiIGZ1bmN0aW9uXHJcblx0XHQvLyBhYm92ZSwgd2Ugc2hvdWxkIHNldCB0aGUgcmV0dXJuZWQgdmFsdWUgdG8gJ251bGwnIG9uY2Ugd2UncmUgZmluaXNoZWRcclxuXHRcdC8vIHVzaW5nIGFueSBvZiB0aGVzZSBmdW5jdGlvbnMuXHJcblx0XHRyZXR1cm4gcmFuZG9tO1xyXG4gIH0gKCkpO1xyXG59O1xyXG5cclxuLypcdD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHRUaGlzIGlzIGJhc2VkIHVwb24gSm9oYW5uZXMgQmFhZ29lJ3MgY2FyZWZ1bGx5IGRlc2lnbmVkIGFuZCBlZmZpY2llbnQgaGFzaFxyXG5cdGZ1bmN0aW9uIGZvciB1c2Ugd2l0aCBKYXZhU2NyaXB0LiAgSXQgaGFzIGEgcHJvdmVuIFwiYXZhbGFuY2hlXCIgZWZmZWN0IHN1Y2hcclxuXHR0aGF0IGV2ZXJ5IGJpdCBvZiB0aGUgaW5wdXQgYWZmZWN0cyBldmVyeSBiaXQgb2YgdGhlIG91dHB1dCA1MCUgb2YgdGhlIHRpbWUsXHJcblx0d2hpY2ggaXMgZ29vZC5cdFNlZTogaHR0cDovL2JhYWdvZS5jb20vZW4vUmFuZG9tTXVzaW5ncy9oYXNoL2F2YWxhbmNoZS54aHRtbFxyXG5cdD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuKi9cclxuZnVuY3Rpb24gTWFzaCgpIHtcclxuXHR2YXIgbiA9IDB4ZWZjODI0OWQ7XHJcblx0dmFyIG1hc2ggPSBmdW5jdGlvbihkYXRhKSB7XHJcblx0XHRpZiAoIGRhdGEgKSB7XHJcblx0XHRcdGRhdGEgPSBkYXRhLnRvU3RyaW5nKCk7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdG4gKz0gZGF0YS5jaGFyQ29kZUF0KGkpO1xyXG5cdFx0XHRcdHZhciBoID0gMC4wMjUxOTYwMzI4MjQxNjkzOCAqIG47XHJcblx0XHRcdFx0biA9IGggPj4+IDA7XHJcblx0XHRcdFx0aCAtPSBuO1xyXG5cdFx0XHRcdGggKj0gbjtcclxuXHRcdFx0XHRuID0gaCA+Pj4gMDtcclxuXHRcdFx0XHRoIC09IG47XHJcblx0XHRcdFx0biArPSBoICogMHgxMDAwMDAwMDA7IC8vIDJeMzJcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gKG4gPj4+IDApICogMi4zMjgzMDY0MzY1Mzg2OTYzZS0xMDsgLy8gMl4tMzJcclxuXHRcdH0gZWxzZSBuID0gMHhlZmM4MjQ5ZDtcclxuXHR9O1xyXG4gIHJldHVybiBtYXNoO1xyXG59XHJcbiIsIi8qXHJcbiAqIG9zd2ViIFxyXG4gKiAgXHJcbiAqIEFuIGV4cGVyaW1lbnQgcmVzZWFyY2ggdG9vbCB3cml0dGVuIGluIEphdmFzY3JpcHQgYW5kIEhUTUwgdG8gYmUgdXNlZCBpbiBcclxuICogUXVhbHRyaWNzIG9yIG90aGVyIHdlYi1iYXNlZCB0b29scy4gQmFzZWQgdXBvbiBPcGVuU2VzYW1lLiAgICAgICAgIFxyXG4gKlxyXG4gKiBBdXRob3I6IGRycy4gSi4gQm9zXHJcbiAqXHJcbiAqIENvcHlyaWdodCAoYykgVW5pdmVyc2l0eSBvZiBHcm9uaW5nZW4gXHJcbiAqIEZhY3VsdHkgb2YgQmVoYXZpb3VyYWwgYW5kIFNvY2lhbCBTY2llbmNlc1xyXG4gKiBUZWNobmljYWwgU3VwcG9ydCBTZXJ2aWNlIFxyXG4gKlxyXG4gKi9cclxuXHJcbi8vIFVzZSBzdHJpY3QgbW9kZS4gICAgIFxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbi8vIFNldCBvc3dlYiBuYW1lc3BhY2UuXHJcbnRoaXMub3N3ZWIgPSB0aGlzLm9zd2VifHx7fTtcclxuXHJcbi8vIERlZmluaXRpb24gb2Ygb3N3ZWIgdmVyc2lvbiBjb25zdGFudHMuIFxyXG5vc3dlYi5WRVJTSU9OX05BTUUgICA9ICdvc3dlYic7XHJcbm9zd2ViLlZFUlNJT05fTlVNQkVSID0gJzAuMDM5ICgxOC0wNy0yMDE2KSc7XHJcblxyXG4vLyBEZWZpbml0aW9uIG9mIG9zd2ViIGNsYXNzIHV0aWxpdHkgbWV0aG9kcy5cclxub3N3ZWIuZXh0ZW5kQ2xhc3MgPSBmdW5jdGlvbihzdWJfY2xhc3MsIHN1cGVyX2NsYXNzKSB7XHJcbiAgICBmdW5jdGlvbiBvKCkgeyBcclxuICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gc3ViX2NsYXNzOyBcclxuICAgIH1cclxuICAgIG8ucHJvdG90eXBlID0gc3VwZXJfY2xhc3MucHJvdG90eXBlO1xyXG4gICAgcmV0dXJuIChzdWJfY2xhc3MucHJvdG90eXBlID0gbmV3IG8oKSk7XHJcbn07IFxyXG5cclxub3N3ZWIuaXNDbGFzcyA9IGZ1bmN0aW9uKGNsYXNzX25hbWUpIHtcclxuICAgIC8vIFJldHVybiB0cnVlIGlmIHRoZSBjbGFzc25hbWUgaXMgZGVmaW5lZCB3aXRoaW4gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIHJldHVybiAodGhpc1tjbGFzc19uYW1lXSAhPT0gdW5kZWZpbmVkKTtcclxufTtcclxuXHJcbm9zd2ViLm5ld0l0ZW1DbGFzcyA9IGZ1bmN0aW9uKHR5cGUsIGV4cGVyaW1lbnQsIG5hbWUsIHN0cmluZykge1xyXG4gICAgLy8gQ3JlYXRlIHRoZSBlbGVtZW50LlxyXG4gICAgdmFyIGVsZW1lbnQgPSBuZXcgdGhpc1t0eXBlXShleHBlcmltZW50LCBuYW1lLCBzdHJpbmcpO1xyXG4gICBcclxuICAgIC8vIFNldCB0aGUgdHlwZSBvZiB0aGUgaXRlbS5cclxuICAgIGVsZW1lbnQudHlwZSA9IHR5cGU7XHJcbiAgICBcclxuICAgIC8vIFJldHVybiB0aGUgZWxlbWVudFxyXG4gICAgcmV0dXJuIGVsZW1lbnQ7XHJcbn07XHJcblxyXG5vc3dlYi5uZXdFbGVtZW50Q2xhc3MgPSBmdW5jdGlvbih0eXBlLCBza2V0Y2hwYWQsIHN0cmluZykge1xyXG4gICAgLy8gQ3JlYXRlIHRoZSBlbGVtZW50LlxyXG4gICAgdmFyIGVsZW1lbnQgPSBuZXcgdGhpc1t0eXBlXShza2V0Y2hwYWQsIHN0cmluZyk7XHJcbiAgICBcclxuICAgIC8vIFJldHVybiB0aGUgZWxlbWVudFxyXG4gICAgcmV0dXJuIGVsZW1lbnQ7XHJcbn07XHJcblxyXG5vc3dlYi5uZXdXaWRnZXRDbGFzcyA9IGZ1bmN0aW9uKHR5cGUsIGZvcm0sIHZhcmlhYmxlcykge1xyXG4gICAgLy8gQ3JlYXRlIHRoZSBlbGVtZW50LlxyXG4gICAgdmFyIHdpZGdldCA9IG5ldyB0aGlzW3R5cGVdKGZvcm0sIHZhcmlhYmxlcyk7XHJcbiAgIFx0XHJcbiAgICAvLyBSZXR1cm4gdGhlIGVsZW1lbnRcclxuICAgIHJldHVybiB3aWRnZXQ7XHJcbn07IFxyXG5cclxub3N3ZWIucHJvbW90ZUNsYXNzID0gZnVuY3Rpb24oc3ViX2NsYXNzLCBwcmVmaXgpIHtcclxuICAgIHZhciBzdWJQID0gc3ViX2NsYXNzLnByb3RvdHlwZSwgc3VwUCA9IChPYmplY3QuZ2V0UHJvdG90eXBlT2YmJk9iamVjdC5nZXRQcm90b3R5cGVPZihzdWJQKSl8fHN1YlAuX19wcm90b19fO1xyXG4gICAgaWYgKHN1cFApIHtcclxuICAgIFx0c3ViUFsocHJlZml4Kz1cIl9cIikgKyBcImNvbnN0cnVjdG9yXCJdID0gc3VwUC5jb25zdHJ1Y3RvcjsgXHJcbiAgICBcdGZvciAodmFyIG4gaW4gc3VwUCkge1xyXG4gICAgICAgICAgICBpZiAoc3ViUC5oYXNPd25Qcm9wZXJ0eShuKSAmJiAodHlwZW9mIHN1cFBbbl0gPT09IFwiZnVuY3Rpb25cIikpIHtcclxuICAgICAgICAgICAgICAgIHN1YlBbcHJlZml4ICsgbl0gPSBzdXBQW25dOyBcclxuICAgICAgICAgICAgfVxyXG5cdH1cclxuICAgIH1cclxuICAgIHJldHVybiBzdWJfY2xhc3M7XHJcbn07IFxyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgY29uc3RhbnRzLlxyXG4gICAgZnVuY3Rpb24gY29uc3RhbnRzKCkge1xyXG4gICAgXHR0aHJvdyAnVGhlIGNsYXNzIGNvbnN0YW50cyBjYW5ub3QgYmUgaW5zdGFudGlhdGVkISc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBlcnJvciBjb25zdGFudHMuIFxyXG4gICAgY29uc3RhbnRzLkVSUk9SXzAwMSA9ICdvc3dlYiBoYXMgc3RvcHBlZCBydW5uaW5nIGR1ZSBhIGZhdGFsIGVycm9yLic7XHJcbiAgICBjb25zdGFudHMuRVJST1JfMDAyID0gJ05vIGNvbnRlbnQgcGFyYW1ldGVyIHNwZWNpZmllZC4nO1xyXG4gICAgY29uc3RhbnRzLkVSUk9SXzAwMyA9ICdObyBjb250ZXh0IHBhcmFtZXRlciBzcGVjaWZpZWQuJztcclxuICAgIGNvbnN0YW50cy5FUlJPUl8wMDQgPSAnSW52YWxpZCBzY3JpcHRJRCBvciBzY3JpcHRVUkwgZm9yIHJldHJpZXZpbmcgc2NyaXB0IGZyb20gZXh0ZXJuYWwgbG9jYXRpb24uJztcclxuICAgIGNvbnN0YW50cy5FUlJPUl8wMDUgPSAnRmFpbHVyZSB0byByZXRyaWV2ZSBzY3JpcHQgZnJvbSBleHRlcm5hbCBsb2NhdGlvbiAoQWpheCBjYWxsIGVycm9yKS4nO1xyXG4gICAgY29uc3RhbnRzLkVSUk9SXzAwNiA9ICdGYWlsdXJlIHRvIHJldHJpZXZlIHNjcmlwdCBmcm9tIGV4dGVybmFsIGxvY2F0aW9uIChkYXRhYmFzZSByZXNwb25zZSBlcnJvciknO1xyXG4gICAgY29uc3RhbnRzLkVSUk9SXzAwNyA9ICdGYWlsdXJlIHRvIHJldHJpZXZlIHNjcmlwdCBmcm9tIGV4dGVybmFsIGxvY2F0aW9uIChkYXRhYmFzZSByZXRyaWV2ZSBlcnJvcikuJztcclxuICAgIGNvbnN0YW50cy5FUlJPUl8wMDggPSAnSW52YWxpZCBzY3JpcHQgZGVmaW5pdGlvbiwgcGFyc2luZyBlcnJvci4nO1xyXG4gICAgY29uc3RhbnRzLkVSUk9SXzAwOSA9ICdVbmtub3duIGNsYXNzIGRlZmluaXRpb24gd2l0aGluIG9zd2ViIHNjcmlwdCAtICc7XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBtZXNzYWdlIGNvbnN0YW50cy4gXHJcbiAgICBjb25zdGFudHMuTUVTU0FHRV8wMDEgPSAnT3MnO1xyXG4gICAgY29uc3RhbnRzLk1FU1NBR0VfMDAyID0gJ3dlYiAtIHZlcnNpb24gJztcclxuICAgIGNvbnN0YW50cy5NRVNTQUdFXzAwMyA9ICdTdGFydCB1cCBvc3dlYiBleHBlcmltZW50IHNlc3Npb24uJztcclxuICAgIGNvbnN0YW50cy5NRVNTQUdFXzAwNCA9ICdSZXRyaWV2aW5nIHN0aW11bGkgZmlsZXMuJztcclxuICAgIGNvbnN0YW50cy5NRVNTQUdFXzAwNSA9ICdSZXRyaWV2aW5nIGlucHV0IHBhcmFtZXRlcnMuJztcclxuICAgIGNvbnN0YW50cy5NRVNTQUdFXzAwNiA9ICdQcmVzcyB3aXRoIHRoZSBtb3VzZSBvbiB0aGlzIHNjcmVlbiB0byBjb250aW51ZS4nO1xyXG4gICAgY29uc3RhbnRzLk1FU1NBR0VfMDA3ID0gJ1dhcm5pbmc6IHRoaXMgbWV0aG9kIGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGUgY3VycmVudCB2ZXJzaW9uIG9mIE9zV2ViIC0gJztcclxuICAgIGNvbnN0YW50cy5NRVNTQUdFXzAwOCA9ICdSZXRyaWV2aW5nIHNlc3Npb24gaW5mb3JtYXRpb24uJztcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIGdlbmVyYWwgY29uc3RhbnRzLiBcclxuICAgIGNvbnN0YW50cy5TVEFUVVNfTk9ORSA9IDA7ICAgICAgICAgICAgICAgICAgIC8vIFJ1bm5pbmcgc3RhdHVzIG9mIGFuIGl0ZW0uICAgXHJcbiAgICBjb25zdGFudHMuU1RBVFVTX0JVSUxEID0gMTtcclxuICAgIGNvbnN0YW50cy5TVEFUVVNfSU5JVElBTElaRSA9IDI7XHJcbiAgICBjb25zdGFudHMuU1RBVFVTX0VYRUNVVEUgPSAzO1xyXG4gICAgY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRSA9IDQ7XHJcbiAgICBjb25zdGFudHMuUEFSU0VSX05PTkUgPSAwOyAgICAgICAgICAgICAgICAgICAvLyBSdW5uaW5nIHN0YXR1cyBvZiB0aGUgcGFyc2VyLlxyXG4gICAgY29uc3RhbnRzLlBBUlNFUl9FWEVDVVRFID0gMTtcclxuICAgIGNvbnN0YW50cy5TVEFUVVNfUEVORElORyA9IDI7XHJcbiAgICBjb25zdGFudHMuU1RBVFVTX0RPTkUgPSAzO1xyXG4gICAgY29uc3RhbnRzLlBSRVNTRVNfT05MWSA9IDE7ICAgICAgICAgICAgICAgICAgLy8gVHlwZSBvZiB1c2VkIGNvbGxlY3Rpb24gbW9kZS4gICAgICAgICAgIFxyXG4gICAgY29uc3RhbnRzLlJFTEVBU0VTX09OTFkgPSAyO1xyXG4gICAgY29uc3RhbnRzLlBSRVNTRVNfQU5EX1JFTEVBU0VTID0gMztcclxuICAgIGNvbnN0YW50cy5SRVNQT05TRV9OT05FID0gMDsgICAgICAgICAgICAgICAgIC8vIFR5cGUgb2YgcmVzcG9uc2UgdXNlZC5cclxuICAgIGNvbnN0YW50cy5SRVNQT05TRV9EVVJBVElPTiA9IDE7XHJcbiAgICBjb25zdGFudHMuUkVTUE9OU0VfS0VZQk9BUkQgPSAyO1xyXG4gICAgY29uc3RhbnRzLlJFU1BPTlNFX01PVVNFID0gMztcclxuICAgIGNvbnN0YW50cy5SRVNQT05TRV9TT1VORCA9IDQ7XHJcbiAgICBjb25zdGFudHMuUkVTUE9OU0VfQVVUT0tFWUJPQVJEID0gNTtcclxuICAgIGNvbnN0YW50cy5SRVNQT05TRV9BVVRPTU9VU0UgPSA2O1xyXG4gICAgY29uc3RhbnRzLlVQREFURV9OT05FID0gMDsgICAgICAgICAgICAgICAgICAvLyBJdGVtIHVwZGF0ZSBzdGF0dXMgZmxhZy5cclxuICAgIGNvbnN0YW50cy5VUERBVEVfT05TRVQgPSAxO1xyXG4gICAgY29uc3RhbnRzLlVQREFURV9PRkZTRVQgPSAyO1xyXG4gICAgY29uc3RhbnRzLlNFUVVFTlRJQUwgPSAwOyAgICAgICAgICAgICAgICAgICAvLyBMb29wIHJhbmRvbWl6YXRpb24gdHlwZS5cclxuICAgIGNvbnN0YW50cy5SQU5ET00gPSAxO1xyXG4gICAgY29uc3RhbnRzLlJBTkRPTVJFUExBQ0VNRU5UID0gMjtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBjb25zdGFudHMgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmNvbnN0YW50cyA9IGNvbnN0YW50cztcclxufSgpKTsgXHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbi8vIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGNhbnZhcy5cclxuICAgIGZ1bmN0aW9uIGNhbnZhcyhleHBlcmltZW50LCBhdXRvX3ByZXBhcmUpIHtcclxuXHQvLyBzZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG4gICAgICAgIHRoaXMuYXV0b19wcmVwYXJlID0gKHR5cGVvZiBhdXRvX3ByZXBhcmUgPT09ICd1bmRlZmluZWQnKSA/IHRydWUgOiBhdXRvX3ByZXBhcmU7ICAgICAgICAgICAgICAvLyBTZXQgYXV0b3ByZXBhcmUgdG9nZ2xlIChub3Qgc3VwcG9ydGVkIHlldCkuIFx0XHJcbiAgICAgICAgdGhpcy5leHBlcmltZW50ID0gKHR5cGVvZiBleHBlcmltZW50ID09PSAndW5kZWZpbmVkJykgPyBvc3dlYi5ydW5uZXIuZXhwZXJpbWVudCA6IGV4cGVyaW1lbnQ7IC8vIEFuY2hvciB0byB0aGUgZXhwZXJpbWVudCBvYmplY3QuXHJcblx0XHRcclxuICAgICAgICAvLyBTZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIFx0dGhpcy5iYWNrZ3JvdW5kX2NvbG9yID0gdGhpcy5leHBlcmltZW50LnZhcnMuYmFja2dyb3VuZDsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQmFja2dyb3B1bmQgY29sb3Igb2YgY2FudmFzLiAgICAgXHJcbiAgICAgICAgdGhpcy5iaWRpID0gKHRoaXMuZXhwZXJpbWVudC52YXJzLmJpZGkgPT09ICd5ZXMnKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdHJ1ZSBiaWRpIG1vZGUgaXMgZW5hYmxlZC5cclxuICAgICAgICB0aGlzLmNvbG9yID0gdGhpcy5leHBlcmltZW50LnZhcnMuZm9yZWdvdW5kOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3JlZ3JvdW5kIGNvbG9yIG9mIGNhbnZhcy5cclxuICAgICAgICB0aGlzLmZpbGwgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0cnVlIGZpbGwgbW9kZSBpcyB1c2VkLlxyXG4gICAgICAgIHRoaXMuZm9udF9ib2xkID0gKHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfYm9sZCA9PT0gJ3llcycpOyAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRydWUgZm9udCBzdHlsZSBib2xkIGlzIGVuYWJsZWQuXHJcbiAgICAgICAgdGhpcy5mb250X2ZhbWlseSA9ICh0aGlzLmV4cGVyaW1lbnQudmFycy5mb250X2ZhbWlseSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmFtaWx5IG5hbWUgb2YgdGhlIGZvbnQgdXNlZC5cclxuICAgICAgICB0aGlzLmZvbnRfaXRhbGljID0gKHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfaXRhbGljID09PSAneWVzJyk7ICAgICAgICAgICAgICAgICAvLyBJZiB0cnVlIGZvbnQgc3R5bGUgaXRhbGljIGlzIGVuYWJsZWQuXHJcbiAgICAgICAgdGhpcy5mb250X3NpemUgPSAodGhpcy5leHBlcmltZW50LnZhcnMuZm9udF9zaXplKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2l6ZSBvZiB0aGUgZm9udCBpbiBwaXhlbHMuXHJcbiAgICAgICAgdGhpcy5mb250X3VuZGVybGluZSA9ICh0aGlzLmV4cGVyaW1lbnQudmFycy5mb250X3VuZGVybGluZSA9PT0gJ3llcycpOyAgICAgICAgICAgLy8gSWYgdHJ1ZSBmb250IHN0eWxlIHVuZGVybGluZSBpcyBlbmFibGVkLlxyXG4gICAgICAgIHRoaXMuaHRtbCA9IHRydWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRydWUgaHRtbCBpcyB1c2VkIChub3Qgc3VwcG9ydGVkIHlldCkuXHJcbiAgICAgICAgdGhpcy5wZW53aWR0aCA9IDE7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmYXVsdCBwZW53aWR0aCBmb3IgZHJhd2luZyBzaGFwZXMuIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgcHJpdmF0ZSBwcm9wZXJ0aWVzLiAgXHJcbiAgICBcdHRoaXMuX2NvbnRhaW5lciA9IG5ldyBjcmVhdGVqcy5Db250YWluZXIoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVBU0VMSlM6IENvbnRhaW5lciB3aGljaCBob2xkcyB0aGUgc2hhcGVzXHJcbiAgICAgICAgdGhpcy5fZm9udF9zdHJpbmcgPSAnYm9sZCAxOHB4IENvdXJpZXIgTmV3JzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRUFTRUxKUzogRGVmYXVsdCBmb250IGRlZmluaXRpb24gc3RyaW5nLlxyXG5cdHRoaXMuX2hlaWdodCA9IG9zd2ViLnJ1bm5lci5fY2FudmFzLmhlaWdodDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhlaWdodCBvZiB0aGUgSFRNTCBjYW52YXMgdXNlZCBmb3IgZHJhd2luZy5cclxuXHR0aGlzLl93aWR0aCA9IG9zd2ViLnJ1bm5lci5fY2FudmFzLndpZHRoOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXaWR0aCBvZiB0aGUgSFRNTCBjYW52YXMgdXNlZCBmb3IgZHJhd2luZy5cclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBjYW52YXMucHJvdG90eXBlO1xyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuYXV0b19wcmVwYXJlPSBmYWxzZTtcclxuICAgIHAuZXhwZXJpbWVudCA9IG51bGw7XHJcbiAgICBwLnVuaWZvcm1fY29vcmRpbmF0ZXMgPSBmYWxzZTtcclxuXHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzLiBcclxuICAgIFxyXG4gICAgcC5fYXJyb3dfc2hhcGUgPSBmdW5jdGlvbihzeCwgc3ksIGV4LCBleSwgYm9keV9sZW5ndGgsIGJvZHlfd2lkdGgsIGhlYWRfd2lkdGgpIHtcclxuICAgICAgICAvLyBMZW5ndGhcclxuICAgICAgICB2YXIgZCA9IE1hdGguc3FydChNYXRoLnBvdyhleSAtIHN5LDIpICsgTWF0aC5wb3coc3ggLSBleCwyKSk7XHJcbiAgICAgICAgdmFyIGFuZ2xlID0gTWF0aC5hdGFuMihleSAtIHN5LCBleCAtIHN4KTtcclxuXHR2YXIgX2hlYWRfd2lkdGggPSAoMSAtIGJvZHlfd2lkdGgpIC8gMi4wO1xyXG5cdGJvZHlfd2lkdGggPSBib2R5X3dpZHRoIC8gMi4wO1xyXG5cdFxyXG4gICAgICAgIC8vIGNhbGN1bGF0ZSBjb29yZGluYXRlc1xyXG5cdHZhciBwNCA9IFtleCwgZXldO1xyXG5cdHZhciBwMSA9IFtzeCArIGJvZHlfd2lkdGggKiBoZWFkX3dpZHRoICogTWF0aC5jb3MoYW5nbGUgLSBNYXRoLlBJIC8gMiksIHN5ICsgYm9keV93aWR0aCAqIGhlYWRfd2lkdGggKiBNYXRoLnNpbihhbmdsZSAtIE1hdGguUEkgLyAyKV07XHJcblx0dmFyIHAyID0gW3AxWzBdICsgYm9keV9sZW5ndGggKiBNYXRoLmNvcyhhbmdsZSkgKiBkLCBwMVsxXSArIGJvZHlfbGVuZ3RoICogTWF0aC5zaW4oYW5nbGUpICogZF07XHJcblx0dmFyIHAzID0gW3AyWzBdICsgX2hlYWRfd2lkdGggKiBoZWFkX3dpZHRoICogTWF0aC5jb3MoYW5nbGUgLSBNYXRoLlBJIC8gMiksIHAyWzFdICsgX2hlYWRfd2lkdGggKiBoZWFkX3dpZHRoICogTWF0aC5zaW4oYW5nbGUgLSBNYXRoLlBJIC8gMildO1xyXG5cdHZhciBwNyA9IFtzeCArIGJvZHlfd2lkdGggKiBoZWFkX3dpZHRoICogTWF0aC5jb3MoYW5nbGUgKyBNYXRoLlBJIC8gMiksIHN5ICsgYm9keV93aWR0aCAqIGhlYWRfd2lkdGggKiBNYXRoLnNpbihhbmdsZSArIE1hdGguUEkgLyAyKV07XHJcblx0dmFyIHA2ID0gW3A3WzBdICsgYm9keV9sZW5ndGggKiBNYXRoLmNvcyhhbmdsZSkgKiBkLCBwN1sxXSArIGJvZHlfbGVuZ3RoICogTWF0aC5zaW4oYW5nbGUpICogZF07XHJcblx0dmFyIHA1ID0gW3A2WzBdICsgX2hlYWRfd2lkdGggKiBoZWFkX3dpZHRoICogTWF0aC5jb3MoYW5nbGUgKyBNYXRoLlBJIC8gMiksIHA2WzFdICsgX2hlYWRfd2lkdGggKiBoZWFkX3dpZHRoICogTWF0aC5zaW4oYW5nbGUgKyBNYXRoLlBJIC8gMildO1xyXG5cdFxyXG4gICAgICAgIHJldHVybiBbcDEsIHAyLCBwMywgcDQsIHA1LCBwNiwgcDddO1xyXG4gICAgfTsgICAgXHJcbiAgICAgICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzLiBcclxuICAgIFxyXG4gICAgcC5hcnJvdyA9IGZ1bmN0aW9uIChzeCwgc3ksIGV4LCBleSwgY29sb3IsIHBlbndpZHRoLCBib2R5X2xlbmd0aCwgYm9keV93aWR0aCwgaGVhZF93aWR0aCwgZmlsbCkge1xyXG4gICAgICAgIHZhciBwb2ludHMgPSB0aGlzLl9hcnJvd19zaGFwZShzeCwgc3ksIGV4LCBleSwgYm9keV93aWR0aCwgYm9keV9sZW5ndGgsIGhlYWRfd2lkdGgpO1xyXG4gICAgXHR2YXIgc2hhcGUgPSBuZXcgY3JlYXRlanMuU2hhcGUoKTtcclxuXHRzaGFwZS5ncmFwaGljcy5zZXRTdHJva2VTdHlsZShwZW53aWR0aCk7XHJcblx0c2hhcGUuZ3JhcGhpY3MuYmVnaW5TdHJva2UoY29sb3IpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNoYXBlLmdyYXBoaWNzLm1vdmVUbyhwb2ludHNbMF1bMF0scG9pbnRzWzBdWzFdKTtcclxuXHRzaGFwZS5ncmFwaGljcy5saW5lVG8ocG9pbnRzWzFdWzBdLHBvaW50c1sxXVsxXSk7XHJcblx0c2hhcGUuZ3JhcGhpY3MubGluZVRvKHBvaW50c1syXVswXSxwb2ludHNbMl1bMV0pO1xyXG5cdHNoYXBlLmdyYXBoaWNzLmxpbmVUbyhwb2ludHNbM11bMF0scG9pbnRzWzNdWzFdKTtcclxuXHRzaGFwZS5ncmFwaGljcy5saW5lVG8ocG9pbnRzWzRdWzBdLHBvaW50c1s0XVsxXSk7XHJcblx0c2hhcGUuZ3JhcGhpY3MubGluZVRvKHBvaW50c1s1XVswXSxwb2ludHNbNV1bMV0pO1xyXG5cdHNoYXBlLmdyYXBoaWNzLmxpbmVUbyhwb2ludHNbNl1bMF0scG9pbnRzWzZdWzFdKTtcclxuXHRzaGFwZS5ncmFwaGljcy5saW5lVG8ocG9pbnRzWzBdWzBdLHBvaW50c1swXVsxXSk7XHJcblx0XHJcbiAgICAgICBcdC8vIEFkZCB0aGUgbGluZSBpdGVtIHRvIGNvbnRhaW5lci5cclxuXHR0aGlzLl9jb250YWluZXIuYWRkQ2hpbGQoc2hhcGUpOyBcclxuICAgIH07IFxyXG4gICAgXHRcdFxyXG4gICAgcC5jaXJjbGUgPSBmdW5jdGlvbih4LCB5LCByLCBmaWxsLCBjb2xvciwgcGVud2lkdGgpIHtcclxuXHR2YXIgc2hhcGUgPSBuZXcgY3JlYXRlanMuU2hhcGUoKTtcclxuXHRzaGFwZS5ncmFwaGljcy5zZXRTdHJva2VTdHlsZShwZW53aWR0aCk7XHJcblx0c2hhcGUuZ3JhcGhpY3MuYmVnaW5TdHJva2UoY29sb3IpO1xyXG5cdGlmIChmaWxsID09IDEpXHJcblx0e1xyXG4gICAgICAgICAgICBzaGFwZS5ncmFwaGljcy5iZWdpbkZpbGwoY29sb3IpO1xyXG5cdH1cclxuXHRzaGFwZS5ncmFwaGljcy5kcmF3Q2lyY2xlKHgsIHksIHIpO1xyXG5cdFx0XHJcblx0Ly8gQWRkIHRoZSBsaW5lIGl0ZW0gdG8gY29udGFpbmVyLlxyXG5cdHRoaXMuX2NvbnRhaW5lci5hZGRDaGlsZChzaGFwZSk7IFxyXG4gICAgfTtcclxuXHJcbiAgICBwLmNsZWFyID0gZnVuY3Rpb24oYmFja3JvdW5kX2NvbG9yKSB7XHJcblx0Ly8gUmVtb3ZlIHRoZSBjb250YWluZXIgZnJvbSB0aGUgc3RhZ2Ugb2JqZWN0LlxyXG5cdG9zd2ViLnJ1bm5lci5fc3RhZ2UucmVtb3ZlQ2hpbGQodGhpcy5fY29udGFpbmVyKTtcclxuXHRcclxuICAgICAgICAvLyBSZW1vdmUgdGhlIGNoaWxkcmVuIGZyb20gdGhlIGNvbnRhaW5lci5cclxuICAgICAgICB0aGlzLl9jb250YWluZXIucmVtb3ZlQWxsQ2hpbGRyZW4oKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5jbG9zZV9kaXNwbGF5ID0gZnVuY3Rpb24oZXhwZXJpbWVudCkge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ2NhbnZhcy5jbG9zZV9kaXNwbGF5KCkuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuY29weSA9IGZ1bmN0aW9uKGNhbnZhcykge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ2NhbnZhcy5jb3B5KCkuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZWxsaXBzZSA9IGZ1bmN0aW9uKHgsIHksIHcsIGgsIGZpbGwsIGNvbG9yLCBwZW53aWR0aCkge1xyXG5cdHZhciBzaGFwZSA9IG5ldyBjcmVhdGVqcy5TaGFwZSgpO1xyXG5cdHNoYXBlLmdyYXBoaWNzLnNldFN0cm9rZVN0eWxlKHBlbndpZHRoKTtcclxuXHRzaGFwZS5ncmFwaGljcy5iZWdpblN0cm9rZShjb2xvcik7XHJcblx0aWYgKGZpbGwgPT0gMSlcclxuXHR7XHJcbiAgICAgICAgICAgIHNoYXBlLmdyYXBoaWNzLmJlZ2luRmlsbChjb2xvcik7XHJcblx0fVxyXG5cdHNoYXBlLmdyYXBoaWNzLmRyYXdFbGxpcHNlKHgsIHksIHcsIGgpOyBcclxuXHJcblx0Ly8gQWRkIHRoZSB0ZXh0IGl0ZW0gdG8gdGhlIHBhcnRlbiBmcmFtZS5cclxuXHR0aGlzLl9jb250YWluZXIuYWRkQ2hpbGQoc2hhcGUpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmZpeGRvdCA9IGZ1bmN0aW9uKHgsIHksIGNvbG9yLCBzdHlsZSkge1xyXG4gICAgICAgIC8vIENoZWNrIHRoZSBjb2xvciBhbmQgc3R5bGUgYXJndW1lbnRzLiAgICAgIFxyXG4gICAgICAgIGNvbG9yID0gKHR5cGVvZiBjb2xvciA9PT0gJ3VuZGVmaW5lZCcpID8gJ3doaXRlJyA6IGNvbG9yO1xyXG4gICAgICAgIHN0eWxlID0gKHR5cGVvZiBzdHlsZSA9PT0gJ3VuZGVmaW5lZCcpID8gJ2RlZmF1bHQnIDogc3R5bGU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHR5cGVvZiB4ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy51bmlmb3JtX2Nvb3JkaW5hdGVzID09PSB0cnVlKSB7XHJcblx0XHR4ID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHggPSB0aGlzLl93aWR0aCAvIDI7XHJcbiAgICAgICAgICAgIH1cclxuXHR9XHJcblx0aWYgKHR5cGVvZiB5ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy51bmlmb3JtX2Nvb3JkaW5hdGVzID09PSB0cnVlKSB7XHJcblx0XHR5ID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuXHRcdHkgPSB0aGlzLl9oZWlnaHQgLyAyO1xyXG4gICAgICAgICAgICB9XHRcclxuXHR9XHJcblx0XHRcclxuXHR2YXIgcyA9IDQ7XHJcblx0dmFyIGggPSAyO1xyXG5cdGlmIChzdHlsZS5pbmRleE9mKCdsYXJnZScpICE9PSAtMSkge1xyXG4gICAgICAgICAgICBzID0gMTY7XHJcblx0fVxyXG5cdGVsc2UgaWYgKChzdHlsZS5pbmRleE9mKCdtZWRpdW0nKSAhPT0gLTEpIHx8IChzdHlsZSA9PT0gJ2RlZmF1bHQnKSkge1xyXG4gICAgICAgICAgICBzID0gODtcclxuXHR9XHJcblx0ZWxzZSBpZiAoc3R5bGUuaW5kZXhPZignc21hbGwnKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgcyA9IDQ7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG4gICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignVW5rbm93biBzdHlsZTogJyArIHN0eWxlKTtcclxuXHR9XHRcclxuXHRcdFxyXG5cdGlmICgoc3R5bGUuaW5kZXhPZignb3BlbicpICE9PSAtMSkgfHwgKHN0eWxlID09PSAnZGVmYXVsdCcpKSB7XHRcclxuICAgICAgICAgICAgdGhpcy5lbGxpcHNlKHggLSBzLCB5IC0gcywgMiAqIHMsIDIgKiBzLCAxLCBjb2xvciwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuZWxsaXBzZSh4IC0gaCwgeSAtIGgsIDIgKiBoLCAyICogaCwgMSwgJ2JsYWNrJywgMSk7XHJcblx0fVxyXG5cdGVsc2UgaWYgKHN0eWxlLmluZGV4T2YoJ2ZpbGxlZCcpICE9PSAtMSlcdHtcdFxyXG4gICAgICAgICAgICB0aGlzLmVsbGlwc2UoeCAtIHMsIHkgLSBzLCAyICogcywgMiAqIHMsIDEsIGNvbG9yLCAxKTtcclxuXHR9XHJcbiAgICAgICAgZWxzZSBpZiAoc3R5bGUuaW5kZXhPZignY3Jvc3MnKSAhPT0gLTEpXHR7XHJcbiAgICAgICAgICAgIHRoaXMubGluZSh4LCB5IC0gcywgeCwgeSArIHMpO1xyXG4gICAgICAgICAgICB0aGlzLmxpbmUoeCAtIHMsIHksIHggKyBzLCB5KTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcbiAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKCdVbmtub3duIHN0eWxlOiAnICsgc3R5bGUpO1xyXG5cdH1cdFxyXG4gICAgfTtcclxuXHJcbiAgICBwLmdhYm9yID0gZnVuY3Rpb24oeCwgeSwgb3JpZW50LCBmcmVxLCBlbnYsIHNpemUsIHN0ZGV2LCBwaGFzZSwgY29sb3IxLCBjb2xvcjIsIGJnbW9kZSkge1xyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ2NhbnZhcy5nYWJvcigpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmhlaWdodCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHRyZXR1cm4gdGhpcy5faGVpZ3RoKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuaW1hZ2UgPSBmdW5jdGlvbihmbmFtZSwgY2VudGVyLCB4LCB5LCBzY2FsZSkge1xyXG5cdC8vIFNldCB0aGUgY2xhc3MgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuXHR2YXIgaW1hZ2UgPSBuZXcgY3JlYXRlanMuQml0bWFwKCk7XHJcbiAgICAgICAgaW1hZ2UuaW1hZ2UgPSBmbmFtZS5kYXRhO1xyXG5cdGltYWdlLnNjYWxlWCA9IHNjYWxlO1xyXG4gICAgICAgIGltYWdlLnNjYWxlWSA9IHNjYWxlO1xyXG4gICAgICAgIGltYWdlLnNuYXBUb1BpeGVsID0gdHJ1ZTtcclxuICAgICAgICBpbWFnZS54ID0geCAtICgoaW1hZ2UuaW1hZ2Uud2lkdGggICogc2NhbGUpIC8gMik7XHJcbiAgICBcdGltYWdlLnkgPSB5IC0gKChpbWFnZS5pbWFnZS5oZWlnaHQgKiBzY2FsZSkgLyAyKTtcclxuXHRcclxuXHQvLyBBZGQgdGhlIHRleHQgaXRlbSB0byB0aGUgcGFydGVuIGZyYW1lLlxyXG5cdHRoaXMuX2NvbnRhaW5lci5hZGRDaGlsZChpbWFnZSk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5pbml0X2Rpc3BsYXkgPSBmdW5jdGlvbihleHBlcmltZW50KSB7XHJcblx0Ly8gU2V0IHRoZSBkaW1lbnNpb24gcHJvcGVydGllcy5cclxuXHR0aGlzLl9oZWlnaHQgPSBleHBlcmltZW50LnZhcnMuaGVpZ2h0O1xyXG4gICAgXHR0aGlzLl93aWR0aCAgPSBleHBlcmltZW50LnZhcnMud2lkdGg7XHJcblx0XHJcblx0Ly8gSW5pdGlhbGl6ZSB0aGUgZGlzcGxheSBkaW1lbnNpb25zLlxyXG5cdG9zd2ViLnJ1bm5lci5fY2FudmFzLmhlaWdodCA9IGV4cGVyaW1lbnQudmFycy5oZWlnaHQ7XHJcblx0b3N3ZWIucnVubmVyLl9jYW52YXMud2lkdGggID0gZXhwZXJpbWVudC52YXJzLndpZHRoO1xyXG5cdFx0XHJcblx0Ly8gSW5pdGlhbGl6ZSB0aGUgZGlzcGxheSBjb2xvci5cclxuXHRvc3dlYi5ydW5uZXIuX2NhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kID0gZXhwZXJpbWVudC52YXJzLmJhY2tncm91bmQ7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY3Vyc29yIHZpc2liaWxpdHkgdG8gbm9uZSAoZGVmYXVsdCkuXHJcbiAgICAgICAgb3N3ZWIucnVubmVyLl9jYW52YXMuc3R5bGUuY3Vyc29yID0gJ25vbmUnO1xyXG5cclxuICAgICAgICAvLyBTZXQgZm9jdXMgdG8gdGhlIGV4cGVyaW1lbnQgY2FudmFzLlxyXG4gICAgICAgIG9zd2ViLnJ1bm5lci5fY2FudmFzLmZvY3VzKCk7IFxyXG4gICAgfTtcclxuXHJcbiAgICBwLmxpbmUgPSBmdW5jdGlvbihzeCwgc3ksIGV4LCBleSwgY29sb3IsIHBlbndpZHRoKSB7XHJcbiAgICBcdHZhciBzaGFwZSA9IG5ldyBjcmVhdGVqcy5TaGFwZSgpO1xyXG5cdHNoYXBlLmdyYXBoaWNzLnNldFN0cm9rZVN0eWxlKHBlbndpZHRoKTtcclxuXHRzaGFwZS5ncmFwaGljcy5iZWdpblN0cm9rZShjb2xvcik7XHJcblx0c2hhcGUuZ3JhcGhpY3MubW92ZVRvKHN4LCBzeSk7XHJcblx0c2hhcGUuZ3JhcGhpY3MubGluZVRvKGV4LCBleSk7IFxyXG5cclxuXHQvLyBBZGQgdGhlIGxpbmUgaXRlbSB0byBjb250YWluZXIuLlxyXG5cdHRoaXMuX2NvbnRhaW5lci5hZGRDaGlsZChzaGFwZSk7IFxyXG4gICAgfTtcclxuXHRcclxuICAgIHAubm9pc2VfcGF0Y2ggPSBmdW5jdGlvbihwWCwgcFksIHBFbnYsIHBTaXplLCBwU3RkZXYsIHBDb2xvcjEsIHBDb2xvcjIsIHBCZ21vZGUpIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICdjYW52YXMubm9pc2VfcGF0Y2goKS4nKTtcclxuICAgIH07XHJcblx0XHJcbiAgICBwLnBvbHlnb24gPSBmdW5jdGlvbih2ZXJ0aWNsZXMpIHtcclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyArICdjYW52YXMucG9seWdvbigpLicpO1xyXG4gICAgfTtcclxuXHRcclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgfTtcclxuXHRcclxuICAgIHAucmVjdCA9IGZ1bmN0aW9uKHgsIHksIHcsIGgsIGZpbGwsIGNvbG9yLCBwZW53aWR0aCkge1xyXG4gICAgXHR2YXIgc2hhcGUgPSBuZXcgY3JlYXRlanMuU2hhcGUoKTtcclxuXHRzaGFwZS5ncmFwaGljcy5zZXRTdHJva2VTdHlsZShwZW53aWR0aCk7XHJcblx0c2hhcGUuZ3JhcGhpY3MuYmVnaW5TdHJva2UoY29sb3IpO1xyXG5cdGlmIChmaWxsID09IDEpXHJcblx0e1xyXG4gICAgICAgICAgICBzaGFwZS5ncmFwaGljcy5iZWdpbkZpbGwoY29sb3IpO1xyXG5cdH1cclxuXHRzaGFwZS5ncmFwaGljcy5yZWN0KHgsIHksIHcsIGgpOyBcclxuXHJcblx0Ly8gQWRkIHRoZSBsaW5lIGl0ZW0gdG8gY29udGFpbmVyLi5cclxuXHR0aGlzLl9jb250YWluZXIuYWRkQ2hpbGQoc2hhcGUpOyBcclxuICAgIH07XHJcblx0XHJcbiAgICBwLnNldF9mb250ID0gZnVuY3Rpb24oZmFtaWx5LCBzaXplLCBpdGFsaWMsIGJvbGQsIHVuZGVybGluZSkge1xyXG4gICBcdC8vIERlZmluZSB0aGUgdGhlIGZvbnQgc3R5bGVzLlxyXG4gICAgXHR2YXIgZm9udF9ib2xkID0gKGJvbGQgPT09IHRydWUpID8gJ2JvbGQgJyA6ICcnO1xyXG4gICAgICAgIHZhciBmb250X2l0YWxpYyA9IChpdGFsaWMgPT09IHRydWUpID8gJ2l0YWxpYyAnIDogJyc7XHJcbiAgICAgICAgdmFyIGZvbnRfdW5kZXJsaW5lID0gKHVuZGVybGluZSA9PT0gdHJ1ZSkgPyAndW5kZXJsaW5lICcgOiAnJztcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIGZvbnQgc3RyaW5nLlxyXG4gICAgICAgIHRoaXMuX2ZvbnRfc3RyaW5nID0gZm9udF9ib2xkICsgZm9udF9pdGFsaWMgKyBmb250X3VuZGVybGluZSArIHNpemUgKyAncHggJyArIGZhbWlseTsgXHJcbiAgICAgfTtcclxuICAgICAgICBcclxuICAgIHAuc2hvdyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHQvLyBBZGQgdGhlIGNvbnRhaW5lciB0byB0aGUgc3RhZ2Ugb2JqZWN0IGFuZCB1cGRhdGUgdGhlIHN0YWdlLlxyXG5cdG9zd2ViLnJ1bm5lci5fc3RhZ2UuYWRkQ2hpbGQodGhpcy5fY29udGFpbmVyKTtcclxuXHRvc3dlYi5ydW5uZXIuX3N0YWdlLnVwZGF0ZSgpOyBcclxuXHJcblx0Ly8gUmV0dXJuIHRoZSBjdXJyZW50IHRpbWUuXHJcblx0aWYgKHRoaXMuZXhwZXJpbWVudCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGVyaW1lbnQuY2xvY2sudGltZSgpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgZWxzZSB7ICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5zaXplID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIENyZWF0ZSBvYmplY3QgdHVwbGUuXHJcbiAgICBcdHZhciBzaXplID0ge3dpZHRoOiB0aGlzLl93aWR0aCwgaGVpZ2h0OiB0aGlzLl9oZWlnaHR9O1xyXG5cdHJldHVybiBzaXplO1xyXG4gICAgfTtcclxuXHRcclxuICAgIHAudGV4dCA9IGZ1bmN0aW9uKHRleHQsIGNlbnRlciwgeCwgeSAsIGNvbG9yLCBodG1sKSB7XHJcblx0Ly8gQ3JlYXRlIHRoZSB0ZXh0IGVsZW1lbnQuICAgICAgICAgIFxyXG5cdHZhciB0ZXh0X2VsZW1lbnQgPSBuZXcgY3JlYXRlanMuVGV4dCh0ZXh0LCB0aGlzLl9mb250X3N0cmluZywgY29sb3IpO1xyXG5cclxuXHQvLyBTZXQgdGhlIHRleHQgZWxlbWVudCBwcm9wZXJ0aWVzLlxyXG5cdHRleHRfZWxlbWVudC54ID0geCAtICh0ZXh0X2VsZW1lbnQuZ2V0TWVhc3VyZWRXaWR0aCgpIC8gMik7XHJcblx0dGV4dF9lbGVtZW50LnkgPSB5IC0gKHRleHRfZWxlbWVudC5nZXRNZWFzdXJlZEhlaWdodCgpIC8gMik7XHJcblx0XHQgXHJcblx0Ly8gQWRkIHRoZSB0ZXh0IGl0ZW0gdG8gdGhlIHBhcnRlbiBmcmFtZS5cclxuXHR0aGlzLl9jb250YWluZXIuYWRkQ2hpbGQodGV4dF9lbGVtZW50KTtcclxuICAgIH07XHJcblxyXG4gICAgcC50ZXh0X3NpemUgPSBmdW5jdGlvbih0ZXh0LCBtYXhfd2lkdGgsIHN0eWxlX2FyZ3MpIHtcclxuICAgICAgICAvLyBSZXR1cm4gdGhlIHRleHQgc2l6ZSBpbiBwaXhlbHMuXHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnY2FudmFzLnRleHRfc2l6ZSgpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBjYW52YXMgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmNhbnZhcyA9IGNhbnZhcztcclxufSgpKTtcclxuXHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBjbG9jay5cclxuICAgIGZ1bmN0aW9uIGNsb2NrKGV4cGVyaW1lbnQpIHtcclxuICAgICAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgcHJvcGVydGllcy4gXHJcbiAgICAgICAgdGhpcy5fc3RhcnRUaW1lID0gdGhpcy5fbm93KCk7ICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGltZSBhbmNob3Igb2YgdGhlIGV4cGVyaW1lbnQuXHJcblx0XHRcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLmV4cGVyaW1lbnQgPSBleHBlcmltZW50OyAgICAgICAgICAgICAgICAgICAgICAvLyBBbmNob3IgdG8gdGhlIGV4cGVyaW1lbnQgb2JqZWN0LlxyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IGNsb2NrLnByb3RvdHlwZTtcclxuICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmV4cGVyaW1lbnQgPSBudWxsO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzLiAgIFxyXG4gICAgXHJcbiAgICBwLl9ub3cgPSBmdW5jdGlvbigpIHtcclxuXHQvLyBHZXQgdGhlIGN1cnJlbnQgdGltZSBzdGFtcCB1c2luZyB0aGUgYmVzdCBhdmFpbGFibGUgdGltaW5nIG1ldGhvZC5cclxuXHRpZiAod2luZG93LnBlcmZvcm1hbmNlLm5vdykge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh3aW5kb3cucGVyZm9ybWFuY2Uubm93KCkpO1xyXG5cdH0gXHJcblx0ZWxzZSBpZiAod2luZG93LnBlcmZvcm1hbmNlLndlYmtpdE5vdykge1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh3aW5kb3cucGVyZm9ybWFuY2Uud2Via2l0Tm93KCkpO1xyXG5cdH0gXHJcblx0ZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMuICAgXHJcblxyXG4gICAgcC5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gU2V0IHRoZSBhYnNvbHV0ZSBzdGFydCB0aW1lIG9mIHRoZSBleHBlaXJtZW50LlxyXG4gICAgICAgIHRoaXMuX3N0YXJ0VGltZSA9IHRoaXMuX25vdygpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnNsZWVwID0gZnVuY3Rpb24oZHVyYXRpb24pIHtcclxuICAgICAgICAvLyBTbGVlcHMgKHBhdXNlcykgZm9yIGEgZHVyYXRpb24gKGluIG1pbGxpc2Vjb25kcykuXHJcblx0aWYgKHRoaXMuZXhwZXJpbWVudCAhPT0gIG51bGwpIHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBldmVudCBwcm9jZXNzb3IuXHJcbiAgICAgICAgICAgIG9zd2ViLmV2ZW50cy5fcnVuKHRoaXMsIGR1cmF0aW9uLCBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfRFVSQVRJT04sIG51bGwpO1xyXG5cdH1cclxuICAgIH07XHJcblx0XHJcbiAgICBwLnRpbWUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBHaXZlcyB0aGUgY3VycmVudCB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzLiBcclxuICAgICAgICBpZiAodGhpcy5fc3RhcnRUaW1lICE9PSAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gKHRoaXMuX25vdygpIC0gdGhpcy5fc3RhcnRUaW1lKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuIFx0XHJcbiAgICAvLyBCaW5kIHRoZSBjbG9jayBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuY2xvY2sgPSBjbG9jaztcclxufSgpKTtcclxuXHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBrZXlib2FyZC5cclxuICAgIGZ1bmN0aW9uIGtleWJvYXJkKGV4cGVyaW1lbnQsIHRpbWVvdXQsIGtleWxpc3QpIHtcclxuICAgICAgICAvLyBTZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLmV4cGVyaW1lbnQgPSBleHBlcmltZW50OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFuY2hvciB0byB0aGUgZXhwZXJpbWVudCBvYmplY3QuIFxyXG5cdHRoaXMua2V5bGlzdCA9ICh0eXBlb2Yga2V5bGlzdCA9PT0gJ3VuZGVmaW5lZCcpID8gW10gOiBrZXlsaXN0O1x0ICAgICAgIC8vIExpc3Qgb2YgYWNjZXB0YWJsZSByZXNwb25zZSBrZXlzLiBcclxuXHR0aGlzLnRpbWVvdXQgPSAodHlwZW9mIHRpbWVvdXQgPT09ICd1bmRlZmluZWQnKSA/IG51bGwgOiB0aW1lb3V0OyAgICAgIC8vIER1cmF0aW9uIGluIG1pbGxpc2Vjb25kIGZvciB0aW1lLW91dC5cclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBrZXlib2FyZC5wcm90b3R5cGU7XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5leHBlcmltZW50ID0gbnVsbDtcclxuICAgIHAua2V5bGlzdCA9IFtdO1xyXG4gICAgcC50aW1lb3V0ID0gbnVsbDtcclxuXHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIHN5bm9uaWVtIG1hcCBmb3IgYWxsIGtleXMuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgcC5TWU5PTklFTV9NQVAgPSBbWycgJywnc3BhY2UnLCdTUEFDRSddLFsnXCInLCdxdW90ZWRibCcsJ1FVT1RFREJMJ10sWychJywnZXhjbGFpbScsJ0VYQ0xBSU0nXSxbJyMnLCdoYXNoJywnSEFTSCddLFxyXG4gICAgICAgIFsnJCcsJ2RvbGxhcicsJ0RPTExBUiddLFsnJicsJ2FtcGVyc2FuZCcsJ0FNUEVSU0FORCddLFtcIidcIiwncXVvdGUnLCdRVU9URSddLFsnKCcsJ2xlZnRicmFja2V0JywnbGVmdHBhcmVuJywnTEVGVEJSQUNLRVQnLCdMRUZUUEFSRU4nXSxcclxuICAgICAgICBbJyknLCdyaWdodGJyYWNrZXQnLCdyaWdodHBhcmVuJywnUklHSFRCUkFDS0VUJywnUklHSFRQQVJFTiddLFsnKicsJ2FzdGVyaWtzJywnQVNURVJJU0snXSxbJysnLCdwbHVzJywnUExVUyddLFsnLCcsJ2NvbW1hJywnQ09NTUEnXSxcclxuICAgICAgICBbJy0nLCdtaW51cycsJ01JTlVTJ10sWycuJywncGVyaW9kJywnUEVSSU9EJ10sWycvJywnc2xhc2gnLCdTTEFTSCddLFxyXG4gICAgICAgIFsnMSddLFsnMiddLFsnMyddLFsnNCddLFsnNSddLFsnNiddLFsnNyddLFsnOCddLFsnOSddLFsnMCddLFsnPScsJ2VxdWFscycsJ0VRVUFMUyddLFxyXG4gICAgICAgIFsnOicsJ2NvbG9uJywnQ09MT04nXSxbJzsnLCdzZW1pY29sb24nLCdTRU1JQ09MT04nXSxbJzwnLCdsZXNzJywnTEVTUyddLFsnPicsJ2dyZWF0ZXInLCdHUkVBVEVSJ10sXHJcbiAgICAgICAgWyc/JywncXVlc3Rpb24nLCdRVUVTVElPTiddLFsnQCcsJ2F0JywnQVQnXSxcclxuICAgICAgICBbJ2EnLCdBJ10sWydiJywnQiddLFsnYycsJ0MnXSxbJ2QnLCdEJ10sWydlJywnRSddLFsnZicsJ0YnXSxcclxuICAgICAgICBbJ2cnLCdHJ10sWydoJywnSCddLFsnaScsJ0knXSxbJ2onLCdKJ10sWydrJywnSyddLFsnbCcsJ0wnXSxcclxuICAgICAgICBbJ20nLCdNJ10sWyduJywnTiddLFsnbycsJ08nXSxbJ3AnLCdQJ10sWydxJywnUSddLFsncicsJ1InXSxcclxuICAgICAgICBbJ3MnLCdTJ10sWyd0JywnVCddLFsndScsJ1UnXSxbJ3YnLCdWJ10sWyd3JywnVyddLFsneCcsJ1gnXSxcclxuICAgICAgICBbJ3knLCdZJ10sWyd6JywnWiddLFxyXG4gICAgICAgIFsna3AwJywnS1AwJ10sWydrcDEnLCdLUDEnXSxbJ2twMicsJ0tQMiddLFsna3AzJywnS1AzJ10sWydrcDQnLCdLUDQnXSxbJ2twNScsJ0tQNSddLFsna3A2JywnS1A2J10sWydrcDcnLCdLUDcnXSxbJ2twOCcsJ0tQOCddLFsna3A5JywnS1A5J10sICBcclxuICAgICAgICBbJ2twX2RpdmlkZScsJ0tQX0RJVklERSddLFsna3BfZW50ZXInLCdLUF9FTlRFUiddLFsna3BfZXF1YWxzJywnS1BfRVFVQUxTJ10sWydrcF9taW51cycsJ0tQX01JTlVTJ10sWydrcF9tdWx0aXBseScsJ0tQX01VTFRJUExZJ10sWydrcF9wZXJpb2QnLCdLUF9QRVJJT0QnXSxbJ2twX3BsdXMnLCdLUF9QTFVTJ10sXHJcbiAgICAgICAgWydcXFxcJywnYmFja3NsYXNoJywnQkFDS1NMQVNIJ10sWydeJywncG93ZXInLCdjYXJldCcsJ1BPV0VSJywnQ0FSRVQnXSxbJ18nLCd1bmRlcnNjb3JlJywnVU5ERVJTQ09SRSddLFsnYCcsJ2JhY2txdW90ZScsJ0JBQ0tRVU9URSddLFxyXG4gICAgICAgIFsnZjEnLCdGMScsJ2hlbHAnLCdIRUxQJ10sWydmMicsJ0YyJ10sWydmMycsJ0YzJ10sWydmNCcsJ0Y0J10sWydmNScsJ0Y1J10sWydmNicsJ0Y2J10sXHJcbiAgICAgICAgWydmNycsJ0Y3J10sWydmOCcsJ0Y4J10sWydmOScsJ0Y5J10sWydmMTAnLCdGMTAnXSxbJ2YxMScsJ0YxMSddLFsnZjEyJywnRjEyJ10sXHJcbiAgICAgICAgWydmMTMnLCdGMTMnXSxbJ2YxNCcsJ0YxNCddLFsnZjE1JywnRjE1J10sXHJcbiAgICAgICAgWyd1cCcsJ1VQJ10sWydkb3duJywnRE9XTiddLFsnbGVmdCcsJ0xFRlQnXSxbJ3JpZ2h0JywnUklHSFQnXSxbJ21lbnUnLCdNRU5VJ10sXHJcbiAgICAgICAgWydsc2hpZnQnLCdsZWZ0IHNoaWZ0JywnTFNISUZUJywnTEVGVCBTSElGVCddLFsnbGN0cmwnLCdsZWZ0IGN0cmwnLCdMQ1RSTCcsJ0xFRlQgQ1RSTCddLFsnbGFsdCcsJ2xlZnQgYWx0JywnTEFMVCcsJ0xFRlQgQUxUJ10sXHJcbiAgICAgICAgWydyc2hpZnQnLCdyaWdodCBzaGlmdCcsJ1JTSElGVCcsJ1JJR0hUIFNISUZUJ10sWydyY3RybCcsJ3JpZ2h0IGN0cmwnLCdSQ1RSTCcsJ1JJR0hUIENUUkwnXSxbJ3JhbHQnLCdyaWdodCBhbHQnLCdhbHQgZ3InLCdSQUxUJywnUklHSFQgQUxUJywnQUxUIEdSJ10sXHJcbiAgICAgICAgWydwYWdlIHVwJywncGFnZXVwJywnUEFHRSBVUCcsJ1BBR0VVUCddLFsncGFnZSBkb3duJywncGFnZWRvd24nLCdQQUdFIERPV04nLCdQQUdFRE9XTiddLFsncGF1c2UnLCdQQVVTRSddLFxyXG4gICAgICAgIFsnc2Nyb2xsIGxvY2snLCdzY3JvbGxvY2snLCdTQ1JPTEwgTE9DSycsJ1NDUk9MTE9DSyddLFsnY2FwcyBsb2NrJywnY2Fwc2xvY2snLCdDQVBTIExPQ0snLCdDQVBTTE9DSyddLFsnbnVtbWxvY2snLCdOVU1NTE9DSyddLFxyXG4gICAgICAgIFsnY2xlYXInLCdDTEVBUiddLFsnZW50ZXInLCdFTlRFUicsJ3JldHVybicsJ1JFVFVSTiddLFsndGFiJywnVEFCJ10sWydiYWNrc3BhY2UnLCdCQUNLU1BBQ0UnXSxbJ2VuZCcsJ0VORCddLFsnaG9tZScsJ0hPTUUnXSxbJ2luc2VydCcsJ0lOU0VSVCddLFsnZGVsZXRlJywnREVMRVRFJ10sXHJcbiAgICAgICAgWydzeXNyZXEnLCdzeXMgcmVxJywnU1lTUkVRJywnU1lTIFJFUSddLFsnYnJlYWsnLCdCUkVBSyddLFsnZXNjYXBlJywnRVNDQVBFJ10sWydwcmludCcsJ1BSSU5UJ10sWydwcmludCBzY3JlZW4nLCdQUklOVCBTQ1JFRU4nXSxcclxuICAgICAgICBbJ2xtZXRhJywnbGVmdCBtZXRhJywnTE1FVEEnLCdMRUZUIE1FVEEnLCwnbHN1cGVyJywnTFNVUEVSJywnbGVmdCBzdXBlcicsJ0xFRlQgU1VQRVInXSwgICAgICAgICAgICAgICAgICBcclxuICAgICAgICBbJ3JtZXRhJywncmlnaHQgbWV0YScsJ1JNRVRBJywnUklHSFQgTUVUQScsJ3JzdXBlcicsJ3JpZ2h0IHN1cGVyJywnUlNVUEVSJywnUklHSFQgU1VQRVInXSwgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAvLyBrZXkgZGVmaW5lZCBiZWxvdyBhcmUgbm90IHN1cHBvcnRlZCB5ZXQuXHJcbiAgICAgICAgWydldXJvJywnRVVSTyddLFsnZmlyc3QnLCdGSVJTVCddLFsnbGFzdCcsJ0xBU1QnXSxbJ2twIGVudGVyJywnS1AgRU5URVInXSxbJ2twIGVxdWFscycsJ0tQIEVRVUFMUyddLFxyXG4gICAgICAgIFsnbW9kZScsJ01PREUnXSxbJ3Vua25vd24nLCdVTktOT1dOJ10sWyd1bmtub3duIGtleScsJ1VOS05PV04gS0VZJ11dOyAgXHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMuXHJcblxyXG4gICAgcC5fZ2V0X2RlZmF1bHRfZnJvbV9zeW5vbmllbSA9IGZ1bmN0aW9uKHJlc3BvbnNlcykge1xyXG4gICAgICAgIHZhciBkZWZhdWx0cyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwO2kgPCByZXNwb25zZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHN5bm9uaWVtID0gdGhpcy5zeW5vbnltcyhyZXNwb25zZXNbaV0pO1xyXG4gICAgICAgICAgICBkZWZhdWx0cy5wdXNoKHN5bm9uaWVtWzBdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRzOyAgICBcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMuXHJcblxyXG4gICAgcC5kZWZhdWx0X2NvbmZpZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIFJldHVybiB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uLlxyXG5cdHJldHVybiB7J3RpbWVvdXQnOiBudWxsLCAna2V5bGlzdCc6IFtdfTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHAuZmx1c2ggPSBmdW5jdGlvbigpIHtcclxuXHQvLyBDbGVhciBhbGwgcGVuZGluZyBrZXlib2FyZCBpbnB1dCwgbm90IGxpbWl0ZWQgdG8gdGhlIGtleWJvYXJkLlxyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ2tleWJvYXJkLmZsdXNoKCkuJyk7XHJcbiAgICB9O1xyXG4gXHRcclxuICAgIHAuZ2V0X2tleSA9IGZ1bmN0aW9uKHRpbWVvdXQsIGtleWxpc3QpIHtcclxuXHQvLyBDb2xsZWN0cyBhIHNpbmdsZSBrZXkgcHJlc3MuXHJcblx0dGhpcy5rZXlsaXN0ID0gKHR5cGVvZiBrZXlsaXN0ID09PSAndW5kZWZpbmVkJykgPyB0aGlzLmtleWxpc3QgOiBrZXlsaXN0O1x0XHJcblx0dGhpcy50aW1lb3V0ID0gKHR5cGVvZiB0aW1lb3V0ID09PSAndW5kZWZpbmVkJykgPyB0aGlzLnRpbWVvdXQgOiB0aW1lb3V0O1xyXG5cdFx0XHJcblx0aWYgKHRoaXMuZXhwZXJpbWVudCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgZXZlbnQgcHJvY2Vzc29yLlxyXG4gICAgICAgICAgICBvc3dlYi5ldmVudHMuX3J1bih0aGlzLCB0aGlzLnRpbWVvdXQsIG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRCwgdGhpcy5rZXlsaXN0KTtcclxuXHR9O1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmdldF9tb2RzID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdHZhciBtb2RlcmF0b3JzID0gW107XHJcbiAgICAgICAgaWYgKG9zd2ViLmV2ZW50cy5fa2V5Ym9hcmRfZXZlbnQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKG9zd2ViLmV2ZW50cy5fa2V5Ym9hcmRfZXZlbnQuc2hpZnRLZXkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIG1vZGVyYXRvcnMucHVzaCgnc2hpZnQnKTtcclxuICAgICAgICAgICAgfTsgICAgXHJcbiAgICAgICAgICAgIGlmIChvc3dlYi5ldmVudHMuX2tleWJvYXJkX2V2ZW50LmN0cmxLZXkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIG1vZGVyYXRvcnMucHVzaCgnY3RybCcpO1xyXG4gICAgICAgICAgICB9OyAgICBcclxuICAgICAgICAgICAgaWYgKG9zd2ViLmV2ZW50cy5fa2V5Ym9hcmRfZXZlbnQuYWx0S2V5ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBtb2RlcmF0b3JzLnB1c2goJ2FsdCcpO1xyXG4gICAgICAgICAgICB9OyAgICBcclxuICAgICAgICB9IFxyXG4gICAgICAgIHJldHVybiBtb2RlcmF0b3JzOyAgICBcclxuICAgIH07XHJcblxyXG4gICAgcC5zZXRfY29uZmlnID0gZnVuY3Rpb24odGltZW91dCwga2V5bGlzdCkge1xyXG5cdC8vIFNldCB0aGUgcHJvcGVydGllcy5cclxuXHR0aGlzLmtleWxpc3QgPSBrZXlsaXN0O1x0XHJcblx0dGhpcy50aW1lb3V0ID0gdGltZW91dDtcclxuICAgIH07XHJcblx0XHJcbiAgICBwLnNob3dfdmlydHVhbF9rZXlib2FyZCA9IGZ1bmN0aW9uKHZpc2libGUpIHtcclxuICAgICAgICAvLyBTaG93cyBvciBoaWRlcyBhIHZpcnR1YWwga2V5Ym9hcmQuXHRcdFxyXG4gICAgXHRpZiAodmlzaWJsZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAvLyBIYWNrIHRvIHNob3cgdGhlIHZpcnV0YWwga2V5Ym9hcmQuICMjIE11c3QgYmUgdGVzdGVkIVxyXG4gICAgICAgICAgICBvc3dlYi5ydW5uZXIuX2NhbnZhcy5zZXRmb2N1cygpO1xyXG5cdH1cclxuXHRlbHNlIHtcclxuICAgICAgICAgICAgLy8gSGFjayB0byBoaWRlIHRoZSB2aXJ0dWFsIGtleWJvYXJkLiAjIyBNdXN0IGJlIHRlc3RlZCFcclxuICAgICAgICAgICAgdmFyIHRtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0bXApO1xyXG4gICAgICAgICAgICB0bXAuZm9jdXMoKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0bXApO1xyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgcC5zeW5vbnltcyA9IGZ1bmN0aW9uKGJ1dHRvbikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgYnV0dG9uICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDtpIDwgdGhpcy5TWU5PTklFTV9NQVAubGVuZ3RoO2krKykge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7aiA8IHRoaXMuU1lOT05JRU1fTUFQW2ldLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuU1lOT05JRU1fTUFQW2ldW2pdID09IGJ1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5TWU5PTklFTV9NQVBbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSAgICBcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUga2V5Ym9hcmQgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmtleWJvYXJkID0ga2V5Ym9hcmQ7XHJcbn0oKSk7XHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBsb2cuXHJcbiAgICBmdW5jdGlvbiBsb2coZXhwZXJpbWVudCwgcGF0aCkge1xyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuICAgIFx0dGhpcy5fYWxsX3ZhcnMgPSBudWxsOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdHJ1ZSBhbGwgdmFyaWFibGVzIGFyZSB3cml0dGVuIHRvIHRoZSBsb2cuICBcclxuXHR0aGlzLl9oZWFkZXJfd3JpdHRlbiA9IGZhbHNlO1x0ICAgICAgICAgICAgICAgICAgIC8vIElmIHRydWUgdGhlIGhlYWRlciBoYXMgYmVlbiB3cml0dGVuIHRvIHRoZSBsb2cuXHJcblx0dGhpcy5fbG9nID0gW107ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXJyYXkgY29udGFpbmluZyB0aGUgbG9nIGVudHJpZXMuXHJcblx0dGhpcy5fcGF0aCA9ICcnOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGF0aCB0byB3aWNoIHRoZSBsb2cgaXMgd3JpdHRlbi5cclxuXHJcbiAgICAgICAgLy8gU2V0IHRoZSBjbGFzcyBwdWJsaWMgcHJvcGVydGllcy4gXHJcblx0dGhpcy5leHBlcmltZW50ID0gZXhwZXJpbWVudDsgICAgICAgICAgICAgICAgICAgICAgLy8gQW5jaG9yIHRvIHRoZSBleHBlcmltZW50IG9iamVjdC5cclxuICAgIFx0dGhpcy5leHBlcmltZW50LnZhcnMubG9nZmlsZSA9IHBhdGg7ICAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIHBhdGggbG9jYXRpb24gaW50byB0aGUgdmFycyBsaXN0LiAgIFxyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IGxvZy5wcm90b3R5cGU7XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5leHBlcmltZW50ID0gbnVsbDtcclxuXHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMuICAgXHJcblxyXG4gICAgcC5hbGxfdmFycyA9IGZ1bmN0aW9uKCkge1xyXG5cdC8vIFJldHJpZXZlcyBhIGxpc3Qgb2YgYWxsIHZhcmlhYmxlcyB0aGF0IGV4aXN0IGluIHRoZSBleHBlcmltZW50LlxyXG5cdGlmICh0aGlzLl9hbGxfdmFycyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9hbGxfdmFycyA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmluc3BlY3QoKTtcclxuXHR9XHJcblx0cmV0dXJuIHRoaXMuX2FsbF92YXJzO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNsb3NlID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gQ2xvc2VzIHRoZSBjdXJyZW50IGxvZy5cclxuXHRpZiAodGhpcy5fbG9nLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8gRWNobyB0aGUgZGF0YSB0byB0aGUgcnVubmVyLlxyXG4gICAgICAgICAgICBvc3dlYi5ydW5uZXIuZGF0YSA9IHRoaXMuX2xvZy5qb2luKCcnKTsgICAgXHJcbiAgICAgICAgfTtcclxuXHJcblx0Ly8gQ2xlYXIgdGhlIGxvZyBmaWxlLlxyXG5cdHRoaXMuX2xvZyA9IFtdO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmZsdXNoID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIEZsdXNoIHRoZSBsb2cgZmlsZS5cclxuICAgICAgICB0aGlzLl9sb2cgPSBbXTtcclxuICAgIH07XHJcblxyXG4gICAgcC5vcGVuID0gZnVuY3Rpb24ocGF0aCkge1x0XHJcblx0Ly8gT3BlbnMgdGhlIGN1cnJlbnQgbG9nLiBJZiBhIGxvZyB3YXMgYWxyZWFkeSBvcGVuLCBpdCBpcyBjbG9zZWQuXHJcblx0dGhpcy5faGVhZGVyX3dyaXR0ZW4gPSBmYWxzZTtcclxuXHR0aGlzLl9wYXRoID0gcGF0aDsgXHJcblx0XHJcblx0Ly8gQ2hlY2sgZm9yIG9sZCBkYXRhLlxyXG5cdGlmICh0aGlzLl9sb2cgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBkYXRhLlxyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcblx0fVxyXG4gICAgfTtcclxuXHJcbiAgICBwLndyaXRlID0gZnVuY3Rpb24obXNnLCBuZXdfbGluZSkge1xyXG4gICAgXHQvLyBXcml0ZSBvbmUgbWVzc2FnZSB0byB0aGUgbG9nLlxyXG5cdG5ld19saW5lID0gKHR5cGVvZiBuZXdfbGluZSA9PT0gJ3VuZGVmaW5lZCcpID8gdHJ1ZSA6IG5ld19saW5lO1xyXG5cdFxyXG5cdC8vIFdyaXRlIGEgbmV3IGxpbmUuXHJcblx0aWYgKG5ld19saW5lID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xvZy5wdXNoKG1zZyArICdcXG4nKTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFdyaXRlIHRoZSBNZXNzYWdlIGxpbmUuXHJcbiAgICAgICAgICAgIHRoaXMuX2xvZy5wdXNoKG1zZyk7XHJcblx0fVxyXG4gICAgfTtcclxuXHJcbiAgICBwLndyaXRlX3ZhcnMgPSBmdW5jdGlvbih2YXJfbGlzdCkge1xyXG4gICAgXHQvLyBXcml0ZXMgdmFyaWFibGVzIHRvIHRoZSBsb2cuXHJcblx0dmFyX2xpc3QgPSAodHlwZW9mIHZhcl9saXN0ID09PSAndW5kZWZpbmVkJykgPyBudWxsIDogdmFyX2xpc3Q7XHJcblx0XHRcclxuXHR2YXIgdmFsdWU7IFxyXG5cdHZhciBsID0gW107XHJcbiAgICAgICAgLy8gSWYgbm8gdmFyIGxpc3QgZGVmaW5lcywgcmV0cmlldmUgYWxsIHZhcmlhYmxlLlxyXG5cdGlmICh2YXJfbGlzdCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHZhcl9saXN0ID0gdGhpcy5hbGxfdmFycygpO1xyXG5cdH1cclxuXHJcbiAgICAgICAgLy8gU29ydCB0aGUgdmFyIGxpc3QuXHJcbiAgICAgICAgdmFyX2xpc3Quc29ydCgpO1xyXG4gICAgICAgIFxyXG5cdC8vIEFkZCB0aGUgaGVhZGVyIHRvIHRoZSBsb2cgZmlsZS5cclxuICAgICAgICBpZiAodGhpcy5faGVhZGVyX3dyaXR0ZW4gPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFyX2xpc3QubGVuZ3RoOyBpKyspIHtcclxuXHRcdGwucHVzaCgnXCInICsgdmFyX2xpc3RbaV0gKyAnXCInKTtcclxuICAgICAgICAgICAgfVx0XHRcclxuICAgICAgICAgICAgdGhpcy53cml0ZShsLmpvaW4oKSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2hlYWRlcl93cml0dGVuID0gdHJ1ZTtcclxuXHR9XHJcblx0XHRcclxuICAgICAgICAvLyBBZGQgdGhlIGRhdGEgZW50cmllcyB0byB0aGUgbG9nIGZpbGUuICAgICAgICBcclxuICAgICAgICBsID0gW107XHJcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCB2YXJfbGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmdldCh2YXJfbGlzdFtpXSwgJ05BJywgZmFsc2UpO1xyXG4gICAgICAgICAgICBsLnB1c2goJ1wiJyArIHZhbHVlICsgJ1wiJyk7XHJcblx0fVxyXG4gICAgICAgIHRoaXMud3JpdGUobC5qb2luKCkpO1xyXG4gICAgfTtcclxuIFx0XHJcbiAgICAvLyBCaW5kIHRoZSBsb2cgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmxvZyA9IGxvZztcclxufSgpKTtcclxuIiwiXHJcbihmdW5jdGlvbigpIHtcclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIG1vdXNlLlxyXG4gICAgZnVuY3Rpb24gbW91c2UoZXhwZXJpbWVudCwgdGltZW91dCwgYnV0dG9ubGlzdCwgdmlzaWJsZSlcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLmV4cGVyaW1lbnQgPSBleHBlcmltZW50OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW5jaG9yIHRvIHRoZSBleHBlcmltZW50IG9iamVjdC5cclxuXHR0aGlzLnRpbWVvdXQgPSAodHlwZW9mIHRpbWVvdXQgPT09ICd1bmRlZmluZWQnKSA/IG51bGwgOiB0aW1lb3V0OyAgICAgICAgICAgLy8gRHVyYXRpb24gaW4gbWlsbGlzZWNvbmQgZm9yIHRpbWUtb3V0LiBcclxuXHR0aGlzLmJ1dHRvbmxpc3QgPSAodHlwZW9mIGJ1dHRvbmxpc3QgPT09ICd1bmRlZmluZWQnKSA/IG51bGwgOiBidXR0b25saXN0OyAgLy8gTGlzdCBvZiBhY2NlcHRhYmxlIHJlc3BvbnNlIGJ1dHRvbnMuXHRcclxuXHR0aGlzLnZpc2libGUgPSAodHlwZW9mIHZpc2libGUgPT09ICd1bmRlZmluZWQnKSA/IGZhbHNlIDogdmlzaWJsZTtcdCAgICAvLyBpZiB0cnVlIHRoZSBtb3VzZSBjdXJzb3IgaXMgdmlzaWJsZS5cclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBtb3VzZS5wcm90b3R5cGU7XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5leHBlcmltZW50ID0gbnVsbDtcclxuICAgIHAuYnV0dG9ubGlzdCA9IFtdO1xyXG4gICAgcC50aW1lb3V0ID0gLTE7XHJcbiAgICBwLnZpc2libGUgPSBmYWxzZTtcclxuXHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIHN5bm9uaWVtIG1hcCBmb3IgYWxsIGtleXMuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgcC5TWU5PTklFTV9NQVAgPSBbWycxJywnbGVmdF9idXR0b24nXSwgWycyJywnbWlkZGxlX2J1dHRvbiddLCBbJzMnLCdyaWdodF9idXR0b24nXSwgWyc0Jywnc2Nyb2xsX3VwJ10sIFsnNScsJ3Njcm9sbF9kb3duJ11dO1xyXG4gICAgICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMuXHJcblxyXG4gICAgcC5fZ2V0X2RlZmF1bHRfZnJvbV9zeW5vbmllbSA9IGZ1bmN0aW9uKHJlc3BvbnNlcykge1xyXG4gICAgICAgIC8vIFJldHVybiB0aGUgZGVmYXVsdCBzeW5vbmllbSB2YWx1ZSBmcm9tIGEgcmVzcG9uc2UuXHJcbiAgICAgICAgdmFyIGRlZmF1bHRzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7aSA8IHJlc3BvbnNlcy5sZW5ndGg7aSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBzeW5vbmllbSA9IHRoaXMuc3lub255bXMocmVzcG9uc2VzW2ldKTtcclxuICAgICAgICAgICAgZGVmYXVsdHMucHVzaChzeW5vbmllbVswXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkZWZhdWx0czsgICAgXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgY2xhc3MgcHVibGljIG1ldGhvZHMuXHJcbiAgICBcclxuICAgIHAuZGVmYXVsdF9jb25maWcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBSZXR1cm4gdGhlIGRlZmF1bHQgY29uZmlndXJhdGlvbi5cclxuICAgICAgICByZXR1cm4geyd0aW1lb3V0JzogbnVsbCwgJ2J1dHRvbmxpc3QnOiBudWxsLCAndmlzaWJsZSc6IGZhbHNlfTtcclxuICAgIH07XHJcblxyXG4gICAgcC5mbHVzaCA9IGZ1bmN0aW9uKCkge1xyXG5cdC8vIENsZWFycyBhbGwgcGVuZGluZyBtb3VzZSBpbnB1dCwgbm90IGxpbWl0ZWQgdG8gdGhlIG1vdXNlLlxyXG4gICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2Uob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA3ICsgJ21vdXNlLmZsdXNoKCkuJyk7XHJcbiAgICB9O1xyXG4gXHRcclxuICAgIHAuZ2V0X2NsaWNrID0gZnVuY3Rpb24odGltZW91dCwgYnV0dG9ubGlzdCwgdmlzaWJsZSkge1xyXG5cdC8vIENvbGxlY3RzIGEgc2luZ2xlIG1vdXNlIGNsaWNrLlxyXG5cdHRoaXMudGltZW91dCA9ICh0eXBlb2YgdGltZW91dCA9PT0gJ3VuZGVmaW5lZCcpID8gdGhpcy50aW1lb3V0IDogdGltZW91dDtcclxuXHR0aGlzLmJ1dHRvbmxpc3QgPSAodHlwZW9mIGJ1dHRvbmxpc3QgPT09ICd1bmRlZmluZWQnKSA/IHRoaXMuYnV0dG9ubGlzdCA6IGJ1dHRvbmxpc3Q7XHRcclxuXHR0aGlzLnZpc2libGUgPSAodHlwZW9mIHZpc2libGUgPT09ICd1bmRlZmluZWQnKSA/IHRoaXMudmlzaWJsZSA6IHZpc2libGU7XHRcclxuXHJcblx0aWYgKHRoaXMuZXhwZXJpbWVudCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIC8vIEhpZGUgb3Igc2hvdyB0aGUgbW91c2UuXHJcbiAgICAgICAgICAgIHRoaXMuc2hvd19jdXJzb3IodGhpcy52aXNpYmxlKTtcclxuXHRcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBldmVudCBwcm9jZXNzb3IuXHJcbiAgICAgICAgICAgIG9zd2ViLmV2ZW50cy5fcnVuKHRoaXMsIHRoaXMudGltZW91dCwgb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX01PVVNFLCB0aGlzLmJ1dHRvbmxpc3QpO1xyXG5cdH07XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZ2V0X3BvcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHQvLyBSZXR1cm5zIHRoZSBjdXJyZW50IG1vdXNlIHBvc2l0aW9uLiAhV2FybmluZzogdGhpcyBtZXRob2RzIHVzZXMgdGhlIHN0YXRlIGluIHRoZSBsYXN0IGtub3duIG1vdXNlIHJlc3BvbmUsIG5vdCB0aGUgY3VycmVudCBzdGF0ZS5cclxuICAgICAgICBpZiAob3N3ZWIuZXZlbnRzLl9tb3VzZV9tb3ZlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7J3J0VGltZSc6IG9zd2ViLmV2ZW50cy5fbW91c2VfbW92ZS5ydFRpbWUsICd4Jzogb3N3ZWIuZXZlbnRzLl9tb3VzZV9tb3ZlLmV2ZW50LmNsaWVudFgsICd5Jzogb3N3ZWIuZXZlbnRzLl9tb3VzZV9tb3ZlLmV2ZW50LmNsaWVudFl9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsncnRUaW1lJzogLTEsICd4JzogLTEsICd5JzogLTF9O1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG5cclxuICAgIHAuZ2V0X3ByZXNzZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBSZXR1cm5zIHRoZSBjdXJyZW50IGJ1dHRvbiBzdGF0ZSBvZiB0aGUgbW91c2UgYnV0dG9ucy4gIVdhcm5pbmc6IHRoaXMgbWV0aG9kcyB1c2VzIHRoZSBzdGF0ZSBpbiB0aGUgbGFzdCBrbm93biBtb3VzZSByZXNwb25lLCBub3QgdGhlIGN1cnJlbnQgc3RhdGUuXHJcbiAgICAgICAgaWYgKG9zd2ViLmV2ZW50cy5fbW91c2VfcHJlc3MgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgJ2J1dHRvbnMnOiBbKG9zd2ViLmV2ZW50cy5fbW91c2VfcHJlc3MuYnV0dG9uID09PSAwKSwgKG9zd2ViLmV2ZW50cy5fbW91c2VfcHJlc3MuYnV0dG9uID09PSAxKSwgKG9zd2ViLmV2ZW50cy5fbW91c2VfcHJlc3MuYnV0dG9uID09PSAyKV19O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgJ2J1dHRvbnMnOiBbbnVsbCwgbnVsbCwgbnVsbF19O1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG5cclxuICAgIHAuc2V0X2NvbmZpZyA9IGZ1bmN0aW9uKHRpbWVvdXQsIGJ1dHRvbmxpc3QsIHZpc2libGUpIHtcclxuXHQvLyBTZXQgbW91c2UgcHJvcGVydGllcy4gICAgICAgICAgXHJcblx0dGhpcy50aW1lb3V0ID0gdGltZW91dDtcclxuXHR0aGlzLmJ1dHRvbmxpc3QgPSBidXR0b25saXN0O1x0XHJcblx0dGhpcy52aXNpYmxlID0gdmlzaWJsZTtcdFxyXG4gICAgfTtcclxuXHJcbiAgICBwLnNldF9wb3MgPSBmdW5jdGlvbihwb3MpIHtcclxuICAgIFx0Ly8gUmV0dXJucyB0aGUgY3VycmVudCBwb3NpdGlvbiBvZiB0aGUgY3Vyc29yLlx0XHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZShvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDcgKyAnbW91c2Uuc2V0X3BvcygpLicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnNob3dfY3Vyc29yID0gZnVuY3Rpb24odmlzaWJsZSkge1xyXG4gICAgXHQvLyBTZXQgdGhlIHByb3BlcnR5XHJcblx0dGhpcy52aXNpYmxlID0gdmlzaWJsZTtcclxuXHRcdFxyXG5cdC8vIEltbWVkaWF0ZWx5IGNoYW5nZXMgdGhlIHZpc2liaWxpdHkgb2YgdGhlIG1vdXNlIGN1cnNvci5cdFxyXG5cdGlmICh2aXNpYmxlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIC8vIFNob3cgdGhlIG1vdXNlIGN1cnNvci5cclxuICAgICAgICAgICAgb3N3ZWIucnVubmVyLl9zdGFnZS5jYW52YXMuc3R5bGUuY3Vyc29yID0gXCJkZWZhdWx0XCI7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBTZXQgdGhlIGN1cnNvciB2aXNpYmlsaXR5IHRvIG5vbmUuXHJcbiAgICAgICAgICAgIG9zd2ViLnJ1bm5lci5fc3RhZ2UuY2FudmFzLnN0eWxlLmN1cnNvciA9IFwibm9uZVwiO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcC5zeW5vbnltcyA9IGZ1bmN0aW9uKGJ1dHRvbilcclxuICAgIHtcclxuICAgICAgICBpZiAodHlwZW9mIGJ1dHRvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7aSA8IHRoaXMuU1lOT05JRU1fTUFQLmxlbmd0aDtpKyspIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwO2ogPCB0aGlzLlNZTk9OSUVNX01BUFtpXS5sZW5ndGg7aisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuU1lOT05JRU1fTUFQW2ldW2pdID09IGJ1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5TWU5PTklFTV9NQVBbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSAgICBcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgbW91c2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLm1vdXNlID0gbW91c2U7XHJcbn0oKSk7IFxyXG5cclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHNhbXBsZXIuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHNhbXBsZXIocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuXHJcbiAgICBcdC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBwcm9wZXJ0aWVzLlxyXG4gICAgICAgIHRoaXMuX3NhbXBsZSAgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3NhbXBsZXIgPSBudWxsO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKHNhbXBsZXIsIG9zd2ViLmdlbmVyaWNfcmVzcG9uc2UpO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuXHJcbiAgICBwLmJsb2NrXHQgID0gZmFsc2U7XHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ1BsYXlzIGEgc291bmQgZmlsZSBpbiAud2F2IG9yIC5vZ2cgZm9ybWF0JztcclxuICAgIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBidWlsZCBjeWNsZS4gXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuXHR0aGlzLmJsb2NrICAgICAgICAgICA9IGZhbHNlO1xyXG5cdHRoaXMudmFycy5zYW1wbGUgICAgID0gJyc7XHJcblx0dGhpcy52YXJzLnBhbiAgICAgICAgPSAwO1xyXG5cdHRoaXMudmFycy5waXRjaCAgICAgID0gMTtcclxuXHR0aGlzLnZhcnMuZmFkZV9pbiAgICA9IDA7XHJcblx0dGhpcy52YXJzLnN0b3BfYWZ0ZXIgPSAwO1xyXG5cdHRoaXMudmFycy52b2x1bWUgICAgID0gMTtcclxuXHR0aGlzLnZhcnMuZHVyYXRpb24gICA9ICdzb3VuZCc7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLiBcclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBDcmVhdGUgdGhlIHNhbXBsZVxyXG5cdGlmICh0aGlzLnZhcnMuc2FtcGxlICE9ICcnKVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gUmV0cmlldmUgdGhlIGNvbnRlbnQgZnJvbSB0aGUgZmlsZSBwb29sLlxyXG4gICAgICAgICAgICB0aGlzLl9zYW1wbGUgICAgICAgICA9IG9zd2ViLnBvb2xbdGhpcy5zeW50YXguZXZhbF90ZXh0KHRoaXMudmFycy5zYW1wbGUpXTsgIFxyXG4gICAgICAgICAgICB0aGlzLl9zYW1wbGVyICAgICAgICA9IG5ldyBvc3dlYi5zYW1wbGVyX2JhY2tlbmQodGhpcy5leHBlcmltZW50LCB0aGlzLl9zYW1wbGUpO1xyXG4gICAgICAgICAgICB0aGlzLl9zYW1wbGVyLnZvbHVtZSA9IHRoaXMudmFycy52b2x1bWU7XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIC8qIHJhaXNlIG9zZXhjZXB0aW9uKFxyXG4gICAgICAgICAgICB1J05vIHNhbXBsZSBoYXMgYmVlbiBzcGVjaWZpZWQgaW4gc2FtcGxlciBcIiVzXCInICUgc2VsZi5uYW1lKSAqL1xyXG5cdH1cclxuICAgIFxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuZ2VuZXJpY19yZXNwb25zZV9wcmVwYXJlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHR0aGlzLnNldF9pdGVtX29uc2V0KCk7XHJcblx0dGhpcy5zZXRfc3JpKCk7XHJcblx0dGhpcy5fc2FtcGxlci5wbGF5KCk7XHJcblx0dGhpcy5wcm9jZXNzX3Jlc3BvbnNlKCk7XHJcbiAgICB9O1x0XHJcblxyXG4gICAgLy8gQmluZCB0aGUgc2FtcGxlciBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuc2FtcGxlciA9IG9zd2ViLnByb21vdGVDbGFzcyhzYW1wbGVyLCBcImdlbmVyaWNfcmVzcG9uc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyB2aWRlby5cclxuICAgIGZ1bmN0aW9uIHZpZGVvKGV4cGVyaW1lbnQsIHNyYykge1xyXG4gICAgICBcdC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuZXhwZXJpbWVudCA9IGV4cGVyaW1lbnQ7XHJcblx0XHJcbiAgICAgICAgLy8gU2V0IHRoZSBjbGFzcyBwaXZhdGUgcHJvcGVydGllcy4gXHJcbiAgICAgICAgdGhpcy5fcGxheWluZyA9IGZhbHNlOyBcclxuICAgICAgICB0aGlzLl9zY3JpcHQgPSBudWxsO1xyXG5cclxuXHQvLyBDcmVhdGUgdGhlIHZpZGVvIGluc3RhbmNlXHJcblx0aWYgKHNyYyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvLyBTZXQgdGhlIHZpZGVvIG9iamVjdC5cclxuICAgICAgICAgICAgdGhpcy5fY3R4ID0gb3N3ZWIucnVubmVyLl9jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgICAgICAgdGhpcy5fdmlkZW8gPSBzcmMuZGF0YTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgZXZlbnQgYW5jaG9ycy5cclxuICAgICAgICAgICAgdGhpcy5fdmlkZW8ub24oXCJlbmRlZFwiLCBvc3dlYi5ldmVudHMuX3ZpZGVvRW5kZWQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZpZGVvLm9uKFwicGxheVwiICwgb3N3ZWIuZXZlbnRzLl92aWRlb1BsYXkuYmluZCh0aGlzKSk7XHJcbiAgICBcdH1cclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSB2aWRlby5wcm90b3R5cGU7XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5hdWRpbyA9IHRydWU7XHJcbiAgICBwLmR1cmF0aW9uID0gJ2tleXByZXNzJztcdFxyXG4gICAgcC5mdWxsX3NjcmVlbiA9IGZhbHNlO1xyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcy5cclxuICAgIFxyXG4gICAgcC5fdXBkYXRlX3ZpZGVvX2NhbnZhcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIENsaXAgdGhlIGNvbnRlbnQgb2YgdGhlIHZpZGVvIHRvIHRoZSBjYW52YXMuXHJcbiAgICAgICAgaWYgKHRoaXMuX3BsYXlpbmcgPT09IHRydWUpIHsgICAgXHJcbiAgICAgICAgICAgIHRoaXMuX2N0eC5kcmF3SW1hZ2UodGhpcy5fdmlkZW8sIDAsIDApO1xyXG5cclxuICAgICAgICAgICAgLy8gZXhlY3V0ZSBzY3JpcHQuXHJcbiAgICAgICAgICAgIGlmICgodGhpcy5fc2NyaXB0ICE9PSBudWxsKSAmJiAodGhpcy5fZXZlbnRfaGFuZGxlcl9hbHdheXMgPT09IHRydWUpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBTdGFydCB0aGUgcGFyc2VyXHJcbiAgICAgICAgICAgICAgICBvc3dlYi5wYXJzZXIuX3J1bihudWxsLCB0aGlzLl9zY3JpcHQpOyAgICBcdFx0XHJcbiAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgfSAgICBcclxuICAgIH07ICAgIFxyXG4gICAgXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzLlxyXG4gICAgXHJcbiAgICBwLnBsYXkgPSBmdW5jdGlvbigpIHtcclxuXHQvLyBQbGF5IHRoZSBhY3R1YWwgdmlkZW8uXHJcbiAgICAgICAgdGhpcy5fdmlkZW8ucGxheSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgdm9sdW1lXHJcbiAgICAgICAgdGhpcy5fdmlkZW8udm9sdW1lID0gKHRoaXMuYXVkaW8gPT09IHRydWUpID8gMSA6IDA7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHZpZGVvIG11c3QgYmUgc2NhbGVkLlxyXG4gICAgICAgIGlmICh0aGlzLmZ1bGxfc2NyZWVuID09IHRydWUpIHsgICAgXHJcbiAgICAgICAgICAgIC8vIERyYXcgdGhlIGZpcnN0IGltYWdlIHdpdGggc2NhbGluZy5cclxuICAgICAgICAgICAgdmFyIHhTY2FsZSA9ICh0aGlzLmV4cGVyaW1lbnQuX2NhbnZhcy5fd2lkdGggIC8gdGhpcy5fdmlkZW8udmlkZW9XaWR0aCk7XHJcbiAgICAgICAgICAgIHZhciB5U2NhbGUgPSAodGhpcy5leHBlcmltZW50Ll9jYW52YXMuX2hlaWdodCAvIHRoaXMuX3ZpZGVvLnZpZGVvSGVpZ2h0KTtcclxuICAgICAgICAgICAgdGhpcy5fY3R4LnNjYWxlKHhTY2FsZSx5U2NhbGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBEcmF3IHRoZSBmaXJzdCBmcmFtZS5cclxuICAgICAgICB0aGlzLl9jdHguZHJhd0ltYWdlKHRoaXMuX3ZpZGVvLCAwLCAwKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIHBsYXkgdG9nZ2xlLlxyXG4gICAgICAgIHRoaXMuX3BsYXlpbmcgPSB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnN0b3AgPSBmdW5jdGlvbigpIHtcclxuXHQvLyBQYXVzZSB0aGUgYWN0dWFsIHNvdW5kLlxyXG5cdHRoaXMuX3ZpZGVvLnBhdXNlKCk7XHJcbiAgICAgICAgdGhpcy5fcGxheWluZyA9IGZhbHNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLndhaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBTZXQgdGhlIGJsb2NraW5nIG9mIHRoZSBzb3VuZC5cclxuICAgICAgICBvc3dlYi5ldmVudHMuX3J1bih0aGlzLCAtMSwgb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX1ZJREVPLFtdKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIEJpbmQgdGhlIHZpZGVvIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi52aWRlb19iYWNrZW5kID0gdmlkZW87XHJcbn0oKSk7XHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBkZWJ1Zy5cclxuICAgIGZ1bmN0aW9uIGRlYnVnKCkge1xyXG4gICAgXHR0aHJvdyAnVGhlIGNsYXNzIGRlYnVnIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhJztcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG4gICAgZGVidWcuZW5hYmxlZCA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZSB0aGUgZGVidWdnZXIgIFxyXG4gICAgZGVidWcuZXJyb3IgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHJ1ZSBpZiBhbiBlcnJvciBvY2N1cmVkLlxyXG4gICAgZGVidWcubWVzc2FnZUxvZyA9IG5ldyBBcnJheSgpOyAgICAgICAgICAgICAgLy8gQXJyYXR5IHdpdGggYWxsZSBsb2cgbWVzc2FnZXMuXHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBjbGFzcyBwcml2YXRlIG1ldGhvZHMuICAgICAgICAgICAgICAgXHJcbiAgIFxyXG4gICAgZGVidWcuX2luaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gRW5hYmxlZC9kaXNhYmxlIHRoZSBkZWJ1Z2dlci5cclxuICAgIFx0dGhpcy5kZWJ1ZyA9IG9zd2ViLnJ1bm5lci5kZWJ1ZztcclxuICAgIFx0Ly8gQ2xlYXIgdGhlIGxvZy5cclxuICAgICAgICB0aGlzLm1lc3NhZ2VMb2cgPSBbXTtcclxuICAgIH07XHRcclxuXHJcbiAgICBkZWJ1Zy5fZmluYWxpemUgPSBmdW5jdGlvbigpIHtcclxuXHQvLyBJZiBlbmFibGVkIHB1c2ggdGhlIG1lc3NhZ2VzIHRvIHRoZSBqYXZhc2NyaXB0IGNvbnNvbGUuXHJcblx0aWYgKHRoaXMuZW5hYmxlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm1lc3NhZ2VMb2cpO1x0XHRcdFxyXG5cdH1cclxuXHJcblx0Ly8gQ2xlYXIgdGhlIGxvZy5cclxuXHR0aGlzLm1lc3NhZ2VMb2cgPSBbXTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgcHVibGljIG1ldGhvZHMuICAgICAgICAgICAgICAgXHJcbiAgIFxyXG4gICAgZGVidWcuYWRkRXJyb3IgPSBmdW5jdGlvbihlcnJvcl90ZXh0KSB7XHJcbiAgICBcdC8vIFNldCB0aGUgZXJyb3IgZmxhZy5cclxuICAgIFx0dGhpcy5lcnJvciA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIFNob3cgdGhlIGZhdGFsIGVycm9yIHdhcm5pbmcuXHJcblx0Y29uc29sZS5sb2coZXJyb3JfdGV4dCk7XHJcblx0Y29uc29sZS5sb2cob3N3ZWIuY29uc3RhbnRzLkVSUk9SXzAwMSk7XHJcblxyXG5cdC8vIFRocm93IHRoZSBleGNlcHRpb24uXHJcblx0dGhyb3cgbmV3IEVycm9yKGVycm9yX3RleHQpO1x0XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgZGVidWcuYWRkTWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2VfdGV4dCkge1xyXG4gICAgICAgIC8vIFB1c2ggdGhlIGVycm9yIG1lc3NhZ2UgdG8gdGhlIGxvZy5cclxuXHR0aGlzLm1lc3NhZ2VMb2cucHVzaChtZXNzYWdlX3RleHQpO1x0XHRcclxuXHRcclxuXHRpZiAoZGVidWcuZW5hYmxlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlX3RleHQpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG5cclxuICAgIGRlYnVnLm1zZyA9IGZ1bmN0aW9uKG1lc3NhZ2VfdGV4dCkge1xyXG5cdC8vIFB1c2ggdGhlIGVycm9yIG1lc3NhZ2UgdG8gdGhlIGxvZy5cclxuXHR0aGlzLmFkZE1lc2FnZShtZXNzYWdlX3RleHQpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBkZWJ1ZyBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZGVidWcgPSBkZWJ1ZztcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGZpbGVfcG9vbF9zdG9yZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZmlsZV9wb29sX3N0b3JlKClcclxuICAgIHtcclxuICAgIFx0dGhyb3cgXCJUaGUgY2xhc3MgZmlsZV9wb29sX3N0b3JlIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhXCI7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBjbGFzcyBwcm9wZXJ0aWVzLlxyXG4gICAgZmlsZV9wb29sX3N0b3JlLl9kYXRhICA9IFtdO1xyXG4gICAgZmlsZV9wb29sX3N0b3JlLl9pdGVtcyA9IFtdOyAgXHJcblx0XHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwcml2YXRlIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUuYWRkX2Zyb21fbG9jYWxfc291cmNlID0gZnVuY3Rpb24ocEl0ZW0pXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIGV4dCA9IHBJdGVtLmZpbGVuYW1lLnN1YnN0cihwSXRlbS5maWxlbmFtZS5sYXN0SW5kZXhPZignLicpICsgMSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKChleHQgPT0gJ2pwZycpIHx8IChleHQgPT0gJ3BuZycpKVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGZpbGUgcG9vbCBtYWdlIGl0ZW0uXHJcbiAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICAgICAgaW1nLnNyYyA9IHBJdGVtLnRvRGF0YVVSTCgpO1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHtkYXRhOiBpbWcsIGZvbGRlcjogcEl0ZW0uZmlsZW5hbWUsIG5hbWU6IHBJdGVtLmZpbGVuYW1lLnJlcGxhY2UoL14uKltcXFxcXFwvXS8sICcnKSwgc2l6ZTogcEl0ZW0ubGVuZ3RoLCB0eXBlOiAnaW1hZ2UnfTtcclxuXHR9XHJcbiAgICAgICAgZWxzZSBpZiAoKGV4dCA9PSAnd2F2JykgfHwgKGV4dCA9PSAnb2dnJykpXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgYWRvID0gbmV3IEF1ZGlvKCk7XHJcbiAgICAgICAgICAgIGFkby5zcmMgPSBwSXRlbS50b0RhdGFVUkwoKTtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSB7ZGF0YTogYWRvLCBmb2xkZXI6IHBJdGVtLmZpbGVuYW1lLCBuYW1lOiBwSXRlbS5maWxlbmFtZS5yZXBsYWNlKC9eLipbXFxcXFxcL10vLCAnJyksIHNpemU6IHBJdGVtLmxlbmd0aCwgdHlwZTogJ3NvdW5kJ307XHJcblx0fVxyXG5cdGVsc2UgaWYgKGV4dCA9PSAnb2d2JylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBhZG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiVklERU9cIik7XHJcbiAgICAgICAgICAgIGFkby5zcmMgPSBwSXRlbS50b0RhdGFVUkwoKTtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSB7ZGF0YTogYWRvLCBmb2xkZXI6IHBJdGVtLmZpbGVuYW1lLCBuYW1lOiBwSXRlbS5maWxlbmFtZS5yZXBsYWNlKC9eLipbXFxcXFxcL10vLCAnJyksIHNpemU6IHBJdGVtLmxlbmd0aCwgdHlwZTogJ3ZpZGVvJ307XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBcclxuXHQvLyBBZGQgdGhlIGl0ZW0gdG8gdGhlIHBvb2wuXHJcblx0dGhpcy5faXRlbXMucHVzaChpdGVtKTtcclxuXHJcblx0Ly8gTGluayB0aGUgaXRlbSBhcyBwcm9wZXJ0eVxyXG5cdHRoaXNbaXRlbS5uYW1lXSA9IGl0ZW07XHJcbiAgICB9O1xyXG5cclxuICAgIGZpbGVfcG9vbF9zdG9yZS5hZGRfZnJvbV9zZXJ2ZXJfc291cmNlID0gZnVuY3Rpb24ocFBhdGgsIHBGaWxlcylcclxuICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnLS0nKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhwRmlsZXMpO1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgc3RpbXVsaSBmaWxlcy5cclxuICAgICAgICBpZiAocEZpbGVzLmxlbmd0aCA+IDApXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBTZXQgdGhlIHByZWxvYWRlci5cclxuICAgICAgICAgICAgdGhpcy5fcXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlKGZhbHNlKTtcclxuICAgICAgICAgICAgY3JlYXRlanMuU291bmQucmVnaXN0ZXJQbHVnaW5zKFtjcmVhdGVqcy5IVE1MQXVkaW9QbHVnaW5dKTsgIC8vIG5lZWQgdGhpcyBzbyBpdCBkb2Vzbid0IGRlZmF1bHQgdG8gV2ViIEF1ZGlvXHJcbiAgICAgICAgICAgIHRoaXMuX3F1ZXVlLmluc3RhbGxQbHVnaW4oY3JlYXRlanMuU291bmQpO1xyXG4gXHRcdFxyXG4gICAgICAgICAgICB0aGlzLl9xdWV1ZS5vbihcImZpbGVsb2FkXCIsIHRoaXMuX2ZpbGVfY29tcGxldGUsIHRoaXMpO1xyXG4gICAgICAgICAgICB0aGlzLl9xdWV1ZS5vbihcImNvbXBsZXRlXCIsIHRoaXMuX2xvYWRfY29tcGxldGUsIHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgLy8gQWRkIHRoZSBzdGltdWxpIGluZm9ybWF0aW9uIHRvIHRoZSBsb2FkZXIuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDtpIDwgcEZpbGVzLmxlbmd0aDtpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciByZSA9IC8oPzpcXC4oW14uXSspKT8kLztcclxuICAgICAgICAgICAgICAgIHZhciBleHRlbnRpb24gPSByZS5leGVjKHBGaWxlc1tpXSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleHRlbnRpb24pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoZXh0ZW50aW9uWzBdID09ICcub2dnJylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc291bmQnKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9xdWV1ZS5sb2FkRmlsZSh7aWQ6IHBGaWxlc1tpXSwgc3JjOiBwUGF0aCArIHBGaWxlc1tpXSwgdHlwZTogY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU09VTkR9KTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7IFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3F1ZXVlLmxvYWRGaWxlKHtpZDogcEZpbGVzW2ldLCBzcmM6IHBQYXRoICsgcEZpbGVzW2ldLCB0eXBlOiBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5JTUFHRX0pO1xyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuXHRcclxuICAgICAgICAgICAgLy8gTG9hZCB0aGUgc3RpbXVsaSBmaWxlcy5cclxuICAgICAgICAgICAgdGhpcy5fcXVldWUubG9hZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBCdWlsZCB0aGUgZXhwZXJpbWVudCBvYmplY3RzIHVzaW5nIHRoZSBnaXZlbiBzY3JpcHQuXHJcbiAgICAgICAgICAgIG9zd2ViLnJ1bm5lci5fYnVpbGRFeHBlcmltZW50KCk7XHJcbiAgICAgICAgfSBcclxuICAgIH07IFxyXG4gICAgXHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUuX2ZpbGVfY29tcGxldGUgPSBmdW5jdGlvbihwRXZlbnQpXHJcbiAgICB7XHJcblx0Ly8gVXBkYXRlIHRoZSBsb2FkZXIgdGV4dC5cclxuXHRvc3dlYi5ydW5uZXIuX3VwZGF0ZUludHJvU2NyZWVuKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwNyk7XHJcblxyXG4gICAgICAgIC8vIFB1c2ggdGhlIHN0aW11bHVzIGl0ZW0gdG8gdGhlIHN0aW11bGkgb2JqZWN0LlxyXG4gICAgICAgIHZhciBpdGVtID0ge2RhdGE6IHBFdmVudC5yZXN1bHQsIGZvbGRlcjogcEV2ZW50Lml0ZW0uaWQsIG5hbWU6IHBFdmVudC5pdGVtLmlkLnJlcGxhY2UoL14uKltcXFxcXFwvXS8sICcnKSwgc2l6ZTogcEV2ZW50Lml0ZW0uaWQsIHR5cGU6ICdpbWFnZSd9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEFkZCB0aGUgaXRlbSB0byB0aGUgcG9vbC5cclxuXHR0aGlzLl9pdGVtcy5wdXNoKGl0ZW0pO1xyXG5cclxuXHQvLyBMaW5rIHRoZSBpdGVtIGFzIHByb3BlcnR5XHJcblx0dGhpc1tpdGVtLm5hbWVdID0gaXRlbTtcclxuICAgIH07XHRcclxuXHRcclxuICAgIGZpbGVfcG9vbF9zdG9yZS5fbG9hZF9jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBVcGRhdGUgdGhlIGxvYWRlciB0ZXh0LlxyXG5cdG9zd2ViLnJ1bm5lci5fdXBkYXRlSW50cm9TY3JlZW4ob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA2KTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5faXRlbXMpO1xyXG5cclxuXHQvLyBCdWlsZGluZyBpcyBkb25lLCBnbyB0byBuZXh0IHBoYXNlLlxyXG4gICAgICAgIG9zd2ViLnJ1bm5lci5fYnVpbGRFeHBlcmltZW50KCk7XHJcbiAgICB9O1x0XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUuYWRkID0gZnVuY3Rpb24ocFBhdGgsIHBOZXdfTmFtZSlcclxuICAgIHtcclxuICAgIFx0Ly8gQ29waWVzIGEgZmlsZSB0byB0aGUgZmlsZSBwb29sLiBcclxuICAgIH07XHJcblx0XHJcbiAgICBmaWxlX3Bvb2xfc3RvcmUuZmFsbGJhY2tfZm9sZGVyID0gZnVuY3Rpb24oKVxyXG4gICAge1x0XHJcbiAgICBcdC8vIFRoZSBmdWxsIHBhdGggdG8gdGhlIGZhbGxiYWNrIHBvb2wgZm9sZGVyLlxyXG4gICAgfTtcclxuXHRcclxuICAgIGZpbGVfcG9vbF9zdG9yZS5maWxlcyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gUmV0dXJucyBhbGwgZmlsZXMgaW4gdGhlIGZpbGUgcG9vbC5cclxuICAgIH07XHJcblxyXG4gICAgZmlsZV9wb29sX3N0b3JlLmZvbGRlciA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gVGhlIGZ1bGwgcGF0aCB0byB0aGUgKG1haW4pIHBvb2wgZm9sZGVyLlxyXG4gICAgfTtcclxuXHRcclxuICAgIGZpbGVfcG9vbF9zdG9yZS5mb2xkZXJzID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyBHaXZlcyBhIGxpc3Qgb2YgYWxsIGZvbGRlcnMgdGhhdCBhcmUgc2VhcmNoZWQgd2hlbiByZXRyaWV2aW5nIHRoZSBmdWxsIHBhdGggdG8gYSBmaWxlLiBcclxuICAgIH07XHJcblxyXG4gICAgZmlsZV9wb29sX3N0b3JlLmluX2ZvbGRlciA9IGZ1bmN0aW9uKHBQYXRoKVxyXG4gICAge1xyXG4gICAgXHQvLyBDaGVja3Mgd2hldGhlciBwYXRoIGlzIGluIHRoZSBwb29sIGZvbGRlci4gXHJcbiAgICB9O1xyXG5cclxuICAgIGZpbGVfcG9vbF9zdG9yZS5yZW5hbWUgPSBmdW5jdGlvbihwT2xkX3BhdGgsIHBOZXdfcGF0aClcclxuICAgIHtcclxuXHQvLyBSZW5hbWVzIGEgZmlsZSBpbiB0aGUgcG9vbCBmb2xkZXIuXHJcbiAgICB9O1xyXG5cdFxyXG4gICAgZmlsZV9wb29sX3N0b3JlLnNpemUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gVGhlIGNvbWJpbmVkIHNpemUgaW4gYnl0ZXMgb2YgYWxsIGZpbGVzIGluIHRoZSBmaWxlIHBvb2wuXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIHN0YWNrIGZpbGVfcG9sZV9zdG9yZSB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIucG9vbCA9IGZpbGVfcG9vbF9zdG9yZTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGZ1bmN0aW9ucy5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZnVuY3Rpb25zKCkgXHJcbiAgICB7XHJcblx0dGhyb3cgXCJUaGUgY2xhc3MgZnVuY3Rpb25zIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhXCI7XHJcbiAgICB9XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgZ2VuZXJhbCBmdW5jdGlvbiBtZXRob2RzLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgZnVuY3Rpb25zLl9pbml0aWFsaXplID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdHdpbmRvd1sncHJpbnQnXVx0XHQgPSB0aGlzLnByaW50O1xyXG5cdHdpbmRvd1sncmFuZGludCddICAgICAgICA9IHRoaXMucmFuZGludDtcclxuICAgICAgICBcclxuXHQvLyBDcmVhdGUgdGhlIGdsb2JhbCBmdW5jdGlvbiBjYWxscyBmb3IgdXNlIGluIHRoZSBpbmxpZGUgc2NyaXB0IGl0ZW0uXHJcblx0d2luZG93WydjYW52YXMnXSAgICAgICAgID0gdGhpcy5jYW52YXM7XHJcblx0d2luZG93Wydjb3B5X3NrZXRjaHBhZCddID0gdGhpcy5jb3B5X3NrZXRjaHBhZDtcclxuXHR3aW5kb3dbJ2tleWJvYXJkJ10gICAgICAgPSB0aGlzLmtleWJvYXJkO1xyXG5cdHdpbmRvd1snbW91c2UnXSAgICAgICAgICA9IHRoaXMubW91c2U7XHJcblx0d2luZG93WydwYXVzZSddICAgICAgICAgID0gdGhpcy5wYXVzZTtcclxuXHR3aW5kb3dbJ3Jlc2V0X2ZlZWRiYWNrJ10gPSB0aGlzLnJlc2V0X2ZlZWRiYWNrO1x0XHJcblx0d2luZG93WydzYW1wbGVyJ10gICAgICAgID0gdGhpcy5zYW1wbGVyO1xyXG5cdHdpbmRvd1snc2V0X3Jlc3BvbnNlJ10gICA9IHRoaXMuc2V0X3Jlc3BvbnNlO1xyXG5cdHdpbmRvd1snc2V0X3N1YmplY3RfbnInXSA9IHRoaXMuc2V0X3N1YmplY3RfbnI7XHRcclxuXHR3aW5kb3dbJ3NvbWV0aW1lcyddICAgICAgPSB0aGlzLnNvbWV0aW1lcztcclxuXHR3aW5kb3dbJ3N5bnRoJ10gXHQgPSB0aGlzLnN5bnRoO1xyXG5cdHdpbmRvd1sneHlfY2lyY2xlJ10gXHQgPSB0aGlzLnh5X2NpcmNsZTtcclxuXHR3aW5kb3dbJ3h5X2Rpc3RhbmNlJ10gXHQgPSB0aGlzLnh5X2Rpc3RhbmNlO1xyXG5cdHdpbmRvd1sneHlfZnJvbV9wb2xhciddICA9IHRoaXMueHlfZnJvbV9wb2xhcjtcclxuXHR3aW5kb3dbJ3h5X2dyaWQnXSBcdCA9IHRoaXMueHlfZ3JpZDtcclxuXHR3aW5kb3dbJ3h5X3JhbmRvbSddIFx0ID0gdGhpcy54eV9yYW5kb207XHJcblx0d2luZG93Wyd4eV90b19wb2xhciddICAgID0gdGhpcy54eV90b19wb2xhcjtcclxuICAgIH07XHJcblx0XHRcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIGdlbmVyYWwgZnVuY3Rpb24gbWV0aG9kcy4gICBcclxuICAgICAqL1xyXG5cclxuICAgIGZ1bmN0aW9ucy5wcmludCA9IGZ1bmN0aW9uKHBTdHJpbmcpXHJcbiAgICB7XHJcblx0Y29uc29sZS5sb2coJ3ByaW50IG91dHB1dDonICsgcFN0cmluZyk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9ucy5yYW5kaW50ID0gZnVuY3Rpb24ocFN0YXJ0LCBwRW5kKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBtdWx0aXBsaWVyID0gcEVuZCAtIHBTdGFydDtcclxuICAgICAgICB2YXIgcmFuZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG11bHRpcGxpZXIpO1xyXG4gICAgICAgIHJldHVybiByYW5kICsgcFN0YXJ0O1xyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBnZW5lcmFsIGZ1bmN0aW9uIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBmdW5jdGlvbnMuY2FudmFzID0gZnVuY3Rpb24ocEF1dG9fcHJlcGFyZSwgcFN0eWxlX2FyZ3MpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3dhcm5pbmc6IGZ1bmN0aW9uIFwiY2FudmFzXCIgbm90IGF2YWlsYWJsZSB5ZXQuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9ucy5jb3B5X3NrZXRjaHBhZCA9IGZ1bmN0aW9uKHBOYW1lKVxyXG4gICAge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCd3YXJuaW5nOiBmdW5jdGlvbiBcImNvcHlfc2tldGNocGFkXCIgbm90IGF2YWlsYWJsZSB5ZXQuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9ucy5rZXlib2FyZCA9IGZ1bmN0aW9uKHBSZXNwX2FyZ3MpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3dhcm5pbmc6IGZ1bmN0aW9uIFwia2V5Ym9hcmRcIiBub3QgYXZhaWxhYmxlIHlldC4nKTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb25zLm1vdXNlID0gZnVuY3Rpb24ocFJlc3BfYXJncylcclxuICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnd2FybmluZzogZnVuY3Rpb24gXCJtb3VzZVwiIG5vdCBhdmFpbGFibGUgeWV0LicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbnMucGF1c2UgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3dhcm5pbmc6IGZ1bmN0aW9uIFwicGF1c2VcIiBub3QgYXZhaWxhYmxlIHlldC4nKTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb25zLnJlc2V0X2ZlZWRiYWNrID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCd3YXJuaW5nOiBmdW5jdGlvbiBcInJlc2V0X2ZlZWRiYWNrXCIgbm90IGF2YWlsYWJsZSB5ZXQuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9ucy5zYW1wbGVyID0gZnVuY3Rpb24ocFNyYywgcFBsYXliYWNrX2FyZ3MpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3dhcm5pbmc6IGZ1bmN0aW9uIFwic2FtcGxlclwiIG5vdCBhdmFpbGFibGUgeWV0LicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbnMuc2V0X3Jlc3BvbnNlID0gZnVuY3Rpb24ocFJlc3BvbnNlLCBwUmVzcG9uc2VfdGltZSwgcENvcnJlY3QpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3dhcm5pbmc6IGZ1bmN0aW9uIFwic2V0X3Jlc3BvbnNlXCIgbm90IGF2YWlsYWJsZSB5ZXQuJyk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgZnVuY3Rpb25zLnNldF9zdWJqZWN0X25yID0gZnVuY3Rpb24ocE5yKVxyXG4gICAge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCd3YXJuaW5nOiBmdW5jdGlvbiBcInNldF9zdWJqZWN0X25yXCIgbm90IGF2YWlsYWJsZSB5ZXQuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9ucy5zb21ldGltZXMgPSBmdW5jdGlvbihwUClcclxuICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnd2FybmluZzogZnVuY3Rpb24gXCJzb21ldGltZXNcIiBub3QgYXZhaWxhYmxlIHlldC4nKTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb25zLnN5bnRoID0gZnVuY3Rpb24ocE9zYywgcEZyZXEsIHBMZW5ndGgsIHBBdHRhY2ssIHBEZWNheSlcclxuICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnd2FybmluZzogZnVuY3Rpb24gXCJzeW50aFwiIG5vdCBhdmFpbGFibGUgeWV0LicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbnMueHlfY2lyY2xlID0gZnVuY3Rpb24ocE4sIHBSaG8sIHBQaGkwLCBwUG9sZSlcclxuICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnd2FybmluZzogZnVuY3Rpb24gXCJ4eV9jaXJjbGVcIiBub3QgYXZhaWxhYmxlIHlldC4nKTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb25zLnh5X2Rpc3RhbmNlID0gZnVuY3Rpb24ocFgxLCBwWTEsIHBYMiwgcFkyKVxyXG4gICAge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCd3YXJuaW5nOiBmdW5jdGlvbiBcInh5X2Rpc3RhbmNlXCIgbm90IGF2YWlsYWJsZSB5ZXQuJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9ucy54eV9mcm9tX3BvbGFyID0gZnVuY3Rpb24ocFJobywgcFBoaSwgcFBvbGUpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3dhcm5pbmc6IGZ1bmN0aW9uIFwieHlfZnJvbV9wb2xhclwiIG5vdCBhdmFpbGFibGUgeWV0LicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbnMueHlfZ3JpZCA9IGZ1bmN0aW9uKHBOLCBwU3BhY2luZywgcFBvbGUpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3dhcm5pbmc6IGZ1bmN0aW9uIFwieHlfZ3JpZFwiIG5vdCBhdmFpbGFibGUgeWV0LicpO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbnMueHlfcmFuZG9tID0gZnVuY3Rpb24ocE4sIHBXaWR0aCwgcEhlaWdodCwgcE1pbl9kaXN0LCBwUG9sZSlcclxuICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnd2FybmluZzogZnVuY3Rpb24gXCJ4eV9yYW5kb21cIiBub3QgYXZhaWxhYmxlIHlldC4nKTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb25zLnh5X3RvX3BvbGFyID0gZnVuY3Rpb24ocFgsIHBZLCBwUG9sZSlcclxuICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnd2FybmluZzogZnVuY3Rpb24gXCJ4eV90b19wb2xhclwiIG5vdCBhdmFpbGFibGUgeWV0LicpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBmdW5jdGlvbnMgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmZ1bmN0aW9ucyA9IGZ1bmN0aW9ucztcclxufSgpKTsgXHJcblxyXG4iLCIvKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBoZWFydGJlYXQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGhlYXJ0YmVhdChwRXhwZXJpbWVudCwgcEludGVydmFsKVxyXG4gICAge1xyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgXHR0aGlzLmV4cGVyaW1lbnQgPSBwRXhwZXJpbWVudDtcclxuXHR0aGlzLmludGVydmFsICAgPSAodHlwZW9mIHBJbnRlcnZhbCA9PT0gJ3VuZGVmaW5lZCcpID8gMSA6IHBJbnRlcnZhbDtcdFxyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IGhlYXJ0YmVhdC5wcm90b3R5cGU7XHJcbiAgICBcclxuICAgIC8vIERlZmluZSB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5leHBlcmltZW50ID0gbnVsbDtcclxuICAgIHAuaW50ZXJ2YWwgICA9IC0xO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIGNsYXNzIHByaXZhdGUgbWV0aG9kcy4gICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuYmVhdCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIH07XHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuc3RhcnQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgLy8gQmluZCB0aGUgaGVhcnRiZWF0IGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5oZWFydGJlYXQgPSBoZWFydGJlYXQ7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBpdGVtX3N0YWNrLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBpdGVtX3N0YWNrKClcclxuICAgIHtcclxuICAgXHR0aHJvdyBcIlRoZSBjbGFzcyBpdGVtX3N0YWNrIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhXCI7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBjbGFzcyBwcm9wZXJ0aWVzLlxyXG4gICAgaXRlbV9zdGFjay5faXRlbXMgPSBbXTsgIFxyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBpdGVtX3N0YWNrLmNsZWFyID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyBDbGVhcnMgdGhlIHN0YWNrLlxyXG5cdHRoaXMuX2l0ZW1zID0gW107XHJcbiAgICB9O1xyXG5cclxuICAgIGl0ZW1fc3RhY2sucHVzaCA9IGZ1bmN0aW9uKHBJdGVtLCBwUGhhc2UpXHJcbiAgICB7XHJcbiAgICBcdC8vIENyZWF0ZSB0aGUgc3RhY2sgaXRlbS5cclxuXHR2YXIgU3RhY2tJdGVtID0geydpdGVtJzogcEl0ZW0sICdwaGFzZSc6IHBQaGFzZX07XHJcblxyXG5cdC8vIFB1c2ggdGhlIGl0ZW0gb250byB0aGUgc3RhY2suXHJcblx0dGhpcy5faXRlbXMucHVzaChTdGFja0l0ZW0pO1xyXG4gICAgfTtcdFxyXG5cclxuICAgIGl0ZW1fc3RhY2sucG9wID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFBvcHMgdGhlIGxhc3QgaXRlbSBmcm9tIHRoZSBzdGFjay5cclxuXHRyZXR1cm4gdGhpcy5faXRlbXMucG9wKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGl0ZW1fc3RhY2sgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLml0ZW1fc3RhY2sgPSBpdGVtX3N0YWNrO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgaXRlbV9zdG9yZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gaXRlbV9zdG9yZSgpXHJcbiAgICB7XHJcblx0dGhyb3cgXCJUaGUgY2xhc3MgaXRlbV9zdG9yZSBjYW5ub3QgYmUgaW5zdGFudGlhdGVkIVwiO1xyXG4gICAgfSBcclxuXHRcdFxyXG4gICAgLy8gU2V0IHRoZSBjbGFzcyBwcml2YXRlIHByb3BlcnRpZXMuIFxyXG4gICAgaXRlbV9zdG9yZS5fZXhwZXJpbWVudCA9IG51bGw7XHJcbiAgICBpdGVtX3N0b3JlLl9pdGVtcyAgICAgID0ge307XHJcbiAgICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBpdGVtLiAgICAgICAgIFxyXG4gICAgICovXHJcbiAgICBcclxuICAgIGl0ZW1fc3RvcmUuZXhlY3V0ZSA9IGZ1bmN0aW9uKHBOYW1lLCBwUGFyZW50KVxyXG4gICAge1xyXG5cdC8vIEV4ZWN1dGVzIHRoZSBydW4gYW5kIHByZXBhcmUgcGhhc2VzIG9mIGFuIGl0ZW0sIGFuZCB1cGRhdGVzIHRoZSBpdGVtIHN0YWNrLlxyXG5cdHRoaXMucHJlcGFyZShwTmFtZSk7XHJcblx0dGhpcy5ydW4ocE5hbWUsIHBQYXJlbnQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBpdGVtX3N0b3JlLml0ZW1zID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIENyZWF0ZSBhIGxpc3QgbyBrZXlzLlxyXG4gICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9pdGVtcykgXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpdGVtcy5wdXNoKFtrZXkgLHRoaXMuX2l0ZW1zW2tleV1dKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFJldHVybnMgYSBsaXN0IG9mIGl0ZW0gbmFtZXMuXHJcblx0cmV0dXJuIGl0ZW1zO1xyXG4gICAgfTtcclxuXHJcbiAgICBpdGVtX3N0b3JlLmtleXMgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gQ3JlYXRlIGEgbGlzdCBvIGtleXMuXHJcbiAgICAgICAgdmFyIGtleXMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5faXRlbXMpIFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBSZXR1cm5zIGEgbGlzdCBvZiBpdGVtIG5hbWVzLlxyXG5cdHJldHVybiBrZXlzO1xyXG4gICAgfTtcclxuXHJcbiAgICBpdGVtX3N0b3JlLm5ldyA9IGZ1bmN0aW9uKHBUeXBlLCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBDaGVjayBpZiB0aGUgZWxlbWVudCBpcyBwYXJ0IG9mIHRoZSBvc3dlYiBuYW1lIHNwYWNlXHJcblx0aWYgKG9zd2ViLmlzQ2xhc3MocFR5cGUpID09IHRydWUpXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBBZGQgdGhlIG5ldyBpdGVtIGFzIHByb3BlcnR5IG9mIGl0ZW1zLlxyXG4gICAgICAgICAgICB0aGlzLl9pdGVtc1twTmFtZV0gPSBvc3dlYi5uZXdJdGVtQ2xhc3MocFR5cGUsIHRoaXMuX2V4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgICAgICB9XHJcblx0ZWxzZVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gVW5rd29uZSBjbGFzcyBkZWZpbml0aW9uLCBzaG93IGVycm9yIG1lc3NhZ2UuXHJcbiAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKG9zd2ViLmNvbnN0YW50cy5FUlJPUl8wMDkgKyBwVHlwZSk7XHJcblx0fVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgaXRlbV9zdG9yZS5wcmVwYXJlID0gZnVuY3Rpb24ocE5hbWUsIHBQYXJlbnQpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gRXhlY3V0ZXMgdGhlIHByZXBhcmUgcGhhc2Ugb2YgYW4gaXRlbSwgYW5kIHVwZGF0ZXMgdGhlIGl0ZW0gc3RhY2suXHJcblx0b3N3ZWIuaXRlbV9zdGFjay5wdXNoKHBOYW1lLCAncHJlcGFyZScpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX2l0ZW1zW3BOYW1lXS5fcGFyZW50ID0gcFBhcmVudDtcclxuICAgICAgICB0aGlzLl9pdGVtc1twTmFtZV0ucHJlcGFyZSgpO1xyXG4gICAgfTtcdFxyXG5cclxuICAgIGl0ZW1fc3RvcmUucnVuID0gZnVuY3Rpb24ocE5hbWUsIHBQYXJlbnQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBjdXJyZW50IGFuZCBpdHMgcGFyZW50IGl0ZW0uXHJcblx0b3N3ZWIuZXZlbnRzLl9jdXJyZW50X2l0ZW0gICAgICAgICA9IHRoaXMuX2l0ZW1zW3BOYW1lXTtcclxuXHRvc3dlYi5ldmVudHMuX2N1cnJlbnRfaXRlbS5fcGFyZW50ID0gcFBhcmVudDtcclxuXHRcdFxyXG5cdC8vIEV4ZWN1dGVzIHRoZSBydW4gcGhhc2Ugb2YgYW4gaXRlbSwgYW5kIHVwZGF0ZXMgdGhlIGl0ZW0gc3RhY2suXHJcblx0b3N3ZWIuaXRlbV9zdGFjay5wdXNoKHBOYW1lLCAncnVuJyk7XHJcblx0dGhpcy5faXRlbXNbcE5hbWVdLnJ1bigpO1xyXG4gICAgfTtcclxuXHJcbiAgICBpdGVtX3N0b3JlLnZhbGlkX25hbWUgPSBmdW5jdGlvbihwSXRlbV90eXBlLCBwU3VnZ2VzdGlvbilcclxuICAgIHtcclxuICAgICAgICAvLyBDaGVjayB0aGUgb3B0aW9uYWwgcGFyYW1ldGVycy5cclxuICAgICAgICBwU3VnZ2VzdGlvbiA9ICh0eXBlb2YgcFN1Z2dlc3Rpb24gPT09ICd1bmRlZmluZWQnKSA/IG51bGwgOiBwU3VnZ2VzdGlvbjtcclxuICAgICAgICBcclxuICAgICAgICBpZiAocFN1Z2dlc3Rpb24gPT0gbnVsbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBuYW1lID0gJ25ld18nICsgcEl0ZW1fdHlwZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGlzLl9leHBlcmltZW50LnN5bnRheC5zYW5pdGl6ZShwU3VnZ2VzdGlvbiwgdHJ1ZSwgZmFsc2UpO1xyXG4gICAgICAgIH0gICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBDcmVhdGUgYSB1bmlxdWUgbmFtZS5cclxuICAgICAgICB2YXIgaSAgICAgPSAxO1xyXG4gICAgICAgIHZhciBfbmFtZSA9IG5hbWU7XHJcbiAgICAgICAgd2hpbGUgKHRoaXMuX2l0ZW1zLmhhc093blByb3BlcnR5KF9uYW1lKSA9PSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgX25hbWUgPSBuYW1lICsgJ18nICsgU3RyaW5nKGkpO1xyXG5cdCAgICBpKys7XHJcbiAgICAgICAgfSBcclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIGZ1bmN0aW9uIHJlc3VsdFxyXG4gICAgICAgIHJldHVybiBfbmFtZTsgXHJcbiAgICB9OyAgICBcclxuICAgIFxyXG4gICAgaXRlbV9zdG9yZS52YWx1ZXMgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgXHQvLyBDcmVhdGUgYSBsaXN0IG8ga2V5cy5cclxuICAgICAgICB2YXIgdmFsdWVzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuX2l0ZW1zKSBcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhbHVlcy5wdXNoKHRoaXMuX2l0ZW1zW2tleV0pO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUmV0dXJucyBhIGxpc3Qgb2YgaXRlbSBuYW1lcy5cclxuXHRyZXR1cm4gdmFsdWVzO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBpdGVtX3N0b3JlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5pdGVtX3N0b3JlID0gaXRlbV9zdG9yZTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHBybmcuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHBybmcoKVxyXG4gICAge1xyXG4gICAgXHR0aHJvdyBcIlRoZSBjbGFzcyBwcm5nIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhXCI7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIFNldCB0aGUgY2xhc3MgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuICAgIHBybmcuX3ByZXZpb3VzID0gMDtcclxuICAgIHBybmcuX3BybmcgICAgID0gdWhlcHJuZygpOyAgICBcclxuICAgIHBybmcuX3NlZWQgICAgID0gJzAnO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIGNsYXNzIG1ldGhvZHMgLSBydW4gY3ljbGUuICAgXHJcbiAgICAgKi9cclxuICAgIFxyXG4gICAgcHJuZy5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBDcmVhdGUgdGhlIHJhbmRvbSBzZWVkLiBcclxuICAgICAgICB0aGlzLl9wcm5nLmluaXRTdGF0ZSgpO1xyXG4gICAgICAgIHRoaXMuX3BybmcuaGFzaFN0cmluZyh0aGlzLl9zZWVkKTsgXHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwcm5nLl9nZXROZXh0ID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBHZXQgdGhlIG5leHQgcmFuZG9tIG51bWJlci5cclxuICAgICAgICB0aGlzLl9wcmV2aW91cyA9ICh0aGlzLl9wcm5nKDEwMDAwMDAwMDAwMDAwMDApIC8gMTAwMDAwMDAwMDAwMDAwMCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUmV0dXJuIGZ1bmN0aW9uIHJlc3VsdC5cclxuICAgICAgICByZXR1cm4gdGhpcy5fcHJldmlvdXM7XHJcblx0fTtcclxuXHJcbiAgICBwcm5nLl9nZXRQcmV2aW91cyA9IGZ1bmN0aW9uKCkgXHJcbiAgICB7XHJcbiAgICAgICAgLy8gUmV0dXJuIGZ1bmN0aW9uIHJlc3VsdC5cclxuICAgICAgICByZXR1cm4gdGhpcy5fcHJldmlvdXM7XHJcbiAgICB9O1xyXG5cclxuICAgIHBybmcuX2dldFNlZWQgPSBmdW5jdGlvbigpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIFJldHVybiB0aGUgY3VycmVudCBzZWVkIHZhbHVlLlxyXG4gICAgICAgIHJldHVybiB0aGlzLl9zZWVkOyAgICAgICAgXHJcbiAgICB9O1xyXG5cclxuICAgIHBybmcuX3JhbmRvbSA9IGZ1bmN0aW9uKHBNaW4sIHBNYXgpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgcmFuZ2UgZGV2aWRlci5cclxuICAgICAgICB2YXIgZGV2aWRlciA9ICgxIC8gKChwTWF4IC0gcE1pbikgKyAxKSk7XHJcbiAgICAgICAgIFxyXG4gICAgICAgIC8vIEdldCB0aGUgcmFuZG9tIG51bWJlciBhbmQgZGV2aWRlIGl0LlxyXG4gICAgICAgIHRoaXMuX3ByZXZpb3VzID0gKCh0aGlzLl9wcm5nKDEwMDAwMDAwMDAwMDAwMDApIC8gMTAwMDAwMDAwMDAwMDAwMCkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgZGV2aWRlci5cclxuICAgICAgICB0aGlzLl9wcmV2aW91cyA9IHBNaW4gKyBNYXRoLmZsb29yKHRoaXMuX3ByZXZpb3VzIC8gZGV2aWRlcik7XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgIC8vIFJldHVybiBmdW5jdGlvbiByZXN1bHQuIFxyXG4gICAgICAgIHJldHVybiB0aGlzLl9wcmV2aW91cztcclxuICAgIH07XHJcblxyXG4gICAgcHJuZy5fcmVzZXQgPSBmdW5jdGlvbigpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIFNldCB0aGUgcmFuZG9tIHNlZWQgdmFsdWUgdG8gMC4gXHJcbiAgICAgICAgdGhpcy5fc2VlZCA9ICcwJztcclxuXHJcbiAgICAgICAgLy8gUmVzZXQgdGhlIFBSTkcgcmFuZ2UuXHJcbiAgICAgICAgdGhpcy5fcHJuZy5pbml0U3RhdGUoKTtcclxuICAgICAgICB0aGlzLl9wcm5nLmhhc2hTdHJpbmcoU3RyaW5nKHRoaXMuX3NlZWQpKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHBybmcuX3NldFNlZWQgPSBmdW5jdGlvbihwU2VlZCkgXHJcbiAgICB7XHJcbiAgICAgICAgLy8gU2V0IHRoZSByYW5kb20gc2VlZCB2YWx1ZS4gXHJcbiAgICAgICAgdGhpcy5fc2VlZCA9IFN0cmluZyhwU2VlZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUmVzZXQgdGhlIFBSTkcgcmFuZ2UuXHJcbiAgICAgICAgdGhpcy5fcHJuZy5pbml0U3RhdGUoKTtcclxuICAgICAgICB0aGlzLl9wcm5nLmhhc2hTdHJpbmcodGhpcy5fc2VlZCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIHBybmcgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnBybmcgPSBwcm5nO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgcHl0aG9uX3dvcmtzcGFjZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gcHl0aG9uX3dvcmtzcGFjZSgpXHJcbiAgICB7XHJcbiAgICBcdHRocm93IFwiVGhlIGNsYXNzIHB5dGhvbl93b3Jrc3BhY2UgY2Fubm90IGJlIGluc3RhbnRpYXRlZCFcIjtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuICAgIFxyXG4gICAgcHl0aG9uX3dvcmtzcGFjZS5fZXZhbCA9IGZ1bmN0aW9uKHBCeXRlY29kZSlcclxuICAgIHtcclxuICAgICAgICAvLyBDaGVjayB3aWNoIHR5cGUgb2YgZXhwcmVzc2lvbiBtdXN0IGJlIGV2YWxlZC5cclxuICAgICAgICBpZiAodHlwZW9mIHBCeXRlY29kZSA9PT0gJ2Jvb2xlYW4nKSAgICBcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBwQnl0ZWNvZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBwQnl0ZWNvZGUgPT09ICdzdHJpbmcnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gT3BlbiBzZXNhbWUgc2NyaXB0LCBmaXJzdCBjaGVjayBmb3IgcGFyYW1ldGVyIHZhbHVlcy4gXHJcbiAgICAgICAgICAgIHBCeXRlY29kZSA9IG9zd2ViLnN5bnRheC5ldmFsX3RleHQocEJ5dGVjb2RlKTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gRXZhbHVhdGUgdGhlIGV4cHJlc3Npb24uXHJcbiAgICAgICAgICAgIGV2YWxfc3RyaW5nID0gb3N3ZWIuc3ludGF4LnJlbW92ZV9xdW90ZXMocEJ5dGVjb2RlKVxyXG4gICAgICAgICAgICBpZihldmFsX3N0cmluZyA9PSBcImFsd2F5c1wiKXtcclxuICAgICAgICAgICAgICAgIGI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfWVsc2UgaWYoZXZhbF9zdHJpbmcgPT0gXCJuZXZlclwiKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChldmFsX3N0cmluZyk7XHJcbiAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCc+cHl0aG9uIHNjcmlwdCAtIG5vdCBzdXBwb3J0ZWQgeWV0Jyk7XHJcbiAgICAgICAgICAgIHJldHVybiBldmFsKHBCeXRlY29kZSk7XHJcbiAgICAgICAgfSAgICBcclxuICAgIH07XHJcblx0XHJcbiAgICBweXRob25fd29ya3NwYWNlLmluaXRfZ2xvYmFscyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIH07XHJcblx0XHJcbiAgICAvLyBCaW5kIHRoZSBweXRob25fd29ya3NwYWNlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5weXRob25fd29ya3NwYWNlID0gcHl0aG9uX3dvcmtzcGFjZTtcclxufSgpKTtcclxuIiwiIFxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBzeW50YXguXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHN5bnRheCgpXHJcbiAgICB7XHJcbiAgICBcdHRocm93IFwiVGhlIGNsYXNzIHN5bnRheCBjYW5ub3QgYmUgaW5zdGFudGlhdGVkIVwiO1xyXG4gICAgfTsgXHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHJpdmF0ZSBjbGFzcyBtZXRob2RzLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgc3ludGF4Ll9jb252ZXJ0UHl0aG9uID0gZnVuY3Rpb24ocFNjcmlwdClcclxuICAgIHtcclxuICAgIFx0cmV0dXJuIHBTY3JpcHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIHN5bnRheC5pc051bWJlciA9IGZ1bmN0aW9uKG4pXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcihuKSA9PSBuOyAvLyBhYW5nZXBhc3QgdmFuID09IG5hYXIgPT09IGVuIHdlZXIgdGVydWcgbmFhciAnPT0nIGFuZGVycyB3ZXJrdCBkdXJhdGlvbiBuaWV0LlxyXG4gICAgfTtcclxuXHJcbiAgICBzeW50YXguaXNGbG9hdCA9IGZ1bmN0aW9uKG4pXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcihuKSA9PT0gbiAmJiBuICUgMSAhPT0gMDtcclxuICAgIH07XHJcblxyXG4gICAgc3ludGF4LnJlbW92ZV9xdW90ZXMgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIGlmIChwU3RyaW5nID09ICdcIlwiJylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIGVsc2UgaWYgKChwU3RyaW5nWzBdID09ICdcIicpICYmIChwU3RyaW5nW3BTdHJpbmcubGVuZ3RoIC0gMV0gPT0gJ1wiJykpXHJcblx0e1xyXG4gICAgICAgICAgICByZXR1cm4gcFN0cmluZy5zbGljZSgxLCBwU3RyaW5nLmxlbmd0aCAtIDEpO1xyXG5cdH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICByZXR1cm4gcFN0cmluZztcclxuXHR9XHRcclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMuICAgXHJcbiAgICAgKi9cclxuICAgIFxyXG4gICAgc3ludGF4LmNvbXBpbGVfY29uZCA9IGZ1bmN0aW9uKHBDbmQsIHBCeXRlY29kZSlcclxuICAgIHtcclxuXHQvLyBDaGVjayBmb3IgY29uZGl0aW9uYWwgcGFyYW10ZXJzLlxyXG5cdHBCeXRlY29kZSA9ICh0eXBlb2YgcEJ5dGVjb2RlID09PSAndW5kZWZpbmVkJykgPyB0cnVlIDogcEJ5dGVjb2RlO1x0XHJcblx0XHRcclxuXHRpZiAocENuZCA9PSAnYWx3YXlzJylcclxuXHR7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG5cdH0gXHJcblx0ZWxzZSBpZiAocENuZCA9PSAnbmV2ZXInKVxyXG5cdHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cdH0gXHJcbiAgICAgICAgZWxzZVxyXG5cdHtcclxuICAgICAgICAgICAgaWYgKHBDbmQuc3Vic3RyaW5nKDAsMSkgPT0gJz0nKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBQeXRob24gc2NyaXB0LCBjb21waWxlIGl0IHRvIGFuIGFzdCB0cmVlLlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3B5dGhvbiBzY3JpcHQgaXMgbm90IHN1cHBvcnRlZCB5ZXQnKTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBvcGVuc2VzYW1lIHNjcmlwdCwgY29udmVydCBpdCB0byBqYXZhc2NyaXB0LlxyXG4gICAgICAgICAgICAgICAgcENuZCA9IHBDbmQucmVwbGFjZSgvW14oIT0pXVs9XS9nLCAnPT0nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gICAgXHJcblxyXG4gICAgICAgIHJldHVybiBwQ25kO1xyXG4gICAgfTtcclxuXHRcclxuICAgIHN5bnRheC5ldmFsX3RleHQgPSBmdW5jdGlvbihwVHh0LCBwVmFycywgcFJvdW5kX2Zsb2F0LCBwVmFyKVxyXG4gICAge1xyXG5cdC8vIEV2YWx1YXRlcyB2YXJpYWJsZXMgYW5kIGlubGluZSBQeXRob24gaW4gYSB0ZXh0IHN0cmluZy5cclxuXHR2YXIgcmVzdWx0ICAgICA9IHBUeHQ7XHJcblx0dmFyIHByb2Nlc3NpbmcgPSByZXN1bHQuc2VhcmNoKC9bXltcXF1dKyg/PV0pL2cpO1xyXG5cdFx0XHJcblx0d2hpbGUgKHByb2Nlc3NpbmcgIT0gLTEpXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBSZXBsYWNlIHRoZSBmb3VuZCB2YWx1ZSB3aXRoIHRoZSB2YXJpYWJsZS5cclxuICAgICAgICAgICAgdmFyIHZhcmlhYmxlID0gcmVzdWx0LnNsaWNlKHByb2Nlc3NpbmcscmVzdWx0LmluZGV4T2YoJ10nKSk7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcFZhcnMgPT09ICd1bmRlZmluZWQnKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvc3dlYi5ydW5uZXIuZXhwZXJpbWVudC52YXJzW3ZhcmlhYmxlXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHBWYXJzW3ZhcmlhYmxlXTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJlc3VsdFx0ID0gcmVzdWx0LnJlcGxhY2UoJ1snICsgdmFyaWFibGUgKyAnXScsdmFsdWUpO1x0XHRcdFxyXG4gICAgICAgICAgICBwcm9jZXNzaW5nICAgPSByZXN1bHQuc2VhcmNoKC9bXltcXF1dKyg/PV0pL2cpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgc3ludGF4LnBhcnNlX2NtZCA9IGZ1bmN0aW9uKHBTdHJpbmcpXHJcbiAgICB7XHJcblx0Ly8gc3BsaXQgdGhlIGFzdHJpbmcuXHJcblx0dmFyIHRva2VucyA9IHRoaXMuc3BsaXQocFN0cmluZyk7XHJcblx0dG9rZW5zLnNoaWZ0KCk7XHJcblx0dG9rZW5zLnNoaWZ0KCk7XHJcblx0cmV0dXJuIHRva2VucztcclxuICAgIH07XHJcblxyXG4gICAgc3ludGF4LnNhbml0aXplID0gZnVuY3Rpb24ocFN0cmluZywgcFN0cmljdCwgcEFsbG93VmFycylcclxuICAgIHtcclxuXHQvLyBSZW1vdmVzIGludmFsaWQgY2hhcmFjdGVycyAobm90YWJseSBxdW90ZXMpIGZyb20gdGhlIHN0cmluZy5cclxuXHRyZXR1cm4gcFN0cmluZztcclxuICAgIH07XHJcblxyXG4gICAgc3ludGF4LnNwbGl0ID0gZnVuY3Rpb24ocExpbmUpXHJcbiAgICB7XHJcbiAgICBcdC8vIFJldHVybiBhbiBhcnJheSB3aXRoIHRva2VucyBpZ25vcmluZyB3aGl0ZXNwYWNlcyB3aXRoaW4uIFxyXG5cdHZhciByZXN1bHQgPSBwTGluZS5tYXRjaCgvKD86W15cXHNcIl0rfFwiW15cIl0qXCIpKy9nKTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gKHJlc3VsdCAhPSBudWxsKSA/IHJlc3VsdCA6IFtdO1xyXG4gICAgfTsgICAgXHJcblxyXG4gICAgLy8gQmluZCB0aGUgc3ludGF4IGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5zeW50YXggPSBzeW50YXg7XHJcbn0oKSk7XHJcblxyXG4iLCIvKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyB2YXJfc3RvcmUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHZhcl9zdG9yZShwSXRlbSwgcFBhcmVudClcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHByb3BlcnRpZXMuIFxyXG4gICAgICAgIHRoaXMuX2l0ZW0gICA9IHBJdGVtO1xyXG4gICAgICAgIHRoaXMuX3BhcmVudCA9IHBQYXJlbnQ7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gdmFyX3N0b3JlLnByb3RvdHlwZTtcclxuICAgIFxyXG4gICAgLy8gU2V0IHRoZSBjbGFzcyBkZWZhdWx0IHByb3BlcnRpZXMuIFxyXG4gICAgcC5faXRlbSAgID0gbnVsbDtcclxuICAgIHAuX3BhcmVudCA9IG51bGw7ICAgICAgICBcclxuXHRcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5nZXQgPSBmdW5jdGlvbihwVmFyLCBwRGVmYXVsdCwgcEV2YWwsIHBWYWxpZClcclxuICAgIHtcclxuXHQvLyBTZXQgdGhlIG9wdGlvbmFsIGFyZ3VtZW50c1xyXG5cdHBEZWZhdWx0ID0gKHR5cGVvZiBwRGVmYXVsdCA9PT0gJ3VuZGVmaW5lZCcpID8gbnVsbCA6IHBEZWZhdWx0O1xyXG5cdHBFdmFsICAgID0gKHR5cGVvZiBwRXZhbCA9PT0gJ3VuZGVmaW5lZCcpICAgID8gdHJ1ZSA6IHBFdmFsO1xyXG5cdHBWYWxpZCAgID0gKHR5cGVvZiBwVmFsaWQgPT09ICd1bmRlZmluZWQnKSAgID8gbnVsbCA6IHBWYWxpZDtcclxuXHRcdFxyXG5cdHZhciB2YWx1ZSA9IG51bGw7XHJcblxyXG5cdC8vIEdldHMgYW4gZXhwZXJpbWVudGFsIHZhcmlhYmxlLlxyXG5cdGlmIChwVmFyIGluIHRoaXMpXHJcblx0e1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXNbcFZhcl0gPT0gJ3N0cmluZycpXHJcbiAgICAgICAgICAgIHtcclxuXHQgXHR2YWx1ZSA9IG9zd2ViLnN5bnRheC5ldmFsX3RleHQodGhpc1twVmFyXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiBcdFx0dmFsdWUgPSB0aGlzW3BWYXJdO1xyXG4gICAgICAgICAgICB9XHJcbiBcdH1cclxuXHJcblx0Ly8gUmV0dXJuIGZ1bmN0aW9uIHJlc3VsdC5cclxuXHRyZXR1cm4gdmFsdWU7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuaW5zcGVjdCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHR2YXIga2V5cyA9IFtdO1xyXG5cdGZvcih2YXIga2V5IGluIHRoaXMpXHJcbiAgXHR7XHJcbiAgICAgICAgICAgIGtleXMucHVzaChrZXkpO1xyXG4gICBcdH1cclxuICAgXHRcdFxyXG4gICBcdC8vIFNsaWRlIGRlZmF1bHQgcHJvcGVydGllcy4gXHJcbiAgIFx0a2V5cyA9IGtleXMuc2xpY2UoMixrZXlzLmxlbmd0aCAtIDMpO1xyXG4gICBcdFx0XHJcblx0cmV0dXJuIGtleXM7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuc2V0ID0gZnVuY3Rpb24ocFZhciwgcFZhbClcclxuICAgIHtcclxuXHQvLyBTZXRzIGFuZCBleHBlcmltZW50YWwgdmFyaWFibGUuXHJcblx0dGhpc1twVmFyXSA9IHBWYWw7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgLy8gQmluZCB0aGUgdmFycyBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIudmFyX3N0b3JlID0gdmFyX3N0b3JlO1xyXG59KCkpO1xyXG4iLCJcdFxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBpdGVtLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBpdGVtKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy5cclxuXHR0aGlzLl9nZXRfbG9jayA9IG51bGw7XHJcblx0dGhpcy5fcGFyZW50ICAgPSBudWxsO1xyXG5cdHRoaXMuX3N0YXR1cyAgID0gb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19OT05FO1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuY291bnQgICAgICA9IDA7XHRcclxuXHR0aGlzLmRlYnVnXHQ9IG9zd2ViLmRlYnVnLmVuYWJsZWQ7XHJcblx0dGhpcy5leHBlcmltZW50ID0gKHBFeHBlcmltZW50ID09IG51bGwpID8gdGhpcyA6IHBFeHBlcmltZW50O1xyXG5cdHRoaXMubmFtZSAgICAgICA9IHBOYW1lO1x0XHJcblx0dGhpcy52YXJzIFx0PSAodGhpcy52YXJzKSA/IHRoaXMudmFycyA6IG5ldyBvc3dlYi52YXJfc3RvcmUodGhpcywgbnVsbCk7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgb2JqZWN0IHJlYWx0ZWQgcHJvcGVydGllcy5cclxuXHR0aGlzLmNsb2NrICAgICAgICAgICAgPSB0aGlzLmV4cGVyaW1lbnQuX2Nsb2NrO1x0XHRcclxuXHR0aGlzLmxvZyAgICAgICAgICAgICAgPSB0aGlzLmV4cGVyaW1lbnQuX2xvZztcclxuXHR0aGlzLnB5dGhvbl93b3Jrc3BhY2UgPSB0aGlzLmV4cGVyaW1lbnQuX3B5dGhvbl93b3Jrc3BhY2U7XHRcclxuICAgICAgICB0aGlzLnN5bnRheCAgICAgICAgICAgPSB0aGlzLmV4cGVyaW1lbnQuX3N5bnRheDsgXHRcclxuXHRcclxuICAgICAgICAvLyBSZWFkIHRoZSBpdGVtIGRlZmluaXRpb24gc3RyaW5nLlx0XHJcblx0dGhpcy5mcm9tX3N0cmluZyhwU2NyaXB0KTtcclxuICAgIH0gXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IGl0ZW0ucHJvdG90eXBlO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5jbG9jayAgICAgICAgICAgID0gbnVsbDtcclxuICAgIHAuY29tbWVudHMgICAgICAgICA9IG51bGw7XHJcbiAgICBwLmNvdW50ICAgICAgICAgICAgPSAwO1xyXG4gICAgcC5kZWJ1ZyAgICAgICAgICAgID0gZmFsc2U7XHJcbiAgICBwLmV4cGVyaW1lbnQgICAgICAgPSBudWxsO1xyXG4gICAgcC5sb2cgICAgICAgICAgICAgID0gbnVsbDtcclxuICAgIHAubmFtZSAgICAgICAgICAgICA9ICcnO1xyXG4gICAgcC5zeW50YXggICAgICAgICAgID0gbnVsbDtcclxuICAgIHAucHl0aG9uX3dvcmtzcGFjZSA9IG51bGw7XHJcbiAgICBwLnZhcnMgICAgICAgICAgICAgPSBudWxsO1xyXG4gICAgcC52YXJpYWJsZXMgICAgICAgID0gbnVsbDtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGdlbmVyYWwgZnVuY3Rpb24uXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLmR1bW15ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyBEdW1teSBmdW5jdGlvbiwgY29udGludWUgZXhlY3V0aW9uIG9mIGFuIGl0ZW0gZGlyZWN0bHkuXHJcbiAgICB9O1xyXG4gICBcclxuICAgIHAucmVzb2x1dGlvbiA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0LyogLy8gUmV0dXJucyB0aGUgZGlzcGxheSByZXNvbHV0aW9uIGFuZCBjaGVja3Mgd2hldGhlciB0aGUgcmVzb2x1dGlvbiBpcyB2YWxpZC5cclxuICAgICAgICB2YXIgdyA9IHRoaXMudmFycy5nZXQoJ3dpZHRoJyk7XHJcblx0dmFyIGggPSB0aGlzLnZhcnMuZ2V0KCdoZWlnaHQnKTtcclxuXHRpZiAoKHR5cGVvZiB3ICE9PSAnbnVtYmVyJykgfHwgKHR5cGVvZiBoICE9PSAnbnVtYmVyJykpXHJcblx0e1xyXG4gICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignKCcgKyBTdHJpbmcodykgKyAnLCcgKyBTdHJpbmcoaCkgKyAnKSBpcyBub3QgYSB2YWxpZCByZXNvbHV0aW9uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBbdywgaF07ICovXHJcbiAgICB9O1xyXG4gICBcclxuICAgIHAuc2V0X3Jlc3BvbnNlID0gZnVuY3Rpb24ocFJlc3BvbnNlLCBwUmVzcG9uc2VfdGltZSwgcENvcnJlY3QpXHJcbiAgICB7XHJcblx0Ly8gUHJvY2Vzc2VzIGEgcmVzcG9uc2UgaW4gc3VjaCBhIHdheSB0aGF0IGZlZWRiYWNrIHZhcmlhYmxlcyBhcmUgdXBkYXRlZCBhcyB3ZWxsLlxyXG4gICAgICAgIGNvbnNvbGUubG9nKCd3YXJuaW5nOiBtZXRob2QgXCJpdGVtLnNldF9yZXNwb25zZVwiIG5vdCBpbXBsZW1lbnRlZCB5ZXQuJyk7XHJcbiAgICB9O1xyXG4gXHJcbiAgICBwLnNsZWVwID0gZnVuY3Rpb24ocE1zKVxyXG4gICAge1xyXG5cdC8vIFBhdXNlcyB0aGUgb2JqZWN0IGV4ZWN1dGlvbi4gIVdBUk5JTkcgVGhpcyBmdW5jdGlvbiBjYW4gbm90IGJlIGltcGxlbWVudGVkIGR1ZSB0aGUgc2NyaXB0IGJsb2NraW5nIG9mIGphdmFzY3JpcHQuXHJcblx0dGhpcy5jbG9jay5zbGVlcChwTXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnRpbWUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gUmV0dXJucyB0aGUgY3VycmVudCB0aW1lLlxyXG4gICAgXHRyZXR1cm4gdGhpcy5jbG9jay50aW1lKCk7XHJcbiAgICB9O1xyXG5cclxuICAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5mcm9tX3N0cmluZyA9IGZ1bmN0aW9uKHBTdHJpbmcpXHJcbiAgICB7XHJcblx0Ly8gUGFyc2VzIHRoZSBpdGVtIGZyb20gYSBkZWZpbml0aW9uIHN0cmluZy5cclxuXHRvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKCcnKTtcclxuICAgICAgICB0aGlzLnZhcmlhYmxlcyA9IHt9O1xyXG5cdHRoaXMucmVzZXQoKTtcclxuXHR0aGlzLmNvbW1lbnRzID0gW107XHJcblx0dGhpcy5yZXNldCgpO1xyXG5cdFx0XHJcblx0Ly8gU3BsaXQgdGhlIHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIGxpbmVzLiAgXHJcblx0aWYgKHBTdHJpbmcgIT0gbnVsbClcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciBsaW5lcyA9IHBTdHJpbmcuc3BsaXQoJ1xcbicpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKChsaW5lc1tpXSAhPSAnJykgJiYgKHRoaXMucGFyc2VfdmFyaWFibGUobGluZXNbaV0pID09IGZhbHNlKSlcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VfbGluZShsaW5lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHR9XHRcdFx0XHRcdFxyXG4gICAgfTtcclxuXHRcclxuICAgIHAucGFyc2VfY29tbWVudCA9IGZ1bmN0aW9uKHBMaW5lKVxyXG4gICAge1xyXG5cdC8vIFBhcnNlcyBjb21tZW50cyBmcm9tIGEgc2luZ2xlIGRlZmluaXRpb24gbGluZSwgaW5kaWNhdGVkIGJ5ICMgLy8gb3IgJy5cclxuXHRwTGluZSA9IHBMaW5lLnRyaW0oKTtcclxuXHRpZiAoKHBMaW5lLmxlbmd0aCA+IDApICYmIChwTGluZS5jaGFyQXQoMCkgPT0gJyMnKSlcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIEFkZCBjb21tZW50cyB0byB0aGUgYXJyYXkgcmVtb3ZpbmcgdGhlIGZpcnN0IGNoYXJhY3Rlci5cclxuICAgICAgICAgICAgdGhpcy5jb21tZW50cy5wdXNoKHBMaW5lLnNsaWNlKDEpKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG5cdH1cdFxyXG5cdGVsc2UgaWYgKChwTGluZS5sZW5ndGggPiAxKSAmJiAocExpbmUuY2hhckF0KDApID09ICcvJykpXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBBZGQgY29tbWVudHMgdG8gdGhlIGFycmF5IHJlbW92aW5nIHRoZSBmaXJzdCB0d28gY2hhcmFjdGVycy5cclxuICAgICAgICAgICAgdGhpcy5jb21tZW50cy5wdXNoKHBMaW5lLnNsaWNlKDIpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1x0XHRcdFxyXG5cdH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblx0fVxyXG4gICAgfTtcdFxyXG5cdFxyXG4gICAgcC5wYXJzZV9rZXl3b3JkID0gZnVuY3Rpb24ocExpbmUsIHBGcm9tX2FzY2lpLCBwRXZhbClcclxuICAgIHtcclxuICAgIH07XHJcblxyXG4gICAgcC5wYXJzZV9saW5lID0gZnVuY3Rpb24ocExpbmUpXHJcbiAgICB7XHJcblx0Ly8gQWxsb3dzIGZvciBhcmJpdHJhcnkgbGluZSBwYXJzaW5nLCBmb3IgaXRlbS1zcGVjaWZpYyByZXF1aXJlbWVudHMuXHJcbiAgICB9O1xyXG5cclxuICAgIHAucGFyc2VfdmFyaWFibGUgPSBmdW5jdGlvbihwTGluZSlcclxuICAgIHtcclxuICAgICAgICAvLyBSZWFkcyBhIHNpbmdsZSB2YXJpYWJsZSBmcm9tIGEgc2luZ2xlIGRlZmluaXRpb24gbGluZS5cclxuICAgICAgICBpZiAodGhpcy5wYXJzZV9jb21tZW50KHBMaW5lKSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW5zID0gb3N3ZWIuc3ludGF4LnNwbGl0KHBMaW5lKTtcclxuICAgICAgICAgICAgaWYgKCh0b2tlbnMgIT0gbnVsbCkgJiYgKHRva2Vucy5sZW5ndGggPiAwKSAmJiAodG9rZW5zWzBdID09ICdzZXQnKSlcclxuICAgICAgICAgICAge1xyXG5cdFx0aWYgKHRva2Vucy5sZW5ndGggIT0gMylcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignRXJyb3IgcGFyc2luZyB2YXJpYWJsZSBkZWZpbml0aW9uOiAnICsgcExpbmUpO1xyXG5cdFx0fVx0XHJcbiAgICAgICAgICAgIFx0ZWxzZVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJldHRyaWV2ZSB0aGUgdmFsdWUgb2YgdGhlIHZhcmlhYmxlLCByZW1vdmUgYWRkaXRpb25hbCBxdW90ZXMuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb3N3ZWIuc3ludGF4LnJlbW92ZV9xdW90ZXModG9rZW5zWzJdKTtcclxuICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgbnVtYmVyIHR5cGVzLlxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb3N3ZWIuc3ludGF4LmlzTnVtYmVyKHZhbHVlKSA/IE51bWJlcih2YWx1ZSkgOiB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhcnMuc2V0KHRva2Vuc1sxXSwgdmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cdFxyXG4gICAgfTtcclxuXHRcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubiBjeWNsZS4gXHJcbiAgICAgKi9cclxuICAgIFxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBSZXNldHMgYWxsIGl0ZW0gdmFyaWFibGVzIHRvIHRoZWlyIGRlZmF1bHQgdmFsdWUuXHJcbiAgICB9O1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbXBsZW1lbnRzIHRoZSBwcmVwYXJlIHBoYXNlIG9mIHRoZSBpdGVtLlxyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLnNldCgnY291bnRfJyArIHRoaXMubmFtZSwgdGhpcy5jb3VudCk7XHJcblx0dGhpcy5jb3VudCsrO1xyXG5cdFx0XHJcblx0Ly8gU2V0IHRoZSBzdGF0dXMgdG8gaW5pdGlhbGl6ZS5cclxuXHR0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0lOSVRJQUxJWkU7XHJcbiAgICBcdFxyXG4gICAgICAgIC8vIEZvciBkZWJ1Z2dpbmcuXHJcbiAgICAgICAgb3N3ZWIuZGVidWcuYWRkTWVzc2FnZSgncHJlcGFyZScgKyB0aGlzLm5hbWUpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEltcGxlbWVudHMgdGhlIGNvbXBsZXRlIHBoYXNlIG9mIHRoZSBpdGVtICh0byBzdXBwb3J0IGJsb2NraW5nIHNjcmlwdCBpbiB0aGUgcHJlcGFyZSBwaGFzZSkuXHJcblx0aWYgKCh0aGlzLl9wYXJlbnQgIT09IG51bGwpICYmICh0aGlzLnR5cGUgIT09ICdmZWVkYmFjaycpKVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gUHJlcGFyZSBjeWNsZSBvZiBwYXJlbnQuXHJcbiAgICAgICAgICAgIHRoaXMuX3BhcmVudC5wcmVwYXJlX2NvbXBsZXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBwLnByZXBhcmVfY29tcGxldGUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gRHVtbXkgZnVuY3Rpb24gZm9yIGNvbXBsZXRpb24gcHJvY2Vzcy5cclxuICAgIH07XHJcblxyXG4gICAgcC5zZXRfaXRlbV9vbnNldCA9IGZ1bmN0aW9uKHBUaW1lKVxyXG4gICAge1xyXG4gXHQvLyBTZXQgYSB0aW1lc3RhbXAgZm9yIHRoZSBpdGVtJ3MgZXhlY3V0aW9uc1xyXG5cdHZhciB0aW1lID0gKHBUaW1lICE9IG51bGwpID8gcFRpbWUgOiB0aGlzLmNsb2NrLnRpbWUoKTtcclxuXHR0aGlzLmV4cGVyaW1lbnQudmFycy5zZXQoJ3RpbWVfJyArIHRoaXMubmFtZSwgdGltZSk7XHJcbiAgICB9O1x0XHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIEltcGxlbWVudHMgdGhlIHJ1biBwaGFzZSBvZiB0aGUgaXRlbS5cclxuICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKCdydW4nICsgdGhpcy5uYW1lKTtcclxuICAgIH07XHJcblxyXG4gICAgcC51cGRhdGUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIEltcGxlbWVudHMgdGhlIHVwZGF0ZSBwaGFzZSBvZiB0aGUgaXRlbS5cclxuICAgIH07XHJcbiAgICBcclxuICAgIHAudXBkYXRlX3Jlc3BvbnNlID0gZnVuY3Rpb24ocFJlc3BvbnNlKVxyXG4gICAge1xyXG5cdC8vIEltcGxlbWVudHMgdGhlIHVwZGF0ZV9yZXNwb25zZSBwaGFzZSBvZiBhbiBpdGVtLlxyXG4gICAgfTtcdFxyXG5cclxuICAgIHAuY29tcGxldGUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIEltcGxlbWVudHMgdGhlIGNvbXBsZXRlIHBoYXNlIG9mIHRoZSBpdGVtLlxyXG5cdGlmICh0aGlzLl9wYXJlbnQgIT09IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gdGhlIHByb2Nlc3MgY29udHJvbCB0byB0aGUgcGFyZW50IG9mIHRoZSBlbGVtZW50LlxyXG4gICAgICAgICAgICBvc3dlYi5ldmVudHMuX2N1cnJlbnRfaXRlbSA9IHRoaXMuX3BhcmVudDtcclxuICAgICAgICAgICAgb3N3ZWIuZXZlbnRzLl9jdXJyZW50X2l0ZW0ucnVuKCk7ICBcclxuXHR9XHJcbiAgICB9O1xyXG4gIFxyXG4gICAgLy8gQmluZCB0aGUgaXRlbSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuaXRlbSA9IGl0ZW07XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBnZW5lcmljX3Jlc3BvbnNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBnZW5lcmljX3Jlc3BvbnNlKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cdFxyXG5cdC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuX2FsbG93ZWRfcmVzcG9uc2VzID0gbnVsbDtcclxuXHR0aGlzLl9kdXJhdGlvbiAgICAgICAgICA9IDA7XHJcblx0dGhpcy5fZHVyYXRpb25fZnVuYyBcdD0gbnVsbDtcclxuXHR0aGlzLl9rZXlib2FyZFx0XHQ9IG51bGw7XHJcblx0dGhpcy5fbW91c2UgICAgICAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuX3Jlc3BvbnNldHlwZVx0PSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfTk9ORTtcclxuXHR0aGlzLl90aW1lb3V0ICAgICAgICAgICA9IC0xO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGdlbmVyaWNfcmVzcG9uc2UsIG9zd2ViLml0ZW0pO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuXHJcbiAgICBwLmF1dG9fcmVzcG9uc2UgICAgPSBcImFcIjtcclxuICAgIHAucHJvY2Vzc19mZWVkYmFjayA9IGZhbHNlO1xyXG4gICAgcC5zeW5vbnltcyAgICAgICAgID0gbnVsbDtcclxuICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5hdXRvX3Jlc3BvbnNlciA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIH07XHJcblxyXG4gICAgcC5hdXRvX3Jlc3BvbnNlcl9tb3VzZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIH07XHJcblxyXG4gICAgcC5wcmVwYXJlX2FsbG93ZWRfcmVzcG9uc2VzID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIFByZXBhcmUgdGhlIGFsbG93ZWQgcmVzcG9uc2VzLi5cclxuICAgICAgICBpZiAodGhpcy52YXJzLmdldCgnYWxsb3dlZF9yZXNwb25zZXMnKSA9PSBudWxsKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5fYWxsb3dlZF9yZXNwb25zZXMgPSBudWxsO1xyXG5cdH1cclxuXHRlbHNlXHJcblx0e1x0XHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxpc3Qgb2YgYWxsb3dlZCByZXNwb25zZXMgdGhhdCBhcmUgc2VwYXJhdGVkIGJ5IHNlbWljb2xvbnMuIEFsc28gdHJpbSBhbnkgd2hpdGVzcGFjZS5cclxuICAgICAgICAgICAgdmFyIGFsbG93ZWRfcmVzcG9uc2VzID0gU3RyaW5nKHRoaXMudmFycy5hbGxvd2VkX3Jlc3BvbnNlcykuc3BsaXQoJzsnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnZhcnMuZHVyYXRpb24gPT0gJ2tleXByZXNzJylcclxuICAgICAgICAgICAge1x0XHJcblx0XHQvL3RoaXMuX2FsbG93ZWRfcmVzcG9uc2VzID0gYWxsb3dlZF9yZXNwb25zZXM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hbGxvd2VkX3Jlc3BvbnNlcyA9IHRoaXMuX2tleWJvYXJkLl9nZXRfZGVmYXVsdF9mcm9tX3N5bm9uaWVtKGFsbG93ZWRfcmVzcG9uc2VzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnZhcnMuZHVyYXRpb24gPT0gJ21vdXNlY2xpY2snKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBGb3IgbW91c2UgcmVzcG9uc2VzLCB3ZSBkb24ndCBjaGVjayBpZiB0aGUgYWxsb3dlZCByZXNwb25zZXMgbWFrZSBzZW5zZS5cclxuICAgICAgICAgICAgXHR0aGlzLl9hbGxvd2VkX3Jlc3BvbnNlcyA9IHRoaXMuX21vdXNlLl9nZXRfZGVmYXVsdF9mcm9tX3N5bm9uaWVtKGFsbG93ZWRfcmVzcG9uc2VzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gSWYgYWxsb3dlZCByZXNwb25zZXMgYXJlIHByb3ZpZGVkLCB0aGUgbGlzdCBzaG91bGQgbm90IGJlIGVtcHR5LlxyXG4gICAgICAgICAgICBpZiAodGhpcy5fYWxsb3dlZF9yZXNwb25zZXMubGVuZ3RoID09IDApXHJcbiAgICAgICAgICAgIHtcclxuXHRcdG9zd2ViLmRlYnVnLmFkZEVycm9yKHRoaXMudmFycy5nZXQoJ2FsbG93ZWRfcmVzcG9uc2VzJykgKyAnIGFyZSBub3QgdmFsaWQgYWxsb3dlZCByZXNwb25zZXMgaW4ga2V5Ym9hcmRfcmVzcG9uc2UgJysgdGhpcy5uYW1lKTtcdFxyXG4gICAgICAgICAgICB9IFxyXG5cdH1cclxuICAgIH07XHJcblx0XHRcclxuICAgIHAucHJlcGFyZV9kdXJhdGlvbiA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBQcmVwYXJlIHRoZSBkdXJhdGlvbi5cclxuICAgICAgICBpZiAodGhpcy52YXJzLmdldCgnZHVyYXRpb24nKSAhPSBudWxsKVxyXG5cdHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnZhcnMuZHVyYXRpb24gPT0gJ251bWJlcicpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICBcdC8vIFByZXBhcmUgYSBkdXJhdGlvbiBpbiBtaWxsaXNlY29uZHNcclxuXHRcdHRoaXMuX2R1cmF0aW9uID0gdGhpcy52YXJzLmR1cmF0aW9uO1xyXG5cdFx0aWYgKHRoaXMuX2R1cmF0aW9uID09IDApXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzcG9uc2V0eXBlID0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX05PTkU7XHJcblx0XHR9XHJcblx0XHRlbHNlXHJcblx0XHR7XHRcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZXR5cGUgPSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfRFVSQVRJT047XHJcblx0XHR9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcblx0XHR0aGlzLl9kdXJhdGlvbiA9IC0xO1xyXG5cdFx0aWYgKHRoaXMudmFycy5kdXJhdGlvbiA9PSAna2V5cHJlc3MnKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJlcGFyZV9kdXJhdGlvbl9rZXlwcmVzcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3BvbnNldHlwZSA9IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRDtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHRoaXMudmFycy5kdXJhdGlvbiA9PSAnbW91c2VjbGljaycpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmVwYXJlX2R1cmF0aW9uX21vdXNlY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZXR5cGUgPSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfTU9VU0U7XHJcblx0XHR9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnZhcnMuZHVyYXRpb24gPT0gJ3NvdW5kJylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZXR5cGUgPSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfU09VTkQ7XHJcbiAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy52YXJzLmR1cmF0aW9uID09ICd2aWRlbycpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzcG9uc2V0eXBlID0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX1ZJREVPO1xyXG4gICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgfVx0XHRcclxuXHR9XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5wcmVwYXJlX2R1cmF0aW9uX2tleXByZXNzID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIFByZXBhcmUgYSBrZXlib2FyZCBkdXJhdGlvbi5cclxuXHR0aGlzLl9rZXlib2FyZCA9IG5ldyBvc3dlYi5rZXlib2FyZCh0aGlzLmV4cGVyaW1lbnQpO1xyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQuYXV0b19yZXNwb25zZSA9PSB0cnVlKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5fZHVyYXRpb25fZnVuYyA9IHRoaXMuYXV0b19yZXNwb25kZXI7XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciBmaW5hbF9kdXJhdGlvbiA9ICh0aGlzLl90aW1lb3V0ICE9IC0xKSA/IHRoaXMuX3RpbWVvdXQgOiB0aGlzLl9kdXJhdGlvbjtcclxuICAgICAgICAgICAgdGhpcy5fa2V5Ym9hcmQuc2V0X2NvbmZpZyhmaW5hbF9kdXJhdGlvbiwgdGhpcy5fYWxsb3dlZF9yZXNwb25zZXMpO1xyXG5cdH1cclxuICAgIH07XHJcblx0XHJcbiAgICBwLnByZXBhcmVfZHVyYXRpb25fbW91c2VjbGljayA9IGZ1bmN0aW9uKHNlbGYpXHJcbiAgICB7XHJcblx0Ly8gUHJlcGFyZSBhIG1vdXNlY2xpY2sgZHVyYXRpb24uXHJcblx0dGhpcy5fbW91c2UgPSBuZXcgb3N3ZWIubW91c2UodGhpcy5leHBlcmltZW50KTtcclxuXHRpZiAodGhpcy5leHBlcmltZW50LmF1dG9fcmVzcG9uc2UgPT0gdHJ1ZSlcclxuXHR7XHJcbiAgICAgICAgICAgIHRoaXMuX2R1cmF0aW9uX2Z1bmMgPSB0aGlzLmF1dG9fcmVzcG9uZGVyX21vdXNlO1xyXG5cdH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgZmluYWxfZHVyYXRpb24gPSAodGhpcy5fdGltZW91dCAhPSAtMSkgPyB0aGlzLl90aW1lb3V0IDogdGhpcy5fZHVyYXRpb247XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlLnNldF9jb25maWcoZmluYWxfZHVyYXRpb24sIHRoaXMuX2FsbG93ZWRfcmVzcG9uc2VzLCBmYWxzZSk7XHJcblx0fVxyXG4gICAgfTtcdFxyXG5cclxuICAgIHAucHJlcGFyZV90aW1lb3V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFByZXBhcmUgdGhlIHRpbWVvdXQuXHJcblx0aWYgKHRoaXMudmFycy5nZXQoJ3RpbWVvdXQnKSAhPSBudWxsKSBcclxuXHR7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy52YXJzLnRpbWVvdXQgPT0gJ251bWJlcicpXHJcbiAgICAgICAgICAgIHtcclxuXHRcdC8vIFByZXBhcmUgYSBkdXJhdGlvbiBpbiBtaWxsaXNlY29uZHNcclxuICAgICAgICAgICAgXHR0aGlzLl90aW1lb3V0ID0gdGhpcy52YXJzLnRpbWVvdXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcblx0XHR0aGlzLl90aW1lb3V0ID0gLTE7XHJcbiAgICAgICAgICAgIH1cdFx0XHJcblx0fVxyXG4gICAgfTtcdFxyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS4gXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByb2Nlc3NfcmVzcG9uc2Vfa2V5cHJlc3MgPSBmdW5jdGlvbihwUmV0dmFsKVxyXG4gICAge1xyXG5cdHRoaXMuZXhwZXJpbWVudC5fc3RhcnRfcmVzcG9uc2VfaW50ZXJ2YWwgPSB0aGlzLnNyaTtcclxuXHR0aGlzLmV4cGVyaW1lbnQuX2VuZF9yZXNwb25zZV9pbnRlcnZhbCAgID0gcFJldHZhbC5ydFRpbWU7XHJcblx0dGhpcy5leHBlcmltZW50LnZhcnMucmVzcG9uc2UgICAgICAgICAgICA9IHRoaXMuc3ludGF4LnNhbml0aXplKHBSZXR2YWwucmVzcCk7XHJcblx0dGhpcy5zeW5vbnltcyAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHRoaXMuX2tleWJvYXJkLnN5bm9ueW1zKHRoaXMuZXhwZXJpbWVudC52YXJzLnJlc3BvbnNlKTsgXHJcblx0dGhpcy5yZXNwb25zZV9ib29ra2VlcGluZygpO1xyXG4gICAgfTtcclxuXHRcclxuICAgIHAucHJvY2Vzc19yZXNwb25zZV9tb3VzZWNsaWNrID0gZnVuY3Rpb24ocFJldHZhbClcclxuICAgIHtcclxuIFx0dGhpcy5leHBlcmltZW50Ll9zdGFydF9yZXNwb25zZV9pbnRlcnZhbCA9IHRoaXMuc3JpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC5fZW5kX3Jlc3BvbnNlX2ludGVydmFsICAgPSBwUmV0dmFsLnJ0VGltZTtcclxuXHR0aGlzLmV4cGVyaW1lbnQudmFycy5yZXNwb25zZVx0XHQgPSBwUmV0dmFsLnJlc3A7XHJcblx0dGhpcy5zeW5vbnltcyAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHRoaXMuX21vdXNlLnN5bm9ueW1zKHRoaXMuZXhwZXJpbWVudC52YXJzLnJlc3BvbnNlKTtcclxuXHR0aGlzLmV4cGVyaW1lbnQudmFycy5jdXJzb3JfeCAgICAgICAgICAgID0gcFJldHZhbC5ldmVudC5jbGllbnRYO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLmN1cnNvcl95ICAgICAgICAgICAgPSBwUmV0dmFsLmV2ZW50LmNsaWVudFk7XHJcblx0dGhpcy5yZXNwb25zZV9ib29ra2VlcGluZygpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnJlc3BvbnNlX2Jvb2trZWVwaW5nID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFRoZSByZXNwb25lIGFuZCByZXNwb25zZV90aW1lIHZhcmlhYmxlcyBhcmUgYWx3YXlzIHNldCwgZm9yIGV2ZXJ5IHJlc3BvbnNlIGl0ZW1cclxuXHR0aGlzLmV4cGVyaW1lbnQudmFycy5zZXQoJ3Jlc3BvbnNlX3RpbWUnLCB0aGlzLmV4cGVyaW1lbnQuX2VuZF9yZXNwb25zZV9pbnRlcnZhbCAtIHRoaXMuZXhwZXJpbWVudC5fc3RhcnRfcmVzcG9uc2VfaW50ZXJ2YWwpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLnNldCgncmVzcG9uc2VfJyArIHRoaXMubmFtZSwgdGhpcy5leHBlcmltZW50LnZhcnMuZ2V0KCdyZXNwb25zZScpKTtcclxuXHR0aGlzLmV4cGVyaW1lbnQudmFycy5zZXQoJ3Jlc3BvbnNlX3RpbWVfJyArIHRoaXMubmFtZSwgdGhpcy5leHBlcmltZW50LnZhcnMuZ2V0KCdyZXNwb25zZV90aW1lJykpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC5fc3RhcnRfcmVzcG9uc2VfaW50ZXJ2YWwgPSBudWxsO1xyXG5cclxuXHQvLyBCdXQgY29ycmVjdG5lc3MgaW5mb3JtYXRpb24gaXMgb25seSBzZXQgZm9yIGRlZGljYXRlZCByZXNwb25zZSBpdGVtcywgc3VjaCBhcyBrZXlib2FyZF9yZXNwb25zZSBpdGVtcywgYmVjYXVzZSBvdGhlcndpc2Ugd2UgbWlnaHQgY29uZm91bmQgdGhlIGZlZWRiYWNrXHJcblx0aWYgKHRoaXMucHJvY2Vzc19mZWVkYmFjayA9PSB0cnVlKVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gZGVidWcubXNnKHVcInByb2Nlc3NpbmcgZmVlZGJhY2sgZm9yICclcydcIiAlIHNlbGYubmFtZSlcclxuICAgICAgICAgICAgaWYgKHRoaXMudmFycy5jb3JyZWN0X3Jlc3BvbnNlICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIGEgY29ycmVjdF9yZXNicG9uc2UgaGFzIGJlZW4gZGVmaW5lZCwgd2UgdXNlIGl0IHRvIGRldGVybWluZSBhY2N1cmFjeSBldGMuXHJcblx0XHRpZiAodGhpcy5zeW5vbnltcyAhPSBudWxsKSAgXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3lub255bXMuaW5kZXhPZihTdHJpbmcodGhpcy52YXJzLmdldCgnY29ycmVjdF9yZXNwb25zZScpKSkgIT0gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgeyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMuY29ycmVjdCAgICAgICA9IDE7XHJcblx0XHRcdHRoaXMuZXhwZXJpbWVudC52YXJzLnRvdGFsX2NvcnJlY3QgPSB0aGlzLmV4cGVyaW1lbnQudmFycy50b3RhbF9jb3JyZWN0ICsgMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMuY29ycmVjdCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cdFx0fVx0XHJcblx0XHRlbHNlXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMuY29ycmVjdCA9ICd1bmRlZmluZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIC8qIGlmIHNlbGYuZXhwZXJpbWVudC5yZXNwb25zZSBpbiAoY29ycmVjdF9yZXNwb25zZSwgc2FmZV9kZWNvZGUoY29ycmVjdF9yZXNwb25zZSkpOlxyXG4gICAgICAgICAgICAgICAgICAgIFx0c2VsZi5leHBlcmltZW50LnZhci5jb3JyZWN0ID0gMVxyXG5cdFx0XHRzZWxmLmV4cGVyaW1lbnQudmFyLnRvdGFsX2NvcnJlY3QgKz0gMVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2U6XHJcbiAgICAgICAgICAgICAgICAgICAgXHRzZWxmLmV4cGVyaW1lbnQudmFyLmNvcnJlY3QgPSAwICovXHJcblx0XHR9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBJZiBhIGNvcnJlY3RfcmVzcG9uc2UgaGFzbid0IGJlZW4gZGVmaW5lZCwgd2Ugc2ltcGx5IHNldCBjb3JyZWN0IHRvIHVuZGVmaW5lZC5cclxuXHRcdHRoaXMuZXhwZXJpbWVudC52YXJzLmNvcnJlY3QgPSAndW5kZWZpbmVkJztcclxuICAgICAgICAgICAgfVx0XHJcblxyXG4gICAgICAgICAgICAvLyBEbyBzb21lIHJlc3BvbnNlIGJvb2trZWVwaW5nXHJcbiAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC52YXJzLnRvdGFsX3Jlc3BvbnNlX3RpbWUgICA9IHRoaXMuZXhwZXJpbWVudC52YXJzLnRvdGFsX3Jlc3BvbnNlX3RpbWUgKyB0aGlzLmV4cGVyaW1lbnQudmFycy5yZXNwb25zZV90aW1lO1xyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy50b3RhbF9yZXNwb25zZXMgICAgICAgPSB0aGlzLmV4cGVyaW1lbnQudmFycy50b3RhbF9yZXNwb25zZXMgKyAxO1xyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5hY2N1cmFjeSAgICAgICAgICAgICAgPSBNYXRoLnJvdW5kKDEwMC4wICogdGhpcy5leHBlcmltZW50LnZhcnMudG90YWxfY29ycmVjdCAvIHRoaXMuZXhwZXJpbWVudC52YXJzLnRvdGFsX3Jlc3BvbnNlcyk7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC52YXJzLmFjYyAgICAgICAgXHQgICAgICAgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5hY2N1cmFjeTtcclxuICAgICAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMuYXZlcmFnZV9yZXNwb25zZV90aW1lID0gTWF0aC5yb3VuZCh0aGlzLmV4cGVyaW1lbnQudmFycy50b3RhbF9yZXNwb25zZV90aW1lIC8gdGhpcy5leHBlcmltZW50LnZhcnMudG90YWxfcmVzcG9uc2VzKTtcclxuICAgICAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMuYXZnX3J0ICAgICAgICAgICAgICAgID0gdGhpcy5leHBlcmltZW50LnZhcnMuYXZlcmFnZV9yZXNwb25zZV90aW1lO1xyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5zZXQoJ2NvcnJlY3RfJyArIHRoaXMubmFtZSwgdGhpcy52YXJzLmNvcnJlY3QpOyBcclxuXHR9IFxyXG4gICAgfTtcdFxyXG5cdFxyXG4gICAgcC5wcm9jZXNzX3Jlc3BvbnNlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIFN0YXJ0IHN0aW11bHVzIHJlc3BvbnNlIGN5Y2xlLlxyXG4gICBcdHN3aXRjaCAodGhpcy5fcmVzcG9uc2V0eXBlKVxyXG4gICBcdHtcclxuICAgICAgICAgICAgY2FzZSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfTk9ORTpcclxuIFx0XHQvLyBEdXJhdGlvbiBpcyAwLCBzbyBjb21wbGV0ZSB0aGUgc3RpbXVsdXMvcmVzcG9uc2UgY3ljbGUuXHJcbiBcdFx0dGhpcy5fc3RhdHVzID0gb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2Ugb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX0RVUkFUSU9OOlxyXG5cdFx0dGhpcy5zbGVlcF9mb3JfZHVyYXRpb24oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRDpcclxuICAgICAgICAgICAgICAgIHRoaXMuX2tleWJvYXJkLmdldF9rZXkoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9NT1VTRTpcclxuICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlLmdldF9jbGljaygpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2Ugb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX1NPVU5EOlxyXG4gICAgICAgICAgICAgICB0aGlzLl9zYW1wbGVyLndhaXQoKTtcclxuXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9WSURFTzpcclxuICAgICAgICAgICAgICAgdGhpcy5fdmlkZW8ud2FpdCgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgIFx0fVx0XHRcclxuICAgIH07XHJcblxyXG4gICAgcC5zZXRfc3JpID0gZnVuY3Rpb24ocFJlc2V0KVxyXG4gICAge1xyXG5cdC8vIFNldHMgdGhlIHN0YXJ0IG9mIHRoZSByZXNwb25zZSBpbnRlcnZhbC5cclxuXHRpZiAocFJlc2V0ID09IHRydWUpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLnNyaSA9IHNlbGYudmFycy5nZXQoJ3RpbWVfJyArIHRoaXMubmFtZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC5fc3RhcnRfcmVzcG9uc2VfaW50ZXJ2YWwgPSB0aGlzLnZhcnMuZ2V0KCd0aW1lXycgKyB0aGlzLm5hbWUpO1xyXG5cdH1cclxuXHRcclxuXHRpZiAodGhpcy5leHBlcmltZW50Ll9zdGFydF9yZXNwb25zZV9pbnRlcnZhbCA9PSBudWxsKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5zcmkgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5nZXQoJ3RpbWVfJyArIHRoaXMubmFtZSk7XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIHRoaXMuc3JpID0gdGhpcy5leHBlcmltZW50Ll9zdGFydF9yZXNwb25zZV9pbnRlcnZhbDtcclxuXHR9XHJcbiAgICB9O1x0XHRcclxuXHJcbiAgICBwLnNsZWVwX2Zvcl9kdXJhdGlvbiA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBTbGVlcCBmb3IgYSBzcGVjaWZpZWQgdGltZS5cclxuXHR0aGlzLnNsZWVwKHRoaXMuX2R1cmF0aW9uKTtcdFx0XHJcbiAgICB9O1xyXG4gICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBpdGVtLiBcclxuICAgICAqL1xyXG4gICAgXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW1wbGVtZW50cyB0aGUgcHJlcGFyZSBwaGFzZSBvZiB0aGUgaXRlbS5cclxuXHR0aGlzLnByZXBhcmVfdGltZW91dCgpO1xyXG5cdHRoaXMucHJlcGFyZV9hbGxvd2VkX3Jlc3BvbnNlcygpO1xyXG5cdHRoaXMucHJlcGFyZV9kdXJhdGlvbigpO1xyXG4gICAgXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5pdGVtX3ByZXBhcmUoKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHAudXBkYXRlX3Jlc3BvbnNlID0gZnVuY3Rpb24ocFJlc3BvbnNlKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEltcGxlbWVudHMgdGhlIHVwZGF0ZSByZXNwb25zZSBwaGFzZSBvZiB0aGUgaXRlbS5cclxuXHRpZiAoKHRoaXMuX3Jlc3BvbnNldHlwZSA9PSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfS0VZQk9BUkQpICYmIChwUmVzcG9uc2UudHlwZSA9PSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfS0VZQk9BUkQpKSBcclxuXHR7XHJcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc19yZXNwb25zZV9rZXlwcmVzcyhwUmVzcG9uc2UpO1xyXG5cdH1cclxuXHRlbHNlIGlmICgodGhpcy5fcmVzcG9uc2V0eXBlID09IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9NT1VTRSkgJiYgKHBSZXNwb25zZS50eXBlID09IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9NT1VTRSkpIFxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzX3Jlc3BvbnNlX21vdXNlY2xpY2socFJlc3BvbnNlKTsgICAgIFxyXG5cdH1cclxuICAgIH07IFxyXG5cclxuICAgIC8vIEJpbmQgdGhlIGdlbmVyaWNfcmVzcG9uc2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmdlbmVyaWNfcmVzcG9uc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZ2VuZXJpY19yZXNwb25zZSwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgZXhwZXJpbWVudC5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZXhwZXJpbWVudChwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQsIHBQb29sX2ZvbGRlciwgcEV4cGVyaW1lbnRfcGF0aCwgcEZ1bGxzY3JlZW4sIHBBdXRvX3Jlc3BvbnNlLCBwTG9nZmlsZSwgcFN1YmplY3RfbnIsIHBXb3Jrc3BhY2UsIHBSZXNvdXJjZXMsIHBIZWFydGJlYXRfaW50ZXJ2YWwpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBpdGVtcyBwcm9wZXJ0eSBmb3IgdGhpcyBleHBlcmltZW50LlxyXG5cdG9zd2ViLml0ZW1fc3RvcmUuX2V4cGVyaW1lbnQgPSB0aGlzO1xyXG5cclxuXHQvLyBTZXQgdGhlIG9wdGlvbmFsIGFyZ3VtZW50c1xyXG5cdHBMb2dmaWxlID0gKHR5cGVvZiBwTG9nZmlsZSA9PT0gJ3VuZGVmaW5lZCcpID8gbnVsbCA6IHBMb2dmaWxlO1xyXG5cclxuXHQvLyBTZXQgdGhlIHByaXZhdGUgcHJvcGVydGllcy4gXHJcblx0dGhpcy5fZW5kX3Jlc3BvbnNlX2ludGVydmFsICAgPSBudWxsO1xyXG5cdHRoaXMuX3N0YXJ0X3Jlc3BvbnNlX2ludGVydmFsID0gbnVsbDtcclxuXHR0aGlzLl9zeW50YXggICAgICAgICAgICAgICAgICA9IG9zd2ViLnN5bnRheDtcclxuXHR0aGlzLl9weXRob25fd29ya3NwYWNlICAgICAgICA9IChwV29ya3NwYWNlKSA/IHBXb3Jrc3BhY2UgOiBvc3dlYi5weXRob25fd29ya3NwYWNlO1xyXG5cclxuXHQvLyBTZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLmF1dG9fcmVzcG9uc2UgICAgICA9IChwQXV0b19yZXNwb25zZSkgPyBwQXV0b19yZXNwb25zZSA6IGZhbHNlO1xyXG5cdHRoaXMuY2xlYW51cF9mdW5jdGlvbnMgID0gW107XHJcblx0dGhpcy5oZWFydGJlYXRfaW50ZXJ2YWwgPSAocEhlYXJ0YmVhdF9pbnRlcnZhbCkgPyBwSGVhcnRiZWF0X2ludGVydmFsIDogMTtcclxuXHR0aGlzLml0ZW1zICAgICAgICAgICAgICA9IG9zd2ViLml0ZW1fc3RvcmU7XHJcblx0dGhpcy5vdXRwdXRfY2hhbm5lbCBcdD0gbnVsbDtcclxuXHR0aGlzLnBhdXNlZCBcdFx0PSBmYWxzZTtcclxuXHR0aGlzLnBsdWdpbl9mb2xkZXIgXHQ9ICdwbHVnaW5zJztcclxuXHR0aGlzLnBvb2wgICAgICAgICAgICAgICA9IG9zd2ViLmZpbGVfcG9vbF9zdG9yZTtcclxuXHR0aGlzLnJlc291cmNlcyBcdFx0PSAocFJlc291cmNlcykgPyBwUmVzb3VyY2VzIDoge307XHJcblx0dGhpcy5yZXN0YXJ0IFx0XHQ9IGZhbHNlO1xyXG5cdHRoaXMucnVubmluZ1x0XHQ9IGZhbHNlO1xyXG5cdHRoaXMudmFycyAgICAgICAgICAgICAgID0gbmV3IG9zd2ViLnZhcl9zdG9yZSh0aGlzLCBudWxsKTtcclxuXHRcdFxyXG5cdC8vIFNldCBkZWZhdWx0IHZhcmlhYmxlc1xyXG5cdHRoaXMudmFycy5zdGFydCAgICAgICAgICAgICAgID0gJ2V4cGVyaW1lbnQnO1xyXG5cdHRoaXMudmFycy50aXRsZSAgICAgICAgICAgICAgID0gJ015IEV4cGVyaW1lbnQnO1xyXG5cdHRoaXMudmFycy5iaWRpICAgICAgICAgICAgICAgID0gJ25vJztcclxuXHR0aGlzLnZhcnMucm91bmRfZGVjaW1hbHMgICAgICA9IDI7XHJcblx0dGhpcy52YXJzLmZvcm1fY2xpY2tzICAgICAgICAgPSAnbm8nO1xyXG5cdHRoaXMudmFycy51bmlmb3JtX2Nvb3JkaW5hdGVzID0gJ25vJztcclxuXHJcbiAgICAgICAgLy8gU291bmQgcGFyYW1ldGVycy5cclxuXHR0aGlzLnZhcnMuc291bmRfZnJlcSAgICAgICAgICA9IDQ4MDAwO1xyXG5cdHRoaXMudmFycy5zb3VuZF9zYW1wbGVfc2l6ZSAgID0gLTE2OyBcclxuXHR0aGlzLnZhcnMuc291bmRfY2hhbm5lbHMgICAgICA9IDI7XHJcblx0dGhpcy52YXJzLnNvdW5kX2J1Zl9zaXplICAgICAgPSAxMDI0O1xyXG5cclxuXHQvLyBEZWZhdWx0IGJhY2tlbmRcclxuXHR0aGlzLnZhcnMuY2FudmFzX2JhY2tlbmQgICAgICA9ICd4cHlyaW1lbnQnO1xyXG5cclxuXHQvLyBEaXNwbGF5IHBhcmFtZXRlcnMuXHJcblx0dGhpcy52YXJzLndpZHRoICAgICAgICAgICAgICAgPSAxMDI0O1xyXG5cdHRoaXMudmFycy5oZWlnaHQgICAgICAgICAgICAgID0gNzY4O1xyXG5cdHRoaXMudmFycy5iYWNrZ3JvdW5kICAgICAgICAgID0gJ2JsYWNrJztcclxuXHR0aGlzLnZhcnMuZm9yZWdyb3VuZCAgICAgICAgICA9ICd3aGl0ZSc7XHJcblx0dGhpcy52YXJzLmZ1bGxzY3JlZW4gICAgICAgICAgPSAocEZ1bGxzY3JlZW4pID8gJ3llcycgOiAnbm8nO1xyXG5cclxuXHQvLyBGb250IHBhcmFtZXRlcnMuXHJcblx0dGhpcy52YXJzLmZvbnRfc2l6ZSAgICAgICAgICAgPSAxODtcclxuXHR0aGlzLnZhcnMuZm9udF9mYW1pbHkgICAgICAgICA9ICdtb25vJztcclxuXHR0aGlzLnZhcnMuZm9udF9pdGFsaWMgICAgICAgICA9ICdubyc7XHJcblx0dGhpcy52YXJzLmZvbnRfYm9sZCBcdCAgICAgID0gJ25vJztcclxuXHR0aGlzLnZhcnMuZm9udF91bmRlcmxpbmUgICAgICA9ICdubyc7IFxyXG5cclxuXHQvLyBMb2dmaWxlIHBhcmFtZXRlcnNcclxuXHR0aGlzLmxvZ2ZpbGUgPSBwTG9nZmlsZTtcclxuXHR0aGlzLmRlYnVnICAgPSBvc3dlYi5kZWJ1Zy5lbmFibGVkO1xyXG5cclxuXHQvLyBDcmVhdGUgdGhlIGJhY2tlbmQgb2JqZWN0cy5cclxuXHR0aGlzLl9jYW52YXMgPSBuZXcgb3N3ZWIuY2FudmFzKHRoaXMpO1xyXG5cdHRoaXMuX2Nsb2NrICA9IG5ldyBvc3dlYi5jbG9jayh0aGlzKTtcclxuXHR0aGlzLl9sb2cgICAgPSBuZXcgb3N3ZWIubG9nKHRoaXMsIHRoaXMubG9nZmlsZSk7XHJcblx0XHJcbiAgICAgICAgLy8gU2V0IHRoZSBnbG9iYWwgYW5jaG9ycy5cclxuICAgICAgICB3aW5kb3dbJ2Nsb2NrJ10gPSB0aGlzLl9jbG9jaztcclxuICAgICAgICB3aW5kb3dbJ2xvZyddICAgPSB0aGlzLl9sb2c7ICAgIFxyXG4gICAgICAgIFxyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLml0ZW1fY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH0gXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGV4cGVyaW1lbnQsIG9zd2ViLml0ZW0pO1xyXG4gIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmF1dG9fcmVzcG9uc2UgICAgICA9IGZhbHNlO1xyXG4gICAgcC5jbGVhbnVwX2Z1bmN0aW9ucyAgPSBbXTtcclxuICAgIHAuaGVhcnRiZWF0X2ludGVydmFsID0gMTtcclxuICAgIHAuaXRlbXMgICAgICAgICAgICAgID0gbnVsbDtcclxuICAgIHAub3V0cHV0X2NoYW5uZWwgICAgID0gbnVsbDtcclxuICAgIHAucGF1c2VkICAgICAgICAgICAgID0gZmFsc2U7XHJcbiAgICBwLnBsdWdpbl9mb2xkZXIgICAgICA9ICcnO1xyXG4gICAgcC5wb29sICAgICAgICAgICAgICAgPSBudWxsO1xyXG4gICAgcC5yZXNvdXJjZXMgICAgICAgICAgPSBudWxsO1xyXG4gICAgcC5yZXN0YXJ0ICAgICAgICAgICAgPSBmYWxzZTtcclxuICAgIHAucnVubmluZyAgICAgICAgICAgID0gZmFsc2U7XHJcbiAgXHRcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gZ2VuZXJhbCBmdW5jdGlvbi5cclxuICAgICAqL1xyXG5cclxuICAgIHAuaXRlbV9wcmVmaXggPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gQSBwcmVmaXggZm9yIHRoZSBwbHVnLWluIGNsYXNzZXMsIHNvIHRoYXQgW3ByZWZpeF1bcGx1Z2luXSBjbGFzcyBpcyB1c2VkIGluc3RlYWQgb2YgdGhlIFtwbHVnaW5dIGNsYXNzLlxyXG5cdHJldHVybiAnJztcdFx0XHJcbiAgICB9O1xyXG5cclxuICAgIHAucmVzZXRfZmVlZGJhY2sgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gUmVzZXRzIHRoZSBmZWVkYmFjayB2YXJpYWJsZXMgKGFjYywgYXZnX3J0LCBldGMuKS5cIlwiXCJcclxuXHR0aGlzLnZhcnMudG90YWxfcmVzcG9uc2VzICAgICAgID0gMDtcclxuXHR0aGlzLnZhcnMudG90YWxfY29ycmVjdCAgICAgICAgID0gMDtcclxuXHR0aGlzLnZhcnMudG90YWxfcmVzcG9uc2VfdGltZSAgID0gMDtcclxuXHR0aGlzLnZhcnMuYXZnX3J0ICAgICAgICAgICAgICAgID0gJ3VuZGVmaW5lZCc7XHJcblx0dGhpcy52YXJzLmF2ZXJhZ2VfcmVzcG9uc2VfdGltZSA9ICd1bmRlZmluZWQnO1xyXG5cdHRoaXMudmFycy5hY2N1cmFjeSAgICAgICAgICAgICAgPSAndW5kZWZpbmVkJztcclxuXHR0aGlzLnZhcnMuYWNjICAgICAgICAgICAgICAgICAgID0gJ3VuZGVmaW5lZCc7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuc2V0X3N1YmplY3QgPSBmdW5jdGlvbihwTnIpXHJcbiAgICB7XHJcblx0Ly8gU2V0cyB0aGUgc3ViamVjdCBudW1iZXIgYW5kIHBhcml0eSAoZXZlbi8gb2RkKS4gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYXV0b21hdGljYWxseSB3aGVuIGFuIGV4cGVyaW1lbnQgaXMgc3RhcnRlZCwgc28geW91IGRvIG5vdCBnZW5lcmFsbHkgbmVlZCB0byBjYWxsIGl0IHlvdXJzZWxmLlxyXG5cdHRoaXMudmFycy5zdWJqZWN0X25yID0gcE5yO1xyXG5cdGlmICgocE5yICUgMikgPT0gMClcclxuXHR7XHJcbiAgICAgICAgICAgIHRoaXMudmFycy5zdWJqZWN0X3Bhcml0eSA9ICdldmVuJztcclxuXHR9XHJcblx0ZWxzZVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy52YXJzLnN1YmplY3RfcGFyaXR5ID0gJ29kZCc7XHJcblx0fVxyXG4gICAgfTtcclxuICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGRpbmcgaXRlbS4gICAgICAgICBcclxuICAgICAqL1xyXG5cclxuICAgIHAucmVhZF9kZWZpbml0aW9uID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuICAgIFx0Ly8gRXh0cmFjdHMgYSB0aGUgZGVmaW5pdGlvbiBvZiBhIHNpbmdsZSBpdGVtIGZyb20gdGhlIHN0cmluZy5cclxuXHR2YXIgbGluZSA9IHBTdHJpbmcuc2hpZnQoKTtcclxuXHR2YXIgZGVmX3N0ciA9ICcnO1xyXG4gICAgXHR3aGlsZSAoKGxpbmUgIT0gbnVsbCkgJiYgKGxpbmUubGVuZ3RoID4gMCkgJiYgKGxpbmUuY2hhckF0KDApID09ICdcXHQnKSlcclxuXHR7XHJcbiAgICAgICAgICAgIGRlZl9zdHIgPSBkZWZfc3RyICsgbGluZSArICdcXG4nO1xyXG4gICAgICAgICAgICBsaW5lID0gcFN0cmluZy5zaGlmdCgpO1xyXG5cdH1cdFxyXG5cdHJldHVybiBkZWZfc3RyO1xyXG4gICAgfTtcdFxyXG5cclxuICAgIHAuZnJvbV9zdHJpbmcgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG4gICAgXHQvLyBTZXQgZGVidWcgbWVzc2FnZS5cclxuXHRvc3dlYi5kZWJ1Zy5hZGRNZXNzYWdlKCdidWlsZGluZyBleHBlcmltZW50Jyk7XHJcblx0XHRcclxuXHQvLyBTcGxpdCB0aGUgc3RyaW5nIGludG8gYW4gYXJyYXkgb2YgbGluZXMuICBcclxuXHRpZiAocFN0cmluZyAhPSBudWxsKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5fc291cmNlID0gcFN0cmluZy5zcGxpdCgnXFxuJyk7XHJcbiAgICAgICAgICAgIHZhciBsID0gdGhpcy5fc291cmNlLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgIHdoaWxlIChsICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuXHRcdC8vIFNldCB0aGUgcHJvY2Vzc2luZyBvZiB0aGUgbmV4dCBsaW5lLlxyXG5cdFx0dmFyIGdldF9uZXh0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB0cnlcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBTcGxpdCB0aGUgc2luZ2xlIGxpbmUgaW50byBhIHNldCBvZiB0b2tlbnMuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBvc3dlYi5zeW50YXguc3BsaXQobCk7XHRcdFx0XHRcdFxyXG5cdFx0fVxyXG5cdFx0Y2F0Y2goZSlcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB1XCJGYWlsZWQgdG8gcGFyc2Ugc2NyaXB0LiBNYXliZSBpdCBjb250YWlucyBpbGxlZ2FsIGNoYXJhY3RlcnMgb3IgdW5jbG9zZWQgcXVvdGVzP1wiLCBcXFxyXG5cdFx0fVx0XHJcblxyXG5cdFx0aWYgKCh0ICE9IG51bGwpICYmICh0Lmxlbmd0aCA+IDApKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRyeSB0byBwYXJzZSB0aGUgbGluZSBhcyB2YXJpYWJsZSAob3IgY29tbWVudClcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXJzZV92YXJpYWJsZShsKSA9PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0WzBdID09ICdkZWZpbmUnKSBcclxuXHRcdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQubGVuZ3RoID09IDMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcblx0XHRcdFx0Ly8gR2V0IHRoZSB0eXBlLCBuYW1lIGFuZCBkZWZpbml0aW9uIHN0cmluZyBvZiBhbiBpdGVtLlxyXG5cdFx0XHRcdHZhciBpdGVtX3R5cGUgPSB0WzFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtX25hbWUgPSBvc3dlYi5zeW50YXguc2FuaXRpemUodFsyXSk7XHJcblx0XHRcdFx0dmFyIGRlZl9zdHIgPSB0aGlzLnJlYWRfZGVmaW5pdGlvbih0aGlzLl9zb3VyY2UpO1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0b3N3ZWIuaXRlbV9zdG9yZS5uZXcoaXRlbV90eXBlLCBpdGVtX25hbWUsIGRlZl9zdHIpOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByYWlzZSBvc2V4Y2VwdGlvbih1J0ZhaWxlZCB0byBwYXJzZSBkZWZpbml0aW9uJyxsaW5lPWxpbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cdFx0XHR9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEdldCB0aGUgbmV4dCBsaW5lLlxyXG5cdFx0aWYgKGdldF9uZXh0ID09IHRydWUpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgbCA9IHRoaXMuX3NvdXJjZS5zaGlmdCgpO1xyXG5cdFx0fVxyXG4gICAgICAgICAgICB9XHJcblx0fTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYmFja2VuZHMuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLmluaXRfY2xvY2sgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5pdGlhbGl6ZXMgdGhlIGNsb2NrIGJhY2tlbmQuXHJcblx0dGhpcy5fY2xvY2suaW5pdGlhbGl6ZTtcclxuICAgIH07XHRcclxuXHJcbiAgICBwLmluaXRfZGlzcGxheSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbml0aWFsaXplcyB0aGUgY2FudmFzIGJhY2tlbmQuXHJcblx0dGhpcy5fY2FudmFzLmluaXRfZGlzcGxheSh0aGlzKTtcclxuXHJcbiAgICAgICAgdGhpcy5fcHl0aG9uX3dvcmtzcGFjZVsnd2luJ10gPSB3aW5kb3c7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuaW5pdF9oZWFydGJlYXQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5pdGlhbGl6ZXMgaGVhcnRiZWF0LlxyXG5cdGlmICgodGhpcy5oZWFydGJlYXRfaW50ZXJ2YWwgPD0gMCkgfHwgKHRoaXMudmFycy5mdWxsc2NyZWVuID09ICd5ZXMnKSB8fCAodGhpcy5vdXRwdXRfY2hhbm5lbCA9PSBudWxsKSlcclxuXHR7XHJcbiAgICAgICAgICAgIHRoaXMuaGVhcnRiZWF0ID0gbnVsbDtcclxuXHR9XHJcblx0ZWxzZVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5oZWFydGJlYXQgPSBuZXcgb3N3ZWIuaGVhcnRiZWF0KHRoaXMsIDEpOyBcdFxyXG4gICAgICAgICAgICB0aGlzLmhlYXJ0YmVhdC5zdGFydCgpO1xyXG5cdH1cclxuICAgIH07XHRcclxuXHJcbiAgICBwLmluaXRfbG9nID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyBPcGVuIGEgY29ubmVjdGlvbiB0byB0aGUgbG9nIGZpbGUuXHJcblx0dGhpcy5fbG9nLm9wZW4odGhpcy5sb2dmaWxlKTsgXHRcclxuICAgIH07XHJcblxyXG4gICAgcC5pbml0X3JhbmRvbSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbml0aWFsaXplcyB0aGUgcmFuZG9tIG51bWJlciBnZW5lcmF0b3JzLiBGb3Igc29tZSByZWFzb25cclxuXHQvKiBpbXBvcnQgcmFuZG9tXHJcblx0cmFuZG9tLnNlZWQoKVxyXG5cdHRyeTpcclxuICAgICAgICAgICAgIyBEb24ndCBhc3N1bWUgdGhhdCBudW1weSBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaW1wb3J0IG51bXB5XHJcbiAgICAgICAgICAgIG51bXB5LnJhbmRvbS5zZWVkKClcclxuICAgICAgICAgICAgZXhjZXB0OlxyXG4gICAgICAgICAgICBwYXNzICovXHJcbiAgICB9O1xyXG5cclxuICAgIHAuaW5pdF9zb3VuZCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbnRpYWxpemVzIHRoZSBzb3VuZCBiYWNrZW5kLlxyXG5cdC8qIGZyb20gb3BlbmV4cCBpbXBvcnQgc2FtcGxlclxyXG5cdHNhbXBsZXIuaW5pdF9zb3VuZChzZWxmKSAqL1xyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1bm5pbmcgaXRlbS4gICAgICAgICBcclxuICAgICAqL1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9ydW4oKTtcclxuXHRcclxuXHQvLyBSdW5zIHRoZSBleHBlcmltZW50LlxyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fc3RhdHVzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgY2FzZSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0lOSVRJQUxJWkU6XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzdGF0dXMgdG8gZmluYWxpemUuXHJcblx0XHR0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG5cclxuXHRcdC8vIFNhdmUgdGhlIGRhdGUgYW5kIHRpbWUsIGFuZCB0aGUgdmVyc2lvbiBvZiBPcGVuU2VzYW1lXHJcblx0XHR0aGlzLnZhcnMuZGF0ZXRpbWUgICAgICAgICAgICA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcclxuXHRcdHRoaXMudmFycy5vcGVuc2VzYW1lX3ZlcnNpb24gID0gb3N3ZWIuVkVSU0lPTl9OVU1CRVI7IFxyXG5cdFx0dGhpcy52YXJzLm9wZW5zZXNhbWVfY29kZW5hbWUgPSBvc3dlYi5WRVJTSU9OX05BTUU7IFxyXG5cdFx0dGhpcy5ydW5uaW5nID0gdHJ1ZTtcclxuXHRcdHRoaXMuaW5pdF9yYW5kb20oKTtcclxuXHRcdHRoaXMuaW5pdF9kaXNwbGF5KCk7XHJcblx0XHR0aGlzLmluaXRfY2xvY2soKTtcclxuXHRcdHRoaXMuaW5pdF9zb3VuZCgpO1xyXG5cdFx0dGhpcy5pbml0X2xvZygpO1xyXG5cdFx0dGhpcy5weXRob25fd29ya3NwYWNlLmluaXRfZ2xvYmFscygpO1xyXG5cdFx0dGhpcy5yZXNldF9mZWVkYmFjaygpO1xyXG5cdFx0dGhpcy5pbml0X2hlYXJ0YmVhdCgpOyBcclxuXHRcclxuXHRcdC8vIEFkZCBjbG9zaW5nIG1lc3NhZ2UgdG8gZGVidWcgc3lzdGVtLlxyXG5cdFx0b3N3ZWIuZGVidWcuYWRkTWVzc2FnZSgnZXhwZXJpbWVudC5ydW4oKTogZXhwZXJpbWVudCBzdGFydGVkIGF0ICcgKyBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCkpOyBcclxuXHJcblx0XHRpZiAob3N3ZWIuaXRlbV9zdG9yZS5faXRlbXNbdGhpcy52YXJzLnN0YXJ0XSAhPSBudWxsKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIG9zd2ViLml0ZW1fc3RhY2suY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBvc3dlYi5pdGVtX3N0b3JlLnByZXBhcmUodGhpcy52YXJzLnN0YXJ0LCB0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAvL29zd2ViLml0ZW1fc3RvcmUuZXhlY3V0ZSh0aGlzLnZhcnMuc3RhcnQsIHRoaXMpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKCdDb3VsZCBub3QgZmluZCBpdGVtICcgKyBzZWxmLnZhcnMuc3RhcnQgKyAgJyAsIHdoaWNoIGlzIHRoZSBlbnRyeSBwb2ludCBvZiB0aGUgZXhwZXJpbWVudCcpO1xyXG5cdFx0fVxyXG5cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2Ugb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTpcclxuXHJcblx0XHQvLyBBZGQgY2xvc2luZyBtZXNzYWdlIHRvIGRlYnVnIHN5c3RlbS5cclxuICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZE1lc3NhZ2UoJ2V4cGVyaW1lbnQucnVuKCk6IGV4cGVyaW1lbnQgZmluaXNoZWQgYXQgJyArICBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCkpO1xyXG5cclxuXHRcdC8vIENvbXBsZXRlIHRoZSBydW4gcHJvY2Vzcy5cclxuXHRcdHRoaXMuZW5kKCk7XHJcblx0XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH07IFxyXG4gICAgfTtcclxuXHJcbiAgICBwLmVuZCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBEaXNhYmxlIHRoZSBydW4gdG9nZ2xlLlxyXG4gICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xyXG5cdFxyXG4gICAgICAgIC8vIENsb3NlIHRoZSBsb2cgZmlsZS5cclxuICAgICAgICB0aGlzLl9sb2cuY2xvc2UoKTtcclxuXHRcdFxyXG5cdC8vIERpc2FibGUgdGhlIHByb2Nlc3NpbmcgdW5pdC5cclxuXHRvc3dlYi5ldmVudHMuX2N1cnJlbnRfaXRlbSA9IG51bGw7XHJcblx0XHJcblx0Ly8gQ2xlYXIgdGhlIGV4cHJpbWVudGFsIHN0YWdlIGFuZCBlbmFibGVkIHRoZSBtb3VzZS5cclxuXHRvc3dlYi5ydW5uZXIuX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7XHJcbiAgICAgICAgb3N3ZWIucnVubmVyLl9zdGFnZS51cGRhdGUoKTsgXHJcblx0XHRcdFxyXG5cdC8vIEZpbmFsaXplIHRoZSBwYXJlbnQgKHJ1bm5lcikuXHRcclxuICAgIFx0b3N3ZWIucnVubmVyLl9maW5hbGl6ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBleHBlcmltZW50IGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5leHBlcmltZW50ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGV4cGVyaW1lbnQsIFwiaXRlbVwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGlubGluZV9zY3JpcHQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGlubGluZV9zY3JpcHQocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLml0ZW1fY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuXHRcclxuXHQvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuX3ByZXBhcmVfcnVuICA9IGZhbHNlOyAgIFxyXG4gICAgICAgIHRoaXMuX3ByZXBhcmVfdHJlZSA9IG51bGw7XHJcblx0dGhpcy5fcnVuX3RyZWUgICAgID0gbnVsbDtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhpbmxpbmVfc2NyaXB0LCBvc3dlYi5pdGVtKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdFeGVjdXRlcyBQeXRob24gY29kZSc7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzIC0gY29tcGlsaW5nIHNjcmlwdC5cclxuICAgICAqL1xyXG5cclxuICAgIHAuX2NvbXBpbGUgPSBmdW5jdGlvbihwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgICAgIGlmIChwU2NyaXB0ICE9ICcnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGxvY2F0aW9ucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgcGFyc2VGbiAgID0gZmlsYmVydF9sb29zZS5wYXJzZV9kYW1taXQ7XHJcbiAgICAgICAgICAgIHZhciByYW5nZXMgICAgPSBmYWxzZTtcclxuICAgICAgICBcdFx0XHJcbiAgICAgICAgICAgIHRyeSBcclxuXHQgICAge1xyXG4gICAgICAgIFx0dmFyIGNvZGUgID0gcFNjcmlwdDtcclxuICAgICAgICAgXHR2YXIgYXN0ICAgPSBwYXJzZUZuKGNvZGUsIHsgbG9jYXRpb25zOiBsb2NhdGlvbnMsIHJhbmdlczogcmFuZ2VzIH0pO1xyXG4gICAgICAgIFxyXG5cdCAgICAgICBcdHJldHVybiBhc3Q7XHJcbiAgICBcdCAgICB9XHJcbiAgICAgICBcdCAgICBjYXRjaCAoZSkgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICBcdGNvbnNvbGUubG9nKCdlcnJvcicpO1xyXG4gICAgICAgIFx0Y29uc29sZS5sb2coZS50b1N0cmluZygpKTtcclxuICAgIFx0ICAgXHRcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cdCAgIFx0XHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGRpbmcgaXRlbS4gICAgICAgICBcclxuICAgICAqL1xyXG5cdFx0XHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuXHR0aGlzLl92YXJfaW5mbyAgICAgPSBudWxsO1xyXG5cdHRoaXMudmFycy5fcHJlcGFyZSA9ICcnO1xyXG5cdHRoaXMudmFycy5fcnVuICAgICA9ICcnO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmZyb21fc3RyaW5nID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuICAgIFx0Ly8gUGFyc2VzIGEgZGVmaW5pdGlvbiBzdHJpbmcuXHJcblx0dGhpcy5yZXNldCgpO1xyXG5cdFx0XHJcblx0Ly8gU3BsaXQgdGhlIHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIGxpbmVzLiAgXHJcblx0aWYgKHBTdHJpbmcgIT0gbnVsbClcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciByZWFkX3J1bl9saW5lcyAgICAgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIHJlYWRfcHJlcGFyZV9saW5lcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgbGluZXMgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHZhciB0b2tlbnMgPSBvc3dlYi5zeW50YXguc3BsaXQobGluZXNbaV0pO1xyXG5cdFx0XHRcclxuXHRcdGlmICgodG9rZW5zICE9IG51bGwpICYmICh0b2tlbnMubGVuZ3RoID4gMCkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbnNbMF0pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cdFx0XHRjYXNlICdzZXQnOiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VfdmFyaWFibGUobGluZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cdFx0XHRjYXNlICdfX2VuZF9fJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfcnVuX2xpbmVzICAgICA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZF9wcmVwYXJlX2xpbmVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuXHRcdFx0YnJlYWs7XHRcclxuXHRcdFx0Y2FzZSAnX19fcHJlcGFyZV9fJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfcHJlcGFyZV9saW5lcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgJ19fX3J1bl9fJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfcnVuX2xpbmVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG5cdFx0XHRicmVhaztcclxuXHRcdFx0ZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkX3J1bl9saW5lcyA9PSB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG5cdFx0XHRcdHRoaXMudmFycy5fcnVuID0gdGhpcy52YXJzLl9ydW4gKyBsaW5lc1tpXSArICdcXG4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVhZF9wcmVwYXJlX2xpbmVzID09IHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcdHRoaXMudmFycy5fcHJlcGFyZSA9IHRoaXMudmFycy5fcHJlcGFyZSArIGxpbmVzW2ldICsgJ1xcbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSBcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVhZF9ydW5fbGluZXMgPT0gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcblx0XHRcdHRoaXMudmFycy5fcnVuID0gdGhpcy52YXJzLl9ydW4gKyBsaW5lc1tpXSArICdcXG4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZWFkX3ByZXBhcmVfbGluZXMgPT0gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcblx0XHRcdHRoaXMudmFycy5fcHJlcGFyZSA9IHRoaXMudmFycy5fcHJlcGFyZSArIGxpbmVzW2ldICsgJ1xcbic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcdH0gXHJcbiAgICAgICAgICAgIH1cclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBpdGVtLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5wcmVwYXJlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENvbXBpbGUgdGhlIHNjcmlwdCBjb2RlIHRvIGFzdCB0cmVlcy5cclxuICAgICAgICB0aGlzLl9wcmVwYXJlX3RyZWUgPSBvc3dlYi5wYXJzZXIuX3ByZXBhcmUodGhpcy52YXJzLl9wcmVwYXJlKTtcclxuICAgICAgICB0aGlzLl9ydW5fdHJlZSAgICAgPSBvc3dlYi5wYXJzZXIuX3ByZXBhcmUodGhpcy52YXJzLl9ydW4pO1xyXG5cdFxyXG4gICAgICAgIC8vIEV4ZWN1dGUgdGhlIHJ1biBjb2RlLlxyXG4gXHRpZiAodGhpcy5fcHJlcGFyZV90cmVlICE9IG51bGwpXHJcbiAgICBcdHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBjdXJyZW50IGl0ZW0uXHJcbiAgICAgICAgICAgIG9zd2ViLmV2ZW50cy5fY3VycmVudF9pdGVtID0gdGhpcztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgcHJlcGFyZSBydW4gdG9nZ2xlLlxyXG4gICAgICAgICAgICB0aGlzLl9wcmVwYXJlX3J1biA9IHRydWU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTdGFydCB0aGUgcGFyc2VyXHJcbiAgICAgICAgICAgIG9zd2ViLnBhcnNlci5fcnVuKHRoaXMsIHRoaXMuX3ByZXBhcmVfdHJlZSk7ICAgIFx0XHRcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbV9wcmVwYXJlKCk7XHJcbiAgICAgICAgfSAgICBcclxuICAgIH07XHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9ydW4oKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBSZWNvcmQgdGhlIG9uc2V0IG9mIHRoZSBjdXJyZW50IGl0ZW0uXHJcblx0dGhpcy5zZXRfaXRlbV9vbnNldCgpOyBcclxuXHJcbiAgICAgICAgLy8gRXhlY3V0ZSB0aGUgcnVuIGNvZGUuXHJcbiBcdGlmICh0aGlzLl9ydW5fdHJlZSAhPSBudWxsKVxyXG4gICAgXHR7XHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgcHJlcGFyZSBydW4gdG9nZ2xlLlxyXG4gICAgICAgICAgICB0aGlzLl9wcmVwYXJlX3J1biA9IGZhbHNlO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHBhcnNlclxyXG4gICAgICAgICAgICBvc3dlYi5wYXJzZXIuX3J1bih0aGlzLCB0aGlzLl9ydW5fdHJlZSk7ICAgIFx0XHRcclxuICAgIFx0fVxyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBwYXJzZXIgaXMgcmVhZHkuIFxyXG4gICAgICAgIGlmIChvc3dlYi5wYXJzZXIuX3N0YXR1cyA9PSAxKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBhY3RpdmUgbm9kZS5cclxuICAgICAgICAgICAgb3N3ZWIucGFyc2VyLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHsgICAgXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wcmVwYXJlX3J1biA9PT0gdHJ1ZSkgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIEluaGVyaXRlZCBwcmVwYXJlLlx0XHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1fcHJlcGFyZSgpO1xyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHsgXHJcbiAgICAgICAgICAgICAgICAvLyBJbmhlcml0ZWQuICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbV9jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICBcclxuICAgIH07IFxyXG5cdFxyXG4gICAgcC5jb21wbGV0ZV9zY3JpcHQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gQWRkZWQgZm9yIHZpZGVvIHNjcmlwdCBmdW5jdGlvbmFsaXJ5LlxyXG4gICAgICAgIHRoaXMuY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgU2VxdWVuY2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmlubGluZV9zY3JpcHQgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoaW5saW5lX3NjcmlwdCwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3Mga2V5Ym9hcmRfcmVzcG9uc2UuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGtleWJvYXJkX3Jlc3BvbnNlKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuZ2VuZXJpY19yZXNwb25zZV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cclxuICAgICAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgcHJvcGVydGllcy4gXHJcblx0dGhpcy5fZmx1c2ggICAgPSAneWVzJztcclxuXHR0aGlzLl9rZXlib2FyZCA9IG5ldyBvc3dlYi5rZXlib2FyZCh0aGlzLmV4cGVyaW1lbnQpOyBcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhrZXlib2FyZF9yZXNwb25zZSwgb3N3ZWIuZ2VuZXJpY19yZXNwb25zZSk7XHJcblxyXG4gICAgICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdDb2xsZWN0cyBrZXlib2FyZCByZXNwb25zZXMnO1xyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBidWlsZCBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucmVzZXQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG5cdHRoaXMuYXV0b19yZXNwb25zZSAgICAgICAgICA9ICdzcGFjZSc7XHJcblx0dGhpcy5wcm9jZXNzX2ZlZWRiYWNrICAgICAgID0gdHJ1ZTsgXHJcblx0dGhpcy52YXJzLmFsbG93ZWRfcmVzcG9uc2VzID0gbnVsbDtcclxuXHR0aGlzLnZhcnMuY29ycmVjdF9yZXNwb25zZSAgPSBudWxsO1xyXG5cdHRoaXMudmFycy5kdXJhdGlvbiAgICAgICAgICA9ICdrZXlwcmVzcyc7XHJcblx0dGhpcy52YXJzLmZsdXNoICAgICAgICAgICAgID0gJ3llcyc7XHJcblx0dGhpcy52YXJzLnRpbWVvdXQgICAgICAgICAgID0gJ2luZmluaXRlJztcclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW4gY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHRcclxuXHQvLyBTZXQgdGhlIGludGVybmFsIGZsdXNoIHByb3BlcnR5LlxyXG5cdHRoaXMuX2ZsdXNoID0gKHRoaXMudmFycy5mbHVzaCkgPyB0aGlzLnZhcnMuZmx1c2ggOiAneWVzJztcclxuXHJcbiAgICBcdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuZ2VuZXJpY19yZXNwb25zZV9wcmVwYXJlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuZ2VuZXJpY19yZXNwb25zZV9ydW4oKTtcclxuXHJcbiAgICAgICAgLy8gUmVjb3JkIHRoZSBvbnNldCBvZiB0aGUgY3VycmVudCBpdGVtLlxyXG5cdHRoaXMuc2V0X2l0ZW1fb25zZXQoKTsgXHJcblx0XHJcblx0Ly8gRmx1c2ggcmVzcG9uc2VzLCB0byBtYWtlIHN1cmUgdGhhdCBlYXJsaWVyIHJlc3BvbnNlcyBhcmUgbm90IGNhcnJpZWQgb3Zlci5cclxuICAgICAgICBpZiAodGhpcy5fZmx1c2ggPT0gJ3llcycpXHJcblx0e1x0XHJcbiAgICAgICAgICAgIHRoaXMuX2tleWJvYXJkLmZsdXNoKCk7XHJcblx0fVx0XHRcclxuXHRcclxuICAgICAgICB0aGlzLnNldF9zcmkoKTtcclxuXHR0aGlzLnByb2Nlc3NfcmVzcG9uc2UoKTtcclxuICAgIH07XHJcblx0XHJcbiAgICAvLyBCaW5kIHRoZSBrZXlib2FyZF9yZXNwb25zZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIua2V5Ym9hcmRfcmVzcG9uc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3Moa2V5Ym9hcmRfcmVzcG9uc2UsIFwiZ2VuZXJpY19yZXNwb25zZVwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGxvZ2dlci5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gbG9nZ2VyKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cdFxyXG4gICAgICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLl9sb2d2YXJzID0gbnVsbDtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhsb2dnZXIsIG9zd2ViLml0ZW0pO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdMb2dzIGV4cGVyaW1lbnRhbCBkYXRhJztcclxuICAgIHAubG9ndmFyc1x0ICA9IFtdO1xyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMgLSBidWlsZCBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucmVzZXQgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG5cdHRoaXMuX2xvZ3ZhcnMgICAgICA9IG51bGw7XHJcblx0dGhpcy5sb2d2YXJzICAgICAgID0gW107XHJcblx0dGhpcy52YXJzLmF1dG9fbG9nID0gJ3llcyc7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZnJvbV9zdHJpbmcgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG5cdC8vIFBhcnNlcyBhIGRlZmluaXRpb24gc3RyaW5nLlxyXG5cdHRoaXMudmFyaWFibGVzID0ge307XHJcblx0dGhpcy5jb21tZW50cyAgPSBbXTtcclxuXHR0aGlzLnJlc2V0KCk7XHJcblxyXG5cdC8vIFNwbGl0IHRoZSBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBsaW5lcy4gIFxyXG5cdGlmIChwU3RyaW5nICE9IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgbGluZXMgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdGlmICgobGluZXNbaV0gIT0gJycpICYmICh0aGlzLnBhcnNlX3ZhcmlhYmxlKGxpbmVzW2ldKSA9PSBmYWxzZSkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IG9zd2ViLnN5bnRheC5zcGxpdChsaW5lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0b2tlbnNbMF0gPT0gJ2xvZycpICYmICh0b2tlbnMubGVuZ3RoID4gMCkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cdFx0XHR0aGlzLmxvZ3ZhcnMucHVzaCh0b2tlbnNbMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cdFxyXG5cdFx0fVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcdFxyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzIC0gcnVuIGN5Y2xlLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5pdGVtX3J1bigpO1xyXG5cdFx0XHJcblx0Ly8gUnVuIGl0ZW0gb25seSBvbmUgdGltZS4gICBcclxuXHRpZiAodGhpcy5fc3RhdHVzICE9IG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfRklOQUxJWkUpXHJcblx0e1xyXG4gICAgICAgICAgICAvLyBpdGVtIGlzIGZpbmFsaXplZC5cclxuICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2V0X2l0ZW1fb25zZXQoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2xvZ3ZhcnMgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG5cdFx0aWYgKHRoaXMudmFycy5hdXRvX2xvZyA9PSAneWVzJylcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2d2YXJzID0gdGhpcy5leHBlcmltZW50Ll9sb2cuYWxsX3ZhcnMoKTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2d2YXJzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXJpYWJsZSBpbiB0aGlzLmxvZ3ZhcnMpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gXHRcdFx0aWYgKCh2YXJpYWJsZSBpbiB0aGlzLl9sb2d2YXJzKSA9PSBmYWxzZSlcclxuIFx0XHRcdHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvZ3ZhcnMucHVzaCh2YXJpYWJsZSk7XHJcblx0XHRcdH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9ndmFycy5zb3J0KCk7XHRcdFxyXG5cdFx0fVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC5fbG9nLndyaXRlX3ZhcnModGhpcy5fbG9ndmFycyk7IFxyXG5cclxuICAgICAgICAgICAgLy8gQ29tcGxldGUgdGhlIGN5Y2xlLlxyXG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgcC5jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgICAgICB0aGlzLml0ZW1fY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgbG9nZ2VyIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5sb2dnZXIgPSBvc3dlYi5wcm9tb3RlQ2xhc3MobG9nZ2VyLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBsb29wLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBsb29wKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cclxuICAgICAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgcHJvcGVydGllcy4gXHJcbiAgICAgICAgdGhpcy5fYnJlYWtfaWYgPSAnJztcclxuICAgICAgICB0aGlzLl9jeWNsZXMgICA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2luZGV4ICAgID0gLTE7XHJcbiAgICAgICAgdGhpcy5fa2V5Ym9hcmQgPSBudWxsO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGxvb3AsIG9zd2ViLml0ZW0pO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdSZXBlYXRlZGx5IHJ1bnMgYW5vdGhlciBpdGVtJztcclxuICAgIHAubWF0cml4ICAgICAgPSBudWxsO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGRpbmcgY3ljbGUuICAgICAgICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuXHR0aGlzLm1hdHJpeCAgICAgICAgPSB7fTtcclxuXHR0aGlzLnZhcnMuY3ljbGVzICAgPSAxO1xyXG5cdHRoaXMudmFycy5yZXBlYXQgICA9IDE7XHJcblx0dGhpcy52YXJzLnNraXAgICAgID0gMDtcclxuXHR0aGlzLnZhcnMub2Zmc2V0ICAgPSAnbm8nO1xyXG5cdHRoaXMudmFycy5vcmRlciAgICA9ICdyYW5kb20nO1xyXG5cdHRoaXMudmFycy5pdGVtICAgICA9ICcnO1xyXG5cdHRoaXMudmFycy5icmVha19pZiA9ICduZXZlcic7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZnJvbV9zdHJpbmcgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG4gICAgXHQvLyBDcmVhdGVzIGEgbG9vcCBmcm9tIGEgZGVmaW5pdGlvbiBpbiBhIHN0cmluZy5cclxuICAgIFx0dGhpcy5jb21tZW50cyAgPSBbXTtcclxuXHR0aGlzLnZhcmlhYmxlcyA9IHt9O1xyXG5cdHRoaXMucmVzZXQoKTtcclxuXHRcdFxyXG5cdC8vIFNwbGl0IHRoZSBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBsaW5lcy4gIFxyXG5cdGlmIChwU3RyaW5nICE9IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgbGluZXMgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdGlmICgobGluZXNbaV0gIT0gJycpICYmICh0aGlzLnBhcnNlX3ZhcmlhYmxlKGxpbmVzW2ldKSA9PSBmYWxzZSkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IG9zd2ViLnN5bnRheC5zcGxpdChsaW5lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0b2tlbnNbMF0gPT0gJ3J1bicpICYmICh0b2tlbnMubGVuZ3RoID4gMSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0dGhpcy52YXJzLml0ZW0gPSB0b2tlbnNbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVx0XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHRva2Vuc1swXSA9PSAnc2V0Y3ljbGUnKSAmJiAodG9rZW5zLmxlbmd0aCA+IDMpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHRcdFx0dmFyIGN5Y2xlID0gdG9rZW5zWzFdO1xyXG5cdFx0XHR2YXIgbmFtZSAgPSB0b2tlbnNbMl07XHJcblx0XHRcdHZhciB2YWx1ZSA9IG9zd2ViLnN5bnRheC5yZW1vdmVfcXVvdGVzKHRva2Vuc1szXSk7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0Ly8gQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIG51bWVyaWNcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvc3dlYi5zeW50YXguaXNOdW1iZXIodmFsdWUpID8gTnVtYmVyKHZhbHVlKSA6IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgcHl0aG9uIGV4cHJlc3Npb24gdG8gamF2YXNjcmlwdC5cclxuXHRcdFx0aWYgKHZhbHVlWzBdID09ICc9JylcclxuXHRcdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHB5dGhvbiBzdGF0ZW1lbnQuIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvc3dlYi5wYXJzZXIuX3ByZXBhcmUodmFsdWUuc2xpY2UoMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IG51bGwpICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmJvZHlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICAgIFxyXG5cdFx0XHR9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRyaXhbY3ljbGVdID09IHVuZGVmaW5lZClcclxuXHRcdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXRyaXhbY3ljbGVdID0ge307XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWF0cml4W2N5Y2xlXVtuYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cdFxyXG5cdFx0fVxyXG4gICAgICAgICAgICB9XHRcclxuXHR9XHJcbiAgICB9O1xyXG4gIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5zaHVmZmxlID0gZnVuY3Rpb24obGlzdClcclxuICAgIHtcclxuICAgICAgICB2YXIgaSwgaiwgdDtcclxuXHRmb3IgKGkgPSAxOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgXHJcblx0e1xyXG5cdCAgICBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEgKyBpKSk7ICBcclxuXHQgICAgaWYgKGogIT0gaSkgXHJcblx0ICAgIHtcclxuXHQgICAgICAgIHQgICAgICAgPSBsaXN0W2ldOyAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgbGlzdFtpXSA9IGxpc3Rbal07XHJcblx0ICAgICAgICBsaXN0W2pdID0gdDtcclxuICAgICAgICAgICAgfVxyXG5cdH1cdFx0XHRcclxuICAgIH07XHJcblxyXG4gICAgcC5hcHBseV9jeWNsZSA9IGZ1bmN0aW9uKGN5Y2xlKVxyXG4gICAge1xyXG5cdC8vIFNldHMgYWxsIHRoZSBsb29wIHZhcmlhYmxlcyBhY2NvcmRpbmcgdG8gdGhlIGN5Y2xlLlxyXG5cdGlmIChjeWNsZSBpbiB0aGlzLm1hdHJpeClcclxuXHR7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHZhcmlhYmxlIGluIHRoaXMubWF0cml4W2N5Y2xlXSlcclxuICAgICAgICAgICAge1xyXG5cdFx0Ly8gR2V0IHRoZSB2YWx1ZSBvZiB0aGUgdmFyaWFibGUuXHJcblx0XHR2YXIgdmFsdWUgPSB0aGlzLm1hdHJpeFtjeWNsZV1bdmFyaWFibGVdO1xyXG5cclxuXHRcdC8vIENoZWNrIGZvciBweXRob24gZXhwcmVzc2lvbi5cclxuXHRcdGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIGNvbnRhaW5zIGFzdCB0cmVlLCBydW4gdGhlIHBhcnNlci5cclxuICAgICAgICAgICAgICAgICAgICB0cnlcclxuICAgICAgICAgICAgICAgICAgICB7XHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXZhbHVhdGUgdGhlIGV4cHJlc3Npb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvc3dlYi5wYXJzZXIuX3J1bnN0YXRlbWVudCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXJyb3IgZHVyaW5nIGV2YWx1YXRpb24uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKCdGYWlsZWQgdG8gZXZhbHVhdGUgJyArIHZhbHVlICsgJyBpbiBsb29wIGl0ZW0gJyArIHRoaXMubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVx0XHRcdFx0XHRcdFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cdFx0XHRcdFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSB2YXJpYWJsZS5cclxuICAgICAgICAgICAgICAgIHRoaXMuZXhwZXJpbWVudC52YXJzLnNldCh2YXJpYWJsZSwgdmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcblx0fVxyXG4gICAgfTtcclxuXHRcclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBQcmVwYXJlIHRoZSBicmVhayBpZiBjb25kaXRpb24uXHJcblx0aWYgKCh0aGlzLnZhcnMuYnJlYWtfaWYgIT0gJycpICYmICh0aGlzLnZhcnMuYnJlYWtfaWYgIT0gJ25ldmVyJykpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLl9icmVha19pZiA9IHRoaXMuc3ludGF4LmNvbXBpbGVfY29uZCh0aGlzLnZhcnMuYnJlYWtfaWYpO1xyXG4gICAgICAgIH1cclxuXHRlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLl9icmVha19pZiA9IG51bGw7XHJcblx0fVxyXG5cclxuXHQvLyAgRmlyc3QgZ2VuZXJhdGUgYSBsaXN0IG9mIGN5Y2xlIG51bWJlcnNcclxuXHR0aGlzLl9jeWNsZXMgPSBbXTtcclxuXHR0aGlzLl9pbmRleCAgPSAwO1xyXG5cdFx0XHJcblx0Ly8gV2FsayB0aHJvdWdoIGFsbCBjb21wbGV0ZSByZXBlYXRzXHJcblx0dmFyIHdob2xlX3JlcGVhdHMgPSBNYXRoLmZsb29yKHRoaXMudmFycy5yZXBlYXQpO1xyXG5cdGZvciAodmFyIGogPSAwOyBqIDwgd2hvbGVfcmVwZWF0czsgaisrKVxyXG5cdHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZhcnMuY3ljbGVzOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHRoaXMuX2N5Y2xlcy5wdXNoKGkpO1xyXG4gICAgICAgICAgICB9XHJcblx0fVxyXG5cdFx0XHRcdFxyXG5cdC8vIEFkZCB0aGUgbGVmdG92ZXIgcmVwZWF0cy5cclxuXHR2YXIgcGFydGlhbF9yZXBlYXRzID0gdGhpcy52YXJzLnJlcGVhdCAtIHdob2xlX3JlcGVhdHM7XHJcblx0aWYgKHBhcnRpYWxfcmVwZWF0cyA+IDApXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgYWxsX2N5Y2xlcyA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6IHRoaXMudmFycy5jeWNsZXN9KS5tYXAoTnVtYmVyLmNhbGwsIE51bWJlcik7ICAgIFxyXG4gICAgICAgICAgICB2YXIgcmVtYWluZGVyICA9IE1hdGguZmxvb3IodGhpcy52YXJzLmN5Y2xlcyAqIHBhcnRpYWxfcmVwZWF0cyk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVtYWluZGVyOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSByYW5kb20gcG9zaXRpb24uXHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhbGxfY3ljbGVzLmxlbmd0aCk7ICAgICBcclxuICAgICAgICAgICAgICAgIC8vIEFkZCBwb3NpdGlvbiB0byBjeWNsZXMuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jeWNsZXMucHVzaChwb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgcG9zaXRpb24gZnJvbSBhcnJheS5cclxuICAgICAgICAgICAgICAgIGFsbF9jeWNsZXMuc3BsaWNlKHBvc2l0aW9uLDEpO1xyXG4gICAgICAgICAgICB9XHJcblx0fVx0XHRcclxuXHJcblx0Ly8gUmFuZG9taXplIHRoZSBsaXN0IGlmIG5lY2Vzc2FyeS5cclxuXHRpZiAodGhpcy52YXJzLm9yZGVyID09ICdyYW5kb20nKVxyXG5cdHtcclxuICAgICAgICAgICAgdGhpcy5zaHVmZmxlKHRoaXMuX2N5Y2xlcyk7XHJcblx0fVx0XHJcblx0ZWxzZVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gSW4gc2VxdWVudGlhbCBvcmRlciwgdGhlIG9mZnNldCBhbmQgdGhlIHNraXAgYXJlIHJlbGV2YW50LlxyXG4gICAgICAgICAgICBpZiAodGhpcy5fY3ljbGVzLmxlbmd0aCA8IHRoaXMudmFycy5za2lwKSAgXHJcbiAgICAgICAgICAgIHtcclxuXHRcdG9zd2ViLmRlYnVnLmFkZEVycm9yKCdUaGUgdmFsdWUgb2Ygc2tpcCBpcyB0b28gaGlnaCBpbiBsb29wIGl0ZW0gJyArIHRoaXMubmFtZSArICcuIFlvdSBjYW5ub3Qgc2tpcCBtb3JlIGN5Y2xlcyB0aGFuIHRoZXJlIGFyZS4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuXHRcdGlmICh0aGlzLnZhcnMub2Zmc2V0ID09ICd5ZXMnKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgc2tpcCBlbGVtZW50cy5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2tpcCA9IHRoaXMuX2N5Y2xlcy5zbGljZSgwLCB0aGlzLnZhcnMuc2tpcCk7XHJcblx0XHRcdFx0XHRcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHNraXAgZWxlbWVudHMgZnJvbSB0aGUgb3JpZ2luYWwgbG9jYXRpb24uXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3ljbGVzID0gdGhpcy5fY3ljbGVzLnNsaWNlKHRoaXMudmFycy5za2lwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBza2lwIGVsZW1lbnQgdG8gdGhlIGVuZC5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jeWNsZXMgPSB0aGlzLl9jeWNsZXMuY29uY2F0KHNraXApO1x0XHRcdFx0XHRcdFx0XHRcdFx0XHJcblx0XHR9XHJcblx0XHRlbHNlXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3ljbGVzID0gdGhpcy5fY3ljbGVzLnNsaWNlKHRoaXMudmFycy5za2lwKTtcclxuXHRcdH1cclxuICAgICAgICAgICAgfVxyXG5cdH1cclxuXHRcdFxyXG5cdC8vIENyZWF0ZSBhIGtleWJvYXJkIHRvIGZsdXNoIHJlc3BvbnNlcyBiZXR3ZWVuIGN5Y2xlcy5cclxuXHR0aGlzLl9rZXlib2FyZCA9IG5ldyBvc3dlYi5rZXlib2FyZCh0aGlzLmV4cGVyaW1lbnQpO1xyXG5cdFxyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgaXRlbSB0byBydW4gZXhpc3RzLlxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQuaXRlbXMuX2l0ZW1zW3RoaXMudmFycy5pdGVtXSA9PT0gJ3VuZGVmaW5lZCcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignQ291bGQgbm90IGZpbmQgaXRlbSAnICsgdGhpcy52YXJzLml0ZW0gKyAnLCB3aGljaCBpcyBjYWxsZWQgYnkgbG9vcCBpdGVtICcgKyB0aGlzLm5hbWUpO1xyXG4gICAgICAgIH0gICAgXHJcblxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9wcmVwYXJlKCk7XHJcblx0XHJcblx0Ly8gU2V0IHRoZSBvbnNldCB0aW1lLlxyXG5cdHRoaXMuc2V0X2l0ZW1fb25zZXQoKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5pdGVtX3J1bigpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fY3ljbGVzLmxlbmd0aCA+IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZXhpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLl9pbmRleCA9IHRoaXMuX2N5Y2xlcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcGx5X2N5Y2xlKHRoaXMuX2luZGV4KTtcclxuXHRcdFxyXG4gICAgICAgICAgICBpZiAodGhpcy5fYnJlYWtfaWYgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5weXRob25fd29ya3NwYWNlWyd0aGlzJ10gPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgYnJlYWtfaWYgPSBvc3dlYi5zeW50YXguZXZhbF90ZXh0KHRoaXMuX2JyZWFrX2lmKTsgXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnB5dGhvbl93b3Jrc3BhY2UuX2V2YWwoYnJlYWtfaWYpID09IHRydWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhpdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHRcclxuICAgICAgICAgICAgfVxyXG5cdFx0XHRcclxuICAgICAgICAgICAgaWYgKGV4aXQgPT0gZmFsc2UpXHJcbiAgICAgICAgICAgIHtcclxuXHRcdHRoaXMuZXhwZXJpbWVudC52YXJzLnJlcGVhdF9jeWNsZSA9IDA7XHJcblx0XHRcclxuICAgICAgICAgICAgICAgIG9zd2ViLml0ZW1fc3RvcmUucHJlcGFyZSh0aGlzLnZhcnMuaXRlbSwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICAvL29zd2ViLml0ZW1fc3RvcmUuZXhlY3V0ZSh0aGlzLnZhcnMuaXRlbSwgdGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBCcmVhayB0aGUgbG9vcC5cclxuICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBCcmVhayB0aGUgbG9vcC5cclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHRcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIGlmIHRoZSBjeWNsZSBtdXN0IGJlIHJlcGVhdGVkLlxyXG5cdGlmICh0aGlzLmV4cGVyaW1lbnQudmFycy5yZXBlYXRfY3ljbGUgPT0gMSlcclxuXHR7XHJcbiAgICAgICAgICAgIG9zd2ViLmRlYnVnLm1zZygncmVwZWF0aW5nIGN5Y2xlICcgKyB0aGlzLl9pbmRleCk7XHJcblx0XHRcdFxyXG4gICAgICAgICAgICB0aGlzLl9jeWNsZXMucHVzaCh0aGlzLl9pbmRleCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodGhpcy52YXJzLm9yZGVyID09ICdyYW5kb20nKVxyXG4gICAgICAgICAgICB7XHJcblx0XHR0aGlzLnNodWZmbGUodGhpcy5fY3ljbGVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHR9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQWxsIGl0ZW1zIGFyZSBwcm9jZXNzZWQsIHNldCB0aGUgc3RhdHVzIHRvIGZpbmFsaXplZC5cclxuICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTtcclxuXHJcbiAgICAgICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgICAgICAgICB0aGlzLml0ZW1fY29tcGxldGUoKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBsb29wIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5sb29wID0gb3N3ZWIucHJvbW90ZUNsYXNzKGxvb3AsIFwiaXRlbVwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIG1vdXNlX3Jlc3BvbnNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBtb3VzZV9yZXNwb25zZShwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkIGNyZWF0ZS5cclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuXHJcbiAgICAgICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuX2ZsdXNoID0gJ3llcyc7XHJcblx0dGhpcy5fbW91c2UgPSBuZXcgb3N3ZWIubW91c2UodGhpcy5leHBlcmltZW50KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhtb3VzZV9yZXNwb25zZSwgb3N3ZWIuZ2VuZXJpY19yZXNwb25zZSk7XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0NvbGxlY3RzIG1vdXNlIHJlc3BvbnNlcyc7XHJcbiAgICBwLnJlc3BfY29kZXMgID0ge307XHJcblx0XHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLlxyXG4gICAgICovXHJcblx0XHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuXHR0aGlzLmF1dG9fcmVzcG9uc2UgICAgICAgICAgPSAxO1xyXG5cdHRoaXMucHJvY2Vzc19mZWVkYmFjayAgICAgICA9IHRydWU7XHJcblx0dGhpcy5yZXNwX2NvZGVzICAgICAgICAgICAgID0ge307XHJcblx0dGhpcy5yZXNwX2NvZGVzWycwJ10gICAgICAgID0gJ3RpbWVvdXQnO1xyXG5cdHRoaXMucmVzcF9jb2Rlc1snMSddICAgICAgICA9ICdsZWZ0X2J1dHRvbic7XHJcblx0dGhpcy5yZXNwX2NvZGVzWycyJ10gICAgICAgID0gJ21pZGRsZV9idXR0b24nO1xyXG5cdHRoaXMucmVzcF9jb2Rlc1snMyddICAgICAgICA9ICdyaWdodF9idXR0b24nO1xyXG5cdHRoaXMucmVzcF9jb2Rlc1snNCddICAgICAgICA9ICdzY3JvbGxfdXAnO1xyXG5cdHRoaXMucmVzcF9jb2Rlc1snNSddICAgICAgICA9ICdzY3JvbGxfZG93bic7XHJcblx0dGhpcy52YXJzLmFsbG93ZWRfcmVzcG9uc2VzID0gbnVsbDtcclxuXHR0aGlzLnZhcnMuY29ycmVjdF9yZXNwb25zZSAgPSBudWxsO1xyXG5cdHRoaXMudmFycy5kdXJhdGlvbiAgICAgICAgICA9ICdtb3VzZWNsaWNrJztcclxuXHR0aGlzLnZhcnMuZmx1c2ggICAgICAgICAgICAgPSAneWVzJztcclxuXHR0aGlzLnZhcnMuc2hvd19jdXJzb3IgICAgICAgPSAneWVzJztcclxuXHR0aGlzLnZhcnMudGltZW91dCAgICAgICAgICAgPSAnaW5maW5pdGUnO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcdFxyXG5cdC8vIFNldCB0aGUgaW50ZXJuYWwgZmx1c2ggcHJvcGVydHkuXHJcblx0dGhpcy5fZmx1c2ggPSAodGhpcy52YXJzLmZsdXNoKSA/IHRoaXMudmFycy5mbHVzaCA6ICd5ZXMnO1xyXG4gXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX3ByZXBhcmUoKTtcclxuICAgfTtcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfcnVuKCk7XHJcblxyXG4gICAgICAgIC8vIFJlY29yZCB0aGUgb25zZXQgb2YgdGhlIGN1cnJlbnQgaXRlbS5cclxuXHR0aGlzLnNldF9pdGVtX29uc2V0KCk7IFxyXG4gICAgICAgIFxyXG5cdC8vIFNob3cgdGhlIGN1cnNvciBpZiBkZWZpbmVkLlxyXG4gICAgICAgIGlmICh0aGlzLnZhcnMuc2hvd19jdXJzb3IgPT0gJ3llcycpXHJcblx0e1x0XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlLnNob3dfY3Vyc29yKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcblx0Ly8gRmx1c2ggcmVzcG9uc2VzLCB0byBtYWtlIHN1cmUgdGhhdCBlYXJsaWVyIHJlc3BvbnNlcyBhcmUgbm90IGNhcnJpZWQgb3Zlci5cclxuXHRpZiAodGhpcy5fZmx1c2ggPT0gJ3llcycpXHJcblx0e1x0XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlLmZsdXNoKCk7XHJcblx0fVx0XHRcclxuICAgIFxyXG4gICAgICAgIHRoaXMuc2V0X3NyaSgpO1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc19yZXNwb25zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEhpZGUgdGhlIG1vdXNlIGN1cnNvci4gICAgXHJcbiAgICAgICAgdGhpcy5fbW91c2Uuc2hvd19jdXJzb3IoZmFsc2UpO1xyXG4gICAgICAgXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5nZW5lcmljX3Jlc3BvbnNlX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIG1vdXNlX3Jlc3BvbnNlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5tb3VzZV9yZXNwb25zZSA9IG9zd2ViLnByb21vdGVDbGFzcyhtb3VzZV9yZXNwb25zZSwgXCJnZW5lcmljX3Jlc3BvbnNlXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3Mgc2VxdWVuY2UuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHNlcXVlbmNlKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cdFxyXG4gICAgICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuXHR0aGlzLl9pbmRleCAgICAgICAgID0gLTE7XHJcblx0dGhpcy5faW5kZXhfcHJlcGFyZSA9IC0xO1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zICAgICAgICAgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2tleWJvYXJkICAgICAgPSBudWxsOyAgICBcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhzZXF1ZW5jZSwgb3N3ZWIuaXRlbSk7XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uICAgID0gJ1J1bnMgYSBudW1iZXIgb2YgaXRlbXMgaW4gc2VxdWVuY2UnO1xyXG4gICAgcC5mbHVzaF9rZXlib2FyZCA9ICd5ZXMnO1xyXG4gICAgcC5pdGVtcyAgICAgICAgICA9IG51bGw7XHJcblx0XHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBSZXNldHMgYWxsIGl0ZW0gdmFyaWFibGVzIHRvIHRoZWlyIGRlZmF1bHQgdmFsdWUuLlxyXG5cdHRoaXMuaXRlbXMgICAgICAgICAgICAgICA9IFtdO1xyXG5cdHRoaXMudmFycy5mbHVzaF9rZXlib2FyZCA9ICd5ZXMnO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmZyb21fc3RyaW5nID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuXHQvLyBQYXJzZXMgYSBkZWZpbml0aW9uIHN0cmluZy5cclxuXHR0aGlzLnZhcmlhYmxlcyA9IHt9O1xyXG5cdHRoaXMuY29tbWVudHMgID0gW107XHJcblx0dGhpcy5yZXNldCgpO1xyXG5cdFx0XHJcblx0Ly8gU3BsaXQgdGhlIHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIGxpbmVzLiAgXHJcblx0aWYgKHBTdHJpbmcgIT0gbnVsbClcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciBsaW5lcyA9IHBTdHJpbmcuc3BsaXQoJ1xcbicpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG5cdFx0aWYgKChsaW5lc1tpXSAhPSAnJykgJiYgKHRoaXMucGFyc2VfdmFyaWFibGUobGluZXNbaV0pID09IGZhbHNlKSlcclxuXHRcdHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5zID0gb3N3ZWIuc3ludGF4LnNwbGl0KGxpbmVzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHRva2Vucy5sZW5ndGggPiAwKSAmJiAodG9rZW5zWzBdID09ICdydW4nKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdG9rZW5zWzFdO1xyXG5cdFx0XHR2YXIgY29uZCA9ICdhbHdheXMnO1xyXG5cdFx0XHRpZiAodG9rZW5zLmxlbmd0aCA+IDIpXHJcblx0XHRcdHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmQgPSB0b2tlbnNbMl07XHJcblx0XHRcdH1cdFxyXG5cclxuXHRcdFx0Ly8gUHVzaCB0aGUgaXRlbSBhbmQgY29uZGl0aW9uIGRlZmluaXRpb24gdG8gdGhlIGl0ZW1zIGxpc3QuXHJcblx0XHRcdHRoaXMuaXRlbXMucHVzaCh7J2l0ZW0nOiBpdGVtLCAnY29uZCc6IGNvbmR9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHRcclxuICAgICAgICAgICAgXHR9IFxyXG4gICAgICAgICAgICB9XHJcblx0fVx0XHRcdFx0XHRcclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW4gY3ljbGUuICAgICAgICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5pdGVtX3ByZXBhcmUoKTtcclxuXHRcclxuICAgICAgICAvLyBDcmVhdGUgYSBrZXlib2FyZCB0byBmbHVzaCByZXNwb25zZXMgYXQgdGhlIHN0YXJ0IG9mIHRoZSBydW4gcGhhc2VcclxuXHRpZiAodGhpcy52YXJzLmZsdXNoX2tleWJvYXJkID09ICd5ZXMnKVxyXG4gICAgICAgIHtcdFxyXG4gICAgICAgICAgICB0aGlzLl9rZXlib2FyZCA9IG5ldyBvc3dlYi5rZXlib2FyZCh0aGlzLmV4cGVyaW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgeyAgICBcclxuICAgICAgICAgICAgdGhpcy5fa2V5Ym9hcmQgPSBudWxsO1xyXG4gICAgICAgIH0gICAgXHJcblx0XHJcbiAgICAgICAgLy8gR2VuZXJhdGUgdGhlIGl0ZW1zIGxpc3QgZm9yIHRoZSBydW4gY3ljbGUuXHJcbiAgICAgICAgdGhpcy5faW5kZXggPSAwO1xyXG5cdHRoaXMuX2l0ZW1zID0gW107XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJlcGFyZSB0aGUgaXRlbXMuXHJcbiAgICAgICAgdGhpcy5wcmVwYXJlX2NvbXBsZXRlKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvKiB0aGlzLl9pdGVtcyA9IFtdO1xyXG5cdGZvciAodmFyIGk9MDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspXHJcblx0e1xyXG4gICAgICAgICAgICBpZiAoKHRoaXMuaXRlbXNbaV0uaXRlbSBpbiBvc3dlYi5pdGVtX3N0b3JlLl9pdGVtcykgPT09IGZhbHNlKVxyXG4gICAgICAgICAgICB7XHJcblx0XHRvc3dlYi5kZWJ1Zy5hZGRFcnJvcignQ291bGQgbm90IGZpbmQgaXRlbSAnICsgdGhpcy5pdGVtc1tpXS5pdGVtLm5hbWUgKyAnIHdoaWNoIGlzIGNhbGxlZCBieSBzZXF1ZW5jZSBpdGVtICcgKyB0aGlzLm5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdGhlIGl0ZW1zLlxyXG4gICAgICAgICAgICAgICAgb3N3ZWIuaXRlbV9zdG9yZS5wcmVwYXJlKHRoaXMuaXRlbXNbaV0uaXRlbSk7XHJcblx0XHRcclxuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgaXRlbSB0byB0aGUgaW50ZXJuYWwgbGlzdC5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnB1c2goeydpdGVtJzogdGhpcy5pdGVtc1tpXS5pdGVtLCAnY29uZCc6IG9zd2ViLnN5bnRheC5jb21waWxlX2NvbmQodGhpcy5pdGVtc1tpXS5jb25kKX0pO1xyXG4gICAgICAgICAgICB9XHJcblx0fSAqL1x0XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBwLnByZXBhcmVfY29tcGxldGUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gR2VuZXJhdGUgdGhlIGl0ZW1zIGxpc3QgZm9yIHRoZSBydW4gY3ljbGUuXHJcbiAgICAgICAgaWYgKHRoaXMuX2luZGV4IDwgdGhpcy5pdGVtcy5sZW5ndGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoKHRoaXMuaXRlbXNbdGhpcy5faW5kZXhdLml0ZW0gaW4gb3N3ZWIuaXRlbV9zdG9yZS5faXRlbXMpID09PSBmYWxzZSlcclxuICAgICAgICAgICAge1xyXG5cdFx0b3N3ZWIuZGVidWcuYWRkRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIGl0ZW0gJyArIHRoaXMuaXRlbXNbdGhpcy5faW5kZXhdLml0ZW0ubmFtZSArICcgd2hpY2ggaXMgY2FsbGVkIGJ5IHNlcXVlbmNlIGl0ZW0gJyArIHRoaXMubmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy8gSW5jcmVhc2UgdGhlIGN1cnJlbnQgaW5kZXguXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIGl0ZW0gdG8gdGhlIGludGVybmFsIGxpc3QuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtcy5wdXNoKHsnaXRlbSc6IHRoaXMuaXRlbXNbdGhpcy5faW5kZXggLSAxXS5pdGVtLCAnY29uZCc6IG9zd2ViLnN5bnRheC5jb21waWxlX2NvbmQodGhpcy5pdGVtc1t0aGlzLl9pbmRleCAtIDFdLmNvbmQpfSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdGhlIGl0ZW0uXHJcbiAgICAgICAgICAgICAgICBvc3dlYi5pdGVtX3N0b3JlLnByZXBhcmUodGhpcy5pdGVtc1t0aGlzLl9pbmRleCAtIDFdLml0ZW0sIHRoaXMpO1xyXG5cdCAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIFByZXBhcmUgcHJvY2VzcyBpcyBkb25lLCBzdGFydCBleGVjdXRpb24uXHJcbiAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gMDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgcHJlcGFyZSBwaGFzZSBmb3JtIHRoZSBzdGFjay4gICAgXHJcbiAgICAgICAgICAgIG9zd2ViLml0ZW1fc3RhY2sucG9wKCk7XHJcbiAgICBcclxuICBcdCAgICAvLyBFeGVjdXRlIHRoZSBuZXh0IGN5Y2xlIG9mIHRoZSBzZXF1bmNlIGl0c2VsZi5cclxuICAgICAgICAgICAgb3N3ZWIuaXRlbV9zdG9yZS5ydW4odGhpcy5uYW1lLCB0aGlzLl9wYXJlbnQpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgICAgICB0aGlzLml0ZW1fcnVuKCk7XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIGFsbCBpdGVtcyBoYXZlIGJlZW4gcHJvY2Vzc2VkLlxyXG4gICAgICAgIGlmICh0aGlzLl9pbmRleCA8IHRoaXMuX2l0ZW1zLmxlbmd0aClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIEZsdXNoIHRoZSBrZXlib2FyZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBzZXF1ZW5jZS5cclxuICAgICAgICAgICAgaWYgKCh0aGlzLl9pbmRleCA9PSAwKSAmJiAodGhpcy52YXJzLmZsdXNoX2tleWJvYXJkID09ICd5ZXMnKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fa2V5Ym9hcmQuZmx1c2goKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSW5jcmVhc2UgdGhlIGN1cnJlbnQgaW5kZXguXHJcbiAgICAgICAgICAgIHRoaXMuX2luZGV4Kys7XHJcbiAgICAgICAgICAgIGN1cnJlbnRfaXRlbSA9IHRoaXMuX2l0ZW1zW3RoaXMuX2luZGV4IC0gMV1cclxuXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgd29ya3NwYWNlLlxyXG4gICAgICAgICAgICBvc3dlYi5weXRob25fd29ya3NwYWNlWydzZWxmJ10gPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coY3VycmVudF9pdGVtKTtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGl0ZW0gbWF5IHJ1bi4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChvc3dlYi5weXRob25fd29ya3NwYWNlLl9ldmFsKGN1cnJlbnRfaXRlbS5jb25kKSA9PSB0cnVlKSBcclxuICAgICAgICAgICAgeyAgIFxyXG4gICAgICAgICAgICAgICAgLy8gcnVuIHRoZSBjdXJyZW50IGl0ZW0gb2YgdGhlIHNlcXVlbmNlIG9iamVjdC5cclxuICAgICAgICAgICAgICAgIG9zd2ViLml0ZW1fc3RvcmUucnVuKGN1cnJlbnRfaXRlbS5pdGVtLCB0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gIFx0ICAgIGVsc2VcclxuICBcdCAgICB7XHJcbiAgXHQgICAgXHQvLyBFeGVjdXRlIHRoZSBuZXh0IGN5Y2xlIG9mIHRoZSBzZXF1bmNlIGl0c2VsZi5cclxuICBcdCAgICBcdHRoaXMucnVuKCk7XHRcclxuICBcdCAgICB9XHJcblx0fVxyXG5cdGVsc2VcclxuXHR7XHJcbiAgICAgICAgICAgIC8vIHNlcXVlbmNlIGlzIGZpbmFsaXplZC5cclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblx0XHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIHNlcXVlbmNlIGlzIGZpbmFsaXplZC5cclxuICAgICAgICB0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5pdGVtX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIHNlcXVlbmNlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5zZXF1ZW5jZSA9IG9zd2ViLnByb21vdGVDbGFzcyhzZXF1ZW5jZSwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCIvKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBza2V0Y2hwYWQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHNrZXRjaHBhZChwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHB1YmxpY2UgcHJvcGVydGllcy5cclxuICAgIFx0dGhpcy5jYW52YXMgICA9IG5ldyBvc3dlYi5jYW52YXMocEV4cGVyaW1lbnQsIGZhbHNlKTtcclxuXHR0aGlzLmVsZW1lbnRzID0gW107XHJcblxyXG5cdC8vIEluaGVyaXRlZCBjcmVhdGUuXHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3Moc2tldGNocGFkLCBvc3dlYi5nZW5lcmljX3Jlc3BvbnNlKTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuY2FudmFzICAgPSBudWxsO1xyXG4gICAgcC5lbGVtZW50cyA9IFtdO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcbiAgICBcclxuICAgIHAuX2NvbXBhcmUgPSBmdW5jdGlvbihhLGIpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIFNvcnQgZnVuY3Rpb24gdXNlZCBmb3IgZGV0ZXJtaW5pbmcgdGhlIGRyYXcgaW5kZXggKHotaW5kZXgpIG9mIGFsbGUgZWxlbWVudGUuXHJcbiAgICAgICAgaWYgKGEuel9pbmRleCgpIDwgYi56X2luZGV4KCkpXHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIGVsc2UgaWYgKGEuel9pbmRleCgpID4gYi56X2luZGV4KCkpXHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICBlbHNlIFxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG4gICAgXHR0aGlzLmVsZW1lbnRzICAgICAgPSBbXTtcclxuXHR0aGlzLnZhcnMuZHVyYXRpb24gPSAna2V5cHJlc3MnO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmZyb21fc3RyaW5nID0gZnVuY3Rpb24ocFN0cmluZylcclxuICAgIHtcclxuICAgICAgICAvLyBEZWZpbmUgYW5kIHJlc2V0IHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0cy5cclxuICAgICAgICB0aGlzLnZhcmlhYmxlcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuY29tbWVudHMgID0gW107XHJcbiBcdHRoaXMucmVzZXQoKTtcclxuXHRcdFxyXG5cdC8vIFNwbGl0IHRoZSBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBsaW5lcy4gIFxyXG5cdGlmIChwU3RyaW5nICE9IG51bGwpXHJcblx0e1xyXG4gICAgICAgICAgICB2YXIgbGluZXMgPSBwU3RyaW5nLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHRcdGlmICgobGluZXNbaV0gIT0gJycpICYmICh0aGlzLnBhcnNlX3ZhcmlhYmxlKGxpbmVzW2ldKSA9PSBmYWxzZSkpXHJcblx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IG9zd2ViLnN5bnRheC5zcGxpdChsaW5lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0b2tlbnMubGVuZ3RoID4gMCkgJiYgKHRva2Vuc1swXSA9PSAnZHJhdycpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHRcdFx0aWYgKG9zd2ViLmlzQ2xhc3ModG9rZW5zWzFdKSA9PSB0cnVlKVxyXG5cdFx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IG9zd2ViLm5ld0VsZW1lbnRDbGFzcyh0b2tlbnNbMV0sIHRoaXMsIGxpbmVzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudHMucHVzaChlbGVtZW50KTtcdFxyXG5cdFx0XHR9XHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG5cdFx0XHR7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlcnJvci5cclxuXHRcdFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHRcdH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU29ydCB0aGUgZWxlbWVudHMgdXNpbiB0aGUgei1pbmRleC5cclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50cy5zb3J0KHRoaXMuX2NvbXBhcmUpO1xyXG4gICAgICAgIH1cdFx0XHRcdFx0XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5wcmVwYXJlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIERyYXcgdGhlIGVsZW1lbnRzLiBcclxuXHRmb3IgKHZhciBpPTA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKVxyXG5cdHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudHNbaV0uaXNfc2hvd24oKSA9PSB0cnVlKVxyXG4gICAgICAgICAgICB7XHJcblx0XHR0aGlzLmVsZW1lbnRzW2ldLmRyYXcoKTtcclxuICAgICAgICAgICAgfVx0XHRcdFxyXG5cdH1cdFx0XHRcdFxyXG4gICAgXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX3ByZXBhcmUoKTtcclxuICAgIH07XHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX3J1bigpO1xyXG5cdFx0XHJcbiAgICAgICAgLy8gU2V0IHRoZSBvbnNldCBhbmQgc3RhcnQgdGhlIHN0aW11bHVzIHJlc3BvbnNlIHByb2Nlc3MuICAgICAgICBcclxuXHR0aGlzLnNldF9pdGVtX29uc2V0KHRoaXMuY2FudmFzLnNob3coKSk7IFxyXG5cdHRoaXMuc2V0X3NyaShmYWxzZSk7XHJcblx0dGhpcy5wcm9jZXNzX3Jlc3BvbnNlKCk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBDbGVhciB0aGUgY2FudmFzLlxyXG5cdHRoaXMuY2FudmFzLmNsZWFyKCk7XHJcblx0XHRcclxuXHQvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgc2tldGNocGFkIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5za2V0Y2hwYWQgPSBvc3dlYi5wcm9tb3RlQ2xhc3Moc2tldGNocGFkLCBcImdlbmVyaWNfcmVzcG9uc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmZWVkYmFjay5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZmVlZGJhY2socEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZCBjcmVhdGUuXHJcblx0dGhpcy5za2V0Y2hwYWRfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhmZWVkYmFjaywgb3N3ZWIuc2tldGNocGFkKTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZGVzY3JpcHRpb24gPSAnUHJvdmlkZXMgZmVlZGJhY2sgdG8gdGhlIHBhcnRpY2lwYW50JztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gUmVzZXRzIGFsbCBpdGVtIHZhcmlhYmxlcyB0byB0aGVpciBkZWZhdWx0IHZhbHVlLlxyXG5cdHRoaXMuc2tldGNocGFkX3Jlc2V0KCk7XHJcblx0dGhpcy52YXJzLnJlc2V0X3ZhcmlhYmxlcyA9ICd5ZXMnO1xyXG4gICAgfTtcdFxyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBQcmVwYXJlcyB0aGUgaXRlbS5cclxuICAgICAgICB0aGlzLl9wYXJlbnQucHJlcGFyZV9jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5za2V0Y2hwYWRfcHJlcGFyZSgpO1xyXG5cdHRoaXMuc2tldGNocGFkX3J1bigpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLnNrZXRjaHBhZF9jb21wbGV0ZSgpO1xyXG5cclxuXHQvLyBSZXNldCBmZWVkYmFjayB2YXJpYWJsZXMuXHJcblx0aWYgKHRoaXMudmFycy5yZXNldF92YXJpYWJsZXMgPT0gJ3llcycpXHJcblx0e1xyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQucmVzZXRfZmVlZGJhY2soKTtcclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGZlZWRiYWNrIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5mZWVkYmFjayA9IG9zd2ViLnByb21vdGVDbGFzcyhmZWVkYmFjaywgXCJza2V0Y2hwYWRcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBzeW50aC5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gc3ludGgocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLnNhbXBsZXJfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhzeW50aCwgb3N3ZWIuc2FtcGxlcik7XHJcblxyXG4gICAgLy8gRGVmaW5lIGFuZCBzZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZGVzY3JpcHRpb24gPSAnQSBiYXNpYyBzb3VuZCBzeW50aGVzaXplcic7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMuXHJcbiAgICAgKi9cclxuXHJcbiAgICAvLyBCaW5kIHRoZSBzeW50aCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuc3ludGggPSBvc3dlYi5wcm9tb3RlQ2xhc3Moc3ludGgsIFwic2FtcGxlclwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGFkdmFuY2VkX2RlbGF5LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBhZHZhbmNlZF9kZWxheShwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG4gICAgXHJcbiAgICAgICAgLy8gU2V0IHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9kdXJhdGlvbiA9IC0xO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGFkdmFuY2VkX2RlbGF5LCBvc3dlYi5pdGVtKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdXYWl0cyBmb3IgYSBzcGVjaWZpZWQgZHVyYXRpb24nO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyBSZXNldHMgYWxsIGl0ZW0gdmFyaWFibGVzIHRvIHRoZWlyIGRlZmF1bHQgdmFsdWUuXHJcblx0dGhpcy52YXJzLmR1cmF0aW9uICAgID0gMTAwMDtcclxuXHR0aGlzLnZhcnMuaml0dGVyICAgICAgPSAwO1xyXG5cdHRoaXMudmFycy5qaXR0ZXJfbW9kZSA9ICdVbmlmb3JtJztcclxuICAgIH07IFxyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHR0aGlzLl9kdXJhdGlvbiA9IHRoaXMudmFycy5kdXJhdGlvbjtcclxuICAgICAgICAvKiAjIFNhbml0eSBjaGVjayBvbiB0aGUgZHVyYXRpb24gdmFsdWUsIHdoaWNoIHNob3VsZCBiZSBhIHBvc2l0aXZlIG51bWVyaWNcclxuXHQjIHZhbHVlLlxyXG5cdGlmIHR5cGUoc2VsZi52YXIuZHVyYXRpb24pIG5vdCBpbiAoaW50LCBmbG9hdCkgb3Igc2VsZi52YXIuZHVyYXRpb24gPCAwOlxyXG5cdFx0cmFpc2Ugb3NleGNlcHRpb24oXHJcblx0XHRcdHUnRHVyYXRpb24gc2hvdWxkIGJlIGEgcG9zaXRpdmUgbnVtZXJpYyB2YWx1ZSBpbiBhZHZhbmNlZF9kZWxheSAlcycgXFxcclxuXHRcdFx0JSBzZWxmLm5hbWUpXHJcblx0aWYgc2VsZi52YXIuaml0dGVyX21vZGUgPT0gdSdVbmlmb3JtJzpcclxuXHRcdHNlbGYuX2R1cmF0aW9uID0gcmFuZG9tLnVuaWZvcm0oc2VsZi52YXIuZHVyYXRpb24tc2VsZi52YXIuaml0dGVyLzIsXHJcblx0XHRcdHNlbGYudmFyLmR1cmF0aW9uK3NlbGYudmFyLmppdHRlci8yKVxyXG5cdGVsaWYgc2VsZi52YXIuaml0dGVyX21vZGUgPT0gdSdTdGQuIERldi4nOlxyXG5cdFx0c2VsZi5fZHVyYXRpb24gPSByYW5kb20uZ2F1c3Moc2VsZi52YXIuZHVyYXRpb24sIHNlbGYudmFyLmppdHRlcilcclxuXHRlbHNlOlxyXG5cdFx0cmFpc2Ugb3NleGNlcHRpb24oXHJcblx0XHRcdHUnVW5rbm93biBqaXR0ZXIgbW9kZSBpbiBhZHZhbmNlZF9kZWxheSAlcycgJSBzZWxmLm5hbWUpXHJcblx0IyBEb24ndCBhbGxvdyBuZWdhdGl2ZSBkdXJhdGlvbnMuXHJcblx0aWYgc2VsZi5fZHVyYXRpb24gPCAwOlxyXG5cdFx0c2VsZi5fZHVyYXRpb24gPSAwXHJcblx0c2VsZi5fZHVyYXRpb24gPSBpbnQoc2VsZi5fZHVyYXRpb24pXHJcblx0c2VsZi5leHBlcmltZW50LnZhci5zZXQodSdkZWxheV8lcycgJSBzZWxmLm5hbWUsIHNlbGYuX2R1cmF0aW9uKVxyXG5cdGRlYnVnLm1zZyh1XCJkZWxheSBmb3IgJXMgbXNcIiAlIHNlbGYuX2R1cmF0aW9uKSAqL1xyXG5cclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLml0ZW1fcHJlcGFyZSgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpIFxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgXHR0aGlzLml0ZW1fcnVuKCk7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgb25zZXQgdGltZS5cclxuICAgICAgICB0aGlzLnNldF9pdGVtX29uc2V0KHRoaXMudGltZSgpKTtcclxuICAgICAgICB0aGlzLnNsZWVwKHRoaXMuX2R1cmF0aW9uKTtcdFx0XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGFkdmFuY2VkX2RlbGF5IGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5hZHZhbmNlZF9kZWxheSA9IG9zd2ViLnByb21vdGVDbGFzcyhhZHZhbmNlZF9kZWxheSwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgZm9ybV9iYXNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBmb3JtX2Jhc2UocE5hbWUsIHBFeHBlcmltZW50LCBwU2NyaXB0LCBwSXRlbV90eXBlLCBwRGVzY3JpcHRpb24pXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuaXRlbV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9mb3JtX3RleHQgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IHBEZXNjcmlwdGlvbjtcclxuICAgICAgICB0aGlzLml0ZW1fdHlwZSAgID0gcEl0ZW1fdHlwZTtcclxuICAgIH0gICBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoZm9ybV9iYXNlLCBvc3dlYi5pdGVtKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5jb2xzICAgICAgICA9IFtdO1xyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdBIGdlbmVyaWMgZm9ybSBwbHVnLWluJztcclxuICAgIHAuZm9ybSAgICAgICAgPSBudWxsO1xyXG4gICAgcC5yb3dzICAgICAgICA9IFtdO1xyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5yZXNldCA9IGZ1bmN0aW9uKCkgXHJcbiAgICB7XHJcbiAgXHQvLyBSZXNldHMgYWxsIGl0ZW0gdmFyaWFibGVzIHRvIHRoZWlyIGRlZmF1bHQgdmFsdWUuXHJcbiAgXHR0aGlzLnZhcnMuY29scyAgICAgICAgPSAnMjsyJztcclxuXHR0aGlzLnZhcnMucm93cyAgICAgICAgPSAnMjsyJztcclxuXHR0aGlzLnZhcnMuc3BhY2luZyAgICAgPSAxMDtcclxuXHR0aGlzLnZhcnMuX3RoZW1lICAgICAgPSAnZ3JheSc7XHJcblx0dGhpcy52YXJzLm9ubHlfcmVuZGVyID0gJ25vJztcclxuXHR0aGlzLnZhcnMudGltZW91dCAgICAgPSAnaW5maW5pdGUnO1xyXG5cdHRoaXMudmFycy5tYXJnaW5zICAgICA9ICc1MDs1MDs1MDs1MCc7XHJcblx0dGhpcy5fdmFyaWFibGVzICAgICAgID0gW107ICAgXHJcblx0dGhpcy5fd2lkZ2V0cyAgICAgICAgID0gW107XHJcbiAgICB9OyAgICBcclxuXHJcbiAgICBwLnBhcnNlX2xpbmUgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIC8vIFNwbGl0IHRoZSBsaW5lIGluIHRva2Vucy5cclxuICAgICAgICB2YXIgbGlzdCA9IHRoaXMuc3ludGF4LnNwbGl0KHBTdHJpbmcpO1xyXG5cclxuICAgICAgICBpZiAoKHRoaXMuX2Zvcm1fdGV4dCA9PSB0cnVlKSAmJiAobGlzdFswXSAhPSAnX19lbmRfXycpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy52YXJzWydmb3JtX3RleHQnXSA9IHRoaXMudmFyc1snZm9ybV90ZXh0J10gKyBwU3RyaW5nLnJlcGxhY2UoJ1xcdCcsJycpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGZvciB3aWRnZXQgZGVmaW5pdGlvbi5cclxuICAgICAgICBpZiAobGlzdFswXSA9PSAnd2lkZ2V0JylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSB3aWRnZXQgY29tbWFuZC5cclxuICAgICAgICAgICAgbGlzdC5zaGlmdCgpO1xyXG5cclxuICAgICAgICAgICAgLy8gQWRkIHdpZGdldCB0byB0aGUgbGlzdC5cclxuICAgICAgICAgICAgdGhpcy5fd2lkZ2V0cy5wdXNoKGxpc3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChsaXN0WzBdID09ICdfX2Zvcm1fdGV4dF9fJylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudmFyc1snZm9ybV90ZXh0J10gPSAnJztcclxuICAgICAgICAgICAgdGhpcy5fZm9ybV90ZXh0ICAgICAgICA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGxpc3RbMF0gPT0gJ19fZW5kX18nKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybV90ZXh0ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8qIGlmIHUndmFyJyBpbiBrd2RpY3Q6XHJcblx0IHNlbGYuX3ZhcmlhYmxlcy5hcHBlbmQoa3dkaWN0W3UndmFyJ10pICAgKi8gIFxyXG4gICAgfTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5pdGVtX3ByZXBhcmUoKTtcclxuXHJcbiAgICAgICAgLy8gUmV0cmlldmUgdGhlIGNvbHVtbiwgcm93cyBhbmQgbWFyZ2lucy5cclxuICAgICAgICB2YXIgY29scyAgICA9IHRoaXMudmFycy5jb2xzLnNwbGl0KCc7Jyk7XHJcbiAgICAgICAgdmFyIHJvd3MgICAgPSB0aGlzLnZhcnMucm93cy5zcGxpdCgnOycpO1xyXG4gICAgICAgIHZhciBtYXJnaW5zID0gdGhpcy52YXJzLm1hcmdpbnMuc3BsaXQoJzsnKTsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gR2V0IHRoZSB0aW1lIG91dCBwYXJhbXRlci5cclxuICAgICAgICBpZiAodGhpcy52YXJzLnRpbWVvdXQgPT0gJ2luZmluaXRlJylcclxuICAgICAgICB7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgdGltZW91dCA9IG51bGw7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgeyAgICBcclxuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSB0aGlzLnZhcnMudGltZW91dDtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgYmFzaWMgZm9ybS4gICAgXHJcbiAgICAgICAgdGhpcy5mb3JtID0gbmV3IG9zd2ViLmZvcm0odGhpcy5leHBlcmltZW50LCBjb2xzLCByb3dzLCB0aGlzLnZhcnMuc3BhY2luZywgbWFyZ2lucywgdGhpcy52YXJzLl90aGVtZSwgdGhpcywgdGltZW91dCwgdGhpcy52YXJzLmZvcm1fY2xpY2tzID09ICd5ZXMnKTtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaT0wO2kgPCB0aGlzLl93aWRnZXRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5mb2N1c193aWRnZXQgPSBudWxsO1xyXG4gICAgICAgICAgICB2YXIga3dkaWN0ID0ge307XHJcbiAgICAgICAgICAgIHZhciBwYXJhbWV0ZXJzID0gW107XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnMucHVzaCh0aGlzLmZvcm0pO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fd2lkZ2V0c1tpXS5sZW5ndGggPiA1KSBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaj01O2ogPCB0aGlzLl93aWRnZXRzW2ldLmxlbmd0aDtqKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhck5hbWUgID0gU3RyaW5nKHRoaXMuX3dpZGdldHNbaV1bal0pLnN1YnN0cigwLFN0cmluZyh0aGlzLl93aWRnZXRzW2ldW2pdKS5pbmRleE9mKCc9JykpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YXJWYWx1ZSA9IFN0cmluZyh0aGlzLl93aWRnZXRzW2ldW2pdKS5zdWJzdHJpbmcoU3RyaW5nKHRoaXMuX3dpZGdldHNbaV1bal0pLmluZGV4T2YoJz0nKSArIDEsU3RyaW5nKHRoaXMuX3dpZGdldHNbaV1bal0pLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAga3dkaWN0W3Zhck5hbWVdID0gb3N3ZWIuc3ludGF4LnJlbW92ZV9xdW90ZXModmFyVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGt3ZGljdFt2YXJOYW1lXSA9IG9zd2ViLnN5bnRheC5ldmFsX3RleHQoa3dkaWN0W3Zhck5hbWVdLCB0aGlzLnZhcnMpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy5wdXNoKG9zd2ViLnN5bnRheC5yZW1vdmVfcXVvdGVzKHZhclZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvKiAjIFByb2Nlc3MgZm9jdXMga2V5d29yZFxyXG4gICAgICAgICAgICBmb2N1cyA9IEZhbHNlXHJcbiAgICAgICAgICAgIGlmIHUnZm9jdXMnIGluIGt3ZGljdDpcclxuICAgICAgICAgICAgICAgIGlmIGt3ZGljdFt1J2ZvY3VzJ10gPT0gdSd5ZXMnOlxyXG4gICAgICAgICAgICAgICAgICAgIGZvY3VzID0gVHJ1ZVxyXG4gICAgICAgICAgICAgICAgZGVsIGt3ZGljdFt1J2ZvY3VzJ10gKi9cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFBhcnNlIGFyZ3VtZW50c1xyXG4gICAgICAgICAgICB2YXIgX3R5cGUgICA9IHRoaXMuX3dpZGdldHNbaV1bNF07XHJcbiAgICAgICAgICAgIHZhciBjb2wgICAgID0gdGhpcy5fd2lkZ2V0c1tpXVswXTtcclxuICAgICAgICAgICAgdmFyIHJvdyAgICAgPSB0aGlzLl93aWRnZXRzW2ldWzFdO1xyXG4gICAgICAgICAgICB2YXIgY29sc3BhbiA9IHRoaXMuX3dpZGdldHNbaV1bMl07XHJcbiAgICAgICAgICAgIHZhciByb3dzcGFuID0gdGhpcy5fd2lkZ2V0c1tpXVszXTtcclxuXHRcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSB3aWRnZXQuXHJcbiAgICAgICAgICAgIHRyeSBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIF93ID0gb3N3ZWIubmV3V2lkZ2V0Q2xhc3MoX3R5cGUsIHRoaXMuZm9ybSwga3dkaWN0KTtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocGFyYW1ldGVycyk7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBfdyA9IG9zd2ViLm5ld1dpZGdldENsYXNzKF90eXBlLCBwYXJhbWV0ZXJzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaChlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSB3aWRnZXQgJyArIF90eXBlICsgJywgZXJyb3I6JyArIGUpO1xyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgd2lkdGggcG9zaXRpb24gYW5kIGZvcm0uICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5mb3JtLnNldF93aWRnZXQoX3csIFtjb2wsIHJvd10sIGNvbHNwYW4sIHJvd3NwYW4pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQWRkIGFzIGZvY3VzIHdpZGdldFxyXG4gICAgICAgICAgICBpZiAoZm9jdXMgPT0gdHJ1ZSkgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgXHRpZiAodGhpcy5mb2N1c193aWRnZXQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcignT3N3ZWIgZXJyb3I6IFlvdSBjYW4gb25seSBzcGVjaWZ5IG9uZSBmb2N1cyB3aWRnZXQnKTtcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c193aWRnZXQgPSBfdztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSAgICBcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5pdGVtX3J1bigpO1xyXG5cclxuICAgICAgICAvLyBTZXQgZGltZW5zaW9ucy5cclxuICAgICAgICB0aGlzLmZvcm0uX3BhcmVudGZvcm0uc3R5bGUud2lkdGggICAgICA9IG9zd2ViLnJ1bm5lci5fY2FudmFzLndpZHRoO1xyXG4gICAgICAgIHRoaXMuZm9ybS5fcGFyZW50Zm9ybS5zdHlsZS5oZWlnaHQgICAgID0gb3N3ZWIucnVubmVyLl9jYW52YXMuaGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuZm9ybS5fcGFyZW50Zm9ybS5zdHlsZS5iYWNrZ3JvdW5kID0gdGhpcy5leHBlcmltZW50LnZhcnMuYmFja2dyb3VuZDtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIC8vIEhpZGUgdGhlIGNhbnZhcywgc2hvdyB0aGUgZm9ybS5cclxuICAgICAgICBvc3dlYi5ydW5uZXIuX2NhbnZhcy5zdHlsZS5kaXNwbGF5ICA9ICdub25lJztcclxuICAgICAgICB0aGlzLmZvcm0uX3BhcmVudGZvcm0uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICAgICAgdGhpcy5mb3JtLl9mb3JtLnN0eWxlLmRpc3BsYXkgICAgICAgPSAnYmxvY2snO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEhpZGUgdGhlIGZvcm1cclxuICAgICAgICB0aGlzLmZvcm0uX3BhcmVudGZvcm0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICB0aGlzLmZvcm0uX2Zvcm0uc3R5bGUuZGlzcGxheSAgICAgICA9ICdub25lJztcclxuICAgICAgICBvc3dlYi5ydW5uZXIuX2NhbnZhcy5zdHlsZS5kaXNwbGF5ICA9ICdpbmxpbmUnO1xyXG5cclxuICAgICAgICAvLyBmb3JtIGlzIGZpbmFsaXplZC5cclxuICAgICAgICB0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG5cclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgICAgICB0aGlzLml0ZW1fY29tcGxldGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgZm9ybV9iYXNlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5mb3JtX2Jhc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZm9ybV9iYXNlLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmb3JtX2NvbnNlbnQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGZvcm1fY29uc2VudChwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuZm9ybV9iYXNlX2NvbnN0cnVjdG9yKHBOYW1lLCBwRXhwZXJpbWVudCwgcFNjcmlwdCwgJ2Zvcm1fY29uc2VudCcsICdBIHNpbXBsZSBjb25zZW50IGZvcm0nKTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhmb3JtX2NvbnNlbnQsIG9zd2ViLmZvcm1fYmFzZSk7XHJcblxyXG4gICAgLy8gRGVmaW5lIGFuZCBzZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZGVzY3JpcHRpb24gPSAnQSBzaW1wbGUgY29uc2VudCBmb3JtJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5mb3JtX2Jhc2VfcnVuKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuY29tcGxldGUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICBcdHRoaXMuZm9ybV9iYXNlX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGZvcm1fY29uc2VudCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZm9ybV9jb25zZW50ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGZvcm1fY29uc2VudCwgXCJmb3JtX2Jhc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmb3JtX211bHRpcGxlX2Nob2ljZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZm9ybV9tdWx0aXBsZV9jaG9pY2UocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLml0ZW1fY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhmb3JtX211bHRpcGxlX2Nob2ljZSwgb3N3ZWIuaXRlbSk7XHJcbiAgICBcclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0Egc2ltcGxlIG11bHRpcGxlIGNob2ljZSBpdGVtJztcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBmb3JtX2Jhc2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmZvcm1fbXVsdGlwbGVfY2hvaWNlID0gb3N3ZWIucHJvbW90ZUNsYXNzKGZvcm1fbXVsdGlwbGVfY2hvaWNlLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmb3JtX3RleHRfZGlzcGxheS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZm9ybV90ZXh0X2Rpc3BsYXkocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmZvcm1fYmFzZV9jb25zdHJ1Y3RvcihwTmFtZSwgcEV4cGVyaW1lbnQsIHBTY3JpcHQsICdmb3JtX3RleHRfZGlzcGxheScsICdBIHNpbXBsZSB0ZXh0IGRpc3BsYXkgZm9ybScpO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGZvcm1fdGV4dF9kaXNwbGF5LCBvc3dlYi5mb3JtX2Jhc2UpO1xyXG5cclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0Egc2ltcGxlIHRleHQgZGlzcGxheSBmb3JtJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5mb3JtX2Jhc2VfcnVuKCk7XHJcbiAgICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgXHR0aGlzLmZvcm1fYmFzZV9jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBmb3JtX3RleHRfZGlzcGxheSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZm9ybV90ZXh0X2Rpc3BsYXkgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZm9ybV90ZXh0X2Rpc3BsYXksIFwiZm9ybV9iYXNlXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgZm9ybV90ZXh0X2lucHV0LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBmb3JtX3RleHRfaW5wdXQocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmZvcm1fYmFzZV9jb25zdHJ1Y3RvcihwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpO1xyXG4gICAgfTsgXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGZvcm1fdGV4dF9pbnB1dCwgb3N3ZWIuZm9ybV9iYXNlKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdBIHNpbXBsZSB0ZXh0IGlucHV0IGZvcm0nO1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGZvcm1fYmFzZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZm9ybV90ZXh0X2lucHV0ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGZvcm1fdGV4dF9pbnB1dCwgXCJmb3JtX2Jhc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBmb3JtX3RleHRfcmVuZGVyLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBmb3JtX3RleHRfcmVuZGVyKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5mb3JtX2Jhc2VfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhmb3JtX3RleHRfcmVuZGVyLCBvc3dlYi5mb3JtX2Jhc2UpO1xyXG5cclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0Egc2ltcGxlIHRleHQgZGlzcGxheSBmb3JtJztcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBmb3JtX2Jhc2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmZvcm1fdGV4dF9yZW5kZXIgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZm9ybV90ZXh0X3JlbmRlciwgXCJmb3JtX2Jhc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBtZWRpYV9wbGF5ZXJfdmxjLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBtZWRpYV9wbGF5ZXJfdmxjKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5nZW5lcmljX3Jlc3BvbnNlX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICBcclxuICAgICAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHJpdmF0ZSBwcm9wZXJ0aWVzLiBcclxuICAgICAgICB0aGlzLl9zY3JpcHRfZXhlY3V0ZWQgPSBmYWxzZTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhtZWRpYV9wbGF5ZXJfdmxjLCBvc3dlYi5nZW5lcmljX3Jlc3BvbnNlKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgYW5kIHNldCB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZXNjcmlwdGlvbiA9ICdBIHZpZGVvIHBsYXllcic7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMgLSBydW4gY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnByZXBhcmUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gT3BlbnMgdGhlIHZpZGVvIGZpbGUgZm9yIHBsYXliYWNrLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvICAgICAgICA9IG9zd2ViLnBvb2xbdGhpcy52YXJzLmdldCgndmlkZW9fc3JjJyldOyAgXHJcbiAgICAgICAgdGhpcy5fdmlkZW9fcGxheWVyID0gbmV3IG9zd2ViLnZpZGVvX2JhY2tlbmQodGhpcy5leHBlcmltZW50LCB0aGlzLl92aWRlbyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBpbmxpbmUgY29kZSBvcHRpb25zLlxyXG4gICAgICAgIGlmICh0aGlzLnZhcnMuZXZlbnRfaGFuZGxlciAhPT0gJycpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl92aWRlb19wbGF5ZXIuX3NjcmlwdCA9IG9zd2ViLnBhcnNlci5fcHJlcGFyZSh0aGlzLnZhcnMuZXZlbnRfaGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5fZXZlbnRfaGFuZGxlcl9hbHdheXMgPSAodGhpcy52YXJzLmV2ZW50X2hhbmRsZXJfdHJpZ2dlciA9PSAnYWZ0ZXIgZXZlcnkgZnJhbWUnKTtcclxuXHRcdFxyXG4gICAgICAgIC8vIFNldCB0aGUgYXVkaW8gb3B0aW9uLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5hdWRpbyA9ICh0aGlzLnZhcnMuZ2V0KCdwbGF5YXVkaW8nKSA9PSAneWVzJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBmdWxsIHNjcmVlbiBvcHRpb24gKGlmIGVuYWJsZWQpLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5mdWxsX3NjcmVlbiA9ICh0aGlzLnZhcnMuZ2V0KCdyZXNpemVWaWRlbycpID09ICd5ZXMnKTtcclxuXHRcclxuICAgICAgXHQvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmdlbmVyaWNfcmVzcG9uc2VfcHJlcGFyZSgpO1xyXG4gICAgfTsgICAgXHJcbiAgICBcclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIG9uc2V0IHRpbWUuXHJcbiAgICAgICAgdGhpcy5zZXRfaXRlbV9vbnNldCgpO1xyXG5cdHRoaXMuc2V0X3NyaSgpO1xyXG5cclxuICAgICAgICAvLyBTdGFydCB0aGUgdmlkZW8gcGxheWVyLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5wbGF5KCk7ICAgIFxyXG5cclxuICAgICAgICAvLyBTdGFydCByZXNwb25zZSBwcm9jZXNzaW5nLlxyXG4gICAgICAgIHRoaXMucHJvY2Vzc19yZXNwb25zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICBpZiAodGhpcy5fc2NyaXB0X2V4ZWN1dGVkID09IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gU3RvcCB0aGUgdmlkZW8gcGxheWluZy4gIFxyXG4gICAgICAgICAgICB0aGlzLl92aWRlb19wbGF5ZXIuc3RvcCgpO1xyXG5cdFxyXG4gICAgICAgICAgICAvLyBleGVjdXRlIHNjcmlwdC5cclxuICAgICAgICAgICAgaWYgKCh0aGlzLl92aWRlb19wbGF5ZXIuX3NjcmlwdCAhPT0gbnVsbCkgJiYgKHRoaXMudmFycy5nZXQoJ2V2ZW50X2hhbmRsZXJfdHJpZ2dlcicpID09ICdvbiBrZXlwcmVzcycpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGV4ZWN1dGUgdG9nZ2xlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2NyaXB0X2V4ZWN1dGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBzY3JpcHQgY29kZS5cclxuICAgICAgICAgICAgICAgIG9zd2ViLnBhcnNlci5fcnVuKHRoaXMsIHRoaXMuX3ZpZGVvX3BsYXllci5fc2NyaXB0KTtcclxuICAgICAgICAgICAgfSAgIFxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHsgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJpY19yZXNwb25zZV9jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgICAgICAgICB0aGlzLmdlbmVyaWNfcmVzcG9uc2VfY29tcGxldGUoKTtcclxuICAgICAgICB9OyAgICBcclxuICAgIH07ICAgIFxyXG5cclxuICAgIHAudXBkYXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgdmlkZW8gY2FudmFzLlxyXG4gICAgICAgIHRoaXMuX3ZpZGVvX3BsYXllci5fdXBkYXRlX3ZpZGVvX2NhbnZhcygpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgbWVkaWFfcGxheWVyX3ZsYyBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIubWVkaWFfcGxheWVyX3ZsYyA9IG9zd2ViLnByb21vdGVDbGFzcyhtZWRpYV9wbGF5ZXJfdmxjLCBcImdlbmVyaWNfcmVzcG9uc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBub3RlcGFkLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBub3RlcGFkKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5pdGVtX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3Mobm90ZXBhZCwgb3N3ZWIuaXRlbSk7XHJcblxyXG4gICAgLy8gRGVmaW5lIGFuZCBzZXQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZGVzY3JpcHRpb24gPSAnQSBzaW1wbGUgbm90ZXBhZCB0byBkb2N1bWVudCB5b3VyIGV4cGVyaW1lbnQuIFRoaXMgcGx1Zy1pbiBkb2VzIG5vdGhpbmcuJztcclxuICAgIHAubm90ZSAgICAgICAgPSAnJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucnVuID0gZnVuY3Rpb24oKSBcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5pdGVtX3J1bigpO1xyXG5cclxuXHQvLyBTaG93IHRoZSBpbmZvcm1hdGlvbiBvZiB0aGUgbm90ZXBhZCBvbiB0aGUgY29uc29sZS5cclxuXHQvL29zd2ViLmRlYnVnLmFkZE1lc3NhZ2UodGhpcy5ub3RlKTtcclxuXHJcbiAgICAgICAgLy8gQ29tcGxldGUgdGhlIGN1cnJlbnQgY3ljbGUuXHJcbiAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIHNlcXVlbmNlIGlzIGZpbmFsaXplZC5cclxuICAgICAgICB0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5pdGVtX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIG5vdGVwYWQgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLm5vdGVwYWQgPSBvc3dlYi5wcm9tb3RlQ2xhc3Mobm90ZXBhZCwgXCJpdGVtXCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgcmVwZWF0X2N5Y2xlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiByZXBlYXRfY3ljbGUocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5pdGVtX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MocmVwZWF0X2N5Y2xlLCBvc3dlYi5pdGVtKTtcclxuXHJcbiAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ09wdGlvbmFsbHkgcmVwZWF0IGEgY3ljbGUgZnJvbSBhIGxvb3AnO1xyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcyAtIHJ1biBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBQcmVwYXJlIHRoZSBjb25kdGlvbiBmb3Igd2hpY2ggdGhlIHJlcGVhdF9jeWNsZSBtdXN0IGZpcmUuXHJcbiAgICAgICAgdGhpcy5fY29uZGl0aW9uID0gb3N3ZWIuc3ludGF4LmNvbXBpbGVfY29uZCh0aGlzLnZhcnMuZ2V0KCdjb25kaXRpb24nKSk7XHJcblxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9wcmVwYXJlKCk7XHJcbiAgICB9OyBcclxuXHJcbiAgICBwLnJ1biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgIFx0Ly8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5pdGVtX3J1bigpO1xyXG5cdFx0XHJcblx0Ly8gUnVuIGl0ZW0gb25seSBvbmUgdGltZS4gICBcclxuXHRpZiAodGhpcy5fc3RhdHVzICE9IG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfRklOQUxJWkUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAob3N3ZWIucHl0aG9uX3dvcmtzcGFjZS5fZXZhbCh0aGlzLl9jb25kaXRpb24pID09IHRydWUpIFxyXG4gICAgICAgICAgICB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5yZXBlYXRfY3ljbGUgPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBDb21wbGV0ZSB0aGUgY3VycmVudCBjeWNsZS5cclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcC5jb21wbGV0ZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBzZXF1ZW5jZSBpcyBmaW5hbGl6ZWQuXHJcbiAgICAgICAgdGhpcy5fc3RhdHVzID0gb3N3ZWIuY29uc3RhbnRzLlNUQVRVU19GSU5BTElaRTtcclxuIFxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG4gICAgICAgIHRoaXMuaXRlbV9jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgcmVwZWF0X2N5Y2xlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5yZXBlYXRfY3ljbGUgPSBvc3dlYi5wcm9tb3RlQ2xhc3MocmVwZWF0X2N5Y2xlLCBcIml0ZW1cIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyByZXNldF9mZWVkYmFjay5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gcmVzZXRfZmVlZGJhY2socEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5pdGVtX2NvbnN0cnVjdG9yKHBFeHBlcmltZW50LCBwTmFtZSwgcFNjcmlwdCk7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MocmVzZXRfZmVlZGJhY2ssIG9zd2ViLml0ZW0pO1xyXG5cclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ1Jlc2V0cyB0aGUgZmVlZGJhY2sgdmFyaWFibGVzLCBzdWNoIGFzIFwiYXZnX3J0XCIgYW5kIFwiYWNjXCInO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzIC0gcnVuIGN5Y2xlLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5ydW4gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICBcdC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuaXRlbV9ydW4oKTtcclxuXHRcdFxyXG5cdC8vIFJ1biBpdGVtIG9ubHkgb25lIHRpbWUuICAgXHJcblx0aWYgKHRoaXMuX3N0YXR1cyAhPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFKVxyXG5cdHtcclxuICAgICAgICAgICAgLy8gUnVuIHRoZSBpdGVtLlxyXG4gICAgICAgICAgICB0aGlzLmV4cGVyaW1lbnQucmVzZXRfZmVlZGJhY2soKTtcclxuXHJcbiAgICAgICAgICAgIC8vIENvbXBsZXRlIHRoZSBjdXJyZW50IGN5Y2xlLlxyXG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBwLmNvbXBsZXRlID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIHNlcXVlbmNlIGlzIGZpbmFsaXplZC5cclxuICAgICAgICB0aGlzLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gXHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICAgICAgdGhpcy5pdGVtX2NvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSByZXNldF9mZWVkYmFjayBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIucmVzZXRfZmVlZGJhY2sgPSBvc3dlYi5wcm9tb3RlQ2xhc3MocmVzZXRfZmVlZGJhY2ssIFwiaXRlbVwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHRvdWNoX3Jlc3BvbnNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiB0b3VjaF9yZXNwb25zZShwRXhwZXJpbWVudCwgcE5hbWUsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMubW91c2VfcmVzcG9uc2VfY29uc3RydWN0b3IocEV4cGVyaW1lbnQsIHBOYW1lLCBwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyh0b3VjaF9yZXNwb25zZSwgb3N3ZWIubW91c2VfcmVzcG9uc2UpO1xyXG5cclxuICAgIC8vIERlZmluZSBhbmQgc2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy4gXHJcbiAgICBwLmRlc2NyaXB0aW9uID0gJ0EgZ3JpZC1iYXNlZCByZXNwb25zZSBpdGVtLCBjb252ZW5pZW50IGZvciB0b3VjaCBzY3JlZW5zJztcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLlxyXG4gICAgICovXHJcblx0XHJcbiAgICBwLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cclxuICAgICAgICB0aGlzLm1vdXNlX3Jlc3BvbnNlX3Jlc2V0KCk7XHJcbiAgICAgICAgdGhpcy52YXJzLnNldCgnYWxsb3dlZF9yZXNwb25zZXMnLG51bGwpO1xyXG5cdFxyXG4gICAgICAgIC8vIFJlc2V0cyBhbGwgaXRlbSB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZS5cclxuICAgICAgICB0aGlzLnZhcnMuX25jb2wgPSAyO1xyXG5cdHRoaXMudmFycy5fbnJvdyA9IDE7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLlxyXG4gICAgICovXHJcbiAgICBcclxuICAgIHAucHJlcGFyZSA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBUZW1wIGhhY2tcclxuICAgICAgICB0aGlzLmV4cGVyaW1lbnQudmFycy5jb3JyZWN0ID0gLTE7XHJcbiAgIFxyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cclxuICAgICAgICB0aGlzLm1vdXNlX3Jlc3BvbnNlX3ByZXBhcmUoKTtcclxuICAgIH07XHJcbiAgICAgICAgXHJcbiAgICBwLnByb2Nlc3NfcmVzcG9uc2VfbW91c2VjbGljayA9IGZ1bmN0aW9uKHBSZXR2YWwpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gUHJvY2Vzc2VzIGEgbW91c2VjbGljayByZXNwb25zZS5cclxuXHR0aGlzLmV4cGVyaW1lbnQuX3N0YXJ0X3Jlc3BvbnNlX2ludGVydmFsID0gdGhpcy5zcmk7XHJcblx0dGhpcy5leHBlcmltZW50Ll9lbmRfcmVzcG9uc2VfaW50ZXJ2YWwgICA9IHBSZXR2YWwucnRUaW1lO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLnJlc3BvbnNlXHRcdCA9IHBSZXR2YWwucmVzcDtcclxuXHR0aGlzLnN5bm9ueW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gdGhpcy5fbW91c2Uuc3lub255bXModGhpcy5leHBlcmltZW50LnZhcnMucmVzcG9uc2UpO1xyXG5cdHRoaXMuZXhwZXJpbWVudC52YXJzLmN1cnNvcl94ICAgICAgICAgICAgPSBwUmV0dmFsLmV2ZW50LmNsaWVudFg7XHJcblx0dGhpcy5leHBlcmltZW50LnZhcnMuY3Vyc29yX3kgICAgICAgICAgICA9IHBSZXR2YWwuZXZlbnQuY2xpZW50WTtcclxuXHRcclxuICAgICAgICB2YXIgcmVjdCA9IG9zd2ViLnJ1bm5lci5fY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmV4cGVyaW1lbnQudmFycy51bmlmb3JtX2Nvb3JkaW5hdGVzID09ICd5ZXMnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5feCA9IHBSZXR2YWwuZXZlbnQuY2xpZW50WCArICh0aGlzLmV4cGVyaW1lbnQudmFycy53aWR0aCAvIDIpO1xyXG5cdCAgICB0aGlzLl95ID0gcFJldHZhbC5ldmVudC5jbGllbnRZICsgKHRoaXMuZXhwZXJpbWVudC52YXJzLmhlaWdodCAvIDIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLl94ID0gcFJldHZhbC5ldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0O1xyXG5cdCAgICB0aGlzLl95ID0gcFJldHZhbC5ldmVudC5jbGllbnRZIC0gcmVjdC50b3A7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBDYWx1bGF0ZSB0aGUgcm93LCBjb2x1bW4gYW5kIGNlbGwuIFxyXG4gICAgICAgIHRoaXMuY29sICA9IE1hdGguZmxvb3IodGhpcy5feCAvICh0aGlzLmV4cGVyaW1lbnQudmFycy53aWR0aCAgLyB0aGlzLnZhcnMuX25jb2wpKTtcclxuXHR0aGlzLnJvdyAgPSBNYXRoLmZsb29yKHRoaXMuX3kgLyAodGhpcy5leHBlcmltZW50LnZhcnMuaGVpZ2h0IC8gdGhpcy52YXJzLl9ucm93KSk7XHJcblx0dGhpcy5jZWxsID0gdGhpcy5yb3cgKiB0aGlzLnZhcnMuX25jb2wgKyB0aGlzLmNvbCArIDE7XHJcbiAgICAgICAgdGhpcy5leHBlcmltZW50LnZhcnMucmVzcG9uc2UgPSB0aGlzLmNlbGw7XHJcbiAgICAgICAgdGhpcy5zeW5vbnltcyAgICAgICAgICAgICAgICAgPSBbU3RyaW5nKHRoaXMuZXhwZXJpbWVudC52YXJzLnJlc3BvbnNlKV07XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAvLyBEbyB0aGUgYm9va2tlZXBpbmcgXHJcbiAgICAgICAgdGhpcy5yZXNwb25zZV9ib29ra2VlcGluZygpO1xyXG4gICAgfTsgICAgICAgICAgICBcclxuXHJcbiAgICAvLyBCaW5kIHRoZSB0b3VjaF9yZXNwb25zZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIudG91Y2hfcmVzcG9uc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3ModG91Y2hfcmVzcG9uc2UsIFwibW91c2VfcmVzcG9uc2VcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBiYXNlX2VsZW1lbnQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGJhc2VfZWxlbWVudChwU2tldGNocGFkLCBwU2NyaXB0LCBwRGVmYXVsdHMpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBwdWJsaWMgcHJvcGVydGllcy5cdFx0XHJcblx0dGhpcy5jYW52YXMgICAgICAgICAgID0gcFNrZXRjaHBhZC5jYW52YXM7XHJcblx0dGhpcy5kZWZhdWx0cyAgICAgICAgID0gcERlZmF1bHRzO1xyXG5cdHRoaXMuZGVmYXVsdHMuc2hvd19pZiA9ICdhbHdheXMnO1xyXG5cdHRoaXMuZGVmYXVsdHMuel9pbmRleCA9IDA7XHJcbiAgICAgICAgdGhpcy5leHBlcmltZW50ICAgICAgID0gcFNrZXRjaHBhZC5leHBlcmltZW50O1xyXG5cdHRoaXMuZml4X2Nvb3JkaW5hdGVzICA9IChwU2tldGNocGFkLnZhcnMudW5pZm9ybV9jb29yZGluYXRlcyA9PSAneWVzJyk7XHJcblx0dGhpcy5uYW1lICAgICAgICAgICAgID0gcFNrZXRjaHBhZC5uYW1lO1xyXG5cdHRoaXMub25seV9rZXl3b3JkcyAgICA9IGZhbHNlO1xyXG5cdHRoaXMucG9vbCAgICAgICAgICAgICA9IHBTa2V0Y2hwYWQuZXhwZXJpbWVudC5wb29sO1xyXG5cdHRoaXMuc2tldGNocGFkICAgICAgICA9IHBTa2V0Y2hwYWQ7XHJcblx0dGhpcy5zeW50YXggICAgICAgICAgID0gcFNrZXRjaHBhZC5zeW50YXg7XHJcblx0dGhpcy52YXJzICAgICAgICAgICAgID0gcFNrZXRjaHBhZC52YXJzO1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIHByaXZhdGUgcHJvcGVydGllcy5cdFx0XHJcbiAgICAgICAgdGhpcy5fcHJvcGVydGllcyAgICAgID0gbnVsbDsgICBcclxuXHJcbiAgICAgICAgLy8gUmVhZCB0aGUgZGVmaW5pdGlvbiBzdHJpbmcuXHJcblx0dGhpcy5mcm9tX3N0cmluZyhwU2NyaXB0KTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBiYXNlX2VsZW1lbnQucHJvdG90eXBlO1xyXG5cclxuICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5kZWZhdWx0cyAgICAgICAgPSB7fTtcclxuICAgIHAuZml4X2Nvb3JkaW5hdGVzID0gdHJ1ZTtcclxuICAgIHAub25seV9rZXl3b3JkcyAgID0gZmFsc2U7XHJcbiAgICBwLnByb3BlcnRpZXMgICAgICA9IHt9O1xyXG4gICAgcC5za2V0Y2hwYWQgICAgICAgPSBudWxsO1x0XHJcbiAgICBwLnZhcnMgICAgICAgICAgICA9IG51bGw7XHJcblx0ICAgICAgICBcdFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBidWlsZGluZyBjeWNsZS4gICAgICAgICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZnJvbV9zdHJpbmcgPSBmdW5jdGlvbihwU3RyaW5nKVxyXG4gICAge1xyXG5cdHZhciB0b2tlbnMgPSBvc3dlYi5zeW50YXgucGFyc2VfY21kKHBTdHJpbmcpO1xyXG5cdFxyXG5cdC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMucHJvcGVydGllcyA9IHt9O1xyXG5cdFx0XHRcclxuXHQvLyBTZXQgdGhlIGRlZmluZSBwcm9wZXJ0aWVzLlxyXG5cdGZvciAodmFyIGk9MDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKylcclxuXHR7XHJcbiAgICAgICAgICAgIHZhciBuYW1lICA9IHRva2Vuc1tpXS5zbGljZSgwLHRva2Vuc1tpXS5pbmRleE9mKCc9JykpO1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSB0b2tlbnNbaV0uc2xpY2UodG9rZW5zW2ldLmluZGV4T2YoJz0nKSArIDEsdG9rZW5zW2ldLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG9zd2ViLnN5bnRheC5yZW1vdmVfcXVvdGVzKHZhbHVlKTtcclxuXHRcdFx0XHJcbiAgICAgICAgICAgIC8vIFNldCAoYW5kIG92ZXJ3cml0ZSkgdGhlIHByb3BlcnRpZXMuXHJcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllc1tuYW1lXSA9IHZhbHVlO1xyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW5uaW5nIGN5Y2xlLiAgICAgICAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC56X2luZGV4ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgXHQvLyAgRGV0ZXJtaW5lcyB0aGUgZHJhd2luZyBvcmRlciBvZiB0aGUgZWxlbWVudHMuIFxyXG4gICAgXHRyZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLnpfaW5kZXg7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZXZhbF9wcm9wZXJ0aWVzID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG5cdC8vIEV2YWx1YXRlcyBhbGwgcHJvcGVydGllcyBhbmQgcmV0dXJuIHRoZW0uXHJcblx0dGhpcy5fcHJvcGVydGllcyA9IHt9O1xyXG5cdFx0XHJcblx0dmFyIHhjID0gdGhpcy5leHBlcmltZW50LnZhcnMud2lkdGggLyAyO1xyXG5cdHZhciB5YyA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmhlaWdodCAvIDI7XHJcblxyXG4gICAgXHRmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzLnByb3BlcnRpZXMpIFxyXG5cdHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5za2V0Y2hwYWQuc3ludGF4LmV2YWxfdGV4dCh0aGlzLnByb3BlcnRpZXNbcHJvcGVydHldKTtcclxuICAgICAgICAgICAgLyogaWYgdmFyID09IHUndGV4dCc6XHJcblx0XHRcdHJvdW5kX2Zsb2F0ID0gVHJ1ZVxyXG4gICAgICAgICAgICAgICAgZWxzZTpcclxuXHRcdFx0cm91bmRfZmxvYXQgPSBGYWxzZVxyXG5cdFx0dmFsID0gc2VsZi5za2V0Y2hwYWQuc3ludGF4LmF1dG9fdHlwZShcclxuXHRcdFx0c2VsZi5za2V0Y2hwYWQuc3ludGF4LmV2YWxfdGV4dCh2YWwsIHJvdW5kX2Zsb2F0PXJvdW5kX2Zsb2F0KSlcclxuXHRcdGlmIHNlbGYuZml4X2Nvb3JkaW5hdGVzIGFuZCB0eXBlKHZhbCkgaW4gKGludCwgZmxvYXQpOiAqL1xyXG4gICAgICAgICAgICBpZiAoKHByb3BlcnR5ICA9PSAneCcpIHx8IChwcm9wZXJ0eSAgPT0gJ3gxJykgfHwgKHByb3BlcnR5ICA9PSAneDInKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICBcdHZhbHVlID0gTnVtYmVyKHZhbHVlKSArIHhjO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAoKHByb3BlcnR5ICA9PSAneScpIHx8IChwcm9wZXJ0eSAgPT0gJ3kxJykgfHwgKHByb3BlcnR5ICA9PSAneTInKSlcclxuICAgICAgICAgICAge1xyXG5cdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpICsgeWM7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzW3Byb3BlcnR5XSA9IHZhbHVlOyBcclxuXHR9XHJcbiAgICB9O1x0XHRcclxuXHRcdFxyXG4gICAgcC5pc19zaG93biA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIHNlbGYgb2YgdGhlIGN1cnJlbnQgd29ya3NwYWNlLlxyXG4gICAgICAgIHRoaXMuZXhwZXJpbWVudC5weXRob25fd29ya3NwYWNlWydzZWxmJ10gPSB0aGlzLnNrZXRjaHBhZDtcclxuICAgICAgICBcclxuICAgICAgICAvLyBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIHNob3duLCBiYXNlZCBvbiB0aGUgc2hvdy1pZiBzdGF0ZW1lbnQuXHJcblx0cmV0dXJuIHRoaXMuZXhwZXJpbWVudC5weXRob25fd29ya3NwYWNlLl9ldmFsKHRoaXMuZXhwZXJpbWVudC5zeW50YXguY29tcGlsZV9jb25kKHRoaXMucHJvcGVydGllc1snc2hvd19pZiddKSk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcC5kcmF3ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZHluYW1pYyBwcm9wZXJ0aWVzLlxyXG4gICAgICAgIHRoaXMuZXZhbF9wcm9wZXJ0aWVzKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJpbmQgdGhlIGJhc2VfZWxlbWVudCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuYmFzZV9lbGVtZW50ID0gYmFzZV9lbGVtZW50O1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgYXJyb3cuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGFycm93KHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBkZWZhdWx0IHByb3BlcnRpZXMuXHJcblx0dGhpcy5kZWZhdWx0c1x0XHQgICAgICAgID0ge307XHJcblx0dGhpcy5kZWZhdWx0cy5hcnJvd19ib2R5X2xlbmd0aCA9IDAuODtcclxuXHR0aGlzLmRlZmF1bHRzLmFycm93X2JvZHlfd2lkdGggID0gMC41O1xyXG5cdHRoaXMuZGVmYXVsdHMuYXJyb3dfaGVhZF93aWR0aCAgPSAzMDtcclxuXHR0aGlzLmRlZmF1bHRzLmZpbGwgICAgIFx0XHQ9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy5jb2xvciAgICBcdFx0PSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb3JlZ3JvdW5kJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5wZW53aWR0aCBcdFx0PSAxO1xyXG5cdHRoaXMuZGVmYXVsdHMueDEgICAgICAgXHRcdD0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnkxICAgICAgIFx0XHQ9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy54MiAgICAgICAgICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy55MiAgICAgICBcdFx0PSBudWxsO1xyXG5cclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhhcnJvdywgb3N3ZWIuYmFzZV9lbGVtZW50KTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS4gICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmJhc2VfZWxlbWVudF9kcmF3KCk7XHJcblx0XHRcclxuXHQvLyBEcmF3IHRoZSBhcnJvdyBlbGVtZW50IHRvIHRoZSBjYW52YXMgb2YgdGhlIHNrZXRjaHBhZC5cclxuXHR0aGlzLnNrZXRjaHBhZC5jYW52YXMuYXJyb3codGhpcy5fcHJvcGVydGllcy54MSwgdGhpcy5fcHJvcGVydGllcy55MSwgdGhpcy5fcHJvcGVydGllcy54MiwgdGhpcy5fcHJvcGVydGllcy55MiwgdGhpcy5fcHJvcGVydGllcy5jb2xvciwgdGhpcy5fcHJvcGVydGllcy5wZW53aWR0aCwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnRpZXMuYXJyb3dfaGVhZF93aWR0aCwgdGhpcy5fcHJvcGVydGllcy5hcnJvd19ib2R5X3dpZHRoLCB0aGlzLl9wcm9wZXJ0aWVzLmFycm93X2JvZHlfbGVuZ3RoLCB0aGlzLl9wcm9wZXJ0aWVzLmZpbGwpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgQXJyb3cgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmFycm93ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGFycm93LCBcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGNpcmNsZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gY2lyY2xlKHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBkZWZhdWx0IHByb3BlcnRpZXMuXHJcblx0dGhpcy5kZWZhdWx0cyAgICAgICAgICA9IHt9O1xyXG5cdHRoaXMuZGVmYXVsdHMuY29sb3IgICAgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb3JlZ3JvdW5kJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5maWxsICAgICA9IDA7XHJcblx0dGhpcy5kZWZhdWx0cy5wZW53aWR0aCA9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy55ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy5yICAgICAgICA9IG51bGw7XHJcblx0XHRcclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhjaXJjbGUsIG9zd2ViLmJhc2VfZWxlbWVudCk7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW4gY3ljbGUuICAgXHJcbiAgICAgKi9cclxuXHRcclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmJhc2VfZWxlbWVudF9kcmF3KCk7XHJcblx0XHRcclxuXHQvLyBEcmF3IHRoZSBjaXJjbGUgZWxlbWVudCB0byB0aGUgY2FudmFzIG9mIHRoZSBza2V0Y2hwYWQuXHJcblx0dGhpcy5za2V0Y2hwYWQuY2FudmFzLmNpcmNsZSh0aGlzLl9wcm9wZXJ0aWVzLngsIHRoaXMuX3Byb3BlcnRpZXMueSwgdGhpcy5fcHJvcGVydGllcy5yLCB0aGlzLl9wcm9wZXJ0aWVzLmZpbGwsIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IsIHRoaXMuX3Byb3BlcnRpZXMucGVud2lkdGgpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgQ2lyY2xlIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5jaXJjbGUgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoY2lyY2xlLFwiYmFzZV9lbGVtZW50XCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgZWxsaXBzZS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZWxsaXBzZShwU2tldGNocGFkLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZGVmYXVsdHMgICAgICAgICAgPSB7fTtcclxuXHR0aGlzLmRlZmF1bHRzLmZpbGwgICAgID0gMTtcclxuXHR0aGlzLmRlZmF1bHRzLmNvbG9yICAgID0gcFNrZXRjaHBhZC52YXJzLmdldCgnZm9yZWdyb3VuZCcpO1xyXG5cdHRoaXMuZGVmYXVsdHMucGVud2lkdGggPSAxO1xyXG5cdHRoaXMuZGVmYXVsdHMueCAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMudyAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMuaCAgICAgICAgPSBudWxsO1xyXG5cclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhlbGxpcHNlLCBvc3dlYi5iYXNlX2VsZW1lbnQpO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLiAgIFxyXG4gICAgICovXHJcblx0XHJcbiAgICBwLmRyYXcgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfZHJhdygpO1xyXG5cdFx0XHJcblx0Ly8gRHJhdyB0aGUgZWxsaXBzZSBlbGVtZW50IHRvIHRoZSBjYW52YXMgb2YgdGhlIHNrZXRjaHBhZC5cclxuICAgICAgICB0aGlzLnNrZXRjaHBhZC5jYW52YXMuZWxsaXBzZShOdW1iZXIodGhpcy5fcHJvcGVydGllcy54KSwgTnVtYmVyKHRoaXMuX3Byb3BlcnRpZXMueSksIE51bWJlcih0aGlzLl9wcm9wZXJ0aWVzLncpLCBOdW1iZXIodGhpcy5fcHJvcGVydGllcy5oKSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllcy5maWxsLCB0aGlzLl9wcm9wZXJ0aWVzLmNvbG9yLCB0aGlzLl9wcm9wZXJ0aWVzLnBlbndpZHRoKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIEJpbmQgdGhlIGVsbGlwc2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmVsbGlwc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3MoZWxsaXBzZSxcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGZpeGRvdC5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gZml4ZG90KHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBkZWZhdWx0IHByb3BlcnRpZXMuXHJcblx0dGhpcy5kZWZhdWx0cyAgICAgICAgICA9IHt9O1xyXG5cdHRoaXMuZGVmYXVsdHMuY29sb3IgICAgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb3JlZ3JvdW5kJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5zdHlsZSAgICA9ICdkZWZhdWx0JztcclxuXHR0aGlzLmRlZmF1bHRzLnggICAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnkgICAgICAgID0gbnVsbDtcclxuXHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2NvbnN0cnVjdG9yKHBTa2V0Y2hwYWQsIHBTY3JpcHQsIHRoaXMuZGVmYXVsdHMpO1xyXG4gICAgfSBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoZml4ZG90LCBvc3dlYi5iYXNlX2VsZW1lbnQpO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBjeWNsZS4gICAgICAgICBcclxuICAgICAqL1xyXG5cdFxyXG4gICAgcC5kcmF3ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2RyYXcoKTtcclxuXHRcdFxyXG5cdC8vIERyYXcgdGhlIGZpeGRvdCBlbGVtZW50IHRvIHRoZSBjYW52YXMgb2YgdGhlIHNrZXRjaHBhZC5cclxuXHR0aGlzLnNrZXRjaHBhZC5jYW52YXMuZml4ZG90KHRoaXMuX3Byb3BlcnRpZXMueCwgdGhpcy5fcHJvcGVydGllcy55LCB0aGlzLl9wcm9wZXJ0aWVzLmNvbG9yLCB0aGlzLl9wcm9wZXJ0aWVzLnN0eWxlKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIEJpbmQgdGhlIGZpeGRvdCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuZml4ZG90ID0gb3N3ZWIucHJvbW90ZUNsYXNzKGZpeGRvdCxcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGdhYm9yLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBnYWJvcihwU2tldGNocGFkLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZGVmYXVsdHMgICAgICAgID0ge307XHJcblx0dGhpcy5kZWZhdWx0cy5iZ21vZGUgPSAnYXZnJztcclxuXHR0aGlzLmRlZmF1bHRzLmNvbG9yMSA9ICd3aGl0ZSc7XHJcblx0dGhpcy5kZWZhdWx0cy5jb2xvcjIgPSAnYmxhY2snO1xyXG5cdHRoaXMuZGVmYXVsdHMuZW52ICAgID0gJ2dhdXNzaWFuJztcclxuXHR0aGlzLmRlZmF1bHRzLmZyZXEgICA9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy5vcmllbnQgPSAwO1xyXG5cdHRoaXMuZGVmYXVsdHMucGhhc2UgID0gMDtcclxuXHR0aGlzLmRlZmF1bHRzLnNpemUgICA9IDk2O1xyXG5cdHRoaXMuZGVmYXVsdHMuc3RkZXYgID0gMTI7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgID0gbnVsbDtcclxuXHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2NvbnN0cnVjdG9yKHBTa2V0Y2hwYWQsIHBTY3JpcHQsIHRoaXMuZGVmYXVsdHMpO1xyXG4gICAgfSBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoZ2Fib3IsIG9zd2ViLmJhc2VfZWxlbWVudCk7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgKHJ1biBjeWNsZSkuICAgXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLmRyYXcgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5oZXJpdGVkLlx0XHJcbiAgICBcdHRoaXMuYmFzZV9lbGVtZW50X2RyYXcoKTtcclxuXHRcdFxyXG5cdC8vIERyYXcgdGhlIGdhYm9yIGVsZW1lbnQgdG8gdGhlIGNhbnZhcyBvZiB0aGUgc2tldGNocGFkLlxyXG5cdHRoaXMuc2tldGNocGFkLmNhbnZhcy5nYWJvcih0aGlzLl9wcm9wZXJ0aWVzLngsIHRoaXMuX3Byb3BlcnRpZXMueSwgdGhpcy5fcHJvcGVydGllcy5vcmllbnQsIHRoaXMuX3Byb3BlcnRpZXMuZnJlcSwgdGhpcy5fcHJvcGVydGllcy5lbnYsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzLnNpemUsIHRoaXMuX3Byb3BlcnRpZXMuc3RkZXYsIHRoaXMuX3Byb3BlcnRpZXMucGhhc2UsIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IxLCB0aGlzLl9wcm9wZXJ0aWVzLmNvbG9yMiwgdGhpcy5fcHJvcGVydGllcy5iZ21vZGUpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgZ2Fib3IgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmdhYm9yID0gb3N3ZWIucHJvbW90ZUNsYXNzKGdhYm9yLFwiYmFzZV9lbGVtZW50XCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgaW1hZ2UuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGltYWdlKHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBjbGFzcyBwdWJsaWMgcHJvcGVydGllcy5cclxuXHR0aGlzLmRlZmF1bHRzXHQgICAgID0ge307XHJcblx0dGhpcy5kZWZhdWx0cy5jZW50ZXIgPSAxO1xyXG5cdHRoaXMuZGVmYXVsdHMuZmlsZSAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnNjYWxlICA9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgID0gbnVsbDtcclxuXHJcblx0Ly8gU2V0IHRoZSBjbGFzcyBwcml2YXRlIHByb3BlcnRpZXMuIFxyXG5cdHRoaXMuX2ZpbGUgICAgICAgICAgID0gbnVsbDtcclxuXHRcdFxyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmJhc2VfZWxlbWVudF9jb25zdHJ1Y3RvcihwU2tldGNocGFkLCBwU2NyaXB0LCB0aGlzLmRlZmF1bHRzKTtcclxuICAgIH0gXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGltYWdlLCBvc3dlYi5iYXNlX2VsZW1lbnQpO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLiAgIFxyXG4gICAgICovXHJcblxyXG4gICAgcC5kcmF3ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaGVyaXRlZC5cdFxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2RyYXcoKTtcclxuXHJcbiAgICBcdC8vIFJldHJpZXZlIHRoZSBjb250ZW50IGZyb20gdGhlIGZpbGUgcG9vbC5cclxuXHR0aGlzLl9maWxlID0gb3N3ZWIucG9vbFt0aGlzLl9wcm9wZXJ0aWVzWydmaWxlJ11dOyAgXHJcblxyXG5cdC8vIERyYXcgdGhlIGltYWdlIGVsZW1lbnQgdG8gdGhlIGNhbnZhcyBvZiB0aGUgc2tldGNocGFkLlxyXG5cdHRoaXMuc2tldGNocGFkLmNhbnZhcy5pbWFnZSh0aGlzLl9maWxlLCB0aGlzLl9wcm9wZXJ0aWVzLmNlbnRlciwgdGhpcy5fcHJvcGVydGllcy54LCB0aGlzLl9wcm9wZXJ0aWVzLnksIHRoaXMuX3Byb3BlcnRpZXMuc2NhbGUpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQmluZCB0aGUgaW1hZ2UgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmltYWdlID0gb3N3ZWIucHJvbW90ZUNsYXNzKGltYWdlLCBcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGxpbmUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGxpbmUocFNrZXRjaHBhZCwgcFNjcmlwdClcclxuICAgIHtcclxuXHQvLyBTZXQgdGhlIGRlZmF1bHQgcHJvcGVydGllcy5cclxuXHR0aGlzLmRlZmF1bHRzICAgICAgICAgID0ge307XHJcblx0dGhpcy5kZWZhdWx0cy5jb2xvciAgICA9IHBTa2V0Y2hwYWQudmFycy5nZXQoJ2ZvcmVncm91bmQnKTtcclxuXHR0aGlzLmRlZmF1bHRzLnBlbndpZHRoID0gMTtcclxuXHR0aGlzLmRlZmF1bHRzLngxICAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnkxICAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLngyICAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLnkyICAgICAgID0gbnVsbDtcclxuXHJcblx0Ly8gSW5oZXJpdGVkLlxyXG5cdHRoaXMuYmFzZV9lbGVtZW50X2NvbnN0cnVjdG9yKHBTa2V0Y2hwYWQsIHBTY3JpcHQsIHRoaXMuZGVmYXVsdHMpO1xyXG4gICAgfSBcclxuXHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKGxpbmUsIG9zd2ViLmJhc2VfZWxlbWVudCk7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBydW4gY3ljbGUuICAgXHJcbiAgICAgKi9cclxuXHRcclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuXHR0aGlzLmJhc2VfZWxlbWVudF9kcmF3KCk7XHJcblx0XHRcclxuXHQvLyBEcmF3IHRoZSBsaW5lIGVsZW1lbnQgdG8gdGhlIGNhbnZhcyBvZiB0aGUgc2tldGNocGFkLlxyXG5cdHRoaXMuc2tldGNocGFkLmNhbnZhcy5saW5lKHRoaXMuX3Byb3BlcnRpZXMueDEsIHRoaXMuX3Byb3BlcnRpZXMueTEsIHRoaXMuX3Byb3BlcnRpZXMueDIsIHRoaXMuX3Byb3BlcnRpZXMueTIsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IsIHRoaXMuX3Byb3BlcnRpZXMucGVud2lkdGgpO1xyXG4gICAgfTtcclxuICAgICAgICBcclxuICAgIC8vIEJpbmQgdGhlIGxpbmUgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmxpbmUgPSBvc3dlYi5wcm9tb3RlQ2xhc3MobGluZSxcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIG5vaXNlLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBub2lzZShwU2tldGNocGFkLCBwU2NyaXB0KVxyXG4gICAge1xyXG5cdC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZGVmYXVsdHNcdCAgICAgPSB7fTtcclxuXHR0aGlzLmRlZmF1bHRzLmNvbG9yMSA9ICd3aGl0ZSc7XHJcblx0dGhpcy5kZWZhdWx0cy5jb2xvcjIgPSAnYmxhY2snO1xyXG5cdHRoaXMuZGVmYXVsdHMuZW52ICAgID0gJ2dhdXNzaWFuJztcclxuXHR0aGlzLmRlZmF1bHRzLnNpemUgICA9IDk2O1xyXG5cdHRoaXMuZGVmYXVsdHMuc3RkZXYgID0gMTI7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgID0gbnVsbDtcclxuXHR0aGlzLmRlZmF1bHRzLmJnbW9kZSA9ICdhdmcnO1xyXG5cclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhub2lzZSwgb3N3ZWIuYmFzZV9lbGVtZW50KTtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAocnVuIGN5Y2xlKS4gICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5iYXNlX2VsZW1lbnRfZHJhdygpO1xyXG5cdFx0XHJcblx0Ly8gRHJhdyB0aGUgbm9pc2UgZWxlbWVudCB0byB0aGUgY2FudmFzIG9mIHRoZSBza2V0Y2hwYWQuXHJcblx0dGhpcy5za2V0Y2hwYWQuY2FudmFzLm5vaXNlKHRoaXMuX3Byb3BlcnRpZXMueCwgdGhpcy5fcHJvcGVydGllcy55LCB0aGlzLl9wcm9wZXJ0aWVzLmVudiwgdGhpcy5fcHJvcGVydGllcy5zaXplLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllcy5zdGRldiwgdGhpcy5fcHJvcGVydGllcy5jb2xvcjEsIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IyLCB0aGlzLl9wcm9wZXJ0aWVzLmJnbW9kZSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSBub2lzZSBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIubm9pc2UgPSBvc3dlYi5wcm9tb3RlQ2xhc3Mobm9pc2UsXCJiYXNlX2VsZW1lbnRcIik7XHJcbn0oKSk7XHJcbiIsIlxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyByZWN0LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiByZWN0KHBTa2V0Y2hwYWQsIHBTY3JpcHQpXHJcbiAgICB7XHJcblx0Ly8gU2V0IHRoZSBkZWZhdWx0IHByb3BlcnRpZXMuXHJcblx0dGhpcy5kZWZhdWx0cyAgICAgICAgICA9IHt9O1xyXG5cdHRoaXMuZGVmYXVsdHMuZmlsbCAgICAgPSAxO1xyXG5cdHRoaXMuZGVmYXVsdHMuY29sb3IgICAgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb3JlZ3JvdW5kJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5wZW53aWR0aCA9IDE7XHJcblx0dGhpcy5kZWZhdWx0cy54ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy55ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy53ICAgICAgICA9IG51bGw7XHJcblx0dGhpcy5kZWZhdWx0cy5oICAgICAgICA9IG51bGw7XHJcblxyXG5cdC8vIEluaGVyaXRlZC5cclxuXHR0aGlzLmJhc2VfZWxlbWVudF9jb25zdHJ1Y3RvcihwU2tldGNocGFkLCBwU2NyaXB0LCB0aGlzLmRlZmF1bHRzKTtcclxuICAgIH0gXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IG9zd2ViLmV4dGVuZENsYXNzKHJlY3QsIG9zd2ViLmJhc2VfZWxlbWVudCk7XHJcblx0XHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgbWV0aG9kcyAtIHJ1biBjeWNsZS4gICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5iYXNlX2VsZW1lbnRfZHJhdygpO1xyXG5cdFx0XHJcblx0Ly8gRHJhdyB0aGUgcmVjdGFuZ2xlIGVsZW1lbnQgdG8gdGhlIGNhbnZhcyBvZiB0aGUgc2tldGNocGFkLlxyXG5cdHRoaXMuc2tldGNocGFkLmNhbnZhcy5yZWN0KHRoaXMuX3Byb3BlcnRpZXMueCwgdGhpcy5fcHJvcGVydGllcy55LCB0aGlzLl9wcm9wZXJ0aWVzLncsIHRoaXMuX3Byb3BlcnRpZXMuaCwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllcy5maWxsLCB0aGlzLl9wcm9wZXJ0aWVzLmNvbG9yLCB0aGlzLl9wcm9wZXJ0aWVzLnBlbndpZHRoKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIEJpbmQgdGhlIFJlY3QgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnJlY3QgPSBvc3dlYi5wcm9tb3RlQ2xhc3MocmVjdCxcImJhc2VfZWxlbWVudFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIHRleHRsaW5lLlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiB0ZXh0bGluZShwU2tldGNocGFkLCBwU2NyaXB0KVxyXG4gICAge1xyXG4gICAgICAgIC8vIFNldCB0aGUgZGVmYXVsdCBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZGVmYXVsdHMgICAgICAgICAgICAgPSB7fTtcclxuXHR0aGlzLmRlZmF1bHRzLmNlbnRlciAgICAgID0gMTtcclxuXHR0aGlzLmRlZmF1bHRzLmNvbG9yICAgICAgID0gcFNrZXRjaHBhZC52YXJzLmdldCgnZm9yZWdyb3VuZCcpO1xyXG5cdHRoaXMuZGVmYXVsdHMuZm9udF9mYW1pbHkgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb250X2ZhbWlseScpO1xyXG5cdHRoaXMuZGVmYXVsdHMuZm9udF9zaXplICAgPSBwU2tldGNocGFkLnZhcnMuZ2V0KCdmb250X3NpemUnKTtcclxuXHR0aGlzLmRlZmF1bHRzLmZvbnRfYm9sZCAgID0gcFNrZXRjaHBhZC52YXJzLmdldCgnZm9udF9ib2xkJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5mb250X2l0YWxpYyA9IHBTa2V0Y2hwYWQudmFycy5nZXQoJ2ZvbnRfaXRhbGljJyk7XHJcblx0dGhpcy5kZWZhdWx0cy5odG1sICAgICAgICA9ICd5ZXMnO1xyXG5cdHRoaXMuZGVmYXVsdHMudGV4dCAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueCAgICAgICAgICAgPSBudWxsO1xyXG5cdHRoaXMuZGVmYXVsdHMueSAgICAgICAgICAgPSBudWxsO1xyXG5cclxuXHQvLyBJbmhlcml0ZWQuXHJcblx0dGhpcy5iYXNlX2VsZW1lbnRfY29uc3RydWN0b3IocFNrZXRjaHBhZCwgcFNjcmlwdCwgdGhpcy5kZWZhdWx0cyk7XHJcbiAgICB9IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyh0ZXh0bGluZSwgb3N3ZWIuYmFzZV9lbGVtZW50KTtcclxuXHRcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVubmluZyBjeWNsZS4gICAgICAgICBcclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhdyA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbmhlcml0ZWQuXHRcclxuICAgIFx0dGhpcy5iYXNlX2VsZW1lbnRfZHJhdygpO1xyXG5cdFx0XHJcbiAgICBcdC8vIFNldCB0aGUgZm9udCBzdHlsZSBhbmQgZHJhdyB0aGUgdGV4dCBlbGVtZW50IHRvIHRoZSBjYW52YXMgb2YgdGhlIHNrZXRjaHBhZC5cclxuXHR0aGlzLnNrZXRjaHBhZC5jYW52YXMuc2V0X2ZvbnQodGhpcy5fcHJvcGVydGllcy5mb250X2ZhbWlseSwgdGhpcy5fcHJvcGVydGllcy5mb250X3NpemUsIHRoaXMuX3Byb3BlcnRpZXMuZm9udF9pdGFsaWMgPT0gJ3llcycsIHRoaXMuX3Byb3BlcnRpZXMuZm9udF9ib2xkID09ICd5ZXMnLCB0aGlzLl9wcm9wZXJ0aWVzLmZvbnRfdW5kZXJsaW5lID09ICd5ZXMnKTtcdFx0XHJcbiAgICAgICAgdGhpcy5za2V0Y2hwYWQuY2FudmFzLnRleHQodGhpcy5fcHJvcGVydGllcy50ZXh0LCB0aGlzLl9wcm9wZXJ0aWVzLmNlbnRlciwgdGhpcy5fcHJvcGVydGllcy54LCB0aGlzLl9wcm9wZXJ0aWVzLnksIHRoaXMuX3Byb3BlcnRpZXMuY29sb3IsIHRoaXMuX3Byb3BlcnRpZXMuaHRtbCk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSBUZXh0IGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi50ZXh0bGluZSA9IG9zd2ViLnByb21vdGVDbGFzcyh0ZXh0bGluZSwgXCJiYXNlX2VsZW1lbnRcIik7XHJcbn0oKSk7XHJcbiIsIlx0XHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGZvcm0uXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGZvcm0ocEV4cGVyaW1lbnQsIHBDb2xzLCBwUm93cywgcFNwYWNpbmcsIHBNYXJnaW5zLCBwVGhlbWUsIHBJdGVtLCBwVGltZW91dCwgcENsaWNrcylcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG4gICAgICAgIHRoaXMuY2xpY2tzICAgICA9IHBDbGlja3M7XHJcblx0dGhpcy5leHBlcmltZW50ID0gcEV4cGVyaW1lbnQ7XHJcblx0dGhpcy5oZWlnaHQgICAgID0gdGhpcy5leHBlcmltZW50LnZhcnMuaGVpZ2h0O1xyXG5cdHRoaXMuaXRlbSAgICAgICA9IChwSXRlbSAhPSBudWxsKSA/IHBJdGVtIDogcEV4cGVyaW1lbnQ7XHJcblx0dGhpcy5tYXJnaW5zICAgID0gcE1hcmdpbnM7XHJcbiAgICAgICAgdGhpcy5zcGFjaW5nICAgID0gcFNwYWNpbmc7XHJcblx0dGhpcy5zcGFuICAgICAgID0gW107XHJcbiAgICAgICAgdGhpcy50aW1lb3V0ICAgID0gcFRpbWVvdXQ7XHJcblx0dGhpcy53aWRnZXRzICAgID0gW107IFxyXG4gICAgICAgIHRoaXMud2lkdGggICAgICA9IHRoaXMuZXhwZXJpbWVudC52YXJzLndpZHRoO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMgLSBjb2x1bW5zIGFuZCByb3dzLlxyXG4gICAgICAgIHZhciBjb2xTaXplID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpPTA7aSA8IHBDb2xzLmxlbmd0aDtpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjb2xTaXplID0gY29sU2l6ZSArIE51bWJlcihwQ29sc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29scyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGk9MDtpIDwgcENvbHMubGVuZ3RoO2krKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuY29scy5wdXNoKE1hdGgucm91bmQoKHBDb2xzW2ldIC8gY29sU2l6ZSkgKiAxMDApKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgIHZhciByb3dTaXplID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpPTA7aSA8IHBSb3dzLmxlbmd0aDtpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByb3dTaXplID0gcm93U2l6ZSArIE51bWJlcihwUm93c1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucm93cyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGk9MDtpIDwgcFJvd3MubGVuZ3RoO2krKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMucm93cy5wdXNoKE1hdGgucm91bmQoKHBSb3dzW2ldIC8gcm93U2l6ZSkgKiAxMDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHJpdmF0ZSBwcm9wZXJ0aWVzLlxyXG4gICAgICAgIHRoaXMuX3BhcmVudGZvcm0gICAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvc3dlYl9mb3JtJyk7XHJcbiAgICAgICAgdGhpcy5fZm9ybSAgICAgICAgICAgICAgID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkRJVlwiKTtcclxuICAgICAgICB0aGlzLl9mb3JtLnN0eWxlLmhlaWdodCAgPSAnMTAwJSc7XHJcbiAgICAgICAgdGhpcy5fZm9ybS5zdHlsZS53aWR0aCAgID0gJzEwMCUnO1xyXG4gICAgICAgIHRoaXMuX2Zvcm0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIHRhYmxlIHByb3BlcnRpZXMgYW5kIGNvbnRlbnQuXHJcbiAgICAgICAgdGhpcy5fdGFibGUgICAgICAgICAgICAgICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJUQUJMRVwiKTtcclxuICAgICAgICB0aGlzLl90YWJsZS5zdHlsZS5wYWRkaW5nICAgID0gdGhpcy5tYXJnaW5zWzBdICsgJ3B4ICcgKyB0aGlzLm1hcmdpbnNbMV0gKyAncHggJyArIHRoaXMubWFyZ2luc1syXSArICdweCAnICsgdGhpcy5tYXJnaW5zWzNdICsgJ3B4JztcclxuICAgICAgICB0aGlzLl90YWJsZS5zdHlsZS5oZWlnaHQgICAgID0gJzEwMCUnO1xyXG4gICAgICAgIHRoaXMuX3RhYmxlLnN0eWxlLndpZHRoICAgICAgPSAnMTAwJSc7XHJcbiAgICAgICAgdGhpcy5fdGFibGUuc3R5bGUuZm9udFN0eWxlICA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfaXRhbGljID09ICd5ZXMnID8gJ2l0YWxpYycgOiAnbm9ybWFsJzsgXHJcbiAgICAgICAgdGhpcy5fdGFibGUuc3R5bGUuZm9udFdlaWdodCA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfYm9sZCAgID09ICd5ZXMnID8gJ2JvbGQnICAgOiAnbm9ybWFsJzsgXHJcbiAgICAgICAgdGhpcy5fdGFibGUuc3R5bGUuZm9udEZhbWlseSA9IHRoaXMuZXhwZXJpbWVudC52YXJzLmZvbnRfZmFtaWx5O1xyXG4gICAgICAgIHRoaXMuX3RhYmxlLnN0eWxlLmNvbG9yICAgICAgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5mb3JlZ3JvdW5kO1xyXG4gICAgICAgIHRoaXMuX3RhYmxlLnN0eWxlLmZvbnRTaXplICAgPSB0aGlzLmV4cGVyaW1lbnQudmFycy5mb250X3NpemUgKyAncHgnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAodmFyIGk9MDtpIDwgdGhpcy5yb3dzLmxlbmd0aDtpKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBJbnNlcnQgdGhlIHJvdyBpbnRvIHRoZSB0YWJsZS5cclxuICAgICAgICAgICAgdmFyIHJvdyAgICAgICAgICA9IHRoaXMuX3RhYmxlLmluc2VydFJvdygpO1xyXG4gICAgICAgICAgICByb3cuc3R5bGUuaGVpZ2h0ID0gdGhpcy5yb3dzW2ldICsgJyUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gSW5zZXIgdGhlIGNlbGxzLlxyXG4gICAgICAgICAgICBmb3IgKHZhciBqPTA7aiA8IHRoaXMuY29scy5sZW5ndGg7aisrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IHJvdy5pbnNlcnRDZWxsKGopO1xyXG4gICAgICAgICAgICAgICAgY2VsbC5zdHlsZS53aWR0aCAgID0gdGhpcy5jb2xzW2pdICsgJyUnO1xyXG4gICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5wYWRkaW5nID0gJzVweCc7XHJcbiAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgfSAgICAgICAgXHJcblxyXG4gICAgICAgIC8vIEFwcGVuZCB0aGUgdGFibGUgdG8gdGhlIGZvcm0uXHJcbiAgICAgICAgdGhpcy5fcGFyZW50Zm9ybS5hcHBlbmRDaGlsZCh0aGlzLl9mb3JtKTtcclxuICAgICAgICB0aGlzLl9mb3JtLmFwcGVuZENoaWxkKHRoaXMuX3RhYmxlKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBEeW5hbWljYWxseSBsb2FkIHRoZSB0aGVtZSBvYmplY3RcclxuXHQvKiB0aGVtZV9tb2QgPSBfX2ltcG9ydF9fKHUnbGlib3BlbnNlc2FtZS53aWRnZXRzLnRoZW1lcy4lcycgJSB0aGVtZSwgZnJvbWxpc3Q9W3UnZHVtbXknXSlcclxuXHR0aGVtZV9jbHMgPSBnZXRhdHRyKHRoZW1lX21vZCwgdGhlbWUpXHJcblx0c2VsZi50aGVtZV9lbmdpbmUgPSB0aGVtZV9jbHMoc2VsZikgKi9cclxuICAgIH0gXHJcblx0XHJcbiAgICAvLyBFeHRlbmQgdGhlIGNsYXNzIGZyb20gaXRzIGJhc2UgY2xhc3MuXHJcbiAgICB2YXIgcCA9IGZvcm0ucHJvdG90eXBlO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5jbGlja3MgICAgID0gbnVsbDtcclxuICAgIHAuZXhwZXJpbWVudCA9IG51bGw7XHJcbiAgICBwLmhlaWdodCAgICAgPSAtMTtcclxuICAgIHAuaXRlbSAgICAgICA9IG51bGw7XHJcbiAgICBwLnNwYWNpbmcgICAgPSBudWxsO1xyXG4gICAgcC50aW1lb3V0ICAgID0gLTE7XHJcbiAgICBwLndpZHRoICAgICAgPSAtMTtcclxuICAgIFxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIG1ldGhvZHMgLSBnZW5lcmFsIGZ1bmN0aW9uLlxyXG4gICAgICovXHJcblxyXG4gICAgcC5fZXhlYyA9IGZ1bmN0aW9uKHBGb2N1c193aWRnZXQpXHJcbiAgICB7XHJcbiAgICB9OyAgIFxyXG5cclxuICAgIHAudGltZWRfb3V0ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmNlbGxfaW5kZXggPSBmdW5jdGlvbihwUG9zKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnZhbGlkYXRlX2dlb21ldHJ5ID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmdldF9jZWxsID0gZnVuY3Rpb24ocEluZGV4KVxyXG4gICAge1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcC5nZXRfcmVjdCA9IGZ1bmN0aW9uKHBJbmRleClcclxuICAgIHtcclxuICAgIH07XHJcblxyXG4gICAgcC5yZW5kZXIgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcblx0dGhpcy52YWxpZGF0ZV9nZW9tZXRyeSgpO1xyXG5cdHRoaXMuY2FudmFzLmNsZWFyKCk7XHJcblx0Zm9yICh2YXIgd2lkZ2V0IGluIHRoaXMud2lkZ2V0cylcclxuXHR7XHJcbiAgICAgICAgICAgIGlmICh3aWRnZXQgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdpZGdldC5yZW5kZXIoKTtcclxuICAgICAgICAgICAgfSAgICBcclxuICAgICAgICB9XHRcdFxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY2FudmFzLnNob3coKTtcclxuICAgIH07ICAgIFxyXG5cclxuICAgIHAuc2V0X3dpZGdldCA9IGZ1bmN0aW9uKHBXaWRnZXQsIHBQb3MsIHBDb2xzcGFuLCBwUm93c3BhbilcclxuICAgIHtcclxuICAgICAgICAvLyBHZXQgdGhlIHJvdyBwb3N0aXRpb24gb2YgdGhlIHdpZGdldC5cclxuICAgICAgICB2YXIgcm93ICA9IHRoaXMuX3RhYmxlLnJvd3NbTnVtYmVyKHBQb3NbMV0pXTtcclxuICAgICAgICB2YXIgY2VsbCA9IHJvdy5jZWxsc1tOdW1iZXIocFBvc1swXSldOyBcclxuICAgICAgICBpZiAoTnVtYmVyKHBDb2xzcGFuKSA+IDEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjZWxsLmNvbFNwYW4gPSBOdW1iZXIocENvbHNwYW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoTnVtYmVyKHBSb3dzcGFuKSA+IDEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjZWxsLnJvd1NwYW4gPSBOdW1iZXIocFJvd3NwYW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBBcHBlbmQgd2lkZ2V0IHRvIHRoZSBjZWxsLlxyXG4gICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQocFdpZGdldC5fZWxlbWVudCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLyogdmFyIGluZGV4ID0gdGhpcy5jZWxsX2luZGV4KG5Qb3M7KVxyXG5cdGlmIChpbmRleCA+PSBsZW4odGhpcy53aWRnZXRzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gcmFpc2Ugb3NleGNlcHRpb24odSdXaWRnZXQgcG9zaXRpb24gKCVzLCAlcykgaXMgb3V0c2lkZSBvZiB0aGUgZm9ybScgJSBwb3MpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIHR5cGUoY29sc3BhbikgIT0gaW50IG9yIGNvbHNwYW4gPCAxIG9yIGNvbHNwYW4gPiBsZW4oc2VsZi5jb2xzKTpcclxuXHRcdFx0cmFpc2Ugb3NleGNlcHRpb24oIFxcXHJcblx0XHRcdFx0dSdDb2x1bW4gc3BhbiAlcyBpcyBpbnZhbGlkIChpLmUuIHRvbyBsYXJnZSwgdG9vIHNtYWxsLCBvciBub3QgYSBudW1iZXIpJyBcXFxyXG5cdFx0XHRcdCUgY29sc3BhbilcclxuXHRcdGlmIHR5cGUocm93c3BhbikgIT0gaW50IG9yIHJvd3NwYW4gPCAxIG9yIHJvd3NwYW4gPiBsZW4oc2VsZi5yb3dzKTpcclxuXHRcdFx0cmFpc2Ugb3NleGNlcHRpb24oIFxcXHJcblx0XHRcdFx0dSdSb3cgc3BhbiAlcyBpcyBpbnZhbGlkIChpLmUuIHRvbyBsYXJnZSwgdG9vIHNtYWxsLCBvciBub3QgYSBudW1iZXIpJyBcXFxyXG5cdFx0XHRcdCUgcm93c3BhbikgXHJcblx0dGhpcy53aWRnZXRzW2luZGV4XSA9IHdpZGdldDtcclxuXHR0aGlzLnNwYW5baW5kZXhdICAgID0gY29sc3Bhbiwgcm93c3BhblxyXG4gICAgICAgIHRoaXMud2lkZ2V0LnNldF9yZWN0KHRoaXMuZ2V0X3JlY3QoaW5kZXgpKSAqL1xyXG4gICAgfTtcclxuXHJcbiAgICBwLnh5X3RvX2luZGV4ID0gZnVuY3Rpb24ocFh5KVxyXG4gICAge1xyXG4gICAgfTtcclxuICBcclxuICAgIC8vIEJpbmQgdGhlIGZvcm0gY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmZvcm0gPSBmb3JtO1xyXG59KCkpO1xyXG4iLCJcdFxyXG4vKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyB3aWRnZXQuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIHdpZGdldChwRm9ybSlcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLlxyXG5cdHRoaXMuZm9jdXMgPSBmYWxzZTtcclxuXHR0aGlzLmZvcm0gID0gcEZvcm07XHJcblx0dGhpcy5yZWN0ICA9IG51bGw7XHJcblx0dGhpcy50eXBlICA9ICd3aWRnZXQnO1xyXG5cdHRoaXMudmFycyAgPSBudWxsO1xyXG4gICAgfSBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gd2lkZ2V0LnByb3RvdHlwZTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIGNsYXNzIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuZm9ybSAgPSBudWxsO1xyXG4gICAgcC5mb2N1cyA9IGZhbHNlO1xyXG4gICAgcC5yZWN0ICA9IG51bGw7XHJcbiAgICBwLnR5cGUgID0gJyc7XHRcclxuICAgIHAudmFycyAgPSBudWxsO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gZ2VuZXJhbCBmdW5jdGlvbi5cclxuICAgICAqL1xyXG5cclxuICAgIHAuYm94X3NpemUgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9OyAgICAgICAgICAgIFxyXG5cclxuICAgIHAudGhlbWVfZW5naW5lID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcC5kcmF3X2ZyYW1lID0gZnVuY3Rpb24ocFJlY3QsIHBTdHlsZSlcclxuICAgIHtcclxuICAgIH07ICAgIFxyXG5cclxuICAgIHAub25fbW91c2VfY2xpY2sgPSBmdW5jdGlvbihwZXZlbnQpXHJcbiAgICB7XHJcbiAgICB9OyAgICAgICAgXHJcblxyXG4gICAgcC5yZW5kZXIgPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuc2V0X3JlY3QgPSBmdW5jdGlvbihwUmVjdClcclxuICAgIHtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHAuc2V0X3ZhciA9IGZ1bmN0aW9uKHBWYWwsIHBWYXIpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gU2V0cyBhbiBleHBlcmltZW50YWwgdmFyaWFibGUuXHJcbiAgICAgICAgaWYgKHBWYXIgPT0gbnVsbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHBWYXIgPSB0aGlzLnZhcnM7XHJcbiAgICAgICAgfSAgICBcclxuXHRcclxuICAgICAgICBpZiAocFZhciAhPSBudWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5mb3JtLmV4cGVyaW1lbnQudmFycy5zZXQocFZhciwgcFZhbCk7ICBcclxuICAgICAgICB9ICBcclxuICAgIH07ICAgIFxyXG4gICAgXHJcbiAgICAvLyBCaW5kIHRoZSB3aWRnZXQgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLndpZGdldCA9IHdpZGdldDtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGJ1dHRvbi5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSBcclxue1xyXG4gICAgZnVuY3Rpb24gYnV0dG9uKHBGb3JtLCBwUHJvcGVydGllcylcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMud2lkZ2V0X2NvbnN0cnVjdG9yKHBGb3JtKTtcclxuXHRcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkJVVFRPTlwiKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLndpZHRoICA9ICcxMDAlJztcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmhlaWdodCA9ICcxMDAlJztcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnRleHRDb250ZW50ID0gcFByb3BlcnRpZXNbJ3RleHQnXTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmZvbnRTdHlsZSAgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC52YXJzLmZvbnRfaXRhbGljID09ICd5ZXMnID8gJ2l0YWxpYycgOiAnbm9ybWFsJzsgXHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5mb250V2VpZ2h0ID0gdGhpcy5mb3JtLmV4cGVyaW1lbnQudmFycy5mb250X2JvbGQgICA9PSAneWVzJyA/ICdib2xkJyAgIDogJ25vcm1hbCc7IFxyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuZm9udEZhbWlseSA9IHRoaXMuZm9ybS5leHBlcmltZW50LnZhcnMuZm9udF9mYW1pbHk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5jb2xvciAgICAgID0gdGhpcy5mb3JtLmV4cGVyaW1lbnQudmFycy5mb3JlZ3JvdW5kO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuZm9udFNpemUgICA9IHRoaXMuZm9ybS5leHBlcmltZW50LnZhcnMuZm9udF9zaXplICsgJ3B4JztcclxuXHJcbiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBlbGVtZW50LlxyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMucmVzcG9uc2UuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcblx0dGhpcy5jZW50ZXIgID0gKHR5cGVvZiBwUHJvcGVydGllc1snY2VudGVyJ10gPT0gJ2Jvb2xlYW4nKSA/IHBQcm9wZXJ0aWVzWydjZW50ZXInXSA6IGZhbHNlOyBcclxuICAgICAgICB0aGlzLmZyYW1lICAgPSAodHlwZW9mIHBQcm9wZXJ0aWVzWydmcmFtZSddICA9PSAnYm9vbGVhbicpID8gcFByb3BlcnRpZXNbJ2ZyYW1lJ10gIDogZmFsc2U7IFxyXG4gICAgICAgIHRoaXMudGFiX3N0ciA9ICcgICAgJztcclxuXHR0aGlzLnR5cGUgICAgPSAnYnV0dG9uJztcclxuXHR0aGlzLnhfcGFkICAgPSA4O1xyXG5cdHRoaXMueV9wYWQgICA9IDg7XHJcbiAgICB9OyBcclxuXHRcclxuICAgIC8vIEV4dGVuZCB0aGUgY2xhc3MgZnJvbSBpdHMgYmFzZSBjbGFzcy5cclxuICAgIHZhciBwID0gb3N3ZWIuZXh0ZW5kQ2xhc3MoYnV0dG9uLCBvc3dlYi53aWRnZXQpO1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcC5jZW50ZXIgID0gZmFsc2U7XHJcbiAgICBwLmZyYW1lICAgPSBudWxsO1xyXG4gICAgcC50YWJfc3RyID0gJyc7XHJcbiAgICBwLnRleHQgICAgPSAnJztcclxuICAgIHAueF9wYWQgICA9IDA7XHJcbiAgICBwLnlfcGFkICAgPSAwO1xyXG5cclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIHB1YmxpYyBjbGFzcyBtZXRob2RzIC0gYnVpbGQgY3ljbGUuXHJcbiAgICAgKi9cclxuXHJcbiAgICBwLnJlc3BvbnNlID0gZnVuY3Rpb24oZXZlbnQpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcyk7XHJcbiAgICAgICAgLy8gQ29tcGxldGUgdGhlIHBhcmVudCBmb3JtLlxyXG4gICAgICAgIHRoaXMuZm9ybS5pdGVtLmNvbXBsZXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAuZHJhd190ZXh0ID0gZnVuY3Rpb24ocFRleHQsIHBIdG1sKVxyXG4gICAge1xyXG4gICAgICAgIC8vIERyYXdzIHRleHQgaW5zaWRlIHRoZSB3aWRnZXQuXHJcblx0cFRleHQgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC5zeW50YXguZXZhbF90ZXh0KHBUZXh0KTtcclxuXHRwVGV4dCA9IHNhZmVfZGVjb2RlKHBUZXh0KS5yZXBsYWNlKCdcXHQnLCB0aGlzLnRhYl9zdHIpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZW50ZXIgPT0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5yZWN0LnggKyB0aGlzLnJlY3QudyAvIDI7XHJcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5yZWN0LnkgKyB0aGlzLnJlY3QuaCAvIDI7XHJcbiAgICAgICAgfSAgXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHsgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgeCA9IHRoaXMucmVjdC54ICsgdGhpcy54X3BhZDtcclxuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnJlY3QueSArIHRoaXMueV9wYWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB3ID0gdGhpcy5yZWN0LncgLSAyICogdGhpcy54X3BhZDtcclxuICAgICAgICBcclxuXHR0aGlzLmZvcm0uY2FudmFzLnRleHQocFRleHQsIHRoaXMuY2VudGVyLCB4LCB5LCB3LCBwSHRtbCk7XHJcbiAgICB9OyAgICBcclxuXHJcbiAgICBwLnJlbmRlciA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBEcmF3cyB0aGUgd2lkZ2V0LlxyXG4gICAgICAgIGlmICh0aGlzLmZyYW1lID09IHRydWUpXHJcbiAgICAgICAgeyAgICBcclxuICAgICAgICAgICAgdGhpcy5kcmF3X2ZyYW1lKHRoaXMucmVjdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuZHJhd190ZXh0KHRoaXMudGV4dCk7IFxyXG4gICAgfTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgLy8gQmluZCB0aGUgYnV0dG9uIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5idXR0b24gPSBvc3dlYi5wcm9tb3RlQ2xhc3MoYnV0dG9uLCBcIndpZGdldFwiKTtcclxufSgpKTtcclxuIiwiXHJcbi8qXHJcbiAqIERlZmluaXRpb24gb2YgdGhlIGNsYXNzIGNoZWNrYm94LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIFxyXG57XHJcbiAgICBmdW5jdGlvbiBjaGVja2JveChwRm9ybSwgcFByb3BlcnRpZXMpXHJcbiAgICB7XHJcblx0Ly8gSW5oZXJpdGVkIGNyZWF0ZS5cclxuXHR0aGlzLndpZGdldF9jb25zdHJ1Y3RvcihwRm9ybSk7XHJcblx0XHJcbiAgICAgICAgLy8gU2V0IHRoZSBjbGFzcyBwcml2YXRlIHByb3BlcnRpZXMuXHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCAgICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJMQUJFTFwiKTsgXHJcbiAgICAgICAgdGhpcy5fZWxlbWVudF9jaGVjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJJTlBVVFwiKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50X2NoZWNrLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJjaGVja2JveFwiKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLndpZHRoICAgICAgPSAnMTAwJSc7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5oZWlnaHQgICAgID0gJzEwMCUnO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQudGV4dENvbnRlbnQgICAgICAgID0gcFByb3BlcnRpZXNbJ3RleHQnXTtcclxuICAgICAgICBcclxuICAgICAgICAvL3RoaXMuX2VsZW1lbnQuaW5uZXJIVE1MICAgICAgICA9IHBQcm9wZXJ0aWVzWyd0ZXh0J107XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5mb250U3R5bGUgID0gdGhpcy5mb3JtLmV4cGVyaW1lbnQudmFycy5mb250X2l0YWxpYyA9PSAneWVzJyA/ICdpdGFsaWMnIDogJ25vcm1hbCc7IFxyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuZm9udFdlaWdodCA9IHRoaXMuZm9ybS5leHBlcmltZW50LnZhcnMuZm9udF9ib2xkICAgPT0gJ3llcycgPyAnYm9sZCcgICA6ICdub3JtYWwnOyBcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmZvbnRGYW1pbHkgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC52YXJzLmZvbnRfZmFtaWx5O1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUuY29sb3IgICAgICA9IHRoaXMuZm9ybS5leHBlcmltZW50LnZhcnMuZm9yZWdyb3VuZDtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmZvbnRTaXplICAgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC52YXJzLmZvbnRfc2l6ZSArICdweCc7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9lbGVtZW50X2NoZWNrKTtcclxuXHJcbiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBlbGVtZW50LlxyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMub25fbW91c2VfY2xpY2suYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCctLS0nKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhwUHJvcGVydGllcyk7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcblx0dGhpcy5jbGlja19hY2NlcHRzID0gKHR5cGVvZiBwUHJvcGVydGllcy5jbGlja19hY2NlcHRzID09PSAndW5kZWZpbmVkJykgPyBmYWxzZSA6IHBQcm9wZXJ0aWVzLmNsaWNrX2FjY2VwdHM7XHJcblx0dGhpcy5ncm91cCAgICAgICAgID0gKHR5cGVvZiBwUHJvcGVydGllcy5ncm91cCA9PT0gJ3VuZGVmaW5lZCcpID8gbnVsbCA6IHBQcm9wZXJ0aWVzLmdyb3VwO1xyXG5cdHRoaXMudHlwZSAgICAgICAgICA9ICdjaGVja2JveCc7XHJcbiAgICAgICAgdGhpcy52YXIgICAgICAgICAgID0gKHR5cGVvZiBwUHJvcGVydGllcy52YXIgPT09ICd1bmRlZmluZWQnKSA/IG51bGwgOiBwUHJvcGVydGllcy52YXI7XHJcbiAgICAgICAgdGhpcy5jaGVja2VkICAgICAgID0gKHR5cGVvZiBwUHJvcGVydGllcy5jaGVja2VkID09PSAnY2hlY2tlZCcpID8gZmFsc2UgIDogcFByb3BlcnRpZXMuY2hlY2tlZDtcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIGN1cnJlbnQgc3RhdHVzIG9mIHRoZSBjaGVja2JveC5cclxuICAgICAgICB0aGlzLnNldF92YXIodGhpcy5jaGVja2VkKTtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhjaGVja2JveCwgb3N3ZWIud2lkZ2V0KTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuY2VudGVyICA9IGZhbHNlO1xyXG4gICAgcC5mcmFtZSAgID0gbnVsbDtcclxuICAgIHAudGFiX3N0ciA9ICcnO1xyXG4gICAgcC50ZXh0ICAgID0gJyc7XHJcbiAgICBwLnhfcGFkICAgPSAwO1xyXG4gICAgcC55X3BhZCAgID0gMDtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGVmaW5pdGlvbiBvZiBwdWJsaWMgY2xhc3MgbWV0aG9kcy5cclxuICAgICAqL1xyXG5cclxuICAgIHAub25fbW91c2VfY2xpY2sgPSBmdW5jdGlvbihldmVudClcclxuICAgIHtcclxuICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2JveCBjbGlja2VkJyk7IFxyXG4gICAgXHJcbiAgICB9O1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAvLyBCaW5kIHRoZSBjaGVja2JveCBjbGFzcyB0byB0aGUgb3N3ZWIgbmFtZXNwYWNlLlxyXG4gICAgb3N3ZWIuY2hlY2tib3ggPSBvc3dlYi5wcm9tb3RlQ2xhc3MoY2hlY2tib3gsIFwid2lkZ2V0XCIpO1xyXG59KCkpO1xyXG4iLCJcclxuLypcclxuICogRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3MgbGFiZWwuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkgXHJcbntcclxuICAgIGZ1bmN0aW9uIGxhYmVsKHBGb3JtLCBwUHJvcGVydGllcylcclxuICAgIHtcclxuXHQvLyBJbmhlcml0ZWQgY3JlYXRlLlxyXG5cdHRoaXMud2lkZ2V0X2NvbnN0cnVjdG9yKHBGb3JtKTtcclxuXHRcclxuICAgICAgICAvLyBTZXQgdGhlIGNsYXNzIHByaXZhdGUgcHJvcGVydGllcy5cclxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIlNQQU5cIik7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5pbm5lckhUTUwgPSBwUHJvcGVydGllc1sndGV4dCddO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgcHVibGljIHByb3BlcnRpZXMuXHJcblx0dGhpcy5jZW50ZXIgID0gKHR5cGVvZiBwUHJvcGVydGllc1snY2VudGVyJ10gPT0gJ2Jvb2xlYW4nKSA/IHBQcm9wZXJ0aWVzWydjZW50ZXInXSA6IGZhbHNlOyBcclxuICAgICAgICB0aGlzLmZyYW1lICAgPSAodHlwZW9mIHBQcm9wZXJ0aWVzWydmcmFtZSddICA9PSAnYm9vbGVhbicpID8gcFByb3BlcnRpZXNbJ2ZyYW1lJ10gIDogZmFsc2U7IFxyXG4gICAgICAgIHRoaXMudGFiX3N0ciA9ICcgICAgJztcclxuXHR0aGlzLnR5cGUgICAgPSAnbGFiZWwnO1xyXG5cdHRoaXMueF9wYWQgICA9IDg7XHJcblx0dGhpcy55X3BhZCAgID0gODtcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRXh0ZW5kIHRoZSBjbGFzcyBmcm9tIGl0cyBiYXNlIGNsYXNzLlxyXG4gICAgdmFyIHAgPSBvc3dlYi5leHRlbmRDbGFzcyhsYWJlbCwgb3N3ZWIud2lkZ2V0KTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBwcm9wZXJ0aWVzLiBcclxuICAgIHAuY2VudGVyICA9IGZhbHNlO1xyXG4gICAgcC5mcmFtZSAgID0gZmFsc2U7XHJcbiAgICBwLnRhYl9zdHIgPSAnJztcclxuICAgIHAudGV4dCAgICA9ICcnO1xyXG4gICAgcC54X3BhZCAgID0gMDtcclxuICAgIHAueV9wYWQgICA9IDA7XHJcblxyXG4gICAgLypcclxuICAgICAqIERlZmluaXRpb24gb2YgcHVibGljIGNsYXNzIG1ldGhvZHMgLSBidWlsZCBjeWNsZS5cclxuICAgICAqL1xyXG5cclxuICAgIHAuZHJhd190ZXh0ID0gZnVuY3Rpb24ocFRleHQsIHBIdG1sKVxyXG4gICAge1xyXG4gICAgICAgIC8vIERyYXdzIHRleHQgaW5zaWRlIHRoZSB3aWRnZXQuXHJcblx0cFRleHQgPSB0aGlzLmZvcm0uZXhwZXJpbWVudC5zeW50YXguZXZhbF90ZXh0KHBUZXh0KTtcclxuXHRwVGV4dCA9IHNhZmVfZGVjb2RlKHBUZXh0KS5yZXBsYWNlKCdcXHQnLCB0aGlzLnRhYl9zdHIpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZW50ZXIgPT0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5yZWN0LnggKyB0aGlzLnJlY3QudyAvIDI7XHJcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5yZWN0LnkgKyB0aGlzLnJlY3QuaCAvIDI7XHJcbiAgICAgICAgfSAgXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHsgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgeCA9IHRoaXMucmVjdC54ICsgdGhpcy54X3BhZDtcclxuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnJlY3QueSArIHRoaXMueV9wYWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB3ID0gdGhpcy5yZWN0LncgLSAyICogdGhpcy54X3BhZDtcclxuICAgICAgICBcclxuXHR0aGlzLmZvcm0uY2FudmFzLnRleHQocFRleHQsIHRoaXMuY2VudGVyLCB4LCB5LCB3LCBwSHRtbCk7XHJcbiAgICB9OyAgICBcclxuXHJcbiAgICBwLnJlbmRlciA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuXHQvLyBEcmF3cyB0aGUgd2lkZ2V0LlxyXG4gICAgICAgIGlmICh0aGlzLmZyYW1lID09IHRydWUpXHJcbiAgICAgICAgeyAgICBcclxuICAgICAgICAgICAgdGhpcy5kcmF3X2ZyYW1lKHRoaXMucmVjdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuZHJhd190ZXh0KHRoaXMudGV4dCk7IFxyXG4gICAgfTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgLy8gQmluZCB0aGUgbGFiZWwgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLmxhYmVsID0gb3N3ZWIucHJvbW90ZUNsYXNzKGxhYmVsLCBcIndpZGdldFwiKTtcclxufSgpKTtcclxuIiwiXHJcbihmdW5jdGlvbigpIHtcclxuICAgIC8vIENsYXNzIGV2ZW50cyAtIHByb2Nlc3NpbmcgYWxsIHVzZXIgYW5kIHN5c3RlbSBldmVucyB3aXRoaW4gb3N3ZWIuXHJcbiAgICBmdW5jdGlvbiBldmVudHMoKSB7XHJcbiAgICBcdHRocm93ICdUaGUgY2xhc3MgZXZlbnRzIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhJztcclxuICAgIH07IFxyXG5cdFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuXHJcbiAgICBldmVudHMuX2FjdGl2ZSA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdHJ1ZSBldmVudCBwcm9jZXNzaW5nIGlzIGFjdGl2ZS5cclxuICAgIGV2ZW50cy5fY2FsbGVyID0gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgY2FsbGVyIG9iamVjdCAoY2xvY2ssIGtleWJvYXJkLCBtb3VzZSkuXHJcbiAgICBldmVudHMuX2N1cnJlbnRfaXRlbSA9IG51bGw7XHRcdFx0ICAgLy8gQ29udGFpbiB0aGUgY3VycmVudCBhY3RpdmUgaXRlbS4gXHRcdFx0XHJcbiAgICBldmVudHMuX2tleWJvYXJkX21vZGUgPSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19PTkxZOyAgLy8gS2V5Ym9hcmQgY29sbGVjdGluZyBtb2RlIChkb3duL3VwL2JvdGgpLlxyXG4gICAgZXZlbnRzLl9rZXlib2FyZF9ldmVudCA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbnRhaW5zIHRoZSBsYXN0IGtub3duIGtleWJvYXJkIGV2ZW50LlxyXG4gICAgZXZlbnRzLl9tb3VzZV9tb2RlID0gb3N3ZWIuY29uc3RhbnRzLlBSRVNTRVNfT05MWTsgICAgIC8vIE1vdXNlIGNvbGxlY3RpbmcgbW9kZSAoZG93bi91cC9ib3RoKS5cclxuICAgIGV2ZW50cy5fbW91c2VfbW92ZSA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb250YWlucyB0aGUgbGFzdCBrbm93biBtb3VzZSBtb3ZlIGV2ZW50ICh1c2VkIHdpdGhpbiB0aGUgbW91c2UgY2xhc3MpLlxyXG4gICAgZXZlbnRzLl9tb3VzZV9wcmVzcyA9IG51bGw7XHRcdFx0XHQgICAvLyBDb250YWlucyB0aGUgbGFzdCBrbm93biBtb3VzZSBwcmVzcyBldmVudCAodXNlZCB3aXRoaW4gdGhlIG1vdXNlIGNsYXNzKS5cdFxyXG4gICAgZXZlbnRzLl9yZXNwb25zZV9naXZlbiA9IGZhbHNlO1x0XHRcdCAgIC8vIFZhbGlkIHJlc3BvbnNlIHRvZ2dsZVxyXG4gICAgZXZlbnRzLl9yZXNwb25zZV90eXBlID0gLTE7XHRcdFx0XHQgICAvLyBTZXQgdHlwZSBvZiByZXNwb25zZSAoMCA9IG5vbmUsIDEgPSBrZXlib2FyZCwgMiA9IG1vdXNlLCAzID0gc291bmQpLiBcclxuICAgIGV2ZW50cy5fcmVzcG9uc2VfbGlzdCA9IG51bGw7XHQgICAgICAgICAgICAgICAgICAgLy8gSXRlbXMgdG8gcmVzcG9uZCBvbi5cclxuICAgIGV2ZW50cy5fc291bmRfZW5kZWQgPSBmYWxzZTtcdFx0XHQgICAvLyBTb3VuZCBwbGF5IGlzIGZpbmlzaGVkLlxyXG4gICAgZXZlbnRzLl90aW1lb3V0ID0gLTE7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIER1cmF0aW9uIGZvciB0aW1lb3V0LlxyXG4gICAgZXZlbnRzLl92aWRlb19lbmRlZCA9IGZhbHNlO1x0XHRcdCAgIC8vIFZpZGVvIHBsYXkgaXMgZmluaXNoZWQuXHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIGNvbnZlcnNpb24gdGFibGUgdG8gY29udmVydCBrZXljb2RlcyB0byBPcGVuU2VzYW1lIGNvZGVzLlxyXG4gICAgZXZlbnRzLktFWV9DT0RFUyA9IFsnJywnJywnJywnJywnJywnJywnaGVscCcsJycsJ2JhY2tzcGFjZScsJ3RhYicsJycsJycsJ2NsZWFyJywnZW50ZXInLCdlbnRlcl9zcGVjaWFsJywnJywnc2hpZnQnLCdjdHJsJywnYWx0JywncGF1c2UnLCAgICAgICAgIC8vIDAwICAuLiAxOVxyXG4gICAgICAgICdjYXBzJywnJywnJywnJywnJywnJywnJywnZXNjYXBlJywnJywnJywnJywnJywnc3BhY2UnLCdwYWdlIHVwJywncGFnZSBkb3duJywnZW5kJywnaG9tZScsJ2xlZnQnLCd1cCcsJ3JpZ2h0JywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIwICAuLiAzOVxyXG4gICAgICAgICdkb3duJywnc2VsZWN0JywncHJpbnQnLCdleGVjdXRlJywncHJpbnQgc2NyZWVuJywnaW5zZXJ0JywnZGVsZXRlJywnJywnMCcsJzEnLCcyJywnMycsJzQnLCc1JywnNicsJzcnLCc4JywnOScsJzonLCc7JywgICAgICAgICAgICAgICAgICAgICAgIC8vIDQwICAuLiA1OVxyXG4gICAgICAgICc8JywnPScsJz4nLCc/JywnQCcsJ2EnLCdiJywnYycsJ2QnLCdlJywnZicsJ2cnLCdoJywnaScsJ2onLCdrJywnbCcsJ20nLCduJywnbycsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDYwICAuLiA3OVxyXG4gICAgICAgICdwJywncScsJ3InLCdzJywndCcsJ3UnLCd2JywndycsJ3gnLCd5JywneicsJ2xlZnQgbWV0YScsJ3JpZ2h0IG1ldGEnLCdtZW51JywnJywnJywna3AwJywna3AxJywna3AyJywna3AzJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDgwICAuLiA5OVxyXG4gICAgICAgICdrcDQnLCdrcDUnLCdrcDYnLCdrcDcnLCdrcDgnLCdrcDknLCdrcF9tdWx0aXBseScsJ2twX3BsdXMnLCcnLCdrcF9taW51cycsJ2twX3BlcmlvZCcsJ2twX2RpdmlkZScsJ2YxJywnZjInLCdmMycsJ2Y0JywnZjUnLCdmNicsJ2Y3JywnZjgnLCAgIC8vIDEwMCAuLiAxMTlcclxuICAgICAgICAnZjknLCdmMTAnLCdmMTEnLCdmMTInLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAxMjAgLi4gMTM5XHJcbiAgICAgICAgJycsJycsJycsJycsJ251bWxvY2snLCdzY3JvbGxvY2snLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMTQwIC4uIDE1OVxyXG4gICAgICAgICdeJywnIScsJ1wiJywnIycsJyQnLCclJywnJicsJ18nLCcoJywnKScsJyonLCcrJywnfCcsJ18nLCd7JywnfScsJ34nLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAxNjAgLi4gMTc5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJzsnLCc9JywnLCcsJy0nLCcuJywnLycsJ2AnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMTgwIC4uIDE5OVxyXG4gICAgICAgICcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCdbJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIwMCAuLiAyMTlcclxuICAgICAgICAnXFxcXCcsJ10nLCdcXCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAyMjAgLi4gMjM5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJyddOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMjQwIC4uIDI1NVxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY29udmVyc2lvbiB0YWJsZSB0byBjb252ZXJ0IHNoaWZ0IGtleWNvZGVzIHRvIE9wZW5TZXNhbWUgY29kZXMuXHJcbiAgICBldmVudHMuS0VZX1NDT0RFUyA9IFsnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywncGF1c2UnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMDAgIC4uIDE5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMjAgIC4uIDM5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJyknLCchJywnQCcsJyMnLCckJywnJScsJ14nLCcmJywnKicsJygnLCcnLCc6JywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gNDAgIC4uIDU5XHJcbiAgICAgICAgJycsJysnLCcnLCcnLCcnLCdhJywnYicsJ2MnLCdkJywnZScsJ2YnLCdnJywnaCcsJ2knLCdqJywnaycsJ2wnLCdtJywnbicsJ28nLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gNjAgIC4uIDc5XHJcbiAgICAgICAgJ3AnLCdxJywncicsJ3MnLCd0JywndScsJ3YnLCd3JywneScsJ3onLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gODAgIC4uIDk5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMTAwIC4uIDExOVxyXG4gICAgICAgICcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDEyMCAuLiAxMzlcclxuICAgICAgICAnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAxNDAgLi4gMTU5XHJcbiAgICAgICAgJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJycsJ18nLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMTYwIC4uIDE3OVxyXG4gICAgICAgICcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCc8JywnJywnPicsJz8nLCd+JywnJywnJywnJywnJywnJywnJywnJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDE4MCAuLiAxOTlcclxuICAgICAgICAnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywneycsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAyMDAgLi4gMjE5XHJcbiAgICAgICAgJ3wnLCd9JywnXCInLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCcnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIyMCAuLiAyMzlcclxuICAgICAgICAnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJywnJ107ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAyNDAgLi4gMjU1XHJcbiAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBtZXRob2RzIGZvciBnZW5lcmFsIGV2ZW50IHByb2Nlc3NpbmcuICAgIFxyXG5cclxuICAgIGV2ZW50cy5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xyXG5cdC8vIEluaXRpYWxpemUgdGhlIGtleWJvYXJkIGV2ZW50IGxpc3RlbmVycy5cclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5fa2V5RG93bi5iaW5kKHRoaXMpLCBmYWxzZSk7IFxyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fa2V5VXAuYmluZCh0aGlzKSwgZmFsc2UpO1xyXG5cclxuXHQvLyBJbml0aWFsaXplIHRoZSBtb3VzZSBldmVudCBsaXN0ZW5lcnMuXHJcbiAgICBcdG9zd2ViLnJ1bm5lci5fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5fbW91c2VEb3duLmJpbmQodGhpcyksIGZhbHNlKTtcclxuXHRvc3dlYi5ydW5uZXIuX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMuX21vdXNlTW92ZS5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcblx0b3N3ZWIucnVubmVyLl9jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5fbW91c2VVcC5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcbiAgICAgICAgXHJcbiAgICBcdC8vIEluaXRpYWxpemUgdGhlIG1vdXNlIGNvbnRleHQgZXZlbnQgbGlzdGVuZXJzLlxyXG4gICAgICAgIG9zd2ViLnJ1bm5lci5fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCB0aGlzLl9tb3VzZUNvbnRleHQuYmluZCh0aGlzKSwgZmFsc2UpO1xyXG5cclxuXHQvLyBJbml0aWFsaXplIHRoZSB0aWNrIGV2ZW50IGxpc3RlbmVyLlxyXG5cdGNyZWF0ZWpzLlRpY2tlci5zZXRJbnRlcnZhbCgxNSk7XHJcblx0Y3JlYXRlanMuVGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0aWNrXCIsIHRoaXMuX3RpY2suYmluZCh0aGlzKSk7XHRcclxuICAgIH07XHJcbiBcclxuICAgIGV2ZW50cy5fZmluYWxpemUgPSBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gRmluYWxpemUgdGhlIHRpY2sgZXZlbnQgbGlzdGVuZXIuICAgICAgICAgICAgIFxyXG5cdGNyZWF0ZWpzLlRpY2tlci5yZW1vdmVFdmVudExpc3RlbmVyKFwidGlja1wiKTtcclxuXHJcblx0Ly8gRmluYWxpemUgdGhlIG1vdXNlIGNvbnRleHQgZXZlbnQgbGlzdGVuZXJzLlxyXG5cdG9zd2ViLnJ1bm5lci5fY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCB0aGlzLl9tb3VzZUNvbnRleHQsIGZhbHNlKTtcclxuXHJcblx0Ly8gRmluYWxpemUgdGhlIG1vdXNlIGV2ZW50IGxpc3RlbmVycy5cclxuXHRvc3dlYi5ydW5uZXIuX2NhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX21vdXNlRG93biwgZmFsc2UpO1xyXG5cdG9zd2ViLnJ1bm5lci5fY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5fbW91c2VNb3ZlLCBmYWxzZSk7IFxyXG5cdG9zd2ViLnJ1bm5lci5fY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMuX21vdXNlVXAsIGZhbHNlKTsgXHJcblxyXG5cdC8vIEZpbmFsaXplIHRoZSBrZXlib2FyZCBldmVudCBsaXN0ZW5lcnMuXHJcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2tleURvd24sIGZhbHNlKTtcclxuXHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuX2tleVVwLCBmYWxzZSk7XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgZXZlbnRzLl9ydW4gPSBmdW5jdGlvbihjYWxsZXIsIHRpbWVvdXQsIHJlc3BvbnNlX3R5cGUsIHJlc3BvbnNlX2xpc3QpIHtcclxuXHQvLyBTZXQgdGhlIGV2ZW50IHJ1bm5pbmcgcHJvcGVydGllcy4gICAgIFxyXG5cdHRoaXMuX2NhbGxlciA9IGNhbGxlcjtcclxuXHR0aGlzLl9yZXNwb25zZV9saXN0ID0gcmVzcG9uc2VfbGlzdDtcclxuXHR0aGlzLl9yZXNwb25zZV90eXBlID0gcmVzcG9uc2VfdHlwZTtcclxuXHR0aGlzLl90aW1lb3V0ID0gdGltZW91dDtcclxuXHJcblx0Ly8gQWN0aXZhdGUgdGhlIGV2ZW50IHJ1bm5pbmcuICBcclxuXHR0aGlzLl9yZXNwb25zZV9naXZlbiA9IGZhbHNlO1xyXG5cdHRoaXMuX3NvdW5kX2VuZGVkID0gZmFsc2U7XHRcdFx0XHRcdFx0XHQgICAgXHJcblx0dGhpcy5fdmlkZW9fZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl9hY3RpdmUgPSB0cnVlO1x0XHJcbiAgICB9O1xyXG5cclxuICAgIGV2ZW50cy5fdXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIENoZWNrIGlmIHRoZSBkdXJhdGlvbiBpcyBmaW5pc2RoZWQuXHJcbiAgIFx0aWYgKCgodGhpcy5fdGltZW91dCA9PT0gLTEpICYmICgodGhpcy5fcmVzcG9uc2VfZ2l2ZW4gPT09IHRydWUpIHx8ICh0aGlzLl9zb3VuZF9lbmRlZCA9PT0gdHJ1ZSkgfHwgKHRoaXMuX3ZpZGVvX2VuZGVkID09PSB0cnVlKSkpIHx8XHJcbiAgICAgICAgICAgICgodGhpcy5fdGltZW91dCA+IDApICYmICgodGhpcy5fcmVzcG9uc2VfdHlwZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX0tFWUJPQVJEKSB8fCAodGhpcy5fcmVzcG9uc2VfdHlwZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlJFU1BPTlNFX01PVVNFKSkgJiYgKHRoaXMuX3Jlc3BvbnNlX2dpdmVuID09PSB0cnVlKSkgfHxcclxuICAgICAgICAgICAgKCgodGhpcy5fdGltZW91dCA+IDApICYmICh0aGlzLl9jdXJyZW50X2l0ZW0uY2xvY2sudGltZSgpIC0gdGhpcy5fY3VycmVudF9pdGVtLmV4cGVyaW1lbnQudmFycy5nZXQoJ3RpbWVfJyArIHRoaXMuX2N1cnJlbnRfaXRlbS5uYW1lKSkgPiB0aGlzLl90aW1lb3V0KSkpIHtcclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBzdGF0dXMgb2YgdGhlIGN1cnJlbnQgaXRlbSB0byBmaW5hbGl6ZS5cclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudF9pdGVtLl9zdGF0dXMgPSBvc3dlYi5jb25zdGFudHMuU1RBVFVTX0ZJTkFMSVpFO1xyXG4gIFx0fVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGN1cnJlbnQgaXRlbS5cclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudF9pdGVtLnVwZGF0ZSgpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBldmVudHMuX2NvbXBsZXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gRGlzYWJsZSB0aGUgdGlja2VyXHJcbiAgICAgICAgdGhpcy5fYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBpdGVtcyBmcm9tIHRoZSBnZW5lcmFsIHN0YWNrLlxyXG5cdG9zd2ViLml0ZW1fc3RhY2sucG9wKCk7XHJcblxyXG4gICAgICAgIC8vIEV4ZWN1dGUgdGhlIHBvc3QtcnVuIHBoYXNlIGFmdGVyIGR1cmF0aW9uIGlzIGZpbmlzaGVkIG9yIHJlc3BvbnNlIGlzIHJlY2VpdmVkLlxyXG5cdHRoaXMuX2N1cnJlbnRfaXRlbS5jb21wbGV0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIG1ldGhvZHMgZm9yIGtleWJvYXJkIGV2ZW50IHByb2Nlc3NpbmcuXHJcblx0XHJcbiAgICBldmVudHMuX2NvbnZlcnRLZXlDb2RlID0gZnVuY3Rpb24oZXZlbnQpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gQ2hlY2sgZm9yIHNwZWNpYWwgY2hhcmFjdGVyc1xyXG4gICAgICAgIHZhciBrZXkgPSAnJztcclxuICAgICAgICBpZiAoKGV2ZW50LnNoaWZ0S2V5ID09PSB0cnVlKSAmJiAoZXZlbnQua2V5Q29kZSAhPT0gMTYpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gU2hpZnQga2V5IHByZXNzZWQgd2l0aCBvdGhlciBrZXksIHNvIGNvbnZlcnQgc2hpZnQga2V5cy5cclxuICAgICAgICAgICAga2V5ID0gdGhpcy5LRVlfU0NPREVTW2V2ZW50LmtleUNvZGVdO1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgZWxzZSBpZiAoKGV2ZW50LnNoaWZ0S2V5ID09PSB0cnVlKSAmJiAoZXZlbnQua2V5Q29kZSA9PT0gMTYpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gU2hpZnQgY29kZSBwcmVzc2VkLCBjaGVjayBmb3IgbG9jYXRpb24gKGxlZnQgb3IgcmlnaHQpXHJcbiAgICAgICAgICAgIGtleSA9IChldmVudC5sb2NhdGlvbiA9PSAxKSA/ICdsc2hpZnQnIDogJ3JzaGlmdCc7IFxyXG4gICAgICAgIH0gXHJcbiAgICAgICAgZWxzZSBpZiAoKGV2ZW50LmN0cmxLZXkgPT09IHRydWUpICYmIChldmVudC5rZXlDb2RlID09PSAxNykpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBDdHJsIGNvZGUgcHJlc3NlZCwgY2hlY2sgZm9yIGxvY2F0aW9uIChsZWZ0IG9yIHJpZ2h0KVxyXG4gICAgICAgICAgICBrZXkgPSAoZXZlbnQubG9jYXRpb24gPT0gMSkgPyAnbGN0cmwnIDogJ3JjdHJsJzsgXHJcbiAgICAgICAgfSBcclxuICAgICAgICBlbHNlIGlmICgoZXZlbnQuYWx0S2V5ID09PSB0cnVlKSAmJiAoZXZlbnQua2V5Q29kZSA9PT0gMTgpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQWx0IGNvZGUgcHJlc3NlZCwgY2hlY2sgZm9yIGxvY2F0aW9uIChsZWZ0IG9yIHJpZ2h0KVxyXG4gICAgICAgICAgICBrZXkgPSAoZXZlbnQubG9jYXRpb24gPT0gMSkgPyAnbGFsdCcgOiAncmFsdCc7IFxyXG4gICAgICAgIH0gXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQ29udmVydCBzdGFuZGFyZCBrZXljb2RlLlxyXG4gICAgICAgICAgICBrZXkgID0gdGhpcy5LRVlfQ09ERVNbZXZlbnQua2V5Q29kZV07XHJcbiAgICAgICAgfSBcclxuICAgICAgICBcclxuICAgICAgICAvLyBSZXR1cm4gZnVuY3Rpb24gcmVzdWx0LlxyXG4gICAgICAgIHJldHVybiBrZXk7XHJcbiAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgZXZlbnRzLl9rZXlEb3duID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAvLyBTdG9yZSB0aGUga2V5Ym9hcmQgZXZlbnQuICAgIFxyXG5cdHRoaXMua2V5Ym9hcmRfZXZlbnQgPSBldmVudDtcclxuXHJcbiAgICAgICAgLy8gT25seSBzZWxlY3QgdGhpcyBldmVudCB3aGVuIHRoZSBjb2xsZWN0aW9uIG1vZGUgaXMgc2V0IGZvciB0aGlzLlxyXG4gICAgXHRpZiAoKHRoaXMuX2tleWJvYXJkX21vZGUgPT09IG9zd2ViLmNvbnN0YW50cy5QUkVTU0VTX09OTFkpIHx8ICh0aGlzLl9rZXlib2FyZF9tb2RlID09PSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19BTkRfUkVMRUFTRVMpKSB7XHJcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGV2ZW50LlxyXG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzS2V5Ym9hcmRFdmVudChldmVudCwgMSk7XHJcbiAgICBcdH0gXHJcbiAgICB9O1x0IFxyXG5cclxuICAgIGV2ZW50cy5fa2V5VXAgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgXHQvLyBPbmx5IHNlbGVjdCB0aGlzIGV2ZW50IHdoZW4gdGhlIGNvbGxlY3Rpb24gbW9kZSBpcyBzZXQgZm9yIHRoaXMuXHJcbiAgICBcdGlmICgodGhpcy5fa2V5Ym9hcmRfbW9kZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlJFTEVBU0VTX09OTFkpIHx8ICh0aGlzLl9rZXlib2FyZF9tb2RlID09PSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19BTkRfUkVMRUFTRVMpKSB7XHJcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGV2ZW50LlxyXG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzS2V5Ym9hcmRFdmVudChldmVudCwgMCk7XHJcbiAgICBcdH0gXHQgXHJcbiAgICB9O1xyXG5cclxuICAgIGV2ZW50cy5fcHJvY2Vzc0tleWJvYXJkRXZlbnQgPSBmdW5jdGlvbihldmVudCwga2V5Ym9hcmRfc3RhdGUpIHtcclxuICAgICAgICAvLyBDcmVhdGUgYSBuZXcga2V5Ym9hcmQgcmVzcG9uc2Ugb2JqZWN0LlxyXG4gICAgICAgIHZhciBLZXlib2FyZFJlc3BvbnNlcyA9IHsnZXZlbnQnOiBldmVudCwgJ3J0VGltZSc6ICBvc3dlYi5ydW5uZXIuZXhwZXJpbWVudC5jbG9jay50aW1lKCksICdzdGF0ZSc6IGtleWJvYXJkX3N0YXRlLCAndHlwZSc6IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRH07XHJcbiAgICAgIFxyXG4gICAgICAgIC8vIENvbnZlcnQgcmVzcG9uc2UgdG8gcHJvcGVyIGtleWJvYXJkIHRva2VuLiBcclxuICAgICAgICBLZXlib2FyZFJlc3BvbnNlcy5yZXNwID0gdGhpcy5fY29udmVydEtleUNvZGUoZXZlbnQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFByb2Nlc3MgdGhlIHJlc3BvbnNlIHRvIHRoZSBjdXJyZW50IG9iamVjdC5cclxuICAgICAgICBpZiAoKHRoaXMuX3Jlc3BvbnNlX3R5cGUgPT09IG9zd2ViLmNvbnN0YW50cy5SRVNQT05TRV9LRVlCT0FSRCkgJiYgKCh0aGlzLl9yZXNwb25zZV9saXN0ID09PSBudWxsKSB8fCAodGhpcy5fcmVzcG9uc2VfbGlzdC5pbmRleE9mKEtleWJvYXJkUmVzcG9uc2VzLnJlc3ApID49IDApKSkge1xyXG4gICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBjdXJyZW50IGl0ZW0uXHJcblx0ICAgIGlmICh0aGlzLl9jdXJyZW50X2l0ZW0gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIHJlc3BvbnNlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9pdGVtLnVwZGF0ZV9yZXNwb25zZShLZXlib2FyZFJlc3BvbnNlcyk7XHJcbiAgICAgICAgICAgIH0gXHQgXHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNldCB0aGUgdmFsaWQgcmVzcG9uc2UgZ2l2ZW4gdG9nZ2xlLlxyXG4gICAgICAgICAgICB0aGlzLl9yZXNwb25zZV9naXZlbiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHRcclxuICAgIC8vIERlZmluaXRpb24gb2YgbWV0aG9kcyBmb3IgbW91c2UgZXZlbnQgcHJvY2Vzc2luZy5cclxuIFxyXG4gICAgZXZlbnRzLl9tb3VzZUNvbnRleHQgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgIC8vIFByZXZlbnQgZGVmYXVsdCBhY3Rpb24uIFxyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUmV0dXJuIGZhbHNlIHRvIHByZXZlbnQgdGhlIGNvbnRleHQgbWVudSBmcm9tIHB1c2hpbmcgdXAuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTsgICAgICAgICAgICBcclxuIFxyXG4gICAgZXZlbnRzLl9tb3VzZURvd24gPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgIC8vIFN0b3JlIHRoZSBtb3VzZSBwcmVzcyBzdGF0dXMgZm9yIHVzZSBpbiB0aGUgbW91c2VlIGNsYXNzLlxyXG4gICAgICAgIHRoaXMuX21vdXNlX3ByZXNzID0gZXZlbnQ7XHJcblxyXG5cdC8vIE9ubHkgc2VsZWN0IHRoaXMgZXZlbnQgd2hlbiB0aGUgY29sbGVjdGlvbiBtb2RlIGlzIHNldCBmb3IgdGhpcy5cclxuICAgIFx0aWYgKCh0aGlzLl9tb3VzZV9tb2RlID09PSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19PTkxZKSB8fCAodGhpcy5fbW91c2VfbW9kZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlBSRVNTRVNfQU5EX1JFTEVBU0VTKSkge1xyXG4gICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBldmVudC5cclxuICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc01vdXNlRXZlbnQoZXZlbnQsIDEpO1xyXG4gICAgXHR9XHRcclxuICAgIH07XHRcclxuXHJcbiAgICBldmVudHMuX21vdXNlTW92ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgLy8gU3RvcmUgdGhlIG1vdXNlIG1vdmUgZXZlbnQgYW5kIGl0cyB0aW1lc3RhbXAgZm9yIHVzZSBpbiB0aGUgbW91c2UgY2xhc3MuXHJcbiAgICAgICAgdGhpcy5fbW91c2VfbW92ZSA9IHsnZXZlbnQnOiBldmVudCwgJ3J0VGltZSc6IG9zd2ViLnJ1bm5lci5leHBlcmltZW50LmNsb2NrLnRpbWUoKX07XHJcbiAgICB9O1x0XHJcblxyXG4gICAgZXZlbnRzLl9tb3VzZVVwID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuXHQvLyBPbmx5IHNlbGVjdCB0aGlzIGV2ZW50IHdoZW4gdGhlIGNvbGxlY3Rpb24gbW9kZSBpcyBzZXQgZm9yIHRoaXMuXHJcbiAgICBcdGlmICgodGhpcy5fbW91c2VfbW9kZSA9PT0gb3N3ZWIuY29uc3RhbnRzLlJFTEVBU0VTX09OTFkpIHx8ICh0aGlzLl9tb3VzZV9tb2RlID09PSBvc3dlYi5jb25zdGFudHMuUFJFU1NFU19BTkRfUkVMRUFTRVMpKSB7XHJcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGV2ZW50LlxyXG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzTW91c2VFdmVudChldmVudCwgMCk7XHJcbiAgICBcdH0gXHRcclxuICAgIH07XHJcblxyXG4gICAgZXZlbnRzLl9wcm9jZXNzTW91c2VFdmVudCA9IGZ1bmN0aW9uKGV2ZW50LCBtb3VzZV9zdGF0ZSkge1xyXG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBtb3VzZSByZXNwb25zZSBvYmplY3QuXHJcbiAgICAgICAgdmFyIE1vdXNlUmVzcG9uc2VzID0geydldmVudCc6IGV2ZW50LCAncnRUaW1lJzogb3N3ZWIucnVubmVyLmV4cGVyaW1lbnQuY2xvY2sudGltZSgpLCAnc3RhdGUnOiBtb3VzZV9zdGF0ZSwgJ3R5cGUnOiBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfTU9VU0V9O1xyXG4gICAgIFx0XHJcbiAgICAgXHQvLyBBZGp1c3QgbW91c2UgcmVzcG9uc2UuICBcclxuICAgICBcdE1vdXNlUmVzcG9uc2VzLnJlc3AgPSBTdHJpbmcoZXZlbnQuYnV0dG9uICsgMSk7ICBcclxuICAgICBcdCBcclxuICAgICAgICAvLyBQcm9jZXNzIHRoZSByZXNwb25zZSB0byB0aGUgY3VycmVudCBvYmplY3QuXHJcbiAgICAgICAgaWYgKCh0aGlzLl9yZXNwb25zZV90eXBlID09PSBvc3dlYi5jb25zdGFudHMuUkVTUE9OU0VfTU9VU0UpICYmICgodGhpcy5fcmVzcG9uc2VfbGlzdCA9PT0gbnVsbCkgfHwgKHRoaXMuX3Jlc3BvbnNlX2xpc3QuaW5kZXhPZihNb3VzZVJlc3BvbnNlcy5yZXNwKSA+PSAwKSkpIHtcclxuICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgcmVzcG9uc2UgdG8gdGhlIGN1cnJlbnQgb2JqZWN0LlxyXG4gICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudF9pdGVtICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X2l0ZW0udXBkYXRlX3Jlc3BvbnNlKE1vdXNlUmVzcG9uc2VzKTtcclxuICAgICAgICAgICAgfSAgIFxyXG5cclxuICAgICAgICAgICAgLy8gU2V0IHRoZSB2YWxpZCByZXNwb25zZSBnaXZlbiB0b2dnbGUuXHJcbiAgICAgICAgICAgIHRoaXMuX3Jlc3BvbnNlX2dpdmVuID0gdHJ1ZTtcclxuXHR9XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBtZXRob2RzIGZvciBzb3VuZCBldmVudCBwcm9jZXNzaW5nLlxyXG5cclxuICAgIGV2ZW50cy5fYXVkaW9FbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIElmIGR1cmF0aW9uIGlzZXF1YWwgdG8gc291bmQgZXhpdCB0aGUgc291bmQgaXRlbS5cclxuICAgICAgICBvc3dlYi5ldmVudHMuX3NvdW5kX2VuZGVkID0gdHJ1ZTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBtZXRob2RzIGZvciB2aWRlbyBldmVudCBwcm9jZXNzaW5nLlxyXG5cclxuICAgIGV2ZW50cy5fdmlkZW9FbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIG9zd2ViLmV2ZW50cy5fdmlkZW9fZW5kZWQgPSB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBldmVudHMuX3ZpZGVvUGxheSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgbWV0aG9kcyBmb3IgdGljayBldmVudCBwcm9jZXNzaW5nICh0aW1pbmcpLlxyXG4gXHJcbiAgICBldmVudHMuX3RpY2sgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgXHQvLyBPbmx5IGNoZWNrIGZvciBzdGF0dXMgaWYgdGhlcmUgaXMgYSBjdXJyZW50IGl0ZW0gYW5kIHRoZSB0aWNrZXIgaXMgYWN0aXZhdGVkLlxyXG4gICAgICAgIGlmICgodGhpcy5fY3VycmVudF9pdGVtICE9PSBudWxsKSAmJiAodGhpcy5fYWN0aXZlID09PSB0cnVlKSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnRfaXRlbS5fc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIG9zd2ViLmNvbnN0YW50cy5TVEFUVVNfRklOQUxJWkU6XHJcbiAgICAgICAgICAgICAgICAgICAvLyBFbmQgYWN0aW9uLiBDb21wbGV0ZSBjdXJyZW50IGFjdGl2ZSBpdGVtLlxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50cy5fY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cdFx0ZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IGFjdGlvbiwgdXBkYXRlIHNlY3Rpb24gb2YgdGhlIGN1cnJlbnQgYWN0aXZlIGl0ZW0uXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRzLl91cGRhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG5cdH1cclxuICAgIH07XHQgXHJcblxyXG4gICAgLy8gQmluZCB0aGUgZXZlbnRzIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5ldmVudHMgPSBldmVudHM7XHJcbn0oKSk7XHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBQYXJhbWV0ZXJzLlxyXG4gICAgZnVuY3Rpb24gcGFyYW1ldGVycygpIHtcclxuXHR0aHJvdyAnVGhlIGNsYXNzIHBhcmFtZXRlcnMgY2Fubm90IGJlIGluc3RhbnRpYXRlZCEnO1xyXG4gICAgfSBcclxuXHJcbiAgICAvLyBEZWZpbmUgdGhlIHByaXZhdGUgcHJvcGVydGllcy4gXHJcbiAgICBwYXJhbWV0ZXJzLl9pdGVtQ291bnRlciA9IDA7XHJcbiAgICBwYXJhbWV0ZXJzLl9wYXJhbWV0ZXJzICA9IG5ldyBBcnJheSgpO1xyXG5cclxuICAgIC8vIERlZmluZSB0aGUgcHVibGljIHByb3BlcnRpZXMuIFxyXG4gICAgcGFyYW1ldGVycy5kaXNwbGF5U3VtbWFyeSAgID0gZmFsc2U7XHJcbiAgICBwYXJhbWV0ZXJzLnVzZURlZmF1bHRWYWx1ZXMgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIGluaXRpYWxpemUgcGFyYW1ldGVycy4gICBcclxuXHJcbiAgICBwYXJhbWV0ZXJzLl9pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIFx0Ly8gU2V0IHByb3BlcnRpZXMgaWYgZGVmaW5lZC5cclxuICAgIFx0dmFyIHBhcmFtZXRlciA9IHtkYXRhVHlwZTogJzAnLCBkZWZhdWx0VmFsdWU6ICcwJywgbmFtZTogJ3N1YmplY3RfbnInLCBwcm9tcHQ6ICdQbGVhc2UgZW50ZXIgdGhlIHN1YmplY3QgbnVtYmVyJywgcHJvbXB0RW5hYmxlZDogdHJ1ZX07XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQWRkIHRoZSBzdWJqZWN0IHBhcmFtZXRlciB0byB0aGUgcGFyYW1ldGVycyBsaXN0LlxyXG4gICAgICAgIHRoaXMuX3BhcmFtZXRlcnMucHVzaChwYXJhbWV0ZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIHByb2Nlc3MgcGFyYW1ldGVycy4gICBcclxuICAgIFxyXG4gICAgcGFyYW1ldGVycy5fcHJvY2Vzc1BhcmFtZXRlcnMgPSBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gUHJvY2VzcyBhbGwgaXRlbXMgZm9yIHdoaWNoIGEgdXNlciBpbnB1dCBpcyByZXF1aXJlZC5cclxuICAgICAgICBpZiAodGhpcy5faXRlbUNvdW50ZXIgPCB0aGlzLl9wYXJhbWV0ZXJzLmxlbmd0aCkge1x0XHJcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIFBhcmFtZXRlci5cclxuICAgICAgICAgICAgaWYgKHRoaXMudXNlRGVmYXVsdFZhbHVlcyA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc1BhcmFtZXRlcih0aGlzLl9wYXJhbWV0ZXJzW3RoaXMuX2l0ZW1Db3VudGVyXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBUcmFuc2ZlciB0aGUgc3RhcnR1cCBpbmZvIHRvIHRoZSBjb250ZXh0LlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNmZXJQYXJhbWV0ZXJzKCk7XHJcbiAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBBbGwgaXRlbXMgaGF2ZSBiZWVuIHByb2Nlc3NlZCwgY29udGluZSB0aGUgUnVubmVyIHByb2Nlc3NpbmcuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3BsYXlTdW1tYXJ5ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIC8vIFNob3cgYSBzdW1tYXJ5IG9mIHRoZSB0aGUgc3RhcnR1cCBpbmZvcm1hdGlvbi4gXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zaG93UGFyYW1ldGVycygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgeyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gVHJhbnNmZXIgdGhlIHN0YXJ0dXAgaW5mbyB0byB0aGUgY29udGV4dC5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zZmVyUGFyYW1ldGVycygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBwYXJhbWV0ZXJzLl9wcm9jZXNzUGFyYW1ldGVyID0gZnVuY3Rpb24ocGFyYW1ldGVyKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgYSB1c2VyIHJlcXVlc3QgaXMgcmVxdWlyZWQuXHJcbiAgICAgICAgaWYgKHBhcmFtZXRlci5wcm9tcHRFbmFibGVkID09IHRydWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fc2hvd0RpYWxvZyhwYXJhbWV0ZXIuZGF0YVR5cGUpO1xyXG5cclxuICAgICAgICAgICAgLy8gU2V0IHRoZSBkaWFsb2cgaW50ZXJmYWNlLlxyXG4gICAgICAgICAgICBpZiAocGFyYW1ldGVyLnJlc3BvbnNlID09ICcnKSB7XHJcbiAgICAgICAgICAgIFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwZGlhbG9naW5wdXQnKS52YWx1ZSA9IHBhcmFtZXRlci5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwZGlhbG9naW5wdXQnKS52YWx1ZSA9IHBhcmFtZXRlci5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3hoZWFkJykuaW5uZXJIVE1MID0gcGFyYW1ldGVyLnByb21wdDtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwYnV0dG9ueWVzJykub25jbGljayA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSByZXNwb25zZSBpbmZvcm1hdGlvblxyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyLnJlc3BvbnNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwZGlhbG9naW5wdXQnKS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gQ2xvc2UgdGhlIGRpYWxvZy5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVEaWFsb2coKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBJbmNyZWFzZSB0aGUgY291bnRlci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1Db3VudGVyKys7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ29udGludWUgcHJvY2Vzc2luZy5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NQYXJhbWV0ZXJzKCk7XHJcblxyXG4gICAgICAgICAgICB9LmJpbmQodGhpcyk7XHJcbiAgICAgICAgXHRcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwYnV0dG9ubm8nKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBDbG9zZSB0aGUgZGlhbG9nLlxyXG5cdCAgICAgICAgdGhpcy5faGlkZURpYWxvZygpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgIFx0XHQvLyBGaW5hbGl6ZSB0aGUgaW50cm9zY3JlZW4gZWxlbWVudHMuXHJcblx0XHRvc3dlYi5ydW5uZXIuX2V4aXQoKTtcclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gQXNzaWduIGRlZmF1bHQgdmFsdWUgdG8gdGhlIFN0YXJ0dXAgaXRlbS5cclxuICAgICAgICAgICAgcGFyYW1ldGVyLnJlc3BvbnNlID0gcGFyYW1ldGVyLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gSW5jcmVhc2UgdGhlIGNvdW50ZXIuXHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1Db3VudGVyKys7XHJcblxyXG4gICAgICAgICAgICAvLyBDb250aW51ZSBwcm9jZXNzaW5nLlxyXG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzUGFyYW1ldGVycygpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICB9O1xyXG5cclxuICAgIHBhcmFtZXRlcnMuX3Nob3dQYXJhbWV0ZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGhlYWQnKS5pbm5lckhUTUwgPSAnU3VtbWFyeSBvZiBzdGFydHVwIGluZm8nO1xyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGJ1dHRvbnllcycpLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gQ2xvc2UgdGhlIGRpYWxvZy5cclxuXHQgICAgdGhpcy5faGlkZURpYWxvZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVHJhbnNmZXIgdGhlIHN0YXJ0dXAgaW5mbyB0byB0aGUgY29udGV4dC5cclxuICAgICAgICAgICAgdGhpcy5fdHJhbnNmZXJQYXJhbWV0ZXJzKCk7IFxyXG4gICAgICAgIFxyXG4gICAgICAgIH0uYmluZCh0aGlzKTsgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwYnV0dG9ubm8nKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIENsb3NlIHRoZSBkaWFsb2cuXHJcbiAgICAgICAgICAgIHRoaXMuX2hpZGVEaWFsb2coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gUmVzZXQgdGhlIGl0ZW0gY291bnRlci5cclxuICAgICAgICAgICAgdGhpcy5faXRlbUNvdW50ZXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gUmVzdGF0IHRoZSBpbnB1dCBwcm9jZXNzLiAgICBcclxuICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc1BhcmFtZXRlcnMoKTsgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0uYmluZCh0aGlzKTsgICAgXHJcblxyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGJ1dHRvbmNhbmNlbCcpLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gQ2xvc2UgdGhlIGRpYWxvZy5cclxuXHQgICAgdGhpcy5faGlkZURpYWxvZygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAvLyBGaW5hbGl6ZSB0aGUgaW50cm9zY3JlZW4gZWxlbWVudHMuXHJcbiAgICAgICAgICAgIG9zd2ViLnJ1bm5lci5fZXhpdCgpO1xyXG4gICAgICAgIH0uYmluZCh0aGlzKTsgICAgXHJcbiAgICAgICBcclxuICBcdC8vIFNldCB0aGUgZGlhbG9nIGludGVyZmFjZS5cclxuICAgICAgICB2YXIgVG1wU3RyaW5nID0gJyc7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7aSA8IHRoaXMuX3BhcmFtZXRlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKCh0aGlzLl9wYXJhbWV0ZXJzW2ldLmVuYWJsZWQgIT0gMCkgJiYgKHRoaXMuX3BhcmFtZXRlcnNbaV0ucHJvbXB0RW5hYmxlZCAhPSAwKSkge1xyXG5cdFx0VG1wU3RyaW5nID0gVG1wU3RyaW5nICsgdGhpcy5fcGFyYW1ldGVyc1tpXS5uYW1lICsgJzogJyArIHRoaXMuX3BhcmFtZXRlcnNbaV0ucmVzcG9uc2UgKyAnXFxyXFxuJzsgIFx0ICAgICAgICBcdFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXBkaWFsb2d0ZXh0YXJlYScpLmlubmVySFRNTCA9IFRtcFN0cmluZztcclxuICAgIH07XHJcblxyXG4gICAgcGFyYW1ldGVycy5fdHJhbnNmZXJQYXJhbWV0ZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIFRyYW5zZmVyIHRoZSBzdGFydHVwIGluZm8gaXRlbXMgdG8gdGhlIGNvbnRleHQuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7aSA8IHRoaXMuX3BhcmFtZXRlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgb3N3ZWIucnVubmVyLmV4cGVyaW1lbnQudmFycy5zZXQodGhpcy5fcGFyYW1ldGVyc1tpXS5uYW1lLHRoaXMuX3BhcmFtZXRlcnNbaV0ucmVzcG9uc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuXHQvLyBQYXJhbWV0ZXJzIGFyZSBwcm9jZXNzZWQsIG5leHQgcGhhc2UuXHJcbiAgICAgICAgb3N3ZWIucnVubmVyLl9wcmVwYXJlU3RhcnRTY3JlZW4oKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8qXHJcbiAgICAgKiBEZWZpbml0aW9uIG9mIGNsYXNzIG1ldGhvZHMgKGRpYWxvZ3MpLiAgIFxyXG4gICAgICovXHJcbiAgICAgXHJcbiAgICBwYXJhbWV0ZXJzLl9zaG93RGlhbG9nID0gZnVuY3Rpb24oZGlhbG9nX3R5cGUpIHtcclxuICAgICAgICB2YXIgZGlhbG9nb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dvdmVybGF5Jyk7XHJcblx0dmFyIGRpYWxvZ2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3gnKTtcclxuXHRcdCAgICAgICAgICAgICAgICBcclxuXHRkaWFsb2dvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcblx0ZGlhbG9nb3ZlcmxheS5zdHlsZS5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKyBcInB4XCI7XHJcblx0ZGlhbG9nYm94LnN0eWxlLmxlZnQgPSAod2luZG93LmlubmVyV2lkdGggLyAyKSAtICg0MDAgKiAuNSkgKyBcInB4XCI7XHJcblx0ZGlhbG9nYm94LnN0eWxlLnRvcCA9IFwiMjAwcHhcIjtcclxuXHRkaWFsb2dib3guc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lXCI7XHJcblxyXG5cdHN3aXRjaCAoZGlhbG9nX3R5cGUpXHJcbiAgICAgICAge1xyXG5cdCAgICBjYXNlIFwiMFwiOiBcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3hib2R5JykuaW5uZXJIVE1MID0gJzxpbnB1dCBpZD1cInFwZGlhbG9naW5wdXRcIj48L2lucHV0Pic7XHJcblx0ICAgIFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGZvb3QnKS5pbm5lckhUTUwgPSAnPGJ1dHRvbiBpZD1cInFwYnV0dG9ueWVzXCI+T2s8L2J1dHRvbj48YnV0dG9uIGlkPVwicXBidXR0b25ub1wiPkNhbmNlbDwvYnV0dG9uPic7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXBkaWFsb2dpbnB1dCcpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiMVwiOiBcclxuXHQgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3hib2R5JykuaW5uZXJIVE1MID0gJzxpbnB1dCBpZD1cInFwZGlhbG9naW5wdXRcIj48L2lucHV0Pic7XHJcblx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhbG9nYm94Zm9vdCcpLmlubmVySFRNTCA9ICc8YnV0dG9uIGlkPVwicXBidXR0b255ZXNcIj5PazwvYnV0dG9uPjxidXR0b24gaWQ9XCJxcGJ1dHRvbm5vXCI+Q2FuY2VsPC9idXR0b24+JztcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxcGRpYWxvZ2lucHV0JykuZm9jdXMoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCIyXCI6IFxyXG5cdCAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGJvZHknKS5pbm5lckhUTUwgPSAnPGlucHV0IGlkPVwicXBkaWFsb2dpbnB1dFwiPjwvaW5wdXQ+JztcclxuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaWFsb2dib3hmb290JykuaW5uZXJIVE1MID0gJzxidXR0b24gaWQ9XCJxcGJ1dHRvbnllc1wiPk9rPC9idXR0b24+PGJ1dHRvbiBpZD1cInFwYnV0dG9ubm9cIj5DYW5jZWw8L2J1dHRvbj4nO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FwZGlhbG9naW5wdXQnKS5mb2N1cygpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIjNcIjogXHJcblx0ICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhbG9nYm94Ym9keScpLmlubmVySFRNTCA9ICc8dGV4dGFyZWEgaWQ9XCJxcGRpYWxvZ3RleHRhcmVhXCI+PC90ZXh0YXJlYT4nO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGZvb3QnKS5pbm5lckhUTUwgPSAnPGJ1dHRvbiBpZD1cInFwYnV0dG9ueWVzXCI+WWVzPC9idXR0b24+PGJ1dHRvbiBpZD1cInFwYnV0dG9ubm9cIj5ObzwvYnV0dG9uPjxidXR0b24gaWQ9XCJxcGJ1dHRvbmNhbmNlbFwiPkNhbmNlbDwvYnV0dG9uPic7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXBkaWFsb2d0ZXh0YXJlYScpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cdH1cclxuICAgIH07XHJcblx0IFxyXG4gICAgcGFyYW1ldGVycy5faGlkZURpYWxvZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGRpYWxvZ292ZXJsYXkuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cdGRpYWxvZ2JveC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcblx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpYWxvZ2JveGJvZHknKS5pbm5lckhUTUwgPSAnJztcclxuXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlhbG9nYm94Zm9vdCcpLmlubmVySFRNTCA9ICcnO1xyXG4gICAgfTtcdFxyXG5cclxuICAgIC8vIEJpbmQgdGhlIHBhcmFtZXRlcnMgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzO1xyXG59KCkpO1xyXG4iLCJcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiB0aGUgY2xhc3Mgc2Vzc2lvbi5cclxuICAgIGZ1bmN0aW9uIHBhcnNlcigpIHtcclxuXHR0aHJvdyAnVGhlIGNsYXNzIHBhcnNlciBjYW5ub3QgYmUgaW5zdGFudGlhdGVkISc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIHByb3BlcnRpZXMuXHJcbiAgICBwYXJzZXIuX2FzdF90cmVlID0gbnVsbDsgICAgXHJcbiAgICBwYXJzZXIuX2N1cnJlbnRfbm9kZSA9IG51bGw7XHJcbiAgICBwYXJzZXIuX2lubGluZV9zY3JpcHQgPSBudWxsO1xyXG4gICAgcGFyc2VyLl9zdGF0dXMgPSAwOyAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBwcmVwYXJlIGN5Y2xlLiAgIFxyXG5cclxuICAgIHBhcnNlci5fcHJlcGFyZSA9IGZ1bmN0aW9uKHNjcmlwdCkge1xyXG4gICAgICAgIGlmIChzY3JpcHQgIT09ICcnKSB7XHJcbiAgICAgICAgICAgIHZhciBsb2NhdGlvbnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIHBhcnNlRm4gPSBmaWxiZXJ0X2xvb3NlLnBhcnNlX2RhbW1pdDtcclxuICAgICAgICAgICAgdmFyIHJhbmdlcyA9IGZhbHNlO1xyXG4gICAgICAgIFx0XHRcclxuXHQgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZhciBjb2RlID0gc2NyaXB0O1xyXG4gICAgICAgICAgIFx0dmFyIGFzdCA9IHBhcnNlRm4oY29kZSwgeyBsb2NhdGlvbnM6IGxvY2F0aW9ucywgcmFuZ2VzOiByYW5nZXMgfSk7XHJcblx0ICAgICAgICByZXR1cm4gYXN0O1xyXG4gICAgXHQgICAgfVxyXG4gICAgICAgXHQgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBcdGNvbnNvbGUubG9nKCdlcnJvcicpO1xyXG4gICAgICAgIFx0Y29uc29sZS5sb2coZS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlXHJcblx0e1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHQgICBcdFxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBnZW5lcmFsIHBhcnNlciBmdW5jdGlvbnMuXHJcblxyXG4gICAgcGFyc2VyLl9zZXRfcmV0dXJuX3ZhbHVlID0gZnVuY3Rpb24obm9kZSwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgaW5kZXggPSAwO1xyXG4gICAgICAgIHdoaWxlICh0eXBlb2Ygbm9kZVsncmV0dXJudmFsdWUnICsgU3RyaW5nKGluZGV4KV0gIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgfSAgICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIHJldHVybiB2YWx1ZVxcXHJcbiAgICAgICAgbm9kZVsncmV0dXJudmFsdWUnICsgU3RyaW5nKGluZGV4KV0gPSB2YWx1ZTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzIC0gbm9kZSBwcm9jZXNzaW5nLlxyXG4gICAgXHJcbiAgICBwYXJzZXIuX25vZGVfYmluYXJ5X2V4cHJlc3Npb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHN0YXR1cyBwcm9wZXJ0eS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwICA6IHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXM7IFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFByb2Nlc3MgdGhlIGN1cnJlbnQgc3RhdHVzLlxyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cykge1xyXG4gICAgICAgICAgICBjYXNlIDA6IFxyXG4gICAgICAgICAgICAgICAgLy8gcHJvY2VzcyByaWdodCBleHByZXNzaW9uO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUucmlnaHQucGFyZW50ID0gdGhpcy5fY3VycmVudF9ub2RlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLnJpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAxOiBcclxuICAgICAgICAgICAgICAgIC8vIHByb2Nlc3MgcmlnaHQgZXhwcmVzc2lvbjtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmxlZnQucGFyZW50ID0gdGhpcy5fY3VycmVudF9ub2RlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLmxlZnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlIDI6IFxyXG4gICAgICAgICAgICAgICAgdmFyIGxlZnQscmlnaHQ7XHJcbiAgICAgICAgICAgICAgICBpZiAgKHR5cGVvZiB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMF0gPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByaWdodCA9IHdpbmRvd1t0aGlzLl9jdXJyZW50X25vZGUucmV0dXJudmFsdWUwXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBsZWZ0LHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgaWYgICh0eXBlb2Ygd2luZG93W3RoaXMuX2N1cnJlbnRfbm9kZS5yZXR1cm52YWx1ZTFdID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0ID0gdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0ID0gd2luZG93W3RoaXMuX2N1cnJlbnRfbm9kZS5yZXR1cm52YWx1ZTFdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFNlbGVjdCB0aGUgYmluYXJ5IG9wZXJhdG9yIHRvIHBlcmZvcm0uXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnRfbm9kZS5vcGVyYXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJy0nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGNhbGwgLSBjaGVjayBmb3IgYmxvY2tpbmcgbWV0aG9kcy5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0X3JldHVybl92YWx1ZSh0aGlzLl9jdXJyZW50X25vZGUucGFyZW50LGxlZnQgLSByaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgICAgICBcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTsgICAgXHJcblxyXG4gICAgcGFyc2VyLl9ub2RlX2NhbGxfZXhwcmVzc2lvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIEluaXRpYWxpemUgc3RhdHVzIHByb3BlcnR5LlxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5hcmd1bWVudHMgPSAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5hcmd1bWVudHMgPT09ICd1bmRlZmluZWQnKSA/IFtdIDogdGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50cztcclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggPSAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5pbmRleCA9PT0gJ3VuZGVmaW5lZCcpID8gMCAgOiB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXg7IFxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPT09ICd1bmRlZmluZWQnKSA/IDAgIDogdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1czsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBzdGF0dXMuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogXHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFyZ3VtZW50cy5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggPCB0aGlzLl9jdXJyZW50X25vZGUuYXJndW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBjdXJyZW50IG5vZGUgdG8gbmV4dCBub2RlIGluIGxpc3QuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50c1t0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXS5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50c1t0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgIGVsc2UgeyBcclxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgcGFyZW50IG5vZGUuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDE6IFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuY2FsbGVlLnBhcmVudCA9IHRoaXMuX2N1cnJlbnRfbm9kZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSA9IHRoaXMuX2N1cnJlbnRfbm9kZS5jYWxsZWU7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgICAgIGNhc2UgMjogXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgc3RhdHVzIG9mIG5vZGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGFydW1lbnRzIGFycmF5LlxyXG4gICAgICAgICAgICAgICAgdmFyIHRtcF9hcmd1bWVudHMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPCB0aGlzLl9jdXJyZW50X25vZGUuYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlWydyZXR1cm52YWx1ZScgKyBTdHJpbmcoaSldXSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wX2FyZ3VtZW50cy5wdXNoKHdpbmRvd1t0aGlzLl9jdXJyZW50X25vZGVbJ3JldHVybnZhbHVlJyArIFN0cmluZyhpKV1dKTtcclxuICAgICAgICAgICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgeyAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wX2FyZ3VtZW50cy5wdXNoKHRoaXMuX2N1cnJlbnRfbm9kZVsncmV0dXJudmFsdWUnICsgU3RyaW5nKGkpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSAgICBcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBTZWxlY3QgdGhlIHR5cGUgb2YgY2FsbCB0byBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICB2YXIgY2FsbGVlID0gdGhpcy5fY3VycmVudF9ub2RlWydyZXR1cm52YWx1ZScgKyBTdHJpbmcodGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50cy5sZW5ndGgpXTtcclxuICAgICAgICAgICAgICAgIHZhciByZXR1cm52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGVlLnR5cGUgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGZ1bmN0aW9uIGNhbGxcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm52YWx1ZSA9IHdpbmRvd1tjYWxsZWUub2JqXS5hcHBseShudWxsLCB0bXBfYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGNhbGwgLSBjaGVjayBmb3IgYmxvY2tpbmcgbWV0aG9kcy5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50WydyZXR1cm52YWx1ZScgKyBTdHJpbmcodGhpcy5fY3VycmVudF9ub2RlLmFyZ3VtZW50cy5sZW5ndGgpXSA9IHJldHVybnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjYWxsZWUudHlwZSA9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoY2FsbGVlLm9iaiA9PSAnY2xvY2snKSAmJiAoY2FsbGVlLnByb3AgPT0gJ3NsZWVwJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBzcGVjaWFsIGNhbGxzIHdpdGggYmxvY2tpbmcgKG5vIGRpcmVjdCByZXN1bHQgcHJvY2Vzc2luZykuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd1tjYWxsZWUub2JqXVtjYWxsZWUucHJvcF0uYXBwbHkod2luZG93W2NhbGxlZS5vYmpdLCB0bXBfYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgeyAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2JqZWN0IG1ldGhvZHMgY2FsbHMuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnZhbHVlID0gd2luZG93W2NhbGxlZS5vYmpdW2NhbGxlZS5wcm9wXSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGNhbGwgLSBjaGVjayBmb3IgYmxvY2tpbmcgbWV0aG9kcy5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnBhcmVudFsncmV0dXJudmFsdWUnICsgU3RyaW5nKHRoaXMuX2N1cnJlbnRfbm9kZS5hcmd1bWVudHMubGVuZ3RoKV0gPSByZXR1cm52YWx1ZTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY2FsbGVlKSB7ICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NhbnZhcyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm52YWx1ZSA9IG5ldyBvc3dlYi5jYW52YXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgY2FsbCAtIGNoZWNrIGZvciBibG9ja2luZyBtZXRob2RzLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnRbJ3JldHVybnZhbHVlJyArIFN0cmluZyh0aGlzLl9jdXJyZW50X25vZGUuYXJndW1lbnRzLmxlbmd0aCldID0gcmV0dXJudmFsdWU7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICAgICAgfSAgICBcclxuICAgICAgICAgICAgYnJlYWs7ICAgIFxyXG4gICAgICAgICAgICBjYXNlIDM6IFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgICAgICBcclxuICAgICAgICB9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfZXhwcmVzc2lvbl9zdGF0ZW1lbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHN0YXR1cyBwcm9wZXJ0eS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwICA6IHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXM7IFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFByb2Nlc3MgdGhlIGN1cnJlbnQgc3RhdHVzLlxyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cykge1xyXG4gICAgICAgICAgICBjYXNlIDA6IFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuZXhwcmVzc2lvbi5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUuZXhwcmVzc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxOiBcclxuICAgICAgICAgICAgICAgIC8vIFNldCBwYXJlbnQgbm9kZS5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLnBhcmVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIDt9ICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfaWRlbnRpZmllciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIFJldHVybiBmdW5jdGlvbiByZXN1bHQuXHJcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlLm5hbWVdID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAvLyBJdGVtIGlzIHVuZGVmaW5lZCwgY3JlYXRlIGl0IHdpdGhvdXQgdmFsdWUvdHlwZSBkZWZpbml0aW9uLlxyXG4gICAgICAgICAgICB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlLm5hbWVdID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSByZXR1cm4gdmFsdWUuXHJcbiAgICAgICAgdGhpcy5fc2V0X3JldHVybl92YWx1ZSh0aGlzLl9jdXJyZW50X25vZGUucGFyZW50LCB0aGlzLl9jdXJyZW50X25vZGUubmFtZSk7XHJcblxyXG4gICAgICAgIC8vIFNldCBwYXJlbnQgbm9kZS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50O1xyXG5cclxuICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfbGl0ZXJhbCA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBTZXQgdGhlIHJldHVybiB2YWx1ZS5cclxuICAgICAgICB0aGlzLl9zZXRfcmV0dXJuX3ZhbHVlKHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQsIHRoaXMuX2N1cnJlbnRfbm9kZS52YWx1ZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHBhcmVudCBub2RlLlxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSA9IHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQ7XHJcblxyXG4gICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHBhcnNlci5fbm9kZV9tZW1iZXJfZXhwcmVzc2lvbiA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHN0YXR1cyBwcm9wZXJ0eS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwIDogdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1czsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBzdGF0dXMuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogXHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIG9iamVjdC5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLm9iamVjdC5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUub2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdG8gdGhlIG5vZGUgcHJvY2Vzc2Vzc29yLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICAgICAgICAgIGJyZWFrOyAgICBcclxuICAgICAgICAgICAgY2FzZSAxOiBcclxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3Mgb2JqZWN0LlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1cyA9IDI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUucHJvcGVydHkucGFyZW50ID0gdGhpcy5fY3VycmVudF9ub2RlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLnByb3BlcnR5O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgIFxyXG4gICAgICAgICAgICBjYXNlIDI6IFxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSByZXR1cm4gdmFsdWUuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdtZW1iZXItPicpO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh0eXBlb2YgdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5yZXR1cm52YWx1ZTAgPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRfcmV0dXJuX3ZhbHVlKHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQseyAnb2JqJzogdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMSwgJ3Byb3AnOiBudWxsLCAndHlwZSc6ICdmdW5jdGlvbid9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgeyAgICBcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRfcmV0dXJuX3ZhbHVlKHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQseyAnb2JqJzogdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMCwgJ3Byb3AnOiB0aGlzLl9jdXJyZW50X25vZGUucmV0dXJudmFsdWUxLCd0eXBlJzonb2JqZWN0J30pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgcGFyZW50IG5vZGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMztcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSA9IHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICB9O1xyXG5cclxuICAgIHBhcnNlci5fbm9kZV9wcm9ncmFtID0gZnVuY3Rpb24oKVxyXG4gICAge1xyXG4gICAgICAgIC8vIEluaXRpYWxpemUgaW5kZXggY291bnRlciBvbmx5IHRoZSBmaXRzdCB0aW1lLlxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5pbmRleCA9ICh0eXBlb2YgdGhpcy5fY3VycmVudF9ub2RlLmluZGV4ID09PSAndW5kZWZpbmVkJykgPyAwIDogdGhpcy5fY3VycmVudF9ub2RlLmluZGV4OyBcclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwIDogdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1czsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBzdGF0dXMuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogXHJcbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBhbGwgbm9kZXMgaW4gc2NyaXB0IGhhdmUgYmVlbiBwcm9jZXNzZWQuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudF9ub2RlLmluZGV4IDwgdGhpcy5fY3VycmVudF9ub2RlLmJvZHkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGN1cnJlbnQgbm9kZSB0byBuZXh0IG5vZGUgaW4gbGlzdC5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuYm9keVt0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXS5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLmJvZHlbdGhpcy5fY3VycmVudF9ub2RlLmluZGV4IC0gMV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19ub2RlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBFbmQgc3RhdHVzLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAxO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgdGhlIG5vZGUgc3RhdHMuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAyO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFsbCBub2RlcyBhcmUgcHJvY2Vzc2VkLCBzZXQgc3RhdHVzIHRvIGZpbmlzaGVkLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdHVzID0gMjtcclxuICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIENvbXBsZXRlIHRoZSBpbmxpbmUgaXRlbS4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faW5saW5lX3NjcmlwdCAhPSBudWxsKSB7ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2lubGluZV9zY3JpcHQuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIGJyZWFrOyAgICBcclxuICAgICAgICB9ICAgXHJcbiAgICB9OyAgICBcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfdmFyaWFibGVfZGVjbGFyYXRpb24gPSBmdW5jdGlvbigpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBpbmRleCBjb3VudGVyIG9ubHkgdGhlIGZpdHN0IHRpbWUuXHJcbiAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmluZGV4ID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggPT09ICd1bmRlZmluZWQnKSA/IDAgOiB0aGlzLl9jdXJyZW50X25vZGUuaW5kZXg7IFxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPSAodHlwZW9mIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgPT09ICd1bmRlZmluZWQnKSA/IDAgOiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzOyBcclxuICAgICAgICBcclxuICAgICAgICAvLyBQcm9jZXNzIHRoZSBjdXJyZW50IHN0YXR1cy5cclxuICAgICAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMpIHtcclxuICAgICAgICAgICAgY2FzZSAwOiBcclxuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBub2RlcyBpbiBzY3JpcHQgaGF2ZSBiZWVuIHByb2Nlc3NlZC5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggPCB0aGlzLl9jdXJyZW50X25vZGUuZGVjbGFyYXRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBjdXJyZW50IG5vZGUgdG8gbmV4dCBub2RlIGluIGxpc3QuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmRlY2xhcmF0aW9uc1t0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXS5wYXJlbnQgPSB0aGlzLl9jdXJyZW50X25vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlID0gdGhpcy5fY3VycmVudF9ub2RlLmRlY2xhcmF0aW9uc1t0aGlzLl9jdXJyZW50X25vZGUuaW5kZXggLSAxXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgdGhlIG5vZGUgc3RhdHMuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIGJyZWFrOyBcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgLy8gQ2hhbmdlIHRoZSBub2RlIHN0YXRzLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMjtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgcGFyZW50IG5vZGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUgPSB0aGlzLl9jdXJyZW50X25vZGUucGFyZW50O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfSAgIFxyXG4gICAgfTtcclxuXHJcbiAgICBwYXJzZXIuX25vZGVfdmFyaWFibGVfZGVjbGFyYXRvciA9IGZ1bmN0aW9uKClcclxuICAgIHtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHN0YXR1cyBwcm9wZXJ0eS5cclxuICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gKHR5cGVvZiB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID09PSAndW5kZWZpbmVkJykgPyAwIDogdGhpcy5fY3VycmVudF9ub2RlLnN0YXR1czsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgY3VycmVudCBzdGF0dXMuXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogXHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGluaXQuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzICAgICAgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmluaXQucGFyZW50ID0gdGhpcy5fY3VycmVudF9ub2RlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlICAgICAgICAgICAgID0gdGhpcy5fY3VycmVudF9ub2RlLmluaXQ7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgbm9kZSBwcm9jZXNzZXNzb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX25vZGUoKTtcclxuICAgICAgICAgICAgYnJlYWs7ICAgIFxyXG4gICAgICAgICAgICBjYXNlIDE6IFxyXG4gICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBpZC5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5zdGF0dXMgICAgPSAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudF9ub2RlLmlkLnBhcmVudCA9IHRoaXMuX2N1cnJlbnRfbm9kZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSAgICAgICAgICAgPSB0aGlzLl9jdXJyZW50X25vZGUuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgICAgIGNhc2UgMjogXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgdmFyaWFibGUuXHJcbiAgICAgICAgICAgICAgICB3aW5kb3dbdGhpcy5fY3VycmVudF9ub2RlLnJldHVybnZhbHVlMV0gPSB0aGlzLl9jdXJyZW50X25vZGUucmV0dXJudmFsdWUwOyAgICAgIFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgcGFyZW50IG5vZGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50X25vZGUuc3RhdHVzID0gMztcclxuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZSA9IHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBub2RlIHByb2Nlc3Nlc3Nvci5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIGdlbmVyYWwgbm9kZSBwcm9jZXNzaW5nLlxyXG5cclxuICAgIHBhcnNlci5fcHJvY2Vzc19ub2RlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3Byb2Nlc3Npbmcgbm9kZScpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuX2N1cnJlbnRfbm9kZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2VsZWN0IHRoZSB0eXBlIG9mIG5vZGUgdG8gcHJvY2Vzc1xyXG4gICAgICAgIHN3aXRjaCh0aGlzLl9jdXJyZW50X25vZGUudHlwZSkgeyBcclxuICAgICAgICAgICAgY2FzZSAnQmluYXJ5RXhwcmVzc2lvbic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX2JpbmFyeV9leHByZXNzaW9uKCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdDYWxsRXhwcmVzc2lvbic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX2NhbGxfZXhwcmVzc2lvbigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnRXhwcmVzc2lvblN0YXRlbWVudCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX2V4cHJlc3Npb25fc3RhdGVtZW50KCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdJZGVudGlmaWVyJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX25vZGVfaWRlbnRpZmllcigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnTGl0ZXJhbCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX2xpdGVyYWwoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ01lbWJlckV4cHJlc3Npb24nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fbm9kZV9tZW1iZXJfZXhwcmVzc2lvbigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnUHJvZ3JhbSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX3Byb2dyYW0oKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1ZhcmlhYmxlRGVjbGFyYXRpb24nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fbm9kZV92YXJpYWJsZV9kZWNsYXJhdGlvbigpO1xyXG4gICAgICAgICAgICBicmVhazsgXHJcbiAgICAgICAgICAgIGNhc2UgJ1ZhcmlhYmxlRGVjbGFyYXRvcic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub2RlX3ZhcmlhYmxlX2RlY2xhcmF0b3IoKTtcclxuICAgICAgICAgICAgYnJlYWs7IFxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBydW4gY3ljbGUuXHJcblxyXG4gICAgcGFyc2VyLl9ydW5zdGF0ZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7XHJcbiAgICAgICAgLy8gQ2FsbCB0aGUgZXhwcmVzc2lvbiBzdGF0ZW1lbnQgZW4gcmV0dXJuIHRoZSB2YWx1ZS4gICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGVfY2FsbF9leHByZXNzaW9uKG5vZGUuZXhwcmVzc2lvbik7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBwYXJzZXIuX3J1biA9IGZ1bmN0aW9uKGlubGluZV9zY3JpcHQsIGFzdF90cmVlKSB7XHJcbiAgICAgICAgLy8gU2V0IHRoZSBpbmxpbmUgaXRlbS4gXHJcblx0dGhpcy5faW5saW5lX3NjcmlwdCA9IGlubGluZV9zY3JpcHQ7XHJcblx0XHJcblx0Ly8gU2V0IHRoZSBmaXJzdCBub2RlIGFuZCBpdHMgcGFyZW50LlxyXG5cdHRoaXMuX2N1cnJlbnRfbm9kZSA9IGFzdF90cmVlO1xyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRfbm9kZS5wYXJlbnQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3N0YXR1cyA9IDE7XHJcbiAgICAgICAgXHJcbiAgICBcdC8vIFByb2Nlc3MgdGhlIG5vZGVzLiBcclxuXHRvc3dlYi5wYXJzZXIuX3Byb2Nlc3Nfbm9kZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBwYXJzZXIgY2xhc3MgdG8gdGhlIG9zd2ViIG5hbWVzcGFjZS5cclxuICAgIG9zd2ViLnBhcnNlciA9IHBhcnNlcjtcclxufSgpKTsgXHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBzZXNzaW9uIC0gc3RvcmUgdXNlciBzZXNzaW9uIGluZm9ybWF0aW9uLiBcclxuICAgIGZ1bmN0aW9uIHNlc3Npb24oKSB7XHJcbiAgICBcdHRocm93ICdUaGUgY2xhc3Mgc2Vzc2lvbiBjYW5ub3QgYmUgaW5zdGFudGlhdGVkISc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMuICAgXHJcblxyXG4gICAgc2Vzc2lvbi5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHQvLyBVcGRhdGUgdGhlIGxvYWRlciB0ZXh0LlxyXG4gICAgXHRvc3dlYi5ydW5uZXIuX3VwZGF0ZUludHJvU2NyZWVuKG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwOCk7XHJcblx0XHJcbiAgICBcdC8vIEdldCB0aGUgc2Vzc2lvbiBpbmZvcm1hdGlvbi5cclxuXHR0aGlzLl9nZXRTZXNzaW9uSW5mb3JtYXRpb24oKTtcclxuICAgIH07XHJcblxyXG4gICAgc2Vzc2lvbi5fZ2V0U2Vzc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIEdldCB0aGUgc2Vzc2lvbiBpbmZvcm1hdGlvbiBmcm9tIHRoZSBjbGllbnQgc3lzdGVtLlxyXG4gICAgXHR0aGlzLl9kYXRlID0gbmV3IERhdGUoKTtcclxuXHR0aGlzLl9zZXNzaW9uID0ge1xyXG4gICAgICAgICAgICAnYnJvd3Nlcic6IHtcclxuICAgICAgICAgICAgICAgICdjb2RlbmFtZSc6IG5hdmlnYXRvci5hcHBDb2RlTmFtZSxcclxuICAgICAgICAgICAgICAgICduYW1lJzogbmF2aWdhdG9yLmFwcE5hbWUsXHJcbiAgICAgICAgICAgICAgICAndmVyc2lvbic6IG5hdmlnYXRvci5hcHBWZXJzaW9uXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdkYXRlJzoge1xyXG4gICAgICAgICAgICAgICAgJ3N0YXJ0ZGF0ZSc6ICgnMCcgKyB0aGlzLl9kYXRlLmdldERhdGUoKSkuc2xpY2UoLTIpICsgJy0nICsgKCcwJyArIHRoaXMuX2RhdGUuZ2V0TW9udGgoKSkuc2xpY2UoLTIpICsgJy0nICsgKCcwJyArIHRoaXMuX2RhdGUuZ2V0RnVsbFllYXIoKSkuc2xpY2UoLTIpLFxyXG4gICAgICAgICAgICAgICAgJ3N0YXJ0dGltZSc6ICgnMCcgKyB0aGlzLl9kYXRlLmdldEhvdXJzKCkpLnNsaWNlKC0yKSArICc6JyArICgnMCcgKyB0aGlzLl9kYXRlLmdldE1pbnV0ZXMoKSkuc2xpY2UoLTIpICsgJzonICsgKCcwJyArIHRoaXMuX2RhdGUuZ2V0U2Vjb25kcygpKS5zbGljZSgtMiksXHJcbiAgICAgICAgICAgICAgICAnc3RhcnRkYXRlVVRDJyA6ICgnMCcgKyB0aGlzLl9kYXRlLmdldFVUQ0RhdGUoKSkuc2xpY2UoLTIpICsgJy0nICsgKCcwJyArIHRoaXMuX2RhdGUuZ2V0VVRDTW9udGgoKSkuc2xpY2UoLTIpICsgJy0nICsgKCcwJyArIHRoaXMuX2RhdGUuZ2V0VVRDRnVsbFllYXIoKSkuc2xpY2UoLTIpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdleHBlcmltZW50Jzoge1xyXG5cdFx0J2RlYnVnJzogMCxcclxuICAgICAgICAgICAgICAgICdwYXJhbWV0ZXJzJzogMCxcclxuXHRcdCdwaWxvdCc6IDAsXHJcbiAgICAgICAgICAgICAgICAndGFza25hbWUnOiAwLFxyXG4gICAgICAgICAgICAgICAgJ3Rhc2t2ZXJzaW9uJzogMFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnc2NyZWVuJzoge1xyXG4gICAgICAgICAgICAgICAgJ2F2YWlsYWJsZUhlaWdodCc6IHNjcmVlbi5hdmFpbEhlaWdodCxcclxuICAgICAgICAgICAgICAgICdhdmFpbGFibGVXaWR0aCc6IHNjcmVlbi5hdmFpbFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgJ2NvbG9yRGVwdGgnOiBzY3JlZW4uY29sb3JEZXB0aCxcclxuICAgICAgICAgICAgICAgICdoZWlnaHQnOiBzY3JlZW4uaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgJ291dGVyaGVpZ2h0Jzogd2luZG93Lm91dGVyaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgJ291dGVyd2lkdGgnOiB3aW5kb3cub3V0ZXJ3aWR0aCxcclxuICAgICAgICAgICAgICAgICdwaXhlbERlcHRoJzogc2NyZWVuLnBpeGVsRGVwdGgsXHJcbiAgICAgICAgICAgICAgICAnc2NyZWVuWCc6IHdpbmRvdy5zY3JlZW5YLFxyXG4gICAgICAgICAgICAgICAgJ3NjcmVlblknOiB3aW5kb3cuc2NyZWVuWSxcclxuICAgICAgICAgICAgICAgICd3aWR0aCc6IHNjcmVlbi53aWR0aFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnc3lzdGVtJzoge1xyXG4gICAgICAgICAgICAgICAgJ29zJzogbmF2aWdhdG9yLnBsYXRmb3JtXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBzZXNzaW9uIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5zZXNzaW9uID0gc2Vzc2lvbjtcclxufSgpKTsgXHJcbiIsIlxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHRoZSBjbGFzcyBydW5uZXIuXHJcbiAgICBmdW5jdGlvbiBydW5uZXIoKSB7XHJcbiAgICBcdHRocm93ICdUaGUgY2xhc3MgcnVubmVyIGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQhJztcclxuICAgIH07XHJcblxyXG4gICAgLy8gU2hvdyBsaWJyYXJ5IG5hbWUgYW5kIGxpYnJhcnkgdmVyc2lvbiBudW1iZXIgaW4gdGhlIGNvbnNvbGUuXHJcbiAgICBjb25zb2xlLmxvZyhvc3dlYi5WRVJTSU9OX05BTUUgKyAnIC0gJyArIG9zd2ViLlZFUlNJT05fTlVNQkVSKTtcdFxyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBwcm9wZXJ0aWVzLlxyXG4gICAgcnVubmVyLl9jYW52YXMgPSBudWxsOyAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FudmFzIG9uIHdoaWNoIHRoZSBleHBlcmltZW50IGlzIHNob3duLlxyXG4gICAgcnVubmVyLl9xdWFsdHJpY3MgPSBudWxsOyAgICAgICAgICAgICAgICAgICAgLy8gTGluayB0byB0aGUgcXVhbHRyaWNzIGludGVyZmFjZSAob3B0aW9uYWwpXHJcbiAgICBydW5uZXIuX3N0YWdlID0gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgICAvLyBMaW5rcyB0byB0aGUgc3RhZ2Ugb2JqZWN0IChDcmVhdGVKUykuXHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwdWJsaWMgcHJvcGVydGllcy5cclxuICAgIHJ1bm5lci5kYXRhID0gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbnRhaW5lciBmb3IgdGhlIGV4cGVyaW1lbnQgcmVzdWx0IGRhdGEgKGlmIGRlZmluZWQpLlxyXG4gICAgcnVubmVyLmRlYnVnID0gZmFsc2U7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVidWcgdG9nZ2xlLlxyXG4gICAgcnVubmVyLmV4cGVyaW1lbnQgPSBudWxsOyAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHJvb3QgZXhwZXJpbWVudCBvYmplY3QgdG8gcnVuLiAgICAgICAgICAgXHJcbiAgICBydW5uZXIub25GaW5pc2hlZCA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAvLyBFdmVudCB0cmlnZ2VyZWQgb24gZmluaXNoaW5nIHRoZSBleHBlcmltZW50LlxyXG4gICAgcnVubmVyLnNjcmVlbkludHJvID0gdHJ1ZTsgICAgICAgICAgICAgICAgICAgLy8gU2hvdyBpbnRyb3NjcmVlbiB0b2dnbGUuXHJcbiAgICBydW5uZXIuc2NyZWVuQ2xpY2sgPSB0cnVlOyAgICAgICAgICAgICAgICAgICAvLyBTaG93IGNsaWNrc2NyZWVuIHRvZ2dsZVxyXG4gICAgcnVubmVyLnNjcmlwdCA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udGFpbmVyIGZvciB0aGUgSlNPTiBzY3JpcHQgZGVmaW5pdGlvbiBvZiB0aGUgZXhwZXJpbWVudC5cclxuICAgIHJ1bm5lci5zY3JpcHRJRCA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElkIHVzZWQgd2hlbiByZXRyaWV2aW5nIHRoZSBzY3JpcHQgZnJvbSB0aGUgZGF0YWJhc2UuXHJcbiAgICBydW5uZXIuc2NyaXB0VVJMID0gJyc7ICAgICAgICAgICAgICAgICAgICAgICAvLyBQYXRoIHBvaW50aW5nIHRvIHRoZSBBTUZQSFAgZGF0YWJhc2UgZmlsZXMuXHJcbiAgICBydW5uZXIuc2Vzc2lvbiA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAvLyBDb250YWluZXIgZm9yIHRoZSBKU09OIHNlc3Npb24gaW5mb3JtYXRpb24uXHJcbiAgICBcclxuICAgIC8qXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIHNldHVwIHJ1bm5lci4gICAgICBcclxuICAgICAqL1xyXG5cclxuICAgIHJ1bm5lci5fc2V0dXBDb250ZW50ID0gZnVuY3Rpb24oY29udGVudCkge1xyXG4gICAgXHQvLyBDaGVjayBpZiB0aGUgZXhwZXJpbWVudCBjb250YWluZXIgaXMgZGVmaW5lZC4gICAgICAgICAgICAgICAgICAgICBcclxuXHRpZiAodHlwZW9mIGNvbnRlbnQgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgLy8gR2V0IHRoZSBjYW52YXMgZnJvbSB0aGUgRE9NIEVsZW1lbnQgdHJlZS5cclxuICAgICAgICAgICAgdGhpcy5fY2FudmFzID0gKHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJykgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250ZW50KSA6IGNvbnRlbnQ7IFx0XHRcclxuXHRcdFxyXG4gICAgICAgICAgICAvLyBTZXQgdGhlIHN0YWdlIG9iamVjdCAoZWFzZWxKUykuIFxyXG4gICAgICAgICAgICB0aGlzLl9zdGFnZSA9IG5ldyBjcmVhdGVqcy5TdGFnZSh0aGlzLl9jYW52YXMpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGFnZS5zbmFwVG9QaXhlbEVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGFnZS5yZWdYID0gLS41O1xyXG4gICAgICAgICAgICB0aGlzLl9zdGFnZS5yZWdZID0gLS41O1xyXG5cdFx0XHJcbiAgICAgICAgICAgIC8vIEJ1aWxkIHRoZSBpbml0aWFsaXphdGlvbiBzY3JlZW4uXHJcbiAgICAgICAgICAgIHRoaXMuX3NldHVwSW50cm9TY3JlZW4oKTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcbiAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKG9zd2ViLmNvbnN0YW50cy5FUlJPUl8wMDIpO1xyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgcnVubmVyLl9zZXR1cENvbnRleHQgPSBmdW5jdGlvbihjb250ZXh0KSB7XHJcblx0Ly8gQ2hlY2sgaWYgdGhlIHNjcmlwdCBwYXJhbWV0ZXIgaXMgZGVmaW5lZC4gICAgICAgICAgICAgICAgICAgICAgICBcclxuXHRpZiAodHlwZW9mIGNvbnRleHQgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgY29udGV4dCBwYXJhbWV0ZXJzLlxyXG4gICAgICAgICAgICB0aGlzLmRlYnVnID0gKHR5cGVvZiBjb250ZXh0LmRlYnVnICE9PSAndW5kZWZpbmVkJykgPyBjb250ZXh0LmRlYnVnIDogZmFsc2U7IFxyXG4gICAgICAgICAgICB0aGlzLmZpbGUgPSAodHlwZW9mIGNvbnRleHQuZmlsZSAhPT0gJ3VuZGVmaW5lZCcpID8gY29udGV4dC5maWxlIDogbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5vbkZpbmlzaGVkID0gKHR5cGVvZiBjb250ZXh0Lm9uRmluaXNoZWQgIT09ICd1bmRlZmluZWQnKSA/IGNvbnRleHQub25GaW5pc2hlZCA6IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuc2NyZWVuQ2xpY2sgPSAodHlwZW9mIGNvbnRleHQuc2NyZWVuQ2xpY2sgIT09ICd1bmRlZmluZWQnKSA/IGNvbnRleHQuc2NyZWVuQ2xpY2sgOiB0cnVlO1x0XHRcdFx0ICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuc2NyZWVuSW50cm8gPSAodHlwZW9mIGNvbnRleHQuc2NyZWVuSW50cm8gIT09ICd1bmRlZmluZWQnKSA/IGNvbnRleHQuc2NyZWVuSW50cm8gOiB0cnVlOyBcclxuICAgICAgICAgICAgdGhpcy5zY3JpcHQgPSAodHlwZW9mIGNvbnRleHQuc2NyaXB0ICE9PSAndW5kZWZpbmVkJykgPyBjb250ZXh0LnNjcmlwdCA6IG51bGw7ICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuc2NyaXB0SUQgPSAodHlwZW9mIGNvbnRleHQuc2NyaXB0SUQgIT09ICd1bmRlZmluZWQnKSA/IGNvbnRleHQuc2NyaXB0SUQgOiAwOyAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnNjcmlwdFVSTCA9ICh0eXBlb2YgY29udGV4dC5zY3JpcHRVUkwgIT09ICd1bmRlZmluZWQnKSA/IGNvbnRleHQuc2NyaXB0VVJMIDogJyc7XHRcdCBcclxuICAgICAgICAgICAgdGhpcy5zZXNzaW9uID0gKHR5cGVvZiBjb250ZXh0LnNlc3Npb24gIT09ICd1bmRlZmluZWQnKSA/IGNvbnRleHQuc2Vzc2lvbiA6IG51bGw7XHJcblx0XHRcdFx0XHRcclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW4gb3NleHAgc2NyaXB0IGlzIGdpdmVuIGFzIHBhcmFtZXRlci4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjcmlwdCAhPT0gbnVsbCkge1x0XHJcbiAgICAgICAgICAgICAgICAvLyBTdGFydCBidWlsZGluZyB0aGUgZXhwZXJpbWVudCBzdHJ1Y3R1cmUuICAgICAgXHJcblx0XHR0aGlzLl9idWlsZEV4cGVyaW1lbnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBhbiBvc2V4cCBmaWxlIGlzIGdpdmVuIGFzIHBhcmFtZXRlci4gXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZmlsZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0dXBTY3JpcHRGcm9tRmlsZSgpO1xyXG4gICAgICAgICAgICB9XHRcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2NyaXB0IGZyb20gYW4gZXh0ZXJuYWwgbG9jYXRpb24uXHJcblx0XHR0aGlzLl9zZXR1cFNjcmlwdEZyb21EYXRhYmFzZSgpO1xyXG4gICAgICAgICAgICB9XHJcblx0fVxyXG5cdGVsc2Uge1xyXG4gICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcihvc3dlYi5jb25zdGFudHMuRVJST1JfMDAzKTtcclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIHJ1bm5lci5fc2V0dXBTY3JpcHRGcm9tRmlsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIENoZWNrIGZvciBiaW5hcnkgb3IgdGV4dCBmaWxlIGRlZmluaXRpb24uXHJcbiAgICAgICAgaWYgKHRoaXMuZmlsZS5zdWJzdHJpbmcoMCwzKSA9PSAnLS0tJykge1xyXG4gICAgICAgICAgICB0aGlzLnNjcmlwdCA9IFN0cmluZyh0aGlzLmZpbGUpO1xyXG4gICAgICAgIH0gXHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIERlY29tcHJlc3MgdGhlIGdpenAgZmlsZSBhbmQgc3BsaXR0IHRoZSB0YXIgcmVzdWx0Llx0XHJcbiAgICAgICAgICAgIEdaaXAubG9hZGxvY2FsKHRoaXMuZmlsZSwgZnVuY3Rpb24oaCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRhciA9IG5ldyBUYXJHWjtcclxuICAgICAgICAgICAgICAgIHRhci5wYXJzZVRhcihoLmRhdGEuam9pbignJykpO1xyXG4gICAgICAgICAgICAgICAgdGFyLmZpbGVzLmZvckVhY2godGhpcy5zZXR1cFNjcmlwdEZyb21GaWxlUmVzdWx0LmJpbmQodGhpcykpOyBcclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCB0aGlzLnNldHVwU2NyaXB0RnJvbUZpbGVQcm9ncmVzcywgdGhpcy5zZXR1cFNjcmlwdEZyb21GaWxlQWxlcnQpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU3RhcnQgYnVpbGRpbmcgdGhlIGV4cGVyaW1lbnQgc3RydWN0dXJlLiAgICAgIFxyXG5cdHRoaXMuX2J1aWxkRXhwZXJpbWVudCgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBydW5uZXIuc2V0dXBTY3JpcHRGcm9tRmlsZUFsZXJ0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB9O1xyXG5cclxuICAgIHJ1bm5lci5zZXR1cFNjcmlwdEZyb21GaWxlUHJvZ3Jlc3MgPSBmdW5jdGlvbigpIHtcclxuICAgIH07XHJcblxyXG4gICAgcnVubmVyLnNldHVwU2NyaXB0RnJvbUZpbGVSZXN1bHQgPSBmdW5jdGlvbihwRmlsZSkge1xyXG5cdC8vIENoZWNrIGlmIHRoZSBmaWxlIGlzIHRoZSBzY3JpcHRmaWxlLlxyXG4gICAgXHRpZiAocEZpbGUuZmlsZW5hbWUgPT09ICdzY3JpcHQub3BlbnNlc2FtZScpIHtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBzY3JpcHQuXHJcbiAgICAgICAgICAgIHRoaXMuc2NyaXB0ID0gU3RyaW5nKHBGaWxlLmRhdGEpO1xyXG4gICBcdH1cclxuXHRlbHNlIGlmICgocEZpbGUuZGF0YSAhPT0gbnVsbCkgJiYgKHBGaWxlLmRhdGEgIT09ICcnKSkge1xyXG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBmaWxlIHBvb2wgZWxlbWVudC5cclxuICAgICAgICAgICAgb3N3ZWIucG9vbC5hZGRfZnJvbV9sb2NhbF9zb3VyY2UocEZpbGUpO1x0XHRcdFxyXG5cdH1cclxuICAgIH07XHJcblxyXG4gICAgcnVubmVyLl9zZXR1cFNjcmlwdEZyb21EYXRhYmFzZSA9IGZ1bmN0aW9uKCkge1xyXG5cdC8vIENoZWNrIGlmIHRoZSBVUkwgYW5kIElEIGlzIHByb3BlcnRseSBkZWZpbmVkLlxyXG4gICAgICAgXHRpZiAoKHRoaXMuc2NyaXB0SUQgPj0gMCkgJiYgKHRoaXMuc2NyaXB0VVJMICE9PSAnJykpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IHRoaXMuc2NyaXB0VVJMICsgJy9waHAvaW5kZXgucGhwPy9hamF4L2dyb3VwL2dldF9zdGF0dXMnO1xyXG4gICAgICAgICAgICB2YXIgcGFyYW1ldGVycyA9IHtncm91cF9pZDogOTksIHRhc2tfbnVtYmVyOiB0aGlzLnNjcmlwdElEfTtcclxuXHRcdFxyXG4gICAgICAgICAgICBuZXcgQWpheC5SZXF1ZXN0KHVybCwge1xyXG4gICAgICAgICAgICBcdHBhcmFtZXRlcnM6IHBhcmFtZXRlcnMsXHJcblx0XHRvbkNyZWF0ZTogZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IHJlc3BvbnNlLnRyYW5zcG9ydDtcclxuICAgICAgICAgICAgICAgICAgICB0LnNldFJlcXVlc3RIZWFkZXIgPSB0LnNldFJlcXVlc3RIZWFkZXIud3JhcChmdW5jdGlvbihvcmlnaW5hbCwgaywgdikge1xyXG5cdFx0XHRpZiAoL14oYWNjZXB0fGFjY2VwdC1sYW5ndWFnZXxjb250ZW50LWxhbmd1YWdlKSQvaS50ZXN0KGspKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsKGssIHYpO1xyXG5cdFx0XHRpZiAoL15jb250ZW50LXR5cGUkL2kudGVzdChrKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgL14oYXBwbGljYXRpb25cXC94LXd3dy1mb3JtLXVybGVuY29kZWR8bXVsdGlwYXJ0XFwvZm9ybS1kYXRhfHRleHRcXC9wbGFpbikoOy4rKT8kL2kudGVzdCh2KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbChrLCB2KTtcclxuXHRcdFx0cmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cdFx0fSxcclxuXHRcdG9uU3VjY2VzczogZnVuY3Rpb24odHJhbnNwb3J0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgcmVzcG9uc2VcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJhbnNwb3J0LnJlc3BvbnNlVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgcmVzcG9uc2UgdGV4dC5cclxuXHRcdFx0dmFyIGpzb25yZXNwb25zZSA9IEpTT04ucGFyc2UodHJhbnNwb3J0LnJlc3BvbnNlVGV4dCk7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0Ly8gQ2hlY2sgaWYgdGhlIHRhc2sgaXMgYXZhaWxhYmxlLlxyXG5cdFx0XHRpZiAoanNvbnJlc3BvbnNlLnRhc2tfYXZhaWxhYmxlID09PSAnMScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc2NyaXB0IHBhcmFtZXRlci5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0ID0ganNvbnJlc3BvbnNlLmRhdGFfYXZhaWxhYmxlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlcyAgPSBqc29ucmVzcG9uc2UuZmlsZV9hdmFpbGFibGUuc3BsaXQoJ1xcclxcbicpOyAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBmaWxlIHBvb2wgZWxlbWVudC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zd2ViLnBvb2wuYWRkX2Zyb21fc2VydmVyX3NvdXJjZSh0aGlzLnNjcmlwdFVSTCArICcvdXNlci80LycsIHRoaXMuZmlsZXMpO1x0XHRcdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblx0XHRcdGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyBlcm9yciBtZXNzYWdlIHdpdGhpbiB0aGUgY29uY29sZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zd2ViLmRlYnVnLmFkZEVycm9yKG9zd2ViLmNvbnN0YW50cy5FUlJPUl8wMDcpO1xyXG5cdFx0XHR9XHJcbiAgICAgICAgICAgICAgICAgICAgfVx0XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcblx0XHRcdC8vIFNob3cgZXJvcnIgbWVzc2FnZSB3aXRoaW4gdGhlIGNvbmNvbGUuXHJcblx0XHRcdG9zd2ViLmRlYnVnLmFkZEVycm9yKG9zd2ViLmNvbnN0YW50cy5FUlJPUl8wMDYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHRcdH0uYmluZCh0aGlzKSxcclxuXHRcdG9uRmFpbHVyZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyBlcm9yciBtZXNzYWdlIHdpdGhpbiB0aGUgY29uY29sZS5cclxuICAgICAgICAgICAgICAgICAgICBvc3dlYi5kZWJ1Zy5hZGRFcnJvcihvc3dlYi5jb25zdGFudHMuRVJST1JfMDA1KTtcclxuXHRcdH0uYmluZCh0aGlzKSBcclxuICAgICAgICAgICAgfSk7IFxyXG5cdH1cclxuXHRlbHNlIHtcclxuICAgICAgICAgICAgLy8gU2hvdyBlcm9yciBtZXNzYWdlIHdpdGhpbiB0aGUgY29uY29sZS5cclxuICAgICAgICAgICAgb3N3ZWIuZGVidWcuYWRkRXJyb3Iob3N3ZWIuY29uc3RhbnRzLkVSUk9SXzAwNCk7XHJcblx0fSBcclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5pdGlvbiBvZiBwcml2YXRlIG1ldGhvZHMgLSBJbnRyb2R1Y3Rpb24gc2NyZWVuLlxyXG5cclxuICAgIHJ1bm5lci5fc2V0dXBJbnRyb1NjcmVlbiA9ICBmdW5jdGlvbigpIHtcclxuICAgIFx0Ly8gU2V0IHRoZSBpbnRyb3NjcmVlbiBlbGVtZW50cy5cclxuXHRpZiAodGhpcy5zY3JlZW5JbnRybyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbnRyb1NjcmVlbiAgPSBuZXcgY3JlYXRlanMuU2hhcGUoKTtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9TY3JlZW4uZ3JhcGhpY3MuYmVnaW5GaWxsKCcjMDAwMDAwJykuZHJhd1JlY3QoMCwwLHRoaXMuX3N0YWdlLndpZHRoLHRoaXMuX3N0YWdlLmhlaWdodCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvTGluZSAgICA9IG5ldyBjcmVhdGVqcy5TaGFwZSgpO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnRyb0xpbmUuZ3JhcGhpY3MuYmVnaW5GaWxsKCcjQUFBQUFBJykuZHJhd1JlY3QoMjAwLDE1NSw0MDAsMSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvVGV4dDEgICA9IG5ldyBjcmVhdGVqcy5UZXh0KCdPUycsIFwiMjRweCBib2xkIFRpbWVzXCIsIFwiI0ZGMDAwMFwiKTtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9UZXh0MS54ID0gMjAwO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnRyb1RleHQxLnkgPSAxMzU7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvVGV4dDIgICA9IG5ldyBjcmVhdGVqcy5UZXh0KG9zd2ViLmNvbnN0YW50cy5NRVNTQUdFXzAwMiArIG9zd2ViLlZFUlNJT05fTlVNQkVSLCBcIjE0cHggQXJpYWxcIiwgXCIjRkZGRkZGXCIpO1xyXG4gICAgICAgICAgICB0aGlzLl9pbnRyb1RleHQyLnggPSAyMzE7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvVGV4dDIueSA9IDE0MjtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9UZXh0MyAgID0gbmV3IGNyZWF0ZWpzLlRleHQob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDAzLFwiMTJweCBBcmlhbFwiLCBcIiNGRkZGRkZcIik7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvVGV4dDMueCA9IDIwMDtcclxuICAgICAgICAgICAgdGhpcy5faW50cm9UZXh0My55ID0gMTY4O1xyXG4gICAgICAgICAgICB0aGlzLl9zdGFnZS5hZGRDaGlsZCh0aGlzLl9pbnRyb1NjcmVlbix0aGlzLl9pbnRyb0xpbmUsdGhpcy5faW50cm9UZXh0MSx0aGlzLl9pbnRyb1RleHQyLHRoaXMuX2ludHJvVGV4dDMpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGFnZS51cGRhdGUoKTtcclxuXHR9XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcnVubmVyLl9jbGVhckludHJvU2NyZWVuID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyBVcGRhdGUgdGhlIGludHJvc2NyZWVuIGVsZW1lbnRzLlxyXG5cdGlmICh0aGlzLnNjcmVlbkludHJvID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlLnJlbW92ZUNoaWxkKHRoaXMuX2ludHJvU2NyZWVuLHRoaXMuX2ludHJvTGluZSx0aGlzLl9pbnRyb1RleHQxLHRoaXMuX2ludHJvVGV4dDIsdGhpcy5faW50cm9UZXh0Myk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlLnVwZGF0ZSgpO1xyXG5cdH1cdFx0XHJcbiAgICB9O1xyXG5cdFxyXG4gICAgcnVubmVyLl91cGRhdGVJbnRyb1NjcmVlbiA9IGZ1bmN0aW9uKHRleHQpIHtcclxuXHQvLyBVcGRhdGUgdGhlIGludHJvc2NyZWVuIGVsZW1lbnRzLlxyXG5cdGlmICh0aGlzLnNjcmVlbkludHJvID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2ludHJvVGV4dDMudGV4dCA9IHRleHQ7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YWdlLnVwZGF0ZSgpO1xyXG5cdH1cdFx0XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgdGhlIHByaXZhdGUgbWV0aG9kcyAtIGJ1aWxkIGN5Y2xlLiAgICAgIFxyXG5cclxuICAgIHJ1bm5lci5fYnVpbGRFeHBlcmltZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcdC8vIEJ1aWxkIHRoZSBiYXNlIGV4cGVyaW1lbnQgb2JqZWN0LlxyXG5cdHRoaXMuZXhwZXJpbWVudCA9IG5ldyBvc3dlYi5leHBlcmltZW50KG51bGwsICd0ZXN0JywgdGhpcy5zY3JpcHQpO1xyXG5cdFxyXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgZ2xvYmFsIHN0YXRpYyBvYmplY3QgY2xhc3Nlcy5cclxuXHR3aW5kb3dbJ2l0ZW1zJ10gPSBvc3dlYi5pdGVtX3N0b3JlO1xyXG5cdHdpbmRvd1sncG9vbCddICA9IG9zd2ViLmZpbGVfcG9sZV9zdG9yZTtcclxuXHR3aW5kb3dbJ3ZhcnMnXSAgPSB0aGlzLmV4cGVyaW1lbnQudmFycztcclxuXHRcdFxyXG5cdC8vIFBlcGFyZSB0aGUgZXhwZXJpbWVudCB0byBydW4uXHJcblx0dGhpcy5fcHJlcGFyZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHByaXZhdGUgbWV0aG9kcyAtIHByZXBhcmUgY3ljbGUuICAgXHJcblxyXG4gICAgcnVubmVyLl9wcmVwYXJlID0gZnVuY3Rpb24oKSB7XHJcblx0Ly8gVXBkYXRlIGlucm9zY3JlZW4uXHJcblx0dGhpcy5fdXBkYXRlSW50cm9TY3JlZW4ob3N3ZWIuY29uc3RhbnRzLk1FU1NBR0VfMDA0KTtcclxuXHRcdFxyXG5cdC8vIFN0YXJ0IHRoZSBzdGltdWxpIGxvYWRlci5cclxuXHRvc3dlYi5wYXJhbWV0ZXJzLl9pbml0aWFsaXplKCk7XHJcbiAgICAgICAgb3N3ZWIuZnVuY3Rpb25zLl9pbml0aWFsaXplKCk7XHJcblx0b3N3ZWIuc2Vzc2lvbi5faW5pdGlhbGl6ZSgpO1xyXG5cclxuICAgICAgICAvLyBTdGFydCB0aGUgcGFyYW1ldGVyIHNjcmVlbiAoc3ViamVjdCBudW1iZXIpLlxyXG4gICAgICAgIHRoaXMuX3ByZXBhcmVQYXJhbWV0ZXJzKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJ1bm5lci5fcHJlcGFyZVBhcmFtZXRlcnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBVcGRhdGUgaW5yb3NjcmVlbi5cclxuXHR0aGlzLl91cGRhdGVJbnRyb1NjcmVlbihvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDUpO1xyXG5cclxuXHQvLyBDaGVjayBpZiBpdGVtcyBtdXN0IGJlIHByb2Nlc3NlZC4gXHJcblx0aWYgKG9zd2ViLnBhcmFtZXRlcnMuX3BhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG5cdFx0Ly8gUHJvY2VzcyB0aGUgUGFyYW1ldGVycy4gICAgICAgIFxyXG4gICBcdCAgICBvc3dlYi5wYXJhbWV0ZXJzLl9wcm9jZXNzUGFyYW1ldGVycygpO1xyXG5cdH1cclxuXHRlbHNlIHsgXHJcbiAgICAgICAgICAgIC8vIFN0YXJ0IHRoZSBleHBlcmltZW50LlxyXG4gICBcdCAgICB0aGlzLl9wcmVwYXJlU3RhcnRTY3JlZW4oKTtcclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIHJ1bm5lci5fcHJlcGFyZVN0YXJ0U2NyZWVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGV4cGVyaW1lbnQgbXVzdCBiZSBjbGlja2VkIHRvIHN0YXJ0LlxyXG4gICAgICAgIGlmICh0aGlzLnNjcmVlbkNsaWNrID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBpbnJvc2NyZWVuLlxyXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVJbnRyb1NjcmVlbihvc3dlYi5jb25zdGFudHMuTUVTU0FHRV8wMDYpO1xyXG5cdFx0XHJcbiAgICAgICAgICAgIC8vIFNldHVwIHRoZSBtb3VzZSBjbGljayByZXNwb25zZSBoYW5kbGVyLlxyXG4gICAgICAgICAgICB2YXIgY2xpY2tIYW5kbGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuXHRcdC8vIFJlbW92ZSB0aGUgaGFuZGxlci5cclxuXHRcdHRoaXMuX2NhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2xpY2tIYW5kbGVyKTtcclxuXHJcblx0XHQvLyBGaW5hbGl6ZSB0aGUgaW50cm9zY3JlZW4gZWxlbWVudHMuXHJcblx0XHR0aGlzLl9jbGVhckludHJvU2NyZWVuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHRhc2suXHJcblx0XHR0aGlzLl9pbml0aWFsaXplKCk7XHJcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKTsgXHJcblxyXG4gICAgICAgICAgICAvLyBTZXQgdGhlIHRlbXBvcmFyeSBtb3VzZSBjbGljay5cclxuICAgICAgICAgICAgdGhpcy5fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbGlja0hhbmRsZXIsIGZhbHNlKTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEZpbmFsaXplIHRoZSBpbnRyb3NjcmVlbiBlbGVtZW50cy5cclxuICAgICAgICAgICAgdGhpcy5fY2xlYXJJbnRyb1NjcmVlbigpO1xyXG5cclxuICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHJ1bm5lci5cclxuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSgpOyBcclxuXHR9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIERlZmluaXRpb24gb2YgcHJpdmF0ZSBtZXRob2RzIC0gcnVuIGN5Y2xlLiAgIFxyXG4gICAgXHJcbiAgICBydW5uZXIuX2luaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcclxuXHQvLyBJbml0aWFsaXplIHRoZSBkZWJ1Z2dlci4gXHJcblx0b3N3ZWIuZGVidWcuX2luaXRpYWxpemUoKTtcclxuXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgZGV2aWNlcy5cclxuXHRvc3dlYi5ldmVudHMuX2luaXRpYWxpemUoKTtcclxuXHJcbiAgICAgICAgLy8gUHJlcGFyZSBhbmQgZXhlY3V0ZSB0aGUgZXhwZXJpbWVudCBpdGVtLlxyXG5cdHRoaXMuZXhwZXJpbWVudC5wcmVwYXJlKCk7XHJcblx0dGhpcy5leHBlcmltZW50LnJ1bigpO1xyXG4gICAgfTtcclxuXHRcclxuICAgIHJ1bm5lci5fZmluYWxpemUgPSBmdW5jdGlvbigpIHsgICBcclxuICAgICAgICAvLyBGaW5hbGl6ZSB0aGUgZGV2aWNlcy5cclxuICAgIFx0b3N3ZWIuZXZlbnRzLl9maW5hbGl6ZSgpO1xyXG4gICAgICAgIFxyXG4gICAgXHQvLyBGaW5hbGl6ZSB0aGUgZGVidWdnZXIuIFxyXG5cdG9zd2ViLmRlYnVnLl9maW5hbGl6ZSgpO1xyXG5cclxuICAgICAgICAvLyBFeGl0IHRoZSBhcHBsaWNhdGlvbi5cclxuICAgICAgICB0aGlzLl9leGl0KCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJ1bm5lci5fZXhpdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIENsZWFyIHRoZSBjYW52YXMuXHJcbiAgICAgICAgdGhpcy5fc3RhZ2UuY2xlYXIoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXQgdGhlIGN1cnNvciB2aXNpYmlsaXR5IHRvIGRlZmF1bHQuXHJcbiAgICAgICAgdGhpcy5fc3RhZ2UuY2FudmFzLnN0eWxlLmN1cnNvciA9IFwiZGVmYXVsdFwiO1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiBhbiBldmVudCBoYW5kbGVyIGlzIGF0dGFjaGVkLlxyXG5cdGlmICh0aGlzLm9uRmluaXNoZWQpIHtcclxuICAgICAgICAgICAgLy8gRXhlY3V0ZS5cclxuICAgICAgICAgICAgdGhpcy5vbkZpbmlzaGVkKHRoaXMuZGF0YSwgb3N3ZWIuc2Vzc2lvbi5fc2Vzc2lvbik7XHJcblx0fVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEZWZpbml0aW9uIG9mIHB1YmxpYyBtZXRob2RzIC0gcnVuIGN5Y2xlLiAgICAgIFxyXG5cclxuICAgIHJ1bm5lci5ydW4gPSBmdW5jdGlvbihjb250ZW50LCBjb250ZXh0KSB7XHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgY29udGVudCBjb250YWluZXIuXHJcblx0dGhpcy5fc2V0dXBDb250ZW50KGNvbnRlbnQpO1xyXG5cclxuXHQvLyBJbml0aWFsaXplIHRoZSBjb250ZXh0IHBhcmFtZXRlclxyXG5cdHRoaXMuX3NldHVwQ29udGV4dChjb250ZXh0KTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQmluZCB0aGUgcnVubmVyIGNsYXNzIHRvIHRoZSBvc3dlYiBuYW1lc3BhY2UuXHJcbiAgICBvc3dlYi5ydW5uZXIgPSBydW5uZXI7XHJcbn0oKSk7IFxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
